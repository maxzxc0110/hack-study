# 1.概要

1. 权限提升：权限提升的集中方式
2. 信息收集：服务器信息、Hash、防火墙杀毒软件、账号密码
3. 内网渗透：端口转发、代理跳板
4. 后门植入：永久后门维持权限

# 2.权限提升

1. 提高程序运行级别
- Exploit/windows/local/ask

上面模块执行攻击以后，在靶机会弹出一个UAC对话框，当且仅当靶机管理员点击是（授权执行）以后才能收到提权的反弹shell，也就是说需要和管理员交互。

2. UAC绕过
- Exploit/windows/local/bypassuac
- Exploit/windows/local/bypassuac_injection
- Exploit/windows/local/bypassuac_vbs

上面模块不需要与靶机管理员交互，直接绕过UAC（执行成功以后需要再执行getsystem命令）

3. 利用本地提权漏洞进行提权

根据具体的系统环境，查找对应的本地系统提升漏洞

# 3.信息收集

信息收集相关
- 获取目标机器的分区情况：post/windows/gather/forensics/enum_drives
- 判断是否为虚拟机：post/windows/gather/checkvm
- 开启哪些服务：post/windows/gather/enum_services
- 安装了哪些应用：post/windows/gather/enum_applocations
- 查看共享：post/windows/gather/enum_shares
- 获取主机最近的系统操作：post/windows/gather/dumplinks
- 查看补丁：post/windows/gather.enum_applications
- scraper脚本
- winenum脚本

 
# 4.数据包捕获

抓包与解包
> 抓包

- 加载sniffer:load sniffer
- 查看网卡信息：sniffer_interface
- 开启监听：sniffer_start 1
- 导出数据包:sniffer_dump 1 1.cap

> 解包

- auxiliary/sniffer/psnuffle

# 5.PassingTheHash
Hash 基础知识
windows系统下的hash密码格式为：

> 用户名称：RID：LM-HASH值：NT-HASH值


获取Hash值

- Hashdump
- Run post/windows/gather/smart_hashdump
- 检查权限和系统类型
- 检查是否是域控制器
- 从注册表读取hash、注入LSASS进程
- 如果是08server并具有管理员权限，直接getsystem尝试提权
- 如果是win7且UAC关闭并具有管理员权限，从注册表读取
- 03/xp直接getsystem,从注册表获取hash

Hash传递(直接用hash密文登录，前提是关闭了UAC)
- Pasexec: exploit/windows/smb/psexec


看到第6