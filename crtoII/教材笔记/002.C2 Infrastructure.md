# Defence in Depth

几种情况可能导致红队把服务用户暴露在危险当中

> Leaving unauthenticated backdoors open and accessible via the Internet, such as web shells or SOCKS proxies.(保留未经身份验证的后门通过 Internet 打开和访问，如 Web shell 或 SOCKS 代理。)

> Using unencrypted channels, such as netcat or HTTP shells.(使用未加密的通道，如 netcat 或 HTTP shell)

> C2 servers being compromised, e.g. this [Cobalt Strike RCE](https://blog.cobaltstrike.com/2016/09/28/cobalt-strike-rce-active-exploitation-reported/) and [Covenant RCE](https://blog.null.farm/hunting-the-hunters).(C2服务器暴露，Cobalt Strike RCE或者Covenant RCE)

# Infrastructure Design

C2基础设施图表

![img](https://rto2-assets.s3.eu-west-2.amazonaws.com/inf/red-team-infra-overview.png?width=1920)

# Apache Installation

安装
```
sudo apt install apache2
sudo a2enmod ssl rewrite proxy proxy_http
```

配置文件
```
ubuntu@redirector-1 /e/a/sites-enabled> ll
total 0
lrwxrwxrwx 1 root root 35 Nov  5  2021 000-default.conf -> ../sites-available/000-default.conf
ubuntu@redirector-1 /e/a/sites-enabled> sudo rm 000-default.conf
ubuntu@redirector-1 /e/a/sites-enabled> sudo ln -s ../sites-available/default-ssl.conf .
ubuntu@redirector-1 /e/a/sites-enabled> ll
total 0
lrwxrwxrwx 1 root root 35 May 26 10:27 default-ssl.conf -> ../sites-available/default-ssl.conf
```

重启apache
```
sudo systemctl restart apache2
```