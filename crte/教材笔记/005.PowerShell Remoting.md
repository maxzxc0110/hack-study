WinRM一般启用5985 (HTTP) and 5986 (HTTPS)端口

需要在Windows机器上启用 ```Enable-PSRemoting```,需要本地管理员权限

远程进程作为一个高完整性进程运行。也就是说，你会得到一个高权限的shell

1. One-to-One

• PSSession
	– Interactive
	– Runs in a new process (wsmprovhost)
	– Is Stateful

• Useful cmdlets
	– New-PSSession
	– Enter-PSSession


2. One-to-Many

• Also known as Fan-out remoting.
• Non-interactive.
• Executes commands in parallel.
• Useful cmdlets
	– Invoke-Command


## Invoke-Command

• Run commands and scripts on
	– multiple remote computers,
	– in disconnected sessions (v3)
	– as background job and more.

• The best thing in PowerShell for passing the hashes, using credentials and executing commands on multiple remote computers.

• Use –Credential parameter to pass username/password.


执行命令
```
Invoke-Command –Scriptblock {Get-Process} -ComputerName (Get-Content <list_of_servers>)
```

执行脚本
```
Invoke-Command –FilePath C:\scripts\Get-PassHashes.ps1 -ComputerName (Get-Content <list_of_servers>)
```

使用下面的方法在远程机器上执行本地加载的函数
```
Invoke-Command -ScriptBlock ${function:Get-PassHashes} -ComputerName (Get-Content <list_of_servers>)
```

上面命令，传递参数的方法
```
Invoke-Command -ScriptBlock ${function:Get-PassHashes} -ComputerName (Get-Content <list_of_servers>) -ArgumentList
```
	
Use below to execute "Stateful" commands using  Invoke-Command	
```
$Sess = New-PSSession –Computername Server1

Invoke-Command –Session $Sess –ScriptBlock {$Proc = Get-Process}

Invoke-Command –Session $Sess –ScriptBlock {$Proc.Name}
```

## winrs

使用winrs命令远程执行，可以逃避日志
```
winrs -remote:server1 -u:server1\administrator -p:Pass@1234 hostname
```

