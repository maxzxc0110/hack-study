# 引入powershell

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659175709057.jpg)

# 枚举当前域
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659175767155.png)

# 枚举当前域的DC
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659175840055.png)

# 枚举林
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659175909887.png)

# 枚举域策略
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659175983912.png)

# 获取域成员
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659176161323.png)

# 获取域里所有计算机
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659176212400.png)

# 获取所有OU
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659177797247.png)

# 获取所有带admin的域组
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659177842792.png)

# 获取所有DA
![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659177954716.png)

# 获取所有GPO
powershell Get-DomainGPO -Properties DisplayName | sort -Property DisplayName

powershell Get-DomainGPO -ComputerIdentity dc01 -Properties DisplayName | sort -Property DisplayName

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659178168742.png)


# Get-DomainGPOLocalGroup
```
beacon> powershell Get-DomainGPOLocalGroup | select GPODisplayName, GroupName

GPODisplayName GroupName           
-------------- ---------           
Tier 1 Admins  DEV\Developers      
Tier 2 Admins  DEV\1st Line Support
```


# Get-DomainGPOUserLocalGroupMapping
```
beacon> powershell Get-DomainGPOUserLocalGroupMapping -LocalGroup Administrators | select ObjectName, GPODisplayName, ContainerName, ComputerName

ObjectName       GPODisplayName ContainerName                                     ComputerName             
----------       -------------- -------------                                     ------------             
1st Line Support Tier 2 Admins  {OU=Tier 2,OU=Servers,DC=dev,DC=cyberbotic,DC=io} {srv-2.dev.cyberbotic.io}
Developers       Tier 1 Admins  {OU=Tier 1,OU=Servers,DC=dev,DC=cyberbotic,DC=io} {srv-1.dev.cyberbotic.io}
```

# Find-DomainUserLocation
```
beacon> powershell Find-DomainUserLocation | select UserName, SessionFromName

UserName      SessionFromName          
--------      ---------------          
nlamb         wkstn-2.dev.cyberbotic.io
```

# Get-NetSession
```
beacon> powershell Get-NetSession -ComputerName dc-2 | select CName, UserName

CName          UserName
-----          --------
\\10.10.17.231 bfarmer 
\\10.10.17.132 nlamb   
```

# Get-DomainTrust
```
beacon> powershell Get-DomainTrust

SourceName      : dev.cyberbotic.io
TargetName      : cyberbotic.io
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : WITHIN_FOREST
TrustDirection  : Bidirectional
WhenCreated     : 2/19/2021 1:28:00 PM
WhenChanged     : 2/19/2021 1:28:00 PM

SourceName      : dev.cyberbotic.io
TargetName      : subsidiary.external
TrustType       : WINDOWS_ACTIVE_DIRECTORY
TrustAttributes : 
TrustDirection  : Inbound
WhenCreated     : 2/19/2021 10:50:56 PM
WhenChanged     : 2/19/2021 10:50:56 PM
```